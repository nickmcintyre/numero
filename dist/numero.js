/*! For license information please see numero.js.LICENSE.txt */
var num;(()=>{var e={328:(e,t)=>{"use strict";function n(e){return new Uint8Array(atob(e).split("").map((function(e){return e.charCodeAt(0)})))}Object.defineProperty(t,"__esModule",{value:!0}),t.stringToUint8array=n,t.stringToArray=function(e){var t=n(e);return new Int16Array(t.buffer)};var r=!1,i=0;function a(){if(r)return r=!1,i;var e=2*Math.random()-1,t=2*Math.random()-1,n=e*e+t*t;if(0===n||n>1)return a();var o=Math.sqrt(-2*Math.log(n)/n);return i=t*o,r=!0,e*o}function o(e,t){return Math.random()*(t-e)+e}function s(e,t){return e+a()*t}function u(e,t){void 0===t&&(t=2);var n=t;function r(e,t){return[e[0]-t[0],e[1]-t[1]]}function i(e,t){return e[0]*t[0]+e[1]*t[1]}function a(e){return e[0]*e[0]+e[1]*e[1]}function o(e,t){return a(r(e,t))}var s,u,c,l,f=e.length,p=[],h=n*n,d=[],m=[];for(d[0]=e[0],s=u=1,l=0;s<f;s++)o(e[s],e[l])<h||(d[u++]=e[s],l=s);for(l<f-1&&(d[u++]=e[f-1]),m[0]=m[u-1]=1,function e(t,n,s,u,c){if(!(u<=s+1)){for(var l,f,p,h,d=s,m=0,g=t*t,v=[n[s],n[u]],y=r(v[1],v[0]),b=a(y),x=s+1;x<u;x++)(p=i(r(n[x],v[0]),y))<=0?h=o(n[x],v[0]):b<=p?h=o(n[x],v[1]):(f=p/b,l=[v[0][0]+f*y[0],v[0][1]+f*y[1]],h=o(n[x],l)),h<=m||(d=x,m=h);m>g&&(c[d]=1,e(t,n,s,d,c),e(t,n,d,u,c))}}(n,d,0,u-1,m),s=c=0;s<u;s++)m[s]&&(p[c++]=d[s]);return p}t.gaussRandom=a,t.randf=o,t.randi=function(e,t){return Math.floor(Math.random()*(t-e)+e)},t.randn=s,t.birandn=function(e,t,n,r,i){var a=s(0,1),o=s(0,1);return[Math.sqrt(1-i*i)*n*a+i*n*o+e,r*o+t]},t.sampleSoftmax=function(e){var t,n=o(0,1),r=e.length,i=0;for(t=0;t<r;t++)if((i+=e[t])>=n)return t;return console.log("error sampling pi index"),-1},t.simplifyLine=u,t.simplifyLines=function(e,t){var n=[],r=2;t&&(r=t);for(var i=0;i<e.length;i++)n.push(u(e[i],r));return n},t.linesToStrokes=function(e){var t,n,r,i,a,o,s,u,c,l,f=0,p=0,h=[];for(s=0;s<e.length;s++)if((c=e[s].length)>1)for(u=0;u<c;u++)u===c-1?(o=1,a=0):(o=0,a=1),r=(t=(l=e[s][u])[0])-f,i=(n=l[1])-p,f=t,p=n,h.push([r,i,a,o,0]);return h.push([0,0,0,0,1]),h.slice(1)},t.lineToStroke=function(e,t){var n,r,i,a,o,s,u,c,l,f,p,h=[];if(l=t[0],f=t[1],(i=e.length)>1)for(p=0;p<i;p++)p===i-1?(r=1,n=0):(r=0,n=1),o=(u=(a=e[p])[0])-l,s=(c=a[1])-f,l=u,f=c,h.push([o,s,n,r,0]);return h}},6240:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2099);t.tf=r,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(5656))},5656:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3850);t.SketchRNN=r.SketchRNN},3850:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(75),o=n(328),s=function(){function e(e){this.NMIXTURE=20,this.checkpointURL=e,this.initialized=!1}return e.prototype.isInitialized=function(){return this.initialized},e.prototype.instantiateFromJSON=function(e,t,n){var r;this.forgetBias=a.scalar(1),this.info=e,this.setPixelFactor(2),this.weightDims=t,this.numUnits=this.weightDims[0][0],this.weights=[];for(var i=0;i<n.length;i++){for(var s=(r=new Float32Array(o.stringToArray(n[i]))).length,u=0;u<s;u++)r[u]=10*r[u]/32767;this.weights.push(r)}this.outputKernel=a.tensor2d(this.weights[0],[this.weightDims[0][0],this.weightDims[0][1]]),this.outputBias=a.tensor1d(this.weights[1]);var c=a.tensor2d(this.weights[2],[this.weightDims[2][0],this.weightDims[2][1]]),l=a.tensor2d(this.weights[3],[this.weightDims[3][0],this.weightDims[3][1]]);this.lstmKernel=a.concat2d([c,l],0),this.lstmBias=a.tensor1d(this.weights[4]),this.rawVars=[this.outputKernel,this.outputBias,this.lstmKernel,this.lstmBias]},e.prototype.initialize=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.dispose(),[4,fetch(this.checkpointURL).then((function(e){return e.json()}))];case 1:return e=t.sent(),this.instantiateFromJSON(e[0],e[1],e[2]),this.initialized=!0,console.log("Initialized SketchRNN."),[2]}}))}))},e.prototype.dispose=function(){if(this.rawVars){for(var e=0;e<this.rawVars.length;e++)this.rawVars[e].dispose();this.rawVars=void 0}this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},e.prototype.setPixelFactor=function(e){this.pixelFactor=e,this.scaleFactor=this.info.scale_factor/this.pixelFactor},e.prototype.update=function(e,t){var n=this,r=a.tidy((function(){var r=n.numUnits,i=n.scaleFactor,o=[e[0]/i,e[1]/i,e[2],e[3],e[4]],s=a.tensor2d(o,[1,5]),u=a.tensor2d(t.c,[1,r]),c=a.tensor2d(t.h,[1,r]),l=a.basicLSTMCell(n.forgetBias,n.lstmKernel,n.lstmBias,s,u,c);return a.concat(l,1)})),i=r.dataSync();r.dispose();var o=i.slice(0,this.numUnits),s=i.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(o),h:new Float32Array(s)}},e.prototype.updateStrokes=function(e,t,n){var r=this,i=a.tidy((function(){var i,o,s,u,c,l=r.numUnits,f=r.scaleFactor,p=e.length;n&&(p=n),s=a.tensor2d(t.c,[1,l]),u=a.tensor2d(t.h,[1,l]);for(var h=0;h<p;h++)i=[e[h][0]/f,e[h][1]/f,e[h][2],e[h][3],e[h][4]],o=a.tensor2d(i,[1,5]),s=(c=a.basicLSTMCell(r.forgetBias,r.lstmKernel,r.lstmBias,o,s,u))[0],u=c[1];return a.concat(c,1)})),o=i.dataSync();i.dispose();var s=o.slice(0,this.numUnits),u=o.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(s),h:new Float32Array(u)}},e.prototype.getPDF=function(e,t,n){var r=this;void 0===t&&(t=.65);var i=t,o=.5+.5*i;n&&(o=n);var s=this.NMIXTURE,u=a.tidy((function(){var t=r.numUnits,n=a.tensor2d(e.h,[1,t]),u=a.scalar(Math.sqrt(i)),c=a.scalar(o),l=a.add(a.matMul(n,r.outputKernel),r.outputBias).squeeze(),f=a.split(l,[3,6*s]),p=f[0],h=f[1],d=a.split(h,6),m=d[0],g=d[1],v=d[2],y=d[3],b=d[4],x=d[5],w=a.softmax(p.div(c)),E=[a.softmax(m.div(c)),g,v,a.exp(y).mul(u),a.exp(b).mul(u),a.tanh(x),w];return a.concat(E)})),c=u.dataSync();return u.dispose(),{pi:new Float32Array(c.slice(0,s)),muX:new Float32Array(c.slice(1*s,2*s)),muY:new Float32Array(c.slice(2*s,3*s)),sigmaX:new Float32Array(c.slice(3*s,4*s)),sigmaY:new Float32Array(c.slice(4*s,15*s)),corr:new Float32Array(c.slice(5*s,6*s)),pen:new Float32Array(c.slice(6*s,6*s+3))}},e.prototype.zeroState=function(){return{c:new Float32Array(this.numUnits),h:new Float32Array(this.numUnits)}},e.prototype.copyState=function(e){return{c:new Float32Array(e.c),h:new Float32Array(e.h)}},e.prototype.zeroInput=function(){return[0,0,1,0,0]},e.prototype.sample=function(e){var t=o.sampleSoftmax(e.pi),n=e.muX[t],r=e.muY[t],i=e.sigmaX[t],a=e.sigmaY[t],s=e.corr[t],u=[0,0,0];u[o.sampleSoftmax(e.pen)]=1;var c=o.birandn(n,r,i,a,s);return[c[0]*this.scaleFactor,c[1]*this.scaleFactor,u[0],u[1],u[2]]},e.prototype.simplifyLine=function(e,t){return o.simplifyLine(e,t)},e.prototype.simplifyLines=function(e,t){return o.simplifyLines(e,t)},e.prototype.linesToStroke=function(e){return o.linesToStrokes(e)},e.prototype.lineToStroke=function(e,t){return o.lineToStroke(e,t)},e}();t.SketchRNN=s},9503:function(e,t,n){!function(e,t,n){"use strict";const r={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class i{constructor(e,t){this.modelPath=t||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(e)}/model.json`}getPrefix(e){return"lite_mobilenet_v2"===e?`ssd${e}`:`ssd_${e}`}async load(){this.model=await t.loadGraphModel(this.modelPath);const e=n.zeros([1,300,300,3],"int32"),r=await this.model.executeAsync(e);await Promise.all(r.map((e=>e.data()))),r.map((e=>e.dispose())),e.dispose()}async infer(e,t,r){const i=n.tidy((()=>(e instanceof n.Tensor||(e=n.browser.fromPixels(e)),n.expandDims(e)))),a=i.shape[1],o=i.shape[2],s=await this.model.executeAsync(i),u=s[0].dataSync(),c=s[1].dataSync();i.dispose(),n.dispose(s);const[l,f]=this.calculateMaxScores(u,s[0].shape[1],s[0].shape[2]),p=n.getBackend();"webgl"===n.getBackend()&&n.setBackend("cpu");const h=n.tidy((()=>{const e=n.tensor2d(c,[s[1].shape[1],s[1].shape[3]]);return n.image.nonMaxSuppression(e,l,t,r,r)})),d=h.dataSync();return h.dispose(),p!==n.getBackend()&&n.setBackend(p),this.buildDetectedObjects(o,a,c,l,d,f)}buildDetectedObjects(e,t,n,i,a,o){const s=a.length,u=[];for(let c=0;c<s;c++){const s=[];for(let e=0;e<4;e++)s[e]=n[4*a[c]+e];const l=s[0]*t,f=s[1]*e,p=s[2]*t,h=s[3]*e;s[0]=f,s[1]=l,s[2]=h-f,s[3]=p-l,u.push({bbox:s,class:r[o[a[c]]+1].displayName,score:i[a[c]]})}return u}calculateMaxScores(e,t,n){const r=[],i=[];for(let a=0;a<t;a++){let t=Number.MIN_VALUE,o=-1;for(let r=0;r<n;r++)e[a*n+r]>t&&(t=e[a*n+r],o=r);r[a]=t,i[a]=o}return[r,i]}async detect(e,t=20,n=.5){return this.infer(e,t,n)}dispose(){null!=this.model&&this.model.dispose()}}e.ObjectDetection=i,e.load=async function(e={}){if(null==n)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const t=e.base||"lite_mobilenet_v2",r=e.modelUrl;if(-1===["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(t))throw new Error(`ObjectDetection constructed with invalid base model ${t}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const a=new i(t,r);return await a.load(),a},e.version="2.2.2",Object.defineProperty(e,"__esModule",{value:!0})}(t,n(6946),n(75))},6946:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GraphModel:()=>oe,loadGraphModel:()=>se,deregisterOp:()=>h,registerOp:()=>f,version_converter:()=>ue});var r,i,a,o=n(75),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function u(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(a=r||(r={}))[a.DT_INVALID=0]="DT_INVALID",a[a.DT_FLOAT=1]="DT_FLOAT",a[a.DT_DOUBLE=2]="DT_DOUBLE",a[a.DT_INT32=3]="DT_INT32",a[a.DT_UINT8=4]="DT_UINT8",a[a.DT_INT16=5]="DT_INT16",a[a.DT_INT8=6]="DT_INT8",a[a.DT_STRING=7]="DT_STRING",a[a.DT_COMPLEX64=8]="DT_COMPLEX64",a[a.DT_INT64=9]="DT_INT64",a[a.DT_BOOL=10]="DT_BOOL",a[a.DT_QINT8=11]="DT_QINT8",a[a.DT_QUINT8=12]="DT_QUINT8",a[a.DT_QINT32=13]="DT_QINT32",a[a.DT_BFLOAT16=14]="DT_BFLOAT16",a[a.DT_FLOAT_REF=101]="DT_FLOAT_REF",a[a.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",a[a.DT_INT32_REF=103]="DT_INT32_REF",a[a.DT_UINT8_REF=104]="DT_UINT8_REF",a[a.DT_INT16_REF=105]="DT_INT16_REF",a[a.DT_INT8_REF=106]="DT_INT8_REF",a[a.DT_STRING_REF=107]="DT_STRING_REF",a[a.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",a[a.DT_INT64_REF=109]="DT_INT64_REF",a[a.DT_BOOL_REF=110]="DT_BOOL_REF",a[a.DT_QINT8_REF=111]="DT_QINT8_REF",a[a.DT_QUINT8_REF=112]="DT_QUINT8_REF",a[a.DT_QINT32_REF=113]="DT_QINT32_REF",a[a.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(i||(i={}));var l={};function f(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};l[e]=n}function p(e){return l[e]}function h(e){delete l[e]}function d(e,t,n,r){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var a=i.inputIndexStart,o=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?a+1:i.inputIndexEnd;if("tensor"===i.type)return m(t.inputNames[i.inputIndexStart],n,r);if("tensors"===i.type)return t.inputNames.slice(a,o).map((function(e){return m(e,n,r)}));var s=Array.prototype.slice.call(m(t.inputNames.slice(a)[0],n,r).dataSync());return"number"===i.type?s[0]:s}var u=t.attrParams[e];return u&&u.value}function m(e,t,n){var r=y(e),i=r[0],a=r[1],o=n.currentContextIds.find((function(e){return!!t[v(i,e)]}));return void 0!==o?t[v(i,o)][a]:void 0}function g(e,t){var n=y(e),r=n[0],i=n[1];return[v(r,t&&t.currentContextId),i]}function v(e,t){return t?e+"-"+t:e}function y(e){var t=e.lastIndexOf(":");return-1===t?[e,0]:[e.substring(0,t),Number(e.substring(t+1))]}function b(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}var x=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),w=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),E=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),C=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),S=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),N=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),A=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),k=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),D=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),_=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),M=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),T=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),O=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),I=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),F=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),R=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),B=function(){function e(){var e=[x,w,E,C,S,N,A,_,D,k,M,T,O,I,F,R],t=[].concat.apply([],e.map((function(e){return e.json})));this.opMappers=t.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return Object.defineProperty(e,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),e.prototype.transformGraph=function(e,t){var n=this;void 0===t&&(t={});var r=[],i=[],a=e.node.reduce((function(e,t){return e[t.name]=n.mapNode(t),t.op.startsWith("Placeholder")&&r.push(e[t.name]),"Const"===t.op&&i.push(e[t.name]),e}),{}),o=[],s=[],u={},c={};null!=t&&(u=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));var l=Object.keys(a);return l.forEach((function(e){var t=a[e];t.inputNames.forEach((function(e){var n=g(e)[0];t.inputs.push(a[n]),a[n].children.push(t)}))})),0===Object.keys(c).length?l.forEach((function(e){var t=a[e];0===t.children.length&&s.push(t)})):Object.keys(c).forEach((function(e){var t=g(e)[0],n=a[t];null!=n&&(n.signatureKey=c[e],s.push(n))})),Object.keys(u).length>0?Object.keys(u).forEach((function(e){var t=g(e)[0],n=a[t];n&&(n.signatureKey=u[e],o.push(n))})):o=r,{nodes:a,inputs:o,outputs:s,weights:i,placeholders:r,signature:t}},e.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})},e.prototype.mapNode=function(e){var t=p(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,i=void 0;switch(n.type){case"string":void 0===(i=P(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=P(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(i=G(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=G(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(i=j(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(i=j(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(i=H(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=H(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(i=L(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=L(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(i=X(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=X(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(i=$(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=$(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(i=K(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=K(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(i=q(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=q(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(i=W(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(i=W(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+n.type+" for op: "+e.op)}return t[n.name]={value:i,type:r},t}),{})),n},e}();function z(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=(0,o.env)().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function P(e,t,n,r){void 0===r&&(r=!1);var i=e[t];return null!=i?z(i.s,r):n}function L(e,t,n){var r=e[t];return r?r.b:n}function j(e,t,n){var r=e[t]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function U(e){switch("string"==typeof e&&(e=r[e]),e){case r.DT_FLOAT:return"float32";case r.DT_INT32:case r.DT_INT64:case r.DT_INT8:case r.DT_UINT8:return"int32";case r.DT_BOOL:return"bool";case r.DT_DOUBLE:return"float32";case r.DT_STRING:return"string";default:return null}}function q(e,t,n){var r=e[t];return r&&r.type?U(r.type):n}function W(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return U(e)})):n}function V(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function $(e,t,n){var r=e[t];return r&&r.shape?V(r.shape):n}function H(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function G(e,t,n,r){void 0===r&&(r=!1);var i=e[t];return i&&i.list&&i.list.s?i.list.s.map((function(e){return z(e,r)})):n}function K(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return V(e)})):n}function X(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var Y=function(){function e(e,t,n){var r=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((function(e){return r.getInput(e)})),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce((function(e,t){return e[t]=r.getAttr(t),e}),{}))}return e.prototype.getInput=function(e){return m(e,this.tensorMap,this.context)},e.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return m(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return j(this.node.rawAttrs,e,t);if(null!=n.s)return P(this.node.rawAttrs,e,t);if(null!=n.b)return L(this.node.rawAttrs,e,t);if(null!=n.shape)return $(this.node.rawAttrs,e,t);if(null!=n.type)return q(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return H(this.node.rawAttrs,e,t);if(null!=n.list.s)return G(this.node.rawAttrs,e,t);if(null!=n.list.shape)return K(this.node.rawAttrs,e,t);if(null!=n.list.b)return X(this.node.rawAttrs,e,t);if(null!=n.list.type)return W(this.node.rawAttrs,e,t)}return t},e}(),J=function(){function e(t,n,r,i,a,o,s){this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=i,this.identicalElementShapes=a,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=e.nextId++}return Object.defineProperty(e.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),e.prototype.clearAndClose=function(){this.tensors.forEach((function(e){return e.tensor.dispose()})),this.tensors=[],this.closed_=!0},e.prototype.size=function(){return this.tensors.length},e.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.tensors.length)throw new Error("Tried to read from index "+e+", but array size is: "+this.tensors.length);var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},e.prototype.readMany=function(e){var t=this;return e.map((function(e){return t.read(e)}))},e.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+",\n          because the value dtype is "+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");n.tensor=t,n.written=!0,this.tensors[e]=n},e.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+e.length+" is not the same as tensors size: "+t.length+".");e.forEach((function(e,r){return n.write(e,t[r])}))},e.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(!e){e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return(0,o.tensor)([],[0].concat(this.elementShape));var r=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),(0,o.stack)(r,0)},e.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(0===this.size())return(0,o.tensor)([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+r[0].shape+")"),(0,o.concat)(r,0)},e.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var n=Math.max.apply(Math,e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(e,(0,o.unstack)(t,0))},e.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var r=0,i=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+r+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var a=0===r?0:t.size/r,s=[];(0,o.tidy)((function(){t=t.reshape([1,r,a]);for(var u=0;u<e.length;++u){var c=[0,0===u?0:i[u-1],0],l=[1,e[u],a];s[u]=(0,o.slice)(t,c,l).reshape(n.elementShape)}return s}));for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},e.prototype.assertShapesMatchAllowUndefinedSize=function(e,t,n){void 0===n&&(n=""),o.util.assert(this.shapesEqualAllowUndefinedSize(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))},e.prototype.shapesEqualAllowUndefinedSize=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0},e.nextId=0,e}();function Z(e,t,n){var r=function(e,t,n){switch(e.category){case"arithmetic":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[(0,o.add)(d("a",e,t,n),d("b",e,t,n))];case"AddN":return[(0,o.addN)(d("tensors",e,t,n))];case"FloorMod":case"Mod":return[(0,o.mod)(d("a",e,t,n),d("b",e,t,n))];case"Mul":return[(0,o.mul)(d("a",e,t,n),d("b",e,t,n))];case"RealDiv":case"Div":return[(0,o.div)(d("a",e,t,n),d("b",e,t,n))];case"DivNoNan":return[(0,o.divNoNan)(d("a",e,t,n),d("b",e,t,n))];case"FloorDiv":return[(0,o.floorDiv)(d("a",e,t,n),d("b",e,t,n))];case"Sub":return[(0,o.sub)(d("a",e,t,n),d("b",e,t,n))];case"Minimum":return[(0,o.minimum)(d("a",e,t,n),d("b",e,t,n))];case"Maximum":return[(0,o.maximum)(d("a",e,t,n),d("b",e,t,n))];case"Pow":return[(0,o.pow)(d("a",e,t,n),d("b",e,t,n))];case"SquaredDifference":return[(0,o.squaredDifference)(d("a",e,t,n),d("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"basic_math":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[(0,o.abs)(d("x",e,t,n))];case"Acos":return[(0,o.acos)(d("x",e,t,n))];case"Acosh":return[(0,o.acosh)(d("x",e,t,n))];case"Asin":return[(0,o.asin)(d("x",e,t,n))];case"Asinh":return[(0,o.asinh)(d("x",e,t,n))];case"Atan":return[(0,o.atan)(d("x",e,t,n))];case"Atan2":return[(0,o.atan2)(d("x",e,t,n),d("y",e,t,n))];case"Atanh":return[(0,o.atanh)(d("x",e,t,n))];case"Ceil":return[(0,o.ceil)(d("x",e,t,n))];case"Complex":return[(0,o.complex)(d("real",e,t,n),d("imag",e,t,n))];case"Cos":return[(0,o.cos)(d("x",e,t,n))];case"Cosh":return[(0,o.cosh)(d("x",e,t,n))];case"Elu":return[(0,o.elu)(d("x",e,t,n))];case"Erf":return[(0,o.erf)(d("x",e,t,n))];case"Exp":return[(0,o.exp)(d("x",e,t,n))];case"Expm1":return[(0,o.expm1)(d("x",e,t,n))];case"Floor":return[(0,o.floor)(d("x",e,t,n))];case"Log":return[(0,o.log)(d("x",e,t,n))];case"Log1p":return[(0,o.log1p)(d("x",e,t,n))];case"Imag":return[(0,o.imag)(d("x",e,t,n))];case"Neg":return[(0,o.neg)(d("x",e,t,n))];case"Reciprocal":return[(0,o.reciprocal)(d("x",e,t,n))];case"Real":return[(0,o.real)(d("x",e,t,n))];case"Relu":return[(0,o.relu)(d("x",e,t,n))];case"Round":return[(0,o.round)(d("x",e,t,n))];case"Selu":return[(0,o.selu)(d("x",e,t,n))];case"Sigmoid":return[(0,o.sigmoid)(d("x",e,t,n))];case"Sin":return[(0,o.sin)(d("x",e,t,n))];case"Sign":return[(0,o.sign)(d("x",e,t,n))];case"Sinh":return[(0,o.sinh)(d("x",e,t,n))];case"Softplus":return[(0,o.softplus)(d("x",e,t,n))];case"Sqrt":return[(0,o.sqrt)(d("x",e,t,n))];case"Square":return[(0,o.square)(d("x",e,t,n))];case"Tanh":return[(0,o.tanh)(d("x",e,t,n))];case"Tan":return[(0,o.tan)(d("x",e,t,n))];case"Relu6":case"ClipByValue":return[(0,o.clipByValue)(d("x",e,t,n),d("clipValueMin",e,t,n),d("clipValueMax",e,t,n))];case"Rsqrt":return[(0,o.rsqrt)(m(e.inputNames[0],t,n))];case"Prod":return[(0,o.prod)(d("x",e,t,n),d("axes",e,t,n))];case"LeakyRelu":return[(0,o.leakyRelu)(d("x",e,t,n),d("alpha",e,t,n))];case"Prelu":return[(0,o.prelu)(d("x",e,t,n),d("alpha",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"control":return function(e,t,n){return u(void 0,void 0,void 0,(function(){var r,i,a,s,u,l,f,p,h,g,v,y,b,x,w,E,C,S,N,A,k,D,_,M,T,O,I,F,R,B,z,P,L,j,U;return c(this,(function(c){switch(c.label){case 0:switch(e.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[d("pred",e,t,n).clone()]];case 2:return r=d("pred",e,t,n),i=d("data",e,t,n),[4,r.data()];case 3:return[2,c.sent()[0]?[void 0,i.clone()]:[i.clone(),void 0]];case 4:return[2,(a=e.inputNames.find((function(e){return void 0!==m(e,t,n)})))?[m(a,t,n).clone()]:void 0];case 5:return s=d("frameName",e,t,n),u=d("tensor",e,t,n),n.enterFrame(s),[2,[u.clone()]];case 6:return l=d("tensor",e,t,n),n.exitFrame(),[2,[l.clone()]];case 7:return f=d("tensor",e,t,n),n.nextIteration(),[2,[f.clone()]];case 8:return p=d("size",e,t,n),h=d("dtype",e,t,n),g=d("elementShape",e,t,n),v=d("dynamicSize",e,t,n),y=d("clearAfterRead",e,t,n),b=d("identicalElementShapes",e,t,n),x=d("name",e,t,n),w=new J(x,h,p,g,b,v,y),n.addTensorArray(w),[2,[(0,o.scalar)(w.id),(0,o.scalar)(1)]];case 9:return E=d("tensorArrayId",e,t,n),C=d("index",e,t,n),S=d("tensor",e,t,n),n.getTensorArray(E).write(C,S),[2,[(0,o.scalar)(1)]];case 10:return N=d("tensorArrayId",e,t,n),A=d("index",e,t,n),[2,[n.getTensorArray(N).read(A)]];case 11:return k=d("tensorArrayId",e,t,n),D=d("indices",e,t,n),_=d("dtype",e,t,n),[2,[n.getTensorArray(k).gather(D,_)]];case 12:return M=d("tensorArrayId",e,t,n),T=d("indices",e,t,n),O=d("tensor",e,t,n),n.getTensorArray(M).scatter(T,O),[2,[(0,o.scalar)(1)]];case 13:return I=d("tensorArrayId",e,t,n),F=n.getTensorArray(I),R=d("dtype",e,t,n),[2,[F.concat(R)]];case 14:return B=d("tensorArrayId",e,t,n),z=d("tensor",e,t,n),P=d("lengths",e,t,n),n.getTensorArray(B).split(P,z),[2,[(0,o.scalar)(1)]];case 15:return L=d("tensorArrayId",e,t,n),j=n.getTensorArray(L),[2,[(0,o.scalar)(j.size(),"int32")]];case 16:return U=d("tensorArrayId",e,t,n),n.getTensorArray(U).clearAndClose(),[2,[(0,o.scalar)(0)]];case 17:throw TypeError("Node type "+e.op+" is not implemented")}}))}))}(e,t,n);case"convolution":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"Conv1D":var r=d("stride",e,t,n),i=d("pad",e,t,n),a=d("dataFormat",e,t,n).toUpperCase(),s=d("dilation",e,t,n);return[(0,o.conv1d)(d("x",e,t,n),d("filter",e,t,n),r,i,a,s)];case"Conv2D":r=d("strides",e,t,n),i=d("pad",e,t,n),a=d("dataFormat",e,t,n).toUpperCase();var u=d("dilations",e,t,n);return[(0,o.conv2d)(d("x",e,t,n),d("filter",e,t,n),[r[1],r[2]],i,a,[u[1],u[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var c=d("fusedOps",e,t,n),l=c[0],f=c[1],p="biasadd"===l,h="prelu"===f,m="fusedbatchnorm"===l,g=d("numArgs",e,t,n);if(p){if(h&&2!==g)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!h&&1!==g)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(m)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");r=d("strides",e,t,n),i=d("pad",e,t,n),a=d("dataFormat",e,t,n).toUpperCase(),u=d("dilations",e,t,n);var v=d("args",e,t,n),y=v[0],b=v[1];return[("_FusedConv2D"===e.op?o.fused.conv2d:o.fused.depthwiseConv2d)({x:d("x",e,t,n),filter:d("filter",e,t,n),strides:[r[1],r[2]],pad:i,dataFormat:a,dilations:[u[1],u[2]],bias:y,activation:f,preluActivationWeights:b})];case"Conv2DBackpropInput":case"Conv2dTranspose":var x=d("outputShape",e,t,n);return r=d("strides",e,t,n),i=d("pad",e,t,n),[(0,o.conv2dTranspose)(d("x",e,t,n),d("filter",e,t,n),x,[r[1],r[2]],i)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return r=d("strides",e,t,n),i=d("pad",e,t,n),u=d("dilations",e,t,n),a=d("dataFormat",e,t,n).toUpperCase(),[(0,o.depthwiseConv2d)(d("input",e,t,n),d("filter",e,t,n),[r[1],r[2]],i,a,[u[1],u[2]])];case"Conv3D":return r=d("strides",e,t,n),i=d("pad",e,t,n),a=d("dataFormat",e,t,n).toUpperCase(),u=d("dilations",e,t,n),[(0,o.conv3d)(d("x",e,t,n),d("filter",e,t,n),[r[1],r[2],r[3]],i,a,[u[1],u[2],u[3]])];case"AvgPool":r=d("strides",e,t,n),i=d("pad",e,t,n);var w=d("kernelSize",e,t,n);return[(0,o.avgPool)(d("x",e,t,n),[w[1],w[2]],[r[1],r[2]],i)];case"MaxPool":return r=d("strides",e,t,n),i=d("pad",e,t,n),w=d("kernelSize",e,t,n),[(0,o.maxPool)(d("x",e,t,n),[w[1],w[2]],[r[1],r[2]],i)];case"MaxPoolWithArgmax":r=d("strides",e,t,n),i=d("pad",e,t,n),w=d("kernelSize",e,t,n);var E=d("includeBatchInIndex",e,t,n),C=(0,o.maxPoolWithArgmax)(d("x",e,t,n),[w[1],w[2]],[r[1],r[2]],i,E);return[C.result,C.indexes];case"AvgPool3D":return r=d("strides",e,t,n),i=d("pad",e,t,n),w=d("kernelSize",e,t,n),[(0,o.avgPool3d)(d("x",e,t,n),[w[1],w[2],w[3]],[r[1],r[2],r[3]],i)];case"MaxPool3D":return r=d("strides",e,t,n),i=d("pad",e,t,n),w=d("kernelSize",e,t,n),[(0,o.maxPool3d)(d("x",e,t,n),[w[1],w[2],w[3]],[r[1],r[2],r[3]],i)];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"creation":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"Fill":var r=d("shape",e,t,n),i=d("dtype",e,t,n),a=d("value",e,t,n);return[(0,o.fill)(r,a,i)];case"LinSpace":var s=d("start",e,t,n),u=d("stop",e,t,n),c=d("num",e,t,n);return[(0,o.linspace)(s,u,c)];case"Multinomial":var l=d("logits",e,t,n),f=d("numSamples",e,t,n),p=d("seed",e,t,n);return[(0,o.multinomial)(l,f,p)];case"OneHot":var h=d("indices",e,t,n),m=d("depth",e,t,n),g=d("onValue",e,t,n),v=d("offValue",e,t,n);return[(0,o.oneHot)(h,m,g,v)];case"Ones":return[(0,o.ones)(d("shape",e,t,n),d("dtype",e,t,n))];case"OnesLike":return[(0,o.onesLike)(d("x",e,t,n))];case"RandomUniform":return[(0,o.randomUniform)(d("shape",e,t,n),d("minval",e,t,n),d("maxval",e,t,n),d("dtype",e,t,n))];case"Range":s=d("start",e,t,n);var y=d("stop",e,t,n),b=d("step",e,t,n);return[(0,o.range)(s,y,b,d("dtype",e,t,n))];case"TruncatedNormal":r=d("shape",e,t,n);var x=d("mean",e,t,n),w=d("stdDev",e,t,n);return p=d("seed",e,t,n),[(0,o.truncatedNormal)(r,x,w,d("dtype",e,t,n),p)];case"Zeros":return[(0,o.zeros)(d("shape",e,t,n),d("dtype",e,t,n))];case"ZerosLike":return[(0,o.zerosLike)(d("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"dynamic":return function(e,t,n){return u(void 0,void 0,void 0,(function(){var r,i,a,s,u,l,f,p;return c(this,(function(c){switch(c.label){case 0:switch(e.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return r=d("boxes",e,t,n),i=d("scores",e,t,n),a=d("maxOutputSize",e,t,n),s=d("iouThreshold",e,t,n),u=d("scoreThreshold",e,t,n),"NonMaxSuppressionV5"!==e.op?[3,3]:(l=d("softNmsSigma",e,t,n),[4,o.image.nonMaxSuppressionWithScoreAsync(r,i,a,s,u,l)]);case 2:return[2,[(p=c.sent()).selectedIndices,p.selectedScores]];case 3:return[4,o.image.nonMaxSuppressionAsync(r,i,a,s,u)];case 4:return[2,[c.sent()]];case 5:return f=d("condition",e,t,n).asType("bool"),[4,(0,o.whereAsync)(f)];case 6:return p=[c.sent()],f.dispose(),[2,p];case 7:return[2,(0,o.setdiff1dAsync)(d("x",e,t,n),d("y",e,t,n))];case 8:throw TypeError("Node type "+e.op+" is not implemented")}}))}))}(e,t,n);case"evaluation":return(0,o.tidy)((function(){return function(e,t,n){if("TopKV2"===e.op){var r=d("x",e,t,n),i=d("k",e,t,n),a=d("sorted",e,t,n),s=(0,o.topk)(r,i,a);return[s.values,s.indices]}throw TypeError("Node type "+e.op+" is not implemented")}(e,t,n)}));case"image":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"ResizeBilinear":var r=d("images",e,t,n),i=d("size",e,t,n),a=d("alignCorners",e,t,n);return[o.image.resizeBilinear(r,[i[0],i[1]],a)];case"ResizeNearestNeighbor":return r=d("images",e,t,n),i=d("size",e,t,n),a=d("alignCorners",e,t,n),[o.image.resizeNearestNeighbor(r,[i[0],i[1]],a)];case"CropAndResize":var s=d("image",e,t,n),u=d("boxes",e,t,n),c=d("boxInd",e,t,n),l=d("cropSize",e,t,n),f=d("method",e,t,n),p=d("extrapolationValue",e,t,n);return[o.image.cropAndResize(s,u,c,l,f,p)];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"graph":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=d("default",e,t,n);return[m(e.name,t,n)||r];case"Placeholder":return[m(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[d("x",e,t,n).clone()];case"IdentityN":return d("x",e,t,n).map((function(e){return e.clone()}));case"Shape":return[(0,o.tensor1d)(d("x",e,t,n).shape,"int32")];case"ShapeN":return d("x",e,t,n).map((function(e){return(0,o.tensor1d)(e.shape)}));case"Size":return[(0,o.scalar)(d("x",e,t,n).size,"int32")];case"Rank":return[(0,o.scalar)(d("x",e,t,n).rank,"int32")];case"NoOp":return[(0,o.scalar)(1)];case"Print":var i=d("x",e,t,n),a=d("data",e,t,n),s=d("message",e,t,n),u=d("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(var c=0;c<a.length;c++)console.log(Array.prototype.slice.call(a[c].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"logical":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"Equal":return[(0,o.equal)(d("a",e,t,n),d("b",e,t,n))];case"NotEqual":return[(0,o.notEqual)(d("a",e,t,n),d("b",e,t,n))];case"Greater":return[(0,o.greater)(d("a",e,t,n),d("b",e,t,n))];case"GreaterEqual":return[(0,o.greaterEqual)(d("a",e,t,n),d("b",e,t,n))];case"Less":return[(0,o.less)(d("a",e,t,n),d("b",e,t,n))];case"LessEqual":return[(0,o.lessEqual)(d("a",e,t,n),d("b",e,t,n))];case"LogicalAnd":return[(0,o.logicalAnd)(d("a",e,t,n),d("b",e,t,n))];case"LogicalNot":return[(0,o.logicalNot)(d("a",e,t,n))];case"LogicalOr":return[(0,o.logicalOr)(d("a",e,t,n),d("b",e,t,n))];case"Select":case"SelectV2":return[(0,o.where)(d("condition",e,t,n),d("a",e,t,n),d("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"matrices":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[(0,o.matMul)(d("a",e,t,n),d("b",e,t,n),d("transposeA",e,t,n),d("transposeB",e,t,n))];case"Transpose":return[(0,o.transpose)(d("x",e,t,n),d("perm",e,t,n))];case"_FusedMatMul":var r=d("fusedOps",e,t,n),i=r[0],a=r[1],s="biasadd"===i,u="prelu"===a,c=d("numArgs",e,t,n);if(s){if(u&&2!==c)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&1!==c)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var l=d("args",e,t,n),f=l[0],p=l[1];return[o.fused.matMul({a:d("a",e,t,n),b:d("b",e,t,n),transposeA:d("transposeA",e,t,n),transposeB:d("transposeB",e,t,n),bias:f,activation:a,preluActivationWeights:p})];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"normalization":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[(0,o.batchNorm)(d("x",e,t,n),d("mean",e,t,n),d("variance",e,t,n),d("offset",e,t,n),d("scale",e,t,n),d("epsilon",e,t,n))];case"LRN":return[(0,o.localResponseNormalization)(d("x",e,t,n),d("radius",e,t,n),d("bias",e,t,n),d("alpha",e,t,n),d("beta",e,t,n))];case"Softmax":return[(0,o.softmax)(d("x",e,t,n))];case"LogSoftmax":return[(0,o.logSoftmax)(d("x",e,t,n))];case"SparseToDense":return[(0,o.sparseToDense)(d("sparseIndices",e,t,n),d("outputShape",e,t,n),d("sparseValues",e,t,n),d("defaultValue",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"reduction":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"Max":var r=d("axis",e,t,n),i=d("keepDims",e,t,n);return[(0,o.max)(d("x",e,t,n),r,i)];case"Mean":return r=d("axis",e,t,n),i=d("keepDims",e,t,n),[(0,o.mean)(d("x",e,t,n),r,i)];case"Min":return r=d("axis",e,t,n),i=d("keepDims",e,t,n),[(0,o.min)(d("x",e,t,n),r,i)];case"Sum":return r=d("axis",e,t,n),i=d("keepDims",e,t,n),[(0,o.sum)(d("x",e,t,n),r,i)];case"All":return r=d("axis",e,t,n),i=d("keepDims",e,t,n),[(0,o.all)(d("x",e,t,n),r,i)];case"Any":return r=d("axis",e,t,n),i=d("keepDims",e,t,n),[(0,o.any)(d("x",e,t,n),r,i)];case"ArgMax":return r=d("axis",e,t,n),[(0,o.argMax)(d("x",e,t,n),r)];case"ArgMin":return r=d("axis",e,t,n),[(0,o.argMin)(d("x",e,t,n),r)];case"Prod":return r=d("axis",e,t,n),i=d("keepDims",e,t,n),[(0,o.prod)(d("x",e,t,n),r,i)];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"slice_join":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var r=d("n",e,t,n),i=d("axis",e,t,n),a=d("tensors",e,t,n);return a=a.slice(0,r),[(0,o.concat)(a,i)];case"GatherV2":case"Gather":i=d("axis",e,t,n);var s=d("x",e,t,n),u=d("indices",e,t,n);return[(0,o.gather)(s,u.asType("int32"),i)];case"ReverseV2":case"Reverse":return i=d("axis",e,t,n),s=d("x",e,t,n),[(0,o.reverse)(s,i)];case"Slice":var c=d("begin",e,t,n),l=d("size",e,t,n);return[(0,o.slice)(d("x",e,t,n),c,l)];case"StridedSlice":c=d("begin",e,t,n);var f=d("end",e,t,n),p=d("strides",e,t,n),h=d("beginMask",e,t,n),m=d("endMask",e,t,n),g=d("ellipsisMask",e,t,n),v=d("newAxisMask",e,t,n),y=d("shrinkAxisMask",e,t,n),b=d("x",e,t,n);if(1===c.length&&b.shape.length>1)for(var x=1;x<b.shape.length;x++)c.push(0),f.push(b.shape[x]),p.push(p[0]);return[(0,o.stridedSlice)(b,c,f,p,h,m,g,v,y)];case"Pack":return(0,o.tidy)((function(){var r=d("axis",e,t,n),i=d("tensors",e,t,n),a=i[0].shape,s=i[0].squeeze().shape,u=i.map((function(e){var t=o.util.arraysEqual(e.shape,a);if(!t&&!o.util.arraysEqual(e.squeeze().shape,s))throw new Error("the input tensors shape does not match");return t?e:e.reshape(a)}));return[(0,o.stack)(u,r)]}));case"Unpack":return(0,o.tidy)((function(){var r=d("axis",e,t,n),i=d("tensor",e,t,n);return(0,o.unstack)(i,r)}));case"Tile":var w=d("reps",e,t,n);return[(0,o.tile)(d("x",e,t,n),w)];case"Split":case"SplitV":i=d("axis",e,t,n);var E=d("numOrSizeSplits",e,t,n);return(0,o.split)(d("x",e,t,n),E,i);case"ScatterNd":u=d("indices",e,t,n);var C=d("values",e,t,n),S=d("shape",e,t,n);return[(0,o.scatterND)(u,C,S)];case"GatherNd":var N=d("x",e,t,n);return u=d("indices",e,t,n),[(0,o.gatherND)(N,u)];case"SparseToDense":u=d("sparseIndices",e,t,n),S=d("outputShape",e,t,n);var A=d("sparseValues",e,t,n),k=d("defaultValue",e,t,n);return[(0,o.sparseToDense)(u,A,S,A.dtype===k.dtype?k:k.asType(A.dtype))];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"spectral":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"FFT":return[(0,o.fft)(d("x",e,t,n))];case"IFFT":return[(0,o.ifft)(d("x",e,t,n))];case"RFFT":return[(0,o.rfft)(d("x",e,t,n))];case"IRFFT":return[(0,o.irfft)(d("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"transformation":return(0,o.tidy)((function(){return function(e,t,n){switch(e.op){case"Cast":return[(0,o.cast)(d("x",e,t,n),d("dtype",e,t,n))];case"ExpandDims":var r=d("axis",e,t,n);return[(0,o.expandDims)(d("x",e,t,n),r)];case"Squeeze":return r=d("axis",e,t,n),[(0,o.squeeze)(d("x",e,t,n),r)];case"Reshape":return[(0,o.reshape)(d("x",e,t,n),d("shape",e,t,n))];case"PadV2":case"Pad":return[(0,o.pad)(d("x",e,t,n),b(d("padding",e,t,n),2),d("constantValue",e,t,n))];case"SpaceToBatchND":var i=d("blockShape",e,t,n),a=b(d("paddings",e,t,n),2);return[(0,o.spaceToBatchND)(d("x",e,t,n),i,a)];case"BatchToSpaceND":i=d("blockShape",e,t,n);var s=b(d("crops",e,t,n),2);return[(0,o.batchToSpaceND)(d("x",e,t,n),i,s)];case"DepthToSpace":var u=d("blockSize",e,t,n),c=d("dataFormat",e,t,n).toUpperCase();return[(0,o.depthToSpace)(d("x",e,t,n),u,c)];default:throw TypeError("Node type "+e.op+" is not implemented")}}(e,t,n)}));case"custom":var r=p(e.op);if(r&&r.customExecutor)return r.customExecutor(new Y(e,t,n));throw TypeError("Custom op "+e.op+" is not registered.");default:throw TypeError("Unknown op '"+e.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,n);return r instanceof Promise?r.then((function(e){return[].concat(e)})):[].concat(r)}var Q=function(){function e(e,t){this.weightMap=e,this.tensorArrayMap=t,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return e.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(e.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),e.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},e.prototype.contextIdforContexts=function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":e.frameName+"-"+e.iterationId})).join("/"):""},e.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},e.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},e.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},e.prototype.getWeight=function(e){return this.weightMap[e]},e.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},e.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},e}();function ee(e,t,n){for(var r=new Set,i=[],a=null,o=null,s=new Set,u=Object.keys(e).map((function(e){return y(e)[0]})),c=t.slice();c.length>0;){var l=c.pop();(re(l)||ie(l))&&null==a&&(o=(a=l).children.map((function(e){return e.name})).filter((function(e){return r.has(e)}))),r.add(l.name),null==n[l.name]&&-1===u.indexOf(l.name)&&(0!==l.inputs.length?l.inputs.forEach((function(e){s.has(e.name)||(s.add(e.name),c.push(e))})):i.push(l.name))}return{inputs:e,outputs:t,usedNodes:r,missingInputs:i,dynamicNode:a,syncInputs:o}}var te=["Switch","Merge","Enter","Exit","NextIteration"],ne=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function re(e){return te.indexOf(e.op)>=0}function ie(e){return ne.indexOf(e.op)>=0}var ae=function(){function e(e){this.graph=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=e.outputs,this._inputs=e.inputs,this._signature=e.signature}return Object.defineProperty(e.prototype,"weightMap",{get:function(){return this._weightMap},set:function(e){var t=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this.weightIds=[].concat.apply([],t),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this._outputs.map((function(e){return e.signatureKey||e.name}))},enumerable:!0,configurable:!0}),e.prototype.getCompilationKey=function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)},e.prototype.compile=function(e,t){var n=ee(e,t,this.weightMap),r=n.missingInputs,i=n.dynamicNode,a=n.syncInputs;if(null!=i)throw new Error("This execution contains the node '"+i.name+"', which has the dynamic op '"+i.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+a+"]");if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs ["+o+"] from the provided inputs ["+s+"]. Missing the following inputs: ["+r+"]")}return function(e,t,n){var r=n.usedNodes,i=n.inputs,a=[];Object.keys(i).map((function(e){return y(e)[0]})).map((function(t){return e.nodes[t]})).forEach((function(e){r.has(e.name)&&a.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&a.push(e)}));for(var o=new Set,s=[];a.length>0;){var u=a.pop();o.add(u.name),t[u.name]||s.push(u),u.children.forEach((function(e){!o.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return o.has(e.name)}))&&a.push(e)}))}return s}(this.graph,this.weightMap,n)},e.prototype.execute=function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=r.map((function(e){return n.graph.nodes[y(e)[0]]})),a=t.map((function(e){return n.graph.nodes[y(e)[0]]})),u=this.getCompilationKey(i,a),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,a),this.compiledMap.set(u,c));var l={};return(0,o.tidy)((function(){var r=new Q(n._weightMap,l),i=s({},n.weightMap);Object.keys(e).forEach((function(t){var n=y(t),r=n[0],a=[];a[n[1]]=e[t],i[r]=a}));for(var a=n.getFrozenTensorIds(i),o={},u=0;u<c.length;u++){var f=c[u];if(!i[f.name]){var p=Z(f,i,r);if(p instanceof Promise)throw new Error("The execution of the op '"+f.op+"' returned a promise. Please use model.executeAsync() instead.");i[f.name]=p,n.checkTensorForDisposal(f.name,f,i,r,a,t,o)}}return t.map((function(e){return m(e,i,r)}))}))},e.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)},e.prototype.checkTensorForDisposal=function(e,t,n,r,i,a,o){"control"!==t.category&&-1===a.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var t=function(e,t,n){return t[v(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach((function(e){if(e&&!i.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}}))}})))},e.prototype.executeAsync=function(e,t){return u(this,void 0,void 0,(function(){var n,r,i,a,o,s,u=this;return c(this,(function(c){switch(c.label){case 0:return e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t),n={},r=new Q(this._weightMap,n),[4,this.executeWithControlFlow(e,r,t)];case 1:return i=c.sent(),a=t.map((function(e){return m(e,i,r)})),o=new Set(a.map((function(e){return e.id}))),s=new Set(Object.keys(e).map((function(t){return e[t].id}))),Object.keys(i).forEach((function(e){i[e].forEach((function(e){!e||e.isDisposed||o.has(e.id)||s.has(e.id)||-1!==u.weightIds.indexOf(e.id)||e.dispose()}))})),[2,a]}}))}))},e.prototype.executeWithControlFlow=function(e,t,n){return u(this,void 0,void 0,(function(){var r,i,a,o,u,l,f,p,h,d,g,v,b,x,w,E,C=this;return c(this,(function(c){switch(c.label){case 0:r=Object.keys(e),i=r.map((function(e){return C.graph.nodes[y(e)[0]]})),a=n.map((function(e){return C.graph.nodes[y(e)[0]]})),o=ee(e,a,this.weightMap),u=o.usedNodes,l=o.missingInputs,f=o.dynamicNode,p=o.syncInputs,h=i.concat(this.graph.weights).map((function(e){return{node:e,contexts:t.currentContext}})),d=s({},this.weightMap),Object.keys(e).forEach((function(t){var n=y(t),r=n[0],i=[];i[n[1]]=e[t],d[r]=i})),g={},v=this.getFrozenTensorIds(d),b={},c.label=1;case 1:return h.length>0?(x=this.processStack(i,h,t,d,b,v,n,g,u),[4,Promise.all(x)]):[3,3];case 2:return c.sent(),[3,1];case 3:if(null==f&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(w=a.filter((function(e){return!re(e)&&!m(e.name,d,t)})).map((function(e){return e.name}))).length>0)throw E="",null!=f&&(E="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+p+"]"),new Error("Cannot compute the outputs ["+w+"] from the provided inputs ["+r+"]. Consider providing the following inputs: ["+l+"]. "+E);return[2,d]}}))}))},e.prototype.processStack=function(e,t,n,r,i,a,o,s,u){for(var c=this,l=[],f=function(){var f=t.pop();n.currentContext=f.contexts;var h="";if("Enter"===f.node.op&&d("isConstant",f.node,r,n)&&(h=g(f.node.name,n)[0]),-1===e.indexOf(f.node)){var m=Z(f.node,r,n);h||(h=g(f.node.name,n)[0]);var v=n.currentContext;m instanceof Promise?l.push(m.then((function(e){return r[h]=e,n.currentContext=v,c.checkTensorForDisposal(h,f.node,r,n,a,o,s),c.processChildNodes(f.node,t,n,r,i,u),e}))):(r[h]=m,p.checkTensorForDisposal(h,f.node,r,n,a,o,s),p.processChildNodes(f.node,t,n,r,i,u))}else p.processChildNodes(f.node,t,n,r,i,u)},p=this;t.length>0;)f();return l},e.prototype.processChildNodes=function(e,t,n,r,i,a){e.children.forEach((function(e){var o=g(e.name,n)[0];!i[o]&&a.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!m(e,r,n)}))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!m(e,r,n)}))&&(i[o]=!0,t.push({contexts:n.currentContext,node:e})))}))},e.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))},e.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],i=y(n)[0],a=t.graph.nodes[i];if(a.attrParams.shape&&a.attrParams.shape.value){var s=a.attrParams.shape.value,u=s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e}));o.util.assert(u,(function(){return"The shape of dict['"+a.name+"'] provided in model.execute(dict) must be ["+s+"], but was ["+r.shape+"]"}))}a.attrParams.dtype&&a.attrParams.dtype.value&&o.util.assert(r.dtype===a.attrParams.dtype.value,(function(){return"The dtype of dict['"+a.name+"'] provided in model.execute(dict) must be "+a.attrParams.dtype.value+", but was "+r.dtype}))}))},e.prototype.mapInputs=function(e){var t={};for(var n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t},e.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter((function(e){var n=y(e)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+n+"] that are not part of graph")},e.prototype.mapOutputs=function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})},e.prototype.checkOutputs=function(e){var t=this;e.forEach((function(e){var n=y(e)[0];if(!t.graph.nodes[n])throw new Error("The output '"+e+"' is not found in the graph")}))},e}(),oe=function(){function e(e,t){void 0===t&&(t={}),this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={})}return Object.defineProperty(e.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),e.prototype.findIOHandler=function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=o.io.browserHTTPRequest(e,this.loadOptions);else{var t=o.io.getLoadHandlers(e,this.loadOptions.onProgress);if(0===t.length)t.push(o.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[e]+"'");this.handler=t[0]}},e.prototype.load=function(){return u(this,void 0,void 0,(function(){var e,t,n,r;return c(this,(function(i){switch(i.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return e=this,[4,this.handler.load()];case 1:return e.artifacts=i.sent(),t=this.artifacts.modelTopology,n={},null!=this.artifacts.userDefinedMetadata&&(n=this.artifacts.userDefinedMetadata.signature),this.version=t.versions.producer+"."+t.versions.minConsumer,r=o.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new ae(B.Instance.transformGraph(t,n)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),[2,!0]}}))}))},e.prototype.save=function(e,t){return u(this,void 0,void 0,(function(){var t;return c(this,(function(n){if("string"==typeof e){if(0===(t=o.io.getSaveHandlers(e)).length)throw new Error("Cannot find any save handlers for URL '"+e+"'");if(t.length>1)throw new Error("Found more than one ("+t.length+") save handlers for URL '"+e+"'");e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]}))}))},e.prototype.predict=function(e,t){return this.execute(e,this.outputNodes)},e.prototype.normalizeInputs=function(e){if(!(e instanceof o.Tensor||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+e.length+" input tensors.");return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})},e.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},e.prototype.execute=function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},e.prototype.executeAsync=function(e,t){return u(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 1:return[2,(n=r.sent()).length>1?n:n[0]]}}))}))},e.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})},e.prototype.dispose=function(){this.executor.dispose()},e}();function se(e,t){return void 0===t&&(t={}),u(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return null==t&&(t={}),t.fromTFHub&&null==e.load&&(e.endsWith("/")||(e+="/"),e+="model.json?tfjs-format=file"),[4,(n=new oe(e,t)).load()];case 1:return r.sent(),[2,n]}}))}))}var ue="1.7.4"},8333:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2127);t.whereImpl=function(e,t){for(var n=[],i=0;i<t.length;i++)t[i]&&n.push(i);var a=r.buffer(e,"int32"),o=r.buffer([n.length,e.length],"int32");for(i=0;i<n.length;i++){var s=a.indexToLoc(n[i]),u=i*e.length;o.values.set(s,u)}return o.toTensor()}},3926:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(2885),s=n(6151),u=n(2368),c=n(223),l=n(3327),f=n(747),p=n(9155),h=n(9155),d=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),m=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new d}return e.prototype.ready=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new u.Profiler(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;s.getKernelsForBackend(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;s.getKernelsForBackend(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[],{}),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,a,o){var u,c=this,l=[],f=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var p,h=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=s.getKernel(r,this.backendName);if(null!=g)p=function(){var e=c.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:i,backend:c.backend});var n=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return c.makeTensorFromDataId(t,n,r)}));if(f){var u=c.getTensorsForGradient(r,t,s);if(null==u){null==o&&(o=[]);var p=s.filter((function(e,t){return o[t]}));u=(a||[]).slice().concat(p)}l=c.saveTensorsForBackwardMode(u)}return s};else{var v=function(e){f&&(l=e.map((function(e){return c.keep(c.clone(e))})))};p=function(){var t=c.backend.numDataIds();m=c.tidy((function(){return e(c.backend,v)}));var n=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(r,t,(function(){return p()})):p()})),f&&this.addTapeNode(r,t,u,n,l,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:u.map((function(e){return e.shape}))}),Array.isArray(m)?u:u[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))},e.prototype.getTensorsForGradient=function(e,t,n){var r=s.getGradient(e);if(null!=r){var i=r.inputsToSave||[],a=r.outputsToSave||[],o=void 0;r.saveAllInputs?(p.assert(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),o=Object.keys(t).map((function(e){return t[e]}))):o=i.map((function(e){return t[e]}));var u=n.filter((function(e,t){return a[t]}));return o.concat(u)}return null},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=e;"string"===n&&p.isString(e[0])&&(i=e.map((function(e){return p.encodeString(e)})));var a=r.write(i,t,n),o=new l.Tensor(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=h.bytesFromStringArray(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){n=n||"float32";var i=new l.Tensor(t,n,e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new l.Variable(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*p.bytesPerElement(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof l.Variable||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i,a){var o=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=s.getGradient(e);null!=c&&(r=c.gradFunc),null!=r&&(u.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=p.makeZerosTypedArray(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i,a)}),this.state.activeTape.push(u)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=f.getTensorsInContainer(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,n,r,i){var a=this;if(void 0===i&&(i=!1),p.assert(n.length>0,(function(){return"gradients() received an empty list of xs."})),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun((function(){return a.startTape()}),(function(){return a.endTape()}),(function(){return a.tidy("forward",e)}));p.assert(o instanceof l.Tensor,(function(){return"The result y returned by f() must be a tensor."}));var s=c.getFilteredNodesXToY(this.state.activeTape,n,o);if(!i&&0===s.length&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,i,u={};u[o.id]=null==r?(e=o.shape,i=h.makeOnesTypedArray(h.sizeFromShape(e),"float32"),t.ENGINE.makeTensor(i,e,"float32")):r,c.backpropagateGradients(u,s,(function(e){return a.tidy(e)}));var l=n.map((function(e){return u[e.id]}));return 0===a.state.gradientDepth&&(a.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),a.state.activeTape=null),{value:o,grads:l}}))},e.prototype.customGrad=function(e){var t=this;return p.assert(p.isFunction(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];p.assert(r.every((function(e){return e instanceof l.Tensor})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,i){return n=e.apply(void 0,r.concat([i])),p.assert(n.value instanceof l.Tensor,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),p.assert(p.isFunction(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];p.assert(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),p.assert(a.every((function(e){return e instanceof l.Tensor})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=h.now(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=h.now()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new d,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}();t.Engine=m,t.ENGINE=function(){var e=function(){if(null==a){var e=void 0;if("undefined"!=typeof window)e=window;else if(void 0!==n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}a=e}return a}();if(null==e._tfengine){var t=new o.Environment(e);e._tfengine=new m(t)}return o.setEnvironmentGlobal(e._tfengine.ENV),l.setTensorTracker((function(){return e._tfengine})),e._tfengine}()},2885:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t=r(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,i)}))}},e}();function r(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return i(t,n[0],n[1]),n.join("=")})),t}function i(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}t.Environment=n,t.getQueryParams=r,t.env=function(){return t.ENV},t.ENV=null,t.setEnvironmentGlobal=function(e){t.ENV=e}},4368:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(2885),a=n(3327),o=n(747);function s(e){i.env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}t.enableProdMode=function(){i.env().set("PROD",!0)},t.enableDebugMode=function(){i.env().set("DEBUG",!0)},t.disableDeprecationWarnings=function(){i.env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},t.deprecationWarn=s,a.setDeprecationWarningFn(s),t.disposeVariables=function(){r.ENGINE.disposeVariables()},t.engine=function(){return r.ENGINE},t.memory=function(){return r.ENGINE.memory()},t.profile=function(e){return r.ENGINE.profile(e)},t.tidy=function(e,t){return r.ENGINE.tidy(e,t)},t.dispose=function(e){o.getTensorsInContainer(e).forEach((function(e){return e.dispose()}))},t.keep=function(e){return r.ENGINE.keep(e)},t.time=function(e){return r.ENGINE.time(e)},t.setBackend=function(e){return r.ENGINE.setBackend(e)},t.ready=function(){return r.ENGINE.ready()},t.getBackend=function(){return r.ENGINE.backendName},t.removeBackend=function(e){r.ENGINE.removeBackend(e)},t.findBackend=function(e){return r.ENGINE.findBackend(e)},t.findBackendFactory=function(e){return r.ENGINE.findBackendFactory(e)},t.registerBackend=function(e,t,n){return void 0===n&&(n=1),r.ENGINE.registerBackend(e,t,n)},t.backend=function(){return r.ENGINE.backend},t.setPlatform=function(e,t){i.env().setPlatform(e,t)}},9121:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Add="Add",t.AddN="AddN",t.Div="Div",t.FusedBatchNorm="FusedBatchNorm",t.SquaredDifference="SquaredDifference",t.Square="Square",t.Transpose="Transpose",t.NonMaxSuppressionV5="NonMaxSuppressionV5",t.BroadcastTo="BroadcastTo",t.OneHot="OneHot",t.Identity="Identity",t.Tile="Tile",t.PadV2="PadV2",t.FromPixels="FromPixels",t.MaxPoolWithArgmax="MaxPoolWithArgmax"},6151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new Map,r=new Map;function i(e,t){return t+"_"+e}t.getKernel=function(e,t){var r=i(e,t);return n.get(r)},t.getGradient=function(e){return r.get(e)},t.getKernelsForBackend=function(e){for(var t=n.entries(),r=[];;){var i=t.next(),a=i.done,o=i.value;if(a)break;var s=o[0],u=o[1];s.split("_")[0]===e&&r.push(u)}return r},t.registerKernel=function(e){var t=e.kernelName,r=e.backendName,a=i(t,r);if(n.has(a))throw new Error("The kernel '"+t+"' for backend '"+r+"' is already registered");n.set(a,e)},t.registerGradient=function(e){var t=e.kernelName;r.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),r.set(t,e)},t.unregisterKernel=function(e,t){var r=i(e,t);if(!n.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is not registered");n.delete(r)},t.unregisterGradient=function(e){if(!r.has(e))throw new Error("The gradient '"+e+"' for backend is not registered");r.delete(e)}},6407:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(9121),a=n(747),o=n(3740),s=n(2668);t.add=s.op({add_:function(e,t){var n,s=o.convertToTensor(e,"a","add"),u=o.convertToTensor(t,"b","add");n=a.makeTypesMatch(s,u),s=n[0],u=n[1];var c={a:s,b:u};return r.ENGINE.runKernelFunc((function(e,t){var n=e.add(s,u);return t([s,u]),n}),c,null,i.Add)}})},2127:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3926),o=n(3327),s=n(3740),u=n(9155),c=n(3591),l=n(8419),f=n(2668);t.buffer=function(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",u.assertNonNegativeIntegerDimensions(e),new o.TensorBuffer(e,t,n)},t.print=function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},t.batchToSpaceND=f.op({batchToSpaceND_:function(e,t,n){var r=s.convertToTensor(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return u.assert(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),u.assert(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),u.assert(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),a.ENGINE.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),t.cast=f.op({cast_:function(e,t){var n=s.convertToTensor(e,"x","cast");if(!u.isValidDtype(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return a.ENGINE.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),t.cumsum=f.op({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=s.convertToTensor(e,"x","cumsum");t|=0;var o=c.getAxesPermutation([t],i.rank),u=i;null!=o&&(u=i.transpose(o));var l=c.getInnerMostAxes(1,i.rank)[0],f=a.ENGINE.runKernelFunc((function(e){return e.cumsum(u,l,n,r)}),{permutedX:u},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=o&&(f=f.transpose(o)),f}}),t.depthToSpace=f.op({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=s.convertToTensor(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],c="NHWC"===n?r.shape[3]:r.shape[1];return u.assert(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),u.assert(o*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),u.assert(c%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+c+" for depthToSpace with input shape "+r.shape})),a.ENGINE.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),t.expandDims=f.op({expandDims_:function(e,n){void 0===n&&(n=0);var r=s.convertToTensor(e,"x","expandDims",null);u.assert(n<=r.rank,(function(){return"Axis must be <= rank of the tensor"}));var i=r.shape.slice();return n<0&&(u.assert(-(r.rank+1)<=n,(function(){return"Axis must be in the interval ["+-(r.rank+1)+", "+r.rank+"]"})),n=r.rank+n+1),i.splice(n,0,1),t.reshape(r,i)}}),t.reshape=f.op({reshape_:function(e,t){var n=s.convertToTensor(e,"x","reshape",null);t=u.inferFromImplicitShape(t,n.size),u.assert(n.size===u.sizeFromShape(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return a.ENGINE.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),t.spaceToBatchND=f.op({spaceToBatchND_:function(e,t,n){var r=s.convertToTensor(e,"x","spaceToBatchND");return u.assert(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),u.assert(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),u.assert(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),a.ENGINE.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),t.squeeze=f.op({squeeze_:function(e,n){var r=s.convertToTensor(e,"x","squeeze");return t.reshape(r,u.squeezeShape(r.shape,n).newShape)}}),t.stack=f.op({stack_:function(e,t){void 0===t&&(t=0);var n=s.convertToTensorArray(e,"tensors","stack");if(u.assert(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,a=n[0].dtype;u.assert(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){u.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){u.assert(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return l.concat(o,t)}}),t.unstack=f.op({unstack_:function(e,n){void 0===n&&(n=0),n=n||0;var r=s.convertToTensor(e,"x","unstack");u.assert(n>=-r.shape.length&&n<r.shape.length,(function(){return"Axis = "+n+" is not in [-"+r.shape.length+", "+r.shape.length+")"})),n<0&&(n+=r.shape.length);var i={axis:n};return a.ENGINE.runKernelFunc((function(e){return e.unstack(r,n)}),{x:r},(function(e){return{x:function(){return t.stack(e,n)}}}),"Unpack",i)}}),t.setdiff1dAsync=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,c,l,f,p,h,d,m;return i(this,(function(i){switch(i.label){case 0:return n=s.convertToTensor(e,"x","setdiff1d"),r=s.convertToTensor(t,"y","setdiff1d"),u.assert(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),u.assert(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),u.assert(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return a=i.sent(),[4,r.data()];case 2:for(c=i.sent(),l=new Set(c),f=0,d=0;d<a.length;d++)l.has(a[d])||f++;for(p=new o.TensorBuffer([f],n.dtype),h=new o.TensorBuffer([f],"int32"),d=0,m=0;d<a.length;d++)l.has(a[d])||(p.values[m]=a[d],h.values[m]=d,m++);return[2,[p.toTensor(),h.toTensor()]]}}))}))}},3591:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9155);function i(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function a(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}t.axesAreInnerMostDims=i,t.combineLocations=a,t.computeOutAndReduceShapes=function(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);var a=t.map((function(t){return e[t]}));return[n,a]},t.expandShapeToKeepDim=function(e,t){return a(e,t.map((function(e){return 1})),t)},t.assertAxesAreInnerMostDims=function(e,t,n){r.assert(i(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))},t.getAxesPermutation=function(e,t){if(i(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n},t.getUndoAxesPermutation=function(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))},t.getInnerMostAxes=function(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}},7399:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(3740),a=n(9155),o=n(7545),s=n(2668);function u(e,t,n,s,u,l){null==l&&(l=.001);var f,p,h=i.convertToTensor(e,"x","batchNorm"),d=i.convertToTensor(t,"mean","batchNorm"),m=i.convertToTensor(n,"variance","batchNorm");null!=u&&(f=i.convertToTensor(u,"scale","batchNorm")),null!=s&&(p=i.convertToTensor(s,"offset","batchNorm")),a.assert(d.rank===m.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),a.assert(null==p||d.rank===p.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),a.assert(null==f||d.rank===f.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var g={x:h,scale:f,offset:p,mean:d,variance:m},v={varianceEpsilon:l};return r.ENGINE.runKernelFunc((function(e,t){var n=o.xAs4D(h),r=e.batchNormalization(n,c(d),c(m),l,c(f),c(p));return t([h,d,m,f]),r}),g,null,"FusedBatchNorm",v).reshape(h.shape)}function c(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}t.batchNormalization=s.op({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),o.warnDeprecation(),u(e,t,n,a,i,r)}}),t.batchNorm=s.op({batchNorm_:u})},7545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4368);t.warnDeprecation=function(){r.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")},t.xAs4D=function(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}},7536:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(747),a=n(3740),o=n(9155),s=n(6407),u=n(2200),c=n(2668),l=n(2801),f=n(4835);t.addStrict=c.op({addStrict_:function(e,t){var n=a.convertToTensor(e,"a","addStrict"),r=a.convertToTensor(t,"b","addStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),t.atan2=c.op({atan2_:function(e,t){var n,o=a.convertToTensor(e,"a","atan2"),c=a.convertToTensor(t,"b","atan2");n=i.makeTypesMatch(o,c),o=n[0],c=n[1];var l=u.assertAndGetBroadcastShape(o.shape,c.shape);return r.ENGINE.runKernelFunc((function(e,t){var n=e.atan2(o,c);return t([o,c]),n}),{$a:o,$b:c},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=s.add(n.square(),r.square()),i=e.mul(r.div(t)),a=u.getReductionAxes(n.shape,l);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$b:function(){var t=s.add(n.square(),r.square()),i=f.neg(e.mul(n.div(t))),a=u.getReductionAxes(r.shape,l);return a.length>0&&(i=i.sum(a)),i.reshape(r.shape)}}}))}}),t.divStrict=c.op({divStrict_:function(e,t){var n=a.convertToTensor(e,"a","div"),r=a.convertToTensor(t,"b","div");return o.assertShapesMatch(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),t.floorDiv=c.op({floorDiv_:function(e,t){var n,o=a.convertToTensor(e,"a","floorDiv"),s=a.convertToTensor(t,"b","floorDiv");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape);return r.ENGINE.runKernelFunc((function(e,t){var n=e.floorDiv(o,s);return t([o,s]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=u.getReductionAxes(n.shape,c);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=u.getReductionAxes(r.shape,c);i.length>0&&(t=t.sum(i).reshape(r.shape));var a=r.square();return t.div(a.toFloat()).neg()}}}),"FloorDiv")}}),t.maximum=c.op({maximum_:function(e,t){var n,o=a.convertToTensor(e,"a","maximum"),s=a.convertToTensor(t,"b","maximum");return n=i.makeTypesMatch(o,s),o=n[0],s=n[1],"bool"===o.dtype&&(o=o.toInt(),s=s.toInt()),u.assertAndGetBroadcastShape(o.shape,s.shape),r.ENGINE.runKernelFunc((function(e,t){var n=e.maximum(o,s);return t([o,s]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),t.maximumStrict=c.op({maximumStrict_:function(e,t){var n=a.convertToTensor(e,"a","maximumStrict"),r=a.convertToTensor(t,"b","maximumStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),t.minimum=c.op({minimum_:function(e,t){var n,o=a.convertToTensor(e,"a","minimum"),s=a.convertToTensor(t,"b","minimum");return n=i.makeTypesMatch(o,s),o=n[0],s=n[1],"bool"===o.dtype&&(o=o.toInt(),s=s.toInt()),u.assertAndGetBroadcastShape(o.shape,s.shape),r.ENGINE.runKernelFunc((function(e,t){var n=e.minimum(o,s);return t([o,s]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),t.minimumStrict=c.op({minimumStrict_:function(e,t){var n=a.convertToTensor(e,"a","minimumStrict"),r=a.convertToTensor(t,"b","minimumStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),t.mod=c.op({mod_:function(e,t){var n,o=a.convertToTensor(e,"a","mod"),s=a.convertToTensor(t,"b","mod");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape);return r.ENGINE.runKernelFunc((function(e,t){var n=e.mod(o,s);return t([o,s]),n}),{$a:o,$b:s},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=u.getReductionAxes(n.shape,c);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=u.getReductionAxes(r.shape,c);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),t.modStrict=c.op({modStrict_:function(e,t){var n=a.convertToTensor(e,"a","modStrict"),r=a.convertToTensor(t,"b","modStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),t.mul=c.op({mul_:function(e,t){var n,o=a.convertToTensor(e,"a","mul"),s=a.convertToTensor(t,"b","mul");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape);return r.ENGINE.runKernelFunc((function(e,t){var n=e.multiply(o,s);return t([o,s]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=u.getReductionAxes(n.shape,c);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=u.getReductionAxes(r.shape,c);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),t.mulStrict=c.op({mulStrict_:function(e,t){var n=a.convertToTensor(e,"a","mul"),r=a.convertToTensor(t,"b","mul");return o.assertShapesMatch(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),t.pow=c.op({pow_:function(e,t){var n,o=a.convertToTensor(e,"base","pow"),s=a.convertToTensor(t,"exp","pow");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape),f=[o,s];return r.ENGINE.runKernelFunc((function(e,t){var n=e.pow(o,s);return t([o,s,n]),n}),{a:o,b:s},(function(e,t){var n=t[0],r=t[1],i=t[2];return{a:function(){var t=r.toFloat(),i=e.mul(t.mul(n.pow(t.sub(l.scalar(1))))),a=u.getReductionAxes(n.shape,c);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},b:function(){var t=n.greater(0),a=n.log().where(t,l.zerosLike(n)),o=e.mul(i.mul(a)),s=u.getReductionAxes(r.shape,c);return s.length>0&&(o=o.sum(s)),o.reshape(r.shape)}}}),"Pow",{},f,[!0])}}),t.powStrict=c.op({powStrict_:function(e,t){return o.assertShapesMatch(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),t.squaredDifferenceStrict=c.op({squaredDifferenceStrict_:function(e,t){var n=a.convertToTensor(e,"a","squaredDifferenceStrict"),r=a.convertToTensor(t,"b","squaredDifferenceStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),t.sub=c.op({sub_:function(e,t){var n,o=a.convertToTensor(e,"a","sub"),s=a.convertToTensor(t,"b","sub");n=i.makeTypesMatch(o,s),o=n[0],s=n[1];var c=u.assertAndGetBroadcastShape(o.shape,s.shape);return r.ENGINE.runKernelFunc((function(e){return e.subtract(o,s)}),{a:o,b:s},(function(e){return{a:function(){var t=e,n=u.getReductionAxes(o.shape,c);return n.length>0&&(t=t.sum(n)),t.reshape(o.shape)},b:function(){var t=e,n=u.getReductionAxes(s.shape,c);return n.length>0&&(t=t.sum(n)),t.neg().reshape(s.shape)}}}),"Sub")}}),t.subStrict=c.op({subStrict_:function(e,t){var n=a.convertToTensor(e,"a","subStrict"),r=a.convertToTensor(t,"b","subStrict");return o.assertShapesMatch(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}})},8247:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(9121),a=n(3740),o=n(2668);t.broadcastTo=o.op({broadcastTo_:function(e,t){var n=a.convertToTensor(e,"broadcastTo","x"),o=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var s=n.shape.slice();s.length<t.length;)s.unshift(1);n=n.reshape(s)}for(var u=n.shape,c=Array.from(t),l=t.length-1;l>=0;l--)if(u[l]===t[l])c[l]=1;else if(1!==n.shape[l])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+t+"].");var f=c.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===f.length)return n.clone();var p={x:n},h={shape:t,inputShape:u};return r.ENGINE.runKernelFunc((function(e){return e.tile(n,c)}),p,(function(e){return{x:function(){return e.sum(f,!0)}}}),i.BroadcastTo,h)}})},2200:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBroadcastDims=function(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r},t.getReductionAxes=function(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n},t.assertAndGetBroadcastShape=function(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}},2258:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(3740),a=n(9155),o=n(2668);t.complex=o.op({complex_:function(e,t){var n=i.convertToTensor(e,"real","complex"),o=i.convertToTensor(t,"imag","complex");return a.assertShapesMatch(n.shape,o.shape,"real and imag shapes, "+n.shape+" and "+o.shape+", must match in call to tf.complex()."),r.ENGINE.runKernelFunc((function(e){return e.complex(n,o)}),{$real:n,$imag:o})}}),t.real=o.op({real_:function(e){var t=i.convertToTensor(e,"input","real");return r.ENGINE.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),t.imag=o.op({imag_:function(e){var t=i.convertToTensor(e,"input","imag");return r.ENGINE.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}})},8419:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(3740),a=n(9155),o=n(9155),s=n(398),u=n(2668),c=n(2801);t.concat=u.op({concat_:function(e,n){void 0===n&&(n=0),a.assert(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var u=i.convertToTensorArray(e,"tensors","concat");"complex64"===u[0].dtype&&u.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),n=o.parseAxisParam(n,u[0].shape)[0];var l=s.computeOutShape(u.map((function(e){return e.shape})),n);if(0===a.sizeFromShape(l))return c.tensor([],l);if(1===(u=u.filter((function(e){return e.size>0}))).length)return u[0];var f=u.map((function(e){return e.shape}));s.assertParamsConsistent(f,n);var p=u,h={axis:n};return r.ENGINE.runKernelFunc((function(e){return e.concat(u,n)}),p,(function(e){var r=f.map((function(e){return e[n]}));return t.split(e,r,n).map((function(e){return function(){return e}}))}),"Concat",h)}}),t.concat1d=u.op({concat1d_:function(e){return t.concat(e,0)}}),t.concat2d=u.op({concat2d_:function(e,n){return t.concat(e,n)}}),t.concat3d=u.op({concat3d_:function(e,n){return t.concat(e,n)}}),t.concat4d=u.op({concat4d_:function(e,n){return t.concat(e,n)}}),t.split=u.op({split_:function(e,n,s){void 0===s&&(s=0);var u,c=i.convertToTensor(e,"x","split");return s=o.parseAxisParam(s,c.shape)[0],"number"==typeof n?(a.assert(c.shape[s]%n==0,(function(){return"Number of splits must evenly divide the axis."})),u=new Array(n).fill(c.shape[s]/n)):(a.assert(c.shape[s]===n.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),u=n),r.ENGINE.runKernelFunc((function(e){return e.split(c,u,s)}),{$x:c},(function(e){return{$x:function(){return t.concat(e,s)}}}))}})},398:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9155);t.assertParamsConsistent=function(e,t){var n=e[0].length;e.forEach((function(e,t){r.assert(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),r.assert(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var i=e[0];e.forEach((function(e,a){for(var o=0;o<n;o++)r.assert(o===t||e[o]===i[o],(function(){return"Error in concat"+n+"D: Shape of tensors["+a+"] ("+e+") does not match the shape of the rest ("+i+") along the non-concatenated axis "+a+"."}))}))},t.computeOutShape=function(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}},1274:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(9121),a=n(747),o=n(3740),s=n(7536),u=n(2668);t.div=u.op({div_:function(e,t){var n,u=o.convertToTensor(e,"a","div"),c=o.convertToTensor(t,"b","div");if(n=a.makeTypesMatch(u,c),u=n[0],c=n[1],"int32"===u.dtype&&"int32"===c.dtype)return s.floorDiv(u,c);var l={a:u,b:c};return r.ENGINE.runKernelFunc((function(e,t){var n=e.realDivide(u,c);return t([u,c]),n}),l,null,i.Div,{})}})},9322:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(747),i=n(3740),a=n(1274),o=n(9524),s=n(2668),u=n(2801);t.divNoNan=s.op({divNoNan_:function(e,t){var n,s=i.convertToTensor(e,"a","div"),c=i.convertToTensor(t,"b","div");s=(n=r.makeTypesMatch(s,c))[0],c=n[1];var l=a.div(s,c),f=u.zerosLike(l),p=c.equal(f);return o.where(p,f,l)}})},9524:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(8333),o=n(3926),s=n(3740),u=n(9155),c=n(2200),l=n(2668),f=n(2801);t.logicalAnd=l.op({logicalAnd_:function(e,t){var n=s.convertToTensor(e,"a","logicalAnd","bool"),r=s.convertToTensor(t,"b","logicalAnd","bool");return c.assertAndGetBroadcastShape(n.shape,r.shape),o.ENGINE.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),t.logicalNot=l.op({logicalNot_:function(e){var t=s.convertToTensor(e,"x","logicalNot","bool");return o.ENGINE.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),t.logicalOr=l.op({logicalOr_:function(e,t){var n=s.convertToTensor(e,"a","logicalOr","bool"),r=s.convertToTensor(t,"b","logicalOr","bool");return c.assertAndGetBroadcastShape(n.shape,r.shape),o.ENGINE.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),t.logicalXor=l.op({logicalXor_:function(e,n){var r=s.convertToTensor(e,"a","logicalXor","bool"),i=s.convertToTensor(n,"b","logicalXor","bool");return c.assertAndGetBroadcastShape(r.shape,i.shape),t.logicalOr(e,n).logicalAnd(t.logicalAnd(e,n).logicalNot())}}),t.where=l.op({where_:function(e,t,n){var r=s.convertToTensor(t,"a","where"),i=s.convertToTensor(n,"b","where"),a=s.convertToTensor(e,"condition","where","bool");return u.assertShapesMatch(r.shape,i.shape,"Error in where: "),1===a.rank?u.assert(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):u.assertShapesMatch(a.shape,i.shape,"Error in where: "),o.ENGINE.runKernelFunc((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return f.zerosLike(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),t.whereAsync=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return[4,(t=s.convertToTensor(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=a.whereImpl(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))}},6708:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(9121),a=n(3740),o=n(2668);t.oneHot=o.op({oneHot_:function(e,t,n,o){if(void 0===n&&(n=1),void 0===o&&(o=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var s=a.convertToTensor(e,"indices","oneHot","int32"),u=s.shape.concat([t]),c={indices:s=s.flatten()},l={depth:t,onValue:n,offValue:o};return r.ENGINE.runKernelFunc((function(e,r){return r([s]),e.oneHot(s,t,n,o)}),c,null,i.OneHot,l).reshape(u)}})},2668:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926);t.op=function(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],i=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.ENGINE.startScope(n);try{var a=i.apply(void 0,e);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r.ENGINE.endScope(a),a}catch(e){throw r.ENGINE.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}},9682:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(9121),a=n(3740),o=n(2668);t.pad=o.op({pad_:function(e,t,n){void 0===n&&(n=0);var o=a.convertToTensor(e,"x","pad");if(0===o.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var s={paddings:t,constantValue:n},u={x:o};return r.ENGINE.runKernelFunc((function(e,r){return r([o]),e.pad(o,t,n)}),u,null,i.PadV2,s)}})},5265:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(9121),a=n(747),o=n(3740),s=n(2200),u=n(2668),c=n(2801);t.squaredDifference=u.op({squaredDifference_:function(e,t){var n,u=o.convertToTensor(e,"a","squaredDifference"),l=o.convertToTensor(t,"b","squaredDifference");n=a.makeTypesMatch(u,l),u=n[0],l=n[1],s.assertAndGetBroadcastShape(u.shape,l.shape);var f={a:u,b:l},p=[u,l];return r.ENGINE.runKernelFunc((function(e,t){var n=e.squaredDifference(u,l);return t([u,l]),n}),f,(function(e,t){var n=t[0],r=t[1],i=c.scalar(2);return{a:function(){return e.mul(n.sub(r).mul(i))},b:function(){return e.mul(r.sub(n).mul(i))}}}),i.SquaredDifference,{},p,[])}})},2801:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(2885),a=n(3740),o=n(9155),s=n(2258),u=n(2668);function c(e,t,n,a){if(null==a&&(a=o.inferDtype(e)),"complex64"===a)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!o.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){o.assertNonNegativeIntegerDimensions(t);var s=o.sizeFromShape(t),u=o.sizeFromShape(n);o.assert(s===u,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+s+" values but has "+u}));for(var c=0;c<n.length;++c){var l=n[c],f=c!==n.length-1||l!==o.sizeFromShape(t.slice(c));o.assert(n[c]===t[c]||!f,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return o.isTypedArray(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==a?o.toTypedArray(e,a,i.env().getBool("DEBUG")):o.flatten(e,[],!0),r.ENGINE.makeTensor(e,t,a)}function l(e,t){o.assertNonNull(e);var n=a.inferShape(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return c(e,null,n,t)}function f(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=f(e,"float32"),i=f(e,"float32");return s.complex(n,i)}var a=o.makeZerosTypedArray(o.sizeFromShape(e),t);return r.ENGINE.makeTensor(a,e,t)}t.tensor=function(e,t,n){return c(e,t,a.inferShape(e,n),n)},t.scalar=function(e,t){if((o.isTypedArray(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&o.isTypedArray(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return c(e,[],[],t)},t.tensor1d=l,t.tensor2d=function(e,t,n){if(o.assertNonNull(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=a.inferShape(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return c(e,t,r,n)},t.tensor3d=function(e,t,n){if(o.assertNonNull(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=a.inferShape(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return c(e,t,r,n)},t.tensor4d=function(e,t,n){if(o.assertNonNull(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=a.inferShape(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return c(e,t,r,n)},t.tensor5d=function(e,t,n){if(o.assertNonNull(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=a.inferShape(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return c(e,t,r,n)},t.tensor6d=function(e,t,n){if(o.assertNonNull(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=a.inferShape(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return c(e,t=t||r,r,n)},t.variable=function(e,t,n,i){return void 0===t&&(t=!0),r.ENGINE.makeVariable(e,t,n,i)},t.ones=function e(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var i=e(t,"float32"),a=f(t,"float32");return s.complex(i,a)}var u=o.makeOnesTypedArray(o.sizeFromShape(t),n);return r.ENGINE.makeTensor(u,t,n)},t.zeros=f,t.fill=function(e,t,n){return r.ENGINE.runKernelFunc((function(r){return r.fill(e,t,n)}),{})},t.linspace=function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return r.ENGINE.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})},t.range=function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return f([0],r);var i=Math.abs(Math.ceil((t-e)/n)),a=o.makeZerosTypedArray(i,r);t<e&&1===n&&(n=-1),a[0]=e;for(var s=1;s<a.length;s++)a[s]=a[s-1]+n;return l(a,r)},t.onesLike=u.op({onesLike_:function(e){var n=a.convertToTensor(e,"x","onesLike");if("complex64"===n.dtype){var i=t.onesLike(s.real(n)),o=t.zerosLike(s.imag(n));return s.complex(i,o)}return r.ENGINE.runKernelFunc((function(e){return e.onesLike(n)}),{x:n},(function(e,n){return{x:function(){return t.zerosLike(e)}}}),"OnesLike")}}),t.zerosLike=u.op({zerosLike_:function(e){var n=a.convertToTensor(e,"x","zerosLike");return r.ENGINE.runKernelFunc((function(e){return e.zerosLike(n)}),{x:n},(function(e,n){return{x:function(){return t.zerosLike(e)}}}),"ZerosLike")}})},7501:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(9121),a=n(3740),o=n(9155),s=n(2668);t.tile=s.op({tile_:function(e,t){var n=a.convertToTensor(e,"x","tile",null);o.assert(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var s=[n],u={x:n},c={reps:t};return r.ENGINE.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),u,null,i.Tile,c,s)}})},9065:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(3740),a=n(9155),o=n(2668);t.transpose=o.op({transpose_:function(e,t){var n=i.convertToTensor(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),a.assert(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){a.assert(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var o={perm:t};return r.ENGINE.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},null,"Transpose",o)}})},4835:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(3740),a=n(9155),o=n(2668),s=n(2801);t.abs=o.op({abs_:function(e){var t=i.convertToTensor(e,"x","abs");return"complex64"===t.dtype?r.ENGINE.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):r.ENGINE.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),t.acos=o.op({acos_:function(e){var t=i.convertToTensor(e,"x","acos");return r.ENGINE.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(s.scalar(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),t.acosh=o.op({acosh_:function(e){var t=i.convertToTensor(e,"x","acosh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),t.asin=o.op({asin_:function(e){var t=i.convertToTensor(e,"x","asin");return r.ENGINE.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(s.scalar(1).sub(n.toFloat().square()).sqrt())}}}))}}),t.asinh=o.op({asinh_:function(e){var t=i.convertToTensor(e,"x","asinh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(s.scalar(1).add(n.toFloat().square()).sqrt())}}}))}}),t.atan=o.op({atan_:function(e){var t=i.convertToTensor(e,"x","atan");return r.ENGINE.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),t.atanh=o.op({atanh_:function(e){var t=i.convertToTensor(e,"x","atanh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(s.scalar(1).sub(n.toFloat().square()))}}}))}}),t.ceil=o.op({ceil_:function(e){var t=i.convertToTensor(e,"x","ceil");return r.ENGINE.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.clipByValue=o.op({clipByValue_:function(e,t,n){var o=i.convertToTensor(e,"x","clipByValue");a.assert(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var u=[o],c={min:t,max:n};return r.ENGINE.runKernelFunc((function(e,r){var i=e.clip(o,t,n);return r([o]),i}),{x:o},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),s.zerosLike(e))}}}),"ClipByValue",c,u)}}),t.cos=o.op({cos_:function(e){var t=i.convertToTensor(e,"x","cos"),n=[t];return r.ENGINE.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),t.cosh=o.op({cosh_:function(e){var t=i.convertToTensor(e,"x","cosh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),t.erf=o.op({erf_:function(e){var t=i.convertToTensor(e,"x","erf");return a.assert("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),r.ENGINE.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),t.exp=o.op({exp_:function(e){var t=i.convertToTensor(e,"x","exp");return r.ENGINE.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),t.expm1=o.op({expm1_:function(e){var t=i.convertToTensor(e,"x","expm1");return r.ENGINE.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),t.floor=o.op({floor_:function(e){var t=i.convertToTensor(e,"x","floor");return r.ENGINE.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.log=o.op({log_:function(e){var t=i.convertToTensor(e,"x","log"),n=[t];return r.ENGINE.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),t.log1p=o.op({log1p_:function(e){var t=i.convertToTensor(e,"x","log1p");return r.ENGINE.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),t.logSigmoid=o.op({logSigmoid_:function(e){var t=i.convertToTensor(e,"x","logSigmoid");return r.ENGINE.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),t.neg=o.op({neg_:function(e){var t=i.convertToTensor(e,"x","neg"),n=[t];return r.ENGINE.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),t.reciprocal=o.op({reciprocal_:function(e){var t=i.convertToTensor(e,"x","reciprocal");return r.ENGINE.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),t.round=o.op({round_:function(e){var t=i.convertToTensor(e,"x","round");return r.ENGINE.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.rsqrt=o.op({rsqrt_:function(e){var t=i.convertToTensor(e,"x","rsqrt"),n=[t];return r.ENGINE.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),t.sigmoid=o.op({sigmoid_:function(e){var t=i.convertToTensor(e,"x","sigmoid");return r.ENGINE.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(s.scalar(1).sub(n)))}}}),"Sigmoid")}}),t.sign=o.op({sign_:function(e){var t=i.convertToTensor(e,"x","sign");return r.ENGINE.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.isNaN=o.op({isNaN_:function(e){var t=i.convertToTensor(e,"x","isNaN");return r.ENGINE.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.isInf=o.op({isInf_:function(e){var t=i.convertToTensor(e,"x","isInf");return r.ENGINE.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.isFinite=o.op({isFinite_:function(e){var t=i.convertToTensor(e,"x","isFinite");return r.ENGINE.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.sin=o.op({sin_:function(e){var t=i.convertToTensor(e,"x","sin"),n=[t];return r.ENGINE.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),t.sinh=o.op({sinh_:function(e){var t=i.convertToTensor(e,"x","sinh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),t.softplus=o.op({softplus_:function(e){var t=i.convertToTensor(e,"x","softplus");return r.ENGINE.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),t.sqrt=o.op({sqrt_:function(e){var t=i.convertToTensor(e,"x","sqrt");return r.ENGINE.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),t.step=o.op({step_:function(e,t){void 0===t&&(t=0);var n=i.convertToTensor(e,"x","step");return r.ENGINE.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return s.zerosLike(e)}}}))}}),t.tan=o.op({tan_:function(e){var t=i.convertToTensor(e,"x","tan");return r.ENGINE.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),t.tanh=o.op({tanh_:function(e){var t=i.convertToTensor(e,"x","tanh");return r.ENGINE.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return s.scalar(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}})},2368:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9155),i=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new o)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,o=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){a(r,n.dtype,e),o.then((function(a){var o="";null!=a.getExtraProfileInfo&&(o=a.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,a.kernelMs,t,o)}))}))})),r},e}();function a(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}return!1}t.Profiler=i,t.checkComputationForErrors=a;var o=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,i,a,o){var s="number"==typeof i?r.rightPad(i+"ms",9):i.error,u=r.rightPad(e,25),c=t.rank,l=t.size,f=r.rightPad(t.shape.toString(),14),p="";for(var h in a){var d=a[h].shape||t.shape,m=d.length;p+=h+": "+m+"D "+(m>0?d:"")+" "}console.log("%c"+u+"\t%c"+s+"\t%c"+c+"D "+f+"\t%c"+l+"\t%c"+p+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();t.Logger=o},4878:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6407);n(3327).Tensor.prototype.add=function(e){return r.add(this,e)}},2077:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7399);n(3327).Tensor.prototype.batchNorm=function(e,t,n,i,a){return r.batchNorm(this,e,t,n,i,a)}},3140:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8247);n(3327).Tensor.prototype.broadcastTo=function(e){return r.broadcastTo(this,e)}},2655:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1274);n(3327).Tensor.prototype.div=function(e){return r.div(this,e)}},6583:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9322);n(3327).Tensor.prototype.divNoNan=function(e){return r.divNoNan(this,e)}},9825:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6708);n(3327).Tensor.prototype.oneHot=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),r.oneHot(this,e,t,n)}},9709:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9682);n(3327).Tensor.prototype.pad=function(e,t){return r.pad(this,e,t)}},4642:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(4878),n(3140),n(2655),n(6583),n(2184),n(8601),n(9825),n(7617),n(9709),n(2077)},2184:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5265);n(3327).Tensor.prototype.squaredDifference=function(e){return r.squaredDifference(this,e)}},8601:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7501);n(3327).Tensor.prototype.tile=function(e){return r.tile(this,e)}},7617:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9065);n(3327).Tensor.prototype.transpose=function(e){return r.transpose(this,e)}},223:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9155);t.getFilteredNodesXToY=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(d=e[a]).inputs;for(var s in o){for(var u=o[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){d.outputs.forEach((function(e){return r[e.id]=!0})),c=!0,i[d.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var p={};for(a=e.length-1;a>=0;a--)for(o=(d=e[a]).inputs,l=0;l<d.outputs.length;l++)if(f[d.outputs[l].id]){for(var s in o)f[o[s].id]=!0,p[d.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var d;if(i[(d=e[a]).id]&&p[d.id]){var m={};for(var s in d.inputs){var g=d.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},d);v.inputs=m,v.outputs=d.outputs,h.push(v)}}return h},t.backpropagateGradients=function(e,t,n){for(var i=function(i){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.kernelName+".");var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(s)+".");var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+i.dtype+"'");var o=a.inputs[t];if(!r.arraysEqual(i.shape,o.shape))throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input '"+t+"' has shape '"+i.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=u.add(i),u.dispose()}};for(var c in a.inputs)u(c)},a=t.length-1;a>=0;a--)i(a)}},3327:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2488),u=n(9155),c=n(9155),l=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=u.sizeFromShape(e),null!=n){var i=n.length;u.assert(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||u.getArrayFromDType(t,this.size),this.strides=c.computeStrides(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),u.assert(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return f().makeTensor(this.values,this.shape,this.dtype)},e}();t.TensorBuffer=l;var f=null,p=null,h=null;t.setTensorTracker=function(e){f=e},t.setOpHandler=function(e){p=e},t.setDeprecationWarningFn=function(e){h=e};var d=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=u.sizeFromShape(e),this.strides=c.computeStrides(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),u.assert(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),p.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,p.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return p.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,c.toNestedArray(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return c.toNestedArray(this.shape,this.dataSync())},e.prototype.data=function(){return a(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=f().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return u.decodeString(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=f().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return u.decodeString(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,f().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(f().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),p.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),p.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),p.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),p.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),p.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),p.clone(this)},e.prototype.toString=function(e){void 0===e&&(e=!1);var t=this.dataSync();return s.tensorToString(t,this.shape,this.dtype,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),p.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),p.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),p.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),p.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),p.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),p.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),p.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),p.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),p.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),p.unstack(this,e)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),h("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),p.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),p.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),p.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),p.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),p.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),p.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),p.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),p.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),p.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),p.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),p.cast(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),p.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),p.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),p.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),p.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),p.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),p.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),p.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),p.mulStrict(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),p.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),p.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),p.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),p.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),p.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),p.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),p.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),p.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),p.squaredDifferenceStrict(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),p.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),p.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),p.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),p.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),p.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),p.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),p.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),p.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),p.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),p.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),p.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),p.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),p.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),p.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),p.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),p.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),p.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),p.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),p.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),p.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),p.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),p.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),p.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),p.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),p.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),p.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),p.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),p.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),p.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),p.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),p.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),p.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),p.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),p.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),p.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),p.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),p.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),p.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),p.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),p.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),p.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),p.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),p.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),p.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),p.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),p.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),p.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),p.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),p.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),p.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),p.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),p.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),p.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),p.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),p.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),p.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),p.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),p.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),p.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),p.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),p.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),p.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),p.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),p.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),p.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),p.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),p.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),p.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),p.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),p.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),p.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),p.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),p.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),f().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),p.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),p.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),p.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),p.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),p.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),p.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),p.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),p.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),p.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),p.spectral.irfft(this)},e}();t.Tensor=d,Object.defineProperty(d,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var m=function(e){function t(t,n,r,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=r,a}return i(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!u.arraysEqual(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");f().disposeTensor(this),this.dataId=e.dataId,f().incRef(this,null)},t.prototype.dispose=function(){f().disposeVariable(this),this.isDisposedInternal=!0},t}(d);t.Variable=m,Object.defineProperty(m,Symbol.hasInstance,{value:function(e){return e instanceof d&&null!=e.assign&&e.assign instanceof Function}})},2488:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9155);function i(e,t,n){var i;return i=Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":r.isString(e)?"'"+e+"'":"bool"===n?a(e):parseFloat(e.toFixed(7)).toString(),r.rightPad(i,t)}function a(e){return 0===e?"false":"true"}function o(e,t,n,r,u,c){void 0===c&&(c=!0);var l="complex64"===n?2:1,f=t[0],p=t.length;if(0===p)return"complex64"===n?[i(s(e)[0],0,n)]:"bool"===n?[a(e[0])]:[e[0].toString()];if(1===p){if(f>20){var h=3*l,d=Array.from(e.slice(0,h)),m=Array.from(e.slice((f-3)*l,f*l));return"complex64"===n&&(d=s(d),m=s(m)),["["+d.map((function(e,t){return i(e,u[t],n)})).join(", ")+", ..., "+m.map((function(e,t){return i(e,u[f-3+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?s(e):Array.from(e)).map((function(e,t){return i(e,u[t],n)})).join(", ")+"]"]}var g=t.slice(1),v=r.slice(1),y=r[0]*l,b=[];if(f>20){for(var x=0;x<3;x++){var w=(E=x*y)+y;b.push.apply(b,o(e.slice(E,w),g,n,v,u,!1))}for(b.push("..."),x=f-3;x<f;x++)w=(E=x*y)+y,b.push.apply(b,o(e.slice(E,w),g,n,v,u,x===f-1))}else for(x=0;x<f;x++){var E;w=(E=x*y)+y,b.push.apply(b,o(e.slice(E,w),g,n,v,u,x===f-1))}var C=2===p?",":"";for(b[0]="["+b[0]+C,x=1;x<b.length-1;x++)b[x]=" "+b[x]+C;var S=",\n";for(x=2;x<p;x++)S+="\n";return b[b.length-1]=" "+b[b.length-1]+"]"+(c?"":S),b}function s(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}t.tensorToString=function(e,t,n,a){var u=r.computeStrides(t),c=function(e,t,n,a){var o=r.sizeFromShape(t),u=a[a.length-1],c=new Array(u).fill(0),l=t.length,f="complex64"===n?s(e):e;if(l>1)for(var p=0;p<o/u;p++)for(var h=p*u,d=0;d<u;d++)c[d]=Math.max(c[d],i(f[h+d],0,n).length);return c}(e,t,n,u),l=t.length,f=o(e,t,n,u,c),p=["Tensor"];return a&&(p.push("  dtype: "+n),p.push("  rank: "+l),p.push("  shape: ["+t+"]"),p.push("  values:")),p.push(f.map((function(e){return"    "+e})).join("\n")),p.join("\n")}},747:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3327),i=n(1221),a=n(9155);function o(e,t,n){if(null!=e)if(e instanceof r.Tensor)t.push(e);else if(i=e,Array.isArray(i)||"object"==typeof i){var i,a=e;for(var s in a){var u=a[s];n.has(u)||(n.add(u),o(u,t,n))}}}t.makeTypesMatch=function(e,t){if(e.dtype===t.dtype)return[e,t];var n=i.upcastType(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]},t.assertTypesMatch=function(e,t){a.assert(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))},t.isTensorInList=function(e,t){return t.some((function(t){return t.id===e.id}))},t.getTensorsInContainer=function(e){var t=[];return o(e,t,new Set),t}},3740:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3926),i=n(2885),a=n(3327),o=n(9155);function s(e,t){var n=e;if(o.isTypedArray(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||o.isTypedArray(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&i.env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&u(e,r,[]),r}function u(e,t,n){if(n=n||[],Array.isArray(e)||o.isTypedArray(e)){o.assert(t.length>0,(function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"})),o.assert(e.length===t[0],(function(){return"Element arr["+n.join("][")+"] should have "+t[0]+" elements, but has "+e.length+" elements"}));for(var r=t.slice(1),i=0;i<e.length;++i)u(e[i],r,n.concat(i))}else o.assert(0===t.length,(function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+t[0]+" elements"}))}function c(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function l(e,t,n,u){if(void 0===u&&(u="numeric"),e instanceof a.Tensor)return c(u,e.dtype,t,n),e;var l=o.inferDtype(e);if("string"!==l&&["bool","int32","float32"].indexOf(u)>=0&&(l=u),c(u,l,t,n),null==e||!o.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var f=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+f+"'")}var p=s(e,l);o.isTypedArray(e)||Array.isArray(e)||(e=[e]);var h="string"!==l?o.toTypedArray(e,l,i.env().getBool("DEBUG")):o.flatten(e,[],!0);return r.ENGINE.makeTensor(h,p,l)}t.inferShape=s,t.convertToTensor=l,t.convertToTensorArray=function(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return l(e,t+"["+r+"]",n)}),r)}},75:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AdadeltaOptimizer:()=>gh,AdagradOptimizer:()=>vh,AdamOptimizer:()=>yh,AdamaxOptimizer:()=>bh,Add:()=>gr,AddN:()=>vr,BroadcastTo:()=>Sr,DataStorage:()=>ia,Div:()=>yr,ENV:()=>l,Environment:()=>s,FromPixels:()=>_r,FusedBatchNorm:()=>br,Identity:()=>Ar,KernelBackend:()=>aa,MaxPoolWithArgmax:()=>Mr,MomentumOptimizer:()=>wh,NonMaxSuppressionV5:()=>Cr,OneHot:()=>Nr,Optimizer:()=>mh,PadV2:()=>Dr,RMSPropOptimizer:()=>Eh,Rank:()=>we,Reduction:()=>ef,SGDOptimizer:()=>xh,Square:()=>wr,SquaredDifference:()=>xr,Tensor:()=>xe,TensorBuffer:()=>ge,Tile:()=>kr,Transpose:()=>Er,Variable:()=>Ae,abs:()=>Rr,acos:()=>Br,acosh:()=>zr,add:()=>Tr,addN:()=>Au,addStrict:()=>mi,all:()=>bl,any:()=>xl,argMax:()=>wl,argMin:()=>El,asin:()=>Pr,asinh:()=>Lr,atan:()=>jr,atan2:()=>gi,atanh:()=>Ur,avgPool:()=>ul,avgPool3d:()=>fl,backend:()=>un,backend_util:()=>Ea,basicLSTMCell:()=>Pl,batchNorm:()=>Ou,batchNorm2d:()=>Ru,batchNorm3d:()=>Pu,batchNorm4d:()=>Uu,batchNormalization:()=>Tu,batchNormalization2d:()=>Fu,batchNormalization3d:()=>zu,batchNormalization4d:()=>ju,batchToSpaceND:()=>er,booleanMaskAsync:()=>Bc,broadcastTo:()=>qu,browser:()=>uh,buffer:()=>Zn,cast:()=>tr,ceil:()=>qr,clipByValue:()=>Wr,clone:()=>Wu,complex:()=>An,concat:()=>Hn,concat1d:()=>Gn,concat2d:()=>Kn,concat3d:()=>Xn,concat4d:()=>Yn,conv1d:()=>jc,conv2d:()=>Uc,conv2dTranspose:()=>Xc,conv3d:()=>qc,conv3dTranspose:()=>Yc,cos:()=>Vr,cosh:()=>$r,cumsum:()=>nr,customGrad:()=>Qi,deprecationWarn:()=>$t,depthToSpace:()=>rr,depthwiseConv2d:()=>$c,diag:()=>Jl,disableDeprecationWarnings:()=>Vt,dispose:()=>Jt,disposeVariables:()=>Ht,div:()=>Oi,divNoNan:()=>Yu,divStrict:()=>vi,dot:()=>Zc,dropout:()=>Zl,elu:()=>Ml,enableDebugMode:()=>Wt,enableProdMode:()=>qt,engine:()=>Gt,env:()=>c,equal:()=>xc,equalStrict:()=>wc,erf:()=>Hr,exp:()=>Gr,expandDims:()=>ir,expm1:()=>Kr,eye:()=>Zu,fft:()=>Vl,fill:()=>Un,findBackend:()=>an,findBackendFactory:()=>on,floor:()=>Xr,floorDiv:()=>yi,frame:()=>rf,fused:()=>zf,gather:()=>Fc,gatherND:()=>Yl,gather_util:()=>Fi,getBackend:()=>nn,getGradient:()=>d,getKernel:()=>h,getKernelsForBackend:()=>m,grad:()=>Ki,grads:()=>Xi,greater:()=>Ec,greaterEqual:()=>Cc,greaterEqualStrict:()=>Sc,greaterStrict:()=>Nc,hammingWindow:()=>nf,hannWindow:()=>tf,ifft:()=>$l,imag:()=>Dn,image:()=>_f,inTopKAsync:()=>sf,io:()=>ih,irfft:()=>Gl,isFinite:()=>si,isInf:()=>oi,isNaN:()=>ai,keep:()=>Zt,leakyRelu:()=>Tl,less:()=>Ac,lessEqual:()=>kc,lessEqualStrict:()=>Dc,lessStrict:()=>_c,linalg:()=>Ef,linspace:()=>qn,localResponseNormalization:()=>Bl,log:()=>Yr,log1p:()=>Jr,logSigmoid:()=>Zr,logSoftmax:()=>na,logSumExp:()=>Cl,logicalAnd:()=>Vu,logicalNot:()=>$u,logicalOr:()=>Hu,logicalXor:()=>Gu,losses:()=>vf,matMul:()=>Jc,math:()=>oh,max:()=>Sl,maxPool:()=>sl,maxPool3d:()=>ll,maxPoolWithArgmax:()=>pl,maximum:()=>bi,maximumStrict:()=>xi,mean:()=>Nl,memory:()=>Kt,min:()=>Al,minimum:()=>wi,minimumStrict:()=>Ei,mod:()=>Ci,modStrict:()=>Si,moments:()=>kl,movingAverage:()=>jl,mul:()=>Ni,mulStrict:()=>Ai,multiRNNCell:()=>Ll,multinomial:()=>Qu,neg:()=>Qr,nextFrame:()=>Ah,norm:()=>zl,notEqual:()=>Mc,notEqualStrict:()=>Tc,oneHot:()=>ec,ones:()=>Ln,onesLike:()=>Vn,op:()=>Nn,outerProduct:()=>Qc,pad:()=>tc,pad1d:()=>nc,pad2d:()=>rc,pad3d:()=>ic,pad4d:()=>ac,pool:()=>cl,pow:()=>ki,powStrict:()=>Di,prelu:()=>Ol,print:()=>Qn,prod:()=>_l,profile:()=>Xt,rand:()=>oc,randomGamma:()=>dc,randomNormal:()=>mc,randomUniform:()=>gc,range:()=>Wn,ready:()=>tn,real:()=>kn,reciprocal:()=>ei,registerBackend:()=>sn,registerGradient:()=>v,registerKernel:()=>g,relu:()=>Il,relu6:()=>Fl,removeBackend:()=>rn,reshape:()=>ar,reverse:()=>el,reverse1d:()=>tl,reverse2d:()=>nl,reverse3d:()=>rl,reverse4d:()=>il,rfft:()=>Hl,round:()=>ti,rsqrt:()=>ni,scalar:()=>Tn,scatterND:()=>Wl,scatter_util:()=>Li,selu:()=>Rl,separableConv2d:()=>Kc,serialization:()=>ph,setBackend:()=>en,setPlatform:()=>cn,setdiff1dAsync:()=>lr,sigmoid:()=>ri,sign:()=>ii,signal:()=>of,sin:()=>ui,sinh:()=>ci,slice:()=>hl,slice1d:()=>dl,slice2d:()=>ml,slice3d:()=>gl,slice4d:()=>vl,slice_util:()=>Gi,softmax:()=>ta,softplus:()=>li,spaceToBatchND:()=>or,sparseToDense:()=>Xl,spectral:()=>Kl,split:()=>Jn,sqrt:()=>fi,square:()=>vc,squaredDifference:()=>yc,squaredDifferenceStrict:()=>_i,squeeze:()=>sr,stack:()=>ur,step:()=>pi,stft:()=>af,stridedSlice:()=>Ul,sub:()=>Mi,subStrict:()=>Ti,sum:()=>Dl,sumOutType:()=>_e,tan:()=>hi,tanh:()=>di,tensor:()=>_n,tensor1d:()=>On,tensor2d:()=>In,tensor3d:()=>Fn,tensor4d:()=>Rn,tensor5d:()=>Bn,tensor6d:()=>zn,tensor_util:()=>Fe,test_util:()=>lc,tidy:()=>Yt,tile:()=>Ju,time:()=>Qt,topk:()=>ql,train:()=>Sh,transpose:()=>ra,truncatedNormal:()=>bc,unregisterGradient:()=>b,unregisterKernel:()=>y,unsortedSegmentSum:()=>Rc,unstack:()=>cr,util:()=>le,valueAndGrad:()=>Yi,valueAndGrads:()=>Ji,variable:()=>Pn,variableGrads:()=>Zi,version_core:()=>hh,webgl:()=>dh,where:()=>Ku,whereAsync:()=>Xu,zeros:()=>jn,zerosLike:()=>$n});var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function a(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var s=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return u(n,t[0],t[1]),t.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,i)}))}},e}();function u(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function c(){return l}var l=null,f=new Map,p=new Map;function h(e,t){var n=x(e,t);return f.get(n)}function d(e){return p.get(e)}function m(e){for(var t=f.entries(),n=[];;){var r=t.next(),i=r.done,a=r.value;if(i)break;var o=a[0],s=a[1];o.split("_")[0]===e&&n.push(s)}return n}function g(e){var t=e.kernelName,n=e.backendName,r=x(t,n);if(f.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");f.set(r,e)}function v(e){var t=e.kernelName;p.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),p.set(t,e)}function y(e,t){var n=x(e,t);if(!f.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is not registered");f.delete(n)}function b(e){if(!p.has(e))throw new Error("The gradient '"+e+"' for backend is not registered");p.delete(e)}function x(e,t){return t+"_"+e}function w(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function E(e,t,n){return Math.max(e,Math.min(t,n))}function C(e){return e%2==0?e:e+1}function S(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function N(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function A(e,t,n){void 0===n&&(n=""),N(M(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function k(e){N(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function D(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||V(e)&&!n)for(var r=0;r<e.length;++r)D(e[r],t,n);else t.push(e);return t}function _(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function M(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function T(e){return e%1==0}function O(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function I(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function F(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function R(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0,o=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?i():setTimeout(o,s)}};o()}))}function B(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function z(e,t){var n=t.length;return N((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),N(e.every((function(e){return T(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function P(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:z(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function L(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function j(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function U(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function q(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function W(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function V(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function $(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function H(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function G(e){return"string"==typeof e||e instanceof String}function K(e){return"boolean"==typeof e}function X(e){return"number"==typeof e}function Y(e){return Array.isArray(e)?Y(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":X(e)?"float32":G(e)?"string":K(e)?"bool":"float32"}function J(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Z(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Q(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function ee(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=D(e)),n&&U(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function te(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var a=n[0],o=0;o<a;o++)i[o]=r[t+o];else{a=n[0];var s=n.slice(1),u=s.reduce((function(e,t){return e*t}));for(o=0;o<a;o++)i[o]=e(t+o*u,s,r)}return i}(0,e,t)}function ne(e,t){for(var n=re(e,t),r=0;r<n.length;r++)n[r]=1;return n}function re(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function ie(){return c().platform.now()}function ae(e){e.forEach((function(t){N(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function oe(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",c().platform.encode(e,t)}function se(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",c().platform.decode(e,t)}function ue(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function ce(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}var le=Object.freeze({shuffle:w,clamp:E,nearestLargerEven:C,sum:S,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},assert:N,assertShapesMatch:A,assertNonNull:k,flatten:D,sizeFromShape:_,isScalarShape:function(e){return 0===e.length},arraysEqual:M,isInt:T,tanh:O,sizeToSquarishShape:I,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return w(t),t},rightPad:F,repeatedTry:R,inferFromImplicitShape:B,parseAxisParam:z,squeezeShape:P,getTypedArrayFromDType:L,getArrayFromDType:j,checkConversionForErrors:U,isValidDtype:q,hasEncodingLoss:W,isTypedArray:V,bytesPerElement:$,bytesFromStringArray:H,isString:G,isBoolean:K,isNumber:X,inferDtype:Y,isFunction:J,nearestDivisor:Z,computeStrides:Q,toTypedArray:ee,toNestedArray:te,makeOnesTypedArray:ne,makeZerosTypedArray:re,now:ie,assertNonNegativeIntegerDimensions:ae,fetch:function(e,t){return c().platform.fetch(e,t)},encodeString:oe,decodeString:se,locToIndex:ue,indexToLoc:ce}),fe=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new pe)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then((function(a){var o="";null!=a.getExtraProfileInfo&&(o=a.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,a.kernelMs,t,o)}))}))})),r},e}(),pe=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,i,a){var o="number"==typeof r?F(r+"ms",9):r.error,s=F(e,25),u=t.rank,c=t.size,l=F(t.shape.toString(),14),f="";for(var p in i){var h=i[p].shape||t.shape,d=h.length;f+=p+": "+d+"D "+(d>0?h:"")+" "}console.log("%c"+s+"\t%c"+o+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function he(e,t,n){return F(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":G(e)?"'"+e+"'":"bool"===n?de(e):parseFloat(e.toFixed(7)).toString(),t)}function de(e){return 0===e?"false":"true"}function me(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var ge=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=_(e),null!=n){var i=n.length;N(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||j(t,this.size),this.strides=Q(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),N(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return ve().makeTensor(this.values,this.shape,this.dtype)},e}(),ve=null,ye=null,be=null,xe=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=_(e),this.strides=Q(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),N(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),ye.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ye.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return ye.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,te(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return te(this.shape,this.dataSync())},e.prototype.data=function(){return a(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=ve().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return se(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=ve().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return se(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ve().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(ve().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),ye.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),ye.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),ye.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),ye.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),ye.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),ye.clone(this)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var i=Q(t),a=function(e,t,n,r){var i=_(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,u="complex64"===n?me(e):e;if(s>1)for(var c=0;c<i/a;c++)for(var l=c*a,f=0;f<a;f++)o[f]=Math.max(o[f],he(u[l+f],0,n).length);return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[he(me(t)[0],0,r)]:"bool"===r?[de(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=3*s,f=Array.from(t.slice(0,l)),p=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(f=me(f),p=me(p)),["["+f.map((function(e,t){return he(e,a[t],r)})).join(", ")+", ..., "+p.map((function(e,t){return he(e,a[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?me(t):Array.from(t)).map((function(e,t){return he(e,a[t],r)})).join(", ")+"]"]}var h=n.slice(1),d=i.slice(1),m=i[0]*s,g=[];if(u>20){for(var v=0;v<3;v++){var y=(b=v*m)+m;g.push.apply(g,e(t.slice(b,y),h,r,d,a,!1))}for(g.push("..."),v=u-3;v<u;v++)y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),h,r,d,a,v===u-1))}else for(v=0;v<u;v++){var b;y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),h,r,d,a,v===u-1))}var x=2===c?",":"";for(g[0]="["+g[0]+x,v=1;v<g.length-1;v++)g[v]=" "+g[v]+x;var w=",\n";for(v=2;v<c;v++)w+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(o?"":w),g}(e,t,n,i,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ye.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ye.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),ye.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),ye.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),ye.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),ye.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),ye.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ye.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),ye.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),ye.unstack(this,e)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),be("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ye.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ye.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),ye.cast(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),ye.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),ye.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),ye.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),ye.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),ye.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),ye.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),ye.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),ye.mulStrict(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),ye.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),ye.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),ye.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ye.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),ye.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ye.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),ye.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),ye.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ye.squaredDifferenceStrict(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),ye.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ye.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),ye.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),ye.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),ye.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),ye.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),ye.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ye.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),ye.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ye.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ye.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ye.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ye.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),ye.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),ye.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),ye.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),ye.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),ye.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),ye.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),ye.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),ye.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),ye.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),ye.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),ye.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),ye.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),ye.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),ye.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),ye.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),ye.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),ye.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),ye.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),ye.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),ye.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ye.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),ye.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),ye.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),ye.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),ye.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ye.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),ye.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),ye.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),ye.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),ye.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),ye.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),ye.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),ye.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),ye.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),ye.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),ye.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),ye.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),ye.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),ye.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),ye.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),ye.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),ye.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),ye.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),ye.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),ye.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),ye.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ye.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ye.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ye.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ye.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ye.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),ye.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),ye.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),ye.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),ye.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),ye.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ye.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ye.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),ye.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),ye.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),ve().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ye.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ye.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ye.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ye.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),ye.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ye.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),ye.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),ye.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),ye.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),ye.spectral.irfft(this)},e}();Object.defineProperty(xe,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var we,Ee,Ce,Se,Ne,Ae=function(e){function t(t,n,r,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=r,a}return i(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!M(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");ve().disposeTensor(this),this.dataId=e.dataId,ve().incRef(this,null)},t.prototype.dispose=function(){ve().disposeVariable(this),this.isDisposedInternal=!0},t}(xe);Object.defineProperty(Ae,Symbol.hasInstance,{value:function(e){return e instanceof xe&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(we||(we={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ee||(Ee={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Ce||(Ce={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Se||(Se={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ne||(Ne={}));var ke={float32:Se,int32:Ee,bool:Ce,complex64:Ne};function De(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return ke[e][t]}function _e(e){return De(e,"int32")}function Me(e,t){if(e.dtype===t.dtype)return[e,t];var n=De(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Te(e,t){N(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function Oe(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof xe)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,a=t;for(var o in a){var s=a[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var Ie,Fe=Object.freeze({makeTypesMatch:Me,assertTypesMatch:Te,isTensorInList:function(e,t){return t.some((function(t){return t.id===e.id}))},getTensorsInContainer:Oe}),Re=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Be=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Re}return e.prototype.ready=function(){return a(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return a(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new fe(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;m(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;m(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return!(i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[],{}),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,a,o){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,p=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=h(r,this.backendName);if(null!=g)f=function(){var e=u.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:i,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}));if(l){var f=u.getTensorsForGradient(r,t,s);if(null==f){null==o&&(o=[]);var p=s.filter((function(e,t){return o[t]}));f=(a||[]).slice().concat(p)}c=u.saveTensorsForBackwardMode(f)}return s};else{var v=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))};f=function(){var t=u.backend.numDataIds();m=u.tidy((function(){return e(u.backend,v)}));var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return f()})):f()})),l&&this.addTapeNode(r,t,s,n,c,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(m)?s:s[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))},e.prototype.getTensorsForGradient=function(e,t,n){var r=d(e);if(null!=r){var i=r.inputsToSave||[],a=r.outputsToSave||[],o=void 0;r.saveAllInputs?(N(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),o=Object.keys(t).map((function(e){return t[e]}))):o=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return a[t]}));return o.concat(s)}return null},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=e;"string"===n&&G(e[0])&&(i=e.map((function(e){return oe(e)})));var a=r.write(i,t,n),o=new xe(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=H(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var i=new xe(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new Ae(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*$(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Ae||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return a(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i,a){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=d(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=re(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i,a)}),this.state.activeTape.push(s)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Oe(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;if(void 0===r&&(r=!1),N(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",e)}));N(a instanceof xe,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(d=e[a]).inputs;for(var s in o){for(var u=o[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){d.outputs.forEach((function(e){return r[e.id]=!0})),c=!0,i[d.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var p={};for(a=e.length-1;a>=0;a--)for(o=(d=e[a]).inputs,l=0;l<d.outputs.length;l++)if(f[d.outputs[l].id]){for(var s in o)f[o[s].id]=!0,p[d.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var d;if(i[(d=e[a]).id]&&p[d.id]){var m={};for(var s in d.inputs){var g=d.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},d);v.inputs=m,v.outputs=d.outputs,h.push(v)}}return h}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[a.id]=null==n?(r=ne(_(e=a.shape),"float32"),ze.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var i=t[r],a=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var o=i.gradient(a),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n((function(){return o[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=i.inputs[t];if(!M(r.shape,a.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in i.inputs)s(u)},i=t.length-1;i>=0;i--)r(i)}(s,o,(function(e){return i.tidy(e)}));var u=t.map((function(e){return s[e.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),i.state.activeTape=null),{value:a,grads:u}}))},e.prototype.customGrad=function(e){var t=this;return N(J(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];N(r.every((function(e){return e instanceof xe})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,i){return N((n=e.apply(void 0,r.concat([i]))).value instanceof xe,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),N(J(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];N(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),N(a.every((function(e){return e instanceof xe})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return a(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return t=ie(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=ie()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Re,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),ze=function(){var e=function(){if(null==Ie){var e=void 0;if("undefined"!=typeof window)e=window;else if(void 0!==n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Ie=e}return Ie}();if(null==e._tfengine){var t=new s(e);e._tfengine=new Be(t)}return function(e){l=e}(e._tfengine.ENV),ve=function(){return e._tfengine},e._tfengine}();function Pe(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Le=c();Le.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Le.registerFlag("IS_BROWSER",(function(){return Pe()})),Le.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),Le.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Le.registerFlag("PROD",(function(){return!1})),Le.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Le.getBool("DEBUG")})),Le.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Le.registerFlag("IS_TEST",(function(){return!1}));var je,Ue,qe,We={},Ve={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function $e(e,t){We[e]=t}function He(e){e in We||(We[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete We[e]}),!1),1===e?t.getContext("webgl",Ve)||t.getContext("experimental-webgl",Ve):t.getContext("webgl2",Ve)}(e));var t=We[e];return t.isContextLost()?(delete We[e],He(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),We[e])}function Ge(e,t){return[t,e]}function Ke(e){var t=_(e);return I(Math.ceil(t/4))}function Xe(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Ye(e,t){var n,r,i,a,o,s,u,l,f,p=e;return 2===c().getNumber("WEBGL_VERSION")?(n=p.R32F,r=p.R16F,i=p.RGBA16F,a=p.RGBA32F,o=p.RED,s=4,u=1,l=p.HALF_FLOAT,f=p.FLOAT):(n=e.RGBA,r=e.RGBA,i=e.RGBA,a=p.RGBA,o=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null,f=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:f}}function Je(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Qe(e,t))}(e),r}function Ze(e){return!!(c().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Qe(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function et(e,t,n){return Ct(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function tt(e,t,n){var r=Ct(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Je(e,t,(function(){return e.shaderSource(r,n)})),Je(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function nt(e,t,n){var r=Ct(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Je(e,t,(function(){return e.shaderSource(r,n)})),Je(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=at.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,o=i.map((function(e,t){return F((t+1).toString(),a)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),f=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+F(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(je||(je={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Ue||(Ue={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(qe||(qe={}));var rt,it,at=/ERROR: [0-9]+:([0-9]+):/g;function ot(e,t){return Ct(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function st(e,t,n){if(Je(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function ut(e,t,n){if(Je(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function ct(e,t,n){var r=Ct(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Je(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Je(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function lt(e,t,n){var r=Ct(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Je(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),Je(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function ft(e,t){return Ct(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function pt(e,t){var n=c().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function ht(e,t){return Ct(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function dt(e,t,n,r,i,a,o,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Je(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,i)})),Je(e,t,(function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,o,s)})),Je(e,t,(function(){return e.enableVertexAttribArray(u)})),!0)}function mt(e,t,n,r){St(e,r),Je(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),Je(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function gt(e,t,n,r){return Ct(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function vt(e,t,n){return e.getUniformLocation(t,n)}function yt(e,t,n,r,i,a){Je(e,t,(function(){return mt(e,t,r,a)})),Je(e,t,(function(){return e.uniform1i(i,a)}))}function bt(e,t,n,r){Je(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),Je(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function xt(e,t,n){Je(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Je(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function wt(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Et(e,t))}function Et(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Ct(e,t,n,r){var i=Je(e,t,(function(){return n()}));if(null==i)throw new Error(r);return i}function St(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Nt(e,t){return void 0===t&&(t=2),_(e.slice(0,e.length-t))}function At(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function kt(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Nt(e)].concat(At(e))),t}function Dt(e,t){var n;void 0===t&&(t=!1);var r=c().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?C(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var i=P(e);e=i.newShape}var a=_(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=Nt(e),s=2,u=2;return e.length&&(s=(n=At(e))[0],u=n[1]),I(a=o*(s/2)*(u/2)).map((function(e){return 2*e}))}return I(a)}function _t(e){return e%2==0}function Mt(e,t){if(M(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(_t(n)&&_t(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&_t(e[0])&&_t(t[0])}function Tt(e){if(null==rt){var t=He(e);rt=t.getParameter(t.MAX_TEXTURE_SIZE)}return rt}function Ot(e){if(null==it){var t=He(e);it=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,it)}function It(e){if(0===e)return 0;var t=He(e);return Ft(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Ft(t,"EXT_disjoint_timer_query")?1:0}function Ft(e,t){return null!=e.getExtension(t)}function Rt(e){try{if(null!=He(e))return!0}catch(e){return!1}return!1}function Bt(e){if(0===e)return!1;var t=He(e);if(1===e){if(!Ft(t,"OES_texture_float"))return!1}else if(!Ft(t,"EXT_color_buffer_float"))return!1;return Pt(t)}function zt(e){if(0===e)return!1;var t=He(e);if(1!==e){if(Ft(t,"EXT_color_buffer_float"))return Pt(t);if(Ft(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=Ye(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,n)}return!1}return!!Ft(t,"OES_texture_float")&&!!Ft(t,"WEBGL_color_buffer_float")&&Pt(t)}function Pt(e){var t=Ye(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function Lt(e){return 2===e&&null!=He(e).fenceSync}var jt=Object.freeze({callAndCheck:Je,canBeRepresented:Ze,getWebGLErrorMessage:Qe,getExtensionOrThrow:et,createVertexShader:tt,createFragmentShader:nt,createProgram:ot,linkProgram:st,validateProgram:ut,createStaticVertexBuffer:ct,createStaticIndexBuffer:lt,getNumChannels:function(){return 2===c().getNumber("WEBGL_VERSION")?1:4},createTexture:ft,validateTextureSize:pt,createFramebuffer:ht,bindVertexBufferToProgramAttribute:dt,bindTextureUnit:mt,unbindTextureUnit:function(e,t,n){St(e,n),Je(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),Je(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:gt,getProgramUniformLocation:vt,bindTextureToProgramUniformSampler:yt,bindCanvasToFramebuffer:function(e,t){Je(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),Je(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),Je(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:bt,unbindColorTextureFromFramebuffer:xt,validateFramebuffer:wt,getFramebufferErrorMessage:Et,getBatchDim:Nt,getRowsCols:At,getShapeAs3D:kt,getTextureShapeFromLogicalShape:Dt,isReshapeFree:Mt,getWebGLMaxTextureSize:Tt,resetMaxTextureSize:function(){rt=null},resetMaxTexturesInShader:function(){it=null},getMaxTexturesInShader:Ot,getWebGLDisjointQueryTimerVersion:It,hasExtension:Ft,isWebGLVersionEnabled:Rt,isCapableOfRenderingToFloatTexture:Bt,isDownloadFloatTextureEnabled:zt,isWebGLFenceEnabled:Lt}),Ut=c();function qt(){c().set("PROD",!0)}function Wt(){c().set("DEBUG",!0)}function Vt(){c().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function $t(e){c().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ht(){ze.disposeVariables()}function Gt(){return ze}function Kt(){return ze.memory()}function Xt(e){return ze.profile(e)}function Yt(e,t){return ze.tidy(e,t)}function Jt(e){Oe(e).forEach((function(e){return e.dispose()}))}function Zt(e){return ze.keep(e)}function Qt(e){return ze.time(e)}function en(e){return ze.setBackend(e)}function tn(){return ze.ready()}function nn(){return ze.backendName}function rn(e){ze.removeBackend(e)}function an(e){return ze.findBackend(e)}function on(e){return ze.findBackendFactory(e)}function sn(e,t,n){return void 0===n&&(n=1),ze.registerBackend(e,t,n)}function un(){return ze.backend}function cn(e,t){c().setPlatform(e,t)}function ln(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c().getBool("IS_TEST")||console.warn.apply(console,e)}function fn(e,t){var n=e;if(V(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||V(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&c().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||V(t)){N(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),N(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),a=0;a<t.length;++a)e(t[a],i,r.concat(a))}else N(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function pn(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function hn(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof xe)return pn(r,e.dtype,t,n),e;var i=Y(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),pn(r,i,t,n),null==e||!V(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=fn(e,i);V(e)||Array.isArray(e)||(e=[e]);var s="string"!==i?ee(e,i,c().getBool("DEBUG")):D(e,[],!0);return ze.makeTensor(s,o,i)}function dn(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return hn(e,t+"["+r+"]",n)}),r)}function mn(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function gn(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function vn(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]}function yn(e,t){return gn(e,t.map((function(e){return 1})),t)}function bn(e,t,n){N(mn(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function xn(e,t){if(mn(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function wn(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function En(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Cn(e,t){var n=e[0].length;e.forEach((function(e,t){N(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),N(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,i){for(var a=0;a<n;a++)N(a===t||e[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function Sn(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Nn(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ze.startScope(n);try{var i=r.apply(void 0,e);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ze.endScope(i),i}catch(e){throw ze.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}Ut.registerFlag("HAS_WEBGL",(function(){return Ut.getNumber("WEBGL_VERSION")>0})),Ut.registerFlag("WEBGL_VERSION",(function(){return Rt(2)?2:Rt(1)?1:0})),Ut.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Ut.get("WEBGL_VERSION")})),Ut.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Ut.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Ut.registerFlag("WEBGL_PACK",(function(){return Ut.getBool("HAS_WEBGL")})),Ut.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_CLIP",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Ut.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_PACK_REDUCE",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_CONV_IM2COL",(function(){return Ut.getBool("WEBGL_PACK")})),Ut.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Tt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Ot(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Ut.getNumber("WEBGL_VERSION");return 0===e?0:It(e)})),Ut.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Ut.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),Ut.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Bt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Ut.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ut.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Ut.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return zt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Lt(Ut.getNumber("WEBGL_VERSION"))})),Ut.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Ut.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),be=$t;var An=Nn({complex_:function(e,t){var n=hn(e,"real","complex"),r=hn(t,"imag","complex");return A(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),ze.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),kn=Nn({real_:function(e){var t=hn(e,"input","real");return ze.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),Dn=Nn({imag_:function(e){var t=hn(e,"input","imag");return ze.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function _n(e,t,n){return Mn(e,t,fn(e,n),n)}function Mn(e,t,n,r){if(null==r&&(r=Y(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!V(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){ae(t);var i=_(t),a=_(n);N(i===a,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==_(t.slice(o));N(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return V(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?ee(e,r,c().getBool("DEBUG")):D(e,[],!0),ze.makeTensor(e,t,r)}function Tn(e,t){if((V(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&V(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Mn(e,[],[],t)}function On(e,t){k(e);var n=fn(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Mn(e,null,n,t)}function In(e,t,n){if(k(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=fn(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Mn(e,t,r,n)}function Fn(e,t,n){if(k(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=fn(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Mn(e,t,r,n)}function Rn(e,t,n){if(k(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=fn(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Mn(e,t,r,n)}function Bn(e,t,n){if(k(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=fn(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Mn(e,t,r,n)}function zn(e,t,n){if(k(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=fn(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Mn(e,t=t||r,r,n)}function Pn(e,t,n,r){return void 0===t&&(t=!0),ze.makeVariable(e,t,n,r)}function Ln(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Ln(e,"float32"),r=jn(e,"float32");return An(n,r)}var i=ne(_(e),t);return ze.makeTensor(i,e,t)}function jn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=jn(e,"float32"),r=jn(e,"float32");return An(n,r)}var i=re(_(e),t);return ze.makeTensor(i,e,t)}function Un(e,t,n){return ze.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function qn(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return ze.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})}function Wn(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return jn([0],r);var i=re(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return On(i,r)}var Vn=Nn({onesLike_:function(e){var t=hn(e,"x","onesLike");if("complex64"===t.dtype){var n=Vn(kn(t)),r=$n(Dn(t));return An(n,r)}return ze.runKernelFunc((function(e){return e.onesLike(t)}),{x:t},(function(e,t){return{x:function(){return $n(e)}}}),"OnesLike")}}),$n=Nn({zerosLike_:function(e){var t=hn(e,"x","zerosLike");return ze.runKernelFunc((function(e){return e.zerosLike(t)}),{x:t},(function(e,t){return{x:function(){return $n(e)}}}),"ZerosLike")}}),Hn=Nn({concat_:function(e,t){void 0===t&&(t=0),N(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=dn(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=z(t,n[0].shape)[0];var r=Sn(n.map((function(e){return e.shape})),t);if(0===_(r))return _n([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var i=n.map((function(e){return e.shape}));Cn(i,t);var a=n,o={axis:t};return ze.runKernelFunc((function(e){return e.concat(n,t)}),a,(function(e){var n=i.map((function(e){return e[t]}));return Jn(e,n,t).map((function(e){return function(){return e}}))}),"Concat",o)}}),Gn=Nn({concat1d_:function(e){return Hn(e,0)}}),Kn=Nn({concat2d_:function(e,t){return Hn(e,t)}}),Xn=Nn({concat3d_:function(e,t){return Hn(e,t)}}),Yn=Nn({concat4d_:function(e,t){return Hn(e,t)}}),Jn=Nn({split_:function(e,t,n){void 0===n&&(n=0);var r,i=hn(e,"x","split");return n=z(n,i.shape)[0],"number"==typeof t?(N(i.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(i.shape[n]/t)):(N(i.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),ze.runKernelFunc((function(e){return e.split(i,r,n)}),{$x:i},(function(e){return{$x:function(){return Hn(e,n)}}}))}});function Zn(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",ae(e),new ge(e,t,n)}function Qn(e,t){void 0===t&&(t=!1),console.log(e.toString(t))}var er=Nn({batchToSpaceND_:function(e,t,n){var r=hn(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return N(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),N(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),N(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),ze.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),tr=Nn({cast_:function(e,t){var n=hn(e,"x","cast");if(!q(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return ze.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),nr=Nn({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=hn(e,"x","cumsum"),a=xn([t|=0],i.rank),o=i;null!=a&&(o=i.transpose(a));var s=En(1,i.rank)[0],u=ze.runKernelFunc((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(u=u.transpose(a)),u}}),rr=Nn({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=hn(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return N(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),N(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),N(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape})),ze.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),ir=Nn({expandDims_:function(e,t){void 0===t&&(t=0);var n=hn(e,"x","expandDims",null);N(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(N(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),ar(n,r)}}),ar=Nn({reshape_:function(e,t){var n=hn(e,"x","reshape",null);t=B(t,n.size),N(n.size===_(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return ze.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),or=Nn({spaceToBatchND_:function(e,t,n){var r=hn(e,"x","spaceToBatchND");return N(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),N(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),N(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),ze.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),sr=Nn({squeeze_:function(e,t){var n=hn(e,"x","squeeze");return ar(n,P(n.shape,t).newShape)}}),ur=Nn({stack_:function(e,t){void 0===t&&(t=0);var n=dn(e,"tensors","stack");if(N(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,a=n[0].dtype;N(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){A(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){N(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return Hn(o,t)}}),cr=Nn({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=hn(e,"x","unstack");N(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length);var r={axis:t};return ze.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return ur(e,t)}}}),"Unpack",r)}}),lr=function(e,t){return a(this,void 0,void 0,(function(){var n,r,i,a,s,u,c,l,f,p;return o(this,(function(o){switch(o.label){case 0:return n=hn(e,"x","setdiff1d"),r=hn(t,"y","setdiff1d"),N(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),N(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),N(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=o.sent(),[4,r.data()];case 2:for(a=o.sent(),s=new Set(a),u=0,f=0;f<i.length;f++)s.has(i[f])||u++;for(c=new ge([u],n.dtype),l=new ge([u],"int32"),f=0,p=0;f<i.length;f++)s.has(i[f])||(c.values[p]=i[f],l.values[p]=f,p++);return[2,[c.toTensor(),l.toTensor()]]}}))}))};function fr(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var a=t.length,o=0;o<a;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(a+1))}return i}function pr(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var a=[],o=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?o.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function hr(e,t,n,r){void 0===r&&(r=!0);var i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?i.push(t[a-1]*e[a]):i.push(e[a]/t[a-1]):i.push(e[a]);return i}function dr(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function mr(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}var gr="Add",vr="AddN",yr="Div",br="FusedBatchNorm",xr="SquaredDifference",wr="Square",Er="Transpose",Cr="NonMaxSuppressionV5",Sr="BroadcastTo",Nr="OneHot",Ar="Identity",kr="Tile",Dr="PadV2",_r="FromPixels",Mr="MaxPoolWithArgmax",Tr=Nn({add_:function(e,t){var n,r=hn(e,"a","add"),i=hn(t,"b","add");n=Me(r,i),r=n[0],i=n[1];var a={a:r,b:i};return ze.runKernelFunc((function(e,t){var n=e.add(r,i);return t([r,i]),n}),a,null,gr)}});function Or(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r}function Ir(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function Fr(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}var Rr=Nn({abs_:function(e){var t=hn(e,"x","abs");return"complex64"===t.dtype?ze.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):ze.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),Br=Nn({acos_:function(e){var t=hn(e,"x","acos");return ze.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Tn(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),zr=Nn({acosh_:function(e){var t=hn(e,"x","acosh");return ze.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),Pr=Nn({asin_:function(e){var t=hn(e,"x","asin");return ze.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Tn(1).sub(n.toFloat().square()).sqrt())}}}))}}),Lr=Nn({asinh_:function(e){var t=hn(e,"x","asinh");return ze.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Tn(1).add(n.toFloat().square()).sqrt())}}}))}}),jr=Nn({atan_:function(e){var t=hn(e,"x","atan");return ze.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),Ur=Nn({atanh_:function(e){var t=hn(e,"x","atanh");return ze.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(Tn(1).sub(n.toFloat().square()))}}}))}}),qr=Nn({ceil_:function(e){var t=hn(e,"x","ceil");return ze.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return $n(e)}}}))}}),Wr=Nn({clipByValue_:function(e,t,n){var r=hn(e,"x","clipByValue");N(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var i=[r],a={min:t,max:n};return ze.runKernelFunc((function(e,i){var a=e.clip(r,t,n);return i([r]),a}),{x:r},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),$n(e))}}}),"ClipByValue",a,i)}}),Vr=Nn({cos_:function(e){var t=hn(e,"x","cos"),n=[t];return ze.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),$r=Nn({cosh_:function(e){var t=hn(e,"x","cosh");return ze.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),Hr=Nn({erf_:function(e){var t=hn(e,"x","erf");return N("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),ze.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),Gr=Nn({exp_:function(e){var t=hn(e,"x","exp");return ze.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),Kr=Nn({expm1_:function(e){var t=hn(e,"x","expm1");return ze.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),Xr=Nn({floor_:function(e){var t=hn(e,"x","floor");return ze.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return $n(e)}}}))}}),Yr=Nn({log_:function(e){var t=hn(e,"x","log"),n=[t];return ze.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),Jr=Nn({log1p_:function(e){var t=hn(e,"x","log1p");return ze.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),Zr=Nn({logSigmoid_:function(e){var t=hn(e,"x","logSigmoid");return ze.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),Qr=Nn({neg_:function(e){var t=hn(e,"x","neg"),n=[t];return ze.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),ei=Nn({reciprocal_:function(e){var t=hn(e,"x","reciprocal");return ze.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),ti=Nn({round_:function(e){var t=hn(e,"x","round");return ze.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return $n(e)}}}))}}),ni=Nn({rsqrt_:function(e){var t=hn(e,"x","rsqrt"),n=[t];return ze.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),ri=Nn({sigmoid_:function(e){var t=hn(e,"x","sigmoid");return ze.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(Tn(1).sub(n)))}}}),"Sigmoid")}}),ii=Nn({sign_:function(e){var t=hn(e,"x","sign");return ze.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return $n(e)}}}))}}),ai=Nn({isNaN_:function(e){var t=hn(e,"x","isNaN");return ze.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return $n(e)}}}))}}),oi=Nn({isInf_:function(e){var t=hn(e,"x","isInf");return ze.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return $n(e)}}}))}}),si=Nn({isFinite_:function(e){var t=hn(e,"x","isFinite");return ze.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return $n(e)}}}))}}),ui=Nn({sin_:function(e){var t=hn(e,"x","sin"),n=[t];return ze.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),ci=Nn({sinh_:function(e){var t=hn(e,"x","sinh");return ze.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),li=Nn({softplus_:function(e){var t=hn(e,"x","softplus");return ze.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),fi=Nn({sqrt_:function(e){var t=hn(e,"x","sqrt");return ze.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),pi=Nn({step_:function(e,t){void 0===t&&(t=0);var n=hn(e,"x","step");return ze.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return $n(e)}}}))}}),hi=Nn({tan_:function(e){var t=hn(e,"x","tan");return ze.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),di=Nn({tanh_:function(e){var t=hn(e,"x","tanh");return ze.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return Tn(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}}),mi=Nn({addStrict_:function(e,t){var n=hn(e,"a","addStrict"),r=hn(t,"b","addStrict");return A(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),gi=Nn({atan2_:function(e,t){var n,r=hn(e,"a","atan2"),i=hn(t,"b","atan2");n=Me(r,i),r=n[0],i=n[1];var a=Fr(r.shape,i.shape);return ze.runKernelFunc((function(e,t){var n=e.atan2(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Tr(n.square(),r.square()),i=e.mul(r.div(t)),o=Ir(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},$b:function(){var t=Tr(n.square(),r.square()),i=Qr(e.mul(n.div(t))),o=Ir(r.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(r.shape)}}}))}}),vi=Nn({divStrict_:function(e,t){var n=hn(e,"a","div"),r=hn(t,"b","div");return A(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),yi=Nn({floorDiv_:function(e,t){var n,r=hn(e,"a","floorDiv"),i=hn(t,"b","floorDiv");n=Me(r,i),r=n[0],i=n[1];var a=Fr(r.shape,i.shape);return ze.runKernelFunc((function(e,t){var n=e.floorDiv(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=Ir(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=Ir(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"FloorDiv")}}),bi=Nn({maximum_:function(e,t){var n,r=hn(e,"a","maximum"),i=hn(t,"b","maximum");return n=Me(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Fr(r.shape,i.shape),ze.runKernelFunc((function(e,t){var n=e.maximum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),xi=Nn({maximumStrict_:function(e,t){var n=hn(e,"a","maximumStrict"),r=hn(t,"b","maximumStrict");return A(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),wi=Nn({minimum_:function(e,t){var n,r=hn(e,"a","minimum"),i=hn(t,"b","minimum");return n=Me(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Fr(r.shape,i.shape),ze.runKernelFunc((function(e,t){var n=e.minimum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),Ei=Nn({minimumStrict_:function(e,t){var n=hn(e,"a","minimumStrict"),r=hn(t,"b","minimumStrict");return A(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Ci=Nn({mod_:function(e,t){var n,r=hn(e,"a","mod"),i=hn(t,"b","mod");n=Me(r,i),r=n[0],i=n[1];var a=Fr(r.shape,i.shape);return ze.runKernelFunc((function(e,t){var n=e.mod(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Ir(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=Ir(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),Si=Nn({modStrict_:function(e,t){var n=hn(e,"a","modStrict"),r=hn(t,"b","modStrict");return A(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Ni=Nn({mul_:function(e,t){var n,r=hn(e,"a","mul"),i=hn(t,"b","mul");n=Me(r,i),r=n[0],i=n[1];var a=Fr(r.shape,i.shape);return ze.runKernelFunc((function(e,t){var n=e.multiply(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=Ir(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=Ir(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),Ai=Nn({mulStrict_:function(e,t){var n=hn(e,"a","mul"),r=hn(t,"b","mul");return A(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),ki=Nn({pow_:function(e,t){var n,r=hn(e,"base","pow"),i=hn(t,"exp","pow");n=Me(r,i),r=n[0],i=n[1];var a=Fr(r.shape,i.shape),o=[r,i];return ze.runKernelFunc((function(e,t){var n=e.pow(r,i);return t([r,i,n]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1],i=t[2];return{a:function(){var t=r.toFloat(),i=e.mul(t.mul(n.pow(t.sub(Tn(1))))),o=Ir(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},b:function(){var t=n.greater(0),o=n.log().where(t,$n(n)),s=e.mul(i.mul(o)),u=Ir(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}),"Pow",{},o,[!0])}}),Di=Nn({powStrict_:function(e,t){return A(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),_i=Nn({squaredDifferenceStrict_:function(e,t){var n=hn(e,"a","squaredDifferenceStrict"),r=hn(t,"b","squaredDifferenceStrict");return A(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Mi=Nn({sub_:function(e,t){var n,r=hn(e,"a","sub"),i=hn(t,"b","sub");n=Me(r,i),r=n[0],i=n[1];var a=Fr(r.shape,i.shape);return ze.runKernelFunc((function(e){return e.subtract(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=Ir(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Ir(i.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(i.shape)}}}),"Sub")}}),Ti=Nn({subStrict_:function(e,t){var n=hn(e,"a","subStrict"),r=hn(t,"b","subStrict");return A(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Oi=Nn({div_:function(e,t){var n,r=hn(e,"a","div"),i=hn(t,"b","div");if(n=Me(r,i),r=n[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return yi(r,i);var a={a:r,b:i};return ze.runKernelFunc((function(e,t){var n=e.realDivide(r,i);return t([r,i]),n}),a,null,yr,{})}});function Ii(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],i=1,a=0;a<n.length-1;++a)i*=n[a];var o=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=o[a],s.push(o[a]);var c=Q(e.shape).map((function(e){return e/u})).concat([1]).slice(0,r);return[s,i,u,c]}var Fi=Object.freeze({prepareAndValidate:Ii});function Ri(e){return e<=30?e:Z(e,Math.floor(Math.sqrt(e)))}function Bi(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(a+" update.rank < "+i+". ");if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(var o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+n.shape[o+i]+") != shape["+(o+i)+"] ("+e[o+i]+")")}function zi(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Bi(n,t,e)}function Pi(e,t,n){for(var r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length,o=1,s=i;s<a;++s)o*=n[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:_(t.shape)/u,sliceSize:o,strides:Q(n.slice(0,i)).concat([1]),outputSize:_(n)}}var Li=Object.freeze({validateUpdateShape:Bi,validateInput:zi,calculateShapes:Pi});function ji(e,t,n){N(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),N(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){N(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},i=0;i<e.rank;++i)r(i)}function Ui(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function qi(e,t,n){for(var r=[],i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function Wi(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),E(0,a,s-1)}function Vi(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),o>0?E(0,a,s):E(-1,a,s-1)}function $i(e,t,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Hi(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}var Gi=Object.freeze({assertParamsValid:ji,maskToAxes:Ui,computeOutShape:qi,startForAxis:Wi,stopForAxis:Vi,isSliceContinous:$i,computeFlatOffset:Hi});function Ki(e){return N(J(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=hn(t,"x","tf.grad",null),i=null!=n?hn(n,"dy","tf.grad"):null;return ze.tidy((function(){var t=ze.gradients((function(){return e(r)}),[r],i),n=t.value,a=t.grads;return null!=i&&A(n.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),ea(a),a[0]}))}}function Xi(e){return N(J(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){N(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=dn(t,"args","tf.grads",null),i=null!=n?hn(n,"dy","tf.grads"):null;return ze.tidy((function(){var t=ze.gradients((function(){return e.apply(void 0,r)}),r,i),n=t.value,a=t.grads;return null!=i&&A(n.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ea(a),a}))}}function Yi(e){return N(J(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){N(t instanceof xe,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),N(null==n||n instanceof xe,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=ze.gradients((function(){return e(t)}),[t],n),i=r.grads,a=r.value;return ea(i),{grad:i[0],value:a}}}function Ji(e){return N(J(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){N(Array.isArray(t)&&t.every((function(e){return e instanceof xe})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),N(null==n||n instanceof xe,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=ze.gradients((function(){return e.apply(void 0,t)}),t,n);return null!=n&&A(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ea(r.grads),r}}function Zi(e,t){N(J(e),(function(){return"The f passed in variableGrads(f) must be a function"})),N(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Ae})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],ze.registeredVariables)t.push(ze.registeredVariables[r]);var i=n?t.filter((function(e){return!e.trainable})):null,a=t.length;N((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var o=ze.gradients(e,t,null,!0),s=o.value,u=o.grads;N(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),N(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=i&&i.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function Qi(e){return ze.customGrad(e)}function ea(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var ta=Nn({softmax_:function(e,t){void 0===t&&(t=-1);var n=hn(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return ze.runKernelFunc((function(e,r){var i=e.softmax(n,t);return r([i]),i}),{logits:n},(function(e,n){var r=n[0],i=e.mul(r);return{logits:function(){return i.sub(i.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),na=Nn({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=hn(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Qi((function(e,n){var r=e.max(t,!0),i=e.sub(r),a=i.toFloat().sub(i.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),ra=Nn({transpose_:function(e,t){var n=hn(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),N(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){N(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var r={perm:t};return ze.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},null,"Transpose",r)}}),ia=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),aa=function(){function e(){}return e.prototype.time=function(e){return oa("time")},e.prototype.read=function(e){return oa("read")},e.prototype.readSync=function(e){return oa("readSync")},e.prototype.numDataIds=function(){return oa("numDataIds")},e.prototype.disposeData=function(e){return oa("disposeData")},e.prototype.write=function(e,t,n){return oa("write")},e.prototype.move=function(e,t,n,r){return oa("move")},e.prototype.memory=function(){return oa("memory")},e.prototype.floatPrecision=function(){return oa("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return oa("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,oa("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return oa("slice")},e.prototype.stridedSlice=function(e,t,n,r){return oa("stridedSlice")},e.prototype.unstack=function(e,t){return oa("unstack")},e.prototype.reverse=function(e,t){return oa("reverse")},e.prototype.concat=function(e,t){return oa("concat")},e.prototype.neg=function(e){return oa("neg")},e.prototype.add=function(e,t){return oa("add")},e.prototype.addN=function(e){return oa("addN")},e.prototype.subtract=function(e,t){return oa("subtract")},e.prototype.multiply=function(e,t){return oa("multiply")},e.prototype.realDivide=function(e,t){return oa("realDivide")},e.prototype.floorDiv=function(e,t){return oa("floorDiv")},e.prototype.sum=function(e,t){return oa("sum")},e.prototype.prod=function(e,t){return oa("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return oa("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return oa("argMin")},e.prototype.argMax=function(e,t){return oa("argMax")},e.prototype.equal=function(e,t){return oa("equal")},e.prototype.notEqual=function(e,t){return oa("notEqual")},e.prototype.less=function(e,t){return oa("less")},e.prototype.lessEqual=function(e,t){return oa("lessEqual")},e.prototype.greater=function(e,t){return oa("greater")},e.prototype.greaterEqual=function(e,t){return oa("greaterEqual")},e.prototype.logicalNot=function(e){return oa("logicalNot")},e.prototype.logicalAnd=function(e,t){return oa("logicalAnd")},e.prototype.logicalOr=function(e,t){return oa("logicalOr")},e.prototype.where=function(e){return oa("where")},e.prototype.select=function(e,t,n){return oa("select")},e.prototype.topk=function(e,t,n){return oa("topk")},e.prototype.min=function(e,t){return oa("min")},e.prototype.minimum=function(e,t){return oa("minimum")},e.prototype.mod=function(e,t){return oa("mod")},e.prototype.max=function(e,t){return oa("max")},e.prototype.maximum=function(e,t){return oa("maximum")},e.prototype.all=function(e,t){return oa("all")},e.prototype.any=function(e,t){return oa("any")},e.prototype.squaredDifference=function(e,t){return oa("squaredDifference")},e.prototype.ceil=function(e){return oa("ceil")},e.prototype.floor=function(e){return oa("floor")},e.prototype.round=function(e){return oa("round")},e.prototype.sign=function(e){return oa("sign")},e.prototype.isNaN=function(e){return oa("isNaN")},e.prototype.isInf=function(e){return oa("isInf")},e.prototype.isFinite=function(e){return oa("isFinite")},e.prototype.pow=function(e,t){return oa("pow")},e.prototype.exp=function(e){return oa("exp")},e.prototype.expm1=function(e){return oa("expm1")},e.prototype.softmax=function(e,t){return oa("softmax")},e.prototype.log=function(e){return oa("log")},e.prototype.log1p=function(e){return oa("log1p")},e.prototype.sqrt=function(e){return oa("sqrt")},e.prototype.rsqrt=function(e){return oa("rsqrt")},e.prototype.square=function(e){return oa("square")},e.prototype.reciprocal=function(e){return oa("reciprocal")},e.prototype.relu=function(e){return oa("relu")},e.prototype.relu6=function(e){return oa("relu6")},e.prototype.prelu=function(e,t){return oa("prelu")},e.prototype.elu=function(e){return oa("elu")},e.prototype.eluDer=function(e,t){return oa("eluDer")},e.prototype.selu=function(e){return oa("selu")},e.prototype.int=function(e){return oa("int")},e.prototype.clip=function(e,t,n){return oa("clip")},e.prototype.abs=function(e){return oa("abs")},e.prototype.complexAbs=function(e){return oa("complexAbs")},e.prototype.sigmoid=function(e){return oa("sigmoid")},e.prototype.softplus=function(e){return oa("softplus")},e.prototype.sin=function(e){return oa("sin")},e.prototype.cos=function(e){return oa("cos")},e.prototype.tan=function(e){return oa("tan")},e.prototype.asin=function(e){return oa("asin")},e.prototype.acos=function(e){return oa("acos")},e.prototype.atan=function(e){return oa("atan")},e.prototype.atan2=function(e,t){return oa("atan2")},e.prototype.sinh=function(e){return oa("sinh")},e.prototype.cosh=function(e){return oa("cosh")},e.prototype.tanh=function(e){return oa("tanh")},e.prototype.asinh=function(e){return oa("asinh")},e.prototype.acosh=function(e){return oa("acosh")},e.prototype.atanh=function(e){return oa("atanh")},e.prototype.erf=function(e){return oa("erf")},e.prototype.step=function(e,t){return oa("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,oa("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return oa("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return oa("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return oa("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,oa("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return oa("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return oa("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return oa("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return oa("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return oa("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return oa("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return oa("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return oa("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return oa("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return oa("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return oa("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return oa("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return oa("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return oa("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return oa("reshape")},e.prototype.cast=function(e,t){return oa("cast")},e.prototype.tile=function(e,t){return oa("tile")},e.prototype.pad=function(e,t,n){return oa("pad")},e.prototype.transpose=function(e,t){return oa("transpose")},e.prototype.gather=function(e,t,n){return oa("gather")},e.prototype.gatherND=function(e,t){return oa("gatherND")},e.prototype.scatterND=function(e,t,n){return oa("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return oa("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return oa("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return oa("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return oa("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return oa("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return oa("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,i,a){return oa("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){return oa("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){return oa("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return oa("multinomial")},e.prototype.oneHot=function(e,t,n,r){return oa("oneHot")},e.prototype.cumsum=function(e,t,n,r){return oa("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return oa("nonMaxSuppression")},e.prototype.fft=function(e){return oa("fft")},e.prototype.ifft=function(e){return oa("ifft")},e.prototype.complex=function(e,t){return oa("complex")},e.prototype.real=function(e){return oa("real")},e.prototype.imag=function(e){return oa("imag")},e.prototype.cropAndResize=function(e,t,n,r,i,a){return oa("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return oa("depthToSpace")},e.prototype.split=function(e,t,n){return oa("split")},e.prototype.sparseToDense=function(e,t,n,r){return oa("sparseToDense")},e.prototype.diag=function(e){return oa("diag")},e.prototype.fill=function(e,t,n){return oa("fill")},e.prototype.onesLike=function(e){return oa("onesLike")},e.prototype.zerosLike=function(e){return oa("zerosLike")},e.prototype.linspace=function(e,t,n){return oa("linspace")},e.prototype.dispose=function(){return oa("dispose")},e}();function oa(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function sa(e,t,n,r,i,a,o){void 0===o&&(o="channelsLast");var s,u=pa(t),c=u[0],l=u[1];if("channelsLast"===o)s=[c,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[c,l,e[1],e[1]]}return ca(e,s,n,r,i,a,!1,o)}function ua(e,t,n,r,i,a,o){void 0===o&&(o="NDHWC");var s,u,c=ha(t),l=c[0],f=c[1],p=c[2];if("NDHWC"===o)u="channelsLast",s=[l,f,p,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);u="channelsFirst",s=[l,f,p,e[1],e[1]]}return la(e,s,n,r,i,!1,u,a)}function ca(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],p=u[3];if("channelsLast"===s)c=e[0],l=e[1],f=e[2],p=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],p=e[1],l=e[2],f=e[3]}var h,d=t[0],m=t[1],g=t[3],v=pa(n),y=v[0],b=v[1],x=pa(r),w=x[0],E=x[1],C=da(d,w),S=da(m,E),A=function(e,t,n,r,i,a,o,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,i){null==r&&(r=fa(e,t,n));var a=e[1],o=ma((e[0]-t+2*r)/n+1,i);N(T(o),(function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"}));var s=ma((a-t+2*r)/n+1,i);return N(T(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[o,s]}([t,n],a,r,e,s);c=f[0],l=f[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/i);var p=Math.max(0,(c-1)*r+a-t),h=Math.max(0,(l-1)*i+o-n),d=Math.floor(p/2),m=p-d,g=Math.floor(h/2);u={top:d,bottom:m,left:g,right:h-g,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-a+1)/r),l=Math.ceil((n-o+1)/i)}return{padInfo:u,outHeight:c,outWidth:l}}(i,l,f,y,b,C,S,a),k=A.padInfo,D=A.outHeight,_=A.outWidth,M=o?g*p:g;return"channelsFirst"===s?h=[c,M,D,_]:"channelsLast"===s&&(h=[c,D,_,M]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:p,outHeight:D,outWidth:_,outChannels:M,padInfo:k,strideHeight:y,strideWidth:b,filterHeight:d,filterWidth:m,effectiveFilterHeight:C,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:E,inShape:e,outShape:h,filterShape:t}}function la(e,t,n,r,i,a,o,s){void 0===a&&(a=!1),void 0===o&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],p=u[3],h=u[4];if("channelsLast"===o)c=e[0],l=e[1],f=e[2],p=e[3],h=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);c=e[0],h=e[1],l=e[2],f=e[3],p=e[4]}var d,m=t[0],g=t[1],v=t[2],y=t[4],b=ha(n),x=b[0],w=b[1],E=b[2],C=ha(r),S=C[0],A=C[1],k=C[2],D=da(m,S),_=da(g,A),M=da(v,k),O=function(e,t,n,r,i,a,o,s,u,c,l){var f,p,h,d;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,i,a){null==i&&(i=fa(e,t,r));var o=e[1],s=e[2],u=ma((e[0]-t+2*i)/r+1,a);N(T(u),(function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var c=ma((o-t+2*i)/r+1,a);N(T(c),(function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=ma((s-t+2*i)/r+1,a);return N(T(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[u,c,l,1]}([t,n,r,1],s,0,i,e,l);p=m[0],h=m[1],d=m[2]}else if("same"===e){var g=((p=Math.ceil(t/i))-1)*i+s-t,v=((h=Math.ceil(n/a))-1)*a+u-n,y=((d=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(g/2),x=g-b,w=Math.floor(v/2),E=v-w,C=Math.floor(y/2);f={top:w,bottom:E,left:C,right:y-C,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-s+1)/i),h=Math.ceil((n-u+1)/a),d=Math.ceil((r-c+1)/o)}return{padInfo:f,outDepth:p,outHeight:h,outWidth:d}}(i,l,f,p,x,w,E,D,_,M,s),I=O.padInfo,F=O.outDepth,R=O.outHeight,B=O.outWidth,z=a?y*h:y;return"channelsFirst"===o?d=[c,z,F,R,B]:"channelsLast"===o&&(d=[c,F,R,B,z]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:f,inWidth:p,inChannels:h,outDepth:F,outHeight:R,outWidth:B,outChannels:z,padInfo:I,strideDepth:x,strideHeight:w,strideWidth:E,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:D,effectiveFilterHeight:_,effectiveFilterWidth:M,dilationDepth:S,dilationHeight:A,dilationWidth:k,inShape:e,outShape:d,filterShape:t}}function fa(e,t,n,r){void 0===r&&(r=1);var i=da(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function pa(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function ha(e){return"number"==typeof e?[e,e,e]:e}function da(e,t){return t<=1?e:e+(e-1)*(t-1)}function ma(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function ga(e){var t=pa(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function va(e,t){return ga(e)||ga(t)}function ya(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function ba(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=jn(e.shape),i=e.toFloat(),a=n.complex(i,r);return r.dispose(),i.dispose(),a}if(!W(e.dtype,t))return ze.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return a=o.cast(t),o.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=Tn(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function xa(e,t){return ze.makeTensorFromDataId(e.dataId,t,e.dtype)}function wa(e,t,n){var r=(t-e)/(n-1),i=re(n,"float32");i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return On(i,"float32")}var Ea=Object.freeze({castTensor:ba,reshapeTensor:xa,linspaceImpl:wa,upcastType:De,axesAreInnerMostDims:mn,combineLocations:gn,computeOutAndReduceShapes:vn,expandShapeToKeepDim:yn,assertAxesAreInnerMostDims:bn,getAxesPermutation:xn,getUndoAxesPermutation:wn,getInnerMostAxes:En,getBroadcastDims:Or,getReductionAxes:Ir,assertAndGetBroadcastShape:Fr,assertParamsConsistent:Cn,computeOutShape:Sn,computePool2DInfo:sa,computePool3DInfo:ua,computeConv2DInfo:ca,computeConv3DInfo:la,computeDefaultPad:fa,tupleValuesAreOne:ga,eitherStridesOrDilationsAreOne:va,convertConv2DDataFormat:ya,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Ri});function Ca(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Sa(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Na(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Aa(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function ka(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,i=e.length,a=0,o=!1;r<i;){var s=n(t,e[a=r+(i-r>>>1)]);s>0?r=a+1:(i=a,o=!s)}return o?r:-r-1}(e,t,n||Da)}(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function Da(e,t){return e>t?1:e<t?-1:0}function _a(e,t,n,r,i){return Ta(e,t,n,r,i,0).selectedIndices}function Ma(e,t,n,r,i,a){var o=Ta(e,t,n,r,i,a,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function Ta(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>i})).sort(Fa),c=a>0?-.5/a:0,l=[],f=[];l.length<n&&u.length>0;){var p=u.pop(),h=p.score,d=p.boxIndex,m=p.suppressBeginIndex;if(h<i)break;for(var g=!1,v=l.length-1;v>=m;--v){var y=Oa(e,d,l[v]);if(y>=r){g=!0;break}if(p.score=p.score*Ia(r,c,y),p.score<=i)break}p.suppressBeginIndex=l.length,g||(p.score===h?(l.push(d),f.push(p.score)):p.score>i&&ka(u,p,Fa))}var b=l.length;return s&&(l.fill(0,b),f.fill(0,b)),{selectedIndices:On(l,"int32"),selectedScores:On(f,"float32"),numValidOutputs:Tn(b,"int32")}}function Oa(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),p=Math.max(i[1],i[3]),h=(s-a)*(u-o),d=(f-c)*(p-l);if(h<=0||d<=0)return 0;var m=Math.max(a,c),g=Math.max(o,l),v=Math.min(s,f),y=Math.min(u,p),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(h+d-b)}function Ia(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Fa(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Ra(e,t,n){var r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var a=e.slice(r,i);return r[n]+=t,a}))}function Ba(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=Zn(n,e.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=a[s]%e.shape[s];var u=e.locToIndex(o);i.values[r]=e.values[u]}return i.toTensor()}function za(e,t,n,r,i){for(var a=t[t.length-1],o=[e.length/a,a],s=o[0],u=o[1],c=L(n,s*r),l=L("int32",s*r),f=0;f<s;f++){for(var p=f*u,h=e.subarray(p,p+u),d=[],m=0;m<h.length;m++)d.push({value:h[m],index:m});d.sort((function(e,t){return t.value-e.value}));var g=f*r,v=c.subarray(g,g+r),y=l.subarray(g,g+r);for(m=0;m<r;m++)v[m]=d[m].value,y[m]=d[m].index}var b=t.slice();return b[b.length-1]=r,[_n(c,b,n),_n(l,b,"int32")]}function Pa(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=Zn(e,"int32"),a=Zn([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=i.indexToLoc(n[r]),s=r*e.length;a.values.set(o,s)}return a.toTensor()}var La=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},ja=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Ua=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,a=e.inSize,o=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function qa(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function Wa(e,t){return 1===t?[e]:qa(e,t)}function Va(){var e,t,n,r,i,a,o,s,u,l;return 2===c().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function $a(e,t,n){void 0===n&&(n="index");var r=Q(t);return r.map((function(t,i){return"int "+e[i]+" = "+n+" / "+t+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+t:"index -= "+e[i]+" * "+t)+";"})).join("")}function Ha(e){var t=Q(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Ga="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Ka(e,t,n,r){var i=[];e.forEach((function(e){var t=_(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+e.name+";"),i.push("uniform int offset"+e.name+";"))}));var a,o,s=i.join("\n"),u=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?Ya(e):Xa(e);var i=e.shapeInfo.logicalShape,a=t.logicalShape;return i.length<=a.length&&(r+=n?function(e,t){var n,r,i=e.name,a=i.charAt(0).toUpperCase()+i.slice(1),o="get"+a+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=Or(e.shapeInfo.logicalShape,t.logicalShape),l=ro(u),f=u-s,p=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+p[e+f]+" = 0;"})).join("\n"),r=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+p[t+f]})).join(", ");var h="return outputValue;",d=1===_(e.shapeInfo.logicalShape),m=1===_(t.logicalShape);if(1!==s||d||m){if(d&&!m)h=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=s-2,v=s-1;c.indexOf(g)>-1&&c.indexOf(v)>-1?h="return vec4(outputValue.x);":c.indexOf(g)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(v)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+r+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&M(o,a))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c,l,f=ro(u),p=Or(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,d=["x","y","z","w","u","v"];return c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords."+d[e+h]+" = 0;"})).join("\n"),l=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+h]})).join(", "),"\n    float "+i+"() {\n      "+f+" coords = getOutputCoords();\n      "+c+"\n      return get"+r+"("+l+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),c=t.texShape,l=Va(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),p=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Ja+"\n    "+Za+"\n    "+Qa+"\n  "}(l);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(M(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2),a=i,o="",s="b, r, c",u=2;u<e.length-1;u++)o="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+o,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,i,a,o}(t.logicalShape,c),o=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return M(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=$a(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=$a(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=$a(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=$a(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,c),o=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(p+=eo),[p,f,o,s,a,u,n].join("\n")}function Xa(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===i&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+to(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+no(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=to(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+a+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape;if(null!=i&&M(t,i)){var a=i[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var o=P(t),s=o.newShape,u=o.keptDims,c=s;if(c.length<t.length)return"\n      "+Xa(io(e,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+ao(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+no(e)+"\n      }\n    ";var l=i[0],f=i[1],p=to(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+l+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],a=t[2],o=P(t),s=o.newShape,u=o.keptDims,c=s;if(c.length<t.length)return"\n        "+Xa(io(e,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+ao(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1)));\n        "+no(e)+"\n      }\n    ";var l=e.shapeInfo.texShape,f=l[0],p=l[1],h=e.shapeInfo.flatOffset;return p===i&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":p===a&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+a+" + depth + "+to(n)+";\n        vec2 uv = uvFromFlat("+f+", "+p+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],a=t[2]*i,o=t[1]*a,s=P(t),u=s.newShape,c=s.keptDims;if(u.length<t.length)return"\n      "+Xa(io(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+ao(["row","col","depth","depth2"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+o+", "+a+", "+i+", 1)));\n        "+no(e)+"\n      }\n    ";var l=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,p=f[0],h=f[1];return h===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===i&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+o+" + col * "+a+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+h+", index + "+to(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],a=t[3]*i,o=t[2]*a,s=t[1]*o,u=P(t),c=u.newShape,l=u.keptDims;if(c.length<t.length)return"\n      "+Xa(io(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+ao(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+o+", "+a+", "+i+")) +\n          depth3;\n        "+no(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,h=p[0],d=p[1];return d===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+o+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":d===i&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" + depth * "+a+" +\n          depth2 * "+i+" + depth3 + "+to(n)+";\n      vec2 uv = uvFromFlat("+h+", "+d+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=P(t),a=i.newShape,o=i.keptDims;if(a.length<t.length)return"\n      "+Xa(io(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+ao(["row","col","depth","depth2","depth3","depth4"],o)+");\n      }\n    ";var s=t[5],u=t[4]*s,c=t[3]*u,l=t[2]*c,f=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+l+", "+c+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+no(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],m=h[1];return m===f&&null==p?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==p?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+l+" + depth * "+c+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+to(n)+";\n      vec2 uv = uvFromFlat("+d+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Ya(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1)+"() {\n      return "+Va().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=Va();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=i[0],o=i[1],s=Va();if(null!=i&&M(t,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===t[0])return"\n        "+Ya(io(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+ao(["b","row","col"],[1,2])+");\n        }\n      ";var o=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+o+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+Va().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),f="int b, int row, int col",p="b * "+l+" + (row / 2) * "+c+" + (col / 2)",h=2;h<n-1;h++)f="int b"+h+", "+f,p="b"+h+" * "+(l*=t[n-h-1])+" + "+p;return"\n    vec4 "+i+"("+f+") {\n      int index = "+p+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Va().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var Ja="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Za="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Qa="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",eo="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function to(e){return"offset"+e}function no(e){var t=e.name,n=_(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function ro(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function io(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function ao(e,t){return t.map((function(t){return e[t]})).join(", ")}var oo=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,N(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var o,s,u=this.outputShape,c=u.length,l=ro(c),f=Wa("coords",c);if(1===a){var p=ro(s=c+1);o="\n        "+p+" sourceLocR = "+p+"("+f.join()+", 0);\n        ++"+f[c-1]+";\n        "+p+" sourceLocG = "+p+"("+f.join()+", 0);\n        ++"+f[c-2]+";\n        "+p+" sourceLocA = "+p+"("+f.join()+", 0);\n        --"+f[c-1]+";\n        "+p+" sourceLocB = "+p+"("+f.join()+", 0);\n        --"+f[c-2]+";"}else s=c,o="\n        "+l+" sourceLocR = coords;\n        ++"+f[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),d="."+h[s-1],m=h.map((function(e){return"int "+e})),g=Wa("sourceLocR",s-1).concat("inIdx.r"),v=Wa("sourceLocG",s-1).concat("inIdx.g"),y=Wa("sourceLocB",s-1).concat("inIdx.b"),b=Wa("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+f[c-2]+" < "+(u[c-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+d+", sourceLocG"+d+",\n          sourceLocB"+d+", sourceLocA"+d+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},so=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uo=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=f-1-e.padInfo.top,m=p-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+d+", "+m+");\n      const float avgMultiplier = float("+g+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+i+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+p+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},co=function(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Fr(e,t),Fr(e,n);var o="0.0";null!=r&&(Fr(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=i&&(Fr(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},lo=function(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Fr(e,t),Fr(e,n);var o="vec4(0.0)";null!=r&&(Fr(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(Fr(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},fo=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Fr(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},po="return a + b;",ho="return a - b;",mo="return a * b;",go="return (a < 0.) ? b * a : a;",vo=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Fr(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},yo="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",bo=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Fr(t,n);var i=this.outputShape.length,a="";if(r)if(0===i||1===_(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+ro(i)+" coords = getOutputCoords();\n        ",1===i)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=Wa("coords",i);a+="\n            bool nextRowOutOfBounds =\n              ("+o[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+o[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},xo=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),wo=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Eo=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Co=function(e){this.outputShape=[],this.outputShape=Sn(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var i=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var a=t.length,o=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},So=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Sn(e,t);var n=this.outputShape,r=n.length,i=ro(r),a=Wa("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var c=o[t],l=o.slice(-2),f=o.join(),p="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];p+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+No(o,c,h)+"),\n            vec2("+No(l,c,h)+"));\n        }"}var d=s.length,m=s[s.length-1];p+="\n        return getChannel(\n          getT"+d+"("+No(o,c,m)+"),\n          vec2("+No(l,c,m)+"));",this.userCode="\n      float getValue("+o.map((function(e){return"int "+e}))+") {\n        "+p+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function No(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var Ao=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ko=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,c=a?2:3,l=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Do=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+i+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_o=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+i+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Mo=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},To=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Oo=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,p=4*Math.floor(e.inChannels/4),h=e.inChannels%4,d="channelsLast"===e.dataFormat,m=d?1:2,g=d?2:3,v=d?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+d+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+d+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+p+") *\n                    getW(wR, wC, "+p+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+p+", xR, xC) *\n                    getW(wR, wC, "+p+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+p+", d2),\n                getW(wR, wC, "+p+" + 1, d2)\n              );\n\n              if ("+d+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+p+"),\n                  getX(batch, xR, xC, "+p+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+p+", xR, xC),\n                  getX(batch, "+p+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+p+", d2),\n                getW(wR, wC, "+p+" + 1, d2),\n                getW(wR, wC, "+p+" + 2, d2)\n              );\n\n              if ("+d+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+p+"),\n                  getX(batch, xR, xC, "+p+" + 1),\n                  getX(batch, xR, xC, "+p+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+p+", xR, xC),\n                  getX(batch, "+p+" + 1, xR, xC),\n                  getX(batch, "+p+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},Io=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,p=e.filterWidth,h=4*Math.floor(e.inChannels/4),d=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+p+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===d)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===d)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===d)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Fo=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,h=e.filterWidth,d=e.outChannels/e.inChannels,m="",g="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",g="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+d+";\n        int q = d2 - d1 * "+d+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+p+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+g+"\n        setOutput(result);\n      }\n    "},Ro=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,h=e.filterWidth,d=h,m="int xR; int xC; int xCOffset;",g=0;g<p;g++)for(var v=0;v<h;v++)m+="\n          vec4 xTexelR"+g+"C"+2*v+" = vec4(0.);\n          vec4 wR"+g+"C"+v+" = vec4(0.);\n          vec4 xR"+g+"C"+v+" = vec4(0.);";for(g=0;g<p;g++)for(var y=0;y<d;y++){if(m+="\n          xR = xRCorner + "+g*l+";\n          xC = xCCorner + "+(v=2*y)*f+";\n        ",1===c){if(v<h&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+g+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+".xy);\n                } else {\n                  xR"+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = xTexelR"+g+"C"+v+";\n              ",v+1<h)){var b=s%2==0?C(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+v+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+";\n                "}}else v<h&&(m+="\n              if(xR >= 0 && xR < "+i+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n              ",v+1<h&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+".xy);\n              ",v+1<h&&(m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n                ")),m+="}");v<h&&(m+="\n            vec4 wTexelR"+g+"C"+v+" = getW("+g+", "+v+", d1, q);\n            wR"+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+".xz);\n          ",v+1<h&&(m+="\n              vec4 wTexelR"+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+", d1, q);\n              wR"+g+"C"+(v+1)+" =\n                vec4(wTexelR"+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<p;g++)for(v=0;v<h;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+E+"\n        "+w+"\n        setOutput(result);\n      }\n    "},Bo=function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],o=e[1],s=e[2],u=e[3],c=t[0],l=n[0],f=n[1];this.outputShape=[c,l,f,u];var p="bilinear"===r?1:0,h=[o-1+".0",s-1+".0"],d=h[0],m=h[1],g=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+d+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+d],v=g[0],y=g[1],b=g[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=x[0],E=x[1],C=x[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+d+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+C+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+p+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},zo=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ro(r)+" coords = getOutputCoords();\n        int end = "+Po(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+Po(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Po(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var Lo=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=je.DENSE;var t=Ke(e),n=Va();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+$a(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},jo=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=je.DENSE;var t=Ke(e),n=Va();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+$a(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},Uo=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),qo=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Wo=function(e){this.variableNames=["A"],this.outTexUsage=Ue.DOWNLOAD;var t=Va();this.outputShape=e,this.userCode="\n      "+Ga+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},Vo=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ue.DOWNLOAD;var t=Va();this.outputShape=e,this.userCode="\n      "+Ga+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},$o=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Va(),i=t[0],a=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+Ha(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},Ho=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Va(),i=t[0],a=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+e[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Ha(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "},Go=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Ko=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),Xo=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=ro(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=0;a<e.length;a++)a===t?i.push("int(getIndices("+r[a]+"))"):i.push(""+r[a]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Yo=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=ro(t.length),i=ro(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Jo(e,t){var n=Va();return tt(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Zo(e,t){return ct(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Qo(e,t){return lt(e,t,new Uint16Array([0,1,2,2,1,3]))}function es(e,t,n,r,i,a,o){pt(n,r);var s=ft(e,t),u=e.TEXTURE_2D;return Je(e,t,(function(){return e.bindTexture(u,s)})),Je(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Je(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Je(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Je(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),Je(e,t,(function(){return e.texImage2D(u,0,i,n,r,0,a,o,null)})),Je(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function ts(e,t,n,r,i){var a=Ge(n,r);return es(e,t,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function ns(e,t,n,r,i){var a=Ge(n,r);return es(e,t,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function rs(e,t,n,r,i){var a=Ge(n,r);return es(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function is(e,t,n,r,i){var a=Xe(n,r);return es(e,t,a[0],a[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function as(e,t,n,r,i){var a=Xe(n,r);return es(e,t,a[0],a[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function os(e,t,n,r){return Je(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),dt(e,t,n,"clipSpacePos",r,3,20,0)&&dt(e,t,n,"uv",r,2,20,12)}function ss(e,t,n,r,i,a,o){var s,u,c;Je(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*i*4),u=e.FLOAT,c=o.internalFormatPackedFloat),s.set(a),Je(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,i,0,e.RGBA,u,s)})),Je(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function us(e,t,n,r){Je(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?Je(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):Je(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),Je(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function cs(e,t,n,r,i){var a=e.createBuffer();Je(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*n*r;return Je(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),Je(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),Je(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function ls(e,t,n){var r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function fs(e,t,n,r,i){var a=Ge(n,r),o=a[0],s=a[1],u=new Uint8Array(n*r*4);return Je(e,t,(function(){return e.readPixels(0,0,o,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function ps(e,t,n,r,i,a,o,s){var u=e,c=new Float32Array(function(e,t){var n=Xe(e,t);return n[0]*n[1]*4}(a,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function hs(e,t,n,r){var i=new Float32Array(n*r*4);return Je(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,i)})),i}var ds=Object.freeze({createVertexShader:Jo,createVertexBuffer:Zo,createIndexBuffer:Qo,createFloat32MatrixTexture:ts,createFloat16MatrixTexture:ns,createUnsignedBytesMatrixTexture:rs,createPackedMatrixTexture:is,createFloat16PackedMatrixTexture:as,bindVertexProgramAttributeStreams:os,uploadDenseMatrixToTexture:ss,uploadPixelDataToTexture:us,createBufferFromOutputTexture:cs,downloadFloat32MatrixFromBuffer:ls,downloadByteEncodedFloatMatrixFromOutputTexture:fs,downloadPackedMatrixFromBuffer:ps,downloadMatrixFromPackedOutputTexture:hs}),ms=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=c().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,$e(t,e)):this.gl=He(t);var n="WEBGL_color_buffer_float";if(1===c().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=et(this.gl,this.debug,"OES_texture_float"),Ft(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=et(this.gl,this.debug,"OES_texture_half_float");else if(c().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Ft(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=et(this.gl,this.debug,"EXT_color_buffer_half_float");else if(c().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Ft(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Ft(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Zo(this.gl,this.debug),this.indexBuffer=Qo(this.gl,this.debug),this.framebuffer=ht(this.gl,this.debug),this.textureConfig=Ye(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return c().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Je(t,this.debug,(function(){return t.finish()})),Je(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Je(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),Je(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Je(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Je(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),ts(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),ns(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),rs(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),us(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),ss(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),as(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),is(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(xt(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Je(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return fs(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,i,a){return ps(this.gl,e,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return ls(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=cs(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(c().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(a,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=a}else c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return hs(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=nt(t,this.debug,e),r=Jo(t,this.debug),i=ot(t,this.debug);return Je(t,this.debug,(function(){return t.attachShader(i,r)})),Je(t,this.debug,(function(){return t.attachShader(i,n)})),st(t,this.debug,i),this.debug&&ut(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=os(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Je(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&ut(this.gl,this.debug,this.program),Je(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?gt(this.gl,this.debug,e,t):vt(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Je(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),yt(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Xe(t,n),i=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,i,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&ut(this.gl,this.debug,this.program),wt(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Je(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Je(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=et(this.gl,this.debug,2===c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return a(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return[4,R((function(){return t.disposed||t.isQueryAvailable(e,c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||R((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),bt(this.gl,this.debug,e,this.framebuffer),this.debug&&wt(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(bt(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&wt(this.gl)):xt(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;bt(r,this.debug,e,this.framebuffer),this.debug&&wt(r),this.outputTexture=e,Je(r,this.debug,(function(){return r.viewport(0,0,t,n)})),Je(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),Je(this.gl,this.debug,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function gs(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,i=t[n],a=i.shape;if(!M(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var o=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!M(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}}))}var vs=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,i=n.inChannels,a=n.strideWidth,o=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,f=n.dataFormat,p=s.left,h=s.top,d=i*r,m=Va(),g="channelsLast"===f,v=g?0:1,y=g?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+o+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+d+");\n\n            if(d0 < "+t[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+p+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+d+".) / "+i+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "},ys=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var a,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},bs=function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},xs=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},ws=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,o=i-1-e.padInfo.top,s=a-1-e.padInfo.left,u=i*a-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Es=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=u-1-e.padInfo.top,p=c-1-e.padInfo.left,h=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+f+", "+p+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+i+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Cs=function(e,t,n,r,i,a,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",d="";a&&(h=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",d="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+p[0]+");\n          result += ("+f[1]+" * "+p[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},Ss=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),Ns=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},As=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Wa("rc",t),r=ro(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",i=e-2;i<e;i++)r+=n[i]+" >= "+t[i],i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var a=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),o=2;o<e;o++)a=t[t.length-1-o]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}},ks=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,i=ro(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+a+");\n      "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Ds=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,i=ro(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=Wa("rc",r),u=Wa("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],p=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",d=0,m=1===r?2:4;d<m;d++)h+="\n        "+f[d]+"\n        if ("+p+") {\n          result["+d+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+d+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+i+" start = "+i+"("+a+");\n      const "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},_s=function(e,t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,o=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var d="avg"===t,m="((batch  * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + d",g="(xR * "+e.inWidth+" + xC) * "+e.inChannels+" + d",v="0.0";if(d||(v="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+s+");\n        const ivec2 pads = ivec2("+p+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+l+";\n              wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+c+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(r?i?m:g:"wR * "+f+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(a/4),x=a%4,w="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+p+", "+h+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+l+";\n            wR += "+u+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+b+"; wC += 4) {\n            int xC = xCCorner + wC * "+c+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              getValue(batch, xR, xC + 3 * "+c+", d)\n            );\n\n            "+w+"\n          }\n\n          int xC = xCCorner + "+b+";\n          if ("+(1===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(2===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(3===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              initializationValue\n            );\n\n            "+w+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}},Ms=function(e,t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,o=e.strideDepth,s=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,f=e.dilationWidth,p=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;var y="avg"===t,b="0.0";if(y||(b="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+s+", "+u+");\n        const ivec3 pads = ivec3("+m+", "+g+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+p+";\n              wD += "+c+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+l+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+f+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(r?i?"(((batch * "+e.inDepth+" + xD) * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"((xD * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"wD * "+h+" * "+d+" +\n                      wR * "+d+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var x=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(x="avgValue / count");var w=4*Math.floor(a/4),E=a%4,C="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+s+", "+u+");\n      const ivec3 pads = ivec3("+m+", "+g+", "+v+");\n      const float initializationValue = "+b+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+b+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+p+";\n            wD += "+c+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+l+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+f+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+f+", ch)\n              );\n\n              "+C+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+C+"\n            } else if ("+(2===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+C+"\n            } else if ("+(3===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                initializationValue\n              );\n\n              "+C+"\n            }\n          }\n          setOutput("+x+");\n        }\n      }\n    "}},Ts=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=Math.ceil(i/n);this.outputShape=[r,a];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",p="vec4";"all"===t?(o="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===t&&(o="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},Os=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+$a(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Ha(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Is=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?i-1:i,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],p=c[1]/l[1],h=1/f,d=1/p,m=2*Math.ceil(h)+2,g=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Fs=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Rs=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Bs=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?i-1:i,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],p=c[1]/l[1],h=1/f,d=1/p,m=2*Math.ceil(h)+2,g=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},zs=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Ps=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),i=ro(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},Ls=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=Wa("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],o=ro(n);function s(n){var r=e.map((function(r,i){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+i+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},js=function(e,t,n,r,i,a,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=ro(i.length),u=ro(a.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var p="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+p+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Us=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},qs=function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&o.push(""+a[u]);r=o.join(),i=s.join()}var c=ro(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},Ws=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=ro(this.rank),r="uniform int start["+this.rank+"];",i=function(e){if(1===e)return"sourceLoc";if(e<=6)return Vs.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+Vs[t]+" = start["+t+"] + coords."+Vs[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Vs=["x","y","z","w","u","v"],$s=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=ro(this.rank),n=Wa("coords",this.rank),r=Wa("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+i+")",o="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Hs=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=ro(n.length),a=ro(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "},Gs=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,i=Ks(t,n),a=Xs(e,i,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[a].shift();return this.usedTextures[a].push(o),o}return this.numUsedTextures++,this.log(),i===qe.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===qe.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===qe.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===qe.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===qe.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var i=Xs(t,Ks(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],o=a.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(o,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Ks(e,t){if(e===Ue.UPLOAD)return qe.PACKED_2X2_FLOAT32;if(e===Ue.RENDER||null==e)return function(e){return c().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?qe.PACKED_2X2_FLOAT32:qe.UNPACKED_FLOAT32:e?qe.PACKED_2X2_FLOAT16:qe.UNPACKED_FLOAT16}(t);if(e===Ue.DOWNLOAD||e===Ue.PIXELS)return qe.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Xs(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var Ys=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=ro(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Js=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Zs="if (isnan(x)) return x;",Qs="return abs(x);",eu=Zs+"\n  return (x < 0.0) ? 0.0 : x;\n",tu=Zs+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",nu="return (x >= 0.0) ? x : (exp(x) - 1.0);",ru="return -x;",iu="return ceil(x);",au="return floor(x);",ou="return exp(x);",su="return exp(x) - 1.0;",uu="return x;",cu="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",lu="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",fu="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",pu=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},hu=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=Wa("rc",t),r=ro(t),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},du={};function mu(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?cu:eu;if("elu"===e)return t?fu:nu;if("relu6"===e)return t?lu:tu;if("prelu"===e)return t?yo:go;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var gu=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!c().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=He(c().getNumber("WEBGL_VERSION"));r.binaryCache=((n=c().getNumber("WEBGL_VERSION"))in du||(du[n]={}),du[n]),r.gpgpu=new ms(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new Gs(r.gpgpu),r.numMBBeforeWarning=null==c().global.screen?1024:c().global.screen.height*c().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new ia(r,ze),r}return i(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(c().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Ue.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(c().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Ue.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensors,a=t.slice,o=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new pu(o,uu):new Js(o,uu);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,p,h=null!=this.activeTimers;return h&&(f=ie()),p="complex64"===r?Ca(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=ie()-f),this.convertAndCacheOnCPU(e,p)},t.prototype.read=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i,a,s,u,l,f,p,h,d,m,g,v,y,b,x,w,E,C,S;return o(this,(function(o){switch(o.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,i=n.shape,a=n.slice,s=n.dtype,u=n.complexTensors,l=n.isPacked,null!=a)return f=l?new pu(i,uu):new Js(i,uu),p=this.runWebGLProgram(f,[{dataId:e,shape:i,dtype:s}],s),h=this.read(p.dataId),this.disposeData(p.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!c().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===c().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==s&&c().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(e),g=this.texData.get(m.dataId),d=(S=this.gpgpu).createBufferFromTexture.apply(S,[g.texture].concat(Ke(i)))),this.pendingRead.set(e,[]),"complex64"===s?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:o.sent(),o.label=2;case 2:return"complex64"!==s?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return y=o.sent(),b=y[0],x=y[1],v=Ca(b,x),[3,5];case 4:null==d?v=this.getValuesFromTexture(e):(w=_(i),v=this.gpgpu.downloadFloat32MatrixFromBuffer(d,w)),o.label=5;case 5:return null!=m&&this.disposeData(m.dataId),E=this.convertAndCacheOnCPU(e,v),C=this.pendingRead.get(e),this.pendingRead.delete(e),C.forEach((function(e){return e(E)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,E]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Ze(n)){if(c().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.isPacked,o=_(r);if(c().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),l=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Ke(r))).subarray(0,o);return this.disposeData(s.dataId),l}var f=c().getBool("WEBGL_PACK")&&!0===a,p=f?kt(r):r,h=f?new Vo(p):new Wo(p),d=this.runWebGLProgram(h,[{shape:p,dtype:i,dataId:e}],"float32"),m=this.texData.get(d.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,o);return this.disposeData(d.dataId),g},t.prototype.time=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i,a,s,u;return o(this,(function(o){switch(o.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),i=D(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),a=D(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return u=o.sent(),s.kernelMs=S(u),s.getExtraProfileInfo=function(){return u.map((function(e,t){return{name:a[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:s.kernelMs={error:"WebGL query timers are not supported in this environment."},o.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ie(),endMs:null}},t.prototype.endTimer=function(e){return c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ie(),e)},t.prototype.getQueryTime=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){return c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,i=t.texShape,a=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,a,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return c().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=ze.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&_(e.shape)<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:ze.keep(e.clone()),imag:ze.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===_(n))return _n([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,i=$i(e.shape,t,n);if(r||!i){var a=c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $s(n):new Ws(n),o=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),i=this.makeOutput(n,e.dtype),a=this.texData.get(i.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var o=Hi(t,e.strides);r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),i},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var i=qi(t,n,r);if(i.some((function(e){return 0===e})))return _n([],i);var a=new Hs(t,r,i);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ls(e.shape,t):new Ps(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return kn(e)})),r=e.map((function(e){return Dn(e)}));return An(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>c().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),a=this.concat(e.slice(0,i),t),o=this.concat(e.slice(i),t);return this.concat([a,o],t)}if(c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new So(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var u=Sn(e.map((function(e){return e.shape})),t),l=e.map((function(e){return e.as2D(-1,_(e.shape.slice(t)))})),f=new Co(l.map((function(e){return e.shape})));return this.compileAndRun(f,l).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ru,e.dtype);var t=new Js(e.shape,ru);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===i||1===a)&&o>1e3){n&&(e=ra(e,[0,2,1])),r&&(t=ra(t,[0,2,1]));var u=1===a?e:e.as3D(s,o,1),c=1===a?2:1,l=1===a?t.as3D(s,1,o):t;return this.multiply(u,l).sum(c,!0)}var f=De(e.dtype,t.dtype),p=new Cs(e.shape,[s,i,a],n,r);return this.compileAndRun(p,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=i?n.shape[1]:n.shape[2],l=t.shape[0],f=De(t.dtype,n.dtype),p=null!=a,h=null!=s,d=o?mu(o,!0):null,m=new Cs(t.shape,[l,u,c],r,i,p,d,h),g=[t,n];return a&&g.push(a),s&&g.push(s),this.compileAndRun(m,g,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new fo("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new fo("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(i,o),u=this.compileAndRun(a,o),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,mo,e.dtype);var f=new vo(mo,e.shape,t.shape);return this.compileAndRun(f,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){var o=[e,t,n],s=null;null!=a&&(s=a.shape,o.push(a));var u=null;if(null!=i&&(u=i.shape,o.push(i)),c().getBool("WEBGL_PACK_NORMALIZATION")){var l=new lo(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,o)}var f=new co(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(f,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){var a=c().getBool("WEBGL_PACK_NORMALIZATION")?new xs(e.shape,t,n,r,i):new ys(e.shape,t,n,r,i);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){var s=new bs(t.shape,r,i,a,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return se(e)}));return Ba(Zn(e.shape,e.dtype,n),t)}var r=new Ys(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ds(e.shape,t,n):new ks(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new Xo(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){N(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=fr(e.shape,t,r),a=pr(i.length,t.length),o=hr(e.shape,t,r),s=dr(n,t.length),u=mr(o,n,t.length);return ra(e.reshape(i),a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){N(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=fr(o.shape,t,r,!1),u=pr(s.length,t.length,!1),c=hr(o.shape,t,r,!1);return ra(o.reshape(s),u).reshape(c)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],a=Ri(i),o=new Ts({windowSize:a,inSize:i,batchSize:r},t),s=this.compileAndRun(o,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var a=Ri(i),o=new Ua({windowSize:a,inSize:i,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(o,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,i=Ri(r[r.length-1]),a=new oo(r,i,t,null==n),o=null==n?[e]:[e,n],s=this.compileAndRun(a,o,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){bn("sum",t,e.rank);var n=vn(e.shape,t),r=n[0],i=_(n[1]),a=e.as2D(-1,i),o=_e(e.dtype);return this.reduce(a,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=vn(e.shape,t),r=n[0],i=_(n[1]),a=e.as2D(-1,i),o=_e(e.dtype);return this.reduce(a,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=xn([r],e.rank),a=e;null!=i&&(a=ra(e,i),r=En(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],i=e.length,a=0;a<i;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=_([a.shape[r]]),u=a.as2D(-1,s),c=_e(e.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(o);return null!=i&&(l=ra(l,wn(i))),l},t.prototype.segOpCompute=function(e,t,n,r,i){var a=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Z(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Z(e,n+1);return n}(o,i),u=new Us({windowSize:s,inSize:o,batchSize:a,numSegments:i},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===i?c:(n=Wn(0,i).tile([o/s]),this.segOpCompute(c,t,n,r,i))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(bn("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!c().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=vn(e.shape,r),a=i[0],o=_(i[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new zo(e.shape,n,r);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new vo("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new vo("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new vo("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new vo("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new vo("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new vo("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new Js(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new vo("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new vo("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new qs(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],De(t.dtype,n.dtype))},t.prototype.where=function(e){ln("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Pa(e.shape,t)},t.prototype.topk=function(e,t,n){return za(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){bn("min",t,e.rank);var n=vn(e.shape,t),r=n[0],i=_(n[1]),a=e.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new vo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new vo("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);bn("max",t,e.rank);var n=vn(e.shape,t),r=n[0],i=_(n[1]),a=e.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new vo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){bn("all",t,e.rank);var n=vn(e.shape,t),r=n[0],i=_(n[1]),a=e.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){bn("any",t,e.rank);var n=vn(e.shape,t),r=n[0],i=_(n[1]),a=e.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.floorDiv=function(e,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new vo("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,po);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=De(e.dtype,t.dtype);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,po,n);var r=new vo(po,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new pu(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,i){void 0===i&&(i=!1);var a=new bo(n,e.shape,t.shape,i);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),a=this.texData.get(t.dataId),o=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(i){var a=i[0],o=i[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,o),c=new vo(n,e.shape,t.shape);return r.compileAndRun(c,[s,u],De(a.dtype,o.dtype))})),s=o[0],u=o[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>c().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var i=e.map((function(e){return e.dtype})).reduce((function(e,t){return De(e,t)})),a=e.map((function(e){return e.shape})),o=c().getBool("WEBGL_PACK")?new ja(e[0].shape,a):new La(e[0].shape,a);return this.compileAndRun(o,e,i)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,ho);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=De(e.dtype,t.dtype);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ho,e.dtype);var r=new vo(ho,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new vo("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=De(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,iu,e.dtype);var t=new Js(e.shape,iu);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,au,e.dtype);var t=new Js(e.shape,au);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new Js(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new Js(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new Js(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new Js(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new Js(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ou,e.dtype);var t=new Js(e.shape,ou);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,su,e.dtype);var t=new Js(e.shape,su);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=z([t],e.shape),r=this.max(e,n),i=yn(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return Oi(o,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new Js(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new Js(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new Js(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Js(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new Js(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=c().getBool("WEBGL_PACK")?new pu(e.shape,cu):new Js(e.shape,eu),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=c().getBool("WEBGL_PACK")?new pu(e.shape,lu):new Js(e.shape,tu),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bo(yo,e.shape,t.shape):new vo(go,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,fu,e.dtype);var t=new Js(e.shape,nu);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new vo("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new Js(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new Js(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,i=(r=c().getBool("WEBGL_PACK_CLIP")?new wo(e.shape):new xo(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Qs,e.dtype);var t=new Js(e.shape,Qs);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Eo(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new Js(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new Js(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new Js(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new Js(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new Js(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new Js(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new Js(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new Js(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new vo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new Js(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new Js(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new Js(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new Js(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new Js(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new Js(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new Js(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new Js(e.shape,function(e){return void 0===e&&(e=0),Zs+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,i,a){var o=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,l=o[0]*o[1]*o[2],f=n.outChannels,p="channelsLast"===n.dataFormat,h=(1===l||1===f)&&u>1e3,d=o[2]%2!=0&&!!s.isPacked;if(h||!c().getBool("WEBGL_LAZILY_UNPACK")||!c().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!d){var m=p?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],g=this.reshape(e,[1,m,n.inChannels]),v=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:v,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),n.outShape)}var y=p?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),b={dataId:e.dataId,shape:[1,y,n.inChannels],dtype:e.dtype},x=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,N(Mt(s.shape,b.shape),(function(){return"packed reshape "+s.shape+" to "+b.shape+" isn't free"}));var w=this.reshape(t,[1,n.inChannels,n.outChannels]),E=this.fusedBatchMatMul({a:b,b:w,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),C=this.texData.get(E.dataId);return N(C.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=x,C.shape=n.outShape,ze.makeTensorFromDataId(E.dataId,n.outShape,E.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,i,a){var o=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,f="channelsLast"===n.dataFormat,p=o*s*u,h=l*c,d=[p,h],m=e.squeeze([0]),g=t.reshape([1,p,-1]),v=new vs(d,m.shape,n),y=this.compileAndRun(v,[m]).reshape([1,d[0],d[1]]),b=null!=r,x=null!=a,w=i?mu(i,!0):null,E=new Cs(y.shape,[1,h,n.outChannels],!0,!1,b,w,x),C=[y,g];r&&C.push(r),x&&C.push(a);var S=this.compileAndRun(E,C);return f?S.reshape([1,l,c,n.outChannels]):S.reshape([1,n.outChannels,l,c])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,i,a,o);if(c().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,i,a,o);var s=null!=i,u=null!=o,l=a?mu(a,!1):null,f=new Oo(r,s,l,u),p=[t,n];return i&&p.push(i),o&&p.push(o),this.compileAndRun(f,p)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(c().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new Oo(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new ko(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new Ao(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,i=e.convInfo,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=c().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,l=o?mu(o,u):null,f=[n,r],p=null!=a,h=null!=s;return p&&f.push(a),h&&f.push(s),u?(t=new Ro(i,p,l,h),this.compileAndRun(t,f)):(t=new Fo(i,p,l,h),this.compileAndRun(t,f))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return c().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Ro(n),this.compileAndRun(r,[e,t])):(r=new Fo(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new To(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new Mo(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new Io(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new _o(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new Do(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new _s(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new _s(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var i=new _s(r,"max",!0),a=this.compileAndRun(i,[t]),o=new ws(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new so(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return ba(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new Ms(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new uo(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new Ms(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var i=new Ms(r,"max",!0),a=this.compileAndRun(i,[t]),o=new Es(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!Mt(e.shape,t)&&(null===n.texture||!Mt(n.shape,t))){var r=this.packedReshape(e,t);return ze.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return xa(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var i=c().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Rs(e.shape,t,n,r):new Fs(e.shape,t,n,r);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new Is(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new zs(e.shape,t,n,r);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new Bs(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var i=t?e:ta(e),a=i.shape[0],o=i.shape[1],s=new Ss(a,o,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var i=new Ns(e.size,t,n,r);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var t=new qo(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return ln("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),_a(e.dataSync(),t.dataSync(),n,r,i)},t.prototype.cropAndResize=function(e,t,n,r,i,a){var o=new Bo(e.shape,t.shape,r,i,a);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){N(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],i="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=i*t,u=a*t,c=o/(t*t),l=new Uo("NHWC"===n?[r,s,u,c]:[r,c,s,u],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return Ra(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=Pi(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/o,o],l=e.reshape([a,i]),f=t.reshape([a,o]);if(0===u)return xa(_n([]),n);var p=Tn(0),h=new js(a,i,l.rank,f.rank,s,c);return this.compileAndRun(h,[f,l,p]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var i=Pi(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.strides,u=i.outputSize,c=new js(o,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(c,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new Go("return real * expR - imag * expI;",e.shape,t),i=new Go("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,a),s=this.compileAndRun(i,a),u=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=Ii(e,t),a=i[0],o=i[1],s=i[2],u=i[3],c=t.reshape([o,r]),l=e.reshape([e.size/s,s]),f=new Yo(r,u,[o,s]);return this.compileAndRun(f,[l,c]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||Y(t))){var r=j(n,_(e));return r.fill(t),ze.makeTensor(r,e,n,this)}var i=new Ko(e,t),a=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return wa(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return ze.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new hu(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new As(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[Nt(e.shape)].concat(At(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[Nt(t)].concat(At(t)),a=new Os(i,n),o=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,i=n.shape,a=n.dtype,o=kt(i);return t=r?new jo(o):new Lo(o),{dtype:a,shape:i,dataId:this.runWebGLProgram(t,[{shape:o,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,i){var a=this;void 0===i&&(i=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===je.DENSE){var u=Ke(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===_(o.shape))return s.values=L(o.dtype,0),o;var l=[],f=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&_(t.shape)<=c().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Mt(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var p,h={shape:o.shape,texData:s,isUniform:!1},d=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var i=e.userCode;return e.constructor.name+"_"+r+"_"+i}(e,f,h),m=this.getAndSaveBinary(d,(function(){return function(e,t,n,r){var i=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Ka(a,s,i,t.packedInputs),l=e.createProgram(u),f=null,p=e.getUniformLocation(l,"NAN",!1);1===c().getNumber("WEBGL_VERSION")&&(f=e.getUniformLocation(l,"INFINITY",!1));for(var h={},d=0;d<t.variableNames.length;d++){var m=t.variableNames[d];h[m]=e.getUniformLocation(l,m,!1),h["offset"+m]=e.getUniformLocation(l,"offset"+m,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:h,inShapeInfos:o,outShapeInfo:s,infLoc:f,nanLoc:p}}(a.gpgpu,e,f,h)})),g=null!=this.activeTimers;if(g&&(p=this.startTimer()),function(e,t,n,r,i){gs(t.inShapeInfos,n),gs([t.outShapeInfo],[r]);var a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===c().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],a=t.uniformLocations[i],o=t.uniformLocations["offset"+i];if(null!=a)if(n.isUniform)if(_(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,m,f,h,r),l.forEach((function(e){return a.disposeData(e.dataId)})),g&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)})),!c().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var v=this.unpackTensor(o);return this.disposeData(o.dataId),v}return o},t.prototype.compileAndRun=function(e,t,n,r,i){void 0===i&&(i=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,i);return ze.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(c().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Yt((function(){if(!c().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=c().getBool("DEBUG");c().set("DEBUG",!1);var n=e.abs(Tn(1e-8)).dataSync()[0];if(c().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.values,o=n.texture,s=n.usage,u=n.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=ie());var f=n.texShape;if(null==f&&(f=Dt(r,u),n.texShape=f),null!=a){var p=kt(r),h=void 0,d=f[1],m=f[0],g=a instanceof Uint8Array;u?(d=(t=Xe(f[0],f[1]))[0],m=t[1],h=new Ho(p,[m,d],g)):h=new $o(p,[m,d],g);var v=this.makeTensorInfo([m,d],i);this.texData.get(v.dataId).usage=g?Ue.PIXELS:Ue.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),d,m,a);var y=this.runWebGLProgram(h,[v],i,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(v.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=ie()-c)}else{var x=this.acquireTexture(f,s,i,u);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*$(t)},t}(aa);function vu(e,t){return e(t={exports:{}},t.exports),t.exports}Pe()&&ze.registerBackend("webgl",(function(){return new gu}),2),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self&&self;var yu=vu((function(e){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var n=new r(e),a=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.alea=a}(0,e)})),bu=vu((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xor128=a}(0,e)})),xu=vu((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xorwow=a}(0,e)})),wu=vu((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&(a.x&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xorshift7=a}(0,e)})),Eu=vu((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&(a.X&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xor4096=a}(0,e)})),Cu=vu((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.tychei=a}(0,e)})),Su=vu((function(e){!function(t,r){var i,a=this,o=256,s="random",u=r.pow(o,6),c=r.pow(2,52),l=2*c,f=255;function p(e,n,f){var p=[],v=m(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,g(t)]}}():e,3),p),y=new h(p),b=function(){for(var e=y.g(6),t=u,n=0;e<c;)e=(e+n)*o,t*=o,n=y.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,m(g(y.S),t),(n.pass||f||function(e,t,n,i){return i&&(i.S&&d(i,y),e.state=function(){return d(y,{})}),n?(r[s]=e,t):e})(b,v,"global"in n?n.global:this==r,n.state)}function h(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=f&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=f&i+1],n=n*o+s[f&(s[i]=s[a=f&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",i=0;i<r.length;)t[f&i]=f&(n^=19*t[f&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=p,m(r.random(),t),e.exports){e.exports=p;try{i=n(4902)}catch(e){}}}([],Math)}));Su.alea=yu,Su.xor128=bu,Su.xorwow=xu,Su.xorshift7=wu,Su.xor4096=Eu,Su.tychei=Cu;var Nu=Su.alea,Au=Nn({addN_:function(e){N(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),N(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return hn(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!M(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return ze.runKernelFunc((function(e,n){return e.addN(t)}),r,null,"AddN")}});function ku(){$t("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Du(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function _u(e,t,n,r,i,a){null==a&&(a=.001);var o,s,u=hn(e,"x","batchNorm"),c=hn(t,"mean","batchNorm"),l=hn(n,"variance","batchNorm");null!=i&&(o=hn(i,"scale","batchNorm")),null!=r&&(s=hn(r,"offset","batchNorm")),N(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),N(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),N(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var f={x:u,scale:o,offset:s,mean:c,variance:l},p={varianceEpsilon:a};return ze.runKernelFunc((function(e,t){var n=Du(u),r=e.batchNormalization(n,Mu(c),Mu(l),a,Mu(o),Mu(s));return t([u,c,l,o]),r}),f,null,"FusedBatchNorm",p).reshape(u.shape)}function Mu(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var Tu=Nn({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),ku(),_u(e,t,n,a,i,r)}}),Ou=Nn({batchNorm_:_u});function Iu(e,t,n,r,i,a){var o,s,u=hn(e,"x","batchNorm"),c=hn(t,"mean","batchNorm"),l=hn(n,"variance","batchNorm");return null!=i&&(o=hn(i,"scale","batchNorm")),null!=r&&(s=hn(r,"offset","batchNorm")),N(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),N(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),N(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=o&&N(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),null!=s&&N(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Ou(u,c,l,s,o,a)}var Fu=Nn({batchNormalization2d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),ku(),Iu(e,t,n,a,i,r)}}),Ru=Nn({batchNorm2d_:Iu});function Bu(e,t,n,r,i,a){var o,s,u=hn(e,"x","batchNorm"),c=hn(t,"mean","batchNorm"),l=hn(n,"variance","batchNorm");return null!=i&&(o=hn(i,"scale","batchNorm")),null!=r&&(s=hn(r,"offset","batchNorm")),N(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),N(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),N(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=o&&N(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),null!=s&&N(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Ou(u,c,l,s,o,a)}var zu=Nn({batchNormalization3d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),ku(),Bu(e,t,n,a,i,r)}}),Pu=Nn({batchNorm3d_:Bu});function Lu(e,t,n,r,i,a){var o,s,u=hn(e,"x","batchNorm"),c=hn(t,"mean","batchNorm"),l=hn(n,"variance","batchNorm");return null!=i&&(o=hn(i,"scale","batchNorm")),null!=r&&(s=hn(r,"offset","batchNorm")),N(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),N(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),N(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=o&&N(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),null!=s&&N(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Ou(u,c,l,s,o,a)}var ju=Nn({batchNormalization4d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),ku(),Lu(e,t,n,a,i,r)}}),Uu=Nn({batchNorm4d_:Lu}),qu=Nn({broadcastTo_:function(e,t){var n=hn(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var i=n.shape.slice();i.length<t.length;)i.unshift(1);n=n.reshape(i)}for(var a=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(a[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return n.clone();var c={x:n},l={shape:t,inputShape:a};return ze.runKernelFunc((function(e){return e.tile(n,o)}),c,(function(e){return{x:function(){return e.sum(u,!0)}}}),Sr,l)}}),Wu=Nn({clone_:function(e){var t=hn(e,"x","clone",null);return ze.runKernelFunc((function(){return ze.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{x:t},null,Ar)}}),Vu=Nn({logicalAnd_:function(e,t){var n=hn(e,"a","logicalAnd","bool"),r=hn(t,"b","logicalAnd","bool");return Fr(n.shape,r.shape),ze.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),$u=Nn({logicalNot_:function(e){var t=hn(e,"x","logicalNot","bool");return ze.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),Hu=Nn({logicalOr_:function(e,t){var n=hn(e,"a","logicalOr","bool"),r=hn(t,"b","logicalOr","bool");return Fr(n.shape,r.shape),ze.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),Gu=Nn({logicalXor_:function(e,t){var n=hn(e,"a","logicalXor","bool"),r=hn(t,"b","logicalXor","bool");return Fr(n.shape,r.shape),Hu(e,t).logicalAnd(Vu(e,t).logicalNot())}}),Ku=Nn({where_:function(e,t,n){var r=hn(t,"a","where"),i=hn(n,"b","where"),a=hn(e,"condition","where","bool");return A(r.shape,i.shape,"Error in where: "),1===a.rank?N(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):A(a.shape,i.shape,"Error in where: "),ze.runKernelFunc((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return $n(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),Xu=function(e){return a(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return[4,(t=hn(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=Pa(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},Yu=Nn({divNoNan_:function(e,t){var n,r=hn(e,"a","div"),i=hn(t,"b","div");r=(n=Me(r,i))[0],i=n[1];var a=Oi(r,i),o=$n(a),s=i.equal(o);return Ku(s,o,a)}}),Ju=Nn({tile_:function(e,t){var n=hn(e,"x","tile",null);N(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var r=[n],i={x:n},a={reps:t};return ze.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),i,null,kr,a,r)}}),Zu=Nn({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=Zn([e,t],r),a=e<=t?e:t,o=0;o<a;++o)i.set(1,o,o);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return Ju(ir(s,0),[n[0],1,1]);if(2===n.length)return Ju(ir(ir(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Ju(ir(ir(ir(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Qu=Nn({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=hn(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?i.as2D(1,-1):i,u=ze.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?u.as1D():u}}),ec=Nn({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=hn(e,"indices","oneHot","int32"),a=i.shape.concat([t]),o={indices:i=i.flatten()},s={depth:t,onValue:n,offValue:r};return ze.runKernelFunc((function(e,a){return a([i]),e.oneHot(i,t,n,r)}),o,null,Nr,s).reshape(a)}}),tc=Nn({pad_:function(e,t,n){void 0===n&&(n=0);var r=hn(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:t,constantValue:n},a={x:r};return ze.runKernelFunc((function(e,i){return i([r]),e.pad(r,t,n)}),a,null,Dr,i)}}),nc=Nn({pad1d_:function(e,t,n){return void 0===n&&(n=0),N(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),tc(e,[t],n)}}),rc=Nn({pad2d_:function(e,t,n){return void 0===n&&(n=0),N(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),tc(e,t,n)}}),ic=Nn({pad3d_:function(e,t,n){return void 0===n&&(n=0),N(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),tc(e,t,n)}}),ac=Nn({pad4d_:function(e,t,n){return void 0===n&&(n=0),N(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),tc(e,t,n)}}),oc=Nn({rand_:function(e,t,n){var r=_(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=t();return ze.makeTensor(i,e,n)}});function sc(){return 32===ze.backend.floatPrecision()?.001:.1}function uc(e,t,n){var r=!0;if((V(e)||V(t))&&(r=!1),V(e)&&V(t)&&(r=!0),r){var i=e.constructor.name,a=t.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var o=fn(e),s=fn(t);if(!M(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var u=V(e)?e:D(e),c=V(t)?t:D(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var f=u[l],p=c[l];if(!n(f,p))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+p+".\nActual:   "+u+".\nExpected: "+c+".")}}function cc(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}var lc=Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=sc()),uc(e,t,(function(e,t){return cc(e,t,n)}))},testEpsilon:sc,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return G(e)||G(e[0])||G(t)||G(t[0])?uc(e,n,(function(e,t){return e==t})):uc(e,t,(function(e,t){return cc(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=sc()),!cc(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),fc=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Nu(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,a=void 0,o=void 0;do{o=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),pc=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var i=r||Math.random();this.randu=Nu(i.toString()),this.randn=new fc(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,i,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(i=this.randu())<t||Math.log(i)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),hc=function(){function e(e,t,n,r){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Nu(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}(),dc=Nn({randomGamma_:function(e,t,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new pc(t,n,r,i),o=Zn(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),mc=Nn({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new fc(t,n,r,!1,i),o=Zn(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),gc=Nn({randomUniform_:function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=Zn(e,r),o=new hc(t,n,null,i),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),vc=Nn({square_:function(e){var t=hn(e,"x","square"),n=[t];return ze.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},n,[])}}),yc=Nn({squaredDifference_:function(e,t){var n,r=hn(e,"a","squaredDifference"),i=hn(t,"b","squaredDifference");n=Me(r,i),r=n[0],i=n[1],Fr(r.shape,i.shape);var a={a:r,b:i},o=[r,i];return ze.runKernelFunc((function(e,t){var n=e.squaredDifference(r,i);return t([r,i]),n}),a,(function(e,t){var n=t[0],r=t[1],i=Tn(2);return{a:function(){return e.mul(n.sub(r).mul(i))},b:function(){return e.mul(r.sub(n).mul(i))}}}),xr,{},o,[])}}),bc=Nn({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var a=new fc(t,n,r,!0,i),o=Zn(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),xc=Nn({equal_:function(e,t){var n,r=hn(e,"a","equal"),i=hn(t,"b","equal");return n=Me(r,i),r=n[0],i=n[1],Fr(r.shape,i.shape),ze.runKernelFunc((function(e){return e.equal(r,i)}),{$a:r,$b:i})}}),wc=Nn({equalStrict_:function(e,t){var n=hn(e,"a","equalStrict"),r=hn(t,"b","equalStrict");return A(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Ec=Nn({greater_:function(e,t){var n,r=hn(e,"a","greater"),i=hn(t,"b","greater");return n=Me(r,i),r=n[0],i=n[1],Fr(r.shape,i.shape),ze.runKernelFunc((function(e){return e.greater(r,i)}),{a:r,b:i},null,"Greater")}}),Cc=Nn({greaterEqual_:function(e,t){var n,r=hn(e,"a","greaterEqual"),i=hn(t,"b","greaterEqual");return n=Me(r,i),r=n[0],i=n[1],Fr(r.shape,i.shape),ze.runKernelFunc((function(e,t){var n=e.greaterEqual(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return $n(n)},b:function(){return $n(r)}}}),"GreaterEqual")}}),Sc=Nn({greaterEqualStrict_:function(e,t){var n=hn(e,"a","greaterEqualStrict"),r=hn(t,"b","greaterEqualStrict");return A(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Nc=Nn({greaterStrict_:function(e,t){var n=hn(e,"a","greaterStrict"),r=hn(t,"b","greaterStrict");return A(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Ac=Nn({less_:function(e,t){var n,r=hn(e,"a","less"),i=hn(t,"b","less");return n=Me(r,i),r=n[0],i=n[1],Fr(r.shape,i.shape),ze.runKernelFunc((function(e){return e.less(r,i)}),{a:r,b:i},null,"Less")}}),kc=Nn({lessEqual_:function(e,t){var n,r=hn(e,"a","lessEqual"),i=hn(t,"b","lessEqual");return n=Me(r,i),r=n[0],i=n[1],Fr(r.shape,i.shape),ze.runKernelFunc((function(e,t){var n=e.lessEqual(r,i);return t([r,i]),n}),{a:r,b:i},null,"LessEqual")}}),Dc=Nn({lessEqualStrict_:function(e,t){var n=hn(e,"a","lessEqualStrict"),r=hn(t,"b","lessEqualStrict");return A(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),_c=Nn({lessStrict_:function(e,t){var n=hn(e,"a","lessStrict"),r=hn(t,"b","lessStrict");return A(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Mc=Nn({notEqual_:function(e,t){var n,r=hn(e,"a","notEqual"),i=hn(t,"b","notEqual");return n=Me(r,i),r=n[0],i=n[1],Fr(r.shape,i.shape),ze.runKernelFunc((function(e){return e.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),Tc=Nn({notEqualStrict_:function(e,t){var n=hn(e,"a","notEqualStrict"),r=hn(t,"b","notEqualStrict");return A(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Oc(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Ic(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Fc=Nn({gather_:function(e,t,n){void 0===n&&(n=0);var r=hn(e,"x","gather"),i=hn(t,"indices","gather","int32");n=z(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],i=[],a=1,o=1,s=0;s<n;s++)i.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)i.push(t.shape[s]);for(s=n+1;s<e.rank;s++)i.push(e.shape[s]),o*=e.shape[s];return{batchSize:a,sliceSize:o,dimSize:r,outputShape:i}}(r,i,n);return ze.runKernelFunc((function(e,t){var a=e.gather(r,i.flatten(),n);return t([i]),a}),{x:r,indices:i},(function(e,t){var i=t[0];return{x:function(){var t=r.shape,a=i.size,o=t.slice(0,n),s=o.length,u=t.slice(n,t.length).slice(1),c=u.length,l=Oc(0,s),f=Oc(s+1,s+1+c),p=Ic([o,[a],u]),h=e.reshape(p),d=i.reshape([a]),m=Ic([[s],l,f]),g=h.transpose(m),v=Rc(g,d,r.shape[n]),y=wn(m);return v.transpose(y)},indices:function(){return i}}}),"Gather",{axis:n}).reshape(a.outputShape)}}),Rc=Nn({unsortedSegmentSum_:function(e,t,n){var r=hn(e,"x","unsortedSegmentSum"),i=hn(t,"segmentIds","unsortedSegmentSum","int32");return N(T(n),(function(){return"numSegments must be of dtype int"})),ze.runKernelFunc((function(e,t){var a=e.unsortedSegmentSum(r,i,n);return t([i]),a}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=bi(t,$n(t)),r=Fc(e,n),i=Cc(t,Tn(0,"int32")),a=r.rank-i.rank,o=0;o<a;++o)i=ir(i,o+1);i=Vu(i,Ln(r.shape,"bool"));var s=$n(r);return Ku(i,r,s)}(e,n)}}}))}}),Bc=function(e,t,n){return a(this,void 0,void 0,(function(){var r,i,a,s,u,c,l,f,p,h,d,m,g;return o(this,(function(o){switch(o.label){case 0:for(r=hn(e,"tensor","boolMask"),i=hn(t,"mask","boolMask","bool"),a=null==n?0:n,s=i.rank,u=r.shape,N(s>0,(function(){return"mask cannot be scalar"})),A(u.slice(a,a+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=a;l<a+s;l++)c*=u[l];return f=u.slice(0,a).concat([c],u.slice(a+s)),p=r.reshape(f),h=i.reshape([-1]),[4,Xu(h)];case 1:return d=o.sent(),m=d.squeeze([1]),g=Fc(p,m,a),e!==r&&r.dispose(),t!==i&&i.dispose(),m.dispose(),p.dispose(),h.dispose(),d.dispose(),[2,g]}}))}))};function zc(e,t,n,r,i,a,o){void 0===a&&(a="NHWC"),N(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),N(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),N(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),N(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===a?s[3]:s[1],f="NHWC"===a?u.shape[3]:u.shape[1];N(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),N(f===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."})),null!=o&&N(T(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var p=ya(a),h=ca(s,n.shape,r,1,i,o,!1,p),d=ze.runKernelFunc((function(e,t){var r=e.conv2dDerInput(u,n,h);return t([n,u]),r}),{dy4D:u,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return Uc(e,n,r,i,a,1,o)},filter:function(){return Wc(e,s,n.shape,r,i,a,o)}}}));return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Pc(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function Lc(e,t,n,r,i){N(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var a=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],c=o.shape[4];N(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),N(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),N(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),N(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),N(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=la(a,n.shape,r,1,i),f=ze.runKernelFunc((function(e){return e.conv3dDerInput(o,n,l)}),{dy5D:o});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var jc=Nn({conv1d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NWC"),void 0===a&&(a=1);var s=hn(e,"x","conv1d"),u=hn(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),N(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),N(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=o&&N(T(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),N(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),N(va(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),N("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),p=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Uc(p,f,[1,n],r,"NHWC",[1,a],o);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Uc=Nn({conv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=hn(e,"x","conv2d"),u=hn(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),N(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),N(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=o&&N(T(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f="NHWC"===i?c.shape[3]:c.shape[1];N(f===u.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."})),N(va(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var p=ya(i),h=ca(c.shape,u.shape,n,a,r,o,!1,p),d=[u,c],m=ze.runKernelFunc((function(e,t){var n=e.conv2d(c,u,h);return t([u,c]),n}),{x:c,filter:u},(function(e,t){var o=t,s=o[0],u=o[1];return N(ga(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return Vc(u.shape,e,s,n,r,i)},filter:function(){return Wc(u,e,s.shape,n,r,i)}}}),"Conv2D",h,d);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),qc=Nn({conv3d_:function(e,t,n,r,i,a){void 0===i&&(i="NDHWC"),void 0===a&&(a=[1,1,1]);var o=hn(e,"x","conv3d"),s=hn(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),N(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),N(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),N(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),N(function(e,t){return Pc(e)||Pc(t)}(n,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),N("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var l=la(u.shape,s.shape,n,a,r),f=ze.runKernelFunc((function(e,t){var n=e.conv3d(u,s,l);return t([u,s]),n}),{x:u,$filter:s},(function(e,t){N(Pc(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var i=t[0],o=t[1];return{x:function(){return Lc(i.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,i){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),N(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),N(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),N(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),N(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),N(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=la(a.shape,n,r,1,i);return ze.runKernelFunc((function(e){return e.conv3dDerFilter(a,o,s)}),{x5D:a,dy5D:o})}(i,e,o.shape,n,r)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Wc=Nn({conv2dDerFilter_:function(e,t,n,r,i,a,o){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),N(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),N(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),N(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===a?s.shape[3]:s.shape[1],l="NHWC"===a?u.shape[3]:u.shape[1];N(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),N(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=o&&N(T(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var f=ya(a),p=ca(s.shape,n,r,1,i,o,!1,f);return ze.runKernelFunc((function(e){return e.conv2dDerFilter(s,u,p)}),{x4D:s,dy4D:u})}}),Vc=Nn({conv2dDerInput_:zc}),$c=Nn({depthwiseConv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=hn(e,"x","depthwiseConv2d"),u=hn(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),N(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),N(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),N(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==a&&(a=[1,1]),N(va(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&N(T(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f=ca(c.shape,u.shape,n,a,r,o,!0),p=[c,u],h=ze.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(c,u,f);return t([c,u]),n}),{x:c,filter:u},(function(e,t){N(ga(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=t[0],r=t[1];return{x:function(){return Hc(n.shape,e,r,f)},filter:function(){return Gc(n,e,r.shape,f)}}}),"DepthwiseConv2dNative",f,p);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Hc=Nn({depthwiseConv2dDerInput_:function(e,t,n,r){var i=t,a=!1;3===t.rank&&(a=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=ze.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(i,n,r)}),{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),Gc=Nn({depthwiseConv2dDerFilter_:function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),ze.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}}),Kc=Nn({separableConv2d_:function(e,t,n,r,i,a,o){void 0===a&&(a=[1,1]),void 0===o&&(o="NHWC");var s=hn(e,"x","separableConv2d"),u=hn(t,"depthwiseFilter","separableConv2d"),c=hn(n,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");N(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),N(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),N(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),N(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),N(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var p=u.shape[2],h=u.shape[3];N(c.shape[2]===p*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*h+", but got "+c.shape[2]+"."}));var d=$c(l,u,r,i,o,a),m=Uc(d,c,1,"valid",o);return f?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Xc=Nn({conv2dTranspose_:function(e,t,n,r,i,a){return zc(n,hn(e,"x","conv2dTranspose"),hn(t,"filter","conv2dTranspose"),r,i,"NHWC",a)}}),Yc=Nn({conv3dTranspose_:function(e,t,n,r,i){return Lc(n,hn(e,"x","conv3dTranspose"),hn(t,"filter","conv3dTranspose"),r,i)}}),Jc=Nn({matMul_:function(e,t,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=hn(e,"a","matMul"),o=hn(t,"b","matMul");i=Me(a,o),a=i[0],o=i[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?o.shape[o.rank-1]:o.shape[o.rank-2],c=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?o.shape[o.rank-2]:o.shape[o.rank-1],f=a.shape.slice(0,-2),p=o.shape.slice(0,-2),h=_(f),d=_(p);N(a.rank>=2&&o.rank>=2&&a.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."})),N(M(f,p),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+p+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."})),N(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=a.shape.slice(0,-2).concat([c,l]),g=n?a.as3D(h,s,c):a.as3D(h,c,s),v=r?o.as3D(d,l,u):o.as3D(d,u,l),y={transposeA:n,transposeB:r};return ze.runKernelFunc((function(e,t){var i=e.batchMatMul(g,v,n,r);return t([g,v]),i}),{a:g,b:v},(function(e,t){var i=t,a=i[0],o=i[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}}),"BatchMatMul",y).reshape(m)}}),Zc=Nn({dot_:function(e,t){var n=hn(e,"t1","dot"),r=hn(t,"t2","dot");N(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return N(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Qc=Nn({outerProduct_:function(e,t){var n=hn(e,"v1","outerProduct"),r=hn(t,"v2","outerProduct");return N(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),el=Nn({reverse_:function(e,t){var n=hn(e,"x","reverse");if(0===n.rank)return n.clone();var r=z(t,n.shape);return ze.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),tl=Nn({reverse1d_:function(e){var t=hn(e,"x","reverse");return N(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),el(t,0)}}),nl=Nn({reverse2d_:function(e,t){var n=hn(e,"x","reverse");return N(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),el(n,t)}}),rl=Nn({reverse3d_:function(e,t){var n=hn(e,"x","reverse");return N(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),el(n,t)}}),il=Nn({reverse4d_:function(e,t){var n=hn(e,"x","reverse");return N(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),el(n,t)}});function al(e,t,n,r,i,a){var o=hn(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),N(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),N(va(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&N(T(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=sa(s.shape,t,n,r,i,a);if(1===c.filterWidth&&1===c.filterHeight&&M(c.inShape,c.outShape))return o.clone();var l=[s],f=ze.runKernelFunc((function(e,t){var n=e.maxPool(s,c);return t([s,n]),n}),{x:s},(function(e,a){var o=a[0],s=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=hn(e,"dy","maxPoolBackprop"),c=hn(t,"input","maxPoolBackprop"),l=hn(n,"output","maxPoolBackprop");N(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==a&&(a=[1,1]),N(va(i,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),N(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),N(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var f=sa(c.shape,r,i,a,o,void 0);return ze.runKernelFunc((function(e){return e.maxPoolBackprop(u,c,l,f)}),{$dy:u,$input:c})}(e,o,s,t,n,r,i)}}}),"MaxPool",c,l);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function ol(e,t,n,r,i,a){var o=hn(e,"x","avgPool","float32");null==r&&(r=[1,1]),N(va(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),N(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&N(T(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=sa(s.shape,t,n,r,i,a);if(1===c.filterWidth&&1===c.filterHeight&&M(c.inShape,c.outShape))return o.clone();var l=ze.runKernelFunc((function(e){return e.avgPool(s,c)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,i,a){var o=hn(e,"dy","avgPoolBackprop"),s=hn(t,"input","avgPoolBackprop");N(s.rank===o.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"})),null==i&&(i=[1,1]),N(va(r,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}));var u=s,c=o,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),N(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),N(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var f=sa(u.shape,n,r,i,a),p=ze.runKernelFunc((function(e){return e.avgPoolBackprop(c,u,f)}),{dy4D:c,input4D:u});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}(e,s,t,n,r,i)}}}),"AvgPool",c);return l=l.cast(o.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var sl=Nn({maxPool_:function(e,t,n,r,i){return al(e,t,n,1,r,i)}}),ul=Nn({avgPool_:function(e,t,n,r,i){return ol(e,t,n,1,r,i)}}),cl=Nn({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");var o=hn(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),N(va(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var c,l=sa(s.shape,t,a,i,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),i=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],i[t]]}))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var p=1===f[0]&&1===f[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),i=n.map((function(e){return e[1]})),a=e.concat(r,i),o=t.map((function(e,t){return(e-a[t]%e)%e})),s=i.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],f,c),d=h[0],m=h[1],g=p?r:"valid",v=p?s:or(s,f,d),y=("avg"===n?function(){return ol(v,t,a,1,g)}:function(){return al(v,t,a,1,g)})(),b=p?y:er(y,f,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),ll=Nn({maxPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=hn(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),N(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),N("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),N(va(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&N(T(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=ua(u.shape,t,n,o,r,i,a),f=ze.runKernelFunc((function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n}),{x:u},(function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=hn(e,"dy","maxPool3dBackprop"),c=hn(t,"input","maxPool3dBackprop"),l=hn(n,"output","maxPool3dBackprop"),f=u,p=c,h=l,d=!1;4===c.rank&&(d=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),p=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),N(5===f.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."})),N(5===p.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+p.rank+"."})),N(5===h.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."})),null==a&&(a=[1,1,1]),N(va(i,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),null!=s&&N(T(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var m=ua(p.shape,r,i,a,o,s),g=ze.runKernelFunc((function(e){return e.maxPool3dBackprop(f,p,h,m)}),{dy5D:f,input5D:p});return d?g.as4D(g.shape[1],g.shape[2],g.shape[3],g.shape[4]):g}(e,s,u,t,n,o,r,i)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),fl=Nn({avgPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=hn(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),N(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),N("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),N(va(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&N(T(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=ua(u.shape,t,n,o,r,i,a),f=ze.runKernelFunc((function(e){return e.avgPool3d(u,l)}),{x:u},(function(e){return{x:function(){return function(e,t,n,r,i,a,o){var s=hn(e,"dy","avgPool3dBackprop"),u=hn(t,"input","avgPool3dBackprop"),c=s,l=u,f=!1;4===u.rank&&(f=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),N(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),N(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==i&&(i=[1,1,1]),N(va(r,i),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"})),null!=o&&N(T(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var p=ua(l.shape,n,r,i,a,o),h=ze.runKernelFunc((function(e){return e.avgPool3dBackprop(c,l,p)}),{dy5D:c,input5D:l});return f?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(e,u,t,n,o,r,i)}}}));return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),pl=Nn({maxPoolWithArgmax_:function(e,t,n,r,i){void 0===i&&(i=!1);var a=hn(e,"x","maxPoolWithArgmax"),o={filterSize:t,strides:n,pad:r,includeBatchInIndex:i},s=ze.runKernel("MaxPoolWithArgmax",{x:a},o);return{result:s[0],indexes:s[1]}}}),hl=Nn({slice_:function(e,t,n){var r,i,a=hn(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach((function(e){N(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(N(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),a.shape[t]-r[t])})),ji(a,r,i);var o=a.shape,s={begin:r,size:i};return ze.runKernelFunc((function(e){return e.slice(a,r,i)}),{x:a},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-i[n]]);return{x:function(){return tc(e,t)}}}),"Slice",s)}}),dl=Nn({slice1d_:function(e,t,n){var r=hn(e,"x","slice1d");return N(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),hl(r,[t],[n])}}),ml=Nn({slice2d_:function(e,t,n){var r=hn(e,"x","slice2d");return N(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),hl(r,t,n)}}),gl=Nn({slice3d_:function(e,t,n){var r=hn(e,"x","slice3d");return N(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),hl(r,t,n)}}),vl=Nn({slice4d_:function(e,t,n){var r=hn(e,"x","slice4d");return N(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),hl(r,t,n)}});function yl(e,t,n,r,i){return t.rank<n.rank&&(t=t.reshape(yn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(yn(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==i?r:r.transpose(i)}}}var bl=Nn({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=hn(e,"x","all","bool"),i=z(t,r.shape),a=i,o=xn(a,r.rank);null!=o&&(r=r.transpose(o),a=En(a.length,r.rank));var s=ze.runKernelFunc((function(e){return e.all(r,a)}),{$x:r});if(n){var u=yn(s.shape,i);return s.reshape(u)}return s}}),xl=Nn({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=hn(e,"x","any","bool"),i=z(t,r.shape),a=i,o=xn(a,r.rank);null!=o&&(r=r.transpose(o),a=En(a.length,r.rank));var s=ze.runKernelFunc((function(e){return e.any(r,a)}),{$x:r});if(n){var u=yn(s.shape,i);return s.reshape(u)}return s}}),wl=Nn({argMax_:function(e,t){void 0===t&&(t=0);var n=hn(e,"x","argMax");null==t&&(t=0);var r=z(t,n.shape),i=xn(r,n.rank);null!=i&&(n=n.transpose(i),r=En(r.length,n.rank));var a={axis:r[0]},o=[n];return ze.runKernelFunc((function(e,t){var i=e.argMax(n,r[0]);return t([n]),i}),{x:n},(function(e,t){var n=t[0];return{x:function(){return $n(n)}}}),"ArgMax",a,o)}}),El=Nn({argMin_:function(e,t){void 0===t&&(t=0);var n=hn(e,"x","argMin");null==t&&(t=0);var r=z(t,n.shape),i=xn(r,n.rank);return null!=i&&(n=n.transpose(i),r=En(r.length,n.rank)),ze.runKernelFunc((function(e,t){var i=e.argMin(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return $n(n)}}}))}}),Cl=Nn({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=hn(e,"x","logSumExp"),i=z(t,r.shape),a=r.max(i,!0),o=r.sub(a).exp().sum(i).log(),s=a.reshape(o.shape).add(o);if(n){var u=yn(s.shape,i);return s.reshape(u)}return s}}),Sl=Nn({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=hn(e,"x","max"),i=r,a=z(t,r.shape),o=a,s=xn(o,r.rank);null!=s&&(r=r.transpose(s),o=En(o.length,r.rank));var u=[r],c=ze.runKernelFunc((function(e,t){var n=e.max(r,o);return t([i,n]),n}),{x:r},(function(e,t){return yl(e,t[1],t[0],a,s)}),"Max",{axes:o},u,[!0]);if(n){var l=yn(c.shape,a);c=c.reshape(l)}return c}}),Nl=Nn({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=hn(e,"x","mean"),i=z(t,r.shape),a=_(vn(r.shape,i)[1]);return Qi((function(e){var r=Tn(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(Ln(e.shape,"float32")).div(a)}}}))(r)}}),Al=Nn({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=hn(e,"x","min"),i=r,a=z(t,r.shape),o=a,s=xn(o,r.rank);null!=s&&(r=r.transpose(s),o=En(o.length,r.rank));var u=[r],c=ze.runKernelFunc((function(e,t){var n=e.min(r,o);return t([i,n]),n}),{x:r},(function(e,t){return yl(e,t[1],t[0],a,s)}),"Min",{axes:o},u,[!0]);if(n){var l=yn(c.shape,a);c=c.reshape(l)}return c}}),kl=Nn({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=z(t,(e=hn(e,"x","moments")).shape),i=e.mean(r,n),a=i.shape;n||(a=yn(i.shape,r));var o=e.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:o.mean(r,n)}}}),Dl=Nn({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=hn(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=z(t,r.shape);return Qi((function(e){var t=xn(i,e.rank),r=i,a=e;null!=t&&(a=e.transpose(t),r=En(r.length,e.rank));var o=function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(Ln(e.shape,"float32"))},s={axes:r},u=ze.runKernelFunc((function(e){return e.sum(a,r)}),{x:a},(function(e){return{x:function(){return o(e)}}}),"Sum",s);if(n){var c=yn(u.shape,i);u=u.reshape(c)}return{value:u,gradFunc:o}}))(r)}}),_l=Nn({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=hn(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=z(t,r.shape),a=xn(i,r.rank),o=i,s=r;null!=a&&(s=r.transpose(a),o=En(o.length,r.rank));var u=ze.runKernelFunc((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var c=yn(u.shape,i);u=u.reshape(c)}return u}}),Ml=Nn({elu_:function(e){var t=hn(e,"x","elu");return ze.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return ze.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),Tl=Nn({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=hn(e,"x","leakyRelu");return bi(Tn(t).mul(n),n)}}),Ol=Nn({prelu_:function(e,t){var n=hn(e,"x","prelu"),r=hn(t,"alpha","prelu");return ze.runKernelFunc((function(e,t){var i=e.prelu(n,r);return t([n,r]),i}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],i=n.greater(0);return{x:function(){return Ku(i,e,e.mul(r))},alpha:function(){var t=Ku(i,$n(e),e.mul(n)),a=Ir(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}}),"Prelu")}}),Il=Nn({relu_:function(e){var t=hn(e,"x","relu");return"bool"===t.dtype?t.toInt():ze.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),Fl=Nn({relu6_:function(e){var t=hn(e,"x","relu6");return"bool"===t.dtype?t.toInt():ze.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),Rl=Nn({selu_:function(e){var t=hn(e,"x","selu");return ze.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(Tn(0)),r=Tn(1.7580993408473768),i=Tn(1.0507009873554805),a=e.mul(i),o=e.mul(r).mul(n.toFloat().exp());return Ku(t,a,o)}}}))}}),Bl=Nn({localResponseNormalization_:function(e,t,n,r,i){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var a=hn(e,"x","localResponseNormalization");N(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),N(T(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=a,s=!1;3===a.rank&&(s=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=ze.runKernelFunc((function(e,a){var s=e.localResponseNormalization4D(o,t,n,r,i);return a([o,s]),s}),{x4D:o},(function(e,a){var o=a[0],s=a[1];return{x4D:function(){return ze.runKernelFunc((function(a){return a.LRNGrad(e,o,s,t,n,r,i)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),zl=Nn({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(Tn(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=hn(e,"x","norm"),t,n),a=i.shape;if(r){var o=z(n,e.shape);a=yn(i.shape,o)}return i.reshape(a)}}),Pl=Nn({basicLSTMCell_:function(e,t,n,r,i,a){var o=hn(e,"forgetBias","basicLSTMCell"),s=hn(t,"lstmKernel","basicLSTMCell"),u=hn(n,"lstmBias","basicLSTMCell"),c=hn(r,"data","basicLSTMCell"),l=hn(i,"c","basicLSTMCell"),f=hn(a,"h","basicLSTMCell"),p=c.concat(f,1).matMul(s).add(u),h=p.shape[0],d=p.shape[1]/4,m=[h,d],g=p.slice([0,0],m),v=p.slice([0,d],m),y=p.slice([0,2*d],m),b=p.slice([0,3*d],m),x=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(o.add(y).sigmoid())),w=x.tanh().mulStrict(b.sigmoid());return[x,w]}}),Ll=Nn({multiRNNCell_:function(e,t,n,r){for(var i=hn(t,"data","multiRNNCell"),a=dn(n,"c","multiRNNCell"),o=dn(r,"h","multiRNNCell"),s=i,u=[],c=0;c<e.length;c++){var l=e[c](s,a[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],p=[];for(c=0;c<u.length;c+=2)f.push(u[c]),p.push(u[c+1]);return[f,p]}}),jl=Nn({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var a=hn(e,"v","movingAverage"),o=hn(t,"x","movingAverage"),s=hn(n,"decay","movingAverage");Te(a,o),N(M(a.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Tn(1),c=u.sub(s),l=o.sub(a).mul(c);if(i){N(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var f=hn(r,"step","movingAverage");l=l.div(u.sub(ki(s,f)))}return a.add(l)}}),Ul=Nn({stridedSlice_:function(e,t,n,r,i,a,o,s,u){if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var c=hn(e,"x","stridedSlice"),l=Ui(s),f=c.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,f.splice(e,0,1)})),c=c.reshape(f);for(var p=0;p<c.rank;p++)t[p]=Wi(i,t,r,c.shape,p),n[p]=Vi(a,n,r,c.shape,p),r[p]=r[p]||1;var h=Ui(u);h.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var d=qi(t,n,r),m=d.filter((function(e,t){return-1===h.indexOf(t)}));return r.every((function(e){return 1===e}))?hl(c,t,d).reshape(m):ze.runKernelFunc((function(e){return e.stridedSlice(c,t,n,r)}),{$x:c}).reshape(m)}}),ql=Nn({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=hn(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var a=ze.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),Wl=Nn({scatterND_:function(e,t,n){var r=hn(e,"indices","scatterND","int32"),i=hn(t,"updates","scatterND");return zi(i,r,n),ze.runKernelFunc((function(e){return e.scatterND(r,i,n)}),{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),Vl=Nn({fft_:function(e){N("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return ze.runKernelFunc((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),$l=Nn({ifft_:function(e){N("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return ze.runKernelFunc((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),Hl=Nn({rfft_:function(e,t){N("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){var a=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(a,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(jn(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=An(n,u).as2D(i,r),l=Vl(c),f=Math.floor(r/2)+1,p=kn(l),h=Dn(l),d=p.split([f,r-f],p.shape.length-1),m=h.split([f,r-f],h.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=f,An(d[0],m[0]).reshape(g)}}),Gl=Nn({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),i=$l(r);return kn(i)}var a=[n,2*(t-1)],o=kn(e).as2D(n,t),s=Dn(e).as2D(n,t),u=o.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(Tn(-1)),l=o.concat(u,1),f=s.concat(c,1);return r=An(l,f).as2D(a[0],a[1]),i=$l(r),kn(i)}}),Kl=Object.freeze({fft:Vl,ifft:$l,rfft:Hl,irfft:Gl}),Xl=Nn({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var i=hn(e,"sparseIndices","sparseToDense","int32"),a=hn(t,"sparseValues","sparseToDense"),o=hn(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),ze.runKernelFunc((function(e){return e.sparseToDense(i,a,n,o)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),Yl=Nn({gatherND_:function(e,t){var n=hn(t,"indices","gatherND","int32"),r=hn(e,"x","gatherND");return ze.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),Jl=Nn({diag_:function(e){var t=hn(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return ze.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),Zl=Nn({dropout_:function(e,t,n,r){var i=hn(e,"x","dropout");if(N("float32"===i.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),N(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof xe?i.clone():i;var a=function(e,t){if(null==t)return e.shape.slice();if(M(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(i,n),o=1-t,s=gc(a,0,1,"float32",r).add(o).floor().div(o);return i.mul(s)}});function Ql(e,t,n){for(var r=1-e%2,i=new Float32Array(e),a=0;a<e;++a){var o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return On(i,"float32")}var ef,tf=Nn({hannWindow_:function(e){return Ql(e,.5,.5)}}),nf=Nn({hammingWindow_:function(e){return Ql(e,.54,.46)}}),rf=Nn({frame_:function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var a=0,o=[];a+t<=e.size;)o.push(hl(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=Hn([hl(e,a,t-s),Un([s],i)]);o.push(u),a+=n}return 0===o.length?In([],[0,t]):Hn(o).as2D(o.length,t)}}),af=Nn({stft_:function(e,t,n,r,i){var a;void 0===i&&(i=tf),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=rf(e,t,n),s=Ni(o,i(t)),u=[],c=0;c<o.shape[0];c++)u.push(Hl(s.slice([c,0],[1,t]),r));return Hn(u)}}),of=Object.freeze({hannWindow:tf,hammingWindow:nf,frame:rf,stft:af}),sf=function(e,t,n){return void 0===n&&(n=1),a(this,void 0,void 0,(function(){var r,i,a,s,u,c,l,f,p,h,d,m,g,v;return o(this,(function(o){switch(o.label){case 0:return r=hn(e,"predictions","inTopK"),i=hn(t,"targets","inTopK"),N(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),N(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),A(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],N(n>0&&n<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n})),[4,r.data()];case 1:return s=o.sent(),[4,i.data()];case 2:for(u=o.sent(),c=[s.length/a,a],f=c[1],p=L("bool",l=c[0]),h=0;h<l;h++){for(d=h*f,m=s.subarray(d,d+f),g=[],v=0;v<m.length;v++)g.push({value:m[v],index:v});for(g.sort((function(e,t){return t.value-e.value})),p[h]=0,v=0;v<n;v++)if(g[v].index===u[h]){p[h]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),[2,_n(p,i.shape,"bool")]}}))}))};!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(ef||(ef={}));var uf=Nn({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=ef.SUM_BY_NONZERO_WEIGHTS);var i=hn(e,"labels","absoluteDifference"),a=hn(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=hn(n,"weights","absoluteDifference")),A(i.shape,a.shape,"Error in absoluteDifference: ");var s=i.sub(a).abs();return cf(s,o,r)}}),cf=Nn({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=ef.SUM_BY_NONZERO_WEIGHTS);var r=hn(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=hn(t,"weights","computeWeightedLoss"));var a=null==i?r:r.mul(i);if(n===ef.NONE)return a;if(n===ef.SUM)return a.sum();if(n===ef.MEAN){if(null==i)return a.mean();var o=r.size/i.size,s=a.sum().div(i.sum());return o>1?s.div(Tn(o)):s}if(n===ef.SUM_BY_NONZERO_WEIGHTS){if(null==i)return a.sum().div(Tn(r.size));var u=i.mul(Ln(r.shape)).notEqual(Tn(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),lf=Nn({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=ef.SUM_BY_NONZERO_WEIGHTS);var a=hn(e,"labels","cosineDistance"),o=hn(t,"predictions","cosineDistance"),s=null;null!=r&&(s=hn(r,"weights","cosineDistance")),A(a.shape,o.shape,"Error in cosineDistance: ");var u=Tn(1).sub(a.mul(o).sum(n,!0));return cf(u,s,i)}}),ff=Nn({hingeLoss_:function(e,t,n,r){void 0===r&&(r=ef.SUM_BY_NONZERO_WEIGHTS);var i=hn(e,"labels","hingeLoss"),a=hn(t,"predictions","hingeLoss"),o=null;null!=n&&(o=hn(n,"weights","hingeLoss")),A(i.shape,a.shape,"Error in hingeLoss: ");var s=Tn(1);i=Tn(2).mul(i).sub(s);var u=s.sub(i.mul(a)).relu();return cf(u,o,r)}}),pf=Nn({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=ef.SUM_BY_NONZERO_WEIGHTS);var a=hn(e,"labels","huberLoss"),o=hn(t,"predictions","huberLoss"),s=null;null!=n&&(s=hn(n,"weights","huberLoss")),A(a.shape,o.shape,"Error in huberLoss: ");var u=Tn(r),c=o.sub(a).abs(),l=wi(c,u),f=c.sub(l),p=Tn(.5).mul(l.square()).add(u.mul(f));return cf(p,s,i)}}),hf=Nn({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=ef.SUM_BY_NONZERO_WEIGHTS);var a=hn(e,"labels","logLoss"),o=hn(t,"predictions","logLoss"),s=null;null!=n&&(s=hn(n,"weights","logLoss")),A(a.shape,o.shape,"Error in logLoss: ");var u=Tn(1),c=Tn(r),l=a.mul(o.add(c).log()).neg().sub(u.sub(a).mul(u.sub(o).add(c).log()));return cf(l,s,i)}}),df=Nn({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=ef.SUM_BY_NONZERO_WEIGHTS);var i=hn(e,"labels","meanSquaredError"),a=hn(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=hn(n,"weights","meanSquaredError")),A(i.shape,a.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(a);return cf(s,o,r)}}),mf=Nn({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=ef.SUM_BY_NONZERO_WEIGHTS);var a=hn(e,"multiClassLabels","sigmoidCrossEntropy"),o=hn(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=hn(n,"weights","sigmoidCrossEntropy")),A(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Tn(r),c=Tn(1),l=Tn(.5);a=a.mul(c.sub(u)).add(l.mul(u))}var f=function(e,t){var n=hn(e,"labels","sigmoidCrossEntropyWithLogits"),r=hn(t,"logits","sigmoidCrossEntropyWithLogits");A(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),a=r.mul(n),o=r.abs().neg().exp().log1p();return i.sub(a).add(o)}(a,o);return cf(f,s,i)}}),gf=Nn({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=ef.SUM_BY_NONZERO_WEIGHTS);var a=hn(e,"onehotLabels","softmaxCrossEntropy"),o=hn(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=hn(n,"weights","softmaxCrossEntropy")),A(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Tn(r),c=Tn(1),l=Tn(a.shape[1]);a=a.mul(c.sub(u)).add(u.div(l))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return Qi((function(e,t,r){var i=t.logSumExp([n],!0),a=t.toFloat().sub(i);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],i=t[1],a=yn(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(i.exp())),e.reshape(a).mul(i.exp().sub(r.toFloat()))]}}}))(e,t)}(a,o);return cf(f,s,i)}}),vf=Object.freeze({get Reduction(){return ef},absoluteDifference:uf,computeWeightedLoss:cf,cosineDistance:lf,hingeLoss:ff,huberLoss:pf,logLoss:hf,meanSquaredError:df,sigmoidCrossEntropy:mf,softmaxCrossEntropy:gf});function yf(e,t){return void 0===t&&(t=!1),ze.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],i=Zu(n),a=e.clone(),o=In([[1]],[1,1]),s=o.clone(),u=n>=r?r:n,c=function(e){var t,u=a,c=s,l=i;t=ze.tidy((function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),c=a.slice([e,e],[1,1]),l=In([[-1]]).where(c.greater(0),In([[1]])),f=c.sub(l.mul(u)),p=t.div(f);s=1===p.shape[0]?o.clone():o.concat(p.slice([1,0],[p.shape[0]-1,p.shape[1]]),0);var h=l.matMul(f).div(u).neg(),d=a.slice([e,0],[n-e,r]),m=h.mul(s),g=s.transpose();if(0===e)a=d.sub(m.matMul(g.matMul(d)));else{var v=d.sub(m.matMul(g.matMul(d)));a=a.slice([0,0],[e,r]).concat(v,0)}var y=m.transpose(),b=i.slice([0,e],[n,i.shape[1]-e]);if(0===e)i=b.sub(b.matMul(s).matMul(y));else{var x=b.sub(b.matMul(s).matMul(y));i=i.slice([0,0],[n,e]).concat(x,1)}return[s,a,i]})),s=t[0],a=t[1],i=t[2],Jt([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(i=i.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var bf=Nn({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=hn(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,a=r.shape.slice(-2),o=a[0],s=a[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var u=Wn(0,o,1,"int32").reshape([-1,1]),c=Wn(0,s,1,"int32"),l=Mi(u,c),f=Vu(l.lessEqual(Tn(+t,"int32")),l.greaterEqual(Tn(-n,"int32"))),p=jn([o,s],r.dtype);return ur(cr(r.reshape([-1,o,s])).map((function(e){return Ku(f,e,p)}))).reshape(i)}}),xf=Nn({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,N(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){N(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},i=1;i<e.length;++i)r(i)}else t=!0,e=Jn(e,e.shape[0],0).map((function(e){return sr(e,[0])}));N(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var a=[],o=e,s=function(e){a.push(ze.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Dl(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(zl(t,"euclidean"))})))};for(i=0;i<e.length;++i)s(i);return t?ur(a,0):a}}),wf=Nn({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return yf(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=cr(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];return r.forEach((function(e){var n=yf(e,t),r=n[0],o=n[1];i.push(r),a.push(o)})),[ur(i,0).reshape(e.shape),ur(a,0).reshape(e.shape)]}}),Ef=Object.freeze({bandPart:bf,gramSchmidt:xf,qr:wf});function Cf(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);var o=e.shape[0];return n=Math.min(n,o),N(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),N(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),N(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),N(1===t.rank,(function(){return"scores must be a 1D tensor"})),N(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]})),N(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}var Sf=Nn({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=hn(e,"images","resizeBilinear");N(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),N(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=ze.runKernelFunc((function(e,t){return t([i]),e.resizeBilinear(i,o,s,n)}),{x:i},(function(e,t){return{x:function(){return ze.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Nf=Nn({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=hn(e,"images","resizeNearestNeighbor");N(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),N(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),N("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=ze.runKernelFunc((function(e,t){return t([i]),e.resizeNearestNeighbor(i,o,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return ze.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Af=Nn({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var a=hn(e,"boxes","nonMaxSuppression"),o=hn(t,"scores","nonMaxSuppression"),s=Cf(a,o,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return ze.runKernelFunc((function(e){return e.nonMaxSuppression(a,o,n,r,i)}),{boxes:a,scores:o},null,"NonMaxSuppressionV3",u)}}),kf=Nn({nonMaxSuppressionWithScore_:function(e,t,n,r,i,a){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var o=hn(e,"boxes","nonMaxSuppression"),s=hn(t,"scores","nonMaxSuppression"),u=Cf(o,s,n,r,i,a),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},l=ze.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Df=Nn({cropAndResize_:function(e,t,n,r,i,a){var o=hn(e,"image","cropAndResize"),s=hn(t,"boxes","cropAndResize","float32"),u=hn(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var c=s.shape[0];return N(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),N(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),N(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),N(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),N(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),N("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),ze.runKernelFunc((function(e,t){return e.cropAndResize(o,s,u,r,i,a)}),{images:o,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:r})}}),_f=Object.freeze({resizeBilinear:Sf,resizeNearestNeighbor:Nf,nonMaxSuppression:Af,nonMaxSuppressionAsync:function(e,t,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),a(this,void 0,void 0,(function(){var a,s,u,c,l,f,p;return o(this,(function(o){switch(o.label){case 0:return a=hn(e,"boxes","nonMaxSuppressionAsync"),s=hn(t,"scores","nonMaxSuppressionAsync"),u=Cf(a,s,n,r,i),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,[4,Promise.all([a.data(),s.data()])];case 1:return c=o.sent(),l=c[0],f=c[1],p=_a(l,f,n,r,i),a!==e&&a.dispose(),s!==t&&s.dispose(),[2,p]}}))}))},nonMaxSuppressionWithScore:kf,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,i,s){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===s&&(s=0),a(this,void 0,void 0,(function(){var a,u,c,l,f,p,h;return o(this,(function(o){switch(o.label){case 0:return a=hn(e,"boxes","nonMaxSuppressionAsync"),u=hn(t,"scores","nonMaxSuppressionAsync"),c=Cf(a,u,n,r,i,s),n=c.maxOutputSize,r=c.iouThreshold,i=c.scoreThreshold,s=c.softNmsSigma,[4,Promise.all([a.data(),u.data()])];case 1:return l=o.sent(),f=l[0],p=l[1],h=Ma(f,p,n,r,i,s),a!==e&&a.dispose(),u!==t&&u.dispose(),[2,h]}}))}))},cropAndResize:Df}),Mf=function(e,t){return!(e>0)||"linear"===t},Tf=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Of=function(e,t){var n=t,r=Ir(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},If=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Il(e);if("elu"===t)return Ml(e);if("relu6"===t)return Fl(e);if("prelu"===t)return Ol(e,n);throw new Error("Unknown fused activation "+t+".")},Ff=Nn({fusedMatMul_:function(e){var t,n=e.a,r=e.b,i=e.transposeA,a=void 0!==i&&i,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,f=e.preluActivationWeights;if(!1===Mf(ze.state.gradientDepth,l)){var p=Jc(n,r,a,s);return null!=u&&(p=Tr(p,u)),If(p,l,f)}var h=hn(n,"a","fused matMul"),d=hn(r,"b","fused matMul");t=Me(h,d),h=t[0],d=t[1];var m=a?h.shape[h.rank-2]:h.shape[h.rank-1],g=s?d.shape[d.rank-1]:d.shape[d.rank-2],v=a?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?d.shape[d.rank-2]:d.shape[d.rank-1],b=h.shape.slice(0,-2),x=d.shape.slice(0,-2),w=_(b),E=_(x);N(h.rank>=2&&d.rank>=2&&h.rank===d.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+d.rank+"."})),N(M(b,x),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+h.shape+" and "+d.shape+" must match."})),N(m===g,(function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+h.shape+" and "+d.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var C,S,A=h.shape.slice(0,-2).concat([v,y]),k=a?h.as3D(w,m,v):h.as3D(w,v,m),D=s?d.as3D(E,y,g):d.as3D(E,g,y);null!=u&&Fr(A,(C=Me(C=hn(u,"bias","fused matMul"),h)[0]).shape),null!=f&&(S=hn(f,"prelu weights","fused matMul"));var T={a:k,b:D};null!=u&&(T.bias=C),null!=f&&(T.preluActivationWeights=S);var O=[k,D];return ze.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:k,b:D,transposeA:a,transposeB:s,bias:C,activation:l,preluActivationWeights:S});return t([k,D,n]),n}),T,(function(e,t){var n=t[0],r=t[1],i=t[2],o=Tf(e,i,l),c={};return null!=u&&(c={bias:function(){return Of(C,o)}}),a||s?!a&&s?Object.assign({a:function(){return o.matMul(r,!1,!1)},b:function(){return o.matMul(n,!0,!1)}},c):a&&!s?Object.assign({a:function(){return r.matMul(o,!1,!0)},b:function(){return n.matMul(o,!1,!1)}},c):Object.assign({a:function(){return r.matMul(o,!0,!0)},b:function(){return o.matMul(n,!0,!0)}},c):Object.assign({a:function(){return o.matMul(r,!1,!0)},b:function(){return n.matMul(o,!0,!1)}},c)}),"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},O,[!0]).reshape(A)}}),Rf=Nn({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,p=void 0===f?"linear":f,h=e.preluActivationWeights;if(p=p||"linear",!1===Mf(ze.state.gradientDepth,p)){var d=Uc(t,n,r,i,o,u,c);return null!=l&&(d=Tr(d,l)),If(d,p,h)}var m=hn(t,"x","conv2d"),g=hn(n,"filter","conv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),N(4===v.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."})),N(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."})),null!=c&&N(T(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."})),N(v.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."})),N(va(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),N("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var b,x,w=ca(v.shape,g.shape,r,u,i,c);null!=l&&(b=Me(b=hn(l,"bias","fused conv2d"),m)[0],Fr(w.outShape,b.shape)),null!=h&&(x=hn(h,"prelu weights","fused conv2d"));var E={x:v,filter:g};null!=l&&(E.bias=b),null!=h&&(E.preluActivationWeights=x);var C=[g,v],S=ze.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:v,filter:g,convInfo:w,bias:b,activation:p,preluActivationWeights:x});return t([g,v,n]),n}),E,(function(e,t){var n=t,a=n[0],o=n[1],s=n[2],c=Tf(e,s,p);N(ga(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var f={};return null!=l&&(f={bias:function(){return Of(b,c)}}),Object.assign({x:function(){return Vc(o.shape,c,a,r,i)},filter:function(){return Wc(o,c,a.shape,r,i)}},f)}),"FusedConv2D",{convInfo:w,activation:p},C,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),Bf=Nn({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,p=void 0===f?"linear":f,h=e.preluActivationWeights;if(!1===Mf(ze.state.gradientDepth,p)){var d=$c(t,n,r,i,o,u,c);return null!=l&&(d=Tr(d,l)),If(d,p,h)}var m=hn(t,"x","depthwiseConv2d"),g=hn(n,"filter","depthwiseConv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),N(4===v.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."})),N(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."})),N(v.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."})),null==u&&(u=[1,1]),N(va(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&N(T(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."}));var b,x,w=ca(v.shape,g.shape,r,u,i,c,!0);null!=l&&(b=Me(b=hn(l,"bias","fused conv2d"),m)[0],Fr(w.outShape,b.shape)),null!=h&&(x=hn(h,"prelu weights","fused depthwiseConv2d"));var E={x:v,filter:g};null!=l&&(E.bias=b),null!=h&&(E.preluActivationWeights=x);var C=[g,v],S=ze.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:v,filter:g,convInfo:w,bias:b,activation:p,preluActivationWeights:x});return t([g,v,n]),n}),E,(function(e,t){N(ga(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=t[0],r=t[1],i=t[2],a=Tf(e,i,p),o={};return null!=l&&(o={bias:function(){return Of(b,a)}}),Object.assign({x:function(){return Hc(r.shape,a,n,w)},filter:function(){return Gc(r,a,n.shape,w)}},o)}),"FusedDepthwiseConv2D",{convInfo:w,activation:p},C,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),zf=Object.freeze({matMul:Ff,conv2d:Rf,depthwiseConv2d:Bf}),Pf=Object.freeze({image:_f,linalg:Ef,losses:vf,spectral:Kl,fused:zf,signal:of,add:Tr,addN:Au,batchNorm:Ou,batchNormalization:Tu,batchNorm2d:Ru,batchNormalization2d:Fu,batchNorm3d:Pu,batchNormalization3d:zu,batchNorm4d:Uu,batchNormalization4d:ju,broadcastTo:qu,clone:Wu,div:Oi,divNoNan:Yu,eye:Zu,multinomial:Qu,oneHot:ec,pad:tc,pad1d:nc,pad2d:rc,pad3d:ic,pad4d:ac,rand:oc,randomGamma:dc,randomNormal:mc,randomUniform:gc,square:vc,squaredDifference:yc,tile:Ju,truncatedNormal:bc,conv1d:jc,conv2d:Uc,conv3d:qc,depthwiseConv2d:$c,separableConv2d:Kc,conv2dTranspose:Xc,conv3dTranspose:Yc,op:Nn,booleanMaskAsync:Bc,complex:An,real:kn,imag:Dn,concat:Hn,concat1d:Gn,concat2d:Kn,concat3d:Xn,concat4d:Yn,split:Jn,matMul:Jc,dot:Zc,outerProduct:Qc,reverse:el,reverse1d:tl,reverse2d:nl,reverse3d:rl,reverse4d:il,maxPool:sl,avgPool:ul,pool:cl,maxPool3d:ll,avgPool3d:fl,maxPoolWithArgmax:pl,slice:hl,slice1d:dl,slice2d:ml,slice3d:gl,slice4d:vl,abs:Rr,acos:Br,acosh:zr,asin:Pr,asinh:Lr,atan:jr,atanh:Ur,ceil:qr,clipByValue:Wr,cos:Vr,cosh:$r,erf:Hr,exp:Gr,expm1:Kr,floor:Xr,log:Yr,log1p:Jr,logSigmoid:Zr,neg:Qr,reciprocal:ei,round:ti,rsqrt:ni,sigmoid:ri,sign:ii,isNaN:ai,isInf:oi,isFinite:si,sin:ui,sinh:ci,softplus:li,sqrt:fi,step:pi,tan:hi,tanh:di,all:bl,any:xl,argMax:wl,argMin:El,logSumExp:Cl,max:Sl,mean:Nl,min:Al,moments:kl,sum:Dl,prod:_l,equal:xc,equalStrict:wc,greater:Ec,greaterEqual:Cc,greaterEqualStrict:Sc,greaterStrict:Nc,less:Ac,lessEqual:kc,lessEqualStrict:Dc,lessStrict:_c,notEqual:Mc,notEqualStrict:Tc,addStrict:mi,atan2:gi,divStrict:vi,floorDiv:yi,maximum:bi,maximumStrict:xi,minimum:wi,minimumStrict:Ei,mod:Ci,modStrict:Si,mul:Ni,mulStrict:Ai,pow:ki,powStrict:Di,squaredDifferenceStrict:_i,sub:Mi,subStrict:Ti,elu:Ml,leakyRelu:Tl,prelu:Ol,relu:Il,relu6:Fl,selu:Rl,logicalAnd:Vu,logicalNot:$u,logicalOr:Hu,logicalXor:Gu,where:Ku,whereAsync:Xu,buffer:Zn,print:Qn,batchToSpaceND:er,cast:tr,cumsum:nr,depthToSpace:rr,expandDims:ir,reshape:ar,spaceToBatchND:or,squeeze:sr,stack:ur,unstack:cr,setdiff1dAsync:lr,fill:Un,linspace:qn,ones:Ln,range:Wn,scalar:Tn,tensor:_n,tensor1d:On,tensor2d:In,tensor3d:Fn,tensor4d:Rn,tensor5d:Bn,tensor6d:zn,variable:Pn,zeros:jn,onesLike:Vn,zerosLike:$n,transpose:ra,softmax:ta,logSoftmax:na,localResponseNormalization:Bl,norm:zl,gather:Fc,unsortedSegmentSum:Rc,basicLSTMCell:Pl,multiRNNCell:Ll,movingAverage:jl,stridedSlice:Ul,topk:ql,scatterND:Wl,fft:Vl,ifft:$l,rfft:Hl,irfft:Gl,sparseToDense:Xl,gatherND:Yl,diag:Jl,dropout:Zl,hannWindow:tf,hammingWindow:nf,frame:rf,stft:af,inTopKAsync:sf});function Lf(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&N("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function jf(e,t,n,r,i,a){for(var o=i.strideHeight,s=i.strideWidth,u=i.dilationHeight,c=i.dilationWidth,l=i.effectiveFilterHeight,f=i.effectiveFilterWidth,p=i.padInfo.top,h=i.padInfo.left,d="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Zn(i.outShape,n),g=m.values,v=i.outShape[1]*i.outShape[2]*i.outShape[3],y=i.outShape[2]*i.outShape[3],b=i.outShape[3],x=0;x<i.batchSize;++x)for(var w=x*v,E=x*r[0],C=0;C<i.inChannels;++C)for(var S=0;S<i.outHeight;++S)for(var N=S*o-p,A=Math.max(0,N),k=Math.min(i.inHeight,l+N),D=w+S*y,_=0;_<i.outWidth;++_){for(var M=_*s-h,T=Math.max(0,M),O=Math.min(i.inWidth,f+M),I=d,F=0,R=0,B=A;B<k;B+=u){for(var z=E+B*r[1],P=T;P<O;P+=c){var L=e[z+P*r[2]+C];"max"===a&&L>I?I=L:"avg"===a&&(F+=L,R++)}if(isNaN(I))break}g[D+_*b+C]="avg"===a?F/R:I}return m}function Uf(e,t,n,r,i,a){void 0===i&&(i=!1),void 0===a&&(a=!1);for(var o=Zn(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,h=r.padInfo.top,d=r.padInfo.left,m=Zn(t,n,e),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.outHeight;++y){for(var b=y*s-h,x=b;x<0;)x+=c;for(var w=Math.min(r.inHeight,f+b),E=0;E<r.outWidth;++E){for(var C=E*u-d,S=C;S<0;)S+=l;for(var N=Math.min(r.inWidth,p+C),A=Number.NEGATIVE_INFINITY,k=-1,D=x;D<w;D+=c)for(var _=D-b,M=S;M<N;M+=l){var T=M-C,O=m.get(g,D,M,v);O>A&&(A=O,k=i?a?((g*r.inHeight+D)*r.inWidth+M)*r.inChannels+v:(D*r.inWidth+M)*r.inChannels+v:_*p+T)}o.set(k,g,y,E,v)}}return o}function qf(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Wf=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new ia(t,ze),t}return i(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,c().get("IS_NODE")&&ln("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Ca(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return se(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Zn(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return ze.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t=ie(),e(),[2,{kernelMs:ie()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:ze.keep(e.clone()),imag:ze.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(Lf(e,"slice"),$i(e.shape,t,n)){var r=Hi(t,e.strides),i=_(n);return _n(this.readSync(e.dataId).subarray(r,r+i),n,e.dtype)}for(var a=Zn(n,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map((function(e,n){return e+t[n]}));a.values[s]=o.get.apply(o,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){Lf(e,"stridedSlice");var i=qi(t,n,r);if(i.some((function(e){return 0===e})))return _n([],i);for(var a=Zn(i,e.dtype),o=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];a.set.apply(a,[o.get.apply(o,c)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=Zn([e.size,e.size],e.dtype),r=n.values,i=0;i<t.length;i++)r[i*e.size+i]=t[i];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.reverse=function(e,t){Lf(e,"reverse");for(var n=Zn(e.shape,e.dtype),r=this.bufferSync(e),i=function(i){var a=n.indexToLoc(i),o=a.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,o)].concat(a))},a=0;a<n.size;a++)i(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return kn(e)})),i=e.map((function(e){return Dn(e)}));return An(this.concat(r,t),this.concat(i,t))}var a=e.map((function(e){var n=_(e.shape.slice(t));return e.as2D(-1,n)})),o=Sn(a.map((function(e){return e.shape})),1),s=Zn(o,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach((function(e){s.set(n.readSync(e.dataId),u),u+=e.size}))}else{var c=0;a.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,i=0;i<e.shape[0];++i)for(var a=i*o[1]+c,u=0;u<e.shape[1];++u)s[a+u]=t[r++];c+=e.shape[1]}))}var l=Sn(e.map((function(e){return e.shape})),t);return _n(s,l,e[0].dtype)},t.prototype.neg=function(e){return Lf(e,"neg"),this.multiply(Tn(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,De(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;Lf(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=Zn(e[0].shape,e[0].dtype),i=r.values,a=0;a<e.length;a++)for(var o=n[a],s=0;s<i.length;s++)i[s]+=o[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=z([t],e.shape),r=this.max(e,n),i=yn(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return Oi(o,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,De(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return Lf([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){Lf([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=l[0],p=l[1],h=l[2],d=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=d[0],g=d[1],v=d[2],y=a*o,b=Zn([s,a,o],e.dtype),x=b.values,w=this.blockSize,E=0;E<s;E++)for(var C=0;C<a;C+=w)for(var S=0;S<o;S+=w)for(var N=0;N<i;N+=w)for(var A=Math.min(C+w,a),k=Math.min(S+w,o),D=Math.min(N+w,i),_=C;_<A;_++)for(var M=S;M<k;M++){for(var T=0,O=N;O<D;O++)T+=u[E*f+_*p+O*h]*c[O*m+M*g+E*v];x[E*y+(_*o+M)]+=T}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,i);return a&&(u=this.add(u,a)),o&&(u=qf(this,u,o,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,De(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.floorDiv=function(e,t){return Lf([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){Lf(e,"sum"),bn("sum",t,e.rank);for(var n=vn(e.shape,t),r=n[0],i=n[1],a=jn(r,De(e.dtype,"int32")),o=_(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=0,p=0;p<o;++p)f+=u[l+p];s[c]=f}return a},t.prototype.prod=function(e,t){Lf(e,"sum");for(var n=vn(e.shape,t),r=n[0],i=n[1],a=jn(r,De(e.dtype,"int32")),o=_(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=1,p=0;p<o;++p)f*=u[l+p];s[c]=f}return a},t.prototype.unsortedSegmentSum=function(e,t,n){Lf(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,a=0;a<i;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var o=Tn(a,"int32"),s=xc(o,t).asType("float32").mul(e).sum(0);r.push(s)}return ur(r)},t.prototype.argMin=function(e,t){Lf(e,"argMin");var n=[t];bn("argMin",n,e.rank);for(var r=vn(e.shape,n),i=r[0],a=r[1],o=jn(i,"int32"),s=_(a),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,p=c[f],h=0,d=0;d<s;++d){var m=c[f+d];m<p&&(p=m,h=d)}u[l]=h}return o},t.prototype.argMax=function(e,t){Lf(e,"argMax");var n=[t];bn("argMax",n,e.rank);for(var r=vn(e.shape,n),i=r[0],a=r[1],o=jn(i,"int32"),s=_(a),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,p=c[f],h=0,d=0;d<s;++d){var m=c[f+d];m>p&&(p=m,h=d)}u[l]=h}return o},t.prototype.cumsum=function(e,t,n,r){if(Lf(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=De(e.dtype,"int32"),a=jn(e.shape,i),o=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var f=0;f<u;f++){var p=c(l,f);if(0===f)o[p]=n?0:s[p];else{var h=c(l,f-1);o[p]=n?s[h]+o[h]:s[p]+o[h]}}return a},t.prototype.equal=function(e,t){return Lf([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return Lf([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return Lf([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return Lf([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return Lf([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return Lf([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){Lf(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return Lf([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return Lf([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){Lf([e,t,n],"select");for(var r=this.readSync(e.dataId),i=this.readSync(t.dataId),a=this.readSync(n.dataId),o=jn(t.shape,De(t.dtype,n.dtype)),s=this.readSync(o.dataId),u=0,c=0===e.rank||e.rank>1||1===t.rank?1:_(t.shape.slice(1)),l=0;l<r.length;l++)for(var f=0;f<c;f++)1===r[l]?s[u++]=i[l]:s[u++]=a[l];return o},t.prototype.where=function(e){Lf([e],"where");var t=this.readSync(e.dataId);return Pa(e.shape,t)},t.prototype.topk=function(e,t,n){return Lf(e,"topk"),za(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Lf(e,"min"),bn("min",t,e.rank);for(var n=vn(e.shape,t),r=n[0],i=n[1],a=jn(r,e.dtype),o=_(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],p=0;p<o;++p){var h=u[l+p];h<f&&(f=h)}s[c]=f}return a},t.prototype.minimum=function(e,t){return Lf([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return Lf([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){Lf(e,"max"),bn("max",t,e.rank);for(var n=vn(e.shape,t),r=n[0],i=n[1],a=jn(r,e.dtype),o=_(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],p=0;p<o;++p){var h=u[l+p];h>f&&(f=h)}s[c]=f}return a},t.prototype.maximum=function(e,t){return Lf([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){Lf(e,"all"),bn("all",t,e.rank);for(var n=vn(e.shape,t),r=n[0],i=n[1],a=jn(r,e.dtype),o=_(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],p=0;p<o;++p){var h=u[l+p];f=f&&h}s[c]=f}return a},t.prototype.any=function(e,t){Lf(e,"any"),bn("any",t,e.rank);for(var n=vn(e.shape,t),r=n[0],i=n[1],a=jn(r,e.dtype),o=_(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],p=0;p<o;++p){var h=u[l+p];f=f||h}s[c]=f}return a},t.prototype.squaredDifference=function(e,t){return Lf([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){Lf(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){Lf(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){Lf(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){Lf(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){Lf(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){Lf(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){Lf(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);t[r]-i<.5?n[r]=Math.floor(t[r]):t[r]-i>.5?n[r]=Math.ceil(t[r]):n[r]=i%2==0?i:i+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){Lf(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){Lf(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){Lf(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){Lf(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log1p(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){Lf(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){Lf(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=1/Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){Lf(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Lf(e,"relu");for(var t=jn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},t.prototype.relu6=function(e){Lf(e,"relu");for(var t=jn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return t},t.prototype.prelu=function(e,t){return Lf([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){Lf(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){Lf([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId),a=0;a<r.length;++a){var o=r[a];n[a]=o>=1?i[a]:i[a]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){Lf(e,"selu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(t,e.shape,"float32")},t.prototype.clip=function(e,t,n){Lf(e,"clip");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var i=n[2*r],a=n[2*r+1];t[r]=Math.hypot(i,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){Lf(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){Lf(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){Lf(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a,o=r[i]>-t,s=r[i]<t,u=Math.exp(r[i]);a=s?u:o?r[i]:Math.log(1+u),n[i]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){Lf(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){Lf(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){Lf(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){Lf(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){Lf(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){Lf(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return Lf([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){Lf(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){Lf(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){Lf(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=O(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){Lf(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){Lf(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){Lf(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){Lf(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),a=Math.abs(n[r]),o=1/(1+.3275911*a);t[r]=i*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),Lf(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a=r[i];isNaN(a)?n[i]=NaN:n[i]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return i&&(s=this.add(s,i)),a&&(s=qf(this,s,a,o)),s},t.prototype.conv2d=function(e,t,n){Lf([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=Zn(n.outShape,e.dtype),f=e.strides[0],p=c?e.strides[1]:e.strides[2],h=c?e.strides[2]:1,d=c?1:e.strides[1],m=l.strides[0],g=c?l.strides[1]:l.strides[2],v=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),w=l.values,E=0;E<n.batchSize;++E)for(var C=E*f,S=E*m,N=0;N<n.outHeight;++N)for(var A=S+N*g,k=N*n.strideHeight-u,D=0;D<r;D++){var _=k+D*a;if(!(_<0||_>=n.inHeight))for(var M=D*t.strides[0],T=C+_*p,O=0;O<n.outWidth;++O)for(var I=A+O*v,F=O*n.strideWidth-s,R=0;R<i;R++){var B=F+R*o;if(!(B<0||B>=n.inWidth))for(var z=T+B*h,P=M+R*t.strides[1],L=0;L<n.inChannels;++L){for(var j=b[z+L*d],U=0;U<n.outChannels;++U)w[I+U*y]+=j*x[P+U];P+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,i=n.filterHeight,a=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,f=n.padInfo.top,p=Zn(n.outShape,e.dtype),h=this.readSync(e.dataId),d=this.readSync(t.dataId),m=p.values,g=0;g<n.batchSize;++g)for(var v=g*e.strides[0],y=g*p.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*p.strides[1],w=b*n.strideDepth-c,E=0;E<r;E++){var C=w+E*o;if(!(C<0||C>=n.inDepth))for(var S=E*t.strides[0],N=v+C*e.strides[1],A=0;A<n.outHeight;++A)for(var k=x+A*p.strides[2],D=A*n.strideHeight-f,_=0;_<i;_++){var M=D+_*s;if(!(M<0||M>=n.inHeight))for(var T=S+_*t.strides[1],O=N+M*e.strides[2],I=0;I<n.outWidth;++I)for(var F=k+I*n.outChannels,R=I*n.strideWidth-l,B=0;B<a;B++){var z=R+B*u;if(!(z<0||z>=n.inWidth))for(var P=T+B*t.strides[2],L=O+z*n.inChannels,j=P,U=0;U<n.inChannels;++U){for(var q=h[L+U],W=0;W<n.outChannels;++W)m[F+W]+=q*d[j+W];j+=n.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){Lf([e,t],"conv2dDerInput");for(var r=Zn(n.inShape,"float32"),i=r.values,a=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,u=s[0],c=s[1],l=s[2],f=n.batchSize,p=n.filterHeight,h=n.filterWidth,d=n.inChannels,m=n.inHeight,g=n.inWidth,v=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,E=n.dataFormat,C=p-1-n.padInfo.top,S=h-1-n.padInfo.left,N="channelsLast"===E,A=r.strides[0],k=N?r.strides[1]:r.strides[2],D=N?r.strides[2]:1,_=N?1:r.strides[1],M=e.strides[0],T=N?e.strides[1]:e.strides[2],O=N?e.strides[2]:1,I=N?1:e.strides[1],F=0;F<f;++F)for(var R=0;R<d;++R)for(var B=0;B<m;++B)for(var z=B-C,P=Math.max(0,Math.ceil(z/x)),L=Math.min(y,(p+z)/x),j=0;j<g;++j){for(var U=j-S,q=Math.max(0,Math.ceil(U/w)),W=Math.min(b,(h+U)/w),V=0,$=P;$<L;++$)for(var H=$*x-z,G=q;G<W;++G)for(var K=M*F+T*$+O*G,X=u*(p-1-H)+c*(h-1-(G*w-U))+l*R,Y=0;Y<v;++Y)V+=a[K+I*Y]*o[X+Y];i[A*F+k*B+D*j+_*R]=V}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=Zn(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],c=a[3],l=this.readSync(e.dataId),f=e.strides,p=f[0],h=f[1],d=f[2],m=f[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],x=v[2],w=v[3],E=n.batchSize,C=n.filterDepth,S=n.filterHeight,N=n.filterWidth,A=n.inChannels,k=n.inDepth,D=n.inHeight,_=n.inWidth,M=n.outChannels,T=n.outDepth,O=n.outHeight,I=n.outWidth,F=n.strideDepth,R=n.strideHeight,B=n.strideWidth,z=C-1-n.padInfo.front,P=S-1-n.padInfo.top,L=N-1-n.padInfo.left,j=0;j<E;++j)for(var U=0;U<A;++U)for(var q=0;q<k;++q)for(var W=q-z,V=Math.max(0,Math.ceil(W/F)),$=Math.min(T,(C+W)/F),H=0;H<D;++H)for(var G=H-P,K=Math.max(0,Math.ceil(G/R)),X=Math.min(O,(S+G)/R),Y=0;Y<_;++Y){for(var J=Y-L,Z=Math.max(0,Math.ceil(J/B)),Q=Math.min(I,(N+J)/B),ee=0,te=V;te<$;++te)for(var ne=te*F-W,re=K;re<X;++re)for(var ie=re*R-G,ae=Z;ae<Q;++ae)for(var oe=p*j+h*te+d*re+m*ae,se=y*(C-1-ne)+b*(S-1-ie)+x*(N-1-(ae*B-J))+w*U,ue=0;ue<M;++ue)ee+=l[oe+ue]*g[se+ue];i[o*j+s*q+u*H+c*Y+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){Lf([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,u=Zn(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,f=this.bufferSync(e),p=this.bufferSync(t),h=0;h<a;++h)for(var d=Math.max(0,Math.ceil((l-h)/r)),m=Math.min(n.outHeight,(n.inHeight+l-h)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((c-g)/i)),y=Math.min(n.outWidth,(n.inWidth+c-g)/i),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,E=0;E<n.batchSize;++E)for(var C=d;C<m;++C)for(var S=h+C*r-l,N=v;N<y;++N){var A=g+N*i-c;w+=s?f.get(E,S,A,b)*p.get(E,C,N,x):f.get(E,b,S,A)*p.get(E,x,C,N)}u.set(w,h,g,b,x)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=Zn(n.filterShape,"float32"),l=c.values,f=c.strides,p=f[0],h=f[1],d=f[2],m=f[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],x=v[2],w=v[3],E=this.readSync(e.dataId),C=e.strides,S=C[0],N=C[1],A=C[2],k=C[3],D=n.padInfo.front,_=n.padInfo.left,M=n.padInfo.top,T=0;T<o;++T)for(var O=Math.max(0,Math.ceil((D-T)/r)),I=Math.min(n.outDepth,(n.inDepth+D-T)/r),F=T*p,R=0;R<s;++R)for(var B=Math.max(0,Math.ceil((M-R)/i)),z=Math.min(n.outHeight,(n.inHeight+M-R)/i),P=R*h+F,L=0;L<u;++L)for(var j=Math.max(0,Math.ceil((_-L)/a)),U=Math.min(n.outWidth,(n.inWidth+_-L)/a),q=L*d+P,W=0;W<n.inChannels;++W)for(var V=W*m+q,$=0;$<n.outChannels;++$){for(var H=0,G=0;G<n.batchSize;++G)for(var K=G*S,X=G*y,Y=O;Y<I;++Y)for(var J=(T+Y*r-D)*N+K,Z=Y*b+X,Q=B;Q<z;++Q)for(var ee=(R+Q*i-M)*A+J,te=Q*x+Z,ne=j;ne<U;++ne){var re=ne*w+te;H+=E[(L+ne*a-_)*k+ee+W]*g[re+$]}l[V+$]=H}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return i&&(s=this.add(s,i)),a&&(s=qf(this,s,a,o)),s},t.prototype.depthwiseConv2D=function(e,t,n){Lf([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=Zn(n.outShape,e.dtype),f=this.readSync(e.dataId),p=this.readSync(t.dataId),h=l.values,d=0;d<n.batchSize;++d)for(var m=d*e.strides[0],g=d*l.strides[0],v=0;v<n.outHeight;++v)for(var y=g+v*l.strides[1],b=v*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var E=x*t.strides[0],C=m+w*e.strides[1],S=0;S<n.outWidth;++S)for(var N=y+S*l.strides[2],A=S*n.strideWidth-u,k=0;k<i;++k){var D=A+k*o;if(!(D<0||D>=n.inWidth))for(var _=E+k*t.strides[1],M=C+D*n.inChannels,T=N,O=_,I=0;I<n.inChannels;++I){for(var F=f[M+I],R=0;R<c;++R)h[T+R]+=F*p[O+R];T+=c,O+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){Lf([e,t],"depthwiseConv2DDerInput");for(var r=Zn(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],c=this.readSync(e.dataId),l=e.strides,f=l[0],p=l[1],h=l[2],d=this.readSync(t.dataId),m=t.strides,g=m[0],v=m[1],y=m[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,E=n.inChannels,C=n.inHeight,S=n.inWidth,N=n.outChannels,A=n.outHeight,k=n.outWidth,D=n.strideHeight,_=n.strideWidth,M=x-1-n.padInfo.top,T=w-1-n.padInfo.left,O=N/E,I=0;I<b;++I)for(var F=0;F<E;++F)for(var R=0;R<C;++R)for(var B=R-M,z=Math.max(0,Math.ceil(B/D)),P=Math.min(A,(x+B)/D),L=0;L<S;++L){for(var j=L-T,U=Math.max(0,Math.ceil(j/_)),q=Math.min(k,(w+j)/_),W=0,V=z;V<P;++V)for(var $=V*D-B,H=U;H<q;++H)for(var G=f*I+p*V+h*H,K=g*(x-1-$)+v*(w-1-(H*_-j))+y*F,X=0;X<O;++X)W+=c[G+(F*O+X)]*d[K+X];i[o*I+s*R+u*L+F]=W}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){Lf([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=Zn(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,f=this.bufferSync(e),p=this.bufferSync(t),h=0;h<a;++h)for(var d=Math.max(0,Math.ceil((c-h)/r)),m=Math.min(n.outHeight,(n.inHeight+c-h)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((u-g)/i)),y=Math.min(n.outWidth,(n.inWidth+u-g)/i),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/l),w=b%l,E=0,C=0;C<n.batchSize;++C)for(var S=d;S<m;++S)for(var N=h+S*r-c,A=v;A<y;++A){var k=g+A*i-u;E+=f.get(C,N,k,x)*p.get(C,S,A,b)}s.set(E,h,g,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return Lf(e,"tile"),Ba(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){Lf(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),a=this.bufferSync(e),o=Zn(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),c=u.map((function(e,t){return e+i[t]}));o.set.apply(o,[a.get.apply(a,u)].concat(c))}return o.toTensor()},t.prototype.gather=function(e,t,n){Lf([e,t],"gather");var r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;for(var a=Zn(r,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),c=u.slice();c[n]=i[u[n]];var l=o.locToIndex(c);a.values[s]=o.values[l]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){Lf([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=fr(e.shape,t,r),a=pr(i.length,t.length),o=hr(e.shape,t,r),s=dr(n,t.length),u=mr(o,n,t.length);return ra(e.reshape(i),a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Lf([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=fr(o.shape,t,r,!1),u=pr(s.length,t.length,!1),c=hr(o.shape,t,r,!1);return ra(o.reshape(s),u).reshape(c)},t.prototype.maxPool=function(e,t){return Lf(e,"maxPool"),jf(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"max").toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){Lf([t,n],"maxPoolBackprop");for(var i=this.readSync(t.dataId),a=Zn(r.outShape,t.dtype,Uf(i,t.shape,t.dtype,r).values),o=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=f-1-r.padInfo.left,h=l-1-r.padInfo.top,d=Zn(t.shape,"float32"),m=this.bufferSync(e),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-h,w=b-p,E=0,C=0;C<l;C+=u){var S=(x+C)/o;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var N=0;N<f;N+=c){var A=(w+N)/s;if(!(A<0||A>=r.outWidth||Math.floor(A)!==A)){var k=l*f-1-a.get(g,S,A,v)===C*f+N?1:0;0!==k&&(E+=m.get(g,S,A,v)*k)}}}d.set(E,g,y,b,v)}return d.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){Lf([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,f=l-1-n.padInfo.left,p=c-1-n.padInfo.top,h=Zn(t.shape,"float32"),d=1/(a*o),m=this.bufferSync(e),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-p,w=b-f,E=0,C=0;C<c;C+=s){var S=(x+C)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var N=0;N<l;N+=u){var A=(w+N)/i;A<0||A>=n.outWidth||Math.floor(A)!==A||(E+=m.get(g,S,A,v))}}h.set(E*d,g,y,b,v)}return h.toTensor()},t.prototype.pool3d=function(e,t,n){Lf(e,"pool3d");for(var r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=t.padInfo.front,h=t.padInfo.top,d=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(e.dataId),v=Zn(t.outShape,e.dtype),y=v.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],E=t.outShape[4],C=0;C<t.batchSize;++C)for(var S=C*b,N=C*e.strides[0],A=0;A<t.inChannels;++A)for(var k=0;k<t.outDepth;++k){for(var D=k*r-p,_=D;_<0;)_+=o;for(var M=Math.min(t.inDepth,c+D),T=S+k*x,O=0;O<t.outHeight;++O){for(var I=O*i-h,F=I;F<0;)F+=s;for(var R=Math.min(t.inHeight,l+I),B=T+O*w,z=0;z<t.outWidth;++z){for(var P=z*a-d,L=P;L<0;)L+=u;for(var j=Math.min(t.inWidth,f+P),U=B+z*E,q=m,W=0,V=0,$=_;$<M;$+=o){for(var H=N+$*e.strides[1],G=F;G<R;G+=s){for(var K=H+G*e.strides[2],X=L;X<j;X+=u){var Y=g[K+X*e.strides[3]+A];if("max"===n&&Y>q?q=Y:"avg"===n&&(W+=Y,V++),isNaN(q))break}if(isNaN(q))break}if(isNaN(q))break}y[U+A]="avg"===n?W/V:q}}}return v.toTensor()},t.prototype.avgPool3d=function(e,t){return Lf(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){Lf([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,m=p-1-n.padInfo.front,g=d-1-n.padInfo.left,v=h-1-n.padInfo.top,y=Zn(t.shape,"float32"),b=1/(o*s*u),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var E=0;E<n.inChannels;++E)for(var C=0;C<n.inDepth;++C)for(var S=0;S<n.inHeight;++S)for(var N=0;N<n.inWidth;++N){for(var A=C-m,k=S-v,D=N-g,_=0,M=0;M<p;M+=c){var T=(A+M)/r;if(!(T<0||T>=n.outDepth||Math.floor(T)!==T))for(var O=0;O<h;O+=l){var I=(k+O)/i;if(!(I<0||I>=n.outHeight||Math.floor(I)!==I))for(var F=0;F<d;F+=f){var R=(D+F)/a;R<0||R>=n.outWidth||Math.floor(R)!==R||(_+=x.get(w,T,I,R,E))}}}y.set(_*b,w,C,S,N,E)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return Lf(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=Zn(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=t.padInfo.front,h=t.padInfo.top,d=t.padInfo.left,m=this.bufferSync(e),g=0;g<t.batchSize;++g)for(var v=0;v<t.inChannels;++v)for(var y=0;y<t.outDepth;++y){for(var b=y*r-p,x=b;x<0;)x+=o;for(var w=Math.min(t.inDepth,c+b),E=0;E<t.outHeight;++E){for(var C=E*i-h,S=C;S<0;)S+=s;for(var N=Math.min(t.inHeight,l+C),A=0;A<t.outWidth;++A){for(var k=A*a-d,D=k;D<0;)D+=u;for(var _=Math.min(t.inWidth,f+k),M=Number.NEGATIVE_INFINITY,T=-1,O=x;O<w;O+=o)for(var I=O-b,F=S;F<N;F+=s)for(var R=F-C,B=D;B<_;B+=u){var z=B-k,P=m.get(g,O,F,B,v);P>=M&&(M=P,T=I*l*f+R*l+z)}n.set(T,g,y,E,A,v)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){Lf([t,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,r),a=r.strideDepth,o=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,p=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=f-1-r.padInfo.front,m=h-1-r.padInfo.left,g=p-1-r.padInfo.top,v=Zn(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var E=0;E<r.inDepth;++E)for(var C=0;C<r.inHeight;++C)for(var S=0;S<r.inWidth;++S){for(var N=E-d,A=C-g,k=S-m,D=0,_=0;_<f;_+=u){var M=(N+_)/a;if(!(M<0||M>=r.outDepth||Math.floor(M)!==M))for(var T=0;T<p;T+=c){var O=(A+T)/o;if(!(O<0||O>=r.outHeight||Math.floor(O)!==O))for(var I=0;I<h;I+=l){var F=(k+I)/s;if(!(F<0||F>=r.outWidth||Math.floor(F)!==F)){var R=f*p*h-1-y.get(x,M,O,F,w)===_*p*h+T*h+I?1:0;0!==R&&(D+=b.get(x,M,O,F,w)*R)}}}}v.set(D,x,E,C,S,w)}return v.toTensor()},t.prototype.cast=function(e,t){return ba(e,t,this)},t.prototype.reshape=function(e,t){return xa(e,t)},t.prototype.avgPool=function(e,t){return Lf(e,"avgPool"),Lf(e,"maxPool"),jf(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){Lf(e,"resizeBilinear");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(_([a,t,n,u])),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,d=f[0]/p[0],m=f[1]/p[1],g=0;g<a;g++)for(var v=0;v<t;v++)for(var y=d*v,b=Math.floor(y),x=y-b,w=Math.min(o-1,Math.ceil(y)),E=g*e.strides[0]+b*e.strides[1],C=g*e.strides[0]+w*e.strides[1],S=0;S<n;S++)for(var N=m*S,A=Math.floor(N),k=N-A,D=Math.min(s-1,Math.ceil(N)),M=E+A*e.strides[2],T=C+A*e.strides[2],O=E+D*e.strides[2],I=C+D*e.strides[2],F=0;F<u;F++){var R=c[M+F],B=c[T+F],z=R+(c[O+F]-R)*k,P=z+(B+(c[I+F]-B)*k-z)*x;l[h++]=P}return _n(l,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){Lf([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(i*a*o*s),p=[n&&c>1?a-1:a,n&&l>1?o-1:o],h=[n&&c>1?c-1:c,n&&l>1?l-1:l],d=p[0]/h[0],m=p[1]/h[1],g=this.readSync(e.dataId),v=0,y=0;y<i;y++)for(var b=y*t.strides[0],x=0;x<c;x++)for(var w=x*d,E=Math.floor(w),C=Math.min(Math.ceil(w),a-1),S=b+E*t.strides[1],N=b+C*t.strides[1],A=w-E,k=1-A,D=0;D<l;D++)for(var _=D*m,M=Math.floor(_),T=Math.min(Math.ceil(_),o-1),O=_-M,I=1-O,F=S+M*t.strides[2],R=S+T*t.strides[2],B=N+M*t.strides[2],z=N+T*t.strides[2],P=k*I,L=k*O,j=A*I,U=A*O,q=0;q<s;q++){var W=g[v++];f[F+q]+=W*P,f[R+q]+=W*L,f[B+q]+=W*j,f[z+q]+=W*U}return Rn(f,[i,o,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){Lf(e,"resizeNearestNeighbor");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(a*t*n*u),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=f[0]/p[0],d=f[1]/p[1],m=0,g=0;g<a;g++)for(var v=g*e.strides[0],y=0;y<t;y++)for(var b=h*y,x=v+Math.min(o-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var E=d*w,C=x+Math.min(s-1,r?Math.round(E):Math.floor(E))*e.strides[2],S=0;S<u;S++){var N=c[C+S];l[m++]=N}return _n(l,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){Lf([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(i*a*o*s),p=this.readSync(e.dataId),h=[n&&c>1?a-1:a,n&&l>1?o-1:o],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=h[0]/d[0],g=h[1]/d[1],v=1/m,y=1/g,b=2*Math.ceil(v)+2,x=2*Math.ceil(y)+2,w=0;w<i;w++)for(var E=w*t.strides[0],C=0;C<a;C++)for(var S=E+C*t.strides[1],N=Math.floor(C*v),A=Math.floor(N-b/2),k=0;k<o;k++)for(var D=S+k*t.strides[2],_=Math.floor(k*y),M=Math.floor(_-x/2),T=0;T<s;T++){for(var O=0,I=0;I<b;I++){var F=I+A;if(!(F<0||F>=c)){var R=E+F*e.strides[1],B=F*m;if(C===Math.min(a-1,n?Math.round(B):Math.floor(B)))for(var z=0;z<x;z++){var P=z+M;if(!(P<0||P>=l)){var L=R+P*e.strides[2],j=P*g;k===Math.min(o-1,n?Math.round(j):Math.floor(j))&&(O+=p[L+T])}}}}f[D+T]=O}return Rn(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){Lf([e,t,n,i,a],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=i?this.readSync(i.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(o.length),p=l.length,h=c.length,d=u.length,m=s.length,g=0,v=0,y=0,b=0,x=0;x<o.length;++x)f[x]=l[g++]+(o[x]-s[v++])*c[y++]/Math.sqrt(u[b++]+r),g>=p&&(g=0),v>=m&&(v=0),y>=h&&(y=0),b>=d&&(b=0);return Rn(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){Lf(e,"localResponseNormalization4D");var a=e.shape[3],o=a-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%a,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,o),u=0;r<=i;r++){var c=s[r];u+=c*c}return u}for(var f=0;f<u;f++){var p=l(f),h=s[f]*Math.pow(n+r*p,-i);c[f]=h}return Rn(c,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){Lf(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),f=new Float32Array(e.size),p=e.size,h=0;h<p;h++){for(var d=h%s,m=h-d+Math.max(0,d-r),g=h-d+Math.min(s,d+r+1),v=0,y=m;y<g;y++)v+=Math.pow(c[y],2);for(v=a*v+i,y=m;y<g;y++){var b=-2*a*o*c[y]*l[h]/v;h===y&&(b+=Math.pow(v,-o)),b*=u[h],f[y]+=b}}return Rn(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){Lf(e,"multinomial");for(var i=t?e:ta(e),a=i.shape[0],o=i.shape[1],s=jn([a,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(i.dataId),l=0;l<a;++l){var f=l*o,p=new Float32Array(o-1);p[0]=c[f];for(var h=1;h<p.length;++h)p[h]=p[h-1]+c[f+h];for(var d=Nu(r.toString()),m=l*n,g=0;g<n;++g){var v=d();u[m+g]=p.length;for(var y=0;y<p.length;y++)if(v<p[y]){u[m+g]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){Lf(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var a=this.readSync(e.dataId),o=0;o<e.size;++o)a[o]>=0&&a[o]<t&&(i[o*t+a[o]]=n);return In(i,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return Lf(e,"nonMaxSuppression"),_a(this.readSync(e.dataId),this.readSync(t.dataId),n,r,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=Zn(e.shape,"float32"),a=Zn(e.shape,"float32"),o=kn(e).as2D(n,r),s=Dn(e).as2D(n,r),u=0;u<n;u++)for(var c=o.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),f=An(c,l),p=this.readSync(this.fftImpl(f,t).dataId),h=0;h<r;h++){var d=Sa(p,h);i.values[u*r+h]=d.real,a.values[u*r+h]=d.imag}return An(i.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(i=An(kn(i).div(Tn(r)),Dn(i).div(Tn(r)))),i}var a=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return An(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),i=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),o=An(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),u=An(s.real,s.imag).as1D();o=this.fftRadix2(o,i,n),u=this.fftRadix2(u,i,n);var c=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),i=0;i<Math.ceil(e/2);i++){var a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}(t,n),l=An(c.real,c.imag).mul(u),f=o.add(l),p=o.sub(l),h=kn(f).concat(kn(p)),d=Dn(f).concat(Dn(p));return An(h,d).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var a=0,o=0,s=0;s<t;s++){var u=Aa(i*s,t,n),c=Sa(e,s);a+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(a/=t,o/=t),Na(r,a,o,i)}return r},t.prototype.depthToSpace=function(e,t,n){N("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),N(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],i=e.shape[1],a=e.shape[2],o=e.shape[3],s=i*t,u=a*t,c=o/(t*t),l=this.readSync(e.dataId),f=new Float32Array(r*s*u*c),p=0,h=0;h<r;++h)for(var d=0;d<s;++d)for(var m=Math.floor(d/t),g=d%t,v=0;v<u;++v)for(var y=Math.floor(v/t),b=(g*t+v%t)*c,x=0;x<c;++x){var w=x+b+o*(y+a*(m+i*h));f[p++]=l[w]}return Rn(f,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=Fr(e.shape,t.shape),a=Zn(i,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Or(e.shape,i),c=Or(t.shape,i),l=a.values;if(u.length+c.length===0)for(var f=0;f<l.length;++f)l[f]=r(o[f%o.length],s[f%s.length]);else{var p=this.bufferSync(e),h=this.bufferSync(t),d=function(n){var i=a.indexToLoc(n),f=i.slice(-e.rank);u.forEach((function(e){return f[e]=0}));var d=p.locToIndex(f),m=i.slice(-t.rank);c.forEach((function(e){return m[e]=0}));var g=h.locToIndex(m);l[n]=r(o[d],s[g])};for(f=0;f<l.length;++f)d(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=Fr(e.shape,t.shape),i=Zn(r,"float32"),a=Zn(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Or(e.shape,r),c=Or(t.shape,r),l=i.values,f=a.values;if(u.length+c.length===0)for(var p=0;p<l.length;p++){var h=p%o.length,d=p%s.length,m=n(o[2*h],o[2*h+1],s[2*d],s[2*d+1]);l[p]=m.real,f[p]=m.imag}else{var g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=i.indexToLoc(r),p=a.slice(-e.rank);u.forEach((function(e){return p[e]=0}));var h=g.locToIndex(p),d=a.slice(-t.rank);c.forEach((function(e){return d[e]=0}));var m=v.locToIndex(d),y=n(o[2*h],o[2*h+1],s[2*m],s[2*m+1]);l[r]=y.real,f[r]=y.imag};for(p=0;p<l.length;p++)y(p)}return this.complex(i.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return Ra(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,i,a){for(var o=e.shape,s=o[0],u=o[1],c=o[2],l=o[3],f=t.shape[0],p=r[0],h=r[1],d=Zn([f,p,h,l],"float32"),m=this.readSync(t.dataId),g=this.readSync(n.dataId),v=this.readSync(e.dataId),y=e.strides,b=d.strides,x=0;x<f;x++){var w=4*x,E=m[w],C=m[w+1],S=m[w+2],N=m[w+3],A=g[x];if(!(A>=s))for(var k=p>1?(S-E)*(u-1)/(p-1):0,D=h>1?(N-C)*(c-1)/(h-1):0,_=0;_<p;_++){var M=p>1?E*(u-1)+_*k:.5*(E+S)*(u-1);if(M<0||M>u-1)for(var T=0;T<h;T++)for(var O=0;O<l;O++){var I=O+T*b[2]+_*b[1]+x*b[0];d.values[I]=a}else if("bilinear"===i){var F=Math.floor(M),R=Math.ceil(M),B=M-F;for(T=0;T<h;T++)if(($=h>1?C*(c-1)+T*D:.5*(C+N)*(c-1))<0||$>c-1)for(O=0;O<l;O++)I=O+T*b[2]+_*b[1]+x*b[0],d.values[I]=a;else{var z=Math.floor($),P=Math.ceil($),L=$-z;for(O=0;O<l;O++){var j=v[I=O+z*y[2]+F*y[1]+A*y[0]],U=v[I=O+P*y[2]+F*y[1]+A*y[0]],q=v[I=O+z*y[2]+R*y[1]+A*y[0]],W=j+(U-j)*L,V=q+(v[I=O+P*y[2]+R*y[1]+A*y[0]]-q)*L;I=O+T*b[2]+_*b[1]+x*b[0],d.values[I]=W+(V-W)*B}}}else for(T=0;T<h;++T){var $;if(($=h>1?C*(c-1)+T*D:.5*(C+N)*(c-1))<0||$>c-1)for(O=0;O<l;O++)I=O+T*b[2]+_*b[1]+x*b[0],d.values[I]=a;else{var H=Math.round($),G=Math.round(M);for(O=0;O<l;O++){var K=O+H*y[2]+G*y[1]+A*y[0],X=O+T*b[2]+_*b[1]+x*b[0];d.values[X]=v[K]}}}}}return d.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var i=Pi(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.sliceSize,u=i.strides,c=i.outputSize;return this.scatter(e,t,n,c,s,o,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=Ii(e,t),a=i[0],o=i[1],s=i[2],u=i[3];if(0===o)return _n([],a,e.dtype);for(var c=new ge([o,s],e.dtype),l=this.readSync(t.dataId),f=this.readSync(e.dataId),p=0;p<o;p++){for(var h=[],d=0,m=0;m<r;m++){var g=l[p*r+m];d+=g*u[m],h.push(g)}if(d<0||d>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var v=0;v<s;v++)c.values[p*s+v]=f[d*s+v]}return c.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=Pi(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=Tn(0);return this.scatter(e,t,n,u,o,a,i,s,c,!0)},t.prototype.fill=function(e,t,n){var r=j(n=n||Y(t),_(e));return r.fill(t),ze.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=j(e.dtype,_(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return wa(e,t,n)},t.prototype.scatter=function(e,t,n,r,i,a,o,s,u,c){var l=[r/i,i],f=this.readSync(e.dataId),p=this.readSync(t.dataId);if(0===r)return _n([],n,t.dtype);var h=new ge(l,t.dtype);h.values.fill(this.readSync(u.dataId)[0]);for(var d=0;d<a;d++){for(var m=[],g=0,v=0;v<o;v++){var y=f[d*o+v];m.push(y),g+=y*s[v]}if(g<0||g>=r/i)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<i;b++)c?h.values[g*i+b]+=p[d*i+b]:h.values[g*i+b]=0===t.rank?p[0]:p[d*i+b]}return h.toTensor().reshape(n)},t}(aa);function Vf(e,t){return{kernelName:e,backendName:"cpu",kernelFunc:function(n){var r=n.inputs,i=n.backend,a=r,o=a.a,s=a.b,u=i;Lf([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,f=t(o.shape,s.shape,c,l,o.dtype),p=f[0],h=f[1];return{dataId:u.write(p,h,o.dtype),shape:h,dtype:o.dtype}}}}function $f(e){return function(t,n,r,i,a){var o=Fr(t,n),s=o.length,u=Q(o),c=L(a,_(o)),l=t.length,f=n.length,p=Q(t),h=Q(n),d=Or(t,o),m=Or(n,o);if(d.length+m.length===0)for(var g=0;g<c.length;++g)c[g]=e(r[g%r.length],i[g%i.length]);else{var v=function(t){var n=ce(t,s,u),a=n.slice(-l);d.forEach((function(e){return a[e]=0}));var o=ue(a,l,p),g=n.slice(-f);m.forEach((function(e){return g[e]=0}));var v=ue(g,f,h);c[t]=e(r[o],i[v])};for(g=0;g<c.length;++g)v(g)}return[c,o]}}ze.registerBackend("cpu",(function(){return new Wf}),1);var Hf=$f((function(e,t){return e/t})),Gf=Vf(yr,Hf),Kf={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n,o=a.filterSize,s=a.strides,u=a.pad,c=a.includeBatchInIndex,l=r;Lf(i,"MaxPoolWithArgmax");var f=l.data.get(i.dataId).values,p=sa(i.shape,o,s,[1,1],u),h=function(e,t,n,r,i){var a=jf(e,0,n,Q(t),i,"max"),o=Uf(e,t,n,i,!0,r);return[a.values,o.values]}(f,i.shape,i.dtype,c,p),d=h[0],m=h[1],g=l.write(d,p.outShape,i.dtype),v=l.write(m,p.outShape,i.dtype);return[{dataId:g,shape:p.outShape,dtype:i.dtype},{dataId:v,shape:p.outShape,dtype:"int32"}]}},Xf={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t,a=i.boxes,o=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,p=n;Lf(a,"NonMaxSuppressionWithScore");var h=Ma(p.data.get(a.dataId).values,p.data.get(o.dataId).values,u,c,l,f);return[h.selectedIndices,h.selectedScores]}},Yf={kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n;Lf(r,"square");for(var a=i.data.get(r.dataId).values,o=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];o[s]=u*u}return{dataId:i.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Jf=$f((function(e,t){var n=e-t;return n*n}));function Zf(e,t,n,r,i){for(var a=_(t),o=t.length,s=Q(t),u=Q(i),c=L(n,_(i)),l=0;l<a;++l){for(var f=ce(l,o,s),p=new Array(f.length),h=0;h<p.length;h++)p[h]=f[r[h]];c[ue(p,o,u)]=e[l]}return c}for(var Qf=0,ep=[Xf,Yf,Vf(xr,Jf),Gf,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n.perm,o=r;Lf(i,"transpose");for(var s=i.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=i.shape[a[c]];var l=Zf(o.data.get(i.dataId).values,i.shape,i.dtype,a,u);return{dataId:o.write(l,u,i.dtype),shape:u,dtype:i.dtype}}},Kf];Qf<ep.length;Qf++)g(ep[Qf]);for(var tp,np=function(e){this.variableNames=["A"];var t=Va(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},rp=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Va(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},ip=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=ro(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},ap=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=ro(this.rank),a=qa("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=a[r];var s="vec2("+o.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},op=0,sp=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.pixels,a=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,u=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],f=u[1],p=[f,l],h=[f,l,a];(s||o)&&(null==tp&&(tp=document.createElement("canvas").getContext("2d")),tp.canvas.width=l,tp.canvas.height=f,tp.drawImage(i,0,0,l,f),i=tp.canvas);var d=n.makeTensorInfo(p,"int32");n.texData.get(d.dataId).usage=Ue.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);var m=c().getBool("WEBGL_PACK")?new rp(h):new np(h),g=n.runWebGLProgram(m,[d],"int32");return n.disposeData(d.dataId),g}},{kernelName:yr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;return function(e,t,n){var r=new vo("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return c().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new bo("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",e.shape,t.shape,!0)),n.runWebGLProgram(r,[e,t],"float32")}(r.a,r.b,n)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;ln("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=t,a=i.boxes,o=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,p=n,h=Ma(p.readSync(a.dataId),p.readSync(o.dataId),u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n,a=new Js(r.shape,"return x * x;");return i.runWebGLProgram(a,[r],r.dtype)}},{kernelName:xr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,i=r.a,a=r.b,o=n,s=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bo("return (a - b) * (a - b);",i.shape,a.shape):new vo("return (a - b) * (a - b);",i.shape,a.shape);return o.compileAndRun(s,[i,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,i=e.backend,a=n.x,o=r.perm,s=i,u=a.shape.length,l=new Array(u),f=0;f<l.length;f++)l[f]=a.shape[o[f]];if(s.shouldExecuteOnCPU([a])){var p=Zf(s.texData.get(a.dataId).values,a.shape,a.dtype,o,l);t=s.makeTensorInfo(l,a.dtype),s.texData.get(t.dataId).values=p}else t=function(e,t,n){var r=c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ap(e.shape,t):new ip(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}(a,o,s);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n,o=a.filterSize,s=a.strides,u=a.pad,c=a.includeBatchInIndex,l=r;N(4===i.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank "+i.shape.length+"."}));var f=[1,1];N(va(s,f),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+f+"'"}));var p=sa(i.shape,o,s,f,u),h=function(e,t,n,r){var i=new _s(n,"max",!1),a=r.runWebGLProgram(i,[e],"float32");return i=new _s(n,"max",!0,!0,t),[a,r.runWebGLProgram(i,[e],"float32")]}(i,c,p,l);return[h[0],h[1]]}}];op<sp.length;op++)g(sp[op]);for(var up=0,cp=[{kernelName:gr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=Fr(n.shape,r.shape);return{a:function(){var t=e,r=Ir(n.shape,i);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},b:function(){var t=e,n=Ir(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},{kernelName:Sr,gradFunc:function(e,t,n){for(var r=n,i=r.inputShape,a=r.shape,o=Array.from(a),s=i.length-1;s>=0;s--)if(i[s]===a[s])o[s]=1;else if(1!==i[s])throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return e.sum(u,!0)}}}},{kernelName:yr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=Fr(n.shape,r.shape);return{a:function(){var t=Oi(e,r.toFloat()),a=Ir(n.shape,i);return a.length>0?Dl(t,a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=Ir(r.shape,i);a.length>0&&(t=Dl(t,a).reshape(r.shape));var o=vc(r);return Qr(Oi(t,o.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,i=t[0],a=t[1],o=t[2],s=t[3],u=Du(i),c=null==s?Tn(1):s,l=Ir(a.shape,u.shape),f=[];if(1===a.rank){for(var p=0;p<u.shape.length-1;++p)f.push(u.shape[p]);f.push(1)}var h=Mi(i,a),d=Ni(e,c),m=ni(Tr(o,Tn(r))),g=Ni(Ni(Ni(m,m),m),Tn(-.5));return{x:function(){return 1===a.rank?ar(Ni(Ni(e,Ju(m.as4D(1,1,1,a.shape[0]),f)),c),i.shape):ar(Ni(Ni(e,m),c),i.shape)},mean:function(){var e=Ni(Ni(m,Tn(-1)),d);return 1===a.rank&&(e=Dl(e,l)),ar(e,a.shape)},variance:function(){var e=Ni(Ni(g,h),d);return 1===a.rank&&(e=Dl(e,l)),ar(e,a.shape)},scale:function(){var t=Ni(h,m),n=Ni(e,t);return 1===a.rank&&(n=Dl(n,l)),ar(n,a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=Dl(t,l)),ar(t,a.shape)}}}},{kernelName:Ar,gradFunc:function(e){return{x:function(){return e.toFloat()}}}},{kernelName:Nr,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return jn(n.shape,"float32")}}}},{kernelName:Dr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],i=n.paddings.map((function(e){return e[0]}));return{x:function(){return e.slice(i,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:xr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=Tn(2);return{a:function(){return Ni(e,Ni(i,Mi(n,r)))},b:function(){return Ni(e,Ni(i,Mi(r,n)))}}}},{kernelName:kr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],i=n.reps;return{x:function(){var t=$n(r);if(1===r.rank)for(var n=0;n<i[0];++n)t=t.add(e.slice([n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(n=0;n<i[0];++n)for(var a=0;a<i[1];++a)t=t.add(e.slice([n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(n=0;n<i[0];++n)for(a=0;a<i[1];++a)for(var o=0;o<i[2];++o)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(n=0;n<i[0];++n)for(a=0;a<i[1];++a)for(o=0;o<i[2];++o)for(var s=0;s<i[3];++s)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(e,t,n){var r=wn(n.perm);return{x:function(){return ra(e,r)}}}}];up<cp.length;up++)v(cp[up]);var lp=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();c().get("IS_BROWSER")&&c().setPlatform("browser",new lp);var fp,pp=function(){function e(){this.util=n(753),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=c().global.fetch?c().global.fetch(e,t):(null==fp&&(fp=n(522)),fp(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();c().get("IS_NODE")&&c().setPlatform("node",new pp);var hp={float32:4,int32:4,uint16:2,uint8:1,bool:1};function dp(e,t){for(var n={},r=0,i=function(t){var i=t.name,a=t.dtype,o=t.shape,s=_(o),u=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=hp[c.dtype],f=e.slice(r,r+s*l),p="uint8"===c.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(p,(function(e){return e*c.scale+c.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=Int32Array.from(p,(function(e){return Math.round(e*c.scale+c.min)}))}r+=s*l}else if("string"===a){var h=_(t.shape);u=[];for(var d=0;d<h;d++){var m=new Uint32Array(e.slice(r,r+4))[0];r+=4;var g=new Uint8Array(e.slice(r,r+m));u.push(g),r+=m}}else{var v=hp[a];if(f=e.slice(r,r+s*v),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=new Uint8Array(f)}r+=s*v}n[i]=_n(u,o,a)},a=0,o=t;a<o.length;a++)i(o[a]);return n}function mp(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}var gp="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function vp(e){return gp?Buffer.byteLength(e):new Blob([e]).size}function yp(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function bp(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function xp(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:vp(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:vp(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var wp=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var i=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&i.push(n)})),i},e}(),Ep="://",Cp=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){N(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Ep)&&(t=t.slice(0,t.indexOf(Ep))),N(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();N(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function Sp(e){if(-1===e.indexOf(Ep))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Cp.getSchemes().join(","));return{scheme:e.split(Ep)[0],path:e.split(Ep)[1]}}function Np(e,t,n){return void 0===n&&(n=!1),a(this,void 0,void 0,(function(){var r,i,a,s,u,c,l,f,p;return o(this,(function(o){switch(o.label){case 0:return N(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),N((r=wp.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),N(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),i=r[0],N((a=wp.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),N(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),s=a[0],u=Sp(e).scheme,c=Sp(e).path,l=u===Sp(e).scheme,[4,i.load()];case 1:return f=o.sent(),n&&l?[4,Cp.getManager(u).removeModel(c)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[4,s.save(f)];case 4:return p=o.sent(),!n||l?[3,6]:[4,Cp.getManager(u).removeModel(c)];case 5:o.sent(),o.label=6;case 6:return[2,p.modelArtifactsInfo]}}))}))}var Ap="models_store",kp="model_info_store";function Dp(){if(!c().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function _p(e){var t=e.result;t.createObjectStore(Ap,{keyPath:"modelPath"}),t.createObjectStore(kp,{keyPath:"modelPath"})}var Mp=function(){function e(e){if(this.indexedDB=Dp(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return _p(i)},i.onsuccess=function(){var a=i.result;if(null==t){var o=a.transaction(Ap,"readonly"),s=o.objectStore(Ap).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},o.oncomplete=function(){return a.close()}}else{var u,c=xp(t),l=a.transaction(kp,"readwrite"),f=l.objectStore(kp),p=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});p.onsuccess=function(){var i=(u=a.transaction(Ap,"readwrite")).objectStore(Ap).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});i.onsuccess=function(){return e({modelArtifactsInfo:c})},i.onerror=function(e){var t=(f=l.objectStore(kp)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(i.error)},t.onerror=function(e){return a.close(),r(i.error)}}},p.onerror=function(e){return a.close(),r(p.error)},l.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}(),Tp=function(e){return c().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Mp.URL_SCHEME)?(t=e.slice(Mp.URL_SCHEME.length),new Mp(t)):null;var t};wp.registerSaveRouter(Tp),wp.registerLoadRouter(Tp);var Op=function(){function e(){this.indexedDB=Dp()}return e.prototype.listModels=function(){return a(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return _p(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(kp,"readonly"),a=i.objectStore(kp).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return a(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){var r;return e=(r=e).startsWith(Mp.URL_SCHEME)?r.slice(Mp.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return _p(i)},i.onsuccess=function(){var t,a=i.result,o=a.transaction(kp,"readwrite"),s=o.objectStore(kp),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),o=function(){var i=(t=a.transaction(Ap,"readwrite")).objectStore(Ap).delete(e);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(e){return r(u.error)}};i.onsuccess=o,i.onerror=function(e){return o(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},o.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(c().getBool("IS_BROWSER"))try{Cp.registerManager(Mp.URL_SCHEME,new Op)}catch(r){}var Ip="/",Fp="tensorflowjs_models",Rp="info",Bp="model_topology",zp="weight_specs",Pp="weight_data",Lp="model_metadata";function jp(e){return{info:[Fp,e,Rp].join(Ip),topology:[Fp,e,Bp].join(Ip),weightSpecs:[Fp,e,zp].join(Ip),weightData:[Fp,e,Pp].join(Ip),modelMetadata:[Fp,e,Lp].join(Ip)}}function Up(e){var t=e.split(Ip);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Ip)}var qp=function(){function e(e){if(!c().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=jp(this.modelPath)}return e.prototype.save=function(e){return a(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=xp(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(gp)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return a(this,void 0,void 0,(function(){var e,t,n,r,i,a,s;return o(this,(function(o){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(gp){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer}(s),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),Wp=function(e){return c().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(qp.URL_SCHEME)?(t=e.slice(qp.URL_SCHEME.length),new qp(t)):null;var t};wp.registerSaveRouter(Wp),wp.registerLoadRouter(Wp);var Vp=function(){function e(){N(c().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),N("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return a(this,void 0,void 0,(function(){var e,t,n,r,i,a;return o(this,(function(o){for(e={},t=Fp+Ip,n=Ip+Rp,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(t)&&i.endsWith(n)&&(a=Up(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return a(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){var i;if(e=(i=e).startsWith(qp.URL_SCHEME)?i.slice(qp.URL_SCHEME.length):i,t=jp(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(c().getBool("IS_BROWSER"))try{Cp.registerManager(qp.URL_SCHEME,new Vp)}catch(r){}function $p(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Hp=function(){function e(t){if(!c().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i,a,s;return o(this,(function(o){switch(o.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,$p((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return o.sent(),null==e.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,$p((function(){return s.dispatchEvent(new MouseEvent("click"))}))]);case 3:o.sent(),o.label=4;case 4:return[2,{modelArtifactsInfo:xp(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),Gp=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return a(this,void 0,void 0,(function(){var e,t,n=this;return o(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var a=new FileReader;a.onload=function(a){var o=JSON.parse(a.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,t)}catch(e){return void i(e)}var l=[],f=[],p=[];u.forEach((function(e){e.paths.forEach((function(e){f.push(e),p.push(null)})),l.push.apply(l,e.weights)})),u.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=f.indexOf(e);p[i]=n,-1===p.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:yp(p),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return bp(e.name)})),i={},a=0,o=e;a<o.length;a++)o[a].paths.forEach((function(e){var a=bp(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");i[e]=t[r.indexOf(a)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function Kp(e,t,n,r){!function(e){N(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){N(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),N(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),N(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function Xp(e,t){return a(this,void 0,void 0,(function(){var n,r,i,a,s,u,l,f,p;return o(this,(function(o){switch(o.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?c().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),i=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return s=o.sent(),[3,4];case 2:return[4,Kp(r,t.onProgress,i,a)];case 3:s=o.sent(),o.label=4;case 4:return u=s.map((function(e){return e.arrayBuffer()})),l=.5,f=1,null!=t.onProgress?[3,6]:[4,Promise.all(u)];case 5:return p=o.sent(),[3,8];case 6:return[4,Kp(u,t.onProgress,l,f)];case 7:p=o.sent(),o.label=8;case 8:return[2,p]}}))}))}function Yp(e){var t=this;return function(n,r,i){return void 0===r&&(r=""),a(t,void 0,void 0,(function(){var t,a,s,u,c,l,f,p,h,d;return o(this,(function(o){switch(o.label){case 0:if(t=n.map((function(){return!1})),a={},s=null!=i?i.map((function(){return!1})):[],u=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var o="quantization"in e?e.quantization.dtype:e.dtype,c=hp[o]*_(e.shape),l=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:c})};null!=i?i.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),r+=c}))})),!s.every((function(e){return e})))throw c=i.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),f=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;f.push(t)}))})),[4,e(f)];case 1:return p=o.sent(),h={},d=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,i=0;i<t;i++)r+=p[d+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,c=0;c<t;c++){var l=new Uint8Array(p[d+c]);s.set(l,u),u+=l.byteLength}a[e].forEach((function(e){var t=dp(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]})),d+=t})),[2,h]}}))}))}}wp.registerSaveRouter((function(e){return c().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Hp.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new Hp(e)}(e.slice(Hp.URL_SCHEME.length)):null}));var Jp=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(N("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=c().platform.fetch,N(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&N(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:xp(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return a(this,void 0,void 0,(function(){var e,t,n,r,i,a,s,u,c,l,f,p;return o(this,(function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=o.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e.json()];case 3:return t=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,i=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,c=t.userDefinedMetadata,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:p=o.sent(),l=p[0],f=p[1],o.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:f,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}}))}))},e.prototype.loadWeights=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i,a,s,u,c,l,f,p;return o(this,(function(o){switch(o.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],i=n[1],a=this.weightPathPrefix||r,s=[],u=0,c=e;u<c.length;u++)l=c[u],s.push.apply(s,l.weights);return f=[],e.forEach((function(e){e.paths.forEach((function(e){f.push(a+e+i)}))})),[4,Xp(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return p=o.sent(),[2,[s,yp(p)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Zp(e){return null!=e.match(Jp.URL_SCHEME_REGEX)}var Qp=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return Zp(e)})):Zp(e))?eh(e,{onProgress:t}):null};function eh(e,t){return new Jp(e,t)}wp.registerSaveRouter(Qp),wp.registerLoadRouter(Qp);var th,nh=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),rh=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),ih=Object.freeze({browserFiles:function(e){return new Gp(e)},browserHTTPRequest:function(e,t){return eh(e,t)},concatenateArrayBuffers:yp,decodeWeights:dp,encodeWeights:function(e,t){return a(this,void 0,void 0,(function(){var n,r,i,s,u,c=this;return o(this,(function(l){switch(l.label){case 0:for(n=[],r=[],i=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),s=function(s){var u=i[s],l=Array.isArray(e)?e[s].tensor:e[u];if("float32"!==l.dtype&&"int32"!==l.dtype&&"bool"!==l.dtype&&"string"!==l.dtype)throw new Error("Unsupported dtype in weight '"+u+"': "+l.dtype);var f={name:u,shape:l.shape,dtype:l.dtype};if("string"===l.dtype){var p=new Promise((function(e){return a(c,void 0,void 0,(function(){var t,n,r,i,a,s,u;return o(this,(function(o){switch(o.label){case 0:return[4,l.bytes()];case 1:for(t=o.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+4*t.length,r=new Uint8Array(n),i=0,a=0;a<t.length;a++)s=t[a],u=new Uint8Array(new Uint32Array([s.length]).buffer),r.set(u,i),i+=4,r.set(s,i),i+=s.length;return e(r),[2]}}))}))}));r.push(p)}else r.push(l.data());null!=t&&(f.group=t),n.push(f)},u=0;u<i.length;++u)s(u);return[4,Promise.all(r)];case 1:return[2,{data:mp(l.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new nh(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nh({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nh({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return wp.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:xp,getSaveHandlers:function(e){return wp.getSaveHandlers(e)},http:eh,isHTTPScheme:Zp,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),a(this,void 0,void 0,(function(){return o(this,(function(i){return[2,Yp((function(e){return Xp(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return wp.registerLoadRouter(e)},registerSaveRouter:function(e){return wp.registerSaveRouter(e)},weightsLoaderFactory:Yp,withSaveHandler:function(e){return new rh(e)},copyModel:function(e,t){return a(this,void 0,void 0,(function(){return o(this,(function(n){return[2,Np(e,t,!1)]}))}))},listModels:function(){return a(this,void 0,void 0,(function(){var e,t,n,r,i,a,s;return o(this,(function(o){switch(o.label){case 0:e=Cp.getSchemes(),t={},n=0,r=e,o.label=1;case 1:return n<r.length?(i=r[n],[4,Cp.getManager(i).listModels()]):[3,4];case 2:for(s in a=o.sent())t[i+Ep+s]=a[s];o.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return a(this,void 0,void 0,(function(){return o(this,(function(n){return[2,Np(e,t,!0)]}))}))},removeModel:function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t=Sp(e),[2,Cp.getManager(t.scheme).removeModel(t.path)]}))}))}}),ah=Nn({confusionMatrix_:function(e,t,n){var r=hn(e,"labels","confusionMatrix"),i=hn(t,"predictions","confusionMatrix");N(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),N(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),N(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),N(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),N(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=ec(r.asType("int32"),n),o=ec(i.asType("int32"),n);return a.transpose().matMul(o).asType("int32")}}),oh=Object.freeze({confusionMatrix:ah}),sh=Nn({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,a=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=h("FromPixels",ze.backendName))return ze.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,c=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],f=c[1];if(o?s=e.getContext("2d").getImageData(0,0,l,f).data:r||n?s=e.data:(a||i)&&(null==th&&(th=document.createElement("canvas").getContext("2d")),th.canvas.width=l,th.canvas.height=f,th.drawImage(e,0,0,l,f),s=th.getImageData(0,0,l,f).data),4===t)u=new Int32Array(s);else{var p=l*f;u=new Int32Array(p*t);for(var d=0;d<p;d++)for(var m=0;m<t;++m)u[d*t+m]=s[4*d+m]}return Fn(u,[f,l,t],"int32")}}),uh=Object.freeze({toPixels:function(e,t){return a(this,void 0,void 0,(function(){var n,r,i,a,s,u,c,l,f,p,h,d,m,g,v,y,b,x,w,E,C,S,N;return o(this,(function(o){switch(o.label){case 0:if(n=hn(e,"img","toPixels"),e instanceof xe||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(s=2===n.rank?1:n.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,n.data()];case 1:return u=o.sent(),c=n.min(),l=n.max(),[4,Promise.all([c.data(),l.data()])];case 2:if(f=o.sent(),p=f[0],h=f[1],d=p[0],m=h[0],c.dispose(),l.dispose(),"float32"===n.dtype){if(d<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+m+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(d<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+m+"].")}for(g="float32"===n.dtype?255:1,v=new Uint8ClampedArray(a*i*4),y=0;y<i*a;++y)b=void 0,x=void 0,w=void 0,E=void 0,1===s?(b=u[y]*g,x=u[y]*g,w=u[y]*g,E=255):3===s?(b=u[3*y]*g,x=u[3*y+1]*g,w=u[3*y+2]*g,E=255):4===s&&(b=u[4*y]*g,x=u[4*y+1]*g,w=u[4*y+2]*g,E=u[4*y+3]*g),v[0+(C=4*y)]=Math.round(b),v[C+1]=Math.round(x),v[C+2]=Math.round(w),v[C+3]=Math.round(E);return null!=t&&(t.width=a,t.height=i,S=t.getContext("2d"),N=new ImageData(v,a,i),S.putImageData(N,0,0)),n!==e&&n.dispose(),[2,v]}}))}))},fromPixels:sh}),ch=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),lh=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function fh(e){N(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),N("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),N(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),lh.register(e)}var ph=Object.freeze({Serializable:ch,SerializationMap:lh,registerClass:fh}),hh="1.7.4",dh=Object.freeze({gpgpu_util:ds,webgl_util:jt,forceHalfFloat:function(){c().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:gu,setWebGLContext:$e,GPGPUContext:ms}),mh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,a=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:a[e.name]}}));this.applyGradients(o)}else this.applyGradients(a);return Jt(a),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return Zi(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Jt(this.iterations_)},t.prototype.saveIterations=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Tn(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(ch);Object.defineProperty(mh,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var gh=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=ze.backend.epsilon()),i}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=ze.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Yt((function(){return $n(i).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Yt((function(){return $n(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Yt((function(){var e=o.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(i);i.assign(u)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Jt(this.accumulatedGrads.map((function(e){return e.variable}))),Jt(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(mh);fh(gh);var vh=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=ze.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Yt((function(){return Un(i.shape,t.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable;Yt((function(){var e=o.add(a.square());o.assign(e);var n=a.div(e.add(ze.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Jt(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(mh);fh(vh);var yh=function(e){function t(t,n,r,i){void 0===i&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Yt((function(){a.accBeta1=Tn(n).variable(),a.accBeta2=Tn(r).variable()})),null==i&&(a.epsilon=ze.backend.epsilon()),a}return i(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Yt((function(){var r=Mi(1,t.accBeta1),i=Mi(1,t.accBeta2);n.forEach((function(n,a){var o=ze.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Yt((function(){return $n(o).variable(!1)}))}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:Yt((function(){return $n(o).variable(!1)}))});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedSecondMoment[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),p=l.div(r),h=f.div(i);u.assign(l),c.assign(f);var d=p.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(d)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Jt(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Jt(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return a(this,void 0,void 0,(function(){var t,n=this;return o(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Yt((function(){n.accBeta1.assign(ki(n.beta1,n.iterations_+1)),n.accBeta2.assign(ki(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(mh);fh(yh);var bh=function(e){function t(t,n,r,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=i,o.decay=a,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],Yt((function(){o.iteration=Tn(0).variable(),o.accBeta1=Tn(n).variable()})),null==i&&(o.epsilon=ze.backend.epsilon()),o}return i(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Yt((function(){var r=Mi(1,t.accBeta1),i=Oi(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,a){var o=ze.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:$n(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:$n(o).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedWeightedInfNorm[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2),p=s.abs(),h=f.maximum(p);u.assign(l),c.assign(h);var d=i.div(r).mul(l.div(h.add(t.epsilon))).add(o);o.assign(d)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Jt(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Jt(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(mh);fh(bh);var xh=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=ze.registeredVariables[n];Yt((function(){var e=t.c.mul(i).add(a);a.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Zt(Tn(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(mh);fh(xh);var wh=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=Tn(i.momentum),i}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=ze.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Yt((function(){return $n(i).variable(!1)}))});var a=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Yt((function(){var e,n=t.m.mul(a).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(i):t.c.mul(n).add(i),a.assign(n),i.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Jt(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(xh);fh(wh);var Eh=function(e){function t(t,n,r,i,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===a&&(a=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=i,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=a,null==i&&(o.epsilon=ze.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return i(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=ze.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Yt((function(){return $n(i).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Yt((function(){return $n(i).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Yt((function(){return $n(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Yt((function(){var e=o.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),c=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(u),s.assign(c);var l=i.sub(c);i.assign(l)}else{var f=o.mul(t.decay).add(a.square().mul(1-t.decay));c=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),o.assign(f),s.assign(c),l=i.sub(c),i.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Jt(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Jt(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Jt(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(mh);fh(Eh);var Ch=function(){function e(){}return e.sgd=function(e){return new xh(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new wh(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new Eh(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new yh(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new gh(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new bh(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new vh(e,t)},e}(),Sh={sgd:Ch.sgd,momentum:Ch.momentum,adadelta:Ch.adadelta,adagrad:Ch.adagrad,rmsprop:Ch.rmsprop,adamax:Ch.adamax,adam:Ch.adam},Nh="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function Ah(){return new Promise((function(e){return Nh((function(){return e()}))}))}xe.prototype.add=function(e){return Tr(this,e)},xe.prototype.broadcastTo=function(e){return qu(this,e)},xe.prototype.div=function(e){return Oi(this,e)},xe.prototype.divNoNan=function(e){return Yu(this,e)},xe.prototype.squaredDifference=function(e){return yc(this,e)},xe.prototype.tile=function(e){return Ju(this,e)},xe.prototype.oneHot=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),ec(this,e,t,n)},xe.prototype.transpose=function(e){return ra(this,e)},xe.prototype.pad=function(e,t){return tc(this,e,t)},xe.prototype.batchNorm=function(e,t,n,r,i){return Ou(this,e,t,n,r,i)},ye=Pf},1221:(e,t)=>{"use strict";var n,r,i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=t.Rank||(t.Rank={})).R0="R0",o.R1="R1",o.R2="R2",o.R3="R3",o.R4="R4",o.R5="R5",o.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(n||(n={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(r||(r={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(i||(i={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(a||(a={}));var s={float32:i,int32:n,bool:r,complex64:a};function u(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return s[e][t]}t.upcastType=u,t.sumOutType=function(e){return u(e,"int32")}},9155:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2885);function i(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function a(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function o(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||f(e)&&!n)for(var r=0;r<e.length;++r)o(e[r],t,n);else t.push(e);return t}function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function u(e){return e%1==0}function c(e,t){var n=t.length;return a((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),a(e.every((function(e){return u(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function l(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function f(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function p(e){return"string"==typeof e||e instanceof String}function h(e){return"boolean"==typeof e}function d(e){return"number"==typeof e}function m(e,t,n){var r=new Array;if(1===t.length)for(var i=t[0],a=0;a<i;a++)r[a]=n[e+a];else{i=t[0];var o=t.slice(1),s=o.reduce((function(e,t){return e*t}));for(a=0;a<i;a++)r[a]=m(e+a*s,o,n)}return r}function g(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}t.shuffle=i,t.clamp=function(e,t,n){return Math.max(e,Math.min(t,n))},t.nearestLargerEven=function(e){return e%2==0?e:e+1},t.sum=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t},t.randUniform=function(e,t){var n=Math.random();return t*n+(1-n)*e},t.distSquared=function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},t.assert=a,t.assertShapesMatch=function(e,t,n){void 0===n&&(n=""),a(s(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))},t.assertNonNull=function(e){a(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))},t.flatten=o,t.sizeFromShape=function(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t},t.isScalarShape=function(e){return 0===e.length},t.arraysEqual=s,t.isInt=u,t.tanh=function(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)},t.sizeToSquarishShape=function(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]},t.createShuffledIndices=function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return i(t),t},t.rightPad=function(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)},t.repeatedTry=function(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0,o=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?i():setTimeout(o,s)}};o()}))},t.inferFromImplicitShape=function(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a},t.parseAxisParam=c,t.squeezeShape=function(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:c(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}},t.getTypedArrayFromDType=function(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n},t.getArrayFromDType=function(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n},t.checkConversionForErrors=l,t.isValidDtype=function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e},t.hasEncodingLoss=function(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)},t.isTypedArray=f,t.bytesPerElement=function(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)},t.bytesFromStringArray=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t},t.isString=p,t.isBoolean=h,t.isNumber=d,t.inferDtype=function e(t){return Array.isArray(t)?e(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":d(t)?"float32":p(t)?"string":h(t)?"bool":"float32"},t.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},t.nearestDivisor=function(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e},t.computeStrides=function(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n},t.toTypedArray=function(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=o(e)),n&&l(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)},t.toNestedArray=function(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return m(0,e,t)},t.makeOnesTypedArray=function(e,t){for(var n=g(e,t),r=0;r<n.length;r++)n[r]=1;return n},t.makeZerosTypedArray=g,t.now=function(){return r.env().platform.now()},t.assertNonNegativeIntegerDimensions=function(e){e.forEach((function(t){a(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))},t.fetch=function(e,t){return r.env().platform.fetch(e,t)},t.encodeString=function(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",r.env().platform.encode(e,t)},t.decodeString=function(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",r.env().platform.decode(e,t)},t.locToIndex=function(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=n[i]*e[i];return r},t.indexToLoc=function(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}},2342:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9674),i=n(6113);class a extends r.Component{componentDidMount(){const{name:e,tab:t}=this.props;this.props.registerSurface(e,t,this)}componentDidUpdate(){return!1}render(){const{name:e,visible:t,styles:n}=this.props,o=Object.assign({},a.defaultStyles,n),{width:s,height:u}=o;let{maxHeight:c,maxWidth:l}=o;c=u===a.defaultStyles.height?c:u,l=s===a.defaultStyles.width?l:s;const f=i.css({display:t?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:u,width:s,maxHeight:c,maxWidth:l,overflow:"auto"}),p=i.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),h=i.css({boxSizing:"border-box"});return r.h("div",{className:`${f} tf-surface`,ref:e=>this.container=e,"data-visible":t},r.h("div",{className:`${p} tf-label`,ref:e=>this.label=e},e),r.h("div",{className:`${h} tf-draw-area`,ref:e=>this.drawArea=e}))}}a.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},t.SurfaceComponent=a},2587:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9674),i=n(6113);class a extends r.Component{render(){const{tabNames:e,activeTab:t,handleClick:n}=this.props,a=e.length>0?e.map((e=>r.h(o,{key:e,id:e,handleClick:n,isActive:e===t},e))):null,s=i.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return r.h("div",{className:`${s} visor-tabs`},a)}}t.Tabs=a;class o extends r.Component{render(){const{children:e,isActive:t,handleClick:n,id:a}=this.props,o=i.css({borderBottomColor:t?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return r.h("a",{className:`${o} tf-tab`,"data-isactive":t,onClick:()=>n(a)},e)}}},8087:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9674),i=n(6113),a=n(2342),o=n(2587);class s extends r.Component{static render(e,t,n){return r.render(r.h(s,Object.assign({},n)),e,t)}constructor(e){super(e),this.surfaces=new Map;const t=null==e.startOpen||e.startOpen;this.state={isOpen:t,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(e,t){const n=this.surfaceId(e,t);let r;if(!this.surfaces.has(n))throw Error(`Surface not found with id: ${n}`);return r=this.surfaces.get(n),{container:r.container,label:r.label,drawArea:r.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(e,t){return e+t}setTabs(e){const t=e.map((e=>e.tab)),n=this.state.tabs;let r;for(const e of t)n.has(e)||(n.add(e),r=e);null!=r&&this.setState({tabs:n,activeTab:r})}getTabs(){return this.state.tabs}registerSurface(e,t,n){const r=this.surfaceId(e,t);this.surfaces.set(r,n)}keyHandler(e){192===e.keyCode&&(e.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(e){this.setState({activeTab:e})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(e){this.setTabs(e.surfaceList)}render(){const{isOpen:e,isFullscreen:t,activeTab:n}=this.state,{surfaceList:s}=this.props,c=Array.from(this.getTabs().values()),l=t?"90vw":"550px",f=i.css({width:l,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),p=i.css({right:"0"}),h=i.css({right:`calc(-${l} - 10px)`}),d=e?p:h,m=i.css({});return r.h("div",{className:`${f} ${d} visor`,"data-isopen":e,"data-isfullscreen":t},r.h(u,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:t}),r.h(o.Tabs,{tabNames:c,activeTab:n,handleClick:this.setActiveTab.bind(this)}),r.h("div",{className:`${m} visor-surfaces`},s.map((e=>r.h(a.SurfaceComponent,{key:e.name+e.tab,name:e.name,tab:e.tab,styles:e.styles,registerSurface:this.registerSurface.bind(this),visible:n===e.tab})))))}}function u(e){const{isFullScreen:t,fullScreenHandler:n,closeHandler:a}=e,o=i.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),s=i.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),u=i.css({marginLeft:"auto"});return r.h("div",{className:`${o} visor-controls`},r.h("button",{className:`${s}`,onClick:n},t?"Minimize":"Maximize"),r.h("button",{className:`${s} ${u}`,onClick:a},"Hide"))}t.VisorComponent=s},8810:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(75),n(4642);const r=n(4337),i=n(7412),a=n(8208),o=n(1825),s=n(485),u=n(3683),c=n(707),l=n(9962),f=n(1267),p=n(8685),h=n(3674),d=n(7450),m=n(8422);t.version_vis=m.version;const g={barchart:r.barchart,table:c.table,histogram:o.histogram,linechart:s.linechart,scatterplot:u.scatterplot,confusionMatrix:i.confusionMatrix,heatmap:a.heatmap};t.render=g;const v={accuracy:d.accuracy,perClassAccuracy:d.perClassAccuracy,confusionMatrix:d.confusionMatrix};t.metrics=v;const y={history:l.history,fitCallbacks:l.fitCallbacks,perClassAccuracy:p.perClassAccuracy,valuesDistribution:h.valuesDistribution,layer:f.layer,modelSummary:f.modelSummary};t.show=y;var b=n(4326);t.visor=b.visor,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(7511))},4337:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(9966)),o=n(3152),s=n(334);t.barchart=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const r=s.getDrawArea(e),i=t,l=Object.assign({},u,n);if(c.has(r)){const e=c.get(r);if(s.shallowEquals(l,e.lastOptions)){yield s.nextFrame();const t=e.view,n=t.changeset().remove((()=>!0)).insert(i);return void(yield t.change("values",n).runAsync())}}const{xLabel:f,yLabel:p,xType:h,yType:d}=l;let m=null;null!=f&&(m={title:f});let g,v=null;null!=p&&(v={title:p}),g=null!=l.color?Array.isArray(l.color)?{field:"index",type:"nominal",scale:{range:l.color}}:{value:l.color}:{value:"#4C78A0"};const y={width:l.width||o.getDefaultWidth(r),height:l.height||o.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:l.fontSize,titleFontSize:l.fontSize},text:{fontSize:l.fontSize},legend:{labelFontSize:l.fontSize,titleFontSize:l.fontSize}},data:{values:i,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:h,axis:m},y:{field:"value",type:d,axis:v},color:g}};yield s.nextFrame();const b=yield a.default(r,y,{actions:!1,mode:"vega-lite",defaultStyle:!1});c.set(r,{view:b.view,lastOptions:l})}))};const u={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},c=new Map},7412:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(9966)),o=n(3152),s=n(334);t.confusionMatrix=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const r=Object.assign({},u,n),i=s.getDrawArea(e),c=[],l=t.values,f=t.tickLabels||[],p=0===f.length;let h=!0;for(let e=0;e<l.length;e++){const t=p?`Class ${e}`:f[e];p&&f.push(t);for(let n=0;n<l[e].length;n++){const i=p?`Class ${n}`:f[n],a=l[e][n];e!==n||r.shadeDiagonal?(c.push({label:t,prediction:i,count:a,scaleCount:a}),0!==a&&(h=!1)):c.push({label:t,prediction:i,count:a,noFill:!0})}}if(!r.shadeDiagonal&&h)for(const e of c)!0===e.noFill&&(e.noFill=!1,e.scaleCount=e.count);const d={width:r.width||o.getDefaultWidth(i),height:r.height||o.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},data:{values:c},encoding:{x:{field:"prediction",type:"ordinal",title:r.xLabel||"prediction",scale:{domain:f}},y:{field:"label",type:"ordinal",title:r.yLabel||"label",scale:{domain:f}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:r.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};!1===r.shadeDiagonal&&d.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),r.showTextOverlay&&d.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const m="string"==typeof r.colorMap?{scheme:r.colorMap}:r.colorMap;d.layer[0].encoding.color.scale.range=m,yield a.default(i,d,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))};const u={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},8208:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(75)),s=a(n(9966)),u=n(3152),c=n(3538),l=n(334);function f(e,t,n){const r=e instanceof o.Tensor?e.shape:[e.length,e[0].length];0===n?c.assert(r[0]===t.length,`Length of xTickLabels (${t.length}) must match number of rows (${r[0]})`):1===n&&c.assert(r[1]===t.length,`Length of yTickLabels (${t.length}) must match number of columns (${r[1]})`)}t.heatmap=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const i=Object.assign({},p,n),a=l.getDrawArea(e);let h=t.values;i.rowMajor&&(h=yield function(e){return r(this,void 0,void 0,(function*(){let t,n;e instanceof o.Tensor?(t=e.shape,n=e.transpose()):(t=[e.length,e[0].length],n=o.tidy((()=>o.tensor2d(e).transpose()))),c.assert(2===n.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const r=yield n.array();n.dispose();const i=[r.length,r[0].length];return c.assert(t[0]===i[1]&&t[1]===i[0],`Unexpected transposed shape. Original ${t} : Transposed ${i}`),r}))}(t.values));const{xTickLabels:d,yTickLabels:m}=t;null!=d&&f(h,d,0),null!=m&&f(h,m,1);const g=[];if(h instanceof o.Tensor){c.assert(2===h.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const e=yield h.data(),[t,n]=h.shape;for(let r=0;r<t;r++){const t=d?`${d[r]}@tfidx@${r}`:r;for(let i=0;i<n;i++){const a=m?`${m[i]}@tfidx@${i}`:i,o=e[r*n+i];g.push({x:t,y:a,value:o})}}}else{const e=h;for(let t=0;t<e.length;t++){const n=d?`${d[t]}@tfidx@${t}`:t;for(let r=0;r<e[t].length;r++){const i=m?`${m[r]}@tfidx@${r}`:r,a=e[t][r];g.push({x:n,y:i,value:a})}}}const v={actions:!1,mode:"vega-lite",defaultStyle:!1},y={width:i.width||u.getDefaultWidth(a),height:i.height||u.getDefaultHeight(a),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:g},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:i.xType,title:i.xLabel,sort:!1},y:{field:"y",type:i.yType,title:i.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},b=new RegExp("@tfidx@\\d+$");let x;switch(d&&(y.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),m&&(y.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(d||m)&&(v.tooltip={sanitize:e=>String(e).replace(b,"")}),i.colorMap){case"blues":x=["#f7fbff","#4292c6"];break;case"greyscale":x=["#000000","#ffffff"];break;default:x="viridis"}if("viridis"!==x&&(y.encoding.fill.scale={range:x}),i.domain){const e=y.encoding.fill;null!=e.scale?e.scale=Object.assign({},e.scale,{domain:i.domain}):e.scale={domain:i.domain}}yield s.default(a,y,v)}))};const p={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},1825:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(6722),o=i(n(9966)),s=n(3152),u=n(7450),c=n(707),l={maxBins:12,fontSize:11};t.histogram=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const r=function(e){if(null==e.length)throw new Error("input data must be an array");if(0===e.length)return[];if("object"==typeof e[0]){if(null==e[0].value)throw new Error("input data must have a value field");return e}{const t=Array(e.length);for(let n=0;n<e.length;n++)t[n]={value:e[n]};return t}}(t),i=Object.assign({},l,n),f=s.subSurface(e,"histogram");if(!1!==n.stats){const t=s.subSurface(e,"stats",{prepend:!0});let o;o=n.stats?n.stats:u.arrayStats(r.map((e=>e.value))),function(e,t,n){const r=a.format(",.4~f"),i=a.format(".4~p"),o=[],s=[];if(null!=e.numVals&&(o.push("Num Vals"),s.push(r(e.numVals))),null!=e.min&&(o.push("Min"),s.push(r(e.min))),null!=e.max&&(o.push("Max"),s.push(r(e.max))),null!=e.numZeros){o.push("# Zeros");let t="";e.numVals&&(t=e.numZeros>0?`(${i(e.numZeros/e.numVals)})`:""),s.push(`${r(e.numZeros)} ${t}`)}if(null!=e.numNans){o.push("# NaNs");let t="";e.numVals&&(t=e.numNans>0?`(${i(e.numNans/e.numVals)})`:""),s.push(`${r(e.numNans)} ${t}`)}if(null!=e.numInfs){o.push("# Infinity");let t="";e.numVals&&(t=e.numInfs>0?`(${i(e.numInfs/e.numVals)})`:""),s.push(`${r(e.numInfs)} ${t}`)}c.table(t,{headers:o,values:[s]},n)}(o,t,{fontSize:i.fontSize})}if(0===r.length)return;const p=[];for(let e=0;e<r.length;e++){const t=r[e].value;null!=t&&isFinite(t)&&p.push(r[e])}const h={width:i.width||s.getDefaultWidth(f),height:i.height||s.getDefaultHeight(f),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:p},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},encoding:{x:{bin:{maxbins:i.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:i.color||"#001B44"}}};return o.default(f,h,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))}},485:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(9966)),o=n(3152),s=n(3538),u=n(334);t.linechart=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const r=Array.isArray(t.values[0])?t.values:[t.values],i=r[0].length,l=t.series?t.series:r.map(((e,t)=>`Series ${t+1}`));s.assert(l.length===r.length,"Must have an equal number of series labels as there are data series"),null!=n.seriesColors&&s.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const f=[];for(let e=0;e<i;e++){const t={x:e};l.forEach(((n,i)=>{const a=r[i][e].y;t[n]=a,t[`${n}-name`]=n})),f.push(t)}const p=Object.assign({},c,n),h={x:{field:"x",type:p.xType,title:p.xLabel},tooltip:[{field:"x",type:"quantitative"},...l.map((e=>({field:e,type:"quantitative"})))]},d=l.map((e=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:e,type:p.yType,title:p.yLabel,scale:p.zoomToFit?{zero:!1}:null!=p.yAxisDomain?{domain:p.yAxisDomain}:void 0},color:{field:`${e}-name`,type:"nominal",legend:{values:l,title:null},scale:{range:p.seriesColors}}}}))),m=u.getDrawArea(e),g={width:p.width||o.getDefaultWidth(m),height:p.height||o.getDefaultHeight(m),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:p.fontSize,titleFontSize:p.fontSize},text:{fontSize:p.fontSize},legend:{labelFontSize:p.fontSize,titleFontSize:p.fontSize}},data:{values:f},encoding:h,layer:[...d,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield a.default(m,g,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const c={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},334:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(7511),a=n(4326);t.getDrawArea=function(e){if(e instanceof HTMLElement)return e;if(i.isSurface(e))return e.drawArea;if(i.isSurfaceInfo(e))return a.visor().surface({name:e.name,tab:e.tab,styles:e.styles}).drawArea;throw new Error("Not a drawable")},t.shallowEquals=function(e,t){const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++){const i=n[r];if(e[i]!==t[i])return!1}return!0},t.nextFrame=function(){return r(this,void 0,void 0,(function*(){yield new Promise((e=>requestAnimationFrame(e)))}))}},3683:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(9966)),o=n(3152),s=n(3538),u=n(334);t.scatterplot=function(e,t,n={}){return r(this,void 0,void 0,(function*(){let r=t.values;const i=null==t.series?[]:t.series;r=Array.isArray(r[0])?r:[r];const l=[];r.forEach(((e,t)=>{const n=null!=i[t]?i[t]:`Series ${t+1}`,r=e.map((e=>Object.assign({},e,{series:n})));l.push(...r)})),null!=n.seriesColors&&s.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const f=u.getDrawArea(e),p=Object.assign({},c,n),h={width:p.width||o.getDefaultWidth(f),height:p.height||o.getDefaultHeight(f),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:p.fontSize,titleFontSize:p.fontSize},text:{fontSize:p.fontSize},legend:{labelFontSize:p.fontSize,titleFontSize:p.fontSize}},data:{values:l},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:p.xType,title:p.xLabel,scale:p.zoomToFit?{zero:!1}:null!=p.xAxisDomain?{domain:p.xAxisDomain}:void 0},y:{field:"y",type:p.yType,title:p.yLabel,scale:p.zoomToFit?{zero:!1}:null!=p.yAxisDomain?{domain:p.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:p.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield a.default(f,h,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const c={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},707:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(6722),i=n(4677),a=n(6113),o=n(334);t.table=function(e,t,n={}){if(t&&null==t.headers)throw new Error('Data to render must have a "headers" property');if(t&&null==t.values)throw new Error('Data to render must have a "values" property');const u=o.getDrawArea(e),c=Object.assign({},s,n);let l=i.select(u).select("table.tf-table");const f=a.css({fontSize:c.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(0===l.size()&&(l=i.select(u).append("table"),l.attr("class",` ${f} tf-table`),l.append("thead").append("tr"),l.append("tbody")),1!==l.size())throw new Error("Error inserting table");const p=a.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),h=l.select("thead").select("tr").selectAll("th").data(t.headers),d=h.enter().append("th").attr("class",`${p}`);h.merge(d).html((e=>e)),h.exit().remove();const m=r.format(",.4~f"),g=l.select("tbody").selectAll("tr").data(t.values),v=g.enter().append("tr"),y=a.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),b=g.merge(v).selectAll("td").data((e=>e)),x=b.enter().append("td").attr("class",`${y}`);b.merge(x).html((e=>"number"==typeof e?m(e):e)),b.exit().remove(),g.exit().remove()};const s={fontSize:14}},9962:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(485),a=n(334),o=n(3152);function s(e,t,n,s={}){return r(this,void 0,void 0,(function*(){const r=a.getDrawArea(e),l={};for(const e of n)if(/val_/.test(e)){const r=e.replace("val_","");u(l,r);const i=c(t,e,n.indexOf(e));l[r].series.push(e),l[r].values.push(i)}else{const r=c(t,e,n.indexOf(e));u(l,e),l[e].series.push(e),l[e].values.push(r)}const f=Object.keys(l),p=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},s),h=[];for(const e of f){const t=o.subSurface(r,e),n=l[e].series,a=l[e].values;n.every((e=>Boolean(e.match("acc"))))&&(p.zoomToFitAccuracy?p.zoomToFit=!0:(p.yAxisDomain=[0,1],delete p.zoomToFit));const s=i.linechart(t,{values:a,series:n},p);h.push(s)}yield Promise.all(h)}))}function u(e,t){null==e[t]&&(e[t]={series:[],values:[]})}function c(e,t,n){if(Array.isArray(e)){const r=Array.isArray(e[0])?e[n]:e,i=[];for(let e=0;e<r.length;e++){const n=r[e];i.push({x:e,y:n[t]})}return i}return e.history[t].map(((e,t)=>({x:t,y:e})))}function l(e,t,n){return null==e[t]&&(e[t]={}),null==e[t][n]&&(e[t][n]=[]),e[t][n]}t.history=s,t.fitCallbacks=function(e,t,n={}){const i={},u=n.callbacks||["onEpochEnd","onBatchEnd"],c=a.getDrawArea(e),f=Object.assign({},n);delete f.callbacks;const p={};return u.forEach((e=>{p[e]=function(e){return(n,u)=>r(this,void 0,void 0,(function*(){/batch/i.test(e)?f.xLabel="Batch":/epoch/i.test(e)&&(f.xLabel="Epoch");const n=[],r=[];for(const a of t)if(null!=u[a]){r.push(a);const t=l(i,e,a);t.push({[a]:u[a]}),n.push(t)}s(o.subSurface(c,e,{title:e}),n,r,f),yield a.nextFrame()}))}(e)})),p}},1267:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1825),a=n(334),o=n(707),s=n(3152),u=n(7450);function c(e){let t;return t=Array.isArray(e.outputShape[0])?`[${e.outputShape.map((e=>l(e))).join(", ")}]`:l(e.outputShape),{name:e.name,trainable:e.trainable,parameters:e.countParams(),outputShape:t}}function l(e){const t=e.slice();return 0===t.length?"Scalar":(null===t[0]&&(t[0]="batch"),`[${t.join(",")}]`)}t.modelSummary=function(e,t){return r(this,void 0,void 0,(function*(){const n=a.getDrawArea(e),r=function(e){return{layers:e.layers.map(c)}}(t),i=r.layers.map((e=>[e.name,e.outputShape,e.parameters,e.trainable]));o.table(n,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:i})}))},t.layer=function(e,t){return r(this,void 0,void 0,(function*(){const n=a.getDrawArea(e),c=yield function(e){return r(this,void 0,void 0,(function*(){const t=e.getWeights(),n=e.weights,r=t.map(u.tensorStats),i=yield Promise.all(r),a=t.map((e=>e.shape));return t.map(((e,t)=>({name:n[t].name,stats:i[t],shape:l(a[t]),weight:e})))}))}(t),f=s.subSurface(n,"layer-weights-info"),p=c.map((e=>[e.name,e.shape,e.stats.min,e.stats.max,e.weight.size,e.stats.numZeros,e.stats.numNans,e.stats.numInfs]));o.table(f,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:p});const h=s.subSurface(n,"select-layer"),d=s.subSurface(n,"param-distribution");!function(e,t,n){const r=`<div><button>Show Values Distribution for:</button>${`\n    <select>\n      ${e.map((e=>`<option value=${e}>${e}</option>`))}\n    </select>\n  `}</div>`;t.innerHTML=r;const i=t.querySelector("button"),a=t.querySelector("select");i.addEventListener("click",(()=>{n(a.selectedOptions[0].label)}))}(c.map((e=>e.name)),h,(e=>r(this,void 0,void 0,(function*(){const t=c.filter((t=>t.name===e))[0],n=yield t.weight.data();i.histogram(d,n,{height:150,width:460,stats:!1})}))))}))}},8685:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(334),a=n(707);t.perClassAccuracy=function(e,t,n){return r(this,void 0,void 0,(function*(){const r=i.getDrawArea(e),o=[];for(let e=0;e<t.length;e++){const r=n?n[e]:e.toString(),i=t[e];o.push([r,i.accuracy,i.count])}return a.table(r,{headers:["Class","Accuracy","# Samples"],values:o})}))}},3674:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1825),a=n(334),o=n(7450);t.valuesDistribution=function(e,t){return r(this,void 0,void 0,(function*(){const n=a.getDrawArea(e),r=yield o.tensorStats(t),s=yield t.data();i.histogram(n,s,{height:150,stats:r})}))}},7511:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSurfaceInfo=function(e){return null!=e.name},t.isSurface=function(e){return e.drawArea instanceof HTMLElement}},3152:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(6113),i=n(334),a={prepend:!1};t.subSurface=function(e,t,n={}){const o=i.getDrawArea(e),s=r.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),u=r.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),c=Object.assign({},a,n);let l=o.querySelector(`div[data-name=${t}]`);if(!l){if(l=document.createElement("div"),l.setAttribute("class",`${s}`),l.dataset.name=t,c.title){const e=document.createElement("div");e.setAttribute("class",`subsurface-title ${u}`),e.innerText=c.title,l.appendChild(e)}c.prepend?o.insertBefore(l,o.firstChild):o.appendChild(l)}return l},t.getDefaultWidth=function(e){let t=0,n=e;for(;n&&0===n.clientWidth;)n=n.parentElement,t=50;return n.clientWidth-t},t.getDefaultHeight=function(e){return 0===e.clientHeight?200:e.clientHeight}},7450:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(75),a=n(3538);t.arrayStats=function(e){if(!Array.isArray(e))throw new Error("input must be an array");if(0===e.length)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const t=e.length;let n=-1/0,r=1/0,i=0,a=0,o=0;for(let s=0;s<t;s++){const t=e[s];t>n&&(n=t),t<r&&(r=t),0===t&&(i+=1),isNaN(t)?a+=1:isFinite(t)||(o+=1)}const s={numVals:t,numZeros:i,numNans:a,max:n,min:r,numInfs:o};return s.max===-1/0&&(s.max=NaN),s.min===1/0&&(s.min=NaN),s},t.tensorStats=function(e){return r(this,void 0,void 0,(function*(){const[t,n,r]=i.tidy((()=>{const t=i.scalar(0,e.dtype);return[e.min(),e.max(),e.equal(t).sum()]}));return Promise.all([e.data(),t.data(),n.data(),r.data()]).then((([e,t,n,r])=>{const i=e.length;let a=0,o=0;for(let t=0;t<i;t++){const n=e[t];isNaN(n)?a+=1:isFinite(n)||(o+=1)}let s=t[0],u=n[0];return a===i&&(s=NaN,u=NaN),{numVals:i,numZeros:r[0],numNans:a,min:s,max:u,numInfs:o}}))}))},t.confusionMatrix=function(e,t,n,o){return r(this,void 0,void 0,(function*(){a.assert(1===e.rank,"labels must be a 1D tensor"),a.assert(1===t.rank,"predictions must be a 1D tensor"),a.assert(e.size===t.size,"labels and predictions must be the same length"),null!=o&&a.assert(o.size===t.size,"labels and predictions must be the same length");const r=e.cast("int32"),s=t.cast("int32");null==n&&(n=i.tidy((()=>i.maximum(r.max(),s.max()).cast("int32").dataSync()[0]+1)));let u=Promise.resolve(null);return null!=o&&(u=o.data()),Promise.all([r.data(),s.data(),u]).then((([e,t,r])=>{const i=Array(n).fill(0);for(let e=0;e<n;e++)i[e]=Array(n).fill(0);for(let n=0;n<e.length;n++){const a=e[n],o=t[n];i[a][o]+=null!=r?r[n]:1}return i}))}))},t.accuracy=function(e,t){return r(this,void 0,void 0,(function*(){a.assertShapesMatch(e.shape,t.shape,"Error computing accuracy.");const n=e.equal(t),r=n.mean(),o=(yield r.data())[0];return i.dispose([n,r]),o}))},t.perClassAccuracy=function(e,t,n){return r(this,void 0,void 0,(function*(){return a.assert(1===e.rank,"labels must be a 1D tensor"),a.assert(1===t.rank,"predictions must be a 1D tensor"),a.assert(e.size===t.size,"labels and predictions must be the same length"),null==n&&(n=i.tidy((()=>i.maximum(e.max(),t.max()).dataSync()[0]+1))),Promise.all([e.data(),t.data()]).then((([e,t])=>{const r=Array(n).fill(0),i=Array(n).fill(0);for(let n=0;n<e.length;n++){const a=e[n],o=t[n];r[a]+=1,a===o&&(i[a]+=1)}const a=[];for(let e=0;e<r.length;e++)a.push({count:r[e],accuracy:0===r[e]?0:i[e]/r[e]});return a}))}))}},3538:(e,t)=>{"use strict";function n(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function r(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.assert=n,t.assertShapesMatch=function(e,t,i=""){n(r(e,t),i+` Shapes ${e} and ${t} must match`)},t.arraysEqual=r,t.DECIMAL_PLACES_TO_CHECK=4},8422:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="1.5.1"},4326:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8087);let i;const a="tfjs-visor-container";t.visor=function(){if("undefined"==typeof document)throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(a)&&null!=i)return i;let e,t=document.getElementById(a);function n(t,n){let i=null;return e=r.VisorComponent.render(t,e,{ref:e=>i=e,surfaceList:Array.from(n.values())}),i}null==t&&(t=document.createElement("div"),t.id=a,document.body.appendChild(t));const s=new Map,u=n(t,s);return i=new o(u,t,s,n),i};class o{constructor(e,t,n,r){this.visorComponent=e,this.el=t,this.surfaceList=n,this.renderVisor=r}surface(e){const{name:t}=e,n=null==e.tab?"Visor":e.tab;if(null==t||!("string"==typeof t||t instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const r=Object.assign({},e,{tab:n}),i=`${t}-${n}`;return this.surfaceList.has(i)||this.surfaceList.set(i,r),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(t,n)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(e){if(!this.visorComponent.state.tabs.has(e))throw new Error(`Tab '${e}' does not exist`);this.visorComponent.setState({activeTab:e})}}t.Visor=o},2099:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AdadeltaOptimizer:()=>i.AdadeltaOptimizer,AdagradOptimizer:()=>i.AdagradOptimizer,AdamOptimizer:()=>i.AdamOptimizer,AdamaxOptimizer:()=>i.AdamaxOptimizer,Add:()=>i.Add,AddN:()=>i.AddN,BroadcastTo:()=>i.BroadcastTo,Callback:()=>na,CallbackList:()=>Nt,CustomCallback:()=>Dt,DataStorage:()=>i.DataStorage,Div:()=>i.Div,ENV:()=>i.ENV,EarlyStopping:()=>aa,Environment:()=>i.Environment,FromPixels:()=>i.FromPixels,FusedBatchNorm:()=>i.FusedBatchNorm,GraphModel:()=>sa.GraphModel,History:()=>kt,Identity:()=>i.Identity,InputSpec:()=>ft,KernelBackend:()=>i.KernelBackend,LayerVariable:()=>ut,LayersModel:()=>zn,MaxPoolWithArgmax:()=>i.MaxPoolWithArgmax,MomentumOptimizer:()=>i.MomentumOptimizer,NonMaxSuppressionV5:()=>i.NonMaxSuppressionV5,OneHot:()=>i.OneHot,Optimizer:()=>i.Optimizer,PadV2:()=>i.PadV2,RMSPropOptimizer:()=>i.RMSPropOptimizer,RNN:()=>Di,Rank:()=>i.Rank,Reduction:()=>i.Reduction,SGDOptimizer:()=>i.SGDOptimizer,Sequential:()=>Ln,Square:()=>i.Square,SquaredDifference:()=>i.SquaredDifference,SymbolicTensor:()=>pt,Tensor:()=>i.Tensor,TensorBuffer:()=>i.TensorBuffer,Tile:()=>i.Tile,Transpose:()=>i.Transpose,Variable:()=>i.Variable,abs:()=>i.abs,acos:()=>i.acos,acosh:()=>i.acosh,add:()=>i.add,addN:()=>i.addN,addStrict:()=>i.addStrict,all:()=>i.all,any:()=>i.any,argMax:()=>i.argMax,argMin:()=>i.argMin,asin:()=>i.asin,asinh:()=>i.asinh,atan:()=>i.atan,atan2:()=>i.atan2,atanh:()=>i.atanh,avgPool:()=>i.avgPool,avgPool3d:()=>i.avgPool3d,backend:()=>i.backend,backend_util:()=>i.backend_util,basicLSTMCell:()=>i.basicLSTMCell,batchNorm:()=>i.batchNorm,batchNorm2d:()=>i.batchNorm2d,batchNorm3d:()=>i.batchNorm3d,batchNorm4d:()=>i.batchNorm4d,batchNormalization:()=>i.batchNormalization,batchNormalization2d:()=>i.batchNormalization2d,batchNormalization3d:()=>i.batchNormalization3d,batchNormalization4d:()=>i.batchNormalization4d,batchToSpaceND:()=>i.batchToSpaceND,booleanMaskAsync:()=>i.booleanMaskAsync,broadcastTo:()=>i.broadcastTo,browser:()=>i.browser,buffer:()=>i.buffer,callbacks:()=>oa,cast:()=>i.cast,ceil:()=>i.ceil,clipByValue:()=>i.clipByValue,clone:()=>i.clone,complex:()=>i.complex,concat:()=>i.concat,concat1d:()=>i.concat1d,concat2d:()=>i.concat2d,concat3d:()=>i.concat3d,concat4d:()=>i.concat4d,constraints:()=>H,conv1d:()=>i.conv1d,conv2d:()=>i.conv2d,conv2dTranspose:()=>i.conv2dTranspose,conv3d:()=>i.conv3d,conv3dTranspose:()=>i.conv3dTranspose,cos:()=>i.cos,cosh:()=>i.cosh,cumsum:()=>i.cumsum,customGrad:()=>i.customGrad,data:()=>r,deprecationWarn:()=>i.deprecationWarn,depthToSpace:()=>i.depthToSpace,depthwiseConv2d:()=>i.depthwiseConv2d,deregisterOp:()=>sa.deregisterOp,diag:()=>i.diag,disableDeprecationWarnings:()=>i.disableDeprecationWarnings,dispose:()=>i.dispose,disposeVariables:()=>i.disposeVariables,div:()=>i.div,divNoNan:()=>i.divNoNan,divStrict:()=>i.divStrict,dot:()=>i.dot,dropout:()=>i.dropout,elu:()=>i.elu,enableDebugMode:()=>i.enableDebugMode,enableProdMode:()=>i.enableProdMode,engine:()=>i.engine,env:()=>i.env,equal:()=>i.equal,equalStrict:()=>i.equalStrict,erf:()=>i.erf,exp:()=>i.exp,expandDims:()=>i.expandDims,expm1:()=>i.expm1,eye:()=>i.eye,fft:()=>i.fft,fill:()=>i.fill,findBackend:()=>i.findBackend,findBackendFactory:()=>i.findBackendFactory,floor:()=>i.floor,floorDiv:()=>i.floorDiv,frame:()=>i.frame,fused:()=>i.fused,gather:()=>i.gather,gatherND:()=>i.gatherND,gather_util:()=>i.gather_util,getBackend:()=>i.getBackend,getGradient:()=>i.getGradient,getKernel:()=>i.getKernel,getKernelsForBackend:()=>i.getKernelsForBackend,grad:()=>i.grad,grads:()=>i.grads,greater:()=>i.greater,greaterEqual:()=>i.greaterEqual,greaterEqualStrict:()=>i.greaterEqualStrict,greaterStrict:()=>i.greaterStrict,hammingWindow:()=>i.hammingWindow,hannWindow:()=>i.hannWindow,ifft:()=>i.ifft,imag:()=>i.imag,image:()=>i.image,inTopKAsync:()=>i.inTopKAsync,initializers:()=>Je,input:()=>Wn,io:()=>i.io,irfft:()=>i.irfft,isFinite:()=>i.isFinite,isInf:()=>i.isInf,isNaN:()=>i.isNaN,keep:()=>i.keep,layers:()=>Zi,leakyRelu:()=>i.leakyRelu,less:()=>i.less,lessEqual:()=>i.lessEqual,lessEqualStrict:()=>i.lessEqualStrict,lessStrict:()=>i.lessStrict,linalg:()=>i.linalg,linspace:()=>i.linspace,loadGraphModel:()=>sa.loadGraphModel,loadLayersModel:()=>qn,localResponseNormalization:()=>i.localResponseNormalization,log:()=>i.log,log1p:()=>i.log1p,logSigmoid:()=>i.logSigmoid,logSoftmax:()=>i.logSoftmax,logSumExp:()=>i.logSumExp,logicalAnd:()=>i.logicalAnd,logicalNot:()=>i.logicalNot,logicalOr:()=>i.logicalOr,logicalXor:()=>i.logicalXor,losses:()=>i.losses,matMul:()=>i.matMul,math:()=>i.math,max:()=>i.max,maxPool:()=>i.maxPool,maxPool3d:()=>i.maxPool3d,maxPoolWithArgmax:()=>i.maxPoolWithArgmax,maximum:()=>i.maximum,maximumStrict:()=>i.maximumStrict,mean:()=>i.mean,memory:()=>i.memory,metrics:()=>Qi,min:()=>i.min,minimum:()=>i.minimum,minimumStrict:()=>i.minimumStrict,mod:()=>i.mod,modStrict:()=>i.modStrict,model:()=>jn,models:()=>ea,moments:()=>i.moments,movingAverage:()=>i.movingAverage,mul:()=>i.mul,mulStrict:()=>i.mulStrict,multiRNNCell:()=>i.multiRNNCell,multinomial:()=>i.multinomial,neg:()=>i.neg,nextFrame:()=>i.nextFrame,norm:()=>i.norm,notEqual:()=>i.notEqual,notEqualStrict:()=>i.notEqualStrict,oneHot:()=>i.oneHot,ones:()=>i.ones,onesLike:()=>i.onesLike,op:()=>i.op,outerProduct:()=>i.outerProduct,pad:()=>i.pad,pad1d:()=>i.pad1d,pad2d:()=>i.pad2d,pad3d:()=>i.pad3d,pad4d:()=>i.pad4d,pool:()=>i.pool,pow:()=>i.pow,powStrict:()=>i.powStrict,prelu:()=>i.prelu,print:()=>i.print,prod:()=>i.prod,profile:()=>i.profile,rand:()=>i.rand,randomGamma:()=>i.randomGamma,randomNormal:()=>i.randomNormal,randomUniform:()=>i.randomUniform,range:()=>i.range,ready:()=>i.ready,real:()=>i.real,reciprocal:()=>i.reciprocal,registerBackend:()=>i.registerBackend,registerCallbackConstructor:()=>Vn,registerGradient:()=>i.registerGradient,registerKernel:()=>i.registerKernel,registerOp:()=>sa.registerOp,regularizers:()=>ta,relu:()=>i.relu,relu6:()=>i.relu6,removeBackend:()=>i.removeBackend,reshape:()=>i.reshape,reverse:()=>i.reverse,reverse1d:()=>i.reverse1d,reverse2d:()=>i.reverse2d,reverse3d:()=>i.reverse3d,reverse4d:()=>i.reverse4d,rfft:()=>i.rfft,round:()=>i.round,rsqrt:()=>i.rsqrt,scalar:()=>i.scalar,scatterND:()=>i.scatterND,scatter_util:()=>i.scatter_util,selu:()=>i.selu,separableConv2d:()=>i.separableConv2d,sequential:()=>Un,serialization:()=>i.serialization,setBackend:()=>i.setBackend,setPlatform:()=>i.setPlatform,setdiff1dAsync:()=>i.setdiff1dAsync,sigmoid:()=>i.sigmoid,sign:()=>i.sign,signal:()=>i.signal,sin:()=>i.sin,sinh:()=>i.sinh,slice:()=>i.slice,slice1d:()=>i.slice1d,slice2d:()=>i.slice2d,slice3d:()=>i.slice3d,slice4d:()=>i.slice4d,slice_util:()=>i.slice_util,softmax:()=>i.softmax,softplus:()=>i.softplus,spaceToBatchND:()=>i.spaceToBatchND,sparseToDense:()=>i.sparseToDense,spectral:()=>i.spectral,split:()=>i.split,sqrt:()=>i.sqrt,square:()=>i.square,squaredDifference:()=>i.squaredDifference,squaredDifferenceStrict:()=>i.squaredDifferenceStrict,squeeze:()=>i.squeeze,stack:()=>i.stack,step:()=>i.step,stft:()=>i.stft,stridedSlice:()=>i.stridedSlice,sub:()=>i.sub,subStrict:()=>i.subStrict,sum:()=>i.sum,sumOutType:()=>i.sumOutType,tan:()=>i.tan,tanh:()=>i.tanh,tensor:()=>i.tensor,tensor1d:()=>i.tensor1d,tensor2d:()=>i.tensor2d,tensor3d:()=>i.tensor3d,tensor4d:()=>i.tensor4d,tensor5d:()=>i.tensor5d,tensor6d:()=>i.tensor6d,tensor_util:()=>i.tensor_util,test_util:()=>i.test_util,tidy:()=>i.tidy,tile:()=>i.tile,time:()=>i.time,topk:()=>i.topk,train:()=>i.train,transpose:()=>i.transpose,truncatedNormal:()=>i.truncatedNormal,unregisterGradient:()=>i.unregisterGradient,unregisterKernel:()=>i.unregisterKernel,unsortedSegmentSum:()=>i.unsortedSegmentSum,unstack:()=>i.unstack,util:()=>i.util,valueAndGrad:()=>i.valueAndGrad,valueAndGrads:()=>i.valueAndGrads,variable:()=>i.variable,variableGrads:()=>i.variableGrads,version:()=>Bo,version_converter:()=>sa.version_converter,version_core:()=>i.version_core,version_layers:()=>un,webgl:()=>i.webgl,where:()=>i.where,whereAsync:()=>i.whereAsync,zeros:()=>i.zeros,zerosLike:()=>i.zerosLike});var r={};n.r(r),n.d(r,{CSVDataset:()=>ho,Dataset:()=>eo,FileDataSource:()=>Do,TextLineDataset:()=>oo,URLDataSource:()=>_o,array:()=>no,csv:()=>Mo,func:()=>To,generator:()=>Oo,microphone:()=>Fo,version_data:()=>Ro,webcam:()=>Io,zip:()=>ro});var i=n(75),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s,u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function c(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function f(){return null==s&&(s=(0,i.backend)().epsilon()),s}var p=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(Error),h=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(Error),d=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(Error),m=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(Error),g=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(Error);function v(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}return(n=new Array(t)).fill(e),n}function y(e,t){if(!e)throw new g(t)}function b(e,t){for(var n=0,r=0,i=e;r<i.length;r++)i[r]===t&&n++;return n}function x(e){return 1===e.length?e[0]:e}function w(e){return Array.isArray(e)?e:[e]}function E(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function C(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}!function(e){o((function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}),e)}(Error);var S={};function N(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function A(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((function(e){return A(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=e[r];null!=i&&"object"==typeof i&&(Array.isArray(i)||"ndarray"!==i.type||"number"!=typeof i.value?A(i):e[r]=i.value)}}function k(e,t,n,r,i){var a,o,s;if(void 0===t&&(t={}),void 0===n&&(n={}),void 0===r&&(r="object"),void 0===i&&(i=!1),"string"==typeof e){var c=e,l=void 0;if(c in n)l=n[c];else if(c in S)l=S[c];else if(null==(l=t[c]))throw new d("Unknown "+r+": "+e+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return l}var f=e;if(null==f.className||null==f.config)throw new d(r+": Improper config format: "+JSON.stringify(f)+".\n'className' and 'config' must set.");var p=f.className,h=void 0,m=void 0;if(p in n?(h=(a=n[p])[0],m=a[1]):p in S?(h=(o=S.className)[0],m=o[1]):p in t&&(h=(s=t[p])[0],m=s[1]),null==h)throw new d("Unknown "+r+": "+p+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=m){for(var g={},v=0,y=Object.keys(S);v<y.length;v++)g[N=y[v]]=S[N];for(var b=0,x=Object.keys(n);b<x.length;b++)g[N=x[b]]=n[N];f.config.customObjects=g;for(var w=u({},S),E=0,C=Object.keys(n);E<C.length;E++){var N=C[E];S[N]=n[N]}A(f.config);var k=m(h,f.config,n,i);return S=u({},w),k}w=u({},S);for(var D=0,_=Object.keys(n);D<_.length;D++)N=_[D],S[N]=n[N];return k=new h(f.config),S=u({},w),k}function D(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function _(e){if(null==e)return e;for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];-1===t.indexOf(i)&&t.push(i)}return t}function M(e){if(null==e)throw new d("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function T(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new d(n+" is not a valid "+t+".  Valid values are "+e+" or null/undefined.")}function O(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),y(n>=0),y(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function I(e,t){Array.isArray(e)?(i.util.assert(e.length>0,(function(){return t+" is unexpectedly an empty array."})),e.forEach((function(e,n){return I(e,"element "+(n+1)+" of "+t)}))):i.util.assert(Number.isInteger(e)&&e>0,(function(){return"Expected "+t+" to be a positive integer, but got "+F(e)+"."}))}function F(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return F(e)})).join(",")+"]":"string"==typeof e?'"'+e+'"':""+e}function R(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function B(e,t){return(0,i.tidy)((function(){return(0,i.sqrt)((0,i.sum)((0,i.mulStrict)(e,e),t,!0))}))}var z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.getConfig=function(){return{}},t}(i.serialization.Serializable),P=function(e){function t(t){var n=e.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return o(t,e),t.prototype.apply=function(e){var t=this;return(0,i.tidy)((function(){var n=B(e,t.axis),r=(0,i.clipByValue)(n,0,t.maxValue);return(0,i.mul)(e,(0,i.div)(r,(0,i.add)(f(),n)))}))},t.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},t.className="MaxNorm",t}(z);i.serialization.registerClass(P);var L=function(e){function t(t){var n=e.call(this)||this;return n.defaultAxis=0,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return o(t,e),t.prototype.apply=function(e){var t=this;return(0,i.tidy)((function(){return(0,i.div)(e,(0,i.add)(f(),B(e,t.axis)))}))},t.prototype.getConfig=function(){return{axis:this.axis}},t.className="UnitNorm",t}(z);i.serialization.registerClass(L);var j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return(0,i.relu)(e)},t.className="NonNeg",t}(z);i.serialization.registerClass(j);var U=function(e){function t(t){var n=e.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=t.minValue?t.minValue:n.defaultMinValue,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.rate=null!=t.rate?t.rate:n.defaultRate,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return o(t,e),t.prototype.apply=function(e){var t=this;return(0,i.tidy)((function(){var n=B(e,t.axis),r=(0,i.add)((0,i.mul)(t.rate,(0,i.clipByValue)(n,t.minValue,t.maxValue)),(0,i.mul)(1-t.rate,n));return(0,i.mul)(e,(0,i.div)(r,(0,i.add)(f(),n)))}))},t.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},t.className="MinMaxNorm",t}(z);i.serialization.registerClass(U);var q={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function W(e){return N(e)}function V(e,t){return void 0===t&&(t={}),k(e,i.serialization.SerializationMap.getMap().classNameMap,t,"constraint")}function $(e){return null==e?null:"string"==typeof e?V({className:e in q?q[e]:e,config:{}}):e instanceof z?e:V(e)}var H=Object.freeze({maxNorm:function(e){return new P(e)},unitNorm:function(e){return new L(e)},nonNeg:function(){return new j},minMaxNorm:function(e){return new U(e)}}),G=["channelsFirst","channelsLast"],K=["valid","same","causal"],X=["max","avg"],Y=["sum","mul","concat","ave"],J=new Map;function Z(e){T(G,"DataFormat",e)}function Q(e){T(K,"PaddingMode",e)}function ee(e){T(X,"PoolMode",e)}var te=[];function ne(e,t){te.push(e);try{var n=t();return te.pop(),n}catch(e){throw te.pop(),e}}function re(e){if(!oe(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===te.length?"":te.join("/")+"/")+e}function ie(e){if(!oe(e))throw new Error("Not a valid tensor name: '"+e+"'");J.has(e)||J.set(e,0);var t=J.get(e);if(J.set(e,J.get(e)+1),t>0){var n=e+"_"+t;return J.set(n,1),n}return e}var ae=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function oe(e){return!!e.match(ae)}function se(e){return e===parseInt(e.toString(),10)}function ue(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,i=t;i<n;++i)r*=e[i];return r}function ce(e){return e=Array.isArray(e)?new Float32Array(e):e,(0,i.tensor1d)(e)}function le(e){return(0,i.min)(ce(e)).dataSync()[0]}function fe(e){return(0,i.max)(ce(e)).dataSync()[0]}function pe(e,t){if(t<e)throw new d("end ("+t+") < begin ("+e+") is forbidden.");for(var n=[],r=e;r<t;++r)n.push(r);return n}function he(e,t){return e.asType(t)}function de(e,t){void 0===t&&(t=-1);var n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function me(e,t,n){return(0,i.tidy)((function(){switch(e.rank){case 1:return(0,i.slice1d)(e,t,n);case 2:return(0,i.slice2d)(e,[t,0],[n,e.shape[1]]);case 3:return(0,i.slice3d)(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return(0,i.slice4d)(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return(0,i.slice)(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return(0,i.slice)(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new d("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}))}function ge(e,t,n){return(0,i.tidy)((function(){switch(e.rank){case 1:return(0,i.slice1d)(e,t,n);case 2:return(0,i.slice2d)(e,[0,t],[e.shape[0],n]);case 3:return(0,i.slice3d)(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return(0,i.slice4d)(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new d("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function ve(e,t,n,r){return(0,i.tidy)((function(){switch(e.rank){case 1:return(0,i.slice1d)(e,t,n);case 2:switch(r){case 1:return me(e,t,n);case 2:return ge(e,t,n);default:throw new d("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return me(e,t,n);case 2:return(0,i.slice3d)(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return ge(e,t,n);default:throw new d("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return me(e,t,n);case 2:return(0,i.slice4d)(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return(0,i.slice4d)(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return ge(e,t,n);default:throw new d("The axis is not within the rank of the tensor "+r)}default:throw new d("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function ye(e,t){var n;return void 0===t&&(t=-1),t<0&&(t=0!==(n=e[0].rank)?n:0),t===e[0].rank&&(t=-1),(0,i.concat)(e,t)}function be(e,t){switch(e.rank){case 1:return(0,i.concat1d)([e,t]);case 2:return(0,i.concat2d)([e,t],0);case 3:return(0,i.concat3d)([e,t],0);case 4:return(0,i.concat4d)([e,t],0);default:throw new d("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function xe(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new d("The length of input n ("+t.length+") does not match the number of dimensions in input x ("+e.rank+")");return(0,i.tile)(e,t)}function we(e,t,n,r,a){return void 0===t&&(t=0),void 0===n&&(n=1),(0,i.randomNormal)(e,t,n,r,a)}function Ee(e,t,n,r){if(e.rank<2||t.rank<2)throw new m("dot requires both inputs to be rank >= 2 but got x shape = "+e.shape+" and y shape = "+t.shape);if(t.rank>=3&&e.shape.slice(-1)[0]!==(f=t.shape.slice(-2)[0]))throw new m("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+e.shape+" and  y shape = "+t.shape);if(2===e.rank&&2===t.rank){var a=!1,o=!1;return i.fused.matMul({a:e,b:t,transposeA:a,transposeB:o,bias:r?Ne(e.rank,r,"channelsLast"):null,activation:n})}var s=e.shape.slice(),u=s.pop();e=e.reshape([-1,u]);var c=t.shape.slice(),l=c.pop(),f=c.pop(),p=c.concat([l]),h=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=t.transpose(h).reshape([f,-1]);var d=s.concat(p);return a=!1,o=!1,i.fused.matMul({a:e,b:t,transposeA:a,transposeB:o,bias:r?Ne(e.rank,r,"channelsLast"):null,activation:n}).reshape(d)}function Ce(e,t,n){return(0,i.tidy)((function(){return t=Array.isArray(t)?(0,i.tensor1d)(t,"int32"):t.toInt(),(0,i.gather)(e,t,n)}))}function Se(e){return(0,i.mulStrict)(e,e)}function Ne(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new d("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+e);if(5===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1,1,1]):t.reshape([1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,1,1,r[0]]):t.reshape([1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1,1]):t.reshape([1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,1,r[0]]):t.reshape([1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1]):t.reshape([1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,r[0]]):t.reshape([1].concat(r))}else if(e<3)return t;throw new d("Unsupported input rank by biasAdd: "+t.rank)}function Ae(e,t,n){return(0,i.tidy)((function(){return null==n&&(n="channelsLast"),Z(n),e.add(Ne(e.rank,t,n))}))}function ke(e,t,n,r){return(0,i.tidy)((function(){return(0,i.dropout)(e,t,n,r)}))}function De(e,t,n){return void 0===n&&(n=!1),n?e():t()}var _e=["fanIn","fanOut","fanAvg"],Me=["normal","uniform","truncatedNormal"],Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.fromConfigUsesCustomObjects=function(){return!1},t.prototype.getConfig=function(){return{}},t}(i.serialization.Serializable),Oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e,t){return(0,i.zeros)(e,t)},t.className="Zeros",t}(Te);i.serialization.registerClass(Oe);var Ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e,t){return(0,i.ones)(e,t)},t.className="Ones",t}(Te);i.serialization.registerClass(Ie);var Fe=function(e){function t(t){var n=e.call(this)||this;if("object"!=typeof t)throw new d("Expected argument of type ConstantConfig but got "+t);if(void 0===t.value)throw new d("config must have value set but got "+t);return n.value=t.value,n}return o(t,e),t.prototype.apply=function(e,t){var n=this;return(0,i.tidy)((function(){return(0,i.mul)((0,i.scalar)(n.value),(0,i.ones)(e,t))}))},t.prototype.getConfig=function(){return{value:this.value}},t.className="Constant",t}(Te);i.serialization.registerClass(Fe);var Re=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return o(t,e),t.prototype.apply=function(e,t){return(0,i.randomUniform)(e,this.minval,this.maxval,t)},t.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},t.className="RandomUniform",t}(Te);i.serialization.registerClass(Re);var Be=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return o(t,e),t.prototype.apply=function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new m("randomNormal does not support dType "+t+".");return we(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="RandomNormal",t}(Te);i.serialization.registerClass(Be);var ze=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return o(t,e),t.prototype.apply=function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new m("truncatedNormal does not support dType "+t+".");return(0,i.truncatedNormal)(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="TruncatedNormal",t}(Te);i.serialization.registerClass(ze);var Pe=function(e){function t(t){var n=e.call(this)||this;return n.gain=null!=t.gain?t.gain:1,n}return o(t,e),t.prototype.apply=function(e,t){var n=this;return(0,i.tidy)((function(){if(2!==e.length||e[0]!==e[1])throw new d("Identity matrix initializer can only be used for 2D square matrices.");return(0,i.mul)(n.gain,(0,i.eye)(e[0]))}))},t.prototype.getConfig=function(){return{gain:this.gain}},t.className="Identity",t}(Te);i.serialization.registerClass(Pe);var Le=function(e){function t(t){var n=e.call(this)||this;if(t.scale<0)throw new d("scale must be a positive float. Got: "+t.scale);return n.scale=null==t.scale?1:t.scale,n.mode=null==t.mode?"fanIn":t.mode,function(e){T(_e,"FanMode",e)}(n.mode),n.distribution=null==t.distribution?"normal":t.distribution,function(e){T(Me,"Distribution",e)}(n.distribution),n.seed=t.seed,n}return o(t,e),t.prototype.apply=function(e,t){var n=function(e,t){var n,r;if(void 0===t&&(t="channelsLast"),Z(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length))if("channelsFirst"===t){var i=ue(e,2);n=e[1]*i,r=e[0]*i}else"channelsLast"===t&&(i=ue(e,0,e.length-2),n=e[e.length-2]*i,r=e[e.length-1]*i);else{var a=ue(e);n=Math.sqrt(a),r=Math.sqrt(a)}return[n,r]}(e),r=n[0],a=n[1],o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,r):"fanOut"===this.mode?o/=Math.max(1,a):o/=Math.max(1,(r+a)/2),"normal"===this.distribution){var s=Math.sqrt(o);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new m(this.getClassName()+" does not support dType "+t+".");return(0,i.truncatedNormal)(e,0,s,t,this.seed)}var u=Math.sqrt(3*o);return(0,i.randomUniform)(e,-u,u,t)},t.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},t.className="VarianceScaling",t}(Te);i.serialization.registerClass(Le);var je=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})||this}return o(t,e),t.prototype.getClassName=function(){return Le.className},t.className="GlorotUniform",t}(Le);i.serialization.registerClass(je);var Ue=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})||this}return o(t,e),t.prototype.getClassName=function(){return Le.className},t.className="GlorotNormal",t}(Le);i.serialization.registerClass(Ue);var qe=function(e){function t(t){return e.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return o(t,e),t.prototype.getClassName=function(){return Le.className},t.className="HeNormal",t}(Le);i.serialization.registerClass(qe);var We=function(e){function t(t){return e.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})||this}return o(t,e),t.prototype.getClassName=function(){return Le.className},t.className="HeUniform",t}(Le);i.serialization.registerClass(We);var Ve=function(e){function t(t){return e.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return o(t,e),t.prototype.getClassName=function(){return Le.className},t.className="LeCunNormal",t}(Le);i.serialization.registerClass(Ve);var $e=function(e){function t(t){return e.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})||this}return o(t,e),t.prototype.getClassName=function(){return Le.className},t.className="LeCunNormal",t}(Le);i.serialization.registerClass($e);var He=function(e){function t(t){var n=e.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==t.gain?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,null!=n.seed)throw new m("Random seed is not implemented for Orthogonal Initializer yet.");return n}return o(t,e),t.prototype.apply=function(e,t){var n=this;return(0,i.tidy)((function(){if(2!==e.length)throw new m("The Orthogonal Initializer does not support non-2D shapes yet.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+e[0]*e[1]+") elements: Slowness may result.");var t=we(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=i.linalg.gramSchmidt(t);return e[0]>e[1]&&(r=r.transpose()),(0,i.mul)(n.gain,r)}))},t.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},t.className="Orthogonal",t}(Te);i.serialization.registerClass(He);var Ge={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Ke(e,t){return void 0===t&&(t={}),k(e,i.serialization.SerializationMap.getMap().classNameMap,t,"initializer")}function Xe(e){return N(e)}function Ye(e){if("string"==typeof e){var t=e in Ge?Ge[e]:e;if("GlorotNormal"===t)return new Ue;if("GlorotUniform"===t)return new je;if("HeNormal"===t)return new qe;if("HeUniform"===t)return new We;if("LeCunNormal"===t)return new Ve;if("LeCunUniform"===t)return new $e;var n={};return n.className=t,n.config={},Ke(n)}return e instanceof Te?e:Ke(e)}var Je=Object.freeze({zeros:function(){return new Oe},ones:function(){return new Ie},constant:function(e){return new Fe(e)},randomUniform:function(e){return new Re(e)},randomNormal:function(e){return new Be(e)},truncatedNormal:function(e){return new ze(e)},identity:function(e){return new Pe(e)},varianceScaling:function(e){return new Le(e)},glorotUniform:function(e){return new je(e)},glorotNormal:function(e){return new Ue(e)},heNormal:function(e){return new qe(e)},heUniform:function(e){return new We(e)},leCunNormal:function(e){return new Ve(e)},leCunUniform:function(e){return new $e(e)},orthogonal:function(e){return new He(e)}}),Ze=0;function Qe(){return Ze++}var et={};function tt(e){return void 0===e&&(e=""),e in et||(et[e]=0),et[e]+=1,e+et[e].toString()}function nt(e){return Array.isArray(e)&&Array.isArray(e[0])}function rt(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function it(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new d("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function at(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new d("Expected exactly 1 Shape; got "+e.length)}return e}function ot(e){for(var t=0,n=0,r=e;n<r.length;n++){var i=r[n];0===i.shape.length?t+=1:t+=i.shape.reduce((function(e,t){return e*t}))}return t}var st="Variable",ut=function(){function e(e,t,n,r,a){void 0===t&&(t="float32"),void 0===n&&(n=st),void 0===r&&(r=!0),void 0===a&&(a=null),this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=Qe(),n=null==n?st:n,this.originalName=re(n),this.name=ie(this.originalName),this.trainable_=r,this.constraint=a,this.val=(0,i.variable)(e,this.trainable_,this.name,this.dtype)}return e.prototype.read=function(){return this.assertNotDisposed(),this.val},e.prototype.write=function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},e.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},e.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!0,configurable:!0}),e}();function ct(e){return e.map((function(e){return e.read()}))}function lt(e){e.forEach((function(e){e[0].write(e[1])}))}var ft=function(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}},pt=function(e,t,n,r,i,a,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=Qe(),null!=a&&(this.originalName=re(a),this.name=ie(this.originalName)),this.rank=t.length},ht=0,dt=function(){function e(e,t){this.callArgs=t,this.id=ht++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(var n=0,r=e.inboundLayers;n<r.length;n++){var i=r[n];null!=i&&i.outboundNodes.push(this)}e.outboundLayer.inboundNodes.push(this)}return e.prototype.getConfig=function(){for(var e=[],t=0,n=this.inboundLayers;t<n.length;t++){var r=n[t];null!=r?e.push(r.name):e.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},e}(),mt=0,gt=function(e){function t(t){var n=e.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=mt++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=t.name;if(!r){var i=n.getClassName();r=E(i)+"_"+tt(i)}if(n.name=r,n.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){var a=void 0;if(null!=t.batchInputShape)a=t.batchInputShape;else if(null!=t.inputShape){var o=null;null!=t.batchSize&&(o=t.batchSize),a=[o].concat(t.inputShape)}n.batchInputShape=a;var s=t.dtype;null==s&&(s=t.inputDType),null==s&&(s="float32"),n.dtype=s}return null!=t.weights?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return o(t,e),t.nodeKey=function(e,t){return e.name+"_ib-"+t.toString()},t.prototype.getNodeAtIndex=function(e,t){if(0===this.inboundNodes.length)throw new h("The layer has never been called and thus has no defined "+t+".");if(this.inboundNodes.length<=e)throw new d("Asked to get "+t+" at node "+e+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[e]},t.prototype.getInputAt=function(e){return x(this.getNodeAtIndex(e,"input").inputTensors)},t.prototype.getOutputAt=function(e){return x(this.getNodeAtIndex(e,"output").outputTensors)},Object.defineProperty(t.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new p("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new p("Layer "+this.name+" is not connected, no input to return.");return x(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new p("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new p("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return x(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),t.prototype.calculateLosses=function(){return this.losses.map((function(e){return e()}))},Object.defineProperty(t.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"built",{get:function(){return this._built},set:function(e){this._built=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},t.prototype.assertInputCompatibility=function(e){if(e=w(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=w(this.inputSpec);if(e.length!==t.length)throw new d("Layer "+this.name+" expects "+t.length+" inputs, but it received "+e.length+" input tensors. Input received: "+e);for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(null!=i){var a=r.rank;if(null!=i.ndim&&a!==i.ndim)throw new d("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+i.ndim+", found ndim="+a);if(null!=i.maxNDim&&a>i.maxNDim)throw new d("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+i.maxNDim+", found ndim="+a);if(null!=i.minNDim&&a<i.minNDim)throw new d("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+i.minNDim+", found ndim="+a+".");if(null!=i.dtype&&r.dtype!==i.dtype)throw new d("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+i.dtype+", found dtype="+r.dtype+".");if(i.axes){var o=r.shape;for(var s in i.axes){var u=Number(s),c=i.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new d("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+c+" but got shape "+o+".")}}if(null!=i.shape)for(var f=0;f<i.shape.length;++f){var p=i.shape[f],h=r.shape[f];if(null!=p&&null!=h&&p!==h)throw new d("Input "+n+" is incompatible with layer "+this.name+": expected shape="+i.shape+", found shape="+r.shape+".")}}}}},t.prototype.call=function(e,t){return e},t.prototype.invokeCallHook=function(e,t){null!=this._callHook&&this._callHook(e,t)},t.prototype.setCallHook=function(e){this._callHook=e},t.prototype.clearCallHook=function(){this._callHook=null},t.prototype.apply=function(e,t){var n=this;t=t||{},this.assertNotDisposed();for(var r=w(e),i=!0,a=0,o=r;a<o.length;a++)if(!(o[a]instanceof pt)){i=!1;break}for(var s=!0,u=0,c=r;u<c.length;u++)if(c[u]instanceof pt){s=!1;break}if(i===s)throw new d("Arguments to apply() must be all SymbolicTensors or all Tensors");return ne(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);for(var i=[],a=0,o=w(e);a<o.length;a++){var u=o[a];i.push(u.shape)}n.build(x(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&s&&(n._refCount=1)}if(n.assertInputCompatibility(e),s){for(var c=[],l=0,f=w(g=n.call(e,t));l<f.length;l++){var p=f[l];-1!==r.indexOf(p)&&(p=p.clone()),c.push(p)}if(g=x(c),null!=n.activityRegularizer)throw new m("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return g}var h=function(e){for(var t=[],n=0,r=e=w(e);n<r.length;n++){var i=r[n];t.push(i.shape)}return x(t)}(e),d=n.computeOutputShape(h),g=void 0,v="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?h[0]:h),g=null!=d&&d.length>0&&Array.isArray(d[0])?d.map((function(r,i){return new pt(v,r,n,w(e),t,n.name,i)})):new pt(v,d,n,w(e),t,n.name),n.addInboundNode(e,g,null,null,h,d,t),n._refCount++,null!=n.activityRegularizer)throw new m("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return g}))},t.prototype.warnOnIncompatibleInputShape=function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor ("+JSON.stringify(e)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(t.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new p("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var e=[],t=0,n=this.inboundNodes;t<n.length;t++){var r=n[t],i=JSON.stringify(r.outputShapes);-1===e.indexOf(i)&&e.push(i)}if(1===e.length){var a=this.inboundNodes[0].outputShapes;return Array.isArray(a)&&Array.isArray(a[0])&&1===a.length?a[0]:a}throw new p("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),t.prototype.countParams=function(){if(!this.built)throw new h("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return ot(this.weights)},t.prototype.build=function(e){this.built=!0},t.prototype.getWeights=function(e){return void 0===e&&(e=!1),ct(e?this.trainableWeights:this.weights)},t.prototype.setWeights=function(e){var t=this;(0,i.tidy)((function(){var n=t.weights;if(n.length!==e.length)throw new d('You called setWeights(weights) on layer "'+t.name+'" with a weight list of length '+e.length+", but the layer was expecting "+n.length+" weights. Provided weights: "+e+"...");if(0!==n.length){for(var r=[],a=ct(n),o=0;o<a.length;++o){var s=a[o],u=n[o],c=e[o];if(!i.util.arraysEqual(s.shape,c.shape))throw new d("Layer weight shape "+s.shape+" not compatible with provided weight shape "+c.shape);r.push([u,c])}lt(r)}}))},t.prototype.addWeight=function(e,t,n,r,i,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new d("Duplicate weight name "+e+" for layer "+this.name);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=Ye("zeros"));var s=r.apply(t,n),u=new ut(s,n,e,a,o);return s.dispose(),null!=i&&this.addLoss((function(){return i.apply(u.read())})),null==a&&(a=!0),a?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u},t.prototype.setFastWeightInitDuringBuild=function(e){this.fastWeightInitDuringBuild=e},t.prototype.addLoss=function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=w(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,e))},t.prototype.computeOutputShape=function(e){return e},t.prototype.computeMask=function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer "+n.name+" does not support masking, but was passed an inputMask.")}))}return null}return t},t.prototype.addInboundNode=function(e,t,n,r,i,a,o){void 0===o&&(o=null);var s=w(e);t=w(t),n=w(n),r=w(r),i=rt(i),a=rt(a);for(var u=[],c=[],l=[],f=0,p=s;f<p.length;f++){var h=p[f];u.push(h.sourceLayer),c.push(h.nodeIndex),l.push(h.tensorIndex)}new dt({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:l,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},o);for(var d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d},t.prototype.getConfig=function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e},t.prototype.disposeWeights=function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length},t.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}},t}(i.serialization.Serializable);function vt(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var i=[],a=0;a<r.inboundLayers.length;a++)for(var o=0,s=vt(r.inputTensors[a],r.inboundLayers[a],r.nodeIndices[a]);o<s.length;o++){var u=s[o];-1===i.indexOf(u)&&i.push(u)}return i}var yt,bt,xt=function(e){function t(t){var n=e.call(this,{dtype:t.dtype,name:null!=t.name?t.name:tt("input").toString()})||this;if(null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new d("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=t.batchInputShape;if(null==r){if(null==t.inputShape)throw new d("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new d("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=r,n.dtype=i,n.inputSpec=[{shape:r}];var a=new pt(n.dtype,n.batchInputShape,n,[],{},n.name);return a.nodeIndex=0,a.tensorIndex=0,new dt({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return o(t,e),t.prototype.apply=function(e,t){throw new d("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},t.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},t.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},t.className="InputLayer",t}(gt);function wt(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new d("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new xt({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function Et(e){return c(this,void 0,void 0,(function(){var t,n,r,a,o,s,u,c;return l(this,(function(l){switch(l.label){case 0:if(null==e)return[2];for(a in t=[],n=[],r=[],e)"number"!=typeof(o=e[a])&&(s=o,t.push(s.data()),n.push(a),r.push(s));return t.length>0?[4,Promise.all(t)]:[3,2];case 1:for(u=l.sent(),c=0;c<u.length;++c)e[n[c]]=u[c][0];(0,i.dispose)(r),l.label=2;case 2:return[2]}}))}))}function Ct(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}i.serialization.registerClass(xt),(bt=yt||(yt={}))[bt.SILENT=0]="SILENT",bt[bt.VERBOSE=1]="VERBOSE";var St=function(){function e(){this.validationData=null}return e.prototype.setParams=function(e){this.params=e},e.prototype.onEpochBegin=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(e){return[2]}))}))},e.prototype.onEpochEnd=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(e){return[2]}))}))},e.prototype.onBatchBegin=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(e){return[2]}))}))},e.prototype.onBatchEnd=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(e){return[2]}))}))},e.prototype.onTrainBegin=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(e){return[2]}))}))},e.prototype.onTrainEnd=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(e){return[2]}))}))},e.prototype.setModel=function(e){},e}(),Nt=function(){function e(e,t){void 0===t&&(t=10),null==e&&(e=[]),this.callbacks=e,this.queueLength=t}return e.prototype.append=function(e){this.callbacks.push(e)},e.prototype.setParams=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setParams(e)},e.prototype.setModel=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setModel(e)},e.prototype.onEpochBegin=function(e,t){return c(this,void 0,void 0,(function(){var n,r;return l(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochBegin(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onEpochEnd=function(e,t){return c(this,void 0,void 0,(function(){var n,r;return l(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onEpochEnd(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onBatchBegin=function(e,t){return c(this,void 0,void 0,(function(){var n,r;return l(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchBegin(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onBatchEnd=function(e,t){return c(this,void 0,void 0,(function(){var n,r;return l(this,(function(i){switch(i.label){case 0:null==t&&(t={}),n=0,r=this.callbacks,i.label=1;case 1:return n<r.length?[4,r[n].onBatchEnd(e,t)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.onTrainBegin=function(e){return c(this,void 0,void 0,(function(){var t,n;return l(this,(function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?[4,n[t].onTrainBegin(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype.onTrainEnd=function(e){return c(this,void 0,void 0,(function(){var t,n;return l(this,(function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?[4,n[t].onTrainEnd(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e}(),At=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.onEpochBegin=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(e){return this.seen=0,this.totals={},[2]}))}))},t.prototype.onBatchEnd=function(e,t){return c(this,void 0,void 0,(function(){var e,n,r,a,o=this;return l(this,(function(s){for(a in null==t&&(t={}),e=null==t.size?0:t.size,this.seen+=e,n=function(n){var a=t[n];if("number"==typeof a)r.totals.hasOwnProperty(n)||(r.totals[n]=0),r.totals[n]=r.totals[n]+a*e;else{var s=void 0;n in r.totals?s=r.totals[n]:r.totals[n]=0;var u=(0,i.tidy)((function(){return(0,i.add)(o.totals[n],(0,i.mul)(a,e))}));r.totals[n]=u,null!=s&&s.dispose()}},r=this,t)n(a);return[2]}))}))},t.prototype.onEpochEnd=function(e,t){return c(this,void 0,void 0,(function(){var e,n,r,a,o,s=this;return l(this,(function(u){if(null!=t)for(e=function(e){if(null==n.totals[e])return"continue";"number"==typeof n.totals[e]?t[e]=n.totals[e]/n.seen:(0,i.tidy)((function(){var n=(0,i.mul)((0,i.div)(1,s.seen),s.totals[e]);t[e]=n,s.totals[e].dispose(),(0,i.keep)(t[e])}))},n=this,r=0,a=this.params.metrics;r<a.length;r++)o=a[r],e(o);return[2]}))}))},t}(St),kt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.onTrainBegin=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(e){return this.epoch=[],this.history={},[2]}))}))},t.prototype.onEpochEnd=function(e,t){return c(this,void 0,void 0,(function(){var n;return l(this,(function(r){for(n in null==t&&(t={}),this.epoch.push(e),t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n]);return[2]}))}))},t.prototype.syncData=function(){return c(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s,u;return l(this,(function(c){switch(c.label){case 0:for(r in e=[],t=[],n=[],this.history)for(i=this.history[r],a=0;a<i.length;++a)"number"!=typeof i[a]&&(o=i[a],e.push(o.data()),t.push(r),n.push(a));return[4,Promise.all(e)];case 1:for(s=c.sent(),u=0;u<s.length;++u)this.history[t[u]][n[u]].dispose(),this.history[t[u]][n[u]]=s[u][0];return[2]}}))}))},t}(St),Dt=function(e){function t(t,n){var r=e.call(this)||this;if(r.currentEpoch=0,r.yieldEvery=n||"auto","auto"===r.yieldEvery&&(r.yieldEvery=125),"never"===r.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return i.util.isNumber(r.yieldEvery)&&(r.maybeWait=function(e,t){var n,r=i.util.now();return function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var s=i.util.now();return s-r<t?n:(r=s,n=e.apply(void 0,a))}}(r.maybeWait.bind(r),r.yieldEvery)),r.trainBegin=t.onTrainBegin,r.trainEnd=t.onTrainEnd,r.epochBegin=t.onEpochBegin,r.epochEnd=t.onEpochEnd,r.batchBegin=t.onBatchBegin,r.batchEnd=t.onBatchEnd,r.yield=t.onYield,r}return o(t,e),t.prototype.maybeWait=function(e,t,n){return c(this,void 0,void 0,(function(){var r;return l(this,(function(a){switch(a.label){case 0:return r=[],null==this.yield?[3,2]:[4,Et(n)];case 1:a.sent(),r.push(this.yield(e,t,n)),a.label=2;case 2:return r.push((0,i.nextFrame)()),[4,Promise.all(r)];case 3:return a.sent(),[2]}}))}))},t.prototype.onEpochBegin=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return this.currentEpoch=e,null==this.epochBegin?[3,3]:[4,Et(t)];case 1:return n.sent(),[4,this.epochBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onEpochEnd=function(e,t){return c(this,void 0,void 0,(function(){var n;return l(this,(function(r){switch(r.label){case 0:return n=[],null==this.epochEnd?[3,2]:[4,Et(t)];case 1:r.sent(),n.push(this.epochEnd(e,t)),r.label=2;case 2:return"epoch"===this.yieldEvery&&n.push((0,i.nextFrame)()),[4,Promise.all(n)];case 3:return r.sent(),[2]}}))}))},t.prototype.onBatchBegin=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,Et(t)];case 1:return n.sent(),[4,this.batchBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.onBatchEnd=function(e,t){return c(this,void 0,void 0,(function(){var n;return l(this,(function(r){switch(r.label){case 0:return n=[],null==this.batchEnd?[3,2]:[4,Et(t)];case 1:r.sent(),n.push(this.batchEnd(e,t)),r.label=2;case 2:return"batch"===this.yieldEvery?n.push((0,i.nextFrame)()):i.util.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),[4,Promise.all(n)];case 3:return r.sent(),[2]}}))}))},t.prototype.onTrainBegin=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return null==this.trainBegin?[3,3]:[4,Et(e)];case 1:return t.sent(),[4,this.trainBegin(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.onTrainEnd=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return null==this.trainEnd?[3,3]:[4,Et(e)];case 1:return t.sent(),[4,this.trainEnd(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t}(St);function _t(e,t){return null==e&&(e={}),e instanceof St?[e]:Array.isArray(e)&&e[0]instanceof St?e:w(e).map((function(e){return new Dt(e,t)}))}var Mt=function(){function e(){}return e.registerCallbackConstructor=function(t,n){i.util.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got "+t})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)},e.checkForDuplicate=function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new d("Duplicate callback constructor.")}))},e.clear=function(){e.constructors={}},e.createCallbacks=function(t){var n=[];for(var r in e.constructors){var i=+r;t>=i&&n.push.apply(n,e.constructors[i])}return n.map((function(e){return new e}))},e.constructors={},e}();function Tt(e,t,n,r,i,a,o,s,u){var c=new kt,l=[new At].concat(Mt.createCallbacks(t));null!=e&&l.push.apply(l,e),l.push(c);var f=new Nt(l);return f.setParams({epochs:n,initialEpoch:r,samples:i,steps:a,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:f,history:c}}function Ot(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),k(e,i.serialization.SerializationMap.getMap().classNameMap,t,"layer",n)}function It(e,t){return(0,i.tidy)((function(){"float32"!==e.dtype&&(e=e.asType("float32"));var n=(0,i.sum)(Se(e),t,!0),r=(0,i.fill)(n.shape,f()),a=(0,i.sqrt)((0,i.maximum)(n,r));return(0,i.div)(e,a)}))}function Ft(e,t){return(0,i.tidy)((function(){return(0,i.mean)(Se((0,i.sub)(t,e)),-1)}))}function Rt(e,t){return(0,i.tidy)((function(){return(0,i.mean)((0,i.abs)((0,i.sub)(t,e)),-1)}))}function Bt(e,t){return(0,i.tidy)((function(){var n=(0,i.sub)(e,t),r=(0,i.clipByValue)((0,i.abs)(e),f(),Number.MAX_VALUE),a=(0,i.abs)((0,i.div)(n,r));return(0,i.mul)(100,(0,i.mean)(a,-1))}))}function zt(e,t,n){return void 0===n&&(n=!1),(0,i.tidy)((function(){if(n)t=(0,i.softmax)(t);else{var r=(0,i.sum)(t,t.shape.length-1,!0);t=(0,i.div)(t,r)}return t=(0,i.clipByValue)(t,f(),1-f()),(0,i.neg)((0,i.sum)((0,i.mul)(e.toFloat(),(0,i.log)(t)),t.shape.length-1))}))}function Pt(e,t){return(0,i.tidy)((function(){var n=(0,i.floor)(function(e){var t=[ue(e.shape)];return e.reshape(t)}(e)).toInt(),r=(t=(0,i.clipByValue)(t,f(),1-f())).shape;return zt((0,i.oneHot)(n,r[r.length-1]).reshape(r),t,!1)}))}function Lt(e,t){return(0,i.tidy)((function(){var n;return n=(0,i.clipByValue)(t,f(),1-f()),n=(0,i.log)((0,i.div)(n,(0,i.sub)(1,n))),(0,i.mean)(function(e,t){if(!i.util.arraysEqual(e.shape,t.shape))throw new d("logits and labels must have the same shape, but got shapes "+JSON.stringify(e.shape)+" and "+JSON.stringify(t.shape));return(0,i.tidy)((function(){var n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())}))}(e,n),-1)}))}function jt(e,t){return(0,i.tidy)((function(){var n=It(e,-1),r=It(t,-1),a=(0,i.mul)(n,r);return(0,i.neg)((0,i.sum)(a,-1))}))}var Ut={meanSquaredError:Ft,meanAbsoluteError:Rt,meanAbsolutePercentageError:Bt,meanSquaredLogarithmicError:function(e,t){return(0,i.tidy)((function(){var n=(0,i.clipByValue)(t,f(),Number.MAX_VALUE),r=(0,i.log)((0,i.add)(1,n)),a=(0,i.clipByValue)(e,f(),Number.MAX_VALUE),o=(0,i.log)((0,i.add)(1,a));return(0,i.mean)(Se((0,i.sub)(r,o)),-1)}))},squaredHinge:function(e,t){return(0,i.tidy)((function(){var n=(0,i.maximum)(0,(0,i.sub)(1,(0,i.mul)(e,t)));return(0,i.mean)(Se(n),-1)}))},hinge:function(e,t){return(0,i.tidy)((function(){var n=(0,i.maximum)(0,(0,i.sub)(1,(0,i.mul)(e,t)));return(0,i.mean)(n,-1)}))},categoricalHinge:function(e,t){return(0,i.tidy)((function(){var n=(0,i.sum)((0,i.mul)(e,t),-1),r=(0,i.max)((0,i.mul)((0,i.sub)(1,e),t),-1);return(0,i.maximum)(0,(0,i.add)(1,(0,i.sub)(r,n)))}))},logcosh:function(e,t){return(0,i.tidy)((function(){var n=Math.log(2),r=(0,i.sub)(t,e),a=(0,i.sub)((0,i.add)(r,(0,i.softplus)((0,i.mul)(-2,r))),n);return(0,i.mean)(a,-1)}))},categoricalCrossentropy:zt,sparseCategoricalCrossentropy:Pt,binaryCrossentropy:Lt,kullbackLeiblerDivergence:function(e,t){return(0,i.tidy)((function(){var n=(0,i.clipByValue)(e,f(),1),r=(0,i.clipByValue)(t,f(),1);return(0,i.sum)((0,i.mul)(e,(0,i.log)((0,i.div)(n,r))),-1)}))},poisson:function(e,t){return(0,i.tidy)((function(){var n=(0,i.log)((0,i.add)(f(),t));return(0,i.mean)((0,i.sub)(t,(0,i.mul)(e,n)),-1)}))},cosineProximity:jt};function qt(e){if("string"==typeof e){if(e in Ut)return Ut[e];var t="Unknown loss "+e;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss "+e+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new d(t)}return e}function Wt(e,t){return(0,i.tidy)((function(){var n=(0,i.mul)(.5,(0,i.onesLike)(t)),r=he((0,i.greater)(t,n),e.dtype);return(0,i.mean)((0,i.equal)(e,r),-1)}))}function Vt(e,t){return(0,i.tidy)((function(){return he((0,i.equal)((0,i.argMax)(e,-1),(0,i.argMax)(t,-1)),"float32")}))}function $t(e,t){return(0,i.tidy)((function(){return(0,i.logicalAnd)(e.equal(1),t.equal(1)).sum().cast("float32")}))}function Ht(e,t){return(0,i.tidy)((function(){var n=$t(e,t),r=function(e,t){return(0,i.tidy)((function(){return(0,i.logicalAnd)(e.equal(0),t.equal(1)).sum().cast("float32")}))}(e,t),a=n.add(r);return(0,i.where)((0,i.greater)(a,0),n.div(a),0).cast("float32")}))}function Gt(e,t){return Lt(e,t)}function Kt(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),(0,i.equal)(e,t).asType("float32")}var Xt=zt,Yt=Pt,Jt={binaryAccuracy:Wt,categoricalAccuracy:Vt,precision:Ht,categoricalCrossentropy:Xt,sparseCategoricalCrossentropy:Yt,mse:Ft,MSE:Ft,mae:Rt,MAE:Rt,mape:Bt,MAPE:Bt,cosine:jt};function Zt(e){if(y(null!==e,"Unknown LossOrMetricFn "+e),"string"==typeof e)return e;for(var t=void 0,n=0,r=Object.keys(Ut);n<r.length;n++){var i=r[n];if(Ut[i]===e){t=i;break}}if(void 0!==t)return t;for(var a=0,o=Object.keys(Jt);a<o.length;a++)if(i=o[a],Jt[i]===e){t=i;break}return void 0!==t?t:e.name}function Qt(e,t,n){if(void 0===n&&(n=!1),null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!en(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'+t+'" is too large in size (length='+r.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.")}}function en(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!=typeof r)return!1;if(!en(e[r]))return!1}return!0}if(Array.isArray(e)){for(var i=0,a=e;i<a.length;i++)if(!en(a[i]))return!1;return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function tn(e,t,n){void 0===n&&(n=console.log);for(var r="",i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[i]).slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function nn(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(e){r="multiple"}tn([e.name+" ("+e.getClassName()+")",r,e.countParams().toString()],t,n)}function rn(e,t,n,r){var i;try{i=JSON.stringify(e.outputShape)}catch(e){i="multiple"}for(var a=[],o=0,s=e.inboundNodes;o<s.length;o++){var u=s[o];if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var c=0;c<u.inboundLayers.length;++c){var l=u.inboundLayers[c].name,f=u.nodeIndices[c],p=u.tensorIndices[c];a.push(l+"["+f+"]["+p+"]")}}var h=e.name,d=e.getClassName(),m=0===a.length?"":a[0];for(tn([h+" ("+d+")",i,e.countParams().toString(),m],t,r),c=1;c<a.length;++c)tn(["","","",a[c]],t,r)}function an(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function on(e,t){if(null===e)return null;if("string"==typeof e)return C(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,i=0;i<r;++i){var a=e[i];an(t,i,a)?n.push(a):n.push(on(a,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var f=C(c);o[f]=on(l,f)}}return o}function sn(e,t){if(null==e)return null;if("string"==typeof e)return E(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,i=0;i<r;++i){var a=e[i];an(t,i,a)?n.push(a):n.push(sn(a,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];o[E(c)]="name"!==c&&"className"!==c||"string"!=typeof l?sn(l,c):l}return o}var un="1.7.4",cn=function(){function e(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;for(var r=0,i=t;r<i.length;r++){var a=i[r];this.add(a.key,a.value)}}}return e.prototype.add=function(e,t,n){if(null!=this.id2Value[e.id])throw new d("Duplicate key: name="+e.name+", id="+e.id);return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return(0,i.cast)(t,e.dtype)}catch(n){throw new d("The dtype of the feed ("+t.dtype+") can not be cast to the dtype of the key '"+e.name+"' ("+e.dtype+").")}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this},e.prototype.addFeed=function(e){this.add(e.key,e.value)},e.prototype.hasKey=function(e){return null!=this.id2Value[e.id]},e.prototype.names=function(){return Object.keys(this.name2Id)},e.prototype.getValue=function(e){if(e instanceof pt){if(null==this.id2Value[e.id])throw new d("Nonexistent key: "+e.name);return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new d("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]},e.prototype.getMask=function(e){if(e instanceof pt){if(null==this.id2Value[e.id])throw new d("Nonexistent key: "+e.name);return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new d("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]},e.prototype.disposeMasks=function(){null!=this.id2Mask&&(0,i.dispose)(this.id2Mask)},e}(),ln={},fn={};function pn(e,t,n,r){for(var a=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),f=0,p=u;f<p.length;f++){var h=p[f];-1!==l.indexOf(h)?c.push(t.getValue(h)):c.push(null)}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var d,m,g=u.join(",")+"|"+t.names().join(",");if(null==ln[g]){var v=function(e,t){i.util.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=dn(e[0],t);n=a.sorted,r=a.recipientMap}else for(var o=new Set,s=0,u=e;s<u.length;s++){for(var c=dn(u[s],t),l=c.sorted,f=c.recipientMap,p=0,h=l;p<h.length;p++){var d=h[p];o.has(d.name)||(n.push(d),o.add(d.name))}var m=function(e){null==r[e]&&(r[e]=new Set),f[e].forEach((function(t){return r[e].add(t)}))};for(var g in f)m(g)}return{sorted:n,recipientCounts:hn(r)}}(s,t);d=v.sorted,m=v.recipientCounts,ln[g]=d,fn[g]=m}d=ln[g],m={},a||Object.assign(m,fn[g]);for(var y=new cn(t),b=0;b<d.length;++b){if(null!=r){var x=(0,i.memory)().numTensors;x>r.maxNumTensors&&(r.maxNumTensors=x),x<r.minNumTensors&&(r.minNumTensors=x)}var E=d[b],C=E.sourceLayer;if(!(C instanceof xt)){for(var S=[],N=[],A=[],k=!1,D=0,_=E.inputs;D<_.length;D++){var M=_[D],T=y.getValue(M),O=y.getMask(M);S.push(T),N.push(O),null!=O&&(k=!0),a||(m[M.name]--,0!==m[M.name]||t.hasKey(M)||-1!==u.indexOf(M.name)||T.isDisposed||!0===M.sourceLayer.stateful||A.push(T))}k&&((n=n||{}).mask=N[0]);var I=w(C.apply(S,n)),F=null;C.supportsMasking&&(F=C.computeMask(S,N));for(var R=mn(E),B=Array.isArray(R)?R:[R],z=0;z<B.length;++z){y.hasKey(B[z])||y.add(B[z],I[z],Array.isArray(F)?F[0]:F);var P=u.indexOf(B[z].name);-1!==P&&(c[P]=I[z])}a||(0,i.dispose)(A)}}return y.disposeMasks(),o?c:c[0]}function hn(e){var t={};for(var n in e)t[n]=e[n].size;return t}function dn(e,t){for(var n=new Set,r=[],i={},a=0,o=t.names();a<o.length;a++){var s=o[a];n.add(s)}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(n.has(l.name))u.pop();else{var f=c[c.length-1]===u.length-1;if(0===l.inputs.length||f)u.pop(),r.push(l),n.add(l.name),f&&c.pop();else{c.push(u.length-1);for(var p=0,h=l.inputs;p<h.length;p++){var d=h[p];null==i[d.name]&&(i[d.name]=new Set),i[d.name].add(l.name),n.has(d.name)||u.push(d)}}}}return{sorted:r,recipientMap:i}}function mn(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r)for(var i=0,a=e.sourceLayer.inboundNodes[r].outputTensors;i<a.length;i++)if(a[i].id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}var gn=function(e){function t(n){var r=e.call(this,{})||this;if(r.containerNodes=new Set,r.name=n.name,null==r.name){var i=r.getClassName().toLowerCase();r.name=tt(i)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(n.inputs)?r.inputs=n.inputs.slice():r.inputs=[n.inputs],Array.isArray(n.outputs)?r.outputs=n.outputs.slice():r.outputs=[n.outputs],_(r.inputs).length!==r.inputs.length)throw new d("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map((function(e){return e.name})));_(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map((function(e){return e.name}))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];for(var a=0,o=r.outputs;a<o.length;a++){var s=(T=o[a]).sourceLayer,u=T.nodeIndex,c=T.tensorIndex;r.outputLayers.push(s),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(c)}for(var l=0,f=r.inputs;l<f.length;l++)s=(T=f[l]).sourceLayer,u=T.nodeIndex,c=T.tensorIndex,y(0===u,"input layer has >1 nodes"),y(0===c,"input layer has >1 tensors"),r.inputLayers.push(s),r.inputLayersNodeIndices.push(u),r.inputLayersTensorIndices.push(c);r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var p=0;p<r.inputLayers.length;p++){if(!((s=r.inputLayers[p])instanceof xt))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+n.inputs+". Input "+p+" (0-based) originates from layer type "+s.getClassName()+".");r.inputNames.push(s.name),r.feedInputShapes.push(s.batchInputShape),r.feedInputNames.push(s.name)}for(var m=0,g=r.outputLayers;m<g.length;m++)s=g[m],r.outputNames.push(s.name);r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));for(var v={},b={},x={},w={},E={},C=[],S=function(e,n,i,a,o,s){null!=a&&null!=o&&null!=s||(a=e.sourceLayer,o=e.nodeIndex,s=e.tensorIndex);var u=a.inboundNodes[o];if(-1!==i.indexOf(u))throw new h("The tensor "+e.name+' at layer "'+a.name+'" is part of a cycle.');if(-1===n.indexOf(u)){r.containerNodes.add(t.nodeKey(a,o)),a.id in E||(E[a.id]=Object.keys(E).length),-1===i.indexOf(u)&&i.push(u);for(var c=u.inboundLayers.length,l=0;l<c;l++){var f=u.inputTensors[l],p=u.inboundLayers[l],d=u.nodeIndices[l],m=u.tensorIndices[l];S(f,n,i,p,d,m)}for(n.push(u);i.indexOf(u)>=0;)i.splice(i.indexOf(u),1);C.push(u)}},N=[],A=[],k=0,M=r.outputs;k<M.length;k++){var T=M[k];S(T,N,A)}for(var O=0,I=C.slice().reverse();O<I.length;O++){b[(te=I[O]).id]=te,te.id in v||(v[te.id]=0);var F=v[te.id],R=null==x[te.outboundLayer.id]?0:x[te.outboundLayer.id];for(F=Math.max(F,R),x[te.outboundLayer.id]=F,w[te.outboundLayer.id]=te.outboundLayer,v[te.id]=F,p=0;p<te.inboundLayers.length;p++){var B=te.inboundLayers[p],z=(u=te.nodeIndices[p],B.inboundNodes[u]),P=null==v[z.id]?0:v[z.id];v[z.id]=Math.max(F+1,P),b[z.id]=z}}var L={};for(var j in v)(F=v[j])in L||(L[F]=[]),L[F].push(b[j]);var U={};for(var q in x)(F=x[q])in U||(U[F]=[]),U[F].push(w[q]);var W=Object.keys(U).map((function(e){return parseInt(e,10)})).sort(D);r.layers=[];for(var V=0,$=W;V<$.length;V++){var H=U[F=$[V]];H.sort((function(e,t){var n=E[e.id],r=E[t.id];return n<r?-1:n>r?1:0}));for(var G=0,K=H;G<K.length;G++)(s=K[G])instanceof t&&r.internalContainerRefs.push(s),r.layers.push(s)}r.layersByDepth=U,W=Object.keys(L).map((function(e){return parseInt(e,10)})).sort(D);for(var X=r.inputs.slice(),Y=[],J=0,Z=W;J<Z.length;J++)for(var Q=0,ee=L[F=Z[J]];Q<ee.length;Q++){var te;if(null!=(s=(te=ee[Q]).outboundLayer)){for(var ne=0,re=te.inputTensors;ne<re.length;ne++)if(T=re[ne],-1===X.indexOf(T))throw new h("Graph disconnected: cannot obtain value for tensor "+T+' at layer "'+s.name+'". The following previous layers were accessed without issue: '+Y);for(var ie=0,ae=te.outputTensors;ie<ae.length;ie++)T=ae[ie],X.push(T);Y.push(s.name)}}r.nodesByDepth=L;for(var oe=r.layers.map((function(e){return e.name})),se=function(e){var t=oe.filter((function(t){return t===e})).length;if(1!==t)throw new h('The name "'+e+'" is used '+t+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(oe))},ue=0,ce=oe;ue<ce.length;ue++)se(ce[ue]);return r.outboundNodes=[],r.inboundNodes=[],new dt({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return o(t,e),t.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},t.prototype.dispose=function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(var t=0,n=this.layers;t<n.length;t++){var r=n[t];e.numDisposedVariables+=r.dispose().numDisposedVariables}for(var i=0,a=this.internalContainerRefs;i<a.length;i++){var o=a[i];e.numDisposedVariables+=o.dispose().numDisposedVariables}}return e.refCountAfterDispose=this._refCount,e},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new d("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e=e.concat(r.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],a=0,o=this.layers;a<o.length;a++)r=o[a],i.push.apply(i,r.trainableWeights);return i.concat(e)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.loadWeights=function(e,t){void 0===t&&(t=!0);for(var n={},r=0,i=0,a=this.layers;i<a.length;i++)for(var o=0,s=a[i].weights;o<s.length;o++){var u=s[o];if(null!=n[u.originalName])throw new d("Duplicate weight name: "+u.originalName);n[u.originalName]=u,r++}var c=[];for(var l in e){if(null!=n[l])c.push([n[l],e[l]]);else if(t)throw new d("Provided weight data has no target variable: "+l);delete n[l]}if(t){var f=[];for(var p in n)f.push(p);if(f.length>0)throw new d(f.length+" of "+r+" weights are not set: "+f)}lt(c)},t.prototype.updatedConfig=function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers "+un,t.backend="TensorFlow.js",t},t.prototype.toJSON=function(e,t){void 0===t&&(t=!0);var n=sn(this.updatedConfig());return t?JSON.stringify(n):n},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){e=w(e);for(var r=new cn,i=0;i<n.inputs.length;++i)r.add(n.inputs[i],e[i]);return pn(n.outputs,r,t)}))},t.prototype.computeMask=function(e,t){var n=this;return(0,i.tidy)((function(){var r;return e=w(e),r=null==t?v(null,e.length):w(t),n.runInternalGraph(e,r)[1]}))},t.prototype.computeOutputShape=function(e){var t=rt(e);if(t.length!==this.inputLayers.length)throw new d("Invalid inputShape argument "+e+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},r=0;r<t.length;r++){var i=this.inputLayers[r],a=t[r];n[A=i.name+"_0_0"]=a}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(D);if(o.length>1)for(var s=0,u=o;s<u.length;s++)for(var c=u[s],l=0,f=this.nodesByDepth[c];l<f.length;l++){var p=f[l];if(i=p.outboundLayer,-1===this.inputLayers.map((function(e){return e.id})).indexOf(i.id)){for(var h=[],m=0;m<p.inboundLayers.length;m++){var g=p.inboundLayers[m],v=p.nodeIndices[m],b=p.tensorIndices[m],w=n[A=g.name+"_"+v+"_"+b];h.push(w)}var E=rt(i.computeOutputShape(x(h))),C=i.inboundNodes.indexOf(p);for(m=0;m<E.length;m++)n[A=i.name+"_"+C+"_"+m]=E[m]}}var S=[],N=[];for(r=0;r<this.outputLayers.length;r++){i=this.outputLayers[r],C=this.outputLayersNodeIndices[r],b=this.outputLayersTensorIndices[r];var A=i.name+"_"+C+"_"+b;N.push(A)}for(r=0;r<N.length;r++){var k=N[r];y(k in n),S.push(n[k])}return x(S)},t.prototype.runInternalGraph=function(e,t){null==t&&(t=v(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var i=this.inputs[r],a=e[r],o=t[r];n[i.id]=[a,o]}for(var s=0,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(D);s<u.length;s++)for(var c=u[s],l=0,f=this.nodesByDepth[c];l<f.length;l++){for(var p=f[l],h=p.outboundLayer,d=p.inputTensors,g=p.outputTensors,b=new Array,x=0,E=d;x<E.length;x++)(i=E[x]).id in n&&b.push(n[i.id]);if(b.length===d.length){var C={},S=void 0,N=void 0,A=void 0,k=void 0;if(null!=p.callArgs&&(C=p.callArgs),1===b.length){var _=b[0],M=_[0],T=_[1];null==C.mask&&(C.mask=T),A=w(h.call(M,C)),k=w(h.computeMask(M,T)),S=[M],N=[T]}else S=b.map((function(e){return e[0]})),N=b.map((function(e){return e[1]})),null==C.mask&&(C.mask=N),A=w(h.call(S,C)),k=w(h.computeMask(S,N));if(h.activityRegularizer)throw new m("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(r=0;r<g.length;++r)i=g[r],a=A[r],o=k[r],n[i.id]=[a,o]}}for(var O=[],I=[],F=[],R=0,B=this.outputs;R<B.length;R++){y((i=B[R]).id in n,"Could not compute output "+i.name+" : "+i.id);var z=n[i.id],P=z[0];o=z[1],F.push(P.shape),O.push(P),I.push(o)}return[O,I,F]},t.prototype.buildNodeConversionMap=function(e){for(var n,r={},i=0,a=this.layers;i<a.length;i++){var o=a[i];n=o instanceof t?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=t.nodeKey(o,s);this.containerNodes.has(u)&&(r[u]=n,n+=1)}}return r},t.prototype.getLayer=function(e,t){if(null!=t){if(this.layers.length<=t)throw new d("Was asked to retrieve layer at index "+t+", but model only has "+this.layers.length+" layer(s).");return this.layers[t]}if(null==e)throw new d("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var i=r[n];if(i.name===e)return i}throw new d("No such layer: "+e)},t.prototype.calculateLosses=function(){var e=this;return(0,i.tidy)((function(){for(var n=[],r=0,i=e.layers;r<i.length;r++)for(var a=i[r],o=0;o<a.inboundNodes.length;++o){var s=t.nodeKey(a,o);e.containerNodes.has(s)&&n.push.apply(n,a.calculateLosses())}return n}))},t.prototype.getConfig=function(){for(var e={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[],i=0,a=this.layers;i<a.length;i++){for(var o=(x=a[i]).getClassName(),s=x.getConfig(),u=[],c=0;c<x.inboundNodes.length;c++){var l=x.inboundNodes[c],f=t.nodeKey(x,c),p={};if(this.containerNodes.has(f)){if(l.callArgs)try{JSON.stringify(l.callArgs),p=l.callArgs}catch(e){console.warn("Layer "+x.name+" was passed non-serializable keyword arguments: "+l.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),p={}}if(l.inboundLayers.length>0){for(var h=[],d=0;d<l.inboundLayers.length;d++){var m=l.inboundLayers[d],g=l.nodeIndices[d],v=l.tensorIndices[d];null==(E=n[t.nodeKey(m,g)])&&(E=0),h.push([m.name,E,v,p])}u.push(h)}}}var y={};y.name=x.name,y.className=o,y.config=s,y.inboundNodes=u,r.push(y)}e.layers=r;var b=[];for(d=0;d<this.inputLayers.length;d++){var x=this.inputLayers[d];g=this.inputLayersNodeIndices[d],f=t.nodeKey(x,g),this.containerNodes.has(f)&&(null!==(E=n[f])&&void 0!==E||(E=0),v=this.inputLayersTensorIndices[d],b.push([x.name,E,v]))}e.inputLayers=b;var w=[];for(d=0;d<this.outputLayers.length;d++){var E;x=this.outputLayers[d],g=this.outputLayersNodeIndices[d],f=t.nodeKey(x,g),this.containerNodes.has(f)&&(null!==(E=n[f])&&void 0!==E||(E=0),v=this.outputLayersTensorIndices[d],w.push([x.name,E,v]))}return e.outputLayers=w,e},t.fromConfig=function(e,t,n,r){void 0===n&&(n={}),void 0===r&&(r=!1);var i={},a={};function o(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function s(e,t){for(var n,r=[],a=0,s=t;a<s.length;a++){var u=s[a],c=u[0],l=u[1],f=u[2];if(n=null==u[3]?{}:u[3],!(c in i))return void o(e,t);var p=i[c];if(p.inboundNodes.length<=l)return void o(e,t);var h=p.inboundNodes[l];r.push(h.outputTensors[f])}r.length>0&&e.apply(x(r),n)}function u(e){var n=e.name,a=Ot(e,null!=t.customObjects?t.customObjects:{});a.setFastWeightInitDuringBuild(r),i[n]=a,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new d("Corrupted configuration, expected array for nodeData: "+e);o(a,e)}))}for(var c=t.name,l=t.layers,f=0,p=l;f<p.length;f++)u(g=p[f]);for(;!M(a);)for(var h=0,m=l;h<m.length;h++){var g=m[h];if((I=i[g.name]).name in a){var v=a[I.name];delete a[I.name];for(var b=0,w=v;b<w.length;b++)s(I,w[b])}}for(var E=[],C=[],S=0,N=t.inputLayers;S<N.length;S++){var A=(g=N[S])[0],k=g[1],D=g[2];y(A in i);var _=(I=i[A]).inboundNodes[k].outputTensors;E.push(_[D])}for(var T=0,O=t.outputLayers;T<O.length;T++){var I;A=(g=O[T])[0],k=g[1],D=g[2],y(A in i),_=(I=i[A]).inboundNodes[k].outputTensors,C.push(_[D])}return new e({inputs:E,outputs:C,name:c})},Object.defineProperty(t.prototype,"stateful",{get:function(){if(this._stateful)throw new d("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var e=0,t=this.layers;e<t.length;e++)if(t[e].stateful)return!0;return!1},enumerable:!0,configurable:!0}),t.prototype.resetStates=function(){var e=this;(0,i.tidy)((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))},t}(gt);function vn(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided "+n+" is an array of "+e.length+" element(s), but the model has "+r+" outputs. Make sure a set of weights is provided for each model output.");return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var i=[];return t.forEach((function(t){t in e?i.push(e[t]):i.push(null)})),i}throw new Error("The model has multiple ("+r+") outputs, so "+n+" must be either an array with "+r+" elements or an object with "+t+" keys. Provided "+n+" not understood: "+JSON.stringify(e))}(e,t,"classWeight")}function yn(e,t,n,r){return c(this,void 0,void 0,(function(){var a,o,s,u,c;return l(this,(function(l){switch(l.label){case 0:if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");return null==n?[3,2]:(a=(0,i.tidy)((function(){if(1===e.shape.length)return e.clone();if(2===e.shape.length){if(e.shape[1]>1)return e.argMax(1);if(1===e.shape[1])return e.reshape([e.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+e.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+e.rank+") during handling of class weights. The rank is expected to be 1 or 2.")})),u=(s=Array).from,[4,a.data()]);case 1:return o=u.apply(s,[l.sent()]),(0,i.dispose)(a),c=[],o.forEach((function(e){if(null==n[e])throw new Error("classWeight must contain all classes in the training data. The class "+e+" exists in the data but not in classWeight");c.push(n[e])})),[2,(0,i.tensor1d)(c,"float32")];case 2:return[2,null]}}))}))}function bn(e,t){return(0,i.mul)(e,t)}function xn(e,t){var n,r,a=t;n=a.xs,r=a.ys,i.util.assert(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+t}));var o=wn("input",e.inputNames,n),s=wn("output",e.outputNames,r),u=o[0].shape[0];i.util.assert(o.length===e.inputs.length,(function(){return"LayersModel has "+e.inputs.length+" inputs, but the dataset provides "+o.length+" inputs.  (Expected input keys: "+JSON.stringify(e.inputNames)+")"})),i.util.assert(s.length===e.outputs.length,(function(){return"LayersModel has "+e.outputs.length+" outputs, but the dataset provides "+s.length+" outputs.  (Expected output keys: "+JSON.stringify(e.outputNames)+")"}));for(var c=function(t){i.util.assert(o[t].shape[0]===u,(function(){return"Batch size mismatch: input "+e.inputNames[t]+" has "+o[t].shape[0]+"; expected  "+u+" based on input "+e.inputNames[0]+"."}))},l=0;l<o.length;l++)c(l);for(var f=function(t){i.util.assert(s[t].shape[0]===u,(function(){return"Batch size mismatch: output "+e.outputNames[t]+" has "+s[t].shape[0]+"; expected  "+u+" based on input "+e.inputNames[0]+"."}))},p=0;p<s.length;p++)f(p);return{xs:o,ys:s}}function wn(e,t,n){if(n instanceof i.Tensor)return[n];if(Array.isArray(n))return i.util.assert(n.length===t.length,(function(){return"Received an array of "+n.length+" Tensors, but expected "+t.length+" to match the "+e+" keys "+t+"."})),n;for(var r=[],a=0,o=t;a<o.length;a++){var s=o[a];if(null==n[s])throw new d("The feature data generated by the dataset lacks the required "+e+" key '"+s+"'.");r.push(n[s])}return r}function En(e,t,n){return c(this,void 0,void 0,(function(){var r,a,o,s,u,c,f,p,h,d,g,v,y,b,x,E,C,S,N,A,k,D,_,M,T,O,I,F,R,B,z,P,L,j;return l(this,(function(l){switch(l.label){case 0:if(r=null!=n.batchesPerEpoch,i.util.assert(null!=e.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),i.util.assert(null!=n,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),i.util.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs})),i.util.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch})),i.util.assert(null==n.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0,l.label=1;case 1:return l.trys.push([1,,26,27]),a=null!=n.validationData,o=void 0,s=void 0,a&&(Cn(n.validationData)?i.util.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches})):(u=function(e){if(3===e.length)throw new m("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData),o=u.xs,s=u.ys)),c=e.makeTrainFunction(),f=e.getDedupedMetricsNames(),p=a?f.slice().concat(f.map((function(e){return"val_"+e}))):f.slice(),h=_t(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,g=Tt(h,d,n.epochs,null,null,function(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(t,n),null,a,p),v=g.callbackList,y=g.history,v.setModel(e),e.history=y,[4,v.onTrainBegin()];case 2:return l.sent(),e.stopTraining_=!1,b=null==n.initialEpoch?0:n.initialEpoch,[4,t.iterator()];case 3:x=l.sent(),l.label=4;case 4:return b<n.epochs?(E={},[4,v.onEpochBegin(b)]):[3,23];case 5:return l.sent(),C=0,S=0,r?[3,7]:[4,t.iterator()];case 6:x=l.sent(),l.label=7;case 7:return!r||C<n.batchesPerEpoch?[4,x.next()]:[3,21];case 8:return N=l.sent(),r&&N.done?(console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+C+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):null==N.value?[3,15]:(A=xn(e,N.value),k=A.xs,D=A.ys,(_={}).batch=S,_.size=k[0].shape[0],[4,v.onBatchBegin(S,_)]);case 9:if(l.sent(),M=[],null==n.classWeight)return[3,13];T=vn(n.classWeight,e.outputNames),j=0,l.label=10;case 10:return j<T.length?(I=(O=M).push,[4,yn(D[j],null,T[j])]):[3,13];case 11:I.apply(O,[l.sent()]),l.label=12;case 12:return++j,[3,10];case 13:for(F=k.concat(D).concat(M),R=c(F),(0,i.dispose)(F),j=0;j<f.length;++j)B=f[j],z=R[j],_[B]=z,(0,i.keep)(z);return[4,v.onBatchEnd(S,_)];case 14:l.sent(),Ct(_),S++,C++,l.label=15;case 15:return(r?C>=n.batchesPerEpoch:N.done)?a?(P=void 0,Cn(n.validationData)?(L=w,[4,e.evaluateDataset(n.validationData,{batches:n.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return P=L.apply(void 0,[l.sent()]),[3,18];case 17:P=w(e.evaluate(o,s,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0})),l.label=18;case 18:for(j=0;j<e.metricsNames.length;++j)E["val_"+e.metricsNames[j]]=P[j];l.label=19;case 19:return[3,21];case 20:return e.stopTraining_?[3,21]:[3,7];case 21:return[4,v.onEpochEnd(b,E)];case 22:return l.sent(),b++,e.stopTraining_?[3,23]:[3,4];case 23:return[4,v.onTrainEnd()];case 24:return l.sent(),[4,e.history.syncData()];case 25:return l.sent(),[2,e.history];case 26:return e.isTraining=!1,[7];case 27:return[2]}}))}))}function Cn(e){return"function"==typeof e.iterator}function Sn(e,t,n){return c(this,void 0,void 0,(function(){var r,a,o,s,u,c,f,p,h,d;return l(this,(function(g){switch(g.label){case 0:if(r=null!=(n=n||{}).batches,a=e.testFunction,o=[],n.verbose>0)throw new m("Verbose mode is not implemented yet.");return i.util.assert(!r||n.batches>0&&Number.isInteger(n.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches)})),function(e){return"function"==typeof e.next}(t)?(u=t,[3,3]):[3,1];case 1:return[4,t.iterator()];case 2:u=g.sent(),g.label=3;case 3:s=u,c=0,f=0,p=function(){var t;return l(this,(function(u){switch(u.label){case 0:return[4,s.next()];case 1:return t=u.sent(),o=(0,i.tidy)((function(){if(t.value){var n=xn(e,t.value),r=n.xs,s=n.ys,u=r.concat(s),l=(0,i.tidy)((function(){return a(u)}));if((0,i.dispose)(u),0===f)for(var p=0;p<l.length;++p)o.push((0,i.scalar)(0));var h=u[0].shape[0],d=function(e){var t=l[e],n=o[e];o[e]=(0,i.tidy)((function(){return(0,i.add)(o[e],(0,i.mul)(h,t))})),f>0&&(0,i.dispose)(n)};for(p=0;p<l.length;++p)d(p);(0,i.dispose)(l),c+=h,++f}return o})),t.done?(r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+n.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}}))},g.label=4;case 4:return!r||f<n.batches?[5,p()]:[3,6];case 5:return"break"===g.sent()?[3,6]:[3,4];case 6:for(h=0;h<o.length;++h)d=o[h],o[h]=(0,i.div)(o[h],c),(0,i.dispose)(d);return[2,x(o)]}}))}))}function Nn(e){i.util.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got "+e}))}function An(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return me(e,t,n-t)})):me(e,t,n-t)}function kn(e,t){return(0,i.tidy)((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return kn(e,t)})):Ce(e,"int32"===t.dtype?t:t.toInt())}))}function Dn(e,t){for(var n=[],r=0,i=null;r<e;)(i=r+t)>=e&&(i=e),n.push([r,i]),r=i;return n}function _n(e,t,n,r,a,o,s,u,f,p,h,g,v,y,b){return c(this,void 0,void 0,(function(){var c,x,w,E,C,S,N,A;return l(this,(function(k){switch(k.label){case 0:if(null==a&&(a=32),null==o&&(o=1),null==h&&(h=!0),null==v&&(v=0),c=!1,null!=f&&null!=p&&(c=!0),null!=b&&(c=!0,null==y))throw new d("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return null!=(x=e.checkNumSamples(n,a,y,"steps_per_epoch"))&&(w=pe(0,x)),null==s&&(s=1),E=Tt(u,s,o,v,x,y,a,c,g),C=E.callbackList,S=E.history,C.setModel(e),e.history=S,[4,C.onTrainBegin()];case 1:k.sent(),e.stopTraining_=!1,N=function(o){var s,u,d,g,v;return l(this,(function(b){switch(b.label){case 0:return[4,C.onEpochBegin(o)];case 1:if(b.sent(),s={},null==y)return[3,2];throw new m("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===h)throw new m("batch shuffling is not implemneted yet");h&&i.util.shuffle(w),u=(0,i.tensor1d)(w),d=Dn(x,a),g=function(o){var h;return l(this,(function(l){switch(l.label){case 0:return h={},[4,C.onBatchBegin(o,h)];case 1:return l.sent(),(0,i.tidy)((function(){var l=d[o][0],m=d[o][1],g=me(u,l,m-l);h.batch=o,h.size=m-l;for(var v=kn(n,g),y=t(v),b=0;b<r.length;++b){var x=r[b],w=y[b];h[x]=w,(0,i.keep)(w)}if(o===d.length-1&&c){var E=e.testLoop(f,p,a);for(b=0;b<r.length;++b)x=r[b],w=E[b],(0,i.keep)(w),s["val_"+x]=w}})),[4,C.onBatchEnd(o,h)];case 2:return l.sent(),Ct(h),e.stopTraining_?[2,"break"]:[2]}}))},v=0,b.label=3;case 3:return v<d.length?[5,g(v)]:[3,6];case 4:if("break"===b.sent())return[3,6];b.label=5;case 5:return++v,[3,3];case 6:u.dispose(),b.label=7;case 7:return[4,C.onEpochEnd(o,s)];case 8:return b.sent(),e.stopTraining_?[2,"break"]:[2]}}))},A=v,k.label=2;case 2:return A<o?[5,N(A)]:[3,5];case 3:if("break"===k.sent())return[3,5];k.label=4;case 4:return++A,[3,2];case 5:return[4,C.onTrainEnd()];case 6:return k.sent(),[4,e.history.syncData()];case 7:return k.sent(),[2,e.history]}}))}))}function Mn(e,t,n,r){return void 0===r&&(r={}),c(this,void 0,void 0,(function(){var a,o,s,u,c,f,p,h,g,v,y,b,x,w,E,C,S,N,A,k;return l(this,(function(l){switch(l.label){case 0:if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0,l.label=1;case 1:return l.trys.push([1,,7,8]),Nn(h=null==r.batchSize?32:r.batchSize),[4,e.standardizeUserData(t,n,r.sampleWeight,r.classWeight,!1,h)];case 2:if(g=l.sent(),a=g[0],o=g[1],p=g[2],v=!1,y=void 0,!(null!=r.validationData&&r.validationData.length>0))return[3,4];if(v=!0,2!==r.validationData.length)throw 3===r.validationData.length?new m("validationData including sample weights is not supported yet."):new d("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+r.validationData+" is invalid.");return s=r.validationData[0],u=r.validationData[1],[4,e.standardizeUserData(s,u,null,null,!0,h)];case 3:return b=l.sent(),c=b[0],f=b[1],y=c.concat(f),[3,5];case 4:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(v=!0,x=Math.floor(a[0].shape[0]*(1-r.validationSplit)),w=a[0].shape[0],c=An(a,x,w),a=An(a,0,x),f=An(o,x,w),o=An(o,0,x),y=c.concat(f)):null!=r.validationSteps&&(v=!0),l.label=5;case 5:return E=a.concat(o).concat(p),e.checkTrainableWeightsConsistency(),C=e.makeTrainFunction(),S=e.getDedupedMetricsNames(),N=void 0,A=void 0,v?(e.makeTestFunction(),N=e.testFunction,A=S.slice().concat(S.map((function(e){return"val_"+e})))):(N=null,y=[],A=S.slice()),k=_t(r.callbacks,r.yieldEvery),[4,_n(e,C,E,S,h,r.epochs,r.verbose,k,N,y,r.shuffle,A,r.initialEpoch,null,null)];case 6:return[2,l.sent()];case 7:return e.isTraining=!1,On(a,t),On(o,n),On(c,s),On(f,u),null!=p&&(0,i.dispose)(p),[7];case 8:return[2]}}))}))}function Tn(e){var t=[];e instanceof i.Tensor&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(de(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function On(e,t){if(null!=e){var n=[];if(t instanceof i.Tensor)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var o=[];if(e instanceof i.Tensor)-1===n.indexOf(e.id)&&o.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&o.push(e)}));else if(null!=e)for(var s in e){var u=e[s];-1===n.indexOf(u.id)&&o.push(u)}o.forEach((function(e){e.isDisposed||e.dispose()}))}}function In(e){return Array.isArray(e)}function Fn(e){return!function(e){return e instanceof i.Tensor}(e)&&!In(e)}function Rn(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=""),null==t||0===t.length){if(null!=e){var a=!1;if(In(e)&&e.length>0)a=!0;else if(Fn(e)){for(var o in e)if(e.hasOwnProperty(o)){a=!0;break}}else a=!0;if(a)throw new d("Error when checking model "+i+" expected no data, but got "+e)}return[]}if(null==e)return t.map((function(e){return null}));var s;if(Fn(e)){e=e,s=[];for(var u=0,c=t;u<c.length;u++){var l=c[u];if(null==e[l])throw new d('No data provided for "'+l+'". Need data for each key in: '+t);s.push(e[l])}}else if(In(e)){if((e=e).length!==t.length)throw new d("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+t.length+" Tensor(s), but instead got the following list of Tensor(s): "+e);s=e}else{if(e=e,t.length>1)throw new d("The model "+i+" expects "+t.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+e.shape);s=[e]}if(s=Tn(s),null!=n)for(var f=0;f<t.length;++f)if(null!=n[f]){var p=s[f];if(p.shape.length!==n[f].length)throw new d("Error when checking "+i+": expected "+t[f]+" to have "+n[f].length+" dimension(s). but got array with shape "+p.shape);for(var h=0;h<n[f].length;++h)if(0!==h||r){var m=p.shape[h],g=n[f][h];if(null!=g&&g>=0&&m!==g)throw new d("Error when checking "+i+": expected "+t[f]+" to have shape ["+n[f]+"], but got array with shape ["+p.shape+"].")}}return s}function Bn(e,t,n,r,i){var a;if(void 0===r&&(r=!0),void 0===i&&(i=""),Array.isArray(e)){if(e.length!==t.length)throw new d("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+t.length+" Tensor(s), but instead got "+e.length+" Tensors(s).");a=e}else{if(t.length>1)throw new d("The model expects "+t.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(e.shape)+".");a=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=a[o];if(s.shape.length!==n[o].length)throw new d("Error when checking "+i+": expected "+t[o]+" to have "+n[o].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[o].length;++u)if(0!==u||r){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new d("Error when checking "+i+": expected "+t[o]+" to have shape "+JSON.stringify(n[o])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}var zn=function(e){function t(t){var n=e.call(this,t)||this;return n.isTraining=!1,n}return o(t,e),t.prototype.summary=function(e,t,n){if(void 0===n&&(n=console.log),!this.built)throw new d("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n,r){void 0===r&&(r=console.log);var i,a=function(e){var t=!0,n=[],r=[];for(var i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(var a=0,o=n;a<o.length;a++){var s=o[a];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,s)}if(t)for(var u=0,c=e.layers;u<c.length;u++){for(var l=!1,f=0,p=c[u].inboundNodes;f<p.length;f++){var h=p[f];if(-1!==r.indexOf(h)){if(l){t=!1;break}l=!0}}if(!t)break}return t}(e),o=["Layer (type)","Output shape","Param #"];if(a?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!a)for(var s in o.push("Receives inputs"),i=[],e.nodesByDepth)i.push.apply(i,e.nodesByDepth[s]);r("_".repeat(t)),tn(o,n,r),r("=".repeat(t));for(var u=e.layers,c=0;c<u.length;++c)a?nn(u[c],n,r):rn(u[c],n,i,r),r((c===u.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var l=function(e){return null!=e.collectedTrainableWeights?ot(e.collectedTrainableWeights):ot(e.trainableWeights)}(e),f=ot(e.nonTrainableWeights);r("Total params: "+(l+f)),r("Trainable params: "+l),r("Non-trainable params: "+f),r("_".repeat(t))}(this,e,t,n)},t.prototype.compile=function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return i.train.adagrad(.01)},Adadelta:function(){return i.train.adadelta(1,.95,f())},Adam:function(){return i.train.adam(.001,.9,.999,f())},Adamax:function(){return i.train.adamax(.002,.9,.999,f(),0)},RMSProp:function(){return i.train.rmsprop(.001,.9,0,f())},SGD:function(){return i.train.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new d("Unknown Optimizer "+e)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof i.Optimizer))throw new d("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new d("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+e.loss+".");var r=e.loss;n=r.map((function(e){return qt(e)}))}else{var a=qt(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var o in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(o))throw new d('Unknown entry in loss dictionary: "'+o+'". Only expected the following keys: '+this.outputNames);for(var s=0,u=this.outputNames;s<u.length;s++){var c=u[s];null==e.loss[c]&&console.warn('Output "'+c+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+c+" during training"),n.push(qt(e.loss[c]))}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var l=0;l<this.outputs.length;++l){var p=this.internalOutputShapes[l],h=this.outputNames[l];this.feedOutputNames.push(h),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[l])}var m=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ne("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===m.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var g=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+e);n=e}if(Array.isArray(n))return t.map((function(e){return n}));for(var r=[],i=0,a=t;i<a.length;i++){var o=a[i],s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}(e.metrics,this.outputNames);ne("metric",(function(){for(var e=function(e){if(-1!==m.indexOf(e))return"continue";!function(n){for(var r,i,a,o=function(n){if("string"==typeof n&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(n)){var o=t.internalOutputShapes[e];1===o[o.length-1]||t.lossFunctions[e]===Lt?-1!==["accuracy","acc"].indexOf(n)?i=Wt:-1!==["crossentropy","ce"].indexOf(n)&&(i=Gt):t.lossFunctions[e]===Pt?-1!==["accuracy","acc"].indexOf(n)?i=Kt:-1!==["crossentropy","ce"].indexOf(n)&&(i=Yt):-1!==["accuracy","acc"].indexOf(n)?i=Vt:-1!==["crossentropy","ce"].indexOf(n)&&(i=Xt);var s=void 0;-1!==["accuracy","acc"].indexOf(n)?s="acc":-1!==["crossentropy","ce"].indexOf(n)&&(s="ce"),a=i,r=""+s}else{var u=function(e){if("string"==typeof e&&e in Jt)return Jt[e];if("string"!=typeof e&&null!=e)return e;throw new d("Unknown metric "+e)}(n);a=u,r=""+Zt(n)}var c;ne(r,(function(){c=a})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,c)},s=0,u=n;s<u.length;s++)o(u[s])}(g[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights},t.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},t.prototype.evaluate=function(e,t,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize;Nn(r);var i=this.standardizeUserDataXY(e,t,!0,r);try{var a=i[0].concat(i[1]);this.makeTestFunction();var o=this.testFunction;return x(this.testLoop(o,a,r,n.verbose,n.steps))}finally{On(i[0],e),On(i[1],t)}},t.prototype.evaluateDataset=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){return this.makeTestFunction(),[2,Sn(this,e,t)]}))}))},t.prototype.checkNumSamples=function(e,t,n,r){var i;if(void 0===r&&(r="steps"),null!=n){if(i=null,null!=t)throw new d("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+t)}else{if(null==e)throw new d("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i},t.prototype.execute=function(e,t){if(Array.isArray(t)&&0===t.length)throw new d("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),o=new cn;if(e instanceof i.Tensor&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new d("The number of inputs provided ("+e.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var s=0;s<this.inputs.length;++s)o.add(this.inputs[s],e[s])}else for(var u=0,c=this.inputs;u<c.length;u++){var l=c[u],f=e[l.name];if(null==f)throw new d("No value is provided for the model's input "+l.name);o.add(l,f)}var p=pn(a,o);return n?p:p[0]},t.prototype.retrieveSymbolicTensors=function(e){for(var t=v(null,e.length),n=e.length,r=0,i=this.layers;r<i.length;r++){for(var a=i[r],o=Array.isArray(a.output)?a.output:[a.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(t[u]=o[c],n--),0===n)break}if(0===n)break}if(n>0){var l=[];throw t.forEach((function(t,n){null==t&&l.push(e[n])})),new d("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(l))}return t},t.prototype.predictLoop=function(e,t,n){var r=this;return void 0===t&&(t=32),void 0===n&&(n=!1),(0,i.tidy)((function(){var a=r.checkNumSamples(e);if(n)throw new m("Verbose predictLoop() is not implemented yet.");for(var o=Dn(a,t),s=r.outputs.map((function(e){return[]})),u=function(t){(0,i.tidy)((function(){var n=o[t][0],i=o[t][1],a=An(e,n,i),s=[];if(Array.isArray(a))for(var u=0;u<a.length;++u)s.push({key:r.inputs[u],value:a[u]});else s.push({key:r.inputs[0],value:a});var c=new cn(s);return pn(r.outputs,c)})).forEach((function(e,t){return s[t].push(e)}))},c=0;c<o.length;++c)u(c);return x(s.map((function(e){return(0,i.concat)(e,0)})))}))},t.prototype.predict=function(e,t){void 0===t&&(t={});var n=Tn(e);Bn(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return Nn(r),this.predictLoop(n,r)}finally{On(n,e)}},t.prototype.predictOnBatch=function(e){Bn(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)},t.prototype.standardizeUserDataXY=function(e,t,n,r){if(void 0===n&&(n=!0),null==this.optimizer_)throw new h("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var a=[],o=0;o<this.feedOutputShapes.length;++o){var s=this.feedOutputShapes[o];this.feedLossFns[o]===Pt?a.push(s.slice(0,s.length-1).concat([1])):a.push(s)}if(function(e,t,n){var r=_(e.map((function(e){return e.shape[0]})));r.sort();var a=_(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new d("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map((function(e){return e.shape}))));if(a.length>1)throw new d("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map((function(e){return e.shape}))));if(r.length>0&&a.length>0&&!i.util.arraysEqual(r,a))throw new d("Input Tensors should have the same number of samples as target Tensors. Found "+r[0]+" input sample(s) and "+a[0]+" target sample(s).")}(e=Rn(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=Rn(t,this.feedOutputNames,a,!1,"target")),function(e,t,n){for(var r=[Ft,Lt,zt],i=0;i<e.length;++i){var a=e[i],o=t[i],s=n[i];if(null!=o){if(o===zt&&1===a.shape[a.shape.length-1])throw new d("You are passing a target array of shape "+a.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=a.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],p=c[l];if(null!=p&&f!==p)throw new d("A target Tensor with shape "+a.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&e[0].shape[0]%r!=0)throw new d("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+r+". Found: "+e[0].shape[0]+" sample(s).");return[e,t]},t.prototype.standardizeUserData=function(e,t,n,r,i,a){return void 0===i&&(i=!0),c(this,void 0,void 0,(function(){var o,s,u,c,f,p,h,d;return l(this,(function(l){switch(l.label){case 0:if(o=this.standardizeUserDataXY(e,t,i,a),s=o[0],u=o[1],null!=n)throw new Error("sample weight is not supported yet.");if(c=null,null==r)return[3,4];f=vn(r,this.outputNames),c=[],p=0,l.label=1;case 1:return p<f.length?(d=(h=c).push,[4,yn(u[p],null,f[p])]):[3,4];case 2:d.apply(h,[l.sent()]),l.label=3;case 3:return++p,[3,1];case 4:return[2,[s,u,c]]}}))}))},t.prototype.testLoop=function(e,t,n,r,a){var o=this;return void 0===r&&(r=0),(0,i.tidy)((function(){var s=o.checkNumSamples(t,n,a,"steps"),u=[];if(r>0)throw new m("Verbose mode is not implemented yet.");if(null!=a)throw new m("steps mode in testLoop() is not implemented yet");for(var c=Dn(s,n),l=(0,i.tensor1d)(pe(0,s)),f=0;f<c.length;++f){var p=c[f][0],h=c[f][1],d=me(l,p,h-p),g=kn(t,d),v=e(g);if(0===f)for(var y=0;y<v.length;++y)u.push((0,i.scalar)(0));for(y=0;y<v.length;++y){var b=v[y];u[y]=(0,i.add)(u[y],(0,i.mul)(h-p,b))}}for(y=0;y<u.length;++y)u[y]=(0,i.div)(u[y],s);return u}))},t.prototype.getDedupedMetricsNames=function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],i=r;b(e,r)>1&&(i+="_"+b(e.slice(0,n),r)),t.push(i)}return t},t.prototype.makeTrainFunction=function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),s=[],u=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],u=0;u<e.inputs.length;++u)t.push({key:e.inputs[u],value:r[u]});var c,l=new cn(t),f=pn(e.outputs,l,{training:!0});for(u=0;u<e.lossFunctions.length;++u){var p=(0,e.lossFunctions[u])(a[u],f[u]);null!=o[u]&&(p=bn(p,o[u]));var h=(0,i.mean)(p);n.push(h),c=0===u?p:(0,i.add)(c,p)}for(u=0;u<e.metricsTensors.length;++u){var d=void 0;if(e.outputs.length>1&&u<e.outputs.length)d=n[u];else{var m=e.metricsTensors[u][0],g=e.metricsTensors[u][1];d=(0,i.mean)(m(a[g],f[g]))}(0,i.keep)(d),s.push(d)}return c=(0,i.mean)(c),e.calculateLosses().forEach((function(e){c=(0,i.add)(c,e)})),c}),!0,u)].concat(s)}},t.prototype.makeTestFunction=function(){var e=this;this.testFunction=function(t){return(0,i.tidy)((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),o=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),s=[],u=0;u<e.inputs.length;++u)s.push({key:e.inputs[u],value:a[u]});var c=new cn(s),l=pn(e.outputs,c);for(u=0;u<e.lossFunctions.length;++u){var f=e.lossFunctions[u],p=(0,i.mean)(f(o[u],l[u]));n=0===u?p:(0,i.add)(n,p),r.push(n)}for(u=0;u<e.metricsTensors.length;++u){var h=e.metricsTensors[u][0],d=e.metricsTensors[u][1],m=(0,i.mean)(h(o[d],l[d]));r.push(m)}return r}))}},t.prototype.fit=function(e,t,n){return void 0===n&&(n={}),c(this,void 0,void 0,(function(){return l(this,(function(r){return[2,Mn(this,e,t,n)]}))}))},t.prototype.fitDataset=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){return[2,En(this,e,t)]}))}))},t.prototype.trainOnBatch=function(e,t){return c(this,void 0,void 0,(function(){var n,r,a,o,s,u,c,f,p;return l(this,(function(l){switch(l.label){case 0:return[4,this.standardizeUserData(e,t)];case 1:n=l.sent(),r=n[0],a=n[1],o=this.makeTrainFunction(),s=o(r.concat(a)),u=[],c=0,f=s,l.label=2;case 2:return c<f.length?[4,f[c].data()]:[3,5];case 3:p=l.sent(),u.push(p[0]),l.label=4;case 4:return c++,[3,2];case 5:return(0,i.dispose)(s),[2,x(u)]}}))}))},t.prototype.getNamedWeights=function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n),a=0;a<r.length;++a)n&&!r[a].trainable||t.push({name:r[a].originalName,tensor:i[a]});return t},Object.defineProperty(t.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=e.prototype.dispose.call(this);if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var n=(0,i.memory)().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-(0,i.memory)().numTensors}return t},t.prototype.getLossIdentifiers=function(){var e;if("string"==typeof this.loss)e=E(this.loss);else if(Array.isArray(this.loss)){for(var t=0,n=this.loss;t<n.length;t++)if("string"!=typeof n[t])throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((function(e){return E(e)}))}else{var r=Object.keys(this.loss);e={};for(var i=this.loss,a=0,o=r;a<o.length;a++){var s=o[a];if("string"!=typeof i[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=E(i[s])}}return e},t.prototype.getMetricIdentifiers=function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[E(Zt(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return E(Zt(e))}));var e={};for(var t in this.metrics)e[t]=E(Zt(this.metrics[t]));return e},t.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},t.prototype.loadTrainingConfig=function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=Ot(on(e.optimizer_config));if("string"==typeof e.loss)t=C(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return C(e)}));else if(null!=e.loss)for(var i in t={},e.loss)t[i]=C(e.loss[i]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return C(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=C(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})},t.prototype.save=function(e,t){return c(this,void 0,void 0,(function(){var n,r,a,o,s,u,c,f,p,h,m;return l(this,(function(l){switch(l.label){case 0:if("string"==typeof e){if(0===(n=i.io.getSaveHandlers(e)).length)throw new d("Cannot find any save handlers for URL '"+e+"'");if(n.length>1)throw new d("Found more than one ("+n.length+") save handlers for URL '"+e+"'");e=n[0]}if(null==e.save)throw new d("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,i.io.encodeWeights(this.getNamedWeights(t))];case 1:return r=l.sent(),a=this.toJSON(null,!1),o={modelTopology:a,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v"+un,convertedBy:null},null!=t&&t.includeOptimizer&&null!=this.optimizer?(o.trainingConfig=this.getTrainingConfig(),s="optimizer",h=(p=i.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,h.apply(p,[l.sent(),s])];case 3:u=l.sent(),c=u.data,f=u.specs,(m=r.specs).push.apply(m,f),r.data=i.io.concatenateArrayBuffers([r.data,c]),l.label=4;case 4:return null!=this.userDefinedMetadata&&(Qt(this.userDefinedMetadata,this.name,!0),o.userDefinedMetadata=this.userDefinedMetadata),o.weightData=r.data,o.weightSpecs=r.specs,[2,e.save(o)]}}))}))},t.prototype.setUserDefinedMetadata=function(e){Qt(e,this.name),this.userDefinedMetadata=e},t.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},t.className="Model",t}(gn);function Pn(e,t,n){return c(this,void 0,void 0,(function(){var r,a,o,s,u,c,f,p,h;return l(this,(function(l){switch(l.label){case 0:if(null==n&&(n={}),null==e.load)throw new d("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,e.load()];case 1:if(r=l.sent(),null!=(a=r.modelTopology).model_config&&(a=a.model_config),o=null==n.strict||n.strict,s=null!=r.weightData&&null!=r.weightSpecs&&o,u=Ot(on(a),t,s),null!=(c=r.trainingConfig)&&u.loadTrainingConfig(c),null!=r.userDefinedMetadata&&u.setUserDefinedMetadata(r.userDefinedMetadata),null==r.weightData)return[3,4];if(null==r.weightSpecs)throw new d("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return f=function(e,t){var n=i.io.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}(r.weightData,r.weightSpecs),p=f.modelWeights,h=f.optimizerWeights,u.loadWeights(p,o),null!=u.optimizer&&h.length>0?[4,u.optimizer.setWeights(h)]:[3,3];case 2:l.sent(),l.label=3;case 3:(0,i.dispose)(p),(0,i.dispose)(h.map((function(e){return e.tensor}))),l.label=4;case 4:return[2,u]}}))}))}i.serialization.registerClass(zn);var Ln=function(e){function t(t){var n=e.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},n.trainable=!0,n.built=!1,n.name=null!=t.name?t.name:tt("sequential_"),null!=t.layers)for(var r=0,i=t.layers;r<i.length;r++){var a=i[r];n.add(a)}return n}return o(t,e),t.prototype.checkShape=function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new d("Negative dimension size caused by adding layer "+e.name+" with input shape ["+e.inboundNodes[0].inputTensors[0].shape+"]")},t.prototype.add=function(e){var n,r=e instanceof t||e instanceof zn;if(r){if(1!==(n=e).outputs.length)throw new d("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new d("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new d("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=wt({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new d("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+e.name+" which has "+e.inboundNodes.length+" pre-existing inbound connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new d("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=vt(this.outputs[0])}this.inboundNodes=[],new dt({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:v(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var a=e.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1},t.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},t.prototype.call=function(e,t){return null==this.model&&this.build(),this.model.call(e,t)},t.prototype.build=function(e){if(at(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new zn({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},t.prototype.countParams=function(){return this.built||this.build(),e.prototype.countParams.call(this)},t.prototype.summary=function(t,n,r){void 0===r&&(r=console.log),this.built||this.build(),e.prototype.summary.call(this,t,n,r)},t.prototype.setWeights=function(e){null==this.model&&this.build(),this.model.setWeights(e)},t.prototype.evaluate=function(e,t,n){if(void 0===n&&(n={}),!this.built)throw new h("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)},t.prototype.evaluateDataset=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){if(!this.built)throw new h("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(e,t)]}))}))},t.prototype.predict=function(e,t){return void 0===t&&(t={}),null==this.model&&this.build(),this.model.predict(e,t)},t.prototype.predictOnBatch=function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)},t.prototype.compile=function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(t.prototype,"optimizer",{get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e},enumerable:!0,configurable:!0}),t.prototype.fit=function(e,t,n){return void 0===n&&(n={}),c(this,void 0,void 0,(function(){return l(this,(function(r){if(!this.built)throw new h("The model needs to be compiled before being used.");return[2,this.model.fit(e,t,n)]}))}))},t.prototype.fitDataset=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){if(!this.built)throw new h("The model needs to be compiled before being used.");return[2,this.model.fitDataset(e,t)]}))}))},t.prototype.trainOnBatch=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){return[2,this.model.trainOnBatch(e,t)]}))}))},t.fromConfig=function(e,n,r,a){var o;void 0===r&&(r={}),void 0===a&&(a=!1);var s={};if(n instanceof Array){if(null==n[0].className||"Merge"===n[0].className)throw new d("Legacy serialization format not supported yet.");o=n}else i.util.assert(null!=n.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),o=n.layers,delete n.layers,s=n;var u=new e(s);if(!(u instanceof t))throw new m("Sequential.fromConfig called on non-Sequential input: "+u);for(var c=0,l=o;c<l.length;c++){var f=Ot(l[c],void 0,a);a&&f.setFastWeightInitDuringBuild(!0),u.add(f)}return u},Object.defineProperty(t.prototype,"stopTraining",{get:function(){if(null==this.model)throw new d("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new d("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t],i={};i.className=r.getClassName(),i.config=r.getConfig(),e.push(i)}return{name:this.name,layers:e}},t.className="Sequential",t}(zn);function jn(e){return new zn(e)}function Un(e){return new Ln(e)}function qn(e,t){return null==t&&(t={}),function(e,t){return c(this,void 0,void 0,(function(){var n;return l(this,(function(r){if(null==t&&(t={}),"string"==typeof e){if(0===(n=i.io.getLoadHandlers(e,t.onProgress)).length)n.push(i.io.browserHTTPRequest(e,t));else if(n.length>1)throw new d("Found more than one ("+n.length+") load handlers for URL '"+e+"'");e=n[0]}return[2,Pn(e,void 0,t)]}))}))}(e,t)}function Wn(e){return wt(e)}function Vn(e,t){Mt.registerCallbackConstructor(e,t)}i.serialization.registerClass(Ln);var $n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.getConfig=function(){return{}},t}(i.serialization.Serializable),Hn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=1),function(e,t){if(void 0===t&&(t=1),1!==t)throw new m("Support for alpha values other than 1 ("+t+") is not implemented yet.");return(0,i.elu)(e)}(e,t)},t.className="elu",t}($n);i.serialization.registerClass(Hn);var Gn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return(0,i.selu)(e)},t.className="selu",t}($n);i.serialization.registerClass(Gn);var Kn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return(0,i.relu)(e)},t.className="relu",t}($n);i.serialization.registerClass(Kn);var Xn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return(0,i.tidy)((function(){return(0,i.minimum)(6,(0,i.relu)(e))}))},t.className="relu6",t}($n);i.serialization.registerClass(Xn);var Yn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return e},t.className="linear",t}($n);i.serialization.registerClass(Yn);var Jn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return(0,i.sigmoid)(e)},t.className="sigmoid",t}($n);i.serialization.registerClass(Jn);var Zn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return function(e){return(0,i.tidy)((function(){var t=(0,i.add)(.5,(0,i.mul)(.2,e));return(0,i.clipByValue)(t,0,1)}))}(e)},t.className="hardSigmoid",t}($n);i.serialization.registerClass(Zn);var Qn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return(0,i.softplus)(e)},t.className="softplus",t}($n);i.serialization.registerClass(Qn);var er=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return function(e){return(0,i.tidy)((function(){return(0,i.div)(e,(0,i.abs)(e).add(1))}))}(e)},t.className="softsign",t}($n);i.serialization.registerClass(er);var tr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e){return(0,i.tanh)(e)},t.className="tanh",t}($n);i.serialization.registerClass(tr);var nr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),(0,i.softmax)(e,t)},t.className="softmax",t}($n);i.serialization.registerClass(nr);var rr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),(0,i.logSoftmax)(e,t)},t.className="logSoftmax",t}($n);function ir(e){return e.getClassName()}function ar(e,t){return void 0===t&&(t={}),k(e,i.serialization.SerializationMap.getMap().classNameMap,t,"activation")}function or(e){var t;return null==e?ar(t={className:"linear",config:{}}):"string"==typeof e?((t={}).className=e,t.config={},ar(t)):e instanceof $n?e:ar(e)}function sr(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+e)}i.serialization.registerClass(rr);var ur=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(i.serialization.Serializable),cr=function(e){function t(t){var n=e.call(this)||this;return sr(t),n.l1=null==t||null==t.l1?.01:t.l1,n.l2=null==t||null==t.l2?.01:t.l2,n.hasL1=0!==n.l1,n.hasL2=0!==n.l2,n}return o(t,e),t.prototype.apply=function(e){var t=this;return(0,i.tidy)((function(){var n=(0,i.zeros)([1]);return t.hasL1&&(n=(0,i.add)(n,(0,i.sum)((0,i.mul)(t.l1,(0,i.abs)(e))))),t.hasL2&&(n=(0,i.add)(n,(0,i.sum)((0,i.mul)(t.l2,Se(e))))),n.asScalar()}))},t.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},t.fromConfig=function(e,t){return new e({l1:t.l1,l2:t.l2})},t.className="L1L2",t}(ur);i.serialization.registerClass(cr);var lr={l1l2:"L1L2"};function fr(e){return N(e)}function pr(e,t){return void 0===t&&(t={}),k(e,i.serialization.SerializationMap.getMap().classNameMap,t,"regularizer")}function hr(e){return null==e?null:"string"==typeof e?pr({className:e in lr?lr[e]:e,config:{}}):e instanceof ur?e:pr(e)}var dr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.supportsMasking=!0,null!=t&&(n.maxValue=t.maxValue),n}return o(t,e),t.prototype.call=function(e,t){e=it(e);var n=(0,i.relu)(e);return null!=this.maxValue&&(n=(0,i.clipByValue)(n,0,this.maxValue)),n},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ReLU",t}(gt);i.serialization.registerClass(dr);var mr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_ALPHA=.3,null==t&&(t={}),n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return o(t,e),t.prototype.call=function(e,t){var n=it(e);return(0,i.leakyRelu)(n,this.alpha)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LeakyReLU",t}(gt);i.serialization.registerClass(mr);var gr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),n.supportsMasking=!0,n.alphaInitializer=Ye(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=hr(t.alphaRegularizer),n.alphaConstraint=$(t.alphaConstraint),null==t.sharedAxes)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new d("Expected sharedAxes to be a number or an array of numbers, but got "+t.sharedAxes);n.sharedAxes=[t.sharedAxes]}return n}return o(t,e),t.prototype.build=function(e){var t=(e=at(e)).slice(1);if(null!=this.sharedAxes)for(var n=0,r=this.sharedAxes;n<r.length;n++)t[(a=r[n])-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var i={};if(null!=this.sharedAxes)for(var a=1;a<e.length;++a)i[a]=e[a];this.inputSpec=[new ft({ndim:e.length,axes:i})],this.built=!0},t.prototype.call=function(e,t){return e=it(e),(0,i.prelu)(e,this.alpha.read())},t.prototype.getConfig=function(){var t={alphaInitializer:Xe(this.alphaInitializer),alphaRegularizer:fr(this.alphaRegularizer),alphaConstraint:W(this.alphaConstraint),sharedAxes:this.sharedAxes},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="PReLU",t}(gt);i.serialization.registerClass(gr);var vr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;if(n.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==n.DEFAULT_ALPHA)throw new m("Non-default alpha value ("+t.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return o(t,e),t.prototype.call=function(e,t){var n=it(e);return(0,i.elu)(n)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ELU",t}(gt);i.serialization.registerClass(vr);var yr=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_THETA=1,null==t&&(t={}),n.theta=null==t.theta?n.DEFAULT_THETA:t.theta,n}return o(t,e),t.prototype.call=function(e,t){var n=it(e);return n.mul(he(n.greater(this.theta),"float32"))},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={theta:this.theta},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ThresholdedReLU",t}(gt);i.serialization.registerClass(yr);var br=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_AXIS=1,null==t&&(t={}),n.softmax=(new nr).apply,n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n}return o(t,e),t.prototype.call=function(e,t){var n=it(e);return this.softmax(n,this.axis)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Softmax",t}(gt);function xr(e,t,n){if("number"==typeof e)return v(e,t);if(e.length!==t)throw new d("The "+n+" argument must be an integer or tuple of "+t+" integers. Received: "+e.length+" elements.");for(var r=0;r<t;++r){var i=e[r];if(!se(i))throw new d("The "+n+" argument must be an integer or tuple of "+t+" integers. Received: "+JSON.stringify(e)+" including a non-integer number "+i)}return e}function wr(e,t,n,r,i){return void 0===i&&(i=1),null==e?e:(a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r));var a}function Er(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+fe([n-t,0]);else{if("same"!==r)throw new d("Unsupport padding mode: "+r+".");e*=t}return e}function Cr(e,t){return(0,i.tidy)((function(){return Z(t),"channelsFirst"===t?(0,i.transpose)(e,[0,2,3,1]):e}))}function Sr(e,t){return(0,i.tidy)((function(){return Z(t),"channelsFirst"===t?(0,i.transpose)(e,[0,2,3,4,1]):e}))}function Nr(e,t,n,r,a,o,s,u){return void 0===r&&(r=[1,1]),void 0===a&&(a="valid"),void 0===u&&(u=null),(0,i.tidy)((function(){if(null==o&&(o="channelsLast"),Z(o),3!==e.rank&&4!==e.rank)throw new d("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+e.rank+".");if(3!==t.rank&&4!==t.rank)throw new d("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+e.rank+".");var c=Cr(e,o);if("causal"===a)throw new m("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=i.fused.conv2d({x:c,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:s,dataFormat:"NHWC",bias:n,activation:u}),"channelsFirst"===o&&(c=(0,i.transpose)(c,[0,3,1,2])),c}))}i.serialization.registerClass(br);var Ar=function(e){function t(n,r){var i=e.call(this,r)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(r),i.rank=n,I(i.rank,"rank"),1!==i.rank&&2!==i.rank&&3!==i.rank)throw new m("Convolution layer for rank other than 1, 2, or 3 ("+i.rank+") is not implemented yet.");if(i.kernelSize=xr(r.kernelSize,n,"kernelSize"),i.strides=xr(null==r.strides?1:r.strides,n,"strides"),i.padding=null==r.padding?"valid":r.padding,Q(i.padding),i.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Z(i.dataFormat),i.activation=or(r.activation),i.useBias=null==r.useBias||r.useBias,i.biasInitializer=Ye(r.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=$(r.biasConstraint),i.biasRegularizer=hr(r.biasRegularizer),i.activityRegularizer=hr(r.activityRegularizer),i.dilationRate=xr(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===i.rank&&Array.isArray(i.dilationRate)&&1!==i.dilationRate.length)throw new d("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(2===i.rank){if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate];else if(2!==i.dilationRate.length)throw new d("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate))}else if(3===i.rank)if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate,i.dilationRate];else if(3!==i.dilationRate.length)throw new d("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(i.dilationRate));return i}return o(t,e),t.verifyArgs=function(e){if(y("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!O(e.kernelSize,"number",1,3))throw new d("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(e.kernelSize)+".")},t.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ir(this.activation),useBias:this.useBias,biasInitializer:Xe(this.biasInitializer),biasRegularizer:fr(this.biasRegularizer),activityRegularizer:fr(this.activityRegularizer),biasConstraint:W(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(gt),kr=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.kernel=null,t.verifyArgs(r),i.filters=r.filters,I(i.filters,"filters"),i.kernelInitializer=Ye(r.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=$(r.kernelConstraint),i.kernelRegularizer=hr(r.kernelRegularizer),i}return o(t,e),t.prototype.build=function(e){var t;e=at(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new d("The channel dimension of the input should be defined. Found "+e[n]);var r=e[n],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(t={},t[n]=r,t)}],this.built=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var t;e=it(e);var r=null==n.bias?null:n.bias.read(),a=R(n.activation.getClassName());if(null!=a&&2===n.rank)t=Nr(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n,r,a,o,s){return void 0===r&&(r=1),void 0===a&&(a="valid"),void 0===s&&(s=1),(0,i.tidy)((function(){if(null==o&&(o="channelsLast"),Z(o),3!==e.shape.length)throw new d("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==t.shape.length)throw new d("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new d("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if("channelsFirst"===o&&(e=(0,i.transpose)(e,[0,2,1])),"causal"===a)throw new m("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var u=(0,i.conv1d)(e,t,r,"same"===a?"same":"valid","NWC",s);return null!=n&&(u=Ae(u,n)),u}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=Nr(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new m("convolutions greater than 3D are not implemented yet.");t=function(e,t,n,r,a,o,s){return void 0===r&&(r=[1,1,1]),void 0===a&&(a="valid"),(0,i.tidy)((function(){if(null==o&&(o="channelsLast"),Z(o),4!==e.rank&&5!==e.rank)throw new d("conv3dWithBias expects input to be of rank 4 or 5, but received "+e.rank+".");if(4!==t.rank&&5!==t.rank)throw new d("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+e.rank+".");var u=Sr(e,o);if("causal"===a)throw new m("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return u=(0,i.conv3d)(u,t,r,"same"===a?"same":"valid","NDHWC",s),null!=n&&(u=Ae(u,n)),"channelsFirst"===o&&(u=(0,i.transpose)(u,[0,4,1,2,3])),u}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))},t.prototype.computeOutputShape=function(e){e=at(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var i=wr(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(i)}var a=[e[0]];return"channelsLast"===this.dataFormat?(a=a.concat(t)).push(this.filters):(a.push(this.filters),a=a.concat(t)),a},t.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:Xe(this.kernelInitializer),kernelRegularizer:fr(this.kernelRegularizer),kernelConstraint:W(this.kernelConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.verifyArgs=function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new d("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))},t}(Ar),Dr=function(e){function t(n){var r=e.call(this,2,n)||this;return t.verifyArgs(n),r}return o(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&!O(e.kernelSize,"number",1,2))throw new d("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv2D",t}(kr);i.serialization.registerClass(Dr);var _r=function(e){function t(n){var r=e.call(this,3,n)||this;return t.verifyArgs(n),r}return o(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new d("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv3D",t}(kr);i.serialization.registerClass(_r);var Mr=function(e){function t(t){var n=e.call(this,t)||this;if(n.inputSpec=[new ft({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new d("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return o(t,e),t.prototype.build=function(e){var t;if(4!==(e=at(e)).length)throw new d("Input should have rank 4; Received input shape: "+JSON.stringify(e));var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new d("The channel dimension of the inputs should be defined. Found `None`.");var r=e[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ft({ndim:4,axes:(t={},t[n]=r,t)})],this.built=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var t=it(e);if(4!==t.shape.length)throw new d("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+t.shape.length);var r,a,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var u=o[r],c=o[a],l=n.kernelSize[0],f=n.kernelSize[1],p=n.strides[0],h=n.strides[1],m=[s,Er(u,p,l,n.padding),Er(c,h,f,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=(0,i.transpose)(t,[0,2,3,1]));var g=(0,i.conv2dTranspose)(t,n.kernel.read(),m,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(g=(0,i.transpose)(g,[0,3,1,2])),null!=n.bias&&(g=Ae(g,n.bias.read(),n.dataFormat)),null!=n.activation&&(g=n.activation.apply(g)),g}))},t.prototype.computeOutputShape=function(e){var t,n,r,i=(e=at(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var a=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return i[t]=this.filters,i[n]=Er(i[n],s,a,this.padding),i[r]=Er(i[r],u,o,this.padding),i},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.dilationRate,t},t.className="Conv2DTranspose",t}(Dr);i.serialization.registerClass(Mr);var Tr=function(e){function t(t,n){var r=e.call(this,t,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new d("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new d("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new d("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=Ye(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=hr(n.depthwiseRegularizer),r.depthwiseConstraint=$(n.depthwiseConstraint),r.pointwiseInitializer=Ye(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=hr(n.pointwiseRegularizer),r.pointwiseConstraint=$(n.pointwiseConstraint),r}return o(t,e),t.prototype.build=function(e){var t;if((e=at(e)).length<this.rank+2)throw new d("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n]||e[n]<0)throw new d("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[n]));for(var r=e[n],i=this.kernelSize.concat([r,this.depthMultiplier]),a=[],o=0;o<this.rank;++o)a.push(1);a.push(r*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new ft({ndim:this.rank+2,axes:(t={},t[n]=r,t)})],this.built=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var t;if(e=it(e),1===n.rank)throw new m("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=(0,i.transpose)(e,[0,2,3,1])),t=(0,i.separableConv2d)(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=Ae(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=(0,i.transpose)(t,[0,3,1,2])),t}))},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Xe(this.depthwiseInitializer),t.pointwiseInitializer=Xe(this.pointwiseInitializer),t.depthwiseRegularizer=fr(this.depthwiseRegularizer),t.pointwiseRegularizer=fr(this.pointwiseRegularizer),t.depthwiseConstraint=W(this.depthwiseConstraint),t.pointwiseConstraint=W(this.pointwiseConstraint),t},t.className="SeparableConv",t}(kr),Or=function(e){function t(t){return e.call(this,2,t)||this}return o(t,e),t.className="SeparableConv2D",t}(Tr);i.serialization.registerClass(Or);var Ir=function(e){function t(n){var r=e.call(this,1,n)||this;return t.verifyArgs(n),r.inputSpec=[{ndim:3}],r}return o(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},t.verifyArgs=function(e){if("number"!=typeof e.kernelSize&&!O(e.kernelSize,"number",1,1))throw new d("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(e.kernelSize)+".")},t.className="Conv1D",t}(kr);i.serialization.registerClass(Ir);var Fr=function(e){function t(t){var n=e.call(this,t)||this;return"number"==typeof t.cropping?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return o(t,e),t.prototype.computeOutputShape=function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){return e=it(e),"channelsLast"===n.dataFormat?ve(ve(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2),n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3):ve(ve(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3),n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))},t.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Cropping2D",t}(gt);i.serialization.registerClass(Fr);var Rr=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=null==t.size?n.DEFAULT_SIZE:t.size,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,n}return o(t,e),t.prototype.computeOutputShape=function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}return t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2],[e[0],t,n,e[3]]},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var t=it(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=(0,i.transpose)(t,[0,2,3,1]);var a=n.size[0]*r[2],o=n.size[1]*r[3],s=t.resizeNearestNeighbor([a,o]);return(0,i.transpose)(s,[0,3,1,2])}return a=n.size[0]*r[1],o=n.size[1]*r[2],t.resizeNearestNeighbor([a,o])}))},t.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="UpSampling2D",t}(gt);i.serialization.registerClass(Rr);var Br=function(e){function t(t){var n=e.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,n.depthwiseInitializer=Ye(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=$(t.depthwiseConstraint),n.depthwiseRegularizer=hr(t.depthwiseRegularizer),n}return o(t,e),t.prototype.build=function(e){if((e=at(e)).length<4)throw new d("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(e)+".");var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new d("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+e[t]+").");var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var t=function(e,t,n,r,a,o){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),(0,i.tidy)((function(){null==a&&(a="channelsLast"),Z(a);var o=Cr(e,a);if(4!==e.rank)throw new d("Input for depthwiseConv2d is required to be 4-D, but is instead "+e.rank+"-D");if(4!==t.rank)throw new d("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return o=(0,i.depthwiseConv2d)(o,t,n,"same"===r?"same":"valid","NHWC",null),"channelsFirst"===a&&(o=(0,i.transpose)(o,[0,3,1,2])),o}))}(e=it(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat);return n.useBias&&(t=Ae(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))},t.prototype.computeOutputShape=function(e){e=at(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=wr(t,this.kernelSize[0],this.padding,this.strides[0]),a=wr(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,i,a]:[e[0],i,a,r]},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Xe(this.depthwiseInitializer),t.depthwiseRegularizer=fr(this.depthwiseRegularizer),t.depthwiseConstraint=W(this.depthwiseRegularizer),t},t.className="DepthwiseConv2D",t}(Ar);i.serialization.registerClass(Br);var zr=function(e){function t(t){var n=e.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return o(t,e),t.prototype.getNoiseShape=function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r=it(e);if(0<n.rate&&n.rate<1){var i=null!=t.training&&t.training,a=n.getNoiseShape(r);return De((function(){return ke(r,n.rate,a,n.seed)}),(function(){return r}),i)}return e}))},t.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.prototype.dispose=function(){return e.prototype.dispose.call(this)},t.className="Dropout",t}(gt);i.serialization.registerClass(zr);var Pr=function(e){function t(t){var n=e.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return o(t,e),t.prototype.getNoiseShape=function(e){var t=e.shape;return[t[0],1,t[2]]},t.className="SpatialDropout1D",t}(zr);i.serialization.registerClass(Pr);var Lr=function(e){function t(t){var n=e.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){var r=null;null!=t.batchSize&&(r=t.batchSize),n.batchInputShape=[r,t.inputDim]}return n.units=t.units,I(n.units,"units"),n.activation=or(t.activation),null!=t.useBias&&(n.useBias=t.useBias),n.kernelInitializer=Ye(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=Ye(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=$(t.kernelConstraint),n.biasConstraint=$(t.biasConstraint),n.kernelRegularizer=hr(t.kernelRegularizer),n.biasRegularizer=hr(t.biasRegularizer),n.activityRegularizer=hr(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return o(t,e),t.prototype.build=function(e){var t,n=(e=at(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(t={},t[-1]=n,t)}],this.built=!0},t.prototype.computeOutputShape=function(e){var t=(e=at(e)).slice();return t[t.length-1]=this.units,t},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r,i=it(e),a=R(n.activation.getClassName());return null!=a?r=Ee(i,n.kernel.read(),a,n.bias?n.bias.read():null):(r=Ee(i,n.kernel.read()),null!=n.bias&&(r=Ae(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))},t.prototype.getConfig=function(){var t={units:this.units,activation:ir(this.activation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:fr(this.kernelRegularizer),biasRegularizer:fr(this.biasRegularizer),activityRegularizer:fr(this.activityRegularizer),kernelConstraint:W(this.kernelConstraint),biasConstraint:W(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Dense",t}(gt);i.serialization.registerClass(Lr);var jr=function(e){function t(t){var n=this;return t=t||{},(n=e.call(this,t)||this).inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return o(t,e),t.prototype.computeOutputShape=function(e){for(var t=0,n=(e=at(e)).slice(1);t<n.length;t++)if(null==n[t])throw new d('The shape of the input to "Flatten" is not fully defined (got '+e.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],ue(e,1)]},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r=it(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var i=[0],a=2;a<r.rank;++a)i.push(a);i.push(1),r=r.transpose(i)}return function(e){if(e.rank<=1)throw new d("batchFlatten requires a minimum rank of 2. Got rank: "+e.rank+".");var t=[e.shape[0],ue(e.shape,1)];return e.reshape(t)}(r)}))},t.prototype.getConfig=function(){var t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);var n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Flatten",t}(gt);i.serialization.registerClass(jr);var Ur=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.activation=or(t.activation),n}return o(t,e),t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r=it(e);return n.activation.apply(r)}))},t.prototype.getConfig=function(){var t={activation:ir(this.activation)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Activation",t}(gt);i.serialization.registerClass(Ur);var qr=function(e){function t(t){var n=e.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return o(t,e),t.prototype.computeOutputShape=function(e){return[e[0],this.n,e[1]]},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){return function(e,t){return(0,i.tidy)((function(){if(2!==e.shape.length)throw new d("repeat() expects a rank-2 tensor, but received a rank-"+e.shape.length+" tensor.");return xe(de(e,1),[1,t,1])}))}(e=it(e),n.n)}))},t.prototype.getConfig=function(){var t={n:this.n},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="RepeatVector",t}(gt);i.serialization.registerClass(qr);var Wr=function(e){function t(t){var n=e.call(this,t)||this;n.targetShape=t.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return o(t,e),t.prototype.isUnknown=function(e){return e<0||null==e},t.prototype.fixUnknownDimension=function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),i=1,a=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==a)throw new d("Can only specifiy one unknown dimension.");a=o}else i*=s}var u=ue(e);if(null!==a){if(0===i||u%i!=0)throw new d(n);r[a]=u/i}else if(u!==i)throw new d(n);return r},t.prototype.computeOutputShape=function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r=it(e),i=r.shape,a=i.slice(0,1).concat(n.fixUnknownDimension(i.slice(1),n.targetShape));return r.reshape(a)}))},t.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Reshape",t}(gt);i.serialization.registerClass(Wr);var Vr=function(e){function t(t){var n=e.call(this,t)||this;if(null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+t.dims+" instead.");var r=pe(1,t.dims.length+1);if(!i.util.arraysEqual(t.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new ft({ndim:n.dims.length+1})],n}return o(t,e),t.prototype.computeOutputShape=function(e){var t=(e=at(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t},t.prototype.call=function(e,t){return(0,i.transpose)(it(e),this.dimsIncludingBatch)},t.prototype.getConfig=function(){var t={dims:this.dims},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Permute",t}(gt);i.serialization.registerClass(Vr);var $r=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.supportsMasking=!0,n.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0,n}return o(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},t.prototype.computeMask=function(e,t){var n=it(e);return(0,i.any)((0,i.notEqual)(n,this.maskValue),-1)},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r=it(e),a=(0,i.any)((0,i.notEqual)(r,n.maskValue),-1,!0);return r.mul(a.asType(r.dtype))}))},t.className="Masking",t}(gt);i.serialization.registerClass($r);var Hr=function(e){function t(t){var n=e.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){var r=null;null!=t.batchSize&&(r=t.batchSize),null==t.inputLength?n.batchInputShape=[r,null]:n.batchInputShape=[r].concat(w(t.inputLength))}return n.inputDim=t.inputDim,I(n.inputDim,"inputDim"),n.outputDim=t.outputDim,I(n.outputDim,"outputDim"),n.embeddingsInitializer=Ye(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=hr(t.embeddingsRegularizer),n.activityRegularizer=hr(t.activityRegularizer),n.embeddingsConstraint=$(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return o(t,e),t.prototype.build=function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},t.prototype.warnOnIncompatibleInputShape=function(e){},t.prototype.computeMask=function(e,t){var n=this;return(0,i.tidy)((function(){return n.maskZero?(e=it(e),(0,i.notEqual)(e,(0,i.zerosLike)(e))):null}))},t.prototype.computeOutputShape=function(e){if(e=at(e),null==this.inputLength)return e.concat([this.outputDim]);var t=w(this.inputLength);if(t.length!==e.length-1)throw new d('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);for(var n=0,r=0;r<t.length;++r){var i=t[r],a=e[r+1];if(null!=i&&null!=a&&i!==a)throw new d('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);null==i&&(t[n]=a),n++}return[e[0]].concat(t,[this.outputDim])},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r=it(e);return"int32"!==r.dtype&&(r=he(r,"int32")),Ce(n.embeddings.read(),r.as1D()).reshape(at(n.computeOutputShape(r.shape)))}))},t.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Xe(this.embeddingsInitializer),embeddingsRegularizer:fr(this.embeddingsRegularizer),activityRegularizer:fr(this.activityRegularizer),embeddingsConstraint:W(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Embedding",t}(gt);i.serialization.registerClass(Hr);var Gr=function(e){function t(t){var n=e.call(this,t||{})||this;return n.supportsMasking=!0,n}return o(t,e),t.prototype.mergeFunction=function(e){throw new m},t.prototype.computeElementwiseOpOutputShape=function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var i=e[e.length-t.length+r],a=t[r];if(null==i||null==a||i<0||a<0)n.push(null);else if(1===i)n.push(a);else if(1===a)n.push(i);else{if(i!==a)throw new d("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n},t.prototype.build=function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[at(e)]),(e=e).length<2)throw new d("A merge layer should be called on an Array of at least 2 inputs. Got "+e.length+" input(s).");for(var t=[],n=0,r=e;n<r.length;n++)null!=(o=r[n])&&null!==o[0]&&t.push(o[0]);if((t=_(t)).length>1)throw new d("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(e)+".");for(var i=null==e[0]?null:e[0].slice(1),a=1;a<e.length;++a){var o=null==e[a]?null:e[a].slice(1);i=this.computeElementwiseOpOutputShape(i,o)}var s=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===_(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){if(e=e,n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){for(var a=fe(r),o=0,s=e;o<s.length;o++){for(var u=(h=s[o]).rank,c=0;c<a-u;++c)h=de(h,1);t.push(h)}return n.mergeFunction(t)}for(var l=!1,f=0,p=e;f<p.length;f++){var h;if(null==(u=(h=p[f]).rank)){var d=h.shape,m=d[0],g=d.slice(1).concat([m]),v=h.reshape([m].concat(ue(d.slice(1))));v=(v=(0,i.transpose)(v,[1,0])).reshape(g),t.push(v),l=!0}else if(u>1){var y=pe(1,u).concat([0]);t.push((0,i.transpose)(h,y)),l=!0}else t.push(h)}var b=n.mergeFunction(t),x=b.rank;if(l)if(null==x){var w=b.shape;g=[m=w[w.length-1]].concat(w.slice(0,w.length-1)),b=(0,i.transpose)(b.reshape([-1,m]),[1,0]).reshape(g)}else x>1&&(y=[x-1].concat(pe(0,x-1)),b=(0,i.transpose)(b,y));return b}return n.mergeFunction(e)}))},t.prototype.computeOutputShape=function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}for(var i=[],a=0,o=e;a<o.length;a++)null!=(r=o[a])&&null!==r[0]&&i.push(r[0]);return 1===(i=_(i)).length?i.concat(t):[null].concat(t)},t.prototype.computeMask=function(e,t){return(0,i.tidy)((function(){if(null==t)return null;if(!Array.isArray(t))throw new d("`mask` should be an Array");if(!Array.isArray(e))throw new d("`inputs` should be an Array");if(t.length!==e.length)throw new d("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+e.length+" vs "+t.length+")");if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:(0,i.expandDims)(e,0)})))[0],r=1;r<t.length-1;++r)n=(0,i.logicalAnd)(n,t[r]);return n}))},t}(gt),Kr=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.mergeFunction=function(e){return(0,i.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=(0,i.add)(t,e[n]);return t}))},t.className="Add",t}(Gr);i.serialization.registerClass(Kr);var Xr=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.mergeFunction=function(e){return(0,i.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=(0,i.mul)(t,e[n]);return t}))},t.className="Multiply",t}(Gr);i.serialization.registerClass(Xr);var Yr=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.mergeFunction=function(e){return(0,i.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=(0,i.add)(t,e[n]);return(0,i.mul)(1/e.length,t)}))},t.className="Average",t}(Gr);i.serialization.registerClass(Yr);var Jr=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.mergeFunction=function(e){return(0,i.tidy)((function(){for(var t=e[0],n=1;n<e.length;++n)t=(0,i.maximum)(t,e[n]);return t}))},t.className="Maximum",t}(Gr);i.serialization.registerClass(Jr);var Zr=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.mergeFunction=function(e){return(0,i.tidy)((function(){for(var t=e[0],n=1;n<e.length;++n)t=(0,i.minimum)(t,e[n]);return t}))},t.className="Minimum",t}(Gr);i.serialization.registerClass(Zr);var Qr=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_AXIS=-1,null==t&&(t={}),n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return o(t,e),t.prototype.build=function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new d("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var t=!0,n=0,r=e=e;n<r.length;n++)if(null!=(f=r[n])){t=!1;break}if(!t){for(var a=[],o=0;o<e.length;++o){var s=e[o].slice();s.splice(this.axis,1);for(var u=!1,c=0,l=a;c<l.length;c++){var f=l[c];if(i.util.arraysEqual(f,s)){u=!0;break}}u||a.push(s)}if(a.length>1)throw new d("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}},t.prototype.mergeFunction=function(e){var t=this;return(0,i.tidy)((function(){return ye(e,t.axis)}))},t.prototype.computeOutputShape=function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new d("A `Concatenate` layer should be called on a list of inputs.");for(var t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,i=0,a=t.slice(1);i<a.length;i++){var o=a[i];if(null==n[r]||null==o[r]){n[r]=null;break}n[r]+=o[r]}return n},t.prototype.computeMask=function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new d("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new d("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new d("Mismatch in the length of mask ("+t.length+") and the legnth of inputs ("+e.length+")");return(0,i.tidy)((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],o=0;o<e.length;++o)null==t[o]?a.push((0,i.onesLike)(e[o]).asType("bool")):t[o].rank<e[o].rank?a.push((0,i.expandDims)(t[o],-1)):a.push(t[o]);var s=(0,i.concat)(a,n.axis);return(0,i.all)(s,-1,!1)}))},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Concatenate",t}(Gr);function ei(e,t){for(;e<0;)e+=t;return e}i.serialization.registerClass(Qr);var ti=function(e){function t(t){var n=e.call(this,t)||this;return n.axes=t.axes,n.normalize=null!=t.normalize&&t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return o(t,e),t.prototype.build=function(e){i.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new m("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new d("Dimension incompatibility: "+t[r[0]]+" !== "+n[r[1]])},t.prototype.mergeFunction=function(e){if(2!==e.length)throw new d("A `Dot` layer must be called on exactly 2 inputs, but received "+e.length+" input(s).");var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return ei(t,e[n].shape.length)})):[ei(this.axes,n.shape.length),ei(this.axes,r.shape.length)],this.normalize&&(n=It(n,t[0]),r=It(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new m("batchDot is not implemented for tensors of 4D or higher rank yet");if(i.util.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got "+e.shape.length})),i.util.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got "+t.shape.length})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new m("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var o=n;return(0,i.tidy)((function(){var n,i;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else if(a>r){for(n=a-r,s=[],u=0;u<n;++u)s.push(1);e=e.reshape(e.shape.concat(s))}else n=0;if(2===e.shape.length&&2===t.shape.length)i=o[0]===o[1]?e.mulStrict(t).sum(o[0]):e.transpose([1,0]).mulStrict(t).sum(o[1]);else{var c=o[0]!==e.shape.length-1,l=o[1]===t.shape.length-1;i=e.matMul(t,c,l)}if(n>0){var f,p=[];for(u=f=r>a?r+a-3:r-1;u<f+n;++u)p.push(u);i=i.squeeze(p)}return 1===i.shape.length&&(i=i.expandDims(1)),i}))}(n,r,t)},t.prototype.interpretAxes=function(e,t){return Array.isArray(this.axes)?this.axes:[ei(this.axes,e.length),ei(this.axes,t.length)]},t.prototype.computeOutputShape=function(e){i.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new m("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a},t.prototype.computeMask=function(e,t){return null},t.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Dot",t}(Gr);i.serialization.registerClass(ti);var ni=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return o(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r=it(e);return De((function(){return we(r.shape,0,n.stddev).add(r)}),(function(){return r}),t.training||!1)}))},t.className="GaussianNoise",t}(gt);i.serialization.registerClass(ni);var ri=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return o(t,e),t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t);var r=it(e);return n.rate>0&&n.rate<1?De((function(){var e=Math.sqrt(n.rate/(1-n.rate));return r.mul(we(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))},t.className="GaussianDropout",t}(gt);i.serialization.registerClass(ri);var ii=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return o(t,e),t.prototype._getNoiseShape=function(e){return this.noiseShape||it(e).shape},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return De((function(){var t=it(e),a=-1.7580993408473766,o=(0,i.greaterEqual)((0,i.randomUniform)(r),n.rate);o=he(o,"float32");var s=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),u=-s*a*n.rate;return t.mul(o).add(o.add(-1).mul(a)).mul(s).add(u)}),(function(){return it(e)}),t.training||!1)}return e}))},t.className="AlphaDropout",t}(gt);function ai(e,t,n,r,a,o){var s;if(void 0===o&&(o=.001),2===e.rank)s=(0,i.batchNorm2d)(e,t,n,r,a,o);else if(3===e.rank)s=(0,i.batchNorm3d)(e,t,n,r,a,o);else{if(4!==e.rank)throw new m("batchNormalization is not implemented for array of rank "+e.rank+" yet");s=(0,i.batchNorm4d)(e,t,n,r,a,o)}return s}i.serialization.registerClass(ii);var oi=function(e){function t(t){var n=this;return null==t&&(t={}),(n=e.call(this,t)||this).supportsMasking=!0,n.axis=null==t.axis?-1:t.axis,n.momentum=null==t.momentum?.99:t.momentum,n.epsilon=null==t.epsilon?.001:t.epsilon,n.center=null==t.center||t.center,n.scale=null==t.scale||t.scale,n.betaInitializer=Ye(t.betaInitializer||"zeros"),n.gammaInitializer=Ye(t.gammaInitializer||"ones"),n.movingMeanInitializer=Ye(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=Ye(t.movingVarianceInitializer||"ones"),n.betaConstraint=$(t.betaConstraint),n.gammaConstraint=$(t.gammaConstraint),n.betaRegularizer=hr(t.betaRegularizer),n.gammaRegularizer=hr(t.gammaRegularizer),n}return o(t,e),t.prototype.build=function(e){var t;e=at(e);var n=this.axis>=0?this.axis:this.axis+e.length,r=e[n];if(null==r)throw new d("Axis "+n+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(e)+".");this.inputSpec=[new ft({ndim:e.length,axes:(t={},t[n]=r,t)})];var i=[r];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var r=null!=t.training&&t.training,a=it(e),o=a.shape,s=o.length,u=pe(0,s),c=n.axis>=0?n.axis:n.axis+s;u.splice(c,1);var l=v(1,s);l[c]=o[c];var f=u.slice();f.sort();var p=!i.util.arraysEqual(f,pe(0,s).slice(0,s-1));if(!r)return function(){if(p){var e=n.movingMean.read().reshape(l),t=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,i=n.scale?n.gamma.read().reshape(l):null;return ai(a,e,t,r,i,n.epsilon)}return ai(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var h=function(e,t,n,r,a){return void 0===a&&(a=.001),i.util.arraysEqual(r.slice().sort(),pe(0,e.rank-1))?function(e,t,n,r,a){return void 0===a&&(a=.001),(0,i.tidy)((function(){var o=(0,i.moments)(e,r),s=o.mean,u=o.variance;return[ai(e,s,u,n,t,a),s,u]}))}(e,t,n,r,a):function(e,t,n,r,a){return void 0===a&&(a=.001),(0,i.tidy)((function(){for(var o=(0,i.moments)(e,r),s=o.mean,u=o.variance,c=[],l=0,f=pe(0,e.rank);l<f.length;l++){var p=f[l];-1!==r.indexOf(p)?c.push(1):c.push(e.shape[p])}var h=s.reshape(c),d=u.reshape(c),m=null==t?null:t.reshape(c),g=null==n?null:n.reshape(c);return[ai(e,h,d,g,m,a),s,u]}))}(e,t,n,r,a)}(a,n.gamma.read(),n.beta.read(),u,n.epsilon),d=h[0],m=h[1],g=h[2],y=function(e,t,n){(0,i.tidy)((function(){var r=1-n,i=e.read(),a=i.sub(t).mul(r);e.write(i.sub(a))}))};return y(n.movingMean,m,n.momentum),y(n.movingVariance,g,n.momentum),d}))},t.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Xe(this.betaInitializer),gammaInitializer:Xe(this.gammaInitializer),movingMeanInitializer:Xe(this.movingMeanInitializer),movingVarianceInitializer:Xe(this.movingVarianceInitializer),betaRegularizer:fr(this.betaRegularizer),gammaRegularizer:fr(this.gammaRegularizer),betaConstraint:W(this.betaConstraint),gammaConstraint:W(this.gammaConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="BatchNormalization",t}(gt);i.serialization.registerClass(oi);var si=function(e){function t(t){var n=this;if(null==t&&(t={}),(n=e.call(this,t)||this).axis=null==t.axis?-1:t.axis,"number"==typeof n.axis){if(!Number.isInteger(n.axis))throw new Error("Expected axis to be an integer, but received "+n.axis)}else{if(!Array.isArray(n.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(n.axis));for(var r=0,i=n.axis;r<i.length;r++){var a=i[r];if(!Number.isInteger(a))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(n.axis))}}return n.epsilon=null==t.epsilon?.001:t.epsilon,n.center=null==t.center||t.center,n.scale=null==t.scale||t.scale,n.betaInitializer=Ye(t.betaInitializer||"zeros"),n.gammaInitializer=Ye(t.gammaInitializer||"ones"),n.betaRegularizer=hr(t.betaRegularizer),n.gammaRegularizer=hr(t.gammaRegularizer),n.supportsMasking=!0,n}return o(t,e),t.prototype.build=function(e){var t=(e=at(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);for(var r=0,i=this.axis;r<i.length;r++){var a=i[r];if(a<0||a>=t)throw new Error("Invalid axis: "+a)}if(this.axis.length!==_(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},t.prototype.call=function(e,t){var n=this,r=it(e),a=r.shape,o=a.length;return(0,i.tidy)((function(){for(var e=(0,i.moments)(r,n.axis,!0),t=e.mean,s=e.variance,u=v(1,o),c=0,l=n.axis;c<l.length;c++){var f=l[c];u[f]=a[f]}for(var p=function(e){return null!=e&&e.shape.length!==o&&n.axis!==[o-1]?e.reshape(u):e},h=p(n.gamma.read()),d=p(n.beta.read()),m=[],g=[],y=0;y<o;++y)-1!==n.axis.indexOf(y)?(m.push(a[y]),g.push(1)):(m.push(1),g.push(a[y]));return t=t.tile(m),s=s.tile(m),h=h.tile(g),d=d.tile(g),ai(r,t,s,d,h,n.epsilon)}))},t.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Xe(this.betaInitializer),gammaInitializer:Xe(this.gammaInitializer),betaRegularizer:fr(this.betaRegularizer),gammaRegularizer:fr(this.gammaRegularizer)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LayerNormalization",t}(gt);i.serialization.registerClass(si);var ui=function(e){function t(t){var n=this;if(null==t&&(t={}),(n=e.call(this,t)||this).dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new d("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+t.padding.length+" array.");var r=void 0,i=void 0;if("number"==typeof t.padding[0])r=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new d("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+t.padding[0].length+" array.");if(r=t.padding[0],2!==t.padding[1].length)throw new d("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+t.padding[1].length+" array.");i=t.padding[1]}n.padding=[r,i]}return n.inputSpec=[new ft({ndim:4})],n}return o(t,e),t.prototype.computeOutputShape=function(e){var t,n;return e=at(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){return function(e,t,n){return(0,i.tidy)((function(){if(4!==e.rank)throw new d("temporalPadding expects input tensor to be 4-D, but received a "+e.rank+"-D tensor.");if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new d("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new d("Unknown data format: "+n+". Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],(0,i.pad)(e,r)}))}(it(e),n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ZeroPadding2D",t}(gt);function ci(e,t,n,r,a,o){return(0,i.tidy)((function(){var s;Z(a),ee(o),Q(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==o&&(o="max"),e=Cr(e,a);var u="same"===r?"same":"valid";return s="max"===o?(0,i.maxPool)(e,t,n,u):(0,i.avgPool)(e,t,n,u),"channelsFirst"===a&&(s=(0,i.transpose)(s,[0,3,1,2])),s}))}function li(e,t,n,r,a,o){return(0,i.tidy)((function(){var s;Z(a),ee(o),Q(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==o&&(o="max"),e=Sr(e,a);var u="same"===r?"same":"valid";return s="max"===o?(0,i.maxPool3d)(e,t,n,u):(0,i.avgPool3d)(e,t,n,u),"channelsFirst"===a&&(s=(0,i.transpose)(s,[0,4,1,2,3])),s}))}i.serialization.registerClass(ui);var fi=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=2),n=e.call(this,t)||this,"number"==typeof t.poolSize)n.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new d("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.poolSize));n.poolSize=t.poolSize}if(I(n.poolSize,"poolSize"),null==t.strides)n.strides=n.poolSize;else if("number"==typeof t.strides)n.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new d("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.strides));n.strides=t.strides}return I(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,Q(n.padding),n.inputSpec=[new ft({ndim:3})],n}return o(t,e),t.prototype.computeOutputShape=function(e){var t=wr((e=at(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){n.invokeCallHook(e,t),e=de(it(e),2);var r=n.poolingFunction(it(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return(0,i.squeeze)(r,[2])}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(gt),pi=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Z(i),Q(r),ci(e,t,n,r,i,"max")},t.className="MaxPooling1D",t}(fi);i.serialization.registerClass(pi);var hi=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Z(i),Q(r),ci(e,t,n,r,i,"avg")},t.className="AveragePooling1D",t}(fi);i.serialization.registerClass(hi);var di=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=[2,2]),(n=e.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new d("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides];return I(n.poolSize,"poolSize"),I(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Z(n.dataFormat),Q(n.padding),n.inputSpec=[new ft({ndim:4})],n}return o(t,e),t.prototype.computeOutputShape=function(e){e=at(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=wr(t,this.poolSize[0],this.padding,this.strides[0]),n=wr(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){return n.invokeCallHook(e,t),n.poolingFunction(it(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(gt),mi=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Z(i),Q(r),ci(e,t,n,r,i,"max")},t.className="MaxPooling2D",t}(di);i.serialization.registerClass(mi);var gi=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Z(i),Q(r),ci(e,t,n,r,i,"avg")},t.className="AveragePooling2D",t}(di);i.serialization.registerClass(gi);var vi=function(e){function t(t){var n=this;if(null==t.poolSize&&(t.poolSize=[2,2,2]),(n=e.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new d("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return I(n.poolSize,"poolSize"),I(n.strides,"strides"),n.padding=null==t.padding?"valid":t.padding,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Z(n.dataFormat),Q(n.padding),n.inputSpec=[new ft({ndim:5})],n}return o(t,e),t.prototype.computeOutputShape=function(e){e=at(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=wr(t,this.poolSize[0],this.padding,this.strides[0]),n=wr(n,this.poolSize[1],this.padding,this.strides[1]),r=wr(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){return n.invokeCallHook(e,t),n.poolingFunction(it(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))},t.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(gt),yi=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Z(i),Q(r),li(e,t,n,r,i,"max")},t.className="MaxPooling3D",t}(vi);i.serialization.registerClass(yi);var bi=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.poolingFunction=function(e,t,n,r,i){return Z(i),Q(r),li(e,t,n,r,i,"avg")},t.className="AveragePooling3D",t}(vi);i.serialization.registerClass(bi);var xi=function(e){function t(t){var n=e.call(this,t)||this;return n.inputSpec=[new ft({ndim:3})],n}return o(t,e),t.prototype.computeOutputShape=function(e){return[e[0],e[2]]},t.prototype.call=function(e,t){throw new m},t}(gt),wi=function(e){function t(t){return e.call(this,t||{})||this}return o(t,e),t.prototype.call=function(e,t){return(0,i.tidy)((function(){var t=it(e);return(0,i.mean)(t,1)}))},t.className="GlobalAveragePooling1D",t}(xi);i.serialization.registerClass(wi);var Ei=function(e){function t(t){return e.call(this,t||{})||this}return o(t,e),t.prototype.call=function(e,t){return(0,i.tidy)((function(){var t=it(e);return(0,i.max)(t,1)}))},t.className="GlobalMaxPooling1D",t}(xi);i.serialization.registerClass(Ei);var Ci=function(e){function t(t){var n=e.call(this,t)||this;return n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Z(n.dataFormat),n.inputSpec=[new ft({ndim:4})],n}return o(t,e),t.prototype.computeOutputShape=function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]},t.prototype.call=function(e,t){throw new m},t.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(gt),Si=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var t=it(e);return"channelsLast"===n.dataFormat?(0,i.mean)(t,[1,2]):(0,i.mean)(t,[2,3])}))},t.className="GlobalAveragePooling2D",t}(Ci);i.serialization.registerClass(Si);var Ni=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var t=it(e);return"channelsLast"===n.dataFormat?(0,i.max)(t,[1,2]):(0,i.max)(t,[2,3])}))},t.className="GlobalMaxPooling2D",t}(Ci);function Ai(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new d("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function ki(e,t,n,r,a,o,s,u){return void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===u&&(u=!1),(0,i.tidy)((function(){var c=t.shape.length;if(c<3)throw new d("Input should be at least 3D, but is "+c+"D.");var l=[1,0].concat(pe(2,c));if(t=(0,i.transpose)(t,l),null!=o)throw new m("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=a.asType("bool").asType("float32")).rank===c-1&&(a=(0,i.expandDims)(a,-1)),a=(0,i.transpose)(a,l)),r&&(t=(0,i.reverse)(t,0),null!=a&&(a=(0,i.reverse)(a,0)));var f,p,h=[],g=n,v=t.shape[0],y=(0,i.unstack)(t);null!=a&&(p=(0,i.unstack)(a));for(var b,x=function(t){var n=y[t],r=(0,i.tidy)((function(){return e(n,g)}));if(null==a)f=r[0],g=r[1];else{var o=(0,i.tidy)((function(){var e=p[t],n=(0,i.onesLike)(e).sub(e);return{output:r[0].mul(e).addStrict(g[0].mul(n)),newStates:g.map((function(t,i){return r[1][i].mul(e).addStrict(t.mul(n))}))}}));f=o.output,g=o.newStates}u&&h.push(f)},w=0;w<v;++w)x(w);return u&&(b=(0,i.stack)(h,1)),[f,b,g]}))}i.serialization.registerClass(Ni);var Di=function(e){function t(t){var n,r=e.call(this,t)||this;if(null==t.cell)throw new d("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(t.cell)?new Bi({cells:t.cell}):t.cell).stateSize)throw new d("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=t.returnSequences&&t.returnSequences,r.returnState=null!=t.returnState&&t.returnState,r.goBackwards=null!=t.goBackwards&&t.goBackwards,r._stateful=null!=t.stateful&&t.stateful,r.unroll=null!=t.unroll&&t.unroll,r.supportsMasking=!0,r.inputSpec=[new ft({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return o(t,e),t.prototype.getStates=function(){return null==this.states_?pe(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_},t.prototype.setStates=function(e){this.states_=e},t.prototype.computeOutputShape=function(e){nt(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){for(var i=[],a=0,o=t;a<o.length;a++){var s=o[a];i.push([e[0],s])}return[n].concat(i)}return n},t.prototype.computeMask=function(e,t){var n=this;return(0,i.tidy)((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))},Object.defineProperty(t.prototype,"states",{get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e},enumerable:!0,configurable:!0}),t.prototype.build=function(e){if(null!=this.numConstants)throw new m("Constants support is not implemented in RNN yet.");nt(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e[e.length-1];this.inputSpec[0]=new ft({shape:[t,null,n]});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!i.util.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new d("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=r.map((function(e){return new ft({shape:[null,e]})}));this.stateful&&this.resetStates()},t.prototype.resetStates=function(e,t){var n=this;void 0===t&&(t=!1),(0,i.tidy)((function(){if(!n.stateful)throw new p("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=n.inputSpec[0].shape[0];if(null==r)throw new d("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==n.states_)Array.isArray(n.cell.stateSize)?n.states_=n.cell.stateSize.map((function(e){return(0,i.zeros)([r,e])})):n.states_=[(0,i.zeros)([r,n.cell.stateSize])];else if(null==e)(0,i.dispose)(n.states_),null!=n.keptStates&&((0,i.dispose)(n.keptStates),n.keptStates=[]),Array.isArray(n.cell.stateSize)?n.states_=n.cell.stateSize.map((function(e){return(0,i.zeros)([r,e])})):n.states_[0]=(0,i.zeros)([r,n.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==n.states_.length)throw new d("Layer "+n.name+" expects "+n.states_.length+" state(s), but it received "+e.length+" state value(s). Input received: "+e);!0===t?n.keptStates.push(n.states_.slice()):(0,i.dispose)(n.states_);for(var a=0;a<n.states_.length;++a){var o=e[a],s=Array.isArray(n.cell.stateSize)?n.cell.stateSize[a]:n.cell.stateSize,u=[r,s];if(!i.util.arraysEqual(o.shape,u))throw new d("State "+a+" is incompatible with layer "+n.name+": expected shape="+u+", received shape="+o.shape);n.states_[a]=o}}n.states_=n.states_.map((function(e){return(0,i.keep)(e.clone())}))}))},t.prototype.apply=function(t,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var a=Ai(t,r,i,this.numConstants);t=a.inputs,r=a.initialState,i=a.constants;var o=[],s=[];if(null!=r){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(var u=0,c=r;u<c.length;u++){var l=c[u];this.stateSpec.push(new ft({shape:l.shape}))}s=s.concat(this.stateSpec)}if(null!=i&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof pt){var f=[t].concat(o),p=this.inputSpec.concat(s),h=this.inputSpec;this.inputSpec=p;var d=e.prototype.apply.call(this,f,n);return this.inputSpec=h,d}return e.prototype.apply.call(this,t,n)},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var r=null==t?null:t.mask,i=null==t?null:t.training,a=null==t?null:t.initialState;e=it(e),null==a&&(a=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(a.length!==o)throw new d("RNN Layer has "+o+" state(s) but was passed "+a.length+" initial state(s).");n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:i},u=ki((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,a,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],f=u[2];n.stateful&&n.resetStates(f,i);var p=n.returnSequences?l:c;return n.returnState?[p].concat(f):p}))},t.prototype.getInitialState=function(e){var t=this;return(0,i.tidy)((function(){var n=(0,i.zeros)(e.shape);return n=de(n=(0,i.sum)(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?xe(n,[1,e]):n})):t.cell.stateSize>1?[xe(n,[1,t.cell.stateSize])]:[n]}))},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)},t.prototype.getConfig=function(){var t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var n=this.cell.getConfig();t.cell={className:this.cell.getClassName(),config:n};var r=e.prototype.getConfig.call(this);return Object.assign(t,r),t},t.fromConfig=function(e,t,n){void 0===n&&(n={});var r=Ot(t.cell,n);return new e(Object.assign(t,{cell:r}))},t.className="RNN",t}(gt);i.serialization.registerClass(Di);var _i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(gt),Mi=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,I(n.units,"units"),n.activation=or(null==t.activation?n.DEFAULT_ACTIVATION:t.activation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Ye(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Ye(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Ye(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=hr(t.kernelRegularizer),n.recurrentRegularizer=hr(t.recurrentRegularizer),n.biasRegularizer=hr(t.biasRegularizer),n.kernelConstraint=$(t.kernelConstraint),n.recurrentConstraint=$(t.recurrentConstraint),n.biasConstraint=$(t.biasConstraint),n.dropout=le([1,fe([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=le([1,fe([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return o(t,e),t.prototype.build=function(e){e=at(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){if(2!==(e=e).length)throw new d("SimpleRNNCell expects 2 input Tensors, got "+e.length+".");var r=e[1];e=e[0];var a,o=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=zi((function(){return(0,i.onesLike)(e)}),n.dropout,o)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=zi((function(){return(0,i.onesLike)(r)}),n.recurrentDropout,o));var s=n.dropoutMask,u=n.recurrentDropoutMask;a=Ee(null!=s?(0,i.mul)(e,s):e,n.kernel.read()),null!=n.bias&&(a=Ae(a,n.bias.read())),null!=u&&(r=(0,i.mul)(r,u));var c=(0,i.add)(a,Ee(r,n.recurrentKernel.read()));return null!=n.activation&&(c=n.activation.apply(c)),[c,c]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:ir(this.activation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:fr(this.kernelRegularizer),recurrentRegularizer:fr(this.recurrentRegularizer),biasRegularizer:fr(this.biasRegularizer),activityRegularizer:fr(this.activityRegularizer),kernelConstraint:W(this.kernelConstraint),recurrentConstraint:W(this.recurrentConstraint),biasConstraint:W(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="SimpleRNNCell",t}(_i);i.serialization.registerClass(Mi);var Ti=function(e){function t(t){return t.cell=new Mi(t),e.call(this,t)||this}return o(t,e),t.prototype.call=function(t,n){var r=this;return(0,i.tidy)((function(){null!=r.cell.dropoutMask&&((0,i.dispose)(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&((0,i.dispose)(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==n?null:n.mask,o=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(r,t,{mask:a,training:o,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:ir(this.activation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:fr(this.kernelRegularizer),recurrentRegularizer:fr(this.recurrentRegularizer),biasRegularizer:fr(this.biasRegularizer),activityRegularizer:fr(this.activityRegularizer),kernelConstraint:W(this.kernelConstraint),recurrentConstraint:W(this.recurrentConstraint),biasConstraint:W(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return new e(t)},t.className="SimpleRNN",t}(Di);i.serialization.registerClass(Ti);var Oi=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,I(n.units,"units"),n.activation=or(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=or(void 0===t.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Ye(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Ye(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Ye(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=hr(t.kernelRegularizer),n.recurrentRegularizer=hr(t.recurrentRegularizer),n.biasRegularizer=hr(t.biasRegularizer),n.kernelConstraint=$(t.kernelConstraint),n.recurrentConstraint=$(t.recurrentConstraint),n.biasConstraint=$(t.biasConstraint),n.dropout=le([1,fe([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=le([1,fe([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return o(t,e),t.prototype.build=function(e){var t=(e=at(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){if(2!==(e=e).length)throw new d("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=zi((function(){return(0,i.onesLike)(e)}),n.dropout,r,3)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=zi((function(){return(0,i.onesLike)(a)}),n.recurrentDropout,r,3));var o,s,u,c=n.dropoutMask,l=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=(0,i.mul)(e,c[0]));var f=Ee(e,n.kernel.read());n.useBias&&(f=Ae(f,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=(0,i.mul)(a,l[0]));var p=n.recurrentKernel.read(),h=(0,i.split)(p,[2*n.units,n.units],p.rank-1),m=h[0],g=h[1],v=Ee(a,m),y=(0,i.split)(f,3,f.rank-1),b=y[0],x=y[1],w=y[2],E=(0,i.split)(v,2,v.rank-1),C=E[0],S=E[1];o=n.recurrentActivation.apply((0,i.add)(b,C)),s=n.recurrentActivation.apply((0,i.add)(x,S));var N=Ee((0,i.mul)(s,a),g);u=n.activation.apply((0,i.add)(w,N));var A=(0,i.add)((0,i.mul)(o,a),(0,i.mul)((0,i.add)(1,(0,i.neg)(o)),u));return[A,A]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:ir(this.activation),recurrentActivation:ir(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:fr(this.kernelRegularizer),recurrentRegularizer:fr(this.recurrentRegularizer),biasRegularizer:fr(this.biasRegularizer),activityRegularizer:fr(this.activityRegularizer),kernelConstraint:W(this.kernelConstraint),recurrentConstraint:W(this.recurrentConstraint),biasConstraint:W(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="GRUCell",t}(_i);i.serialization.registerClass(Oi);var Ii=function(e){function t(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Oi(t),e.call(this,t)||this}return o(t,e),t.prototype.call=function(t,n){var r=this;return(0,i.tidy)((function(){null!=r.cell.dropoutMask&&((0,i.dispose)(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&((0,i.dispose)(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==n?null:n.mask,o=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(r,t,{mask:a,training:o,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:ir(this.activation),recurrentActivation:ir(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),kernelRegularizer:fr(this.kernelRegularizer),recurrentRegularizer:fr(this.recurrentRegularizer),biasRegularizer:fr(this.biasRegularizer),activityRegularizer:fr(this.activityRegularizer),kernelConstraint:W(this.kernelConstraint),recurrentConstraint:W(this.recurrentConstraint),biasConstraint:W(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},t.className="GRU",t}(Di);i.serialization.registerClass(Ii);var Fi=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,I(n.units,"units"),n.activation=or(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=or(void 0===t.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Ye(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Ye(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Ye(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=hr(t.kernelRegularizer),n.recurrentRegularizer=hr(t.recurrentRegularizer),n.biasRegularizer=hr(t.biasRegularizer),n.kernelConstraint=$(t.kernelConstraint),n.recurrentConstraint=$(t.recurrentConstraint),n.biasConstraint=$(t.biasConstraint),n.dropout=le([1,fe([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=le([1,fe([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return o(t,e),t.prototype.build=function(e){var t,n,r=(e=at(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var i=this.biasInitializer,a=this.units;n=new((t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.apply=function(e,t){var n=i.apply([a]),r=(new Ie).apply([a]),o=i.apply([2*a]);return be(be(n,r),o)},t}(Te)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var r=null!=t.training&&t.training;if(3!==(e=e).length)throw new d("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var a=e[1],o=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=zi((function(){return(0,i.onesLike)(e)}),n.dropout,r,4)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=zi((function(){return(0,i.onesLike)(a)}),n.recurrentDropout,r,4));var s,u,c,l,f=n.dropoutMask,p=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=(0,i.mul)(e,f[0]));var h=Ee(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=(0,i.mul)(a,p[0])),h=(0,i.add)(h,Ee(a,n.recurrentKernel.read())),n.useBias&&(h=Ae(h,n.bias.read()));var m=(0,i.split)(h,4,h.rank-1),g=m[0],v=m[1],y=m[2],b=m[3];s=n.recurrentActivation.apply(g),u=n.recurrentActivation.apply(v),c=(0,i.add)((0,i.mul)(u,o),(0,i.mul)(s,n.activation.apply(y))),l=n.recurrentActivation.apply(b);var x=(0,i.mul)(l,n.activation.apply(c));return[x,x,c]}))},t.prototype.getConfig=function(){var t={units:this.units,activation:ir(this.activation),recurrentActivation:ir(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:fr(this.kernelRegularizer),recurrentRegularizer:fr(this.recurrentRegularizer),biasRegularizer:fr(this.biasRegularizer),activityRegularizer:fr(this.activityRegularizer),kernelConstraint:W(this.kernelConstraint),recurrentConstraint:W(this.recurrentConstraint),biasConstraint:W(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="LSTMCell",t}(_i);i.serialization.registerClass(Fi);var Ri=function(e){function t(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Fi(t),e.call(this,t)||this}return o(t,e),t.prototype.call=function(t,n){var r=this;return(0,i.tidy)((function(){null!=r.cell.dropoutMask&&((0,i.dispose)(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&((0,i.dispose)(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==n?null:n.mask,o=null==n?null:n.training,s=null==n?null:n.initialState;return e.prototype.call.call(r,t,{mask:a,training:o,initialState:s})}))},Object.defineProperty(t.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var t={units:this.units,activation:ir(this.activation),recurrentActivation:ir(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Xe(this.kernelInitializer),recurrentInitializer:Xe(this.recurrentInitializer),biasInitializer:Xe(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:fr(this.kernelRegularizer),recurrentRegularizer:fr(this.recurrentRegularizer),biasRegularizer:fr(this.biasRegularizer),activityRegularizer:fr(this.activityRegularizer),kernelConstraint:W(this.kernelConstraint),recurrentConstraint:W(this.recurrentConstraint),biasConstraint:W(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},t.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},t.className="LSTM",t}(Di);i.serialization.registerClass(Ri);var Bi=function(e){function t(t){var n=e.call(this,t)||this;return n.cells=t.cells,n}return o(t,e),Object.defineProperty(t.prototype,"stateSize",{get:function(){for(var e=[],t=0,n=this.cells.slice().reverse();t<n.length;t++){var r=n[t];Array.isArray(r.stateSize)?e.push.apply(e,r.stateSize):e.push(r.stateSize)}return e},enumerable:!0,configurable:!0}),t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){for(var r=(e=e).slice(1),i=[],a=0,o=n.cells.slice().reverse();a<o.length;a++){var s=o[a];Array.isArray(s.stateSize)?i.push(r.splice(0,s.stateSize.length)):i.push(r.splice(0,1))}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l)s=n.cells[l],r=i[l],u=0===l?[e[0]].concat(r):[u[0]].concat(r),u=s.call(u,t),c.push(u.slice(1));r=[];for(var f=0,p=c.slice().reverse();f<p.length;f++){var h=p[f];r.push.apply(r,h)}return[u[0]].concat(r)}))},t.prototype.build=function(e){var t;nt(e)&&(e=e[0]),e=e,this.cells.forEach((function(n,r){ne("RNNCell_"+r,(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0},t.prototype.getConfig=function(){for(var t=[],n=0,r=this.cells;n<r.length;n++){var i=r[n];t.push({className:i.getClassName(),config:i.getConfig()})}var a={cells:t},o=e.prototype.getConfig.call(this);return Object.assign(a,o),a},t.fromConfig=function(e,t,n){void 0===n&&(n={});for(var r=[],i=0,a=t.cells;i<a.length;i++){var o=a[i];r.push(Ot(o,n))}return new e({cells:r})},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],a=0,o=this.cells;a<o.length;a++)r=o[a],i.push.apply(i,r.trainableWeights);return i.concat(e)}return e},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.weights)}return ct(e)},t.prototype.setWeights=function(e){for(var t=[],n=0,r=this.cells;n<r.length;n++)for(var i=r[n],a=i.weights.length,o=e.splice(a),s=0;s<i.weights.length;++s)t.push([i.weights[s],o[s]]);lt(t)},t.className="StackedRNNCells",t}(_i);function zi(e,t,n,r){function a(){return ke(e(),t)}if(void 0===n&&(n=null),void 0===r&&(r=1),r>1){for(var o=[],s=0;s<r;s++)o.push(De(a,e,n));return o.map((function(e){return(0,i.keep)(e.clone())}))}return(0,i.keep)(De(a,e,n).clone())}i.serialization.registerClass(Bi);var Pi=function(e){function t(t){var n=e.call(this,t)||this;return n.layer=t.layer,n}return o(t,e),t.prototype.build=function(e){this.built=!0},Object.defineProperty(t.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.layer.getWeights()},t.prototype.setWeights=function(e){this.layer.setWeights(e)},t.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)},t.fromConfig=function(e,t,n){void 0===n&&(n={});var r=Ot(t.layer,n);delete t.layer;var i={layer:r};return Object.assign(i,t),new e(i)},t}(gt),Li=function(e){function t(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n}return o(t,e),t.prototype.build=function(t){if((t=at(t)).length<3)throw new d("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(t));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),e.prototype.build.call(this,t)},t.prototype.computeOutputShape=function(e){var t=[(e=at(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){return ki((function(e,r){return[it(n.layer.call(e,t)),[]]}),e=it(e),[],!1,null,null,!1,!0)[1]}))},t.className="TimeDistributed",t}(Pi);i.serialization.registerClass(Li);var ji=function(e){function t(t){var n=e.call(this,t)||this,r=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=r,n.forwardLayer=Ot(i),r.goBackwards=!0!==r.goBackwards;var a={};if(a.className=t.layer.getClassName(),a.config=r,n.backwardLayer=Ot(a),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=void 0===t.mergeMode?"concat":t.mergeMode,function(e){T(Y,"BidirectionalMergeMode",e)}(n.mergeMode),t.weights)throw new m("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return o(t,e),Object.defineProperty(t.prototype,"trainable",{get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},t.prototype.setWeights=function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))},t.prototype.computeOutputShape=function(e){var t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),t=i[0]):t=i[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):x(n)},t.prototype.apply=function(t,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var a=Ai(t,r,i,this.numConstants);if(t=a.inputs,r=a.initialState,i=a.constants,Array.isArray(t)&&(r=t.slice(1),t=t[0]),(null==r||0===r.length)&&null==i)return e.prototype.apply.call(this,t,n);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new d("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,o.push.apply(o,r);var c=r.map((function(e){return new ft({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,c)}if(null!=i)throw new m("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof pt,f=0,p=o;f<p.length;f++)if(p[f]instanceof pt!==l)throw new d("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){var h=[t].concat(o),g=this.inputSpec.concat(s),v=this.inputSpec;this.inputSpec=g;var y=e.prototype.apply.call(this,h,n);return this.inputSpec=v,y}return e.prototype.apply.call(this,t,n)},t.prototype.call=function(e,t){var n=this;return(0,i.tidy)((function(){var r,a,o,s,u=t.initialState;if(null==u)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var c=u.slice(0,u.length/2),l=u.slice(u.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:c})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:l}))}return n.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=(0,i.reverse)(a,1)),"concat"===n.mergeMode?s=ye([r,a]):"sum"===n.mergeMode?s=(0,i.add)(r,a):"ave"===n.mergeMode?s=(0,i.mul)(.5,(0,i.add)(r,a)):"mul"===n.mergeMode?s=(0,i.mul)(r,a):null==n.mergeMode&&(s=[r,a]),n.returnState?null==n.mergeMode?s.concat(o):[s].concat(o):s}))},t.prototype.resetStates=function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},t.prototype.build=function(e){var t=this;ne(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),ne(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0},t.prototype.computeMask=function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n},Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),t.prototype.setFastWeightInitDuringBuild=function(t){e.prototype.setFastWeightInitDuringBuild.call(this,t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)},t.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.fromConfig=function(e,t){var n=Ot(t.layer);if(delete t.layer,null!=t.numConstants)throw new m("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)},t.className="Bidirectional",t}(Pi);function Ui(e){return new hi(e)}function qi(e){return new gi(e)}function Wi(e){return new bi(e)}function Vi(e){return new Ei(e)}function $i(e){return new Ni(e)}function Hi(e){return new pi(e)}function Gi(e){return new mi(e)}i.serialization.registerClass(ji);var Ki=Vi,Xi=$i,Yi=Hi,Ji=Gi,Zi=Object.freeze({inputLayer:function(e){return new xt(e)},elu:function(e){return new vr(e)},reLU:function(e){return new dr(e)},leakyReLU:function(e){return new mr(e)},prelu:function(e){return new gr(e)},softmax:function(e){return new br(e)},thresholdedReLU:function(e){return new yr(e)},conv1d:function(e){return new Ir(e)},conv2d:function(e){return new Dr(e)},conv2dTranspose:function(e){return new Mr(e)},conv3d:function(e){return new _r(e)},separableConv2d:function(e){return new Or(e)},cropping2D:function(e){return new Fr(e)},upSampling2d:function(e){return new Rr(e)},depthwiseConv2d:function(e){return new Br(e)},activation:function(e){return new Ur(e)},dense:function(e){return new Lr(e)},dropout:function(e){return new zr(e)},spatialDropout1d:function(e){return new Pr(e)},flatten:function(e){return new jr(e)},repeatVector:function(e){return new qr(e)},reshape:function(e){return new Wr(e)},permute:function(e){return new Vr(e)},embedding:function(e){return new Hr(e)},add:function(e){return new Kr(e)},average:function(e){return new Yr(e)},concatenate:function(e){return new Qr(e)},maximum:function(e){return new Jr(e)},minimum:function(e){return new Zr(e)},multiply:function(e){return new Xr(e)},dot:function(e){return new ti(e)},batchNormalization:function(e){return new oi(e)},layerNormalization:function(e){return new si(e)},zeroPadding2d:function(e){return new ui(e)},averagePooling1d:Ui,avgPool1d:function(e){return Ui(e)},avgPooling1d:function(e){return Ui(e)},averagePooling2d:qi,avgPool2d:function(e){return qi(e)},avgPooling2d:function(e){return qi(e)},averagePooling3d:Wi,avgPool3d:function(e){return Wi(e)},avgPooling3d:function(e){return Wi(e)},globalAveragePooling1d:function(e){return new wi(e)},globalAveragePooling2d:function(e){return new Si(e)},globalMaxPooling1d:Vi,globalMaxPooling2d:$i,maxPooling1d:Hi,maxPooling2d:Gi,maxPooling3d:function(e){return new yi(e)},gru:function(e){return new Ii(e)},gruCell:function(e){return new Oi(e)},lstm:function(e){return new Ri(e)},lstmCell:function(e){return new Fi(e)},simpleRNN:function(e){return new Ti(e)},simpleRNNCell:function(e){return new Mi(e)},rnn:function(e){return new Di(e)},stackedRNNCells:function(e){return new Bi(e)},bidirectional:function(e){return new ji(e)},timeDistributed:function(e){return new Li(e)},globalMaxPool1d:Ki,globalMaxPool2d:Xi,maxPool1d:Yi,maxPool2d:Ji,Layer:gt,RNN:Di,RNNCell:_i,input:Wn,gaussianNoise:function(e){return new ni(e)},gaussianDropout:function(e){return new ri(e)},alphaDropout:function(e){return new ii(e)},masking:function(e){return new $r(e)}}),Qi=Object.freeze({binaryAccuracy:function(e,t){return Wt(e,t)},binaryCrossentropy:function(e,t){return Gt(e,t)},sparseCategoricalAccuracy:function(e,t){return Kt(e,t)},categoricalAccuracy:function(e,t){return Vt(e,t)},categoricalCrossentropy:function(e,t){return Xt(e,t)},precision:function(e,t){return Ht(e,t)},recall:function(e,t){return function(e,t){return(0,i.tidy)((function(){var n=$t(e,t),r=function(e,t){return(0,i.tidy)((function(){return(0,i.logicalAnd)(e.equal(1),t.equal(0)).sum().cast("float32")}))}(e,t),a=n.add(r);return(0,i.where)((0,i.greater)(a,0),n.div(a),0).cast("float32")}))}(e,t)},cosineProximity:function(e,t){return jt(e,t)},meanAbsoluteError:function(e,t){return Rt(e,t)},meanAbsolutePercentageError:function(e,t){return Bt(e,t)},MAPE:function(e,t){return Bt(e,t)},mape:function(e,t){return Bt(e,t)},meanSquaredError:function(e,t){return Ft(e,t)},MSE:function(e,t){return Ft(e,t)},mse:function(e,t){return Ft(e,t)}}),ea=Object.freeze({modelFromJSON:function(e,t){return c(this,void 0,void 0,(function(){var n,r,a,o,s,u,c,f;return l(this,(function(l){switch(l.label){case 0:return"modelTopology"in e||(e={modelTopology:e}),null!=(n=(e=e).modelTopology).model_config&&(n=n.model_config),r=on(n),a=Ot(r,t),null==e.weightsManifest?[3,2]:[4,i.io.loadWeights(e.weightsManifest,e.pathPrefix,a.weights.map((function(e){return e.originalName})))];case 1:for(o=l.sent(),s={},u=0,c=a.weights;u<c.length;u++)f=c[u],s[f.originalName]=o[f.originalName];a.loadWeights(s),(0,i.dispose)(o),l.label=2;case 2:return[2,a]}}))}))}}),ta=Object.freeze({l1l2:function(e){return new cr(e)},l1:function(e){return function(e){return sr(e),new cr({l1:null!=e?e.l1:null,l2:0})}(e)},l2:function(e){return function(e){return sr(e),new cr({l2:null!=e?e.l2:null,l1:0})}(e)}}),na=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.model=null,t}return o(t,e),t.prototype.setModel=function(e){if(!(e instanceof zn))throw new Error("model must be a LayersModel, not some other Container");this.model=e},t}(St);function ra(e,t){return e<t}function ia(e,t){return e>t}var aa=function(e){function t(t){var n=e.call(this)||this;if(null==t&&(t={}),t.restoreBestWeights)throw new m("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,-1===["auto","min","max"].indexOf(n.mode)&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),"min"===n.mode?n.monitorFunc=ra:"max"===n.mode||-1!==n.monitor.indexOf("acc")?n.monitorFunc=ia:n.monitorFunc=ra,n.monitorFunc===ra&&(n.minDelta*=-1),n}return o(t,e),t.prototype.onTrainBegin=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(e){return this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===ra?1/0:-1/0,[2]}))}))},t.prototype.onEpochEnd=function(e,t){return c(this,void 0,void 0,(function(){var n;return l(this,(function(r){switch(r.label){case 0:return[4,Et(t)];case 1:return r.sent(),null==(n=this.getMonitorValue(t))||(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0))),[2]}}))}))},t.prototype.onTrainEnd=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(e){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]}))}))},t.prototype.getMonitorValue=function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(e)),t},t}(na),oa={earlyStopping:function(e){return new aa(e)}},sa=n(6946),ua=function(e,t){return(ua=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function ca(e,t){function n(){this.constructor=e}ua(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function la(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function fa(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function pa(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self&&self;var ha=pa((function(e){!function(e,t,n){function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new function(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}(e),i=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),da=pa((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new function(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),ma=pa((function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),ga=pa((function(e){!function(e,t,n){function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.x&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),va=pa((function(e){!function(e,t,n){function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.X&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),ya=pa((function(e){!function(e,t,n){function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&r(i,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),ba=pa((function(e){!function(t,r){var i,a=this,o=256,s="random",u=r.pow(o,6),c=r.pow(2,52),l=2*c,f=255;function p(e,n,p){var g=[],v=d(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,m(t)]}}():e,3),g),y=new function(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=f&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=f&i+1],n=n*o+s[f&(s[i]=s[a=f&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}(g),b=function(){for(var e=y.g(6),t=u,n=0;e<c;)e=(e+n)*o,t*=o,n=y.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,d(m(y.S),t),(n.pass||p||function(e,t,n,i){return i&&(i.S&&h(i,y),e.state=function(){return h(y,{})}),n?(r[s]=e,t):e})(b,v,"global"in n?n.global:this==r,n.state)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){for(var n,r=e+"",i=0;i<r.length;)t[f&i]=f&(n^=19*t[f&i])+r.charCodeAt(i++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=p,d(r.random(),t),e.exports){e.exports=p;try{i=n(802)}catch(e){}}}([],Math)}));ba.alea=ha,ba.xor128=da,ba.xorwow=ma,ba.xorshift7=ga,ba.xor4096=va,ba.tychei=ya;var xa=ba.alea;function wa(e,t,n,r){if(void 0===n&&(n=new Map),void 0===r&&(r=new Set),null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(Aa(e)){var a=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=wa(e[o],t,n,r);a[o]=s}return r.delete(e),a}throw new Error("Can't recurse into non-iterable type: "+e)}return n.set(e,i.value),i.value}function Ea(e,t){return void 0===t&&(t=Sa),Ca(e,t)}function Ca(e,t,n){void 0===n&&(n=new Set);var r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(Aa(r)){var a=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var i=Ca(e.map((function(e){return e[r]})),t,n);a[r]=i};for(var s in r)o(s);return n.delete(r),a}throw new Error("Can't recurse into non-iterable type: "+r)}return i.value}function Sa(e){return null===e?null:Aa(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function Na(e,t){return la(this,void 0,void 0,(function(){var n,r,i,a,o,s;return fa(this,(function(u){switch(u.label){case 0:n=new Map,wa(e,t,n),r=0,i=Array.from(n.keys()),u.label=1;case 1:return r<i.length?(a=i[r],(o=n.get(a))instanceof Promise?[4,o]:[3,3]):[3,4];case 2:s=u.sent(),n.set(a,s),u.label=3;case 3:return r++,[3,1];case 4:return[2,wa(e,t,n)]}}))}))}function Aa(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof i.Tensor))}function ka(e){return function(e,t){return wa(e,t)}(e,Da)}function Da(e){return e instanceof i.Tensor?{value:e.clone(),recurse:!1}:Aa(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var _a=function(){function e(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return e.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},e.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},e.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},e.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},e.prototype.isFull=function(){return this.length()===this.capacity},e.prototype.isEmpty=function(){return 0===this.length()},e.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},e.prototype.pushAll=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.push(r)}},e.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},e.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},e.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},e.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},e}(),Ma=function(e){function t(){return e.call(this,t.INITIAL_CAPACITY)||this}return ca(t,e),t.prototype.isFull=function(){return!1},t.prototype.push=function(t){e.prototype.isFull.call(this)&&this.expand(),e.prototype.push.call(this,t)},t.prototype.unshift=function(t){e.prototype.isFull.call(this)&&this.expand(),e.prototype.unshift.call(this,t)},t.prototype.expand=function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n},t.INITIAL_CAPACITY=32,t}(_a);function Ta(e){return new Pa(e)}function Oa(e){return new La(e)}function Ia(e,t){return new Ya(e,t)}function Fa(e,t){return void 0===t&&(t=Ra.FAIL),new Ja(e,t)}var Ra,Ba,za=function(){function e(){}return e.prototype.toArray=function(){return la(this,void 0,void 0,(function(){var e,t;return fa(this,(function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}}))}))},e.prototype.toArrayForTest=function(){return la(this,void 0,void 0,(function(){var e,t,n;return fa(this,(function(r){switch(r.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=r.sent(),r.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=r.sent(),[3,2];case 4:return[2,t]}}))}))},e.prototype.resolveFully=function(){return la(this,void 0,void 0,(function(){var e;return fa(this,(function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}}))}))},e.prototype.resolveWhile=function(e){return la(this,void 0,void 0,(function(){var t,n;return fa(this,(function(r){switch(r.label){case 0:return[4,this.next()];case 1:t=r.sent(),n=e(t.value),r.label=2;case 2:return t.done||!n?[3,4]:[4,this.next()];case 3:return t=r.sent(),n=e(t.value),[3,2];case 4:return[2]}}))}))},e.prototype.handleErrors=function(e){return new Ha(this,e)},e.prototype.filter=function(e){return new Va(this,e)},e.prototype.map=function(e){return new $a(this,e)},e.prototype.mapAsync=function(e){return new Ga(this,e)},e.prototype.serialMapAsync=function(e){return new Ga(this,e).serial()},e.prototype.flatmap=function(e){return new Xa(this,e)},e.prototype.forEachAsync=function(e){return la(this,void 0,void 0,(function(){return fa(this,(function(t){return[2,this.map(e).resolveFully()]}))}))},e.prototype.serialForEach=function(e){return la(this,void 0,void 0,(function(){return fa(this,(function(t){return[2,this.serialMapAsync(e).resolveWhile((function(e){return!0===e}))]}))}))},e.prototype.rowMajorBatch=function(e,t){return void 0===t&&(t=!0),new Wa(this,e,t)},e.prototype.columnMajorBatch=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=Sa),this.rowMajorBatch(e,t).map((function(e){return Ea(e,n)}))},e.prototype.concatenate=function(e,t){return new Ya(Ta([this,e]),t)},e.prototype.take=function(e){return e<0||null==e?this:new qa(this,e)},e.prototype.skip=function(e){return e<0||null==e?this:new Ua(this,e)},e.prototype.prefetch=function(e){return new Za(this,e)},e.prototype.shuffle=function(e,t){return new Qa(this,e,t)},e.prototype.serial=function(){return new ja(this)},e}(),Pa=function(e){function t(t){var n=e.call(this)||this;return n.items=t,n.trav=0,n}return ca(t,e),t.prototype.summary=function(){return"Array of "+this.items.length+" items"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e;return fa(this,(function(t){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(e=this.items[this.trav],this.trav++,[2,{value:ka(e),done:!1}])}))}))},t}(za),La=function(e){function t(t){var n=e.call(this)||this;return n.nextFn=t,n}return ca(t,e),t.prototype.summary=function(){return"Function call"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){try{return[2,this.nextFn()]}catch(e){throw e.message="Error thrown while iterating through a dataset: "+e.message,e}return[2]}))}))},t}(za),ja=function(e){function t(t){var n=e.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e=this;return fa(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){return[2,this.upstream.next()]}))}))},t}(za),Ua=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.maxCount=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e=this;return fa(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return la(this,void 0,void 0,(function(){var e;return fa(this,(function(t){switch(t.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(e=t.sent()).done?[2,e]:((0,i.dispose)(e.value),[3,0]);case 2:return[2,this.upstream.next()]}}))}))},t}(za),qa=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.maxCount=n,r.count=0,r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Take"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]}))}))},t}(za),Wa=function(e){function t(t,n,r){void 0===r&&(r=!0);var i=e.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=r,i.lastRead=Promise.resolve({value:null,done:!1}),i}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e=this;return fa(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return la(this,void 0,void 0,(function(){var e,t;return fa(this,(function(n){switch(n.label){case 0:e=[],n.label=1;case 1:return e.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(t=n.sent()).done?this.enableSmallLastBatch&&e.length>0?[2,{value:e,done:!1}]:[2,{value:null,done:!0}]:(e.push(t.value),[3,1]);case 3:return[2,{value:e,done:!1}]}}))}))},t}(za),Va=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.predicate=n,r.lastRead=Promise.resolve({value:null,done:!1}),r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e=this;return fa(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return la(this,void 0,void 0,(function(){var e;return fa(this,(function(t){switch(t.label){case 0:return[4,this.upstream.next()];case 1:return(e=t.sent()).done||this.predicate(e.value)?[2,e]:((0,i.dispose)(e.value),[3,0]);case 2:return[2]}}))}))},t}(za),$a=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Map"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return fa(this,(function(u){switch(u.label){case 0:return[4,this.upstream.next()];case 1:if((e=u.sent()).done)return[2,{value:null,done:!0}];for(t=i.tensor_util.getTensorsInContainer(e.value),n=this.transform(e.value),r=i.tensor_util.getTensorsInContainer(n),a=0,o=t;a<o.length;a++)s=o[a],i.tensor_util.isTensorInList(s,r)||s.dispose();return[2,{value:n,done:!1}]}}))}))},t}(za),Ha=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.handler=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e=this;return fa(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return la(this,void 0,void 0,(function(){var e;return fa(this,(function(t){switch(t.label){case 0:t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,t.sent()];case 3:return e=t.sent(),this.handler(e)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}}))}))},t}(za),Ga=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return fa(this,(function(u){switch(u.label){case 0:return[4,this.upstream.next()];case 1:return(e=u.sent()).done?[2,{value:null,done:!0}]:(t=i.tensor_util.getTensorsInContainer(e.value),[4,this.transform(e.value)]);case 2:for(n=u.sent(),r=i.tensor_util.getTensorsInContainer(n),a=0,o=t;a<o.length;a++)s=o[a],i.tensor_util.isTensorInList(s,r)||s.dispose();return[2,{value:n,done:!1}]}}))}))},t}(za),Ka=function(e){function t(){var t=e.call(this)||this;return t.outputQueue=new Ma,t.lastRead=Promise.resolve({value:null,done:!1}),t}return ca(t,e),t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e=this;return fa(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.serialNext=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return e.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}}))}))},t}(za),Xa=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.transform=n,r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},t.prototype.pump=function(){return la(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return fa(this,(function(u){switch(u.label){case 0:return[4,this.upstream.next()];case 1:if((e=u.sent()).done)return[2,!1];for(t=i.tensor_util.getTensorsInContainer(e.value),n=this.transform(e.value),r=i.tensor_util.getTensorsInContainer(n),this.outputQueue.pushAll(n),a=0,o=t;a<o.length;a++)s=o[a],i.tensor_util.isTensorInList(s,r)||s.dispose();return[2,!0]}}))}))},t}(Ka),Ya=function(e){function t(t,n){var r=e.call(this)||this;return r.baseErrorHandler=n,r.lastRead=null,r.iterator=null,r.moreIterators=t,r}return ca(t,e),t.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},t.prototype.next=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]}))}))},t.prototype.readFromChain=function(e){return la(this,void 0,void 0,(function(){var t,n;return fa(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return r.sent(),null!=this.iterator?[3,3]:[4,this.moreIterators.next()];case 2:if((t=r.sent()).done)return[2,{value:null,done:!0}];this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),r.label=3;case 3:return[4,this.iterator.next()];case 4:return(n=r.sent()).done?(this.iterator=null,[2,this.readFromChain(e)]):[2,n]}}))}))},t}(za);(Ba=Ra||(Ra={}))[Ba.FAIL=0]="FAIL",Ba[Ba.SHORTEST=1]="SHORTEST",Ba[Ba.LONGEST=2]="LONGEST";var Ja=function(e){function t(t,n){void 0===n&&(n=Ra.FAIL);var r=e.call(this)||this;return r.iterators=t,r.mismatchMode=n,r.count=0,r.currentPromise=null,r}return ca(t,e),t.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},t.prototype.nextState=function(e){return la(this,void 0,void 0,(function(){function t(e){return e instanceof za?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}}var n,r,i;return fa(this,(function(a){switch(a.label){case 0:return[4,e];case 1:return a.sent(),n=0,r=0,[4,Na(this.iterators,t)];case 2:if(i=a.sent(),n===r)return[2,{value:null,done:!0}];if(r>0)switch(this.mismatchMode){case Ra.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case Ra.SHORTEST:return[2,{value:null,done:!0}];case Ra.LONGEST:}return this.count++,[2,{value:i,done:!1}]}}))}))},t.prototype.next=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]}))}))},t}(za),Za=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.bufferSize=n,r.buffer=new _a(n),r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},t.prototype.refill=function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}},t.prototype.next=function(){return this.refill(),this.buffer.shift()},t}(za),Qa=function(e){function t(t,n,r){var a=e.call(this,t,n)||this;return a.upstream=t,a.windowSize=n,a.upstreamExhausted=!1,a.random=xa(r||i.util.now().toString()),a.lastRead=Promise.resolve({value:null,done:!1}),a}return ca(t,e),t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e=this;return fa(this,(function(t){return this.lastRead=this.lastRead.then((function(){return e.serialNext()})),[2,this.lastRead]}))}))},t.prototype.randomInt=function(e){return Math.floor(this.random()*e)},t.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},t.prototype.serialNext=function(){return la(this,void 0,void 0,(function(){var e,t;return fa(this,(function(n){switch(n.label){case 0:this.upstreamExhausted||this.refill(),n.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(e=this.chooseIndex(),[4,this.buffer.shuffleExcise(e)]);case 2:return(t=n.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,t]);case 3:return[2,{value:null,done:!0}]}}))}))},t}(Za),eo=function(){function e(){this.size=null}return e.prototype.batch=function(e,t){var n=this;void 0===t&&(t=!0);var r=this;return i.util.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      "+e})),to((function(){return la(n,void 0,void 0,(function(){return fa(this,(function(n){switch(n.label){case 0:return[4,r.iterator()];case 1:return[2,n.sent().columnMajorBatch(e,t,io)]}}))}))}),this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e))},e.prototype.concatenate=function(e){var t=this,n=this;return to((function(){return la(t,void 0,void 0,(function(){var t,r;return fa(this,(function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return r=(t=i.sent()).concatenate,[4,e.iterator()];case 2:return[2,r.apply(t,[i.sent()])]}}))}))}),this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null)},e.prototype.filter=function(e){var t=this,n=this;return to((function(){return la(t,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().filter((function(t){return(0,i.tidy)((function(){return e(t)}))}))]}}))}))}),this.size===1/0?1/0:null)},e.prototype.forEachAsync=function(e){return la(this,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}}))}))},e.prototype.forEach=function(e){return la(this,void 0,void 0,(function(){return fa(this,(function(t){return(0,i.deprecationWarn)("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(e)]}))}))},e.prototype.map=function(e){var t=this,n=this;return to((function(){return la(t,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().map((function(t){return(0,i.tidy)((function(){return e(t)}))}))]}}))}))}),this.size)},e.prototype.mapAsync=function(e){var t=this,n=this;return to((function(){return la(t,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().mapAsync(e)]}}))}))}),this.size)},e.prototype.prefetch=function(e){var t=this;if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return to((function(){return la(t,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().prefetch(e)]}}))}))}),this.size)},e.prototype.repeat=function(e){var t=this,n=this;return to((function(){return la(t,void 0,void 0,(function(){var t=this;return fa(this,(function(r){return[2,Ia(Oa((function(){return la(t,void 0,void 0,(function(){var e;return fa(this,(function(t){switch(t.label){case 0:return e={},[4,n.iterator()];case 1:return[2,(e.value=t.sent(),e.done=!1,e)]}}))}))})).take(e))]}))}))}),null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null)},e.prototype.skip=function(e){var t=this,n=this;return to((function(){return la(t,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().skip(e)]}}))}))}),null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null)},e.prototype.shuffle=function(e,t,n){var r=this;if(void 0===n&&(n=!0),null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var a=this,o=xa(t||i.util.now().toString());return to((function(){return la(r,void 0,void 0,(function(){var t;return fa(this,(function(r){switch(r.label){case 0:return t=o.int32(),n&&(t+=o.int32()),[4,a.iterator()];case 1:return[2,r.sent().shuffle(e,t.toString())]}}))}))}),this.size)},e.prototype.take=function(e){var t=this,n=this;return to((function(){return la(t,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,n.iterator()];case 1:return[2,t.sent().take(e)]}}))}))}),null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null)},e.prototype.toArray=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}}))}))},e.prototype.toArrayForTest=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}}))}))},e.MAX_BUFFER_SIZE=1e4,e}();function to(e,t){return void 0===t&&(t=null),new(function(n){function r(){var e=null!==n&&n.apply(this,arguments)||this;return e.size=t,e}return ca(r,n),r.prototype.iterator=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(t){return[2,e()]}))}))},r}(eo))}function no(e){var t=this;return to((function(){return la(t,void 0,void 0,(function(){return fa(this,(function(t){return[2,Ta(e)]}))}))}),e.length)}function ro(e){var t,n=this;if(!Aa(e))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray(e))for(var r=0;r<e.length;r++)t=null==t?e[r].size:Math.min(t,e[r].size);else if(e instanceof Object)for(var i in e)t=null==t?e[i].size:Math.min(t,e[i].size);return to((function(){return la(n,void 0,void 0,(function(){return fa(this,(function(t){switch(t.label){case 0:return[4,Na(e,(function(e){if(e instanceof eo)return{value:e.iterator(),recurse:!1};if(Aa(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}))];case 1:return[2,Fa(t.sent(),Ra.SHORTEST)]}}))}))}),t)}function io(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof i.Tensor||i.util.isTypedArray(e)}(e[0])?{value:ao(e),recurse:!1}:{value:null,recurse:!0}}function ao(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof i.Tensor?(0,i.stack)(e):(0,i.tensor)(e)}var oo=function(e){function t(t){var n=e.call(this)||this;return n.input=t,n}return ca(t,e),t.prototype.iterator=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return[4,this.input.iterator()];case 1:return[2,e.sent().decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e}))]}}))}))},t}(eo),so='"',uo=Symbol("out"),co=Symbol("field"),lo=Symbol("quote"),fo=Symbol("quoteafterquote"),po=Symbol("quoteinquote"),ho=function(e){function t(t,n){var r=e.call(this)||this;return r.input=t,r.hasHeader=!0,r.fullColumnNames=null,r.columnNamesValidated=!1,r.columnConfigs=null,r.configuredColumnsOnly=!1,r.delimiter=",",r.delimWhitespace=!1,r.base=new oo(t),n||(n={}),r.hasHeader=!1!==n.hasHeader,r.fullColumnNames=n.columnNames,r.columnConfigs=n.columnConfigs,r.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(i.util.assert(null==n.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),r.delimWhitespace=!0,r.delimiter=" "):r.delimiter=n.delimiter?n.delimiter:",",r}return ca(t,e),t.prototype.columnNames=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:e.sent(),e.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}}))}))},t.prototype.setColumnNames=function(){return la(this,void 0,void 0,(function(){var e,t,n,r,a,o,s=this;return fa(this,(function(u){switch(u.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(e=u.sent(),!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&e&&i.util.assert(e.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=e),t=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),n=Object.keys(t).filter((function(e){return t[e]>1})),i.util.assert(0===n.length,(function(){return"Duplicate column names found: "+n.toString()})),this.columnConfigs)for(r=0,a=Object.keys(this.columnConfigs);r<a.length;r++)if(o=a[r],-1===this.fullColumnNames.indexOf(o))throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");return this.columnNamesValidated=!0,[2]}}))}))},t.prototype.maybeReadHeaderLine=function(){return la(this,void 0,void 0,(function(){var e,t;return fa(this,(function(n){switch(n.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,n.sent().next()];case 2:if((e=n.sent()).done)throw new Error("No data was found for CSV parsing.");return t=e.value,[2,this.parseRow(t,!1)];case 3:return[2,null]}}))}))},t.prototype.iterator=function(){return la(this,void 0,void 0,(function(){var e,t=this;return fa(this,(function(n){switch(n.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:n.sent(),n.label=2;case 2:return[4,this.base.iterator()];case 3:return e=n.sent(),this.hasHeader&&(e=e.skip(1)),[2,e.map((function(e){return t.makeDataElement(e)}))]}}))}))},t.prototype.makeDataElement=function(e){for(var t=this.parseRow(e),n={},r={},i=0;i<this.fullColumnNames.length;i++){var a=this.fullColumnNames[i],o=this.columnConfigs?this.columnConfigs[a]:null;if(!this.configuredColumnsOnly||o){var s=t[i],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column "+a+" is empty in this line: "+e);u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[a]=u:n[a]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}},t.prototype.getBoolean=function(e){return"1"===e||"true"===e.toLowerCase()?1:0},t.prototype.parseRow=function(e,t){void 0===t&&(t=!0);for(var n=[],r=0,i=e.length,a=uo,o=0;o<i;o++)switch(a){case uo:switch(e.charAt(o)){case so:r=o+1,a=lo;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),a=uo;break;default:a=co,r=o}break;case co:e.charAt(o)===this.delimiter&&(n.push(e.substring(r,o)),a=uo,r=o+1);break;case lo:e.charAt(o)===so&&(a=fo);break;case fo:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),a=uo,r=o+1;break;case so:a=lo;break;default:a=po}break;case po:e.charAt(o)===so&&(a=lo)}if(a===fo?n.push(e.substring(r,i-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+n);return n},t}(eo),mo=function(e){function t(t){var n=e.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var r=Math.log2(n.fftSize);if(n.fftSize<0||r<4||r>14||!Number.isInteger(r))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+n.fftSize);if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=!1!==t.includeSpectrogram,n.includeWaveform=!0===t.includeWaveform,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return ca(t,e),t.prototype.summary=function(){return"microphone"},t.create=function(e){return void 0===e&&(e={}),la(this,void 0,void 0,(function(){var n;return fa(this,(function(r){switch(r.label){case 0:if((0,i.env)().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(n=new t(e)).start()];case 1:return r.sent(),[2,n]}}))}))},t.prototype.start=function(){return la(this,void 0,void 0,(function(){var e,t,n,r;return fa(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=this,[4,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})];case 1:return e.stream=i.sent(),[3,3];case 2:throw t=i.sent(),new Error("Error thrown while initializing video stream: "+t.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(n=window.AudioContext||window.webkitAudioContext,this.audioContext=new n,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return r=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,r.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}}))}))},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e,t,n,r,i;return fa(this,(function(a){switch(a.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return n=a.sent(),this.includeSpectrogram&&(r=this.flattenQueue(n.freqDataQueue),e=this.getTensorFromAudioDataArray(r,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(n.timeDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:e,waveform:t},done:!1}]}}))}))},t.prototype.capture=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return[4,this.next()];case 1:return[2,e.sent().value]}}))}))},t.prototype.getAudioData=function(){return la(this,void 0,void 0,(function(){var e,t,n,r=this;return fa(this,(function(i){return e=[],t=[],n=0,[2,new Promise((function(i){var a=setInterval((function(){r.includeSpectrogram&&(r.analyser.getFloatFrequencyData(r.freqData),r.freqData[0]===-1/0&&i({freqDataQueue:e,timeDataQueue:t}),e.push(r.freqData.slice(0,r.columnTruncateLength))),r.includeWaveform&&(r.analyser.getFloatTimeDomainData(r.timeData),t.push(r.timeData.slice())),++n===r.numFrames&&(clearInterval(a),i({freqDataQueue:e,timeDataQueue:t}))}),r.fftSize/r.sampleRateHz*1e3)}))]}))}))},t.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},t.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},t.prototype.getSampleRate=function(){return this.sampleRateHz},t.prototype.flattenQueue=function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n},t.prototype.getTensorFromAudioDataArray=function(e,t){var n=new Float32Array(i.util.sizeFromShape(t));return n.set(e,n.length-e.length),(0,i.tensor)(n,t)},t}(za),go=function(e){function t(t,n){var r=e.call(this)||this;if(r.webcamVideoElement=t,r.webcamConfig=n,r.isClosed=!0,r.resize=!1,r.needToResize())if(r.resize=!0,r.cropSize=[r.webcamConfig.resizeHeight,r.webcamConfig.resizeWidth],r.cropBoxInd=(0,i.tensor1d)([0],"int32"),r.webcamConfig.centerCrop){var a=1*r.webcamConfig.resizeWidth/r.webcamVideoElement.width,o=1*r.webcamConfig.resizeHeight/r.webcamVideoElement.height,s=(1-a)/2,u=(1-o)/2,c=s+a,l=o+u;r.cropBox=(0,i.tensor2d)([u,s,l,c],[1,4])}else r.cropBox=(0,i.tensor2d)([0,0,1,1],[1,4]);return r}return ca(t,e),t.prototype.summary=function(){return"webcam"},t.create=function(e,n){return void 0===n&&(n={}),la(this,void 0,void 0,(function(){var r;return fa(this,(function(a){switch(a.label){case 0:if((0,i.env)().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=n.resizeWidth,e.height=n.resizeHeight}return[4,(r=new t(e,n)).start()];case 1:return a.sent(),[2,r]}}))}))},t.prototype.start=function(){return la(this,void 0,void 0,(function(){var e,t,n=this;return fa(this,(function(r){switch(r.label){case 0:this.webcamConfig.facingMode&&i.util.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: "+n.webcamConfig.facingMode+". Please provide 'user' or 'environment'"})),r.label=1;case 1:return r.trys.push([1,3,,4]),e=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return e.stream=r.sent(),[3,4];case 3:throw(t=r.sent()).message="Error thrown while initializing video stream: "+t.message,t;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise((function(e){n.webcamVideoElement.onloadedmetadata=function(){e()}}))]}}))}))},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e;return fa(this,(function(t){if(this.isClosed)return[2,{value:null,done:!0}];try{e=i.browser.fromPixels(this.webcamVideoElement)}catch(e){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(e))}if(!this.resize)return[2,{value:e,done:!1}];try{return[2,{value:this.cropAndResizeFrame(e),done:!1}]}catch(e){throw new Error("Error thrown cropping the video: "+e.message)}finally{e.dispose()}return[2]}))}))},t.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},t.prototype.cropAndResizeFrame=function(e){var t=this;return(0,i.tidy)((function(){var n,r=e.toFloat().expandDims(0),a=(n=i.image.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return n.reshape(a.slice(1))}))},t.prototype.capture=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){switch(e.label){case 0:return[4,this.next()];case 1:return[2,e.sent().value]}}))}))},t.prototype.stop=function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0},t.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},t}(za),vo=function(){},yo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ca(t,e),t.prototype.split=function(e){return new bo(this,e)},t}(za),bo=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.impl=new xo(t,n),r}return ca(t,e),t.prototype.summary=function(){return this.impl.summary()},t.prototype.next=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){return[2,this.impl.next()]}))}))},t}(yo),xo=function(e){function t(t,n){var r=e.call(this)||this;return r.upstream=t,r.separator=n,r.carryover="",r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},t.prototype.pump=function(){return la(this,void 0,void 0,(function(){var e,t,n,r,i;return fa(this,(function(a){switch(a.label){case 0:return[4,this.upstream.next()];case 1:if((e=a.sent()).done)return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((t=e.value.split(this.separator))[0]=this.carryover+t[0],n=0,r=t.slice(0,-1);n<r.length;n++)i=r[n],this.outputQueue.push(i);return this.carryover=t[t.length-1],[2,!0]}}))}))},t}(Ka),wo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ca(t,e),t.prototype.decodeUTF8=function(){return new Eo(this)},t}(za),Eo=function(e){function t(t){var n=e.call(this)||this;return n.upstream=t,n.impl=new Co(t),n}return ca(t,e),t.prototype.summary=function(){return this.impl.summary()},t.prototype.next=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){return[2,this.impl.next()]}))}))},t}(yo),Co=function(e){function t(t){var r=e.call(this)||this;if(r.upstream=t,(0,i.env)().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=n(5688).StringDecoder;r.decoder=new a("utf8")}return r}return ca(t,e),t.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},t.prototype.pump=function(){return la(this,void 0,void 0,(function(){var e,t,n;return fa(this,(function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return(e=r.sent()).done?[2,!1]:(t=e.value,n=(0,i.env)().get("IS_BROWSER")?this.decoder.decode(t,{stream:!0}):this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(n),[2,!0])}}))}))},t}(Ka),So=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.file=t,r.options=n,i.util.assert(t instanceof Uint8Array||!!(0,i.env)().get("IS_BROWSER")&&(t instanceof File||t instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=n.offset||0,r.chunkSize=n.chunkSize||1048576,r}return ca(t,e),t.prototype.summary=function(){return"FileChunks "+this.file},t.prototype.next=function(){return la(this,void 0,void 0,(function(){var e,t,n=this;return fa(this,(function(r){switch(r.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(e=new Promise((function(e,t){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)e(new Uint8Array(n.file.slice(n.offset,r)));else{var i=new FileReader;i.onload=function(n){var r=i.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(r)},i.onabort=function(e){return t(new Error("Aborted"))},i.onerror=function(e){return t(new Error(e.type))};var a=n.file.slice(n.offset,r);i.readAsArrayBuffer(a)}n.offset=r})),t={},[4,e]);case 1:return[2,(t.value=r.sent(),t.done=!1,t)]}}))}))},t}(wo);function No(e,t){return void 0===t&&(t={}),la(this,void 0,void 0,(function(){var n,r,a,o,s;return fa(this,(function(u){switch(u.label){case 0:return"string"==typeof e?n=e:(n=e.url,r=Ao(e)),[4,i.util.fetch(n,r)];case 1:return(a=u.sent()).ok?(s=Uint8Array.bind,[4,a.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new So(o,t)];case 3:throw new Error(a.statusText)}}))}))}var Ao=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function ko(e){return"string"==typeof e&&"file://"===e.substr(0,7)}var Do=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.input=t,r.options=n,r}return ca(t,e),t.prototype.iterator=function(){return la(this,void 0,void 0,(function(){var e;return fa(this,(function(t){return ko(this.input)&&(0,i.env)().get("IS_NODE")&&(e=n(4633),this.input=e.readFileSync(this.input.substr(7))),[2,new So(this.input,this.options)]}))}))},t}(vo),_o=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;return r.url=t,r.fileOptions=n,r}return ca(t,e),t.prototype.iterator=function(){return la(this,void 0,void 0,(function(){return fa(this,(function(e){return ko(this.url)?[2,new Do(this.url,this.fileOptions).iterator()]:[2,No(this.url,this.fileOptions)]}))}))},t}(vo);function Mo(e,t){return void 0===t&&(t={}),new ho(new _o(e),t)}function To(e){var t=this,n=Oa(e);return to((function(){return la(t,void 0,void 0,(function(){return fa(this,(function(e){return[2,n]}))}))}))}function Oo(e){var t=this;return to((function(){return la(t,void 0,void 0,(function(){var t;return fa(this,(function(n){switch(n.label){case 0:return[4,e()];case 1:return t=n.sent(),[2,Oa((function(){return t.next()}))]}}))}))}))}function Io(e,t){return la(this,void 0,void 0,(function(){return fa(this,(function(n){return[2,go.create(e,t)]}))}))}function Fo(e){return la(this,void 0,void 0,(function(){return fa(this,(function(t){return[2,mo.create(e)]}))}))}var Ro="1.7.4",Bo={"tfjs-core":i.version_core,"tfjs-data":Ro,"tfjs-layers":un,"tfjs-converter":sa.version_converter,tfjs:"1.7.4"}},9669:(e,t,n)=>{e.exports=n(1609)},5448:(e,t,n)=>{"use strict";var r=n(4867),i=n(6026),a=n(4372),o=n(5327),s=n(4097),u=n(4109),c=n(7985),l=n(5061);e.exports=function(e){return new Promise((function(t,n){var f=e.data,p=e.headers,h=e.responseType;r.isFormData(f)&&delete p["Content-Type"];var d=new XMLHttpRequest;if(e.auth){var m=e.auth.username||"",g=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";p.Authorization="Basic "+btoa(m+":"+g)}var v=s(e.baseURL,e.url);function y(){if(d){var r="getAllResponseHeaders"in d?u(d.getAllResponseHeaders()):null,a={data:h&&"text"!==h&&"json"!==h?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:r,config:e,request:d};i(t,n,a),d=null}}if(d.open(e.method.toUpperCase(),o(v,e.params,e.paramsSerializer),!0),d.timeout=e.timeout,"onloadend"in d?d.onloadend=y:d.onreadystatechange=function(){d&&4===d.readyState&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))&&setTimeout(y)},d.onabort=function(){d&&(n(l("Request aborted",e,"ECONNABORTED",d)),d=null)},d.onerror=function(){n(l("Network Error",e,null,d)),d=null},d.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(l(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",d)),d=null},r.isStandardBrowserEnv()){var b=(e.withCredentials||c(v))&&e.xsrfCookieName?a.read(e.xsrfCookieName):void 0;b&&(p[e.xsrfHeaderName]=b)}"setRequestHeader"in d&&r.forEach(p,(function(e,t){void 0===f&&"content-type"===t.toLowerCase()?delete p[t]:d.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(d.withCredentials=!!e.withCredentials),h&&"json"!==h&&(d.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&d.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){d&&(d.abort(),n(e),d=null)})),f||(f=null),d.send(f)}))}},1609:(e,t,n)=>{"use strict";var r=n(4867),i=n(1849),a=n(321),o=n(7185);function s(e){var t=new a(e),n=i(a.prototype.request,t);return r.extend(n,a.prototype,t),r.extend(n,t),n}var u=s(n(5655));u.Axios=a,u.create=function(e){return s(o(u.defaults,e))},u.Cancel=n(5263),u.CancelToken=n(4972),u.isCancel=n(6502),u.all=function(e){return Promise.all(e)},u.spread=n(8713),u.isAxiosError=n(6268),e.exports=u,e.exports.default=u},5263:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4972:(e,t,n)=>{"use strict";var r=n(5263);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},6502:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},321:(e,t,n)=>{"use strict";var r=n(4867),i=n(5327),a=n(782),o=n(3572),s=n(7185),u=n(4875),c=u.validators;function l(e){this.defaults=e,this.interceptors={request:new a,response:new a}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&u.assertOptions(t,{silentJSONParsing:c.transitional(c.boolean,"1.0.0"),forcedJSONParsing:c.transitional(c.boolean,"1.0.0"),clarifyTimeoutError:c.transitional(c.boolean,"1.0.0")},!1);var n=[],r=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(r=r&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var i,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!r){var l=[o,void 0];for(Array.prototype.unshift.apply(l,n),l=l.concat(a),i=Promise.resolve(e);l.length;)i=i.then(l.shift(),l.shift());return i}for(var f=e;n.length;){var p=n.shift(),h=n.shift();try{f=p(f)}catch(e){h(e);break}}try{i=o(f)}catch(e){return Promise.reject(e)}for(;a.length;)i=i.then(a.shift(),a.shift());return i},l.prototype.getUri=function(e){return e=s(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,r){return this.request(s(r||{},{method:e,url:t,data:n}))}})),e.exports=l},782:(e,t,n)=>{"use strict";var r=n(4867);function i(){this.handlers=[]}i.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},4097:(e,t,n)=>{"use strict";var r=n(1793),i=n(7303);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},5061:(e,t,n)=>{"use strict";var r=n(481);e.exports=function(e,t,n,i,a){var o=new Error(e);return r(o,t,n,i,a)}},3572:(e,t,n)=>{"use strict";var r=n(4867),i=n(8527),a=n(6502),o=n(5655);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return s(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return a(t)||(s(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},481:e=>{"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},7185:(e,t,n)=>{"use strict";var r=n(4867);e.exports=function(e,t){t=t||{};var n={},i=["url","method","data"],a=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function u(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function c(i){r.isUndefined(t[i])?r.isUndefined(e[i])||(n[i]=u(void 0,e[i])):n[i]=u(e[i],t[i])}r.forEach(i,(function(e){r.isUndefined(t[e])||(n[e]=u(void 0,t[e]))})),r.forEach(a,c),r.forEach(o,(function(i){r.isUndefined(t[i])?r.isUndefined(e[i])||(n[i]=u(void 0,e[i])):n[i]=u(void 0,t[i])})),r.forEach(s,(function(r){r in t?n[r]=u(e[r],t[r]):r in e&&(n[r]=u(void 0,e[r]))}));var l=i.concat(a).concat(o).concat(s),f=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===l.indexOf(e)}));return r.forEach(f,c),n}},6026:(e,t,n)=>{"use strict";var r=n(5061);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},8527:(e,t,n)=>{"use strict";var r=n(4867),i=n(5655);e.exports=function(e,t,n){var a=this||i;return r.forEach(n,(function(n){e=n.call(a,e,t)})),e}},5655:(e,t,n)=>{"use strict";var r=n(4867),i=n(6016),a=n(481),o={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var u,c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(u=n(5448)),u),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)||t&&"application/json"===t["Content-Type"]?(s(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(0,JSON.parse)(e),r.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,o=!n&&"json"===this.responseType;if(o||i&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw a(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){c.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){c.headers[e]=r.merge(o)})),e.exports=c},1849:e=>{"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},5327:(e,t,n)=>{"use strict";var r=n(4867);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var a;if(n)a=n(t);else if(r.isURLSearchParams(t))a=t.toString();else{var o=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),o.push(i(t)+"="+i(e))})))})),a=o.join("&")}if(a){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}},7303:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4372:(e,t,n)=>{"use strict";var r=n(4867);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,a,o){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(a)&&s.push("domain="+a),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},6268:e=>{"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},7985:(e,t,n)=>{"use strict";var r=n(4867);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},6016:(e,t,n)=>{"use strict";var r=n(4867);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},4109:(e,t,n)=>{"use strict";var r=n(4867),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,a,o={};return e?(r.forEach(e.split("\n"),(function(e){if(a=e.indexOf(":"),t=r.trim(e.substr(0,a)).toLowerCase(),n=r.trim(e.substr(a+1)),t){if(o[t]&&i.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o}},8713:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},4875:(e,t,n)=>{"use strict";var r=n(8593),i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var a={},o=r.version.split(".");function s(e,t){for(var n=t?t.split("."):o,r=e.split("."),i=0;i<3;i++){if(n[i]>r[i])return!0;if(n[i]<r[i])return!1}return!1}i.transitional=function(e,t,n){var i=t&&s(t);function o(e,t){return"[Axios v"+r.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,s){if(!1===e)throw new Error(o(r," has been removed in "+t));return i&&!a[r]&&(a[r]=!0,console.warn(o(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,s)}},e.exports={isOlderVersion:s,assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),i=r.length;i-- >0;){var a=r[i],o=t[a];if(o){var s=e[a],u=void 0===s||o(s,a,e);if(!0!==u)throw new TypeError("option "+a+" must be "+u)}else if(!0!==n)throw Error("Unknown option "+a)}},validators:i}},4867:(e,t,n)=>{"use strict";var r=n(1849),i=Object.prototype.toString;function a(e){return"[object Array]"===i.call(e)}function o(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function u(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===i.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),a(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isPlainObject:u,isUndefined:o,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function n(n,r){u(t[r])&&u(n)?t[r]=e(t[r],n):u(n)?t[r]=e({},n):a(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)l(arguments[r],n);return t},extend:function(e,t,n){return l(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},6313:e=>{var t=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(a,s,u,c,l){"object"==typeof s&&(u=s.depth,c=s.prototype,l=s.includeNonEnumerable,s=s.circular);var f=[],p=[],h="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===u&&(u=1/0),function a(u,d){if(null===u)return null;if(0===d)return u;var m,g;if("object"!=typeof u)return u;if(e(u,t))m=new t;else if(e(u,n))m=new n;else if(e(u,r))m=new r((function(e,t){u.then((function(t){e(a(t,d-1))}),(function(e){t(a(e,d-1))}))}));else if(i.__isArray(u))m=[];else if(i.__isRegExp(u))m=new RegExp(u.source,o(u)),u.lastIndex&&(m.lastIndex=u.lastIndex);else if(i.__isDate(u))m=new Date(u.getTime());else{if(h&&Buffer.isBuffer(u))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(m),m;e(u,Error)?m=Object.create(u):void 0===c?(g=Object.getPrototypeOf(u),m=Object.create(g)):(m=Object.create(c),g=c)}if(s){var v=f.indexOf(u);if(-1!=v)return p[v];f.push(u),p.push(m)}for(var y in e(u,t)&&u.forEach((function(e,t){var n=a(t,d-1),r=a(e,d-1);m.set(n,r)})),e(u,n)&&u.forEach((function(e){var t=a(e,d-1);m.add(t)})),u){var b;g&&(b=Object.getOwnPropertyDescriptor(g,y)),b&&null==b.set||(m[y]=a(u[y],d-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(u);for(y=0;y<x.length;y++){var w=x[y];(!(C=Object.getOwnPropertyDescriptor(u,w))||C.enumerable||l)&&(m[w]=a(u[w],d-1),C.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(l){var E=Object.getOwnPropertyNames(u);for(y=0;y<E.length;y++){var C,S=E[y];(C=Object.getOwnPropertyDescriptor(u,S))&&C.enumerable||(m[S]=a(u[S],d-1),Object.defineProperty(m,S,{enumerable:!1}))}}return m}(a,u)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=o,i}();e.exports&&(e.exports=t)},1977:function(e,t){var n;!function(r){"use strict";var i=function(e){return.5*(Math.exp(e)+Math.exp(-e))},a=function(e){return.5*(Math.exp(e)-Math.exp(-e))},o=function(){throw SyntaxError("Invalid Param")};function s(e,t){var n=Math.abs(e),r=Math.abs(t);return 0===e?Math.log(r):0===t?Math.log(n):n<3e3&&r<3e3?.5*Math.log(e*e+t*t):Math.log(e/Math.cos(Math.atan2(t,e)))}function u(e,t){if(!(this instanceof u))return new u(e,t);var n=function(e,t){var n={re:0,im:0};if(null==e)n.re=n.im=0;else if(void 0!==t)n.re=e,n.im=t;else switch(typeof e){case"object":if("im"in e&&"re"in e)n.re=e.re,n.im=e.im;else if("abs"in e&&"arg"in e){if(!Number.isFinite(e.abs)&&Number.isFinite(e.arg))return u.INFINITY;n.re=e.abs*Math.cos(e.arg),n.im=e.abs*Math.sin(e.arg)}else if("r"in e&&"phi"in e){if(!Number.isFinite(e.r)&&Number.isFinite(e.phi))return u.INFINITY;n.re=e.r*Math.cos(e.phi),n.im=e.r*Math.sin(e.phi)}else 2===e.length?(n.re=e[0],n.im=e[1]):o();break;case"string":n.im=n.re=0;var r=e.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),i=1,a=0;null===r&&o();for(var s=0;s<r.length;s++){var c=r[s];" "===c||"\t"===c||"\n"===c||("+"===c?i++:"-"===c?a++:"i"===c||"I"===c?(i+a===0&&o()," "===r[s+1]||isNaN(r[s+1])?n.im+=parseFloat((a%2?"-":"")+"1"):(n.im+=parseFloat((a%2?"-":"")+r[s+1]),s++),i=a=0):((i+a===0||isNaN(c))&&o(),"i"===r[s+1]||"I"===r[s+1]?(n.im+=parseFloat((a%2?"-":"")+c),s++):n.re+=parseFloat((a%2?"-":"")+c),i=a=0))}i+a>0&&o();break;case"number":n.im=0,n.re=e;break;default:o()}return isNaN(n.re)||isNaN(n.im),n}(e,t);this.re=n.re,this.im=n.im}u.prototype={re:0,im:0,sign:function(){var e=this.abs();return new u(this.re/e,this.im/e)},add:function(e,t){var n=new u(e,t);return this.isInfinite()&&n.isInfinite()?u.NAN:this.isInfinite()||n.isInfinite()?u.INFINITY:new u(this.re+n.re,this.im+n.im)},sub:function(e,t){var n=new u(e,t);return this.isInfinite()&&n.isInfinite()?u.NAN:this.isInfinite()||n.isInfinite()?u.INFINITY:new u(this.re-n.re,this.im-n.im)},mul:function(e,t){var n=new u(e,t);return this.isInfinite()&&n.isZero()||this.isZero()&&n.isInfinite()?u.NAN:this.isInfinite()||n.isInfinite()?u.INFINITY:0===n.im&&0===this.im?new u(this.re*n.re,0):new u(this.re*n.re-this.im*n.im,this.re*n.im+this.im*n.re)},div:function(e,t){var n=new u(e,t);if(this.isZero()&&n.isZero()||this.isInfinite()&&n.isInfinite())return u.NAN;if(this.isInfinite()||n.isZero())return u.INFINITY;if(this.isZero()||n.isInfinite())return u.ZERO;e=this.re,t=this.im;var r,i,a=n.re,o=n.im;return 0===o?new u(e/a,t/a):Math.abs(a)<Math.abs(o)?new u((e*(i=a/o)+t)/(r=a*i+o),(t*i-e)/r):new u((e+t*(i=o/a))/(r=o*i+a),(t-e*i)/r)},pow:function(e,t){var n=new u(e,t);if(e=this.re,t=this.im,n.isZero())return u.ONE;if(0===n.im){if(0===t&&e>0)return new u(Math.pow(e,n.re),0);if(0===e)switch((n.re%4+4)%4){case 0:return new u(Math.pow(t,n.re),0);case 1:return new u(0,Math.pow(t,n.re));case 2:return new u(-Math.pow(t,n.re),0);case 3:return new u(0,-Math.pow(t,n.re))}}if(0===e&&0===t&&n.re>0&&n.im>=0)return u.ZERO;var r=Math.atan2(t,e),i=s(e,t);return e=Math.exp(n.re*i-n.im*r),t=n.im*i+n.re*r,new u(e*Math.cos(t),e*Math.sin(t))},sqrt:function(){var e,t,n=this.re,r=this.im,i=this.abs();if(n>=0){if(0===r)return new u(Math.sqrt(n),0);e=.5*Math.sqrt(2*(i+n))}else e=Math.abs(r)/Math.sqrt(2*(i-n));return t=n<=0?.5*Math.sqrt(2*(i-n)):Math.abs(r)/Math.sqrt(2*(i+n)),new u(e,r<0?-t:t)},exp:function(){var e=Math.exp(this.re);return this.im,new u(e*Math.cos(this.im),e*Math.sin(this.im))},expm1:function(){var e=this.re,t=this.im;return new u(Math.expm1(e)*Math.cos(t)+function(e){var t=Math.PI/4;if(-t>e||e>t)return Math.cos(e)-1;var n=e*e;return n*(n*(n*(n*(n*(n*(n*(n/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-.5)}(t),Math.exp(e)*Math.sin(t))},log:function(){var e=this.re,t=this.im;return new u(s(e,t),Math.atan2(t,e))},abs:function(){return e=this.re,t=this.im,n=Math.abs(e),r=Math.abs(t),n<3e3&&r<3e3?Math.sqrt(n*n+r*r):(n<r?(n=r,r=e/t):r=t/e,n*Math.sqrt(1+r*r));var e,t,n,r},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var e=this.re,t=this.im;return new u(Math.sin(e)*i(t),Math.cos(e)*a(t))},cos:function(){var e=this.re,t=this.im;return new u(Math.cos(e)*i(t),-Math.sin(e)*a(t))},tan:function(){var e=2*this.re,t=2*this.im,n=Math.cos(e)+i(t);return new u(Math.sin(e)/n,a(t)/n)},cot:function(){var e=2*this.re,t=2*this.im,n=Math.cos(e)-i(t);return new u(-Math.sin(e)/n,a(t)/n)},sec:function(){var e=this.re,t=this.im,n=.5*i(2*t)+.5*Math.cos(2*e);return new u(Math.cos(e)*i(t)/n,Math.sin(e)*a(t)/n)},csc:function(){var e=this.re,t=this.im,n=.5*i(2*t)-.5*Math.cos(2*e);return new u(Math.sin(e)*i(t)/n,-Math.cos(e)*a(t)/n)},asin:function(){var e=this.re,t=this.im,n=new u(t*t-e*e+1,-2*e*t).sqrt(),r=new u(n.re-t,n.im+e).log();return new u(r.im,-r.re)},acos:function(){var e=this.re,t=this.im,n=new u(t*t-e*e+1,-2*e*t).sqrt(),r=new u(n.re-t,n.im+e).log();return new u(Math.PI/2-r.im,r.re)},atan:function(){var e=this.re,t=this.im;if(0===e){if(1===t)return new u(0,1/0);if(-1===t)return new u(0,-1/0)}var n=e*e+(1-t)*(1-t),r=new u((1-t*t-e*e)/n,-2*e/n).log();return new u(-.5*r.im,.5*r.re)},acot:function(){var e=this.re,t=this.im;if(0===t)return new u(Math.atan2(1,e),0);var n=e*e+t*t;return 0!==n?new u(e/n,-t/n).atan():new u(0!==e?e/0:0,0!==t?-t/0:0).atan()},asec:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new u(0,1/0);var n=e*e+t*t;return 0!==n?new u(e/n,-t/n).acos():new u(0!==e?e/0:0,0!==t?-t/0:0).acos()},acsc:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new u(Math.PI/2,1/0);var n=e*e+t*t;return 0!==n?new u(e/n,-t/n).asin():new u(0!==e?e/0:0,0!==t?-t/0:0).asin()},sinh:function(){var e=this.re,t=this.im;return new u(a(e)*Math.cos(t),i(e)*Math.sin(t))},cosh:function(){var e=this.re,t=this.im;return new u(i(e)*Math.cos(t),a(e)*Math.sin(t))},tanh:function(){var e=2*this.re,t=2*this.im,n=i(e)+Math.cos(t);return new u(a(e)/n,Math.sin(t)/n)},coth:function(){var e=2*this.re,t=2*this.im,n=i(e)-Math.cos(t);return new u(a(e)/n,-Math.sin(t)/n)},csch:function(){var e=this.re,t=this.im,n=Math.cos(2*t)-i(2*e);return new u(-2*a(e)*Math.cos(t)/n,2*i(e)*Math.sin(t)/n)},sech:function(){var e=this.re,t=this.im,n=Math.cos(2*t)+i(2*e);return new u(2*i(e)*Math.cos(t)/n,-2*a(e)*Math.sin(t)/n)},asinh:function(){var e=this.im;this.im=-this.re,this.re=e;var t=this.asin();return this.re=-this.im,this.im=e,e=t.re,t.re=-t.im,t.im=e,t},acosh:function(){var e=this.acos();if(e.im<=0){var t=e.re;e.re=-e.im,e.im=t}else t=e.im,e.im=-e.re,e.re=t;return e},atanh:function(){var e=this.re,t=this.im,n=e>1&&0===t,r=1-e,i=1+e,a=r*r+t*t,o=0!==a?new u((i*r-t*t)/a,(t*r+i*t)/a):new u(-1!==e?e/0:0,0!==t?t/0:0),c=o.re;return o.re=s(o.re,o.im)/2,o.im=Math.atan2(o.im,c)/2,n&&(o.im=-o.im),o},acoth:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new u(0,Math.PI/2);var n=e*e+t*t;return 0!==n?new u(e/n,-t/n).atanh():new u(0!==e?e/0:0,0!==t?-t/0:0).atanh()},acsch:function(){var e=this.re,t=this.im;if(0===t)return new u(0!==e?Math.log(e+Math.sqrt(e*e+1)):1/0,0);var n=e*e+t*t;return 0!==n?new u(e/n,-t/n).asinh():new u(0!==e?e/0:0,0!==t?-t/0:0).asinh()},asech:function(){var e=this.re,t=this.im;if(this.isZero())return u.INFINITY;var n=e*e+t*t;return 0!==n?new u(e/n,-t/n).acosh():new u(0!==e?e/0:0,0!==t?-t/0:0).acosh()},inverse:function(){if(this.isZero())return u.INFINITY;if(this.isInfinite())return u.ZERO;var e=this.re,t=this.im,n=e*e+t*t;return new u(e/n,-t/n)},conjugate:function(){return new u(this.re,-this.im)},neg:function(){return new u(-this.re,-this.im)},ceil:function(e){return e=Math.pow(10,e||0),new u(Math.ceil(this.re*e)/e,Math.ceil(this.im*e)/e)},floor:function(e){return e=Math.pow(10,e||0),new u(Math.floor(this.re*e)/e,Math.floor(this.im*e)/e)},round:function(e){return e=Math.pow(10,e||0),new u(Math.round(this.re*e)/e,Math.round(this.im*e)/e)},equals:function(e,t){var n=new u(e,t);return Math.abs(n.re-this.re)<=u.EPSILON&&Math.abs(n.im-this.im)<=u.EPSILON},clone:function(){return new u(this.re,this.im)},toString:function(){var e=this.re,t=this.im,n="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(e)<u.EPSILON&&(e=0),Math.abs(t)<u.EPSILON&&(t=0),0===t?n+e:(0!==e?(n+=e,n+=" ",t<0?(t=-t,n+="-"):n+="+",n+=" "):t<0&&(t=-t,n+="-"),1!==t&&(n+=t),n+"i"))},toVector:function(){return[this.re,this.im]},valueOf:function(){return 0===this.im?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return 0===this.im&&0===this.re},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return!(this.isNaN()||this.isFinite())}},u.ZERO=new u(0,0),u.ONE=new u(1,0),u.I=new u(0,1),u.PI=new u(Math.PI,0),u.E=new u(Math.E,0),u.INFINITY=new u(1/0,1/0),u.NAN=new u(NaN,NaN),u.EPSILON=1e-15,void 0===(n=function(){return u}.apply(t,[]))||(e.exports=n)}()},6238:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e)};var r,i=(r=n(5477))&&r.__esModule?r:{default:r};e.exports=t.default},638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"string"==typeof e&&n.test(e)};var n=/-webkit-|-moz-|-ms-/;e.exports=t.default},6722:(e,t,n)=>{"use strict";function r(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function i(e){return(e=r(Math.abs(e)))?e[1]:NaN}n.r(t),n.d(t,{format:()=>h,formatDefaultLocale:()=>v,formatLocale:()=>g,formatPrefix:()=>d,formatSpecifier:()=>s,precisionFixed:()=>y,precisionPrefix:()=>b,precisionRound:()=>x});var a,o=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function s(e){return new u(e)}function u(e){if(!(t=o.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}function c(e,t){var n=r(e,t);if(!n)return e+"";var i=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")}s.prototype=u.prototype,u.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const l={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return c(100*e,t)},r:c,s:function(e,t){var n=r(e,t);if(!n)return e+"";var i=n[0],o=n[1],s=o-(a=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,u=i.length;return s===u?i:s>u?i+new Array(s-u+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+r(e,Math.max(0,t+s-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function f(e){return e}var p,h,d,m=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function g(e){var t,n,r=e.grouping&&e.thousands?(t=e.grouping,n=e.thousands,function(e,r){for(var i=e.length,a=[],o=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}):f,o=e.currency,u=e.decimal,c=e.numerals?function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(e.numerals):f,p=e.percent||"%";function h(e){var t=(e=s(e)).fill,n=e.align,i=e.sign,f=e.symbol,h=e.zero,d=e.width,g=e.comma,v=e.precision,y=e.trim,b=e.type;"n"===b?(g=!0,b="g"):l[b]||(null==v&&(v=12),y=!0,b="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var x="$"===f?o[0]:"#"===f&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===f?o[1]:/[%p]/.test(b)?p:"",E=l[b],C=/[defgprs%]/.test(b);function S(e){var o,s,l,f=x,p=w;if("c"===b)p=E(e)+p,e="";else{var S=(e=+e)<0;if(e=E(Math.abs(e),v),y&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(i>0){if(!+e[r])break e;i=0}}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&(S=!1),f=(S?"("===i?i:"-":"-"===i||"("===i?"":i)+f,p=("s"===b?m[8+a/3]:"")+p+(S&&"("===i?")":""),C)for(o=-1,s=e.length;++o<s;)if(48>(l=e.charCodeAt(o))||l>57){p=(46===l?u+e.slice(o+1):e.slice(o))+p,e=e.slice(0,o);break}}g&&!h&&(e=r(e,1/0));var N=f.length+e.length+p.length,A=N<d?new Array(d-N+1).join(t):"";switch(g&&h&&(e=r(A+e,A.length?d-p.length:1/0),A=""),n){case"<":e=f+e+p+A;break;case"=":e=f+A+e+p;break;case"^":e=A.slice(0,N=A.length>>1)+f+e+p+A.slice(N);break;default:e=A+f+e+p}return c(e)}return v=null==v?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),S.toString=function(){return e+""},S}return{format:h,formatPrefix:function(e,t){var n=h(((e=s(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(i(t)/3))),a=Math.pow(10,-r),o=m[8+r/3];return function(e){return n(a*e)+o}}}}function v(e){return p=g(e),h=p.format,d=p.formatPrefix,p}function y(e){return Math.max(0,-i(Math.abs(e)))}function b(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(i(t)/3)))-i(Math.abs(e)))}function x(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,i(t)-i(e))+1}v({decimal:".",thousands:",",grouping:[3],currency:["$",""]})},4677:(e,t,n)=>{"use strict";n.r(t),n.d(t,{clientPoint:()=>Ce,create:()=>ye,creator:()=>u,customEvent:()=>ce,event:()=>re,local:()=>xe,matcher:()=>g,mouse:()=>Se,namespace:()=>a,namespaces:()=>i,select:()=>ve,selectAll:()=>Ne,selection:()=>ge,selector:()=>l,selectorAll:()=>p,style:()=>O,touch:()=>Ae,touches:()=>ke,window:()=>D});var r="http://www.w3.org/1999/xhtml";const i={svg:"http://www.w3.org/2000/svg",xhtml:r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function a(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),i.hasOwnProperty(t)?{space:i[t],local:e}:e}function o(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===r&&t.documentElement.namespaceURI===r?t.createElement(e):t.createElementNS(n,e)}}function s(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function u(e){var t=a(e);return(t.local?s:o)(t)}function c(){}function l(e){return null==e?c:function(){return this.querySelector(e)}}function f(){return[]}function p(e){return null==e?f:function(){return this.querySelectorAll(e)}}var h=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var d=document.documentElement;if(!d.matches){var m=d.webkitMatchesSelector||d.msMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector;h=function(e){return function(){return m.call(this,e)}}}}const g=h;function v(e){return new Array(e.length)}function y(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function b(e,t,n,r,i,a){for(var o,s=0,u=t.length,c=a.length;s<c;++s)(o=t[s])?(o.__data__=a[s],r[s]=o):n[s]=new y(e,a[s]);for(;s<u;++s)(o=t[s])&&(i[s]=o)}function x(e,t,n,r,i,a,o){var s,u,c,l={},f=t.length,p=a.length,h=new Array(f);for(s=0;s<f;++s)(u=t[s])&&(h[s]=c="$"+o.call(u,u.__data__,s,t),c in l?i[s]=u:l[c]=u);for(s=0;s<p;++s)(u=l[c="$"+o.call(e,a[s],s,a)])?(r[s]=u,u.__data__=a[s],l[c]=null):n[s]=new y(e,a[s]);for(s=0;s<f;++s)(u=t[s])&&l[h[s]]===u&&(i[s]=u)}function w(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function E(e){return function(){this.removeAttribute(e)}}function C(e){return function(){this.removeAttributeNS(e.space,e.local)}}function S(e,t){return function(){this.setAttribute(e,t)}}function N(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function A(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function k(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function D(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function _(e){return function(){this.style.removeProperty(e)}}function M(e,t,n){return function(){this.style.setProperty(e,t,n)}}function T(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function O(e,t){return e.style.getPropertyValue(t)||D(e).getComputedStyle(e,null).getPropertyValue(t)}function I(e){return function(){delete this[e]}}function F(e,t){return function(){this[e]=t}}function R(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function B(e){return e.trim().split(/^|\s+/)}function z(e){return e.classList||new P(e)}function P(e){this._node=e,this._names=B(e.getAttribute("class")||"")}function L(e,t){for(var n=z(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function j(e,t){for(var n=z(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function U(e){return function(){L(this,e)}}function q(e){return function(){j(this,e)}}function W(e,t){return function(){(t.apply(this,arguments)?L:j)(this,e)}}function V(){this.textContent=""}function $(e){return function(){this.textContent=e}}function H(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function G(){this.innerHTML=""}function K(e){return function(){this.innerHTML=e}}function X(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Y(){this.nextSibling&&this.parentNode.appendChild(this)}function J(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Z(){return null}function Q(){var e=this.parentNode;e&&e.removeChild(this)}function ee(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function te(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}y.prototype={constructor:y,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},P.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var ne={},re=null;function ie(e,t,n){return e=ae(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function ae(e,t,n){return function(r){var i=re;re=r;try{e.call(this,this.__data__,t,n)}finally{re=i}}}function oe(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function se(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?t.length=i:delete this.__on}}}function ue(e,t,n){var r=ne.hasOwnProperty(e.type)?ie:ae;return function(i,a,o){var s,u=this.__on,c=r(t,a,o);if(u)for(var l=0,f=u.length;l<f;++l)if((s=u[l]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=c,s.capture=n),void(s.value=t);this.addEventListener(e.type,c,n),s={type:e.type,name:e.name,value:t,listener:c,capture:n},u?u.push(s):this.__on=[s]}}function ce(e,t,n,r){var i=re;e.sourceEvent=re,re=e;try{return t.apply(n,r)}finally{re=i}}function le(e,t,n){var r=D(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function fe(e,t){return function(){return le(this,e,t)}}function pe(e,t){return function(){return le(this,e,t.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(ne={mouseenter:"mouseover",mouseleave:"mouseout"}));var he=[null];function de(e,t){this._groups=e,this._parents=t}function me(){return new de([[document.documentElement]],he)}de.prototype=me.prototype={constructor:de,select:function(e){"function"!=typeof e&&(e=l(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,s=t[i],u=s.length,c=r[i]=new Array(u),f=0;f<u;++f)(a=s[f])&&(o=e.call(a,a.__data__,f,s))&&("__data__"in a&&(o.__data__=a.__data__),c[f]=o);return new de(r,this._parents)},selectAll:function(e){"function"!=typeof e&&(e=p(e));for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,s=t[a],u=s.length,c=0;c<u;++c)(o=s[c])&&(r.push(e.call(o,o.__data__,c,s)),i.push(o));return new de(r,i)},filter:function(e){"function"!=typeof e&&(e=g(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,u=r[i]=[],c=0;c<s;++c)(a=o[c])&&e.call(a,a.__data__,c,o)&&u.push(a);return new de(r,this._parents)},data:function(e,t){if(!e)return d=new Array(this.size()),l=-1,this.each((function(e){d[++l]=e})),d;var n,r=t?x:b,i=this._parents,a=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var o=a.length,s=new Array(o),u=new Array(o),c=new Array(o),l=0;l<o;++l){var f=i[l],p=a[l],h=p.length,d=e.call(f,f&&f.__data__,l,i),m=d.length,g=u[l]=new Array(m),v=s[l]=new Array(m);r(f,p,g,v,c[l]=new Array(h),d,t);for(var y,w,E=0,C=0;E<m;++E)if(y=g[E]){for(E>=C&&(C=E+1);!(w=v[C])&&++C<m;);y._next=w||null}}return(s=new de(s,i))._enter=u,s._exit=c,s},enter:function(){return new de(this._enter||this._groups.map(v),this._parents)},exit:function(){return new de(this._exit||this._groups.map(v),this._parents)},merge:function(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u,c=t[s],l=n[s],f=c.length,p=o[s]=new Array(f),h=0;h<f;++h)(u=c[h]||l[h])&&(p[h]=u);for(;s<r;++s)o[s]=t[s];return new de(o,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&o!==r.nextSibling&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=w);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,s=n[a],u=s.length,c=i[a]=new Array(u),l=0;l<u;++l)(o=s[l])&&(c[l]=o);c.sort(t)}return new de(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=new Array(this.size()),t=-1;return this.each((function(){e[++t]=this})),e},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){var e=0;return this.each((function(){++e})),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,s=a.length;o<s;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},attr:function(e,t){var n=a(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?C:E:"function"==typeof t?n.local?k:A:n.local?N:S)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?_:"function"==typeof t?T:M)(e,t,null==n?"":n)):O(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?I:"function"==typeof t?R:F)(e,t)):this.node()[e]},classed:function(e,t){var n=B(e+"");if(arguments.length<2){for(var r=z(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?W:t?U:q)(n,t))},text:function(e){return arguments.length?this.each(null==e?V:("function"==typeof e?H:$)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?G:("function"==typeof e?X:K)(e)):this.node().innerHTML},raise:function(){return this.each(Y)},lower:function(){return this.each(J)},append:function(e){var t="function"==typeof e?e:u(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:u(e),r=null==t?Z:"function"==typeof t?t:l(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Q)},clone:function(e){return this.select(e?te:ee)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=oe(e+""),o=a.length;if(!(arguments.length<2)){for(s=t?ue:se,null==n&&(n=!1),r=0;r<o;++r)this.each(s(a[r],t,n));return this}var s=this.node().__on;if(s)for(var u,c=0,l=s.length;c<l;++c)for(r=0,u=s[c];r<o;++r)if((i=a[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?pe:fe)(e,t))}};const ge=me;function ve(e){return"string"==typeof e?new de([[document.querySelector(e)]],[document.documentElement]):new de([[e]],he)}function ye(e){return ve(u(e).call(document.documentElement))}var be=0;function xe(){return new we}function we(){this._="@"+(++be).toString(36)}function Ee(){for(var e,t=re;e=t.sourceEvent;)t=e;return t}function Ce(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function Se(e){var t=Ee();return t.changedTouches&&(t=t.changedTouches[0]),Ce(e,t)}function Ne(e){return"string"==typeof e?new de([document.querySelectorAll(e)],[document.documentElement]):new de([null==e?[]:e],he)}function Ae(e,t,n){arguments.length<3&&(n=t,t=Ee().changedTouches);for(var r,i=0,a=t?t.length:0;i<a;++i)if((r=t[i]).identifier===n)return Ce(e,r);return null}function ke(e,t){null==t&&(t=Ee().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=Ce(e,t[n]);return i}we.prototype=xe.prototype={constructor:we,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}}},3776:function(e,t,n){var r;!function(i){"use strict";var a,o,s,u=9e15,c=1e9,l="0123456789abcdef",f="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",p="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",h={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-u,maxE:u,crypto:!1},d=!0,m="[DecimalError] ",g=m+"Invalid argument: ",v=m+"Precision limit exceeded",y=m+"crypto unavailable",b="[object Decimal]",x=Math.floor,w=Math.pow,E=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,C=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,S=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,N=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,A=1e7,k=f.length-1,D=p.length-1,_={toStringTag:b};function M(e){var t,n,r,i=e.length-1,a="",o=e[0];if(i>0){for(a+=o,t=1;t<i;t++)(n=7-(r=e[t]+"").length)&&(a+=U(n)),a+=r;(n=7-(r=(o=e[t])+"").length)&&(a+=U(n))}else if(0===o)return"0";for(;o%10==0;)o/=10;return a+o}function T(e,t,n){if(e!==~~e||e<t||e>n)throw Error(g+e)}function O(e,t,n,r){var i,a,o,s;for(a=e[0];a>=10;a/=10)--t;return--t<0?(t+=7,i=0):(i=Math.ceil((t+1)/7),t%=7),a=w(10,7-t),s=e[i]%a|0,null==r?t<3?(0==t?s=s/100|0:1==t&&(s=s/10|0),o=n<4&&99999==s||n>3&&49999==s||5e4==s||0==s):o=(n<4&&s+1==a||n>3&&s+1==a/2)&&(e[i+1]/a/100|0)==w(10,t-2)-1||(s==a/2||0==s)&&0==(e[i+1]/a/100|0):t<4?(0==t?s=s/1e3|0:1==t?s=s/100|0:2==t&&(s=s/10|0),o=(r||n<4)&&9999==s||!r&&n>3&&4999==s):o=((r||n<4)&&s+1==a||!r&&n>3&&s+1==a/2)&&(e[i+1]/a/1e3|0)==w(10,t-3)-1,o}function I(e,t,n){for(var r,i,a=[0],o=0,s=e.length;o<s;){for(i=a.length;i--;)a[i]*=t;for(a[0]+=l.indexOf(e.charAt(o++)),r=0;r<a.length;r++)a[r]>n-1&&(void 0===a[r+1]&&(a[r+1]=0),a[r+1]+=a[r]/n|0,a[r]%=n)}return a.reverse()}_.absoluteValue=_.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),R(e)},_.ceil=function(){return R(new this.constructor(this),this.e+1,2)},_.clampedTo=_.clamp=function(e,t){var n=this,r=n.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(g+t);return n.cmp(e)<0?e:n.cmp(t)>0?t:new r(n)},_.comparedTo=_.cmp=function(e){var t,n,r,i,a=this,o=a.d,s=(e=new a.constructor(e)).d,u=a.s,c=e.s;if(!o||!s)return u&&c?u!==c?u:o===s?0:!o^u<0?1:-1:NaN;if(!o[0]||!s[0])return o[0]?u:s[0]?-c:0;if(u!==c)return u;if(a.e!==e.e)return a.e>e.e^u<0?1:-1;for(t=0,n=(r=o.length)<(i=s.length)?r:i;t<n;++t)if(o[t]!==s[t])return o[t]>s[t]^u<0?1:-1;return r===i?0:r>i^u<0?1:-1},_.cosine=_.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+7,r.rounding=1,n=function(e,t){var n,r,i;if(t.isZero())return t;(r=t.d.length)<32?i=(1/J(4,n=Math.ceil(r/3))).toString():(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=Y(e,1,t.times(i),new e(1));for(var a=n;a--;){var o=t.times(t);t=o.times(o).minus(o).times(8).plus(1)}return e.precision-=n,t}(r,Z(r,n)),r.precision=e,r.rounding=t,R(2==s||3==s?n.neg():n,e,t,!0)):new r(1):new r(NaN)},_.cubeRoot=_.cbrt=function(){var e,t,n,r,i,a,o,s,u,c,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(d=!1,(a=l.s*w(l.s*l,1/3))&&Math.abs(a)!=1/0?r=new f(a.toString()):(n=M(l.d),(a=((e=l.e)-n.length+1)%3)&&(n+=1==a||-2==a?"0":"00"),a=w(n,1/3),e=x((e+1)/3)-(e%3==(e<0?-1:2)),(r=new f(n=a==1/0?"5e"+e:(n=a.toExponential()).slice(0,n.indexOf("e")+1)+e)).s=l.s),o=(e=f.precision)+3;;)if(c=(u=(s=r).times(s).times(s)).plus(l),r=F(c.plus(l).times(s),c.plus(u),o+2,1),M(s.d).slice(0,o)===(n=M(r.d)).slice(0,o)){if("9999"!=(n=n.slice(o-3,o+1))&&(i||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(R(r,e+1,1),t=!r.times(r).times(r).eq(l));break}if(!i&&(R(s,e+1,0),s.times(s).times(s).eq(l))){r=s;break}o+=4,i=1}return d=!0,R(r,e,f.rounding,t)},_.decimalPlaces=_.dp=function(){var e,t=this.d,n=NaN;if(t){if(n=7*((e=t.length-1)-x(this.e/7)),e=t[e])for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n},_.dividedBy=_.div=function(e){return F(this,new this.constructor(e))},_.dividedToIntegerBy=_.divToInt=function(e){var t=this.constructor;return R(F(this,new t(e),0,1,1),t.precision,t.rounding)},_.equals=_.eq=function(e){return 0===this.cmp(e)},_.floor=function(){return R(new this.constructor(this),this.e+1,3)},_.greaterThan=_.gt=function(e){return this.cmp(e)>0},_.greaterThanOrEqualTo=_.gte=function(e){var t=this.cmp(e);return 1==t||0===t},_.hyperbolicCosine=_.cosh=function(){var e,t,n,r,i,a=this,o=a.constructor,s=new o(1);if(!a.isFinite())return new o(a.s?1/0:NaN);if(a.isZero())return s;n=o.precision,r=o.rounding,o.precision=n+Math.max(a.e,a.sd())+4,o.rounding=1,(i=a.d.length)<32?t=(1/J(4,e=Math.ceil(i/3))).toString():(e=16,t="2.3283064365386962890625e-10"),a=Y(o,1,a.times(t),new o(1),!0);for(var u,c=e,l=new o(8);c--;)u=a.times(a),a=s.minus(u.times(l.minus(u.times(l))));return R(a,o.precision=n,o.rounding=r,!0)},_.hyperbolicSine=_.sinh=function(){var e,t,n,r,i=this,a=i.constructor;if(!i.isFinite()||i.isZero())return new a(i);if(t=a.precision,n=a.rounding,a.precision=t+Math.max(i.e,i.sd())+4,a.rounding=1,(r=i.d.length)<3)i=Y(a,2,i,i,!0);else{e=(e=1.4*Math.sqrt(r))>16?16:0|e,i=Y(a,2,i=i.times(1/J(5,e)),i,!0);for(var o,s=new a(5),u=new a(16),c=new a(20);e--;)o=i.times(i),i=i.times(s.plus(o.times(u.times(o).plus(c))))}return a.precision=t,a.rounding=n,R(i,t,n,!0)},_.hyperbolicTangent=_.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,F(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)},_.inverseCosine=_.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,a=n.rounding;return-1!==r?0===r?t.isNeg()?L(n,i,a):new n(0):new n(NaN):t.isZero()?L(n,i+4,a).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=L(n,i+4,a).times(.5),n.precision=i,n.rounding=a,e.minus(t))},_.inverseHyperbolicCosine=_.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,d=!1,n=n.times(n).minus(1).sqrt().plus(n),d=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)},_.inverseHyperbolicSine=_.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,d=!1,n=n.times(n).plus(1).sqrt().plus(n),d=!0,r.precision=e,r.rounding=t,n.ln())},_.inverseHyperbolicTangent=_.atanh=function(){var e,t,n,r,i=this,a=i.constructor;return i.isFinite()?i.e>=0?new a(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=a.precision,t=a.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?R(new a(i),e,t,!0):(a.precision=n=r-i.e,i=F(i.plus(1),new a(1).minus(i),n+e,1),a.precision=e+4,a.rounding=1,i=i.ln(),a.precision=e,a.rounding=t,i.times(.5))):new a(NaN)},_.inverseSine=_.asin=function(){var e,t,n,r,i=this,a=i.constructor;return i.isZero()?new a(i):(t=i.abs().cmp(1),n=a.precision,r=a.rounding,-1!==t?0===t?((e=L(a,n+4,r).times(.5)).s=i.s,e):new a(NaN):(a.precision=n+6,a.rounding=1,i=i.div(new a(1).minus(i.times(i)).sqrt().plus(1)).atan(),a.precision=n,a.rounding=r,i.times(2)))},_.inverseTangent=_.atan=function(){var e,t,n,r,i,a,o,s,u,c=this,l=c.constructor,f=l.precision,p=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&f+4<=D)return(o=L(l,f+4,p).times(.25)).s=c.s,o}else{if(!c.s)return new l(NaN);if(f+4<=D)return(o=L(l,f+4,p).times(.5)).s=c.s,o}for(l.precision=s=f+10,l.rounding=1,e=n=Math.min(28,s/7+2|0);e;--e)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(d=!1,t=Math.ceil(s/7),r=1,u=c.times(c),o=new l(c),i=c;-1!==e;)if(i=i.times(u),a=o.minus(i.div(r+=2)),i=i.times(u),void 0!==(o=a.plus(i.div(r+=2))).d[t])for(e=t;o.d[e]===a.d[e]&&e--;);return n&&(o=o.times(2<<n-1)),d=!0,R(o,l.precision=f,l.rounding=p,!0)},_.isFinite=function(){return!!this.d},_.isInteger=_.isInt=function(){return!!this.d&&x(this.e/7)>this.d.length-2},_.isNaN=function(){return!this.s},_.isNegative=_.isNeg=function(){return this.s<0},_.isPositive=_.isPos=function(){return this.s>0},_.isZero=function(){return!!this.d&&0===this.d[0]},_.lessThan=_.lt=function(e){return this.cmp(e)<0},_.lessThanOrEqualTo=_.lte=function(e){return this.cmp(e)<1},_.logarithm=_.log=function(e){var t,n,r,i,a,o,s,u,c=this,l=c.constructor,f=l.precision,p=l.rounding;if(null==e)e=new l(10),t=!0;else{if(n=(e=new l(e)).d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=c.d,c.s<0||!n||!n[0]||c.eq(1))return new l(n&&!n[0]?-1/0:1!=c.s?NaN:n?0:1/0);if(t)if(n.length>1)a=!0;else{for(i=n[0];i%10==0;)i/=10;a=1!==i}if(d=!1,o=H(c,s=f+5),r=t?P(l,s+10):H(e,s),O((u=F(o,r,s,1)).d,i=f,p))do{if(o=H(c,s+=10),r=t?P(l,s+10):H(e,s),u=F(o,r,s,1),!a){+M(u.d).slice(i+1,i+15)+1==1e14&&(u=R(u,f+1,0));break}}while(O(u.d,i+=10,p));return d=!0,R(u,f,p)},_.minus=_.sub=function(e){var t,n,r,i,a,o,s,u,c,l,f,p,h=this,m=h.constructor;if(e=new m(e),!h.d||!e.d)return h.s&&e.s?h.d?e.s=-e.s:e=new m(e.d||h.s!==e.s?h:NaN):e=new m(NaN),e;if(h.s!=e.s)return e.s=-e.s,h.plus(e);if(c=h.d,p=e.d,s=m.precision,u=m.rounding,!c[0]||!p[0]){if(p[0])e.s=-e.s;else{if(!c[0])return new m(3===u?-0:0);e=new m(h)}return d?R(e,s,u):e}if(n=x(e.e/7),l=x(h.e/7),c=c.slice(),a=l-n){for((f=a<0)?(t=c,a=-a,o=p.length):(t=p,n=l,o=c.length),a>(r=Math.max(Math.ceil(s/7),o)+2)&&(a=r,t.length=1),t.reverse(),r=a;r--;)t.push(0);t.reverse()}else{for((f=(r=c.length)<(o=p.length))&&(o=r),r=0;r<o;r++)if(c[r]!=p[r]){f=c[r]<p[r];break}a=0}for(f&&(t=c,c=p,p=t,e.s=-e.s),o=c.length,r=p.length-o;r>0;--r)c[o++]=0;for(r=p.length;r>a;){if(c[--r]<p[r]){for(i=r;i&&0===c[--i];)c[i]=A-1;--c[i],c[r]+=A}c[r]-=p[r]}for(;0===c[--o];)c.pop();for(;0===c[0];c.shift())--n;return c[0]?(e.d=c,e.e=z(c,n),d?R(e,s,u):e):new m(3===u?-0:0)},_.modulo=_.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?R(new r(n),r.precision,r.rounding):(d=!1,9==r.modulo?(t=F(n,e.abs(),0,3,1)).s*=e.s:t=F(n,e,0,r.modulo,1),t=t.times(e),d=!0,n.minus(t))},_.naturalExponential=_.exp=function(){return $(this)},_.naturalLogarithm=_.ln=function(){return H(this)},_.negated=_.neg=function(){var e=new this.constructor(this);return e.s=-e.s,R(e)},_.plus=_.add=function(e){var t,n,r,i,a,o,s,u,c,l,f=this,p=f.constructor;if(e=new p(e),!f.d||!e.d)return f.s&&e.s?f.d||(e=new p(e.d||f.s===e.s?f:NaN)):e=new p(NaN),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(c=f.d,l=e.d,s=p.precision,u=p.rounding,!c[0]||!l[0])return l[0]||(e=new p(f)),d?R(e,s,u):e;if(a=x(f.e/7),r=x(e.e/7),c=c.slice(),i=a-r){for(i<0?(n=c,i=-i,o=l.length):(n=l,r=a,o=c.length),i>(o=(a=Math.ceil(s/7))>o?a+1:o+1)&&(i=o,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for((o=c.length)-(i=l.length)<0&&(i=o,n=l,l=c,c=n),t=0;i;)t=(c[--i]=c[i]+l[i]+t)/A|0,c[i]%=A;for(t&&(c.unshift(t),++r),o=c.length;0==c[--o];)c.pop();return e.d=c,e.e=z(c,r),d?R(e,s,u):e},_.precision=_.sd=function(e){var t,n=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(g+e);return n.d?(t=j(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t},_.round=function(){var e=this,t=e.constructor;return R(new t(e),e.e+1,t.rounding)},_.sine=_.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+7,r.rounding=1,n=function(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:Y(e,2,t,t);n=(n=1.4*Math.sqrt(r))>16?16:0|n,t=Y(e,2,t=t.times(1/J(5,n)),t);for(var i,a=new e(5),o=new e(16),s=new e(20);n--;)i=t.times(t),t=t.times(a.plus(i.times(o.times(i).minus(s))));return t}(r,Z(r,n)),r.precision=e,r.rounding=t,R(s>2?n.neg():n,e,t,!0)):new r(NaN)},_.squareRoot=_.sqrt=function(){var e,t,n,r,i,a,o=this,s=o.d,u=o.e,c=o.s,l=o.constructor;if(1!==c||!s||!s[0])return new l(!c||c<0&&(!s||s[0])?NaN:s?o:1/0);for(d=!1,0==(c=Math.sqrt(+o))||c==1/0?(((t=M(s)).length+u)%2==0&&(t+="0"),c=Math.sqrt(t),u=x((u+1)/2)-(u<0||u%2),r=new l(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):r=new l(c.toString()),n=(u=l.precision)+3;;)if(r=(a=r).plus(F(o,a,n+2,1)).times(.5),M(a.d).slice(0,n)===(t=M(r.d)).slice(0,n)){if("9999"!=(t=t.slice(n-3,n+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(R(r,u+1,1),e=!r.times(r).eq(o));break}if(!i&&(R(a,u+1,0),a.times(a).eq(o))){r=a;break}n+=4,i=1}return d=!0,R(r,u,l.rounding,e)},_.tangent=_.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,(n=n.sin()).s=1,n=F(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,R(2==s||4==s?n.neg():n,e,t,!0)):new r(NaN)},_.times=_.mul=function(e){var t,n,r,i,a,o,s,u,c,l=this,f=l.constructor,p=l.d,h=(e=new f(e)).d;if(e.s*=l.s,!(p&&p[0]&&h&&h[0]))return new f(!e.s||p&&!p[0]&&!h||h&&!h[0]&&!p?NaN:p&&h?0*e.s:e.s/0);for(n=x(l.e/7)+x(e.e/7),(u=p.length)<(c=h.length)&&(a=p,p=h,h=a,o=u,u=c,c=o),a=[],r=o=u+c;r--;)a.push(0);for(r=c;--r>=0;){for(t=0,i=u+r;i>r;)s=a[i]+h[r]*p[i-r-1]+t,a[i--]=s%A|0,t=s/A|0;a[i]=(a[i]+t)%A|0}for(;!a[--o];)a.pop();return t?++n:a.shift(),e.d=a,e.e=z(a,n),d?R(e,f.precision,f.rounding):e},_.toBinary=function(e,t){return Q(this,2,e,t)},_.toDecimalPlaces=_.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),void 0===e?n:(T(e,0,c),void 0===t?t=r.rounding:T(t,0,8),R(n,e+n.e+1,t))},_.toExponential=function(e,t){var n,r=this,i=r.constructor;return void 0===e?n=B(r,!0):(T(e,0,c),void 0===t?t=i.rounding:T(t,0,8),n=B(r=R(new i(r),e+1,t),!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n},_.toFixed=function(e,t){var n,r,i=this,a=i.constructor;return void 0===e?n=B(i):(T(e,0,c),void 0===t?t=a.rounding:T(t,0,8),n=B(r=R(new a(i),e+i.e+1,t),!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n},_.toFraction=function(e){var t,n,r,i,a,o,s,u,c,l,f,p,h=this,m=h.d,v=h.constructor;if(!m)return new v(h);if(c=n=new v(1),r=u=new v(0),o=(a=(t=new v(r)).e=j(m)-h.e-1)%7,t.d[0]=w(10,o<0?7+o:o),null==e)e=a>0?t:c;else{if(!(s=new v(e)).isInt()||s.lt(c))throw Error(g+s);e=s.gt(t)?a>0?t:c:s}for(d=!1,s=new v(M(m)),l=v.precision,v.precision=a=7*m.length*2;f=F(s,t,0,1,1),1!=(i=n.plus(f.times(r))).cmp(e);)n=r,r=i,i=c,c=u.plus(f.times(i)),u=i,i=t,t=s.minus(f.times(i)),s=i;return i=F(e.minus(n),r,0,1,1),u=u.plus(i.times(c)),n=n.plus(i.times(r)),u.s=c.s=h.s,p=F(c,r,a,1).minus(h).abs().cmp(F(u,n,a,1).minus(h).abs())<1?[c,r]:[u,n],v.precision=l,d=!0,p},_.toHexadecimal=_.toHex=function(e,t){return Q(this,16,e,t)},_.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),null==e){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),void 0===t?t=r.rounding:T(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(d=!1,n=F(n,e,0,t,1).times(e),d=!0,R(n)):(e.s=n.s,n=e),n},_.toNumber=function(){return+this},_.toOctal=function(e,t){return Q(this,8,e,t)},_.toPower=_.pow=function(e){var t,n,r,i,a,o,s=this,u=s.constructor,c=+(e=new u(e));if(!(s.d&&e.d&&s.d[0]&&e.d[0]))return new u(w(+s,c));if((s=new u(s)).eq(1))return s;if(r=u.precision,a=u.rounding,e.eq(1))return R(s,r,a);if((t=x(e.e/7))>=e.d.length-1&&(n=c<0?-c:c)<=9007199254740991)return i=q(u,s,n,r),e.s<0?new u(1).div(i):R(i,r,a);if((o=s.s)<0){if(t<e.d.length-1)return new u(NaN);if(0==(1&e.d[t])&&(o=1),0==s.e&&1==s.d[0]&&1==s.d.length)return s.s=o,s}return(t=0!=(n=w(+s,c))&&isFinite(n)?new u(n+"").e:x(c*(Math.log("0."+M(s.d))/Math.LN10+s.e+1)))>u.maxE+1||t<u.minE-1?new u(t>0?o/0:0):(d=!1,u.rounding=s.s=1,n=Math.min(12,(t+"").length),(i=$(e.times(H(s,r+n)),r)).d&&O((i=R(i,r+5,1)).d,r,a)&&(t=r+10,+M((i=R($(e.times(H(s,t+n)),t),t+5,1)).d).slice(r+1,r+15)+1==1e14&&(i=R(i,r+1,0))),i.s=o,d=!0,u.rounding=a,R(i,r,a))},_.toPrecision=function(e,t){var n,r=this,i=r.constructor;return void 0===e?n=B(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(T(e,1,c),void 0===t?t=i.rounding:T(t,0,8),n=B(r=R(new i(r),e,t),e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n},_.toSignificantDigits=_.toSD=function(e,t){var n=this.constructor;return void 0===e?(e=n.precision,t=n.rounding):(T(e,1,c),void 0===t?t=n.rounding:T(t,0,8)),R(new n(this),e,t)},_.toString=function(){var e=this,t=e.constructor,n=B(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n},_.truncated=_.trunc=function(){return R(new this.constructor(this),this.e+1,1)},_.valueOf=_.toJSON=function(){var e=this,t=e.constructor,n=B(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};var F=function(){function e(e,t,n){var r,i=0,a=e.length;for(e=e.slice();a--;)r=e[a]*t+i,e[a]=r%n|0,i=r/n|0;return i&&e.unshift(i),e}function t(e,t,n,r){var i,a;if(n!=r)a=n>r?1:-1;else for(i=a=0;i<n;i++)if(e[i]!=t[i]){a=e[i]>t[i]?1:-1;break}return a}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=e[n]<t[n]?1:0,e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(r,i,a,s,u,c){var l,f,p,h,d,m,g,v,y,b,w,E,C,S,N,k,D,_,M,T,O=r.constructor,I=r.s==i.s?1:-1,F=r.d,B=i.d;if(!(F&&F[0]&&B&&B[0]))return new O(r.s&&i.s&&(F?!B||F[0]!=B[0]:B)?F&&0==F[0]||!B?0*I:I/0:NaN);for(c?(d=1,f=r.e-i.e):(c=A,d=7,f=x(r.e/d)-x(i.e/d)),M=B.length,D=F.length,b=(y=new O(I)).d=[],p=0;B[p]==(F[p]||0);p++);if(B[p]>(F[p]||0)&&f--,null==a?(S=a=O.precision,s=O.rounding):S=u?a+(r.e-i.e)+1:a,S<0)b.push(1),m=!0;else{if(S=S/d+2|0,p=0,1==M){for(h=0,B=B[0],S++;(p<D||h)&&S--;p++)N=h*c+(F[p]||0),b[p]=N/B|0,h=N%B|0;m=h||p<D}else{for((h=c/(B[0]+1)|0)>1&&(B=e(B,h,c),F=e(F,h,c),M=B.length,D=F.length),k=M,E=(w=F.slice(0,M)).length;E<M;)w[E++]=0;(T=B.slice()).unshift(0),_=B[0],B[1]>=c/2&&++_;do{h=0,(l=t(B,w,M,E))<0?(C=w[0],M!=E&&(C=C*c+(w[1]||0)),(h=C/_|0)>1?(h>=c&&(h=c-1),1==(l=t(g=e(B,h,c),w,v=g.length,E=w.length))&&(h--,n(g,M<v?T:B,v,c))):(0==h&&(l=h=1),g=B.slice()),(v=g.length)<E&&g.unshift(0),n(w,g,E,c),-1==l&&(l=t(B,w,M,E=w.length))<1&&(h++,n(w,M<E?T:B,E,c)),E=w.length):0===l&&(h++,w=[0]),b[p++]=h,l&&w[0]?w[E++]=F[k]||0:(w=[F[k]],E=1)}while((k++<D||void 0!==w[0])&&S--);m=void 0!==w[0]}b[0]||b.shift()}if(1==d)y.e=f,o=m;else{for(p=1,h=b[0];h>=10;h/=10)p++;y.e=p+f*d-1,R(y,u?a+y.e+1:a,s,m)}return y}}();function R(e,t,n,r){var i,a,o,s,u,c,l,f,p,h=e.constructor;e:if(null!=t){if(!(f=e.d))return e;for(i=1,s=f[0];s>=10;s/=10)i++;if((a=t-i)<0)a+=7,o=t,u=(l=f[p=0])/w(10,i-o-1)%10|0;else if((p=Math.ceil((a+1)/7))>=(s=f.length)){if(!r)break e;for(;s++<=p;)f.push(0);l=u=0,i=1,o=(a%=7)-7+1}else{for(l=s=f[p],i=1;s>=10;s/=10)i++;u=(o=(a%=7)-7+i)<0?0:l/w(10,i-o-1)%10|0}if(r=r||t<0||void 0!==f[p+1]||(o<0?l:l%w(10,i-o-1)),c=n<4?(u||r)&&(0==n||n==(e.s<0?3:2)):u>5||5==u&&(4==n||r||6==n&&(a>0?o>0?l/w(10,i-o):0:f[p-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,c?(t-=e.e+1,f[0]=w(10,(7-t%7)%7),e.e=-t||0):f[0]=e.e=0,e;if(0==a?(f.length=p,s=1,p--):(f.length=p+1,s=w(10,7-a),f[p]=o>0?(l/w(10,i-o)%w(10,o)|0)*s:0),c)for(;;){if(0==p){for(a=1,o=f[0];o>=10;o/=10)a++;for(o=f[0]+=s,s=1;o>=10;o/=10)s++;a!=s&&(e.e++,f[0]==A&&(f[0]=1));break}if(f[p]+=s,f[p]!=A)break;f[p--]=0,s=1}for(a=f.length;0===f[--a];)f.pop()}return d&&(e.e>h.maxE?(e.d=null,e.e=NaN):e.e<h.minE&&(e.e=0,e.d=[0])),e}function B(e,t,n){if(!e.isFinite())return G(e);var r,i=e.e,a=M(e.d),o=a.length;return t?(n&&(r=n-o)>0?a=a.charAt(0)+"."+a.slice(1)+U(r):o>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(e.e<0?"e":"e+")+e.e):i<0?(a="0."+U(-i-1)+a,n&&(r=n-o)>0&&(a+=U(r))):i>=o?(a+=U(i+1-o),n&&(r=n-i-1)>0&&(a=a+"."+U(r))):((r=i+1)<o&&(a=a.slice(0,r)+"."+a.slice(r)),n&&(r=n-o)>0&&(i+1===o&&(a+="."),a+=U(r))),a}function z(e,t){var n=e[0];for(t*=7;n>=10;n/=10)t++;return t}function P(e,t,n){if(t>k)throw d=!0,n&&(e.precision=n),Error(v);return R(new e(f),t,1,!0)}function L(e,t,n){if(t>D)throw Error(v);return R(new e(p),t,n,!0)}function j(e){var t=e.length-1,n=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function U(e){for(var t="";e--;)t+="0";return t}function q(e,t,n,r){var i,a=new e(1),o=Math.ceil(r/7+4);for(d=!1;;){if(n%2&&ee((a=a.times(t)).d,o)&&(i=!0),0===(n=x(n/2))){n=a.d.length-1,i&&0===a.d[n]&&++a.d[n];break}ee((t=t.times(t)).d,o)}return d=!0,a}function W(e){return 1&e.d[e.d.length-1]}function V(e,t,n){for(var r,i=new e(t[0]),a=0;++a<t.length;){if(!(r=new e(t[a])).s){i=r;break}i[n](r)&&(i=r)}return i}function $(e,t){var n,r,i,a,o,s,u,c=0,l=0,f=0,p=e.constructor,h=p.rounding,m=p.precision;if(!e.d||!e.d[0]||e.e>17)return new p(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(d=!1,u=m):u=t,s=new p(.03125);e.e>-2;)e=e.times(s),f+=5;for(u+=r=Math.log(w(2,f))/Math.LN10*2+5|0,n=a=o=new p(1),p.precision=u;;){if(a=R(a.times(e),u,1),n=n.times(++l),M((s=o.plus(F(a,n,u,1))).d).slice(0,u)===M(o.d).slice(0,u)){for(i=f;i--;)o=R(o.times(o),u,1);if(null!=t)return p.precision=m,o;if(!(c<3&&O(o.d,u-r,h,c)))return R(o,p.precision=m,h,d=!0);p.precision=u+=10,n=a=s=new p(1),l=0,c++}o=s}}function H(e,t){var n,r,i,a,o,s,u,c,l,f,p,h=1,m=e,g=m.d,v=m.constructor,y=v.rounding,b=v.precision;if(m.s<0||!g||!g[0]||!m.e&&1==g[0]&&1==g.length)return new v(g&&!g[0]?-1/0:1!=m.s?NaN:g?0:m);if(null==t?(d=!1,l=b):l=t,v.precision=l+=10,r=(n=M(g)).charAt(0),!(Math.abs(a=m.e)<15e14))return c=P(v,l+2,b).times(a+""),m=H(new v(r+"."+n.slice(1)),l-10).plus(c),v.precision=b,null==t?R(m,b,y,d=!0):m;for(;r<7&&1!=r||1==r&&n.charAt(1)>3;)r=(n=M((m=m.times(e)).d)).charAt(0),h++;for(a=m.e,r>1?(m=new v("0."+n),a++):m=new v(r+"."+n.slice(1)),f=m,u=o=m=F(m.minus(1),m.plus(1),l,1),p=R(m.times(m),l,1),i=3;;){if(o=R(o.times(p),l,1),M((c=u.plus(F(o,new v(i),l,1))).d).slice(0,l)===M(u.d).slice(0,l)){if(u=u.times(2),0!==a&&(u=u.plus(P(v,l+2,b).times(a+""))),u=F(u,new v(h),l,1),null!=t)return v.precision=b,u;if(!O(u.d,l-10,y,s))return R(u,v.precision=b,y,d=!0);v.precision=l+=10,c=o=m=F(f.minus(1),f.plus(1),l,1),p=R(m.times(m),l,1),i=s=1}u=c,i+=2}}function G(e){return String(e.s*e.s/0)}function K(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;48===t.charCodeAt(r);r++);for(i=t.length;48===t.charCodeAt(i-1);--i);if(t=t.slice(r,i)){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%7,n<0&&(r+=7),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=7;r<i;)e.d.push(+t.slice(r,r+=7));r=7-(t=t.slice(r)).length}else r-=i;for(;r--;)t+="0";e.d.push(+t),d&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function X(e,t){var n,r,i,o,s,u,c,l,f;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),N.test(t))return K(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(C.test(t))n=16,t=t.toLowerCase();else if(E.test(t))n=2;else{if(!S.test(t))throw Error(g+t);n=8}for((o=t.search(/p/i))>0?(c=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),s=(o=t.indexOf("."))>=0,r=e.constructor,s&&(o=(u=(t=t.replace(".","")).length)-o,i=q(r,new r(n),o,2*o)),o=f=(l=I(t,n,A)).length-1;0===l[o];--o)l.pop();return o<0?new r(0*e.s):(e.e=z(l,f),e.d=l,d=!1,s&&(e=F(e,i,4*u)),c&&(e=e.times(Math.abs(c)<54?w(2,c):a.pow(2,c))),d=!0,e)}function Y(e,t,n,r,i){var a,o,s,u,c=e.precision,l=Math.ceil(c/7);for(d=!1,u=n.times(n),s=new e(r);;){if(o=F(s.times(u),new e(t++*t++),c,1),s=i?r.plus(o):r.minus(o),r=F(o.times(u),new e(t++*t++),c,1),void 0!==(o=s.plus(r)).d[l]){for(a=l;o.d[a]===s.d[a]&&a--;);if(-1==a)break}a=s,s=r,r=o,o=a}return d=!0,o.d.length=l+1,o}function J(e,t){for(var n=e;--t;)n*=e;return n}function Z(e,t){var n,r=t.s<0,i=L(e,e.precision,1),a=i.times(.5);if((t=t.abs()).lte(a))return s=r?4:1,t;if((n=t.divToInt(i)).isZero())s=r?3:2;else{if((t=t.minus(n.times(i))).lte(a))return s=W(n)?r?2:3:r?4:1,t;s=W(n)?r?1:4:r?3:2}return t.minus(i).abs()}function Q(e,t,n,r){var i,a,s,u,f,p,h,d,m,g=e.constructor,v=void 0!==n;if(v?(T(n,1,c),void 0===r?r=g.rounding:T(r,0,8)):(n=g.precision,r=g.rounding),e.isFinite()){for(v?(i=2,16==t?n=4*n-3:8==t&&(n=3*n-2)):i=t,(s=(h=B(e)).indexOf("."))>=0&&(h=h.replace(".",""),(m=new g(1)).e=h.length-s,m.d=I(B(m),10,i),m.e=m.d.length),a=f=(d=I(h,10,i)).length;0==d[--f];)d.pop();if(d[0]){if(s<0?a--:((e=new g(e)).d=d,e.e=a,d=(e=F(e,m,n,r,0,i)).d,a=e.e,p=o),s=d[n],u=i/2,p=p||void 0!==d[n+1],p=r<4?(void 0!==s||p)&&(0===r||r===(e.s<0?3:2)):s>u||s===u&&(4===r||p||6===r&&1&d[n-1]||r===(e.s<0?8:7)),d.length=n,p)for(;++d[--n]>i-1;)d[n]=0,n||(++a,d.unshift(1));for(f=d.length;!d[f-1];--f);for(s=0,h="";s<f;s++)h+=l.charAt(d[s]);if(v){if(f>1)if(16==t||8==t){for(s=16==t?4:3,--f;f%s;f++)h+="0";for(f=(d=I(h,i,t)).length;!d[f-1];--f);for(s=1,h="1.";s<f;s++)h+=l.charAt(d[s])}else h=h.charAt(0)+"."+h.slice(1);h=h+(a<0?"p":"p+")+a}else if(a<0){for(;++a;)h="0"+h;h="0."+h}else if(++a>f)for(a-=f;a--;)h+="0";else a<f&&(h=h.slice(0,a)+"."+h.slice(a))}else h=v?"0p+0":"0";h=(16==t?"0x":2==t?"0b":8==t?"0o":"")+h}else h=G(e);return e.s<0?"-"+h:h}function ee(e,t){if(e.length>t)return e.length=t,!0}function te(e){return new this(e).abs()}function ne(e){return new this(e).acos()}function re(e){return new this(e).acosh()}function ie(e,t){return new this(e).plus(t)}function ae(e){return new this(e).asin()}function oe(e){return new this(e).asinh()}function se(e){return new this(e).atan()}function ue(e){return new this(e).atanh()}function ce(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,a=r+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(n=t.s<0?L(this,r,i):new this(0)).s=e.s:!e.d||t.isZero()?(n=L(this,a,1).times(.5)).s=e.s:t.s<0?(this.precision=a,this.rounding=1,n=this.atan(F(e,t,a,1)),t=L(this,a,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(F(e,t,a,1)):(n=L(this,a,1).times(t.s>0?.25:.75)).s=e.s:n=new this(NaN),n}function le(e){return new this(e).cbrt()}function fe(e){return R(e=new this(e),e.e+1,2)}function pe(e,t,n){return new this(e).clamp(t,n)}function he(e){if(!e||"object"!=typeof e)throw Error(m+"Object expected");var t,n,r,i=!0===e.defaults,a=["precision",1,c,"rounding",0,8,"toExpNeg",-u,0,"toExpPos",0,u,"maxE",0,u,"minE",-u,0,"modulo",0,9];for(t=0;t<a.length;t+=3)if(n=a[t],i&&(this[n]=h[n]),void 0!==(r=e[n])){if(!(x(r)===r&&r>=a[t+1]&&r<=a[t+2]))throw Error(g+n+": "+r);this[n]=r}if(n="crypto",i&&(this[n]=h[n]),void 0!==(r=e[n])){if(!0!==r&&!1!==r&&0!==r&&1!==r)throw Error(g+n+": "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(y);this[n]=!0}else this[n]=!1}return this}function de(e){return new this(e).cos()}function me(e){return new this(e).cosh()}function ge(e,t){return new this(e).div(t)}function ve(e){return new this(e).exp()}function ye(e){return R(e=new this(e),e.e+1,3)}function be(){var e,t,n=new this(0);for(d=!1,e=0;e<arguments.length;)if((t=new this(arguments[e++])).d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return d=!0,new this(1/0);n=t}return d=!0,n.sqrt()}function xe(e){return e instanceof a||e&&e.toStringTag===b||!1}function we(e){return new this(e).ln()}function Ee(e,t){return new this(e).log(t)}function Ce(e){return new this(e).log(2)}function Se(e){return new this(e).log(10)}function Ne(){return V(this,arguments,"lt")}function Ae(){return V(this,arguments,"gt")}function ke(e,t){return new this(e).mod(t)}function De(e,t){return new this(e).mul(t)}function _e(e,t){return new this(e).pow(t)}function Me(e){var t,n,r,i,a=0,o=new this(1),s=[];if(void 0===e?e=this.precision:T(e,1,c),r=Math.ceil(e/7),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));a<r;)(i=t[a])>=429e7?t[a]=crypto.getRandomValues(new Uint32Array(1))[0]:s[a++]=i%1e7;else{if(!crypto.randomBytes)throw Error(y);for(t=crypto.randomBytes(r*=4);a<r;)(i=t[a]+(t[a+1]<<8)+(t[a+2]<<16)+((127&t[a+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,a):(s.push(i%1e7),a+=4);a=r/4}else for(;a<r;)s[a++]=1e7*Math.random()|0;for(e%=7,(r=s[--a])&&e&&(i=w(10,7-e),s[a]=(r/i|0)*i);0===s[a];a--)s.pop();if(a<0)n=0,s=[0];else{for(n=-1;0===s[0];n-=7)s.shift();for(r=1,i=s[0];i>=10;i/=10)r++;r<7&&(n-=7-r)}return o.e=n,o.d=s,o}function Te(e){return R(e=new this(e),e.e+1,this.rounding)}function Oe(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function Ie(e){return new this(e).sin()}function Fe(e){return new this(e).sinh()}function Re(e){return new this(e).sqrt()}function Be(e,t){return new this(e).sub(t)}function ze(){var e=0,t=arguments,n=new this(t[e]);for(d=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return d=!0,R(n,this.precision,this.rounding)}function Pe(e){return new this(e).tan()}function Le(e){return new this(e).tanh()}function je(e){return R(e=new this(e),e.e+1,1)}(a=function e(t){var n,r,i;function a(e){var t,n,r,i=this;if(!(i instanceof a))return new a(e);if(i.constructor=a,xe(e))return i.s=e.s,void(d?!e.d||e.e>a.maxE?(i.e=NaN,i.d=null):e.e<a.minE?(i.e=0,i.d=[0]):(i.e=e.e,i.d=e.d.slice()):(i.e=e.e,i.d=e.d?e.d.slice():e.d));if("number"==(r=typeof e)){if(0===e)return i.s=1/e<0?-1:1,i.e=0,void(i.d=[0]);if(e<0?(e=-e,i.s=-1):i.s=1,e===~~e&&e<1e7){for(t=0,n=e;n>=10;n/=10)t++;return void(d?t>a.maxE?(i.e=NaN,i.d=null):t<a.minE?(i.e=0,i.d=[0]):(i.e=t,i.d=[e]):(i.e=t,i.d=[e]))}return 0*e!=0?(e||(i.s=NaN),i.e=NaN,void(i.d=null)):K(i,e.toString())}if("string"!==r)throw Error(g+e);return 45===(n=e.charCodeAt(0))?(e=e.slice(1),i.s=-1):(43===n&&(e=e.slice(1)),i.s=1),N.test(e)?K(i,e):X(i,e)}if(a.prototype=_,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.EUCLID=9,a.config=a.set=he,a.clone=e,a.isDecimal=xe,a.abs=te,a.acos=ne,a.acosh=re,a.add=ie,a.asin=ae,a.asinh=oe,a.atan=se,a.atanh=ue,a.atan2=ce,a.cbrt=le,a.ceil=fe,a.clamp=pe,a.cos=de,a.cosh=me,a.div=ge,a.exp=ve,a.floor=ye,a.hypot=be,a.ln=we,a.log=Ee,a.log10=Se,a.log2=Ce,a.max=Ne,a.min=Ae,a.mod=ke,a.mul=De,a.pow=_e,a.random=Me,a.round=Te,a.sign=Oe,a.sin=Ie,a.sinh=Fe,a.sqrt=Re,a.sub=Be,a.sum=ze,a.tan=Pe,a.tanh=Le,a.trunc=je,void 0===t&&(t={}),t&&!0!==t.defaults)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<i.length;)t.hasOwnProperty(r=i[n++])||(t[r]=this[r]);return a.config(t),a}(h)).prototype.constructor=a,a.default=a.Decimal=a,f=new a(f),p=new a(p),void 0===(r=function(){return a}.call(t,n,t,e))||(e.exports=r)}()},7928:e=>{"use strict";var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},r={"":"\\--","":"\\---"," ":"~","\t":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},i=function(e,n){return t({},e,n)};e.exports=function(e){for(var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=a.preserveFormatting,s=void 0!==o&&o,u=a.escapeMapFn,c=void 0===u?i:u,l=String(e),f="",p=c(t({},n),s?t({},r):{}),h=Object.keys(p),d=function(){var e=!1;h.forEach((function(t,n){e||l.length>=t.length&&l.slice(0,t.length)===t&&(f+=p[h[n]],l=l.slice(t.length,l.length),e=!0)})),e||(f+=l.slice(0,1),l=l.slice(1,l.length))};l;)d();return f}},7187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,a),r(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}m(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,a,o,c;if(s(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,c=l,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):d(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(a){r.once&&e.removeEventListener(t,i),n(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var u=a[e];if(void 0===u)return!1;if("function"==typeof u)r(u,this,t);else{var c=u.length,l=d(u,c);for(n=0;n<c;++n)r(l[n],this,t)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){return s(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,a,o;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},4063:e=>{"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n}},5035:e=>{"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=a.push(t)-1,u=Object.keys(t).sort(i&&i(t));for(o="",n=0;n<u.length;n++){var c=u[n],l=e(t[c]);l&&(o&&(o+=","),o+=JSON.stringify(c)+":"+l)}return a.splice(s,1),"{"+o+"}"}}(e)}},2297:e=>{"use strict";var t=/-(.)/g;e.exports=function(e){return e.replace(t,(function(e,t){return t.toUpperCase()}))}},250:(e,t,n)=>{"use strict";var r=n(2297),i=/^-ms-/;e.exports=function(e){return r(e.replace(i,"ms-"))}},139:e=>{"use strict";function t(e){return function(){return e}}var n=function(){};n.thatReturns=t,n.thatReturnsFalse=t(!1),n.thatReturnsTrue=t(!0),n.thatReturnsNull=t(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(e){return e},e.exports=n},9349:e=>{"use strict";var t=/([A-Z])/g;e.exports=function(e){return e.replace(t,"-$1").toLowerCase()}},7100:(e,t,n)=>{"use strict";var r=n(9349),i=/^ms-/;e.exports=function(e){return r(e).replace(i,"-ms-")}},1767:e=>{"use strict";e.exports=function(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}},3620:(e,t,n)=>{"use strict";var r=n(139);e.exports=r},5628:function(e,t){var n;!function(r){"use strict";var i={s:1,n:0,d:1};function a(e){function t(){var t=Error.apply(this,arguments);t.name=this.name=e,this.stack=t.stack,this.message=t.message}function n(){}return n.prototype=Error.prototype,t.prototype=new n,t}var o=h.DivisionByZero=a("DivisionByZero"),s=h.InvalidParameter=a("InvalidParameter");function u(e,t){return isNaN(e=parseInt(e,10))&&c(),e*t}function c(){throw new s}function l(e){for(var t={},n=e,r=2,i=4;i<=n;){for(;n%r==0;)n/=r,t[r]=(t[r]||0)+1;i+=1+2*r++}return n!==e?n>1&&(t[n]=(t[n]||0)+1):t[e]=(t[e]||0)+1,t}var f=function(e,t){var n,r=0,a=1,s=1,l=0,f=0,p=0,h=1,d=1,m=0,g=1,v=1,y=1,b=1e7;if(null==e);else if(void 0!==t)s=(r=e)*(a=t);else switch(typeof e){case"object":"d"in e&&"n"in e?(r=e.n,a=e.d,"s"in e&&(r*=e.s)):0 in e?(r=e[0],1 in e&&(a=e[1])):c(),s=r*a;break;case"number":if(e<0&&(s=e,e=-e),e%1==0)r=e;else if(e>0){for(e>=1&&(e/=d=Math.pow(10,Math.floor(1+Math.log(e)/Math.LN10)));g<=b&&y<=b;){if(e===(n=(m+v)/(g+y))){g+y<=b?(r=m+v,a=g+y):y>g?(r=v,a=y):(r=m,a=g);break}e>n?(m+=v,g+=y):(v+=m,y+=g),g>b?(r=v,a=y):(r=m,a=g)}r*=d}else(isNaN(e)||isNaN(t))&&(a=r=NaN);break;case"string":if(null===(g=e.match(/\d+|./g))&&c(),"-"===g[m]?(s=-1,m++):"+"===g[m]&&m++,g.length===m+1?f=u(g[m++],s):"."===g[m+1]||"."===g[m]?("."!==g[m]&&(l=u(g[m++],s)),(1+ ++m===g.length||"("===g[m+1]&&")"===g[m+3]||"'"===g[m+1]&&"'"===g[m+3])&&(f=u(g[m],s),h=Math.pow(10,g[m].length),m++),("("===g[m]&&")"===g[m+2]||"'"===g[m]&&"'"===g[m+2])&&(p=u(g[m+1],s),d=Math.pow(10,g[m+1].length)-1,m+=3)):"/"===g[m+1]||":"===g[m+1]?(f=u(g[m],s),h=u(g[m+2],1),m+=3):"/"===g[m+3]&&" "===g[m+1]&&(l=u(g[m],s),f=u(g[m+2],s),h=u(g[m+4],1),m+=5),g.length<=m){s=r=p+(a=h*d)*l+d*f;break}default:c()}if(0===a)throw new o;i.s=s<0?-1:1,i.n=Math.abs(r),i.d=Math.abs(a)};function p(e,t){if(!e)return t;if(!t)return e;for(;;){if(!(e%=t))return t;if(!(t%=e))return e}}function h(e,t){if(!(this instanceof h))return new h(e,t);f(e,t),e=p(i.d,i.n),this.s=i.s,this.n=i.n/e,this.d=i.d/e}h.prototype={s:1,n:0,d:1,abs:function(){return new h(this.n,this.d)},neg:function(){return new h(-this.s*this.n,this.d)},add:function(e,t){return f(e,t),new h(this.s*this.n*i.d+i.s*this.d*i.n,this.d*i.d)},sub:function(e,t){return f(e,t),new h(this.s*this.n*i.d-i.s*this.d*i.n,this.d*i.d)},mul:function(e,t){return f(e,t),new h(this.s*i.s*this.n*i.n,this.d*i.d)},div:function(e,t){return f(e,t),new h(this.s*i.s*this.n*i.d,this.d*i.n)},clone:function(){return new h(this)},mod:function(e,t){return isNaN(this.n)||isNaN(this.d)?new h(NaN):void 0===e?new h(this.s*this.n%this.d,1):(f(e,t),0===i.n&&0===this.d&&h(0,0),new h(this.s*(i.d*this.n)%(i.n*this.d),i.d*this.d))},gcd:function(e,t){return f(e,t),new h(p(i.n,this.n)*p(i.d,this.d),i.d*this.d)},lcm:function(e,t){return f(e,t),0===i.n&&0===this.n?new h:new h(i.n*this.n,p(i.n,this.n)*p(i.d,this.d))},ceil:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new h(NaN):new h(Math.ceil(e*this.s*this.n/this.d),e)},floor:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new h(NaN):new h(Math.floor(e*this.s*this.n/this.d),e)},round:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new h(NaN):new h(Math.round(e*this.s*this.n/this.d),e)},inverse:function(){return new h(this.s*this.d,this.n)},pow:function(e,t){if(f(e,t),1===i.d)return i.s<0?new h(Math.pow(this.s*this.d,i.n),Math.pow(this.n,i.n)):new h(Math.pow(this.s*this.n,i.n),Math.pow(this.d,i.n));if(this.s<0)return null;var n=l(this.n),r=l(this.d),a=1,o=1;for(var s in n)if("1"!==s){if("0"===s){a=0;break}if(n[s]*=i.n,n[s]%i.d!=0)return null;n[s]/=i.d,a*=Math.pow(s,n[s])}for(var s in r)if("1"!==s){if(r[s]*=i.n,r[s]%i.d!=0)return null;r[s]/=i.d,o*=Math.pow(s,r[s])}return i.s<0?new h(o,a):new h(a,o)},equals:function(e,t){return f(e,t),this.s*this.n*i.d==i.s*i.n*this.d},compare:function(e,t){f(e,t);var n=this.s*this.n*i.d-i.s*i.n*this.d;return(0<n)-(n<0)},simplify:function(e){if(isNaN(this.n)||isNaN(this.d))return this;var t=this.abs().toContinued();function n(e){return 1===e.length?new h(e[0]):n(e.slice(1)).inverse().add(e[0])}e=e||.001;for(var r=0;r<t.length;r++){var i=n(t.slice(0,r+1));if(i.sub(this.abs()).abs().valueOf()<e)return i.mul(this.s)}return this},divisible:function(e,t){return f(e,t),!(!(i.n*this.d)||this.n*i.d%(i.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(e){var t,n="",r=this.n,i=this.d;return this.s<0&&(n+="-"),1===i?n+=r:(e&&(t=Math.floor(r/i))>0&&(n+=t,n+=" ",r%=i),n+=r,n+="/",n+=i),n},toLatex:function(e){var t,n="",r=this.n,i=this.d;return this.s<0&&(n+="-"),1===i?n+=r:(e&&(t=Math.floor(r/i))>0&&(n+=t,r%=i),n+="\\frac{",n+=r,n+="}{",n+=i,n+="}"),n},toContinued:function(){var e,t=this.n,n=this.d,r=[];if(isNaN(t)||isNaN(n))return r;do{r.push(Math.floor(t/n)),e=t%n,t=n,n=e}while(1!==t);return r},toString:function(e){var t=this.n,n=this.d;if(isNaN(t)||isNaN(n))return"NaN";e=e||15;var r=function(e,t){for(;t%2==0;t/=2);for(;t%5==0;t/=5);if(1===t)return 0;for(var n=10%t,r=1;1!==n;r++)if(n=10*n%t,r>2e3)return 0;return r}(0,n),i=function(e,t,n){for(var r=1,i=function(e,t,n){for(var r=1;t>0;e=e*e%n,t>>=1)1&t&&(r=r*e%n);return r}(10,n,t),a=0;a<300;a++){if(r===i)return a;r=10*r%t,i=10*i%t}return 0}(0,n,r),a=-1===this.s?"-":"";if(a+=t/n|0,t%=n,(t*=10)&&(a+="."),r){for(var o=i;o--;)a+=t/n|0,t%=n,t*=10;for(a+="(",o=r;o--;)a+=t/n|0,t%=n,t*=10;a+=")"}else for(o=e;t&&o--;)a+=t/n|0,t%=n,t*=10;return a}},void 0===(n=function(){return h}.apply(t,[]))||(e.exports=n)}()},6482:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},r=["Webkit","ms","Moz","O"];Object.keys(n).forEach((function(e){r.forEach((function(t){n[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=n[e]}))}));var i={isUnitlessNumber:n,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};t.default=i},8511:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(6482));function i(e){return e&&e.__esModule?e:{default:e}}i(n(3620));var a=r.default.isUnitlessNumber;t.default=function(e,t,n){return null==t||"boolean"==typeof t||""===t?"":isNaN(t)||0===t||a.hasOwnProperty(e)&&a[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}},6563:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processStyleName=void 0,t.createMarkupForStyles=function(e,t){var n="";for(var i in e){var a=0===i.indexOf("--");if(e.hasOwnProperty(i)&&"label"!==i){var o=e[i];null!=o&&(a?n+=i+":"+o+";":(n+=s(i)+":",n+=(0,r.default)(i,o,t)+";"))}}return n||null},o(n(250));var r=o(n(8511)),i=o(n(7100)),a=o(n(1767));function o(e){return e&&e.__esModule?e:{default:e}}o(n(3620));var s=t.processStyleName=(0,a.default)(i.default)},5913:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e){return Array.isArray(e)?(i=!1,a=[],(t=e).forEach((function(e){var t=r(e);null!==t&&t===e||(i=!0),null!==t&&a.push(t)})),0==a.length?null:i?a:t):function(e){if(function(e){return null==e||!1===e||"object"===(void 0===e?"undefined":n(e))&&0===Object.keys(e).length}(e))return null;if("object"!==(void 0===e?"undefined":n(e)))return e;for(var t={},i=Object.keys(e),a=!1,o=0;o<i.length;o++){var s=e[i[o]],u=r(s);null!==u&&u===s||(a=!0),null!==u&&(t[i[o]]=u)}return 0===Object.keys(t).length?null:a?t:e}(e);var t,i,a}t.default=r},8108:(e,t)=>{"use strict";function n(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)+(e.charCodeAt(t++)<<16)+(e.charCodeAt(t)<<24)}function r(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)}function i(e,t){return(65535&(e|=0))*(t|=0)+(((e>>>16)*t&65535)<<16)|0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var a=1540483477,o=t^e.length,s=e.length,u=0;s>=4;){var c=n(e,u);c=i(c,a),c=i(c^=c>>>24,a),o=i(o,a),o^=c,u+=4,s-=4}switch(s){case 3:o^=r(e,u),o=i(o^=e.charCodeAt(u+2)<<16,a);break;case 2:o=i(o^=r(e,u),a);break;case 1:o=i(o^=e.charCodeAt(u),a)}return o=i(o^=o>>>13,a),(o^=o>>>15)>>>0}},6113:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compose=t.merge=t.$=t.style=t.presets=t.keyframes=t.fontFace=t.insertGlobal=t.insertRule=t.plugins=t.styleSheet=void 0,t.speedy=function(e){return f.speedy(e)},t.simulations=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];d=!!e},t.simulate=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,o.default)(t))?d?t.reduce((function(e,t){return e["data-simulate-"+y(t)]="",e}),{}):(m||(console.warn("can't simulate without once calling simulations(true)"),m=!0),g||(console.warn("don't use simulation outside dev"),g=!0),{}):{}},t.cssLabels=function(e){v=!!e},t.isLikeRule=x,t.idFor=w,t.css=q,t.rehydrate=function(e){(0,r.default)(D,e.reduce((function(e,t){return e[t]=!0,e}),{}))},t.flush=function(){D=f.inserted={},_=f.registered={},T={},f.flush(),f.inject()},t.select=V,t.parent=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return q(l({},e+" &",n))},t.media=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return q(l({},"@media "+e,n))},t.pseudo=$,t.active=function(e){return $(":active",e)},t.any=function(e){return $(":any",e)},t.checked=function(e){return $(":checked",e)},t.disabled=function(e){return $(":disabled",e)},t.empty=function(e){return $(":empty",e)},t.enabled=function(e){return $(":enabled",e)},t._default=function(e){return $(":default",e)},t.first=function(e){return $(":first",e)},t.firstChild=function(e){return $(":first-child",e)},t.firstOfType=function(e){return $(":first-of-type",e)},t.fullscreen=function(e){return $(":fullscreen",e)},t.focus=function(e){return $(":focus",e)},t.hover=function(e){return $(":hover",e)},t.indeterminate=function(e){return $(":indeterminate",e)},t.inRange=function(e){return $(":in-range",e)},t.invalid=function(e){return $(":invalid",e)},t.lastChild=function(e){return $(":last-child",e)},t.lastOfType=function(e){return $(":last-of-type",e)},t.left=function(e){return $(":left",e)},t.link=function(e){return $(":link",e)},t.onlyChild=function(e){return $(":only-child",e)},t.onlyOfType=function(e){return $(":only-of-type",e)},t.optional=function(e){return $(":optional",e)},t.outOfRange=function(e){return $(":out-of-range",e)},t.readOnly=function(e){return $(":read-only",e)},t.readWrite=function(e){return $(":read-write",e)},t.required=function(e){return $(":required",e)},t.right=function(e){return $(":right",e)},t.root=function(e){return $(":root",e)},t.scope=function(e){return $(":scope",e)},t.target=function(e){return $(":target",e)},t.valid=function(e){return $(":valid",e)},t.visited=function(e){return $(":visited",e)},t.dir=function(e,t){return $(":dir("+e+")",t)},t.lang=function(e,t){return $(":lang("+e+")",t)},t.not=function(e,t){var n=e.split(",").map((function(e){return e.trim()})).map((function(e){return":not("+e+")"}));return 1===n.length?$(":not("+e+")",t):V(n.join(""),t)},t.nthChild=function(e,t){return $(":nth-child("+e+")",t)},t.nthLastChild=function(e,t){return $(":nth-last-child("+e+")",t)},t.nthLastOfType=function(e,t){return $(":nth-last-of-type("+e+")",t)},t.nthOfType=function(e,t){return $(":nth-of-type("+e+")",t)},t.after=function(e){return $("::after",e)},t.before=function(e){return $("::before",e)},t.firstLetter=function(e){return $("::first-letter",e)},t.firstLine=function(e){return $("::first-line",e)},t.selection=function(e){return $("::selection",e)},t.backdrop=function(e){return $("::backdrop",e)},t.placeholder=function(e){return q({"::placeholder":e})},t.cssFor=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,o.default)(t))?t.map((function(e){var t={label:[]};return B(t,{src:e}),k(b(t),A(t)).join("")})).join(""):""},t.attribsFor=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=(t=(0,o.default)(t))?t.map((function(e){w(e);var t=Object.keys(e)[0];return t+'="'+(e[t]||"")+'"'})).join(" "):"";return r};var r=c(n(7418)),i=n(6837),a=n(6563),o=c(n(5913)),s=n(2389),u=c(n(8108));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=t.styleSheet=new i.StyleSheet;f.inject();var p=t.plugins=f.plugins=new s.PluginSet([s.prefixes,s.contentWrap,s.fallbacks]);p.media=new s.PluginSet,p.fontFace=new s.PluginSet,p.keyframes=new s.PluginSet([s.prefixes,s.fallbacks]);var h="undefined"!=typeof window,d=false,m=!1,g=!1,v=false;function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.toLowerCase().replace(/[^a-z0-9]/g,t)}function b(e){var t=JSON.stringify(e),n=(0,u.default)(t).toString(36);return e.label&&e.label.length,n}function x(e){var t=Object.keys(e).filter((function(e){return"toString"!==e}));return 1===t.length&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0])}function w(e){var t=Object.keys(e).filter((function(e){return"toString"!==e}));if(1!==t.length)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0]);if(!n)throw new Error("not a rule");return n[1]}var E=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function C(e){if(-1===e.indexOf(","))return[e];for(var t,n=[],r=[],i=0;t=E.exec(e);)switch(t[0]){case"(":i++;break;case")":i--;break;case",":if(i)break;n.push(t.index)}for(t=n.length;t--;)r.unshift(e.slice(n[t]+1)),e=e.slice(0,n[t]);return r.unshift(e),r}function S(e,t){if(!e)return t.replace(/\&/g,"");if(!t)return".css-"+e+",[data-css-"+e+"]";var n=C(t).map((function(t){return t.indexOf("&")>=0?[t.replace(/\&/gm,".css-"+e),t.replace(/\&/gm,"[data-css-"+e+"]")].join(","):".css-"+e+t+",[data-css-"+e+"]"+t})).join(",");return d&&/^\&\:/.exec(t)&&!/\s/.exec(t)&&(n+=",.css-"+e+"[data-simulate-"+y(t)+"],[data-css-"+e+"][data-simulate-"+y(t)+"]"),n}function N(e){var t=e.selector,n=e.style,r=p.transform({selector:t,style:n});return r.selector+"{"+(0,a.createMarkupForStyles)(r.style)+"}"}function A(e){var t=void 0,n=void 0,r=void 0,i=void 0;return Object.keys(e).forEach((function(a){a.indexOf("&")>=0?(n=n||{})[a]=e[a]:0===a.indexOf("@media")?(r=r||{})[a]=A(e[a]):0===a.indexOf("@supports")?(i=i||{})[a]=A(e[a]):"label"===a?e.label.length>0&&((t=t||{}).label=v?e.label.join("."):""):(t=t||{})[a]=e[a]})),{plain:t,selects:n,medias:r,supports:i}}function k(e,t){var n=[],r=t.plain,i=t.selects,a=t.medias,o=t.supports;return r&&n.push(N({style:r,selector:S(e)})),i&&Object.keys(i).forEach((function(t){return n.push(N({style:i[t],selector:S(e,t)}))})),a&&Object.keys(a).forEach((function(t){return n.push(t+"{"+k(e,a[t]).join("")+"}")})),o&&Object.keys(o).forEach((function(t){return n.push(t+"{"+k(e,o[t]).join("")+"}")})),n}var D=f.inserted={},_=f.registered={};function M(e){_[e.id]||(_[e.id]=e)}var T={};function O(e,t){var n=C(e).map((function(e){return e.indexOf("&")>=0?e:"&"+e})),r=C(t).map((function(e){return e.indexOf("&")>=0?e:"&"+e}));return r.reduce((function(e,t){return e.concat(n.map((function(e){return t.replace(/\&/g,e)})))}),[]).join(",")}function I(e,t){return e?"@supports "+e.substring(9)+" and "+t.substring(9):t}function F(e){for(var t=[],n=0;n<e.length;n++)t=Array.isArray(e[n])?t.concat(F(e[n])):t.concat(e[n]);return t}var R={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function B(e,t){var n=t.selector,r=void 0===n?"":n,i=t.mq,a=void 0===i?"":i,s=t.supp,u=void 0===s?"":s,c=t.src,l=void 0===c?{}:c;Array.isArray(l)||(l=[l]),(l=F(l)).forEach((function(t){if(x(t)){var n=function(e){if(x(e)){var t=_[w(e)];if(null==t)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return t}return e}(t);if("css"!==n.type)throw new Error("cannot merge this rule");t=n.style}(t=(0,o.default)(t))&&t.composes&&B(e,{selector:r,mq:a,supp:u,src:t.composes}),Object.keys(t||{}).forEach((function(n){if(function(e){for(var t=[":",".","[",">"," "],n=!1,r=e.charAt(0),i=0;i<t.length;i++)if(r===t[i]){n=!0;break}return n||e.indexOf("&")>=0}(n))R[n]&&R[n].forEach((function(i){return B(e,{selector:O(r,i),mq:a,supp:u,src:t[n]})})),B(e,{selector:O(r,n),mq:a,supp:u,src:t[n]});else if(function(e){return 0===e.indexOf("@media")}(n))B(e,{selector:r,mq:(o=a,s=n,o?"@media "+o.substring(6)+" and "+s.substring(6):s),supp:u,src:t[n]});else if(function(e){return 0===e.indexOf("@supports")}(n))B(e,{selector:r,mq:a,supp:I(u,n),src:t[n]});else if("composes"===n);else{var i=e;u&&(i[u]=i[u]||{},i=i[u]),a&&(i[a]=i[a]||{},i=i[a]),r&&(i[r]=i[r]||{},i=i[r]),"label"===n?v&&(e.label=e.label.concat(t.label)):i[n]=t[n]}var o,s}))}))}function z(e){var t={label:[]};return B(t,{src:e}),function(e){if(M(e),function(e){if(!D[e.id]){D[e.id]=!0;var t=A(e.style),n=k(e.id,t);D[e.id]=!!h||n,n.forEach((function(e){return f.insert(e)}))}}(e),T[e.id])return T[e.id];var t=l({},"data-css-"+e.id,v&&e.label||"");return Object.defineProperty(t,"toString",{enumerable:!1,value:function(){return"css-"+e.id}}),T[e.id]=t,t}({id:b(t),style:t,label:v?t.label.join("."):"",type:"css"})}var P={};Object.defineProperty(P,"toString",{enumerable:!1,value:function(){return"css-nil"}});var L,j="undefined"!=typeof WeakMap?[P,new WeakMap,new WeakMap,new WeakMap]:[P],U="undefined"!=typeof WeakMap?(L=z,function(e){if(j[e.length]){for(var t=j[e.length],n=0;n<e.length-1;)t.has(e[n])||t.set(e[n],new WeakMap),t=t.get(e[n]),n++;if(t.has(e[e.length-1])){var r=t.get(e[n]);if(_[r.toString().substring(4)])return r}}var i=L(e);if(j[e.length]){for(var a=0,o=j[e.length];a<e.length-1;)o=o.get(e[a]),a++;try{o.set(e[a],i)}catch(e){}}return i}):z;function q(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0]&&t[0].length&&t[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(t=(0,o.default)(t))?U(t):P}q.insert=function(e){var t={id:b(e),css:e,type:"raw"};M(t),D[t.id]||(f.insert(t.css),D[t.id]=!!h||[t.css])},t.insertRule=q.insert,q.global=function(e,t){if(t=(0,o.default)(t))return q.insert(N({selector:e,style:t}))},t.insertGlobal=q.global,q.keyframes=function(e,t){t||(t=e,e="animation");var n={id:b({name:e,kfs:t=(0,o.default)(t)||{}}),type:"keyframes",name:e,keyframes:t};return M(n),function(e){if(!D[e.id]){var t=Object.keys(e.keyframes).map((function(t){var n=p.keyframes.transform({id:e.id,name:t,style:e.keyframes[t]});return n.name+"{"+(0,a.createMarkupForStyles)(n.style)+"}"})).join(""),n=["-webkit-","-moz-","-o-",""].map((function(n){return"@"+n+"keyframes "+e.name+"_"+e.id+"{"+t+"}"}));n.forEach((function(e){return f.insert(e)})),D[e.id]=!!h||n}}(n),e+"_"+n.id},q.fontFace=function(e){var t={id:b(e=(0,o.default)(e)),type:"font-face",font:e};return M(t),function(e){if(!D[e.id]){var t="@font-face{"+(0,a.createMarkupForStyles)(e.font)+"}";f.insert(t),D[e.id]=!!h||[t]}}(t),e.fontFamily},t.fontFace=q.fontFace,t.keyframes=q.keyframes,t.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var W=t.style=q;function V(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e?q(l({},e,n)):W(n)}function $(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return q(l({},e,n))}t.$=V,t.merge=q,t.compose=q},2389:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.PluginSet=u,t.fallbacks=function(e){if(Object.keys(e.style).map((function(t){return Array.isArray(e.style[t])})).indexOf(!0)>=0){var t=e.style,n=Object.keys(t).reduce((function(e,n){return e[n]=Array.isArray(t[n])?t[n].join("; "+(0,a.processStyleName)(n)+": "):t[n],e}),{});return(0,i.default)({},e,{style:n})}return e},t.contentWrap=function(e){if(e.style.content){var t=e.style.content;return c.indexOf(t)>=0||/^(attr|calc|counters?|url)\(/.test(t)?e:t.charAt(0)!==t.charAt(t.length-1)||'"'!==t.charAt(0)&&"'"!==t.charAt(0)?r({},e,{style:r({},e.style,{content:'"'+t+'"'})}):e}return e},t.prefixes=function(e){return(0,i.default)({},e,{style:(0,o.default)(r({},e.style))})};var i=s(n(7418)),a=n(6563),o=s(n(4975));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){this.fns=e||[]}(0,i.default)(u.prototype,{add:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){e.fns.indexOf(t)>=0||(e.fns=[t].concat(e.fns))}))},remove:function(e){this.fns=this.fns.filter((function(t){return t!==e}))},clear:function(){this.fns=[]},transform:function(e){return this.fns.reduce((function(e,t){return t(e)}),e)}});var c=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},4975:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t in e){var n=e[t],r=(0,a.default)(v,t,n,e,y);r&&(e[t]=r),(0,i.default)(y,t,e)}return e};var r=g(n(2633)),i=g(n(7901)),a=g(n(1745)),o=g(n(5848)),s=g(n(6230)),u=g(n(7879)),c=g(n(5716)),l=g(n(8544)),f=g(n(7551)),p=g(n(1242)),h=g(n(9686)),d=g(n(1113)),m=g(n(5152));function g(e){return e&&e.__esModule?e:{default:e}}var v=[s.default,o.default,u.default,l.default,f.default,p.default,h.default,d.default,m.default,c.default],y=r.default.prefixMap},6837:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleSheet=l;var r,i=(r=n(7418))&&r.__esModule?r:{default:r};function a(e){return e[e.length-1]}function o(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}var s="undefined"!=typeof window,u=function(){if(s){var e=document.createElement("div");return e.innerHTML="\x3c!--[if lt IE 10]><i></i><![endif]--\x3e",1===e.getElementsByTagName("i").length}}();function c(){var e=document.createElement("style");return e.type="text/css",e.setAttribute("data-glamor",""),e.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.speedy,n=void 0===t||t,r=e.maxLength,i=void 0===r?s&&u?4e3:65e3:r;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=i,this.ctr=0}(0,i.default)(l.prototype,{getSheet:function(){return o(a(this.tags))},inject:function(){var e=this;if(this.injected)throw new Error("already injected stylesheet!");s?this.tags[0]=c():this.sheet={cssRules:[],insertRule:function(t){e.sheet.cssRules.push({cssText:t})}},this.injected=!0},speedy:function(e){if(0!==this.ctr)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+e+") earlier in your app, or call flush() before speedy("+e+")");this.isSpeedy=!!e},_insert:function(e){try{var t=this.getSheet();t.insertRule(e,-1!==e.indexOf("@import")?0:t.cssRules.length)}catch(e){}},insert:function(e){if(s)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(e);else if(-1!==e.indexOf("@import")){var t=a(this.tags);t.insertBefore(document.createTextNode(e),t.firstChild)}else a(this.tags).appendChild(document.createTextNode(e));else this.sheet.insertRule(e,-1!==e.indexOf("@import")?0:this.sheet.cssRules.length);return this.ctr++,s&&this.ctr%this.maxLength==0&&this.tags.push(c()),this.ctr-1},delete:function(e){return this.replace(e,"")},flush:function(){s?(this.tags.forEach((function(e){return e.parentNode.removeChild(e)})),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!s)return this.sheet.cssRules;var e=[];return this.tags.forEach((function(t){return e.splice.apply(e,[e.length,0].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array.from(o(t).cssRules))))})),e}})},5477:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=/[A-Z]/g,i=/^ms-/,a={};function o(e){return"-"+e.toLowerCase()}const s=function(e){if(a.hasOwnProperty(e))return a[e];var t=e.replace(r,o);return a[e]=i.test(t)?"-"+t:t}},6230:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,i.default)(t)&&t.indexOf("cross-fade(")>-1)return a.map((function(e){return t.replace(/cross-fade\(/g,e+"cross-fade(")}))};var r,i=(r=n(638))&&r.__esModule?r:{default:r},a=["-webkit-",""];e.exports=t.default},5848:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("cursor"===e&&r.hasOwnProperty(t))return n.map((function(e){return e+t}))};var n=["-webkit-","-moz-",""],r={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};e.exports=t.default},7879:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,i.default)(t)&&t.indexOf("filter(")>-1)return a.map((function(e){return t.replace(/filter\(/g,e+"filter(")}))};var r,i=(r=n(638))&&r.__esModule?r:{default:r},a=["-webkit-",""];e.exports=t.default},5716:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("display"===e&&n.hasOwnProperty(t))return n[t]};var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};e.exports=t.default},8544:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){"flexDirection"===e&&"string"==typeof t&&(t.indexOf("column")>-1?i.WebkitBoxOrient="vertical":i.WebkitBoxOrient="horizontal",t.indexOf("reverse")>-1?i.WebkitBoxDirection="reverse":i.WebkitBoxDirection="normal"),r.hasOwnProperty(e)&&(i[r[e]]=n[t]||t)};var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},r={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};e.exports=t.default},7551:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,i.default)(t)&&o.test(t))return a.map((function(e){return e+t}))};var r,i=(r=n(638))&&r.__esModule?r:{default:r},a=["-webkit-","-moz-",""],o=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;e.exports=t.default},1242:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,i.default)(t)&&t.indexOf("image-set(")>-1)return a.map((function(e){return t.replace(/image-set\(/g,e+"image-set(")}))};var r,i=(r=n(638))&&r.__esModule?r:{default:r},a=["-webkit-",""];e.exports=t.default},9686:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("position"===e&&"sticky"===t)return["-webkit-sticky","sticky"]},e.exports=t.default},1113:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(r.hasOwnProperty(e)&&i.hasOwnProperty(t))return n.map((function(e){return e+t}))};var n=["-webkit-","-moz-",""],r={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},i={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};e.exports=t.default},5152:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){if("string"==typeof t&&s.hasOwnProperty(e)){var c=function(e,t){if((0,i.default)(e))return e;for(var n=e.split(/,(?![^()]*(?:\([^()]*\))?\))/g),a=0,o=n.length;a<o;++a){var s=n[a],c=[s];for(var l in t){var f=(0,r.default)(l);if(s.indexOf(f)>-1&&"order"!==f)for(var p=t[l],h=0,d=p.length;h<d;++h)c.unshift(s.replace(f,u[p[h]]+f))}n[a]=c.join(",")}return n.join(",")}(t,o),l=c.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-moz-|-ms-/.test(e)})).join(",");if(e.indexOf("Webkit")>-1)return l;var f=c.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-webkit-|-ms-/.test(e)})).join(",");return e.indexOf("Moz")>-1?f:(n["Webkit"+(0,a.default)(e)]=l,n["Moz"+(0,a.default)(e)]=f,c)}};var r=o(n(6238)),i=o(n(638)),a=o(n(2160));function o(e){return e&&e.__esModule?e:{default:e}}var s={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},u={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};e.exports=t.default},2633:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["Webkit"],r=["Moz"],i=["ms"],a=["Webkit","Moz"],o=["Webkit","ms"],s=["Webkit","Moz","ms"];t.default={plugins:[],prefixMap:{appearance:a,userSelect:s,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:s,breakBefore:s,breakInside:s,columnCount:a,columnFill:a,columnGap:a,columnRule:a,columnRuleColor:a,columnRuleStyle:a,columnRuleWidth:a,columns:a,columnSpan:a,columnWidth:a,writingMode:o,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:o,scrollSnapPointsX:o,scrollSnapPointsY:o,scrollSnapDestination:o,scrollSnapCoordinate:o,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:s,flowInto:o,flowFrom:o,regionFragment:o,textAlignLast:r,tabSize:r,wrapFlow:i,wrapThrough:i,wrapMargin:i,gridTemplateColumns:i,gridTemplateRows:i,gridTemplateAreas:i,gridTemplate:i,gridAutoColumns:i,gridAutoRows:i,gridAutoFlow:i,grid:i,gridRowStart:i,gridColumnStart:i,gridRowEnd:i,gridRow:i,gridColumn:i,gridColumnEnd:i,gridColumnGap:i,gridRowGap:i,gridArea:i,gridGap:i,textSizeAdjust:o,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},e.exports=t.default},2160:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.exports=t.default},7901:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(e.hasOwnProperty(t))for(var r=e[t],a=0,o=r.length;a<o;++a)n[r[a]+(0,i.default)(t)]=n[t]};var r,i=(r=n(2160))&&r.__esModule?r:{default:r};e.exports=t.default},1745:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,i){for(var a=0,o=e.length;a<o;++a){var s=e[a](t,n,r,i);if(s)return s}},e.exports=t.default},3228:e=>{e.exports=function e(t,n){"use strict";var r,i,a=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,o=/(^[ ]*|[ ]*$)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=/^0x[0-9a-f]+$/i,c=/^0/,l=function(t){return e.insensitive&&(""+t).toLowerCase()||""+t},f=l(t).replace(o,"")||"",p=l(n).replace(o,"")||"",h=f.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),d=p.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=parseInt(f.match(u),16)||1!==h.length&&f.match(s)&&Date.parse(f),g=parseInt(p.match(u),16)||m&&p.match(s)&&Date.parse(p)||null;if(g){if(m<g)return-1;if(m>g)return 1}for(var v=0,y=Math.max(h.length,d.length);v<y;v++){if(r=!(h[v]||"").match(c)&&parseFloat(h[v])||h[v]||0,i=!(d[v]||"").match(c)&&parseFloat(d[v])||d[v]||0,isNaN(r)!==isNaN(i))return isNaN(r)?1:-1;if(typeof r!=typeof i&&(r+="",i+=""),r<i)return-1;if(r>i)return 1}return 0}},9593:(e,t,n)=>{"use strict";const r=n(4411),i=Symbol("max"),a=Symbol("length"),o=Symbol("lengthCalculator"),s=Symbol("allowStale"),u=Symbol("maxAge"),c=Symbol("dispose"),l=Symbol("noDisposeOnSet"),f=Symbol("lruList"),p=Symbol("cache"),h=Symbol("updateAgeOnGet"),d=()=>1,m=(e,t,n)=>{const r=e[p].get(t);if(r){const t=r.value;if(g(e,t)){if(y(e,r),!e[s])return}else n&&(e[h]&&(r.value.now=Date.now()),e[f].unshiftNode(r));return t.value}},g=(e,t)=>{if(!t||!t.maxAge&&!e[u])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[u]&&n>e[u]},v=e=>{if(e[a]>e[i])for(let t=e[f].tail;e[a]>e[i]&&null!==t;){const n=t.prev;y(e,t),t=n}},y=(e,t)=>{if(t){const n=t.value;e[c]&&e[c](n.key,n.value),e[a]-=n.length,e[p].delete(n.key),e[f].removeNode(t)}};class b{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const x=(e,t,n,r)=>{let i=n.value;g(e,i)&&(y(e,n),e[s]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||d;if(this[o]="function"!=typeof t?d:t,this[s]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[u]=e.maxAge||0,this[c]=e.dispose,this[l]=e.noDisposeOnSet||!1,this[h]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,v(this)}get max(){return this[i]}set allowStale(e){this[s]=!!e}get allowStale(){return this[s]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[u]=e,v(this)}get maxAge(){return this[u]}set lengthCalculator(e){"function"!=typeof e&&(e=d),e!==this[o]&&(this[o]=e,this[a]=0,this[f].forEach((e=>{e.length=this[o](e.value,e.key),this[a]+=e.length}))),v(this)}get lengthCalculator(){return this[o]}get length(){return this[a]}get itemCount(){return this[f].length}rforEach(e,t){t=t||this;for(let n=this[f].tail;null!==n;){const r=n.prev;x(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[f].head;null!==n;){const r=n.next;x(this,e,n,t),n=r}}keys(){return this[f].toArray().map((e=>e.key))}values(){return this[f].toArray().map((e=>e.value))}reset(){this[c]&&this[f]&&this[f].length&&this[f].forEach((e=>this[c](e.key,e.value))),this[p]=new Map,this[f]=new r,this[a]=0}dump(){return this[f].map((e=>!g(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[f]}set(e,t,n){if((n=n||this[u])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,s=this[o](t,e);if(this[p].has(e)){if(s>this[i])return y(this,this[p].get(e)),!1;const o=this[p].get(e).value;return this[c]&&(this[l]||this[c](e,o.value)),o.now=r,o.maxAge=n,o.value=t,this[a]+=s-o.length,o.length=s,this.get(e),v(this),!0}const h=new b(e,t,s,r,n);return h.length>this[i]?(this[c]&&this[c](e,t),!1):(this[a]+=h.length,this[f].unshift(h),this[p].set(e,this[f].head),v(this),!0)}has(e){if(!this[p].has(e))return!1;const t=this[p].get(e).value;return!g(this,t)}get(e){return m(this,e,!0)}peek(e){return m(this,e,!1)}pop(){const e=this[f].tail;return e?(y(this,e),e.value):null}del(e){y(this,this[p].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[p].forEach(((e,t)=>m(this,t,!1)))}}},4676:(e,t,n)=>{var r=n(7522),i=n(8520),a=n(1865),o=n(4775),s=n(6709),u=n(6515),c=n(1566);c.alea=r,c.xor128=i,c.xorwow=a,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},7522:function(e,t,n){var r;!function(e,i,a){function o(e){var t,n=this,r=(t=4022871197,function(e){e=String(e);for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},6515:function(e,t,n){var r;!function(e,i,a){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},8520:function(e,t,n){var r;!function(e,i,a){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},6709:function(e,t,n){var r;!function(e,i,a){function o(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},4775:function(e,t,n){var r;!function(e,i,a){function o(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},1865:function(e,t,n){var r;!function(e,i,a){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},1566:function(e,t,n){var r;!function(i,a,o){var s,u=256,c=o.pow(u,6),l=o.pow(2,52),f=2*l,p=255;function h(e,t,n){var r=[],p=v(g((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(a)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(i.crypto||i.msCrypto).getRandomValues(e)),y(e)}catch(e){var t=i.navigator,n=t&&t.plugins;return[+new Date,i,n,i.screen,y(a)]}}():e,3),r),h=new d(r),b=function(){for(var e=h.g(6),t=c,n=0;e<l;)e=(e+n)*u,t*=u,n=h.g(1);for(;e>=f;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|h.g(4)},b.quick=function(){return h.g(4)/4294967296},b.double=b,v(y(h.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&m(r,h),e.state=function(){return m(h,{})}),n?(o.random=e,t):e})(b,p,"global"in t?t.global:this==o,t.state)}function d(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);i<u;)o[i]=i++;for(i=0;i<u;i++)o[i]=o[a=p&a+e[i%n]+(t=o[i])],o[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,o=r.S;e--;)t=o[i=p&i+1],n=n*u+o[p&(o[i]=o[a=p&a+t])+(o[a]=t)];return r.i=i,r.j=a,n})(u)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(g(e[n],t-1))}catch(e){}return r.length?r:"string"==i?e:e+"\0"}function v(e,t){for(var n,r=e+"",i=0;i<r.length;)t[p&i]=p&(n^=19*t[p&i])+r.charCodeAt(i++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(v(o.random(),a),e.exports){e.exports=h;try{s=n(2007)}catch(e){}}else void 0===(r=function(){return h}.call(t,n,t,e))||(e.exports=r)}("undefined"!=typeof self?self:this,[],Math)},7418:e=>{"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function i(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,a){for(var o,s,u=i(e),c=1;c<arguments.length;c++){for(var l in o=Object(arguments[c]))n.call(o,l)&&(u[l]=o[l]);if(t){s=t(o);for(var f=0;f<s.length;f++)r.call(o,s[f])&&(u[s[f]]=o[s[f]])}}return u}},9674:(e,t,n)=>{"use strict";function r(){}n.r(t),n.d(t,{default:()=>P,h:()=>s,createElement:()=>s,cloneElement:()=>l,Component:()=>B,render:()=>z,rerender:()=>d,options:()=>i});var i={},a=[],o=[];function s(e,t){var n,s,u,c,l=o;for(c=arguments.length;c-- >2;)a.push(arguments[c]);for(t&&null!=t.children&&(a.length||a.push(t.children),delete t.children);a.length;)if((s=a.pop())&&void 0!==s.pop)for(c=s.length;c--;)a.push(s[c]);else"boolean"==typeof s&&(s=null),(u="function"!=typeof e)&&(null==s?s="":"number"==typeof s?s=String(s):"string"!=typeof s&&(u=!1)),u&&n?l[l.length-1]+=s:l===o?l=[s]:l.push(s),n=u;var f=new r;return f.nodeName=e,f.children=l,f.attributes=null==t?void 0:t,f.key=null==t?void 0:t.key,void 0!==i.vnode&&i.vnode(f),f}function u(e,t){for(var n in t)e[n]=t[n];return e}var c="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function l(e,t){return s(e.nodeName,u(u({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var f=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,p=[];function h(e){!e._dirty&&(e._dirty=!0)&&1==p.push(e)&&(i.debounceRendering||c)(d)}function d(){var e,t=p;for(p=[];e=t.pop();)e._dirty&&F(e)}function m(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&g(e,t.nodeName):n||e._componentConstructor===t.nodeName}function g(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function v(e){var t=u({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);return t}function y(e){var t=e.parentNode;t&&t.removeChild(e)}function b(e,t,n,r,i){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),r&&r(e);else if("class"!==t||i)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var a in n)a in r||(e.style[a]="");for(var a in r)e.style[a]="number"==typeof r[a]&&!1===f.test(a)?r[a]+"px":r[a]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var o=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,x,o):e.removeEventListener(t,x,o),(e._listeners||(e._listeners={}))[t]=r}else if("list"!==t&&"type"!==t&&!i&&t in e)!function(e,t,n){try{e[t]=n}catch(e){}}(e,t,null==r?"":r),null!=r&&!1!==r||e.removeAttribute(t);else{var s=i&&t!==(t=t.replace(/^xlink:?/,""));null==r||!1===r?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function x(e){return this._listeners[e.type](i.event&&i.event(e)||e)}var w=[],E=0,C=!1,S=!1;function N(){for(var e;e=w.pop();)i.afterMount&&i.afterMount(e),e.componentDidMount&&e.componentDidMount()}function A(e,t,n,r,i,a){E++||(C=null!=i&&void 0!==i.ownerSVGElement,S=null!=e&&!("__preactattr_"in e));var o=k(e,t,n,r,a);return i&&o.parentNode!==i&&i.appendChild(o),--E||(S=!1,a||N()),o}function k(e,t,n,r,i){var a=e,o=C;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(a=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(a,e),D(e,!0))),a.__preactattr_=!0,a;var s,u,c=t.nodeName;if("function"==typeof c)return function(e,t,n,r){for(var i=e&&e._component,a=i,o=e,s=i&&e._componentConstructor===t.nodeName,u=s,c=v(t);i&&!u&&(i=i._parentComponent);)u=i.constructor===t.nodeName;return i&&u&&(!r||i._component)?(I(i,c,3,n,r),e=i.base):(a&&!s&&(R(a),e=o=null),i=T(t.nodeName,c,n),e&&!i.nextBase&&(i.nextBase=e,o=null),I(i,c,1,n,r),e=i.base,o&&e!==o&&(o._component=null,D(o,!1))),e}(e,t,n,r);if(C="svg"===c||"foreignObject"!==c&&C,c=String(c),(!e||!g(e,c))&&(s=c,(u=C?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s)).normalizedNodeName=s,a=u,e)){for(;e.firstChild;)a.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(a,e),D(e,!0)}var l=a.firstChild,f=a.__preactattr_,p=t.children;if(null==f){f=a.__preactattr_={};for(var h=a.attributes,d=h.length;d--;)f[h[d].name]=h[d].value}return!S&&p&&1===p.length&&"string"==typeof p[0]&&null!=l&&void 0!==l.splitText&&null==l.nextSibling?l.nodeValue!=p[0]&&(l.nodeValue=p[0]):(p&&p.length||null!=l)&&function(e,t,n,r,i){var a,o,s,u,c,l=e.childNodes,f=[],p={},h=0,d=0,g=l.length,v=0,b=t?t.length:0;if(0!==g)for(var x=0;x<g;x++){var w=l[x],E=w.__preactattr_;null!=(C=b&&E?w._component?w._component.__key:E.key:null)?(h++,p[C]=w):(E||(void 0!==w.splitText?!i||w.nodeValue.trim():i))&&(f[v++]=w)}if(0!==b)for(x=0;x<b;x++){var C;if(c=null,null!=(C=(u=t[x]).key))h&&void 0!==p[C]&&(c=p[C],p[C]=void 0,h--);else if(!c&&d<v)for(a=d;a<v;a++)if(void 0!==f[a]&&m(o=f[a],u,i)){c=o,f[a]=void 0,a===v-1&&v--,a===d&&d++;break}c=k(c,u,n,r),s=l[x],c&&c!==e&&c!==s&&(null==s?e.appendChild(c):c===s.nextSibling?y(s):e.insertBefore(c,s))}if(h)for(var x in p)void 0!==p[x]&&D(p[x],!1);for(;d<=v;)void 0!==(c=f[v--])&&D(c,!1)}(a,p,n,r,S||null!=f.dangerouslySetInnerHTML),function(e,t,n){var r;for(r in n)t&&null!=t[r]||null==n[r]||b(e,r,n[r],n[r]=void 0,C);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||b(e,r,n[r],n[r]=t[r],C)}(a,t.attributes,f),C=o,a}function D(e,t){var n=e._component;n?R(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||y(e),_(e))}function _(e){for(e=e.lastChild;e;){var t=e.previousSibling;D(e,!0),e=t}}var M={};function T(e,t,n){var r,i=M[e.name];if(e.prototype&&e.prototype.render?(r=new e(t,n),B.call(r,t,n)):((r=new B(t,n)).constructor=e,r.render=O),i)for(var a=i.length;a--;)if(i[a].constructor===e){r.nextBase=i[a].nextBase,i.splice(a,1);break}return r}function O(e,t,n){return this.constructor(e,n)}function I(e,t,n,r,a){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||a?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===i.syncComponentUpdates&&e.base?h(e):F(e,1,a)),e.__ref&&e.__ref(e))}function F(e,t,n,r){if(!e._disable){var a,o,s,c=e.props,l=e.state,f=e.context,p=e.prevProps||c,h=e.prevState||l,d=e.prevContext||f,m=e.base,g=e.nextBase,y=m||g,b=e._component,x=!1;if(m&&(e.props=p,e.state=h,e.context=d,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,l,f)?x=!0:e.componentWillUpdate&&e.componentWillUpdate(c,l,f),e.props=c,e.state=l,e.context=f),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!x){a=e.render(c,l,f),e.getChildContext&&(f=u(u({},f),e.getChildContext()));var C,S,k=a&&a.nodeName;if("function"==typeof k){var _=v(a);(o=b)&&o.constructor===k&&_.key==o.__key?I(o,_,1,f,!1):(C=o,e._component=o=T(k,_,f),o.nextBase=o.nextBase||g,o._parentComponent=e,I(o,_,0,f,!1),F(o,1,n,!0)),S=o.base}else s=y,(C=b)&&(s=e._component=null),(y||1===t)&&(s&&(s._component=null),S=A(s,a,f,n||!m,y&&y.parentNode,!0));if(y&&S!==y&&o!==b){var M=y.parentNode;M&&S!==M&&(M.replaceChild(S,y),C||(y._component=null,D(y,!1)))}if(C&&R(C),e.base=S,S&&!r){for(var O=e,B=e;B=B._parentComponent;)(O=B).base=S;S._component=O,S._componentConstructor=O.constructor}}if(!m||n?w.unshift(e):x||(e.componentDidUpdate&&e.componentDidUpdate(p,h,d),i.afterUpdate&&i.afterUpdate(e)),null!=e._renderCallbacks)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);E||r||N()}}function R(e){i.beforeUnmount&&i.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?R(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,y(t),function(e){var t=e.constructor.name;(M[t]||(M[t]=[])).push(e)}(e),_(t)),e.__ref&&e.__ref(null)}function B(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}function z(e,t,n){return A(n,e,{},!1,t,!1)}u(B.prototype,{setState:function(e,t){var n=this.state;this.prevState||(this.prevState=u({},n)),u(n,"function"==typeof e?e(n,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),h(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),F(this,2)},render:function(){}});const P={h:s,createElement:s,cloneElement:l,Component:B,render:z,rerender:d,options:i}},2257:(e,t,n)=>{const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(e,t){if(t=a(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?o[s.COMPARATORLOOSE]:o[s.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new l(n[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new l(e,this.options)}catch(e){return!1}return u(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new f(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new f(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),a=this.semver.version===e.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=u(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=u(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||a&&o||s||c}}e.exports=i;const a=n(2893),{re:o,t:s}=n(5765),u=n(7539),c=n(4225),l=n(6376),f=n(6902)},6902:(e,t,n)=>{class r{constructor(e,t){if(t=a(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!d(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&m(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=i.get(t);if(n)return n;const r=this.options.loose,a=r?c[l.HYPHENRANGELOOSE]:c[l.HYPHENRANGE];e=e.replace(a,k(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(c[l.COMPARATORTRIM],f),s("comparator trim",e,c[l.COMPARATORTRIM]),e=(e=(e=e.replace(c[l.TILDETRIM],p)).replace(c[l.CARETTRIM],h)).split(/\s+/).join(" ");const u=r?c[l.COMPARATORLOOSE]:c[l.COMPARATOR],m=e.split(" ").map((e=>v(e,this.options))).join(" ").split(/\s+/).map((e=>A(e,this.options))).filter(this.options.loose?e=>!!e.match(u):()=>!0).map((e=>new o(e,this.options))),g=(m.length,new Map);for(const e of m){if(d(e))return[e];g.set(e.value,e)}g.size>1&&g.has("")&&g.delete("");const y=[...g.values()];return i.set(t,y),y}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some((n=>g(n,t)&&e.set.some((e=>g(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(D(this.set[t],e,this.options))return!0;return!1}}e.exports=r;const i=new(n(9593))({max:1e3}),a=n(2893),o=n(2257),s=n(4225),u=n(6376),{re:c,t:l,comparatorTrimReplace:f,tildeTrimReplace:p,caretTrimReplace:h}=n(5765),d=e=>"<0.0.0-0"===e.value,m=e=>""===e.value,g=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},v=(e,t)=>(s("comp",e,t),e=w(e,t),s("caret",e),e=b(e,t),s("tildes",e),e=C(e,t),s("xrange",e),e=N(e,t),s("stars",e),e),y=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map((e=>x(e,t))).join(" "),x=(e,t)=>{const n=t.loose?c[l.TILDELOOSE]:c[l.TILDE];return e.replace(n,((t,n,r,i,a)=>{let o;return s("tilde",e,t,n,r,i,a),y(n)?o="":y(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:y(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(s("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,s("tilde return",o),o}))},w=(e,t)=>e.trim().split(/\s+/).map((e=>E(e,t))).join(" "),E=(e,t)=>{s("caret",e,t);const n=t.loose?c[l.CARETLOOSE]:c[l.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,a,o)=>{let u;return s("caret",e,t,n,i,a,o),y(n)?u="":y(i)?u=`>=${n}.0.0${r} <${+n+1}.0.0-0`:y(a)?u="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:o?(s("replaceCaret pr",o),u="0"===n?"0"===i?`>=${n}.${i}.${a}-${o} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a}-${o} <${+n+1}.0.0-0`):(s("no pr"),u="0"===n?"0"===i?`>=${n}.${i}.${a}${r} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a} <${+n+1}.0.0-0`),s("caret return",u),u}))},C=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map((e=>S(e,t))).join(" ")),S=(e,t)=>{e=e.trim();const n=t.loose?c[l.XRANGELOOSE]:c[l.XRANGE];return e.replace(n,((n,r,i,a,o,u)=>{s("xRange",e,n,r,i,a,o,u);const c=y(i),l=c||y(a),f=l||y(o),p=f;return"="===r&&p&&(r=""),u=t.includePrerelease?"-0":"",c?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&p?(l&&(a=0),o=0,">"===r?(r=">=",l?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",l?i=+i+1:a=+a+1),"<"===r&&(u="-0"),n=`${r+i}.${a}.${o}${u}`):l?n=`>=${i}.0.0${u} <${+i+1}.0.0-0`:f&&(n=`>=${i}.${a}.0${u} <${i}.${+a+1}.0-0`),s("xRange return",n),n}))},N=(e,t)=>(s("replaceStars",e,t),e.trim().replace(c[l.STAR],"")),A=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?l.GTE0PRE:l.GTE0],"")),k=e=>(t,n,r,i,a,o,s,u,c,l,f,p,h)=>`${n=y(r)?"":y(i)?`>=${r}.0.0${e?"-0":""}`:y(a)?`>=${r}.${i}.0${e?"-0":""}`:o?`>=${n}`:`>=${n}${e?"-0":""}`} ${u=y(c)?"":y(l)?`<${+c+1}.0.0-0`:y(f)?`<${c}.${+l+1}.0-0`:p?`<=${c}.${l}.${f}-${p}`:e?`<${c}.${l}.${+f+1}-0`:`<=${u}`}`.trim(),D=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(s(e[n].semver),e[n].semver!==o.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},6376:(e,t,n)=>{const r=n(4225),{MAX_LENGTH:i,MAX_SAFE_INTEGER:a}=n(3295),{re:o,t:s}=n(5765),u=n(2893),{compareIdentifiers:c}=n(6742);class l{constructor(e,t){if(t=u(t),e instanceof l){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?o[s.LOOSE]:o[s.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof l)){if("string"==typeof e&&e===this.version)return 0;e=new l(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof l||(e=new l(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof l||(e=new l(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return c(n,i)}while(++t)}compareBuild(e){e instanceof l||(e=new l(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return c(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}e.exports=l},3507:(e,t,n)=>{const r=n(3959);e.exports=(e,t)=>{const n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},7539:(e,t,n)=>{const r=n(8718),i=n(1194),a=n(1312),o=n(5903),s=n(1544),u=n(2056);e.exports=(e,t,n,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,c);case"!=":return i(e,n,c);case">":return a(e,n,c);case">=":return o(e,n,c);case"<":return s(e,n,c);case"<=":return u(e,n,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},9038:(e,t,n)=>{const r=n(6376),i=n(3959),{re:a,t:o}=n(5765);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=a[o.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),a[o.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;a[o.COERCERTL].lastIndex=-1}else n=e.match(a[o.COERCE]);return null===n?null:i(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)}},8880:(e,t,n)=>{const r=n(6376);e.exports=(e,t,n)=>{const i=new r(e,n),a=new r(t,n);return i.compare(a)||i.compareBuild(a)}},7880:(e,t,n)=>{const r=n(6269);e.exports=(e,t)=>r(e,t,!0)},6269:(e,t,n)=>{const r=n(6376);e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},2378:(e,t,n)=>{const r=n(3959),i=n(8718);e.exports=(e,t)=>{if(i(e,t))return null;{const n=r(e),i=r(t),a=n.prerelease.length||i.prerelease.length,o=a?"pre":"",s=a?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==i[e])return o+e;return s}}},8718:(e,t,n)=>{const r=n(6269);e.exports=(e,t,n)=>0===r(e,t,n)},1312:(e,t,n)=>{const r=n(6269);e.exports=(e,t,n)=>r(e,t,n)>0},5903:(e,t,n)=>{const r=n(6269);e.exports=(e,t,n)=>r(e,t,n)>=0},253:(e,t,n)=>{const r=n(6376);e.exports=(e,t,n,i)=>{"string"==typeof n&&(i=n,n=void 0);try{return new r(e,n).inc(t,i).version}catch(e){return null}}},1544:(e,t,n)=>{const r=n(6269);e.exports=(e,t,n)=>r(e,t,n)<0},2056:(e,t,n)=>{const r=n(6269);e.exports=(e,t,n)=>r(e,t,n)<=0},8679:(e,t,n)=>{const r=n(6376);e.exports=(e,t)=>new r(e,t).major},7789:(e,t,n)=>{const r=n(6376);e.exports=(e,t)=>new r(e,t).minor},1194:(e,t,n)=>{const r=n(6269);e.exports=(e,t,n)=>0!==r(e,t,n)},3959:(e,t,n)=>{const{MAX_LENGTH:r}=n(3295),{re:i,t:a}=n(5765),o=n(6376),s=n(2893);e.exports=(e,t)=>{if(t=s(t),e instanceof o)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?i[a.LOOSE]:i[a.FULL]).test(e))return null;try{return new o(e,t)}catch(e){return null}}},2358:(e,t,n)=>{const r=n(6376);e.exports=(e,t)=>new r(e,t).patch},7559:(e,t,n)=>{const r=n(3959);e.exports=(e,t)=>{const n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},9795:(e,t,n)=>{const r=n(6269);e.exports=(e,t,n)=>r(t,e,n)},3657:(e,t,n)=>{const r=n(8880);e.exports=(e,t)=>e.sort(((e,n)=>r(n,e,t)))},5712:(e,t,n)=>{const r=n(6902);e.exports=(e,t,n)=>{try{t=new r(t,n)}catch(e){return!1}return t.test(e)}},1100:(e,t,n)=>{const r=n(8880);e.exports=(e,t)=>e.sort(((e,n)=>r(e,n,t)))},6397:(e,t,n)=>{const r=n(3959);e.exports=(e,t)=>{const n=r(e,t);return n?n.version:null}},1249:(e,t,n)=>{const r=n(5765);e.exports={re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n(3295).SEMVER_SPEC_VERSION,SemVer:n(6376),compareIdentifiers:n(6742).compareIdentifiers,rcompareIdentifiers:n(6742).rcompareIdentifiers,parse:n(3959),valid:n(6397),clean:n(3507),inc:n(253),diff:n(2378),major:n(8679),minor:n(7789),patch:n(2358),prerelease:n(7559),compare:n(6269),rcompare:n(9795),compareLoose:n(7880),compareBuild:n(8880),sort:n(1100),rsort:n(3657),gt:n(1312),lt:n(1544),eq:n(8718),neq:n(1194),gte:n(5903),lte:n(2056),cmp:n(7539),coerce:n(9038),Comparator:n(2257),Range:n(6902),satisfies:n(5712),toComparators:n(1042),maxSatisfying:n(5775),minSatisfying:n(1657),minVersion:n(5316),validRange:n(9042),outside:n(6826),gtr:n(7606),ltr:n(32),intersects:n(2937),simplifyRange:n(7908),subset:n(799)}},3295:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:t,MAX_SAFE_COMPONENT_LENGTH:16}},4225:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},6742:e=>{const t=/^[0-9]+$/,n=(e,n)=>{const r=t.test(e),i=t.test(n);return r&&i&&(e=+e,n=+n),e===n?0:r&&!i?-1:i&&!r?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},2893:e=>{const t=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:t.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{}},5765:(e,t,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:r}=n(3295),i=n(4225),a=(t=e.exports={}).re=[],o=t.src=[],s=t.t={};let u=0;const c=(e,t,n)=>{const r=u++;i(r,t),s[e]=r,o[r]=t,a[r]=new RegExp(t,n?"g":void 0)};c("NUMERICIDENTIFIER","0|[1-9]\\d*"),c("NUMERICIDENTIFIERLOOSE","[0-9]+"),c("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),c("MAINVERSION",`(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})`),c("MAINVERSIONLOOSE",`(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})`),c("PRERELEASEIDENTIFIER",`(?:${o[s.NUMERICIDENTIFIER]}|${o[s.NONNUMERICIDENTIFIER]})`),c("PRERELEASEIDENTIFIERLOOSE",`(?:${o[s.NUMERICIDENTIFIERLOOSE]}|${o[s.NONNUMERICIDENTIFIER]})`),c("PRERELEASE",`(?:-(${o[s.PRERELEASEIDENTIFIER]}(?:\\.${o[s.PRERELEASEIDENTIFIER]})*))`),c("PRERELEASELOOSE",`(?:-?(${o[s.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[s.PRERELEASEIDENTIFIERLOOSE]})*))`),c("BUILDIDENTIFIER","[0-9A-Za-z-]+"),c("BUILD",`(?:\\+(${o[s.BUILDIDENTIFIER]}(?:\\.${o[s.BUILDIDENTIFIER]})*))`),c("FULLPLAIN",`v?${o[s.MAINVERSION]}${o[s.PRERELEASE]}?${o[s.BUILD]}?`),c("FULL",`^${o[s.FULLPLAIN]}$`),c("LOOSEPLAIN",`[v=\\s]*${o[s.MAINVERSIONLOOSE]}${o[s.PRERELEASELOOSE]}?${o[s.BUILD]}?`),c("LOOSE",`^${o[s.LOOSEPLAIN]}$`),c("GTLT","((?:<|>)?=?)"),c("XRANGEIDENTIFIERLOOSE",`${o[s.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),c("XRANGEIDENTIFIER",`${o[s.NUMERICIDENTIFIER]}|x|X|\\*`),c("XRANGEPLAIN",`[v=\\s]*(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:${o[s.PRERELEASE]})?${o[s.BUILD]}?)?)?`),c("XRANGEPLAINLOOSE",`[v=\\s]*(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:${o[s.PRERELEASELOOSE]})?${o[s.BUILD]}?)?)?`),c("XRANGE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAIN]}$`),c("XRANGELOOSE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAINLOOSE]}$`),c("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),c("COERCERTL",o[s.COERCE],!0),c("LONETILDE","(?:~>?)"),c("TILDETRIM",`(\\s*)${o[s.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",c("TILDE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAIN]}$`),c("TILDELOOSE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAINLOOSE]}$`),c("LONECARET","(?:\\^)"),c("CARETTRIM",`(\\s*)${o[s.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",c("CARET",`^${o[s.LONECARET]}${o[s.XRANGEPLAIN]}$`),c("CARETLOOSE",`^${o[s.LONECARET]}${o[s.XRANGEPLAINLOOSE]}$`),c("COMPARATORLOOSE",`^${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]})$|^$`),c("COMPARATOR",`^${o[s.GTLT]}\\s*(${o[s.FULLPLAIN]})$|^$`),c("COMPARATORTRIM",`(\\s*)${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]}|${o[s.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",c("HYPHENRANGE",`^\\s*(${o[s.XRANGEPLAIN]})\\s+-\\s+(${o[s.XRANGEPLAIN]})\\s*$`),c("HYPHENRANGELOOSE",`^\\s*(${o[s.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[s.XRANGEPLAINLOOSE]})\\s*$`),c("STAR","(<|>)?=?\\s*\\*"),c("GTE0","^\\s*>=\\s*0.0.0\\s*$"),c("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},7606:(e,t,n)=>{const r=n(6826);e.exports=(e,t,n)=>r(e,t,">",n)},2937:(e,t,n)=>{const r=n(6902);e.exports=(e,t,n)=>(e=new r(e,n),t=new r(t,n),e.intersects(t))},32:(e,t,n)=>{const r=n(6826);e.exports=(e,t,n)=>r(e,t,"<",n)},5775:(e,t,n)=>{const r=n(6376),i=n(6902);e.exports=(e,t,n)=>{let a=null,o=null,s=null;try{s=new i(t,n)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(a&&-1!==o.compare(e)||(a=e,o=new r(a,n)))})),a}},1657:(e,t,n)=>{const r=n(6376),i=n(6902);e.exports=(e,t,n)=>{let a=null,o=null,s=null;try{s=new i(t,n)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(a&&1!==o.compare(e)||(a=e,o=new r(a,n)))})),a}},5316:(e,t,n)=>{const r=n(6376),i=n(6902),a=n(1312);e.exports=(e,t)=>{e=new i(e,t);let n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let o=null;i.forEach((e=>{const t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":o&&!a(t,o)||(o=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!o||n&&!a(n,o)||(n=o)}return n&&e.test(n)?n:null}},6826:(e,t,n)=>{const r=n(6376),i=n(2257),{ANY:a}=i,o=n(6902),s=n(5712),u=n(1312),c=n(1544),l=n(2056),f=n(5903);e.exports=(e,t,n,p)=>{let h,d,m,g,v;switch(e=new r(e,p),t=new o(t,p),n){case">":h=u,d=l,m=c,g=">",v=">=";break;case"<":h=c,d=f,m=u,g="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,p))return!1;for(let n=0;n<t.set.length;++n){const r=t.set[n];let o=null,s=null;if(r.forEach((e=>{e.semver===a&&(e=new i(">=0.0.0")),o=o||e,s=s||e,h(e.semver,o.semver,p)?o=e:m(e.semver,s.semver,p)&&(s=e)})),o.operator===g||o.operator===v)return!1;if((!s.operator||s.operator===g)&&d(e,s.semver))return!1;if(s.operator===v&&m(e,s.semver))return!1}return!0}},7908:(e,t,n)=>{const r=n(5712),i=n(6269);e.exports=(e,t,n)=>{const a=[];let o=null,s=null;const u=e.sort(((e,t)=>i(e,t,n)));for(const e of u)r(e,t,n)?(s=e,o||(o=e)):(s&&a.push([o,s]),s=null,o=null);o&&a.push([o,null]);const c=[];for(const[e,t]of a)e===t?c.push(e):t||e!==u[0]?t?e===u[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const l=c.join(" || "),f="string"==typeof t.raw?t.raw:String(t);return l.length<f.length?l:t}},799:(e,t,n)=>{const r=n(6902),i=n(2257),{ANY:a}=i,o=n(5712),s=n(6269),u=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===a){if(1===t.length&&t[0].semver===a)return!0;e=n.includePrerelease?[new i(">=0.0.0-0")]:[new i(">=0.0.0")]}if(1===t.length&&t[0].semver===a){if(n.includePrerelease)return!0;t=[new i(">=0.0.0")]}const r=new Set;let u,f,p,h,d,m,g;for(const t of e)">"===t.operator||">="===t.operator?u=c(u,t,n):"<"===t.operator||"<="===t.operator?f=l(f,t,n):r.add(t.semver);if(r.size>1)return null;if(u&&f){if(p=s(u.semver,f.semver,n),p>0)return null;if(0===p&&(">="!==u.operator||"<="!==f.operator))return null}for(const e of r){if(u&&!o(e,String(u),n))return null;if(f&&!o(e,String(f),n))return null;for(const r of t)if(!o(e,String(r),n))return!1;return!0}let v=!(!f||n.includePrerelease||!f.semver.prerelease.length)&&f.semver,y=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver;v&&1===v.prerelease.length&&"<"===f.operator&&0===v.prerelease[0]&&(v=!1);for(const e of t){if(g=g||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,u)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),">"===e.operator||">="===e.operator){if(h=c(u,e,n),h===e&&h!==u)return!1}else if(">="===u.operator&&!o(u.semver,String(e),n))return!1;if(f)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),"<"===e.operator||"<="===e.operator){if(d=l(f,e,n),d===e&&d!==f)return!1}else if("<="===f.operator&&!o(f.semver,String(e),n))return!1;if(!e.operator&&(f||u)&&0!==p)return!1}return!(u&&m&&!f&&0!==p||f&&g&&!u&&0!==p||y||v)},c=(e,t,n)=>{if(!e)return t;const r=s(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},l=(e,t,n)=>{if(!e)return t;const r=s(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n={})=>{if(e===t)return!0;e=new r(e,n),t=new r(t,n);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=u(r,e,n);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},1042:(e,t,n)=>{const r=n(6902);e.exports=(e,t)=>new r(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},9042:(e,t,n)=>{const r=n(6902);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(e){return null}}},4279:e=>{function t(){}t.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function i(){r.off(e,i),t.apply(n,arguments)}return i._=t,this.on(e,i,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var a=0,o=r.length;a<o;a++)r[a].fn!==t&&r[a].fn._!==t&&i.push(r[a]);return i.length?n[e]=i:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t},708:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Tensor:()=>OX,Turtle:()=>SX,abs:()=>LX,acos:()=>QX,add:()=>FX,asin:()=>eY,atan:()=>tY,atan2:()=>nY,average:()=>PY,ceil:()=>jX,compile:()=>AX,complex:()=>oY,concat:()=>bY,constrain:()=>UX,copy:()=>sY,cos:()=>rY,derivative:()=>kX,dispose:()=>TY,div:()=>zX,dot:()=>PX,endScope:()=>_Y,evaluate:()=>DX,exp:()=>qX,eye:()=>uY,fill:()=>cY,flatten:()=>gY,floor:()=>WX,fromImage:()=>OY,getBackend:()=>qY,keep:()=>MY,linspace:()=>lY,log:()=>VX,math:()=>i,max:()=>$X,mean:()=>zY,memory:()=>AY,min:()=>HX,mod:()=>GX,mult:()=>BX,ones:()=>fY,pad:()=>vY,parse:()=>_X,percentile:()=>RY,pow:()=>KX,ptp:()=>FY,quantile:()=>BY,random:()=>pY,randomGaussian:()=>hY,range:()=>dY,reshape:()=>yY,reverse:()=>xY,round:()=>XX,sd:()=>LY,setBackend:()=>UY,simplify:()=>MX,sin:()=>iY,slice:()=>wY,sort:()=>NY,split:()=>EY,sq:()=>YX,sqrt:()=>JX,stack:()=>CY,startScope:()=>DY,sub:()=>RX,sum:()=>ZX,tan:()=>aY,tf:()=>m,tidy:()=>kY,toImage:()=>IY,unstack:()=>SY,variance:()=>jY,zeros:()=>mY});var r={};n.r(r),n.d(r,{createAbs:()=>ai,createAccessorNode:()=>zy,createAcos:()=>si,createAcosh:()=>Go,createAcot:()=>Ai,createAcoth:()=>Ns,createAcsc:()=>Di,createAcsch:()=>Xo,createAdd:()=>$c,createAddScalar:()=>Mi,createAnd:()=>Nu,createApply:()=>Jo,createApplyTransform:()=>yb,createArg:()=>Ti,createArrayNode:()=>Ay,createAsec:()=>es,createAsech:()=>Ii,createAsin:()=>nf,createAsinh:()=>Fi,createAssignmentNode:()=>Py,createAtan:()=>Ri,createAtan2:()=>Kc,createAtanh:()=>zi,createAtomicMass:()=>Qt,createAvogadro:()=>en,createBellNumbers:()=>op,createBigNumberClass:()=>Ee,createBignumber:()=>Pi,createBin:()=>ts,createBitAnd:()=>ku,createBitNot:()=>na,createBitOr:()=>Yc,createBitXor:()=>_u,createBlockNode:()=>ky,createBohrMagneton:()=>It,createBohrRadius:()=>Lt,createBoltzmann:()=>tn,createBoolean:()=>ia,createCatalan:()=>Zc,createCbrt:()=>Tu,createCeil:()=>rf,createChain:()=>Iy,createChainClass:()=>uy,createClassicalElectronRadius:()=>jt,createClone:()=>oa,createColumn:()=>of,createColumnTransform:()=>Mb,createCombinations:()=>la,createCombinationsWithRep:()=>rs,createCompare:()=>Iu,createCompareNatural:()=>tl,createCompareText:()=>Ru,createCompile:()=>Hy,createComplex:()=>pa,createComplexClass:()=>He,createComposition:()=>uf,createConcat:()=>zu,createConcatTransform:()=>Sb,createConditionalNode:()=>Dy,createConductanceQuantum:()=>Ft,createConj:()=>da,createConstantNode:()=>_y,createCos:()=>as,createCosh:()=>ga,createCot:()=>As,createCoth:()=>ya,createCoulomb:()=>Tt,createCount:()=>ju,createCreateUnit:()=>Lf,createCross:()=>lf,createCsc:()=>ba,createCsch:()=>ss,createCtranspose:()=>qu,createCube:()=>wa,createDeepEqual:()=>rl,createDenseMatrixClass:()=>sr,createDerivative:()=>ib,createDet:()=>lp,createDeuteronMass:()=>Ht,createDiag:()=>Vu,createDiff:()=>al,createDiffTransform:()=>wb,createDistance:()=>pf,createDivide:()=>vp,createDivideScalar:()=>Hu,createDot:()=>ol,createDotDivide:()=>Ku,createDotMultiply:()=>df,createDotPow:()=>Uf,createE:()=>ft,createEfimovFactor:()=>Zt,createEigs:()=>Tp,createElectricConstant:()=>_t,createElectronMass:()=>Ut,createElementaryCharge:()=>Ot,createEqual:()=>Yu,createEqualScalar:()=>Sa,createEqualText:()=>ul,createErf:()=>Na,createEvaluate:()=>Ky,createExp:()=>Ta,createExpm:()=>bp,createExpm1:()=>Ia,createFactorial:()=>Wf,createFalse:()=>at,createFaraday:()=>nn,createFermiCoupling:()=>qt,createFibonacciHeapClass:()=>mf,createFilter:()=>Fa,createFilterTransform:()=>hb,createFineStructure:()=>Wt,createFirstRadiation:()=>rn,createFix:()=>gf,createFlatten:()=>Zu,createFloor:()=>cl,createForEach:()=>za,createForEachTransform:()=>mb,createFormat:()=>ja,createFraction:()=>ks,createFractionClass:()=>Sn,createFunctionAssignmentNode:()=>Fy,createFunctionNode:()=>qy,createGamma:()=>wf,createGasConstant:()=>on,createGcd:()=>ec,createGetMatrixDataType:()=>qa,createGravitationConstant:()=>Nt,createGravity:()=>mn,createHartreeEnergy:()=>Vt,createHasNumericValue:()=>nc,createHelp:()=>cb,createHelpClass:()=>Xy,createHex:()=>Wa,createHypot:()=>ic,createI:()=>bt,createIdentity:()=>fl,createIm:()=>Va,createImmutableDenseMatrixClass:()=>ac,createIndex:()=>Cf,createIndexClass:()=>oc,createIndexNode:()=>Ly,createIndexTransform:()=>Eb,createInfinity:()=>st,createIntersect:()=>Vf,createInv:()=>fp,createInverseConductanceQuantum:()=>Rt,createInvmod:()=>hl,createIsInteger:()=>Ha,createIsNaN:()=>cs,createIsNegative:()=>Qa,createIsNumeric:()=>_s,createIsPositive:()=>to,createIsPrime:()=>fs,createIsZero:()=>ro,createKldivergence:()=>wp,createKlitzing:()=>Pt,createKron:()=>uc,createLN10:()=>dt,createLN2:()=>ht,createLOG10E:()=>gt,createLOG2E:()=>mt,createLarger:()=>ml,createLargerEq:()=>lc,createLcm:()=>Sf,createLeftShift:()=>hc,createLog:()=>gl,createLog10:()=>ao,createLog1p:()=>np,createLog2:()=>so,createLoschmidt:()=>an,createLsolve:()=>gc,createLsolveAll:()=>yl,createLup:()=>sp,createLusolve:()=>dp,createMad:()=>Bp,createMagneticConstant:()=>Dt,createMagneticFluxQuantum:()=>Bt,createMap:()=>uo,createMapTransform:()=>gb,createMatrix:()=>Ts,createMatrixClass:()=>Nn,createMatrixFromColumns:()=>yc,createMatrixFromFunction:()=>Is,createMatrixFromRows:()=>xl,createMax:()=>Nf,createMaxTransform:()=>Nb,createMean:()=>Cp,createMeanTransform:()=>Tb,createMedian:()=>Np,createMin:()=>bc,createMinTransform:()=>Ab,createMod:()=>Us,createMode:()=>wc,createMolarMass:()=>hn,createMolarMassC12:()=>dn,createMolarPlanckConstant:()=>sn,createMolarVolume:()=>un,createMultinomial:()=>Fp,createMultiply:()=>El,createMultiplyScalar:()=>lo,createNaN:()=>ut,createNeutronMass:()=>Gt,createNode:()=>ly,createNorm:()=>Lp,createNot:()=>vo,createNthRoot:()=>$s,createNthRoots:()=>Cc,createNuclearMagneton:()=>zt,createNull:()=>ot,createNumber:()=>yo,createNumeric:()=>Xs,createObjectNode:()=>fy,createOct:()=>bo,createOnes:()=>Sc,createOperatorNode:()=>Cy,createOr:()=>Ys,createParenthesisNode:()=>Sy,createParse:()=>Vy,createParser:()=>Zy,createParserClass:()=>Yy,createPartitionSelect:()=>Ac,createPermutations:()=>Hf,createPhi:()=>pt,createPi:()=>ct,createPickRandom:()=>So,createPlanckCharge:()=>bn,createPlanckConstant:()=>At,createPlanckLength:()=>gn,createPlanckMass:()=>vn,createPlanckTemperature:()=>xn,createPlanckTime:()=>yn,createPow:()=>Cl,createPrint:()=>Ao,createProd:()=>Qs,createProtonMass:()=>$t,createQr:()=>Sl,createQuantileSeq:()=>Af,createQuantumOfCirculation:()=>Kt,createRandom:()=>Mo,createRandomInt:()=>hs,createRange:()=>Al,createRangeClass:()=>An,createRangeNode:()=>My,createRangeTransform:()=>kb,createRationalize:()=>fb,createRe:()=>To,createReducedPlanckConstant:()=>kt,createRelationalNode:()=>Ny,createReplacer:()=>ur,createReshape:()=>tu,createResize:()=>Dc,createResultSet:()=>kn,createReviver:()=>Ty,createRightArithShift:()=>Dl,createRightLogShift:()=>Mc,createRotate:()=>$p,createRotationMatrix:()=>qp,createRound:()=>Bc,createRow:()=>_l,createRowTransform:()=>Db,createRydberg:()=>Xt,createSQRT1_2:()=>vt,createSQRT2:()=>yt,createSackurTetrode:()=>cn,createSec:()=>Oo,createSech:()=>ms,createSecondRadiation:()=>ln,createSetCartesian:()=>Tl,createSetDifference:()=>Df,createSetDistinct:()=>Il,createSetIntersect:()=>Xf,createSetIsSubset:()=>Rl,createSetMultiplicity:()=>Mf,createSetPowerset:()=>zl,createSetSize:()=>cp,createSetSymDifference:()=>Of,createSetUnion:()=>Jf,createSign:()=>Fo,createSimplify:()=>rb,createSin:()=>Ro,createSinh:()=>vs,createSize:()=>ru,createSlu:()=>Yl,createSmaller:()=>ou,createSmallerEq:()=>Lc,createSort:()=>Ff,createSpaClass:()=>Zf,createSparse:()=>bs,createSparseMatrixClass:()=>Bo,createSpeedOfLight:()=>St,createSplitUnit:()=>Po,createSqrt:()=>xs,createSqrtm:()=>gp,createSquare:()=>jo,createSqueeze:()=>uu,createStd:()=>_p,createStdTransform:()=>Fb,createStefanBoltzmann:()=>fn,createStirlingS2:()=>ip,createString:()=>qo,createSubset:()=>lu,createSubsetTransform:()=>Cb,createSubtract:()=>vu,createSum:()=>Jl,createSumTransform:()=>_b,createSymbolNode:()=>jy,createTan:()=>Wo,createTanh:()=>ws,createTau:()=>lt,createThomsonCrossSection:()=>Yt,createTo:()=>bu,createTrace:()=>Zl,createTranspose:()=>xu,createTrue:()=>it,createTypeOf:()=>$o,createTyped:()=>Cr,createUnaryMinus:()=>Cs,createUnaryPlus:()=>ii,createUnequal:()=>Uc,createUnitClass:()=>zf,createUnitFunction:()=>ep,createUppercaseE:()=>wt,createUppercasePi:()=>xt,createUsolve:()=>Wc,createUsolveAll:()=>ef,createVacuumImpedance:()=>Mt,createVariance:()=>Dp,createVarianceTransform:()=>Ib,createVersion:()=>Et,createWeakMixingAngle:()=>Jt,createWienDisplacement:()=>pn,createXgcd:()=>Eu,createXor:()=>Vc,createZeros:()=>Su});var i={};n.r(i),n.d(i,{AccessorNode:()=>Zb,AccessorNodeDependencies:()=>Nx,ArgumentsError:()=>kc,ArrayNode:()=>Vb,ArrayNodeDependencies:()=>Ux,AssignmentNode:()=>Qb,AssignmentNodeDependencies:()=>Hx,BigNumber:()=>Hp,BigNumberDependencies:()=>hx,BlockNode:()=>$b,BlockNodeDependencies:()=>Iw,Chain:()=>Pb,ChainDependencies:()=>jw,Complex:()=>Gp,ComplexDependencies:()=>dx,ConditionalNode:()=>Hb,ConditionalNodeDependencies:()=>nE,ConstantNode:()=>Gb,ConstantNodeDependencies:()=>rE,DenseMatrix:()=>hh,DenseMatrixDependencies:()=>gx,DimensionError:()=>Bn,EDependencies:()=>mA,FibonacciHeap:()=>kg,FibonacciHeapDependencies:()=>PE,Fraction:()=>Jp,FractionDependencies:()=>vx,FunctionAssignmentNode:()=>Jb,FunctionAssignmentNodeDependencies:()=>iE,FunctionNode:()=>nx,FunctionNodeDependencies:()=>oE,Help:()=>ox,HelpDependencies:()=>PC,ImmutableDenseMatrix:()=>Nm,ImmutableDenseMatrixDependencies:()=>$w,Index:()=>Am,IndexDependencies:()=>Hw,IndexError:()=>zn,IndexNode:()=>ex,IndexNodeDependencies:()=>uE,InfinityDependencies:()=>$C,LN10:()=>eh,LN10Dependencies:()=>iS,LN2:()=>mh,LN2Dependencies:()=>aS,LOG10E:()=>th,LOG10EDependencies:()=>oS,LOG2E:()=>rd,LOG2EDependencies:()=>sS,Matrix:()=>nh,MatrixDependencies:()=>mx,NaNDependencies:()=>LS,Node:()=>Lb,NodeDependencies:()=>xx,ObjectNode:()=>jb,ObjectNodeDependencies:()=>cE,OperatorNode:()=>Ub,OperatorNodeDependencies:()=>lE,PIDependencies:()=>gA,ParenthesisNode:()=>qb,ParenthesisNodeDependencies:()=>fE,Parser:()=>sx,ParserDependencies:()=>XS,Range:()=>oh,RangeDependencies:()=>sE,RangeNode:()=>Kb,RangeNodeDependencies:()=>pE,RelationalNode:()=>Wb,RelationalNodeDependencies:()=>hE,ResultSet:()=>sh,ResultSetDependencies:()=>Ow,SQRT1_2:()=>uh,SQRT1_2Dependencies:()=>kN,SQRT2:()=>yh,SQRT2Dependencies:()=>DN,Spa:()=>yv,SpaDependencies:()=>LE,SparseMatrix:()=>yd,SparseMatrixDependencies:()=>Ex,SymbolNode:()=>tx,SymbolNodeDependencies:()=>aE,Unit:()=>Pg,UnitDependencies:()=>vw,_Infinity:()=>Qp,_NaN:()=>rh,_false:()=>Xp,_null:()=>ih,_true:()=>fh,abs:()=>Eh,absDependencies:()=>bx,acos:()=>Ch,acosDependencies:()=>Ax,acosh:()=>Sd,acoshDependencies:()=>kx,acot:()=>Sh,acotDependencies:()=>Dx,acoth:()=>Ud,acothDependencies:()=>_x,acsc:()=>Nh,acscDependencies:()=>Mx,acsch:()=>Nd,acschDependencies:()=>Tx,add:()=>Vm,addDependencies:()=>Ix,addScalar:()=>Ah,addScalarDependencies:()=>Ox,all:()=>CA,and:()=>um,andDependencies:()=>Bx,apply:()=>Ad,applyDependencies:()=>Px,applyTransformDependencies:()=>Lx,arg:()=>kh,argDependencies:()=>jx,asec:()=>kd,asecDependencies:()=>qx,asech:()=>Dh,asechDependencies:()=>Wx,asin:()=>xg,asinDependencies:()=>Vx,asinh:()=>_h,asinhDependencies:()=>$x,atan:()=>Mh,atan2:()=>$m,atan2Dependencies:()=>Kx,atanDependencies:()=>Gx,atanh:()=>Th,atanhDependencies:()=>Xx,atomicMass:()=>Ug,atomicMassDependencies:()=>yw,avogadro:()=>wv,avogadroDependencies:()=>bw,bellNumbers:()=>Rv,bellNumbersDependencies:()=>Aw,bignumber:()=>Oh,bignumberDependencies:()=>Yx,bin:()=>Dd,binDependencies:()=>kw,bitAnd:()=>cm,bitAndDependencies:()=>Dw,bitNot:()=>Ih,bitNotDependencies:()=>_w,bitOr:()=>Hm,bitOrDependencies:()=>Mw,bitXor:()=>lm,bitXorDependencies:()=>Tw,bohrMagneton:()=>qg,bohrMagnetonDependencies:()=>Fw,bohrRadius:()=>Ev,bohrRadiusDependencies:()=>Rw,boltzmann:()=>Wg,boltzmannDependencies:()=>Bw,boolean:()=>Fh,booleanDependencies:()=>zw,catalan:()=>Gm,catalanDependencies:()=>Pw,cbrt:()=>fm,cbrtDependencies:()=>Lw,ceil:()=>wg,ceilDependencies:()=>rw,chain:()=>Yb,chainDependencies:()=>Uw,classicalElectronRadius:()=>qv,classicalElectronRadiusDependencies:()=>qw,clone:()=>Rh,cloneDependencies:()=>Ww,column:()=>Eg,columnDependencies:()=>Yw,columnTransformDependencies:()=>Jw,combinations:()=>Bh,combinationsDependencies:()=>ww,combinationsWithRep:()=>_d,combinationsWithRepDependencies:()=>Zw,compare:()=>pm,compareDependencies:()=>Qw,compareNatural:()=>Km,compareNaturalDependencies:()=>eE,compareText:()=>hm,compareTextDependencies:()=>tE,compile:()=>ix,compileDependencies:()=>mE,complex:()=>zh,complexDependencies:()=>gE,composition:()=>Cg,compositionDependencies:()=>yE,concat:()=>dm,concatDependencies:()=>bE,concatTransformDependencies:()=>xE,conductanceQuantum:()=>Vg,conductanceQuantumDependencies:()=>wE,config:()=>ve,conj:()=>Ph,conjDependencies:()=>lw,cos:()=>Md,cosDependencies:()=>EE,cosh:()=>Lh,coshDependencies:()=>CE,cot:()=>qd,cotDependencies:()=>SE,coth:()=>jh,cothDependencies:()=>NE,coulomb:()=>Cv,coulombDependencies:()=>AE,count:()=>mm,countDependencies:()=>DE,create:()=>NA,createAbs:()=>ai,createAccessorNode:()=>zy,createAcos:()=>si,createAcosh:()=>Go,createAcot:()=>Ai,createAcoth:()=>Ns,createAcsc:()=>Di,createAcsch:()=>Xo,createAdd:()=>$c,createAddScalar:()=>Mi,createAnd:()=>Nu,createApply:()=>Jo,createApplyTransform:()=>yb,createArg:()=>Ti,createArrayNode:()=>Ay,createAsec:()=>es,createAsech:()=>Ii,createAsin:()=>nf,createAsinh:()=>Fi,createAssignmentNode:()=>Py,createAtan:()=>Ri,createAtan2:()=>Kc,createAtanh:()=>zi,createAtomicMass:()=>Qt,createAvogadro:()=>en,createBellNumbers:()=>op,createBigNumberClass:()=>Ee,createBignumber:()=>Pi,createBin:()=>ts,createBitAnd:()=>ku,createBitNot:()=>na,createBitOr:()=>Yc,createBitXor:()=>_u,createBlockNode:()=>ky,createBohrMagneton:()=>It,createBohrRadius:()=>Lt,createBoltzmann:()=>tn,createBoolean:()=>ia,createCatalan:()=>Zc,createCbrt:()=>Tu,createCeil:()=>rf,createChain:()=>Iy,createChainClass:()=>uy,createClassicalElectronRadius:()=>jt,createClone:()=>oa,createColumn:()=>of,createColumnTransform:()=>Mb,createCombinations:()=>la,createCombinationsWithRep:()=>rs,createCompare:()=>Iu,createCompareNatural:()=>tl,createCompareText:()=>Ru,createCompile:()=>Hy,createComplex:()=>pa,createComplexClass:()=>He,createComposition:()=>uf,createConcat:()=>zu,createConcatTransform:()=>Sb,createConditionalNode:()=>Dy,createConductanceQuantum:()=>Ft,createConj:()=>da,createConstantNode:()=>_y,createCos:()=>as,createCosh:()=>ga,createCot:()=>As,createCoth:()=>ya,createCoulomb:()=>Tt,createCount:()=>ju,createCreateUnit:()=>Lf,createCross:()=>lf,createCsc:()=>ba,createCsch:()=>ss,createCtranspose:()=>qu,createCube:()=>wa,createDeepEqual:()=>rl,createDenseMatrixClass:()=>sr,createDerivative:()=>ib,createDet:()=>lp,createDeuteronMass:()=>Ht,createDiag:()=>Vu,createDiff:()=>al,createDiffTransform:()=>wb,createDistance:()=>pf,createDivide:()=>vp,createDivideScalar:()=>Hu,createDot:()=>ol,createDotDivide:()=>Ku,createDotMultiply:()=>df,createDotPow:()=>Uf,createE:()=>ft,createEfimovFactor:()=>Zt,createEigs:()=>Tp,createElectricConstant:()=>_t,createElectronMass:()=>Ut,createElementaryCharge:()=>Ot,createEqual:()=>Yu,createEqualScalar:()=>Sa,createEqualText:()=>ul,createErf:()=>Na,createEvaluate:()=>Ky,createExp:()=>Ta,createExpm:()=>bp,createExpm1:()=>Ia,createFactorial:()=>Wf,createFalse:()=>at,createFaraday:()=>nn,createFermiCoupling:()=>qt,createFibonacciHeapClass:()=>mf,createFilter:()=>Fa,createFilterTransform:()=>hb,createFineStructure:()=>Wt,createFirstRadiation:()=>rn,createFix:()=>gf,createFlatten:()=>Zu,createFloor:()=>cl,createForEach:()=>za,createForEachTransform:()=>mb,createFormat:()=>ja,createFraction:()=>ks,createFractionClass:()=>Sn,createFunctionAssignmentNode:()=>Fy,createFunctionNode:()=>qy,createGamma:()=>wf,createGasConstant:()=>on,createGcd:()=>ec,createGetMatrixDataType:()=>qa,createGravitationConstant:()=>Nt,createGravity:()=>mn,createHartreeEnergy:()=>Vt,createHasNumericValue:()=>nc,createHelp:()=>cb,createHelpClass:()=>Xy,createHex:()=>Wa,createHypot:()=>ic,createI:()=>bt,createIdentity:()=>fl,createIm:()=>Va,createImmutableDenseMatrixClass:()=>ac,createIndex:()=>Cf,createIndexClass:()=>oc,createIndexNode:()=>Ly,createIndexTransform:()=>Eb,createInfinity:()=>st,createIntersect:()=>Vf,createInv:()=>fp,createInverseConductanceQuantum:()=>Rt,createInvmod:()=>hl,createIsInteger:()=>Ha,createIsNaN:()=>cs,createIsNegative:()=>Qa,createIsNumeric:()=>_s,createIsPositive:()=>to,createIsPrime:()=>fs,createIsZero:()=>ro,createKldivergence:()=>wp,createKlitzing:()=>Pt,createKron:()=>uc,createLN10:()=>dt,createLN2:()=>ht,createLOG10E:()=>gt,createLOG2E:()=>mt,createLarger:()=>ml,createLargerEq:()=>lc,createLcm:()=>Sf,createLeftShift:()=>hc,createLog:()=>gl,createLog10:()=>ao,createLog1p:()=>np,createLog2:()=>so,createLoschmidt:()=>an,createLsolve:()=>gc,createLsolveAll:()=>yl,createLup:()=>sp,createLusolve:()=>dp,createMad:()=>Bp,createMagneticConstant:()=>Dt,createMagneticFluxQuantum:()=>Bt,createMap:()=>uo,createMapTransform:()=>gb,createMatrix:()=>Ts,createMatrixClass:()=>Nn,createMatrixFromColumns:()=>yc,createMatrixFromFunction:()=>Is,createMatrixFromRows:()=>xl,createMax:()=>Nf,createMaxTransform:()=>Nb,createMean:()=>Cp,createMeanTransform:()=>Tb,createMedian:()=>Np,createMin:()=>bc,createMinTransform:()=>Ab,createMod:()=>Us,createMode:()=>wc,createMolarMass:()=>hn,createMolarMassC12:()=>dn,createMolarPlanckConstant:()=>sn,createMolarVolume:()=>un,createMultinomial:()=>Fp,createMultiply:()=>El,createMultiplyScalar:()=>lo,createNaN:()=>ut,createNeutronMass:()=>Gt,createNode:()=>ly,createNorm:()=>Lp,createNot:()=>vo,createNthRoot:()=>$s,createNthRoots:()=>Cc,createNuclearMagneton:()=>zt,createNull:()=>ot,createNumber:()=>yo,createNumeric:()=>Xs,createObjectNode:()=>fy,createOct:()=>bo,createOnes:()=>Sc,createOperatorNode:()=>Cy,createOr:()=>Ys,createParenthesisNode:()=>Sy,createParse:()=>Vy,createParser:()=>Zy,createParserClass:()=>Yy,createPartitionSelect:()=>Ac,createPermutations:()=>Hf,createPhi:()=>pt,createPi:()=>ct,createPickRandom:()=>So,createPlanckCharge:()=>bn,createPlanckConstant:()=>At,createPlanckLength:()=>gn,createPlanckMass:()=>vn,createPlanckTemperature:()=>xn,createPlanckTime:()=>yn,createPow:()=>Cl,createPrint:()=>Ao,createProd:()=>Qs,createProtonMass:()=>$t,createQr:()=>Sl,createQuantileSeq:()=>Af,createQuantumOfCirculation:()=>Kt,createRandom:()=>Mo,createRandomInt:()=>hs,createRange:()=>Al,createRangeClass:()=>An,createRangeNode:()=>My,createRangeTransform:()=>kb,createRationalize:()=>fb,createRe:()=>To,createReducedPlanckConstant:()=>kt,createRelationalNode:()=>Ny,createReplacer:()=>ur,createReshape:()=>tu,createResize:()=>Dc,createResultSet:()=>kn,createReviver:()=>Ty,createRightArithShift:()=>Dl,createRightLogShift:()=>Mc,createRotate:()=>$p,createRotationMatrix:()=>qp,createRound:()=>Bc,createRow:()=>_l,createRowTransform:()=>Db,createRydberg:()=>Xt,createSQRT1_2:()=>vt,createSQRT2:()=>yt,createSackurTetrode:()=>cn,createSec:()=>Oo,createSech:()=>ms,createSecondRadiation:()=>ln,createSetCartesian:()=>Tl,createSetDifference:()=>Df,createSetDistinct:()=>Il,createSetIntersect:()=>Xf,createSetIsSubset:()=>Rl,createSetMultiplicity:()=>Mf,createSetPowerset:()=>zl,createSetSize:()=>cp,createSetSymDifference:()=>Of,createSetUnion:()=>Jf,createSign:()=>Fo,createSimplify:()=>rb,createSin:()=>Ro,createSinh:()=>vs,createSize:()=>ru,createSlu:()=>Yl,createSmaller:()=>ou,createSmallerEq:()=>Lc,createSort:()=>Ff,createSpaClass:()=>Zf,createSparse:()=>bs,createSparseMatrixClass:()=>Bo,createSpeedOfLight:()=>St,createSplitUnit:()=>Po,createSqrt:()=>xs,createSqrtm:()=>gp,createSquare:()=>jo,createSqueeze:()=>uu,createStd:()=>_p,createStdTransform:()=>Fb,createStefanBoltzmann:()=>fn,createStirlingS2:()=>ip,createString:()=>qo,createSubset:()=>lu,createSubsetTransform:()=>Cb,createSubtract:()=>vu,createSum:()=>Jl,createSumTransform:()=>_b,createSymbolNode:()=>jy,createTan:()=>Wo,createTanh:()=>ws,createTau:()=>lt,createThomsonCrossSection:()=>Yt,createTo:()=>bu,createTrace:()=>Zl,createTranspose:()=>xu,createTrue:()=>it,createTypeOf:()=>$o,createTyped:()=>Cr,createUnaryMinus:()=>Cs,createUnaryPlus:()=>ii,createUnequal:()=>Uc,createUnit:()=>$g,createUnitClass:()=>zf,createUnitDependencies:()=>_E,createUnitFunction:()=>ep,createUppercaseE:()=>wt,createUppercasePi:()=>xt,createUsolve:()=>Wc,createUsolveAll:()=>ef,createVacuumImpedance:()=>Mt,createVariance:()=>Dp,createVarianceTransform:()=>Ib,createVersion:()=>Et,createWeakMixingAngle:()=>Jt,createWienDisplacement:()=>pn,createXgcd:()=>Eu,createXor:()=>Vc,createZeros:()=>Su,cross:()=>Sg,crossDependencies:()=>ME,csc:()=>Uh,cscDependencies:()=>TE,csch:()=>Td,cschDependencies:()=>OE,ctranspose:()=>gm,ctransposeDependencies:()=>FE,cube:()=>qh,cubeDependencies:()=>RE,deepEqual:()=>Xm,deepEqualDependencies:()=>BE,derivative:()=>lx,derivativeDependencies:()=>$E,det:()=>Wv,detDependencies:()=>UE,deuteronMass:()=>Hg,deuteronMassDependencies:()=>HE,diag:()=>vm,diagDependencies:()=>GE,diff:()=>Ym,diffDependencies:()=>KE,diffTransformDependencies:()=>XE,distance:()=>Ng,distanceDependencies:()=>JE,divide:()=>Kv,divideDependencies:()=>WE,divideScalar:()=>ym,divideScalarDependencies:()=>ew,docs:()=>sb,dot:()=>Jm,dotDependencies:()=>pw,dotDivide:()=>bm,dotDivideDependencies:()=>ZE,dotMultiply:()=>Ag,dotMultiplyDependencies:()=>QE,dotPow:()=>Gg,dotPowDependencies:()=>eC,e:()=>Kp,eDependencies:()=>tC,efimovFactor:()=>dh,efimovFactorDependencies:()=>nC,eigs:()=>ny,eigsDependencies:()=>pC,electricConstant:()=>Kg,electricConstantDependencies:()=>hC,electronMass:()=>Sv,electronMassDependencies:()=>dC,elementaryCharge:()=>Xg,elementaryChargeDependencies:()=>mC,equal:()=>xm,equalDependencies:()=>tw,equalScalar:()=>Wh,equalScalarDependencies:()=>wx,equalText:()=>Zm,equalTextDependencies:()=>gC,erf:()=>Vh,erfDependencies:()=>vC,evaluate:()=>ax,evaluateDependencies:()=>yC,exp:()=>$h,expDependencies:()=>bC,expm:()=>Xv,expm1:()=>Hh,expm1Dependencies:()=>wC,expmDependencies:()=>xC,factorial:()=>Yg,factorialDependencies:()=>Cw,factory:()=>be,falseDependencies:()=>EC,faraday:()=>Nv,faradayDependencies:()=>CC,fermiCoupling:()=>Jg,fermiCouplingDependencies:()=>SC,filter:()=>Gh,filterDependencies:()=>NC,filterTransformDependencies:()=>AC,fineStructure:()=>Yp,fineStructureDependencies:()=>kC,firstRadiation:()=>Bv,firstRadiationDependencies:()=>DC,fix:()=>Dg,fixDependencies:()=>aw,flatten:()=>wm,flattenDependencies:()=>rC,floor:()=>Qm,floorDependencies:()=>iw,forEach:()=>Kh,forEachDependencies:()=>_C,forEachTransformDependencies:()=>MC,format:()=>Xh,formatDependencies:()=>ow,fraction:()=>Wd,fractionDependencies:()=>Jx,gamma:()=>_g,gammaDependencies:()=>Ew,gasConstant:()=>Zg,gasConstantDependencies:()=>TC,gcd:()=>Em,gcdDependencies:()=>OC,getMatrixDataType:()=>Yh,getMatrixDataTypeDependencies:()=>IC,gravitationConstant:()=>Vv,gravitationConstantDependencies:()=>FC,gravity:()=>Qg,gravityDependencies:()=>RC,hartreeEnergy:()=>Av,hartreeEnergyDependencies:()=>BC,hasNumericValue:()=>Cm,hasNumericValueDependencies:()=>zC,help:()=>fx,helpDependencies:()=>LC,hex:()=>Jh,hexDependencies:()=>jC,hypot:()=>Sm,hypotDependencies:()=>UC,i:()=>Zp,iDependencies:()=>qC,identity:()=>eg,identityDependencies:()=>cw,im:()=>Zh,imDependencies:()=>iC,index:()=>Mg,indexDependencies:()=>WC,indexTransformDependencies:()=>VC,intersect:()=>ev,intersectDependencies:()=>HC,inv:()=>$v,invDependencies:()=>qE,inverseConductanceQuantum:()=>tv,inverseConductanceQuantumDependencies:()=>GC,invmod:()=>tg,invmodDependencies:()=>YC,isAccessorNode:()=>j,isArray:()=>S,isArrayNode:()=>U,isAssignmentNode:()=>q,isBigNumber:()=>b,isBlockNode:()=>W,isBoolean:()=>T,isChain:()=>te,isCollection:()=>A,isComplex:()=>x,isConditionalNode:()=>V,isConstantNode:()=>$,isDate:()=>R,isDenseMatrix:()=>k,isFraction:()=>w,isFunction:()=>F,isFunctionAssignmentNode:()=>H,isFunctionNode:()=>G,isHelp:()=>I,isIndex:()=>M,isIndexNode:()=>K,isInteger:()=>Qh,isIntegerDependencies:()=>zx,isMatrix:()=>N,isNaN:()=>Od,isNaNDependencies:()=>JC,isNegative:()=>ed,isNegativeDependencies:()=>xw,isNode:()=>X,isNull:()=>P,isNumber:()=>y,isNumeric:()=>Vd,isNumericDependencies:()=>sw,isObject:()=>z,isObjectNode:()=>Y,isOperatorNode:()=>J,isParenthesisNode:()=>Z,isPositive:()=>td,isPositiveDependencies:()=>vE,isPrime:()=>Id,isPrimeDependencies:()=>ZC,isRange:()=>_,isRangeNode:()=>Q,isRegExp:()=>B,isResultSet:()=>O,isSparseMatrix:()=>D,isString:()=>C,isSymbolNode:()=>ee,isUndefined:()=>L,isUnit:()=>E,isZero:()=>nd,isZeroDependencies:()=>zE,kldivergence:()=>Yv,kldivergenceDependencies:()=>tS,klitzing:()=>nv,klitzingDependencies:()=>nS,kron:()=>km,kronDependencies:()=>rS,larger:()=>ng,largerDependencies:()=>Sw,largerEq:()=>Dm,largerEqDependencies:()=>Gw,lcm:()=>Tg,lcmDependencies:()=>uS,leftShift:()=>_m,leftShiftDependencies:()=>cS,log:()=>rg,log10:()=>id,log10Dependencies:()=>lS,log1p:()=>kv,log1pDependencies:()=>fS,log2:()=>ad,log2Dependencies:()=>pS,logDependencies:()=>QC,loschmidt:()=>rv,loschmidtDependencies:()=>hS,lsolve:()=>Mm,lsolveAll:()=>ig,lsolveAllDependencies:()=>mS,lsolveDependencies:()=>dS,lup:()=>zv,lupDependencies:()=>jE,lusolve:()=>Hv,lusolveDependencies:()=>vS,mad:()=>iy,madDependencies:()=>wS,magneticConstant:()=>iv,magneticConstantDependencies:()=>ES,magneticFluxQuantum:()=>Dv,magneticFluxQuantumDependencies:()=>CS,map:()=>od,mapDependencies:()=>yS,mapTransformDependencies:()=>SS,matrix:()=>$d,matrixDependencies:()=>Cx,matrixFromColumns:()=>Tm,matrixFromColumnsDependencies:()=>aC,matrixFromFunction:()=>Hd,matrixFromFunctionDependencies:()=>NS,matrixFromRows:()=>ag,matrixFromRowsDependencies:()=>AS,max:()=>Og,maxDependencies:()=>kS,maxTransformDependencies:()=>DS,mean:()=>Jv,meanDependencies:()=>_S,meanTransformDependencies:()=>MS,median:()=>Zv,medianDependencies:()=>xS,min:()=>Om,minDependencies:()=>TS,minTransformDependencies:()=>OS,mod:()=>Gd,modDependencies:()=>KC,mode:()=>Im,modeDependencies:()=>IS,molarMass:()=>av,molarMassC12:()=>_v,molarMassC12Dependencies:()=>RS,molarMassDependencies:()=>FS,molarPlanckConstant:()=>ov,molarPlanckConstantDependencies:()=>BS,molarVolume:()=>Pv,molarVolumeDependencies:()=>zS,multinomial:()=>ry,multinomialDependencies:()=>PS,multiply:()=>og,multiplyDependencies:()=>hw,multiplyScalar:()=>sd,multiplyScalarDependencies:()=>uw,neutronMass:()=>sv,neutronMassDependencies:()=>jS,norm:()=>ay,normDependencies:()=>US,not:()=>ud,notDependencies:()=>Fx,nthRoot:()=>Kd,nthRootDependencies:()=>qS,nthRoots:()=>Fm,nthRootsDependencies:()=>WS,nuclearMagneton:()=>uv,nuclearMagnetonDependencies:()=>VS,nullDependencies:()=>$S,number:()=>cd,numberDependencies:()=>Zx,numeric:()=>Xd,numericDependencies:()=>Qx,oct:()=>ld,octDependencies:()=>HS,ones:()=>Rm,onesDependencies:()=>GS,or:()=>Yd,orDependencies:()=>KS,parse:()=>rx,parseDependencies:()=>dE,parser:()=>ux,parserDependencies:()=>YS,partitionSelect:()=>Bm,partitionSelectDependencies:()=>bS,permutations:()=>cv,permutationsDependencies:()=>JS,phi:()=>ah,phiDependencies:()=>ZS,pi:()=>gh,piDependencies:()=>QS,pickRandom:()=>fd,pickRandomDependencies:()=>eN,planckCharge:()=>Mv,planckChargeDependencies:()=>tN,planckConstant:()=>lv,planckConstantDependencies:()=>nN,planckLength:()=>Qv,planckLengthDependencies:()=>rN,planckMass:()=>fv,planckMassDependencies:()=>iN,planckTemperature:()=>Tv,planckTemperatureDependencies:()=>aN,planckTime:()=>pv,planckTimeDependencies:()=>oN,pow:()=>sg,powDependencies:()=>dw,print:()=>pd,printDependencies:()=>sN,prod:()=>Jd,prodDependencies:()=>kE,protonMass:()=>Lv,protonMassDependencies:()=>uN,qr:()=>ug,qrDependencies:()=>sC,quantileSeq:()=>Ig,quantileSeqDependencies:()=>cN,quantumOfCirculation:()=>hv,quantumOfCirculationDependencies:()=>lN,random:()=>hd,randomDependencies:()=>fN,randomInt:()=>Fd,randomIntDependencies:()=>pN,range:()=>cg,rangeDependencies:()=>Xw,rangeTransformDependencies:()=>hN,rationalize:()=>px,rationalizeDependencies:()=>dN,re:()=>dd,reDependencies:()=>uC,reducedPlanckConstant:()=>dv,reducedPlanckConstantDependencies:()=>mN,replacer:()=>vh,replacerDependencies:()=>gN,reshape:()=>Zd,reshapeDependencies:()=>vN,resize:()=>zm,resizeDependencies:()=>yN,reviver:()=>Xb,reviverDependencies:()=>bN,rightArithShift:()=>lg,rightArithShiftDependencies:()=>xN,rightLogShift:()=>Pm,rightLogShiftDependencies:()=>wN,rotate:()=>sy,rotateDependencies:()=>CN,rotationMatrix:()=>oy,rotationMatrixDependencies:()=>EN,round:()=>Lm,roundDependencies:()=>nw,row:()=>fg,rowDependencies:()=>SN,rowTransformDependencies:()=>NN,rydberg:()=>mv,rydbergDependencies:()=>AN,sackurTetrode:()=>ch,sackurTetrodeDependencies:()=>_N,sec:()=>md,secDependencies:()=>MN,sech:()=>Rd,sechDependencies:()=>TN,secondRadiation:()=>Ov,secondRadiationDependencies:()=>ON,setCartesian:()=>pg,setCartesianDependencies:()=>IN,setDifference:()=>Fg,setDifferenceDependencies:()=>FN,setDistinct:()=>hg,setDistinctDependencies:()=>RN,setIntersect:()=>gv,setIntersectDependencies:()=>BN,setIsSubset:()=>dg,setIsSubsetDependencies:()=>zN,setMultiplicity:()=>Rg,setMultiplicityDependencies:()=>PN,setPowerset:()=>mg,setPowersetDependencies:()=>LN,setSize:()=>jv,setSizeDependencies:()=>jN,setSymDifference:()=>Bg,setSymDifferenceDependencies:()=>UN,setUnion:()=>vv,setUnionDependencies:()=>qN,sign:()=>gd,signDependencies:()=>oC,simplify:()=>cx,simplifyDependencies:()=>VE,sin:()=>vd,sinDependencies:()=>cC,sinh:()=>Bd,sinhDependencies:()=>WN,size:()=>Qd,sizeDependencies:()=>fw,slu:()=>gg,sluDependencies:()=>gS,smaller:()=>em,smallerDependencies:()=>Vw,smallerEq:()=>jm,smallerEqDependencies:()=>Kw,sort:()=>zg,sortDependencies:()=>VN,sparse:()=>zd,sparseDependencies:()=>$N,speedOfLight:()=>Iv,speedOfLightDependencies:()=>HN,splitUnit:()=>bd,splitUnitDependencies:()=>GN,sqrt:()=>Pd,sqrtDependencies:()=>YE,sqrtm:()=>Gv,sqrtmDependencies:()=>KN,square:()=>xd,squareDependencies:()=>XN,squeeze:()=>tm,squeezeDependencies:()=>YN,std:()=>ty,stdDependencies:()=>ZN,stdTransformDependencies:()=>QN,stefanBoltzmann:()=>bv,stefanBoltzmannDependencies:()=>eA,stirlingS2:()=>Fv,stirlingS2Dependencies:()=>Nw,string:()=>wd,stringDependencies:()=>tA,subset:()=>nm,subsetDependencies:()=>Sx,subsetTransformDependencies:()=>nA,subtract:()=>rm,subtractDependencies:()=>gw,sum:()=>vg,sumDependencies:()=>eS,sumTransformDependencies:()=>rA,tan:()=>Ed,tanDependencies:()=>iA,tanh:()=>Ld,tanhDependencies:()=>aA,tau:()=>lh,tauDependencies:()=>oA,thomsonCrossSection:()=>Uv,thomsonCrossSectionDependencies:()=>sA,to:()=>im,toDependencies:()=>uA,trace:()=>yg,traceDependencies:()=>cA,transpose:()=>am,transposeDependencies:()=>IE,trueDependencies:()=>lA,typeOf:()=>Cd,typeOfDependencies:()=>fA,typed:()=>bh,typedDependencies:()=>yx,unaryMinus:()=>jd,unaryMinusDependencies:()=>mw,unaryPlus:()=>xh,unaryPlusDependencies:()=>pA,unequal:()=>Um,unequalDependencies:()=>hA,unit:()=>xv,unitDependencies:()=>dA,usolve:()=>qm,usolveAll:()=>bg,usolveAllDependencies:()=>fC,usolveDependencies:()=>lC,vacuumImpedance:()=>Lg,vacuumImpedanceDependencies:()=>vA,variance:()=>ey,varianceDependencies:()=>JN,varianceTransformDependencies:()=>yA,version:()=>ph,versionDependencies:()=>bA,weakMixingAngle:()=>wh,weakMixingAngleDependencies:()=>xA,wienDisplacement:()=>jg,wienDisplacementDependencies:()=>wA,xgcd:()=>om,xgcdDependencies:()=>XC,xor:()=>Wm,xorDependencies:()=>EA,zeros:()=>sm,zerosDependencies:()=>Rx});var a={};n.r(a),n.d(a,{load:()=>LA});var o={};n.r(o),n.d(o,{Darknet:()=>$A,load:()=>HA});var s={};n.r(s),n.d(s,{Doodlenet:()=>KA,load:()=>XA});var u={};n.r(u),n.d(u,{array3DToImage:()=>QA,cropImage:()=>ek,flipImage:()=>tk,imgToPixelArray:()=>ik,imgToTensor:()=>nk,isInstanceOfSupportedElement:()=>rk,processVideo:()=>ZA});var c={};n.r(c),n.d(c,{SpeechCommands:()=>Wk,load:()=>Vk});var l={};n.r(l),n.d(l,{AdadeltaOptimizer:()=>$W,AdagradOptimizer:()=>HW,AdamOptimizer:()=>GW,AdamaxOptimizer:()=>KW,DataStorage:()=>yR,ENV:()=>mM,Environment:()=>pM,KernelBackend:()=>bR,MomentumOptimizer:()=>YW,Optimizer:()=>VW,RMSPropOptimizer:()=>JW,Rank:()=>AT,Reduction:()=>LU,SGDOptimizer:()=>XW,Tensor:()=>NT,TensorBuffer:()=>wT,Variable:()=>TT,abs:()=>PP,acos:()=>LP,acosh:()=>jP,add:()=>PL,addN:()=>LL,addStrict:()=>jL,all:()=>rU,any:()=>iU,argMax:()=>aU,argMin:()=>oU,asin:()=>UP,asinh:()=>qP,atan:()=>WP,atan2:()=>UL,atanh:()=>VP,avgPool:()=>Gj,avgPool3d:()=>Yj,backend:()=>pI,backend_util:()=>LR,basicLSTMCell:()=>CU,batchNorm:()=>DL,batchNorm2d:()=>_L,batchNorm3d:()=>ML,batchNorm4d:()=>TL,batchNormalization:()=>kL,batchNormalization2d:()=>SL,batchNormalization3d:()=>NL,batchNormalization4d:()=>AL,batchToSpaceND:()=>gF,booleanMaskAsync:()=>wj,broadcastTo:()=>vF,browser:()=>IW,buffer:()=>dF,cast:()=>yF,ceil:()=>$P,clipByValue:()=>HP,clone:()=>bF,complex:()=>MI,concat:()=>YI,concat1d:()=>JI,concat2d:()=>ZI,concat3d:()=>QI,concat4d:()=>eF,conv1d:()=>Nj,conv2d:()=>Aj,conv2dTranspose:()=>Fj,conv3d:()=>kj,conv3dTranspose:()=>Rj,cos:()=>GP,cosh:()=>KP,cumsum:()=>xF,customGrad:()=>dR,deprecationWarn:()=>YO,depthToSpace:()=>wF,depthwiseConv2d:()=>Mj,diag:()=>BU,disableDeprecationWarnings:()=>XO,dispose:()=>nI,disposeVariables:()=>JO,div:()=>qL,divNoNan:()=>WL,divStrict:()=>VL,dot:()=>zj,dropout:()=>zU,elu:()=>dU,enableDebugMode:()=>KO,enableProdMode:()=>GO,engine:()=>ZO,env:()=>dM,equal:()=>aj,equalStrict:()=>oj,erf:()=>XP,exp:()=>YP,expandDims:()=>EF,expm1:()=>JP,eye:()=>CF,fft:()=>_U,fill:()=>$I,findBackend:()=>cI,findBackendFactory:()=>lI,floor:()=>ZP,floorDiv:()=>$L,frame:()=>qU,fused:()=>wq,gather:()=>bj,gatherND:()=>RU,gather_util:()=>XF,getBackend:()=>sI,getGradient:()=>bM,getKernel:()=>yM,getKernelsForBackend:()=>xM,grad:()=>cR,grads:()=>lR,greater:()=>sj,greaterEqual:()=>uj,greaterEqualStrict:()=>cj,greaterStrict:()=>lj,hammingWindow:()=>UU,hannWindow:()=>jU,ifft:()=>MU,imag:()=>OI,image:()=>hq,inTopKAsync:()=>$U,io:()=>_W,irfft:()=>OU,isFinite:()=>lL,isInf:()=>cL,isNaN:()=>uL,keep:()=>rI,leakyRelu:()=>mU,less:()=>fj,lessEqual:()=>pj,lessEqualStrict:()=>hj,lessStrict:()=>dj,linalg:()=>oq,linspace:()=>HI,localResponseNormalization:()=>wU,log:()=>QP,log1p:()=>eL,logSigmoid:()=>tL,logSoftmax:()=>vR,logSumExp:()=>sU,logicalAnd:()=>OL,logicalNot:()=>IL,logicalOr:()=>FL,logicalXor:()=>RL,losses:()=>tq,matMul:()=>Bj,math:()=>TW,max:()=>uU,maxPool:()=>Hj,maxPool3d:()=>Xj,maximum:()=>HL,maximumStrict:()=>GL,mean:()=>cU,memory:()=>QO,min:()=>lU,minimum:()=>KL,minimumStrict:()=>XL,mod:()=>YL,modStrict:()=>JL,moments:()=>fU,movingAverage:()=>NU,mul:()=>ZL,mulStrict:()=>QL,multiRNNCell:()=>SU,multinomial:()=>SF,neg:()=>nL,nextFrame:()=>tV,norm:()=>EU,notEqual:()=>mj,notEqualStrict:()=>gj,oneHot:()=>NF,ones:()=>WI,onesLike:()=>KI,op:()=>_I,outerProduct:()=>Pj,pad:()=>AF,pad1d:()=>kF,pad2d:()=>DF,pad3d:()=>_F,pad4d:()=>MF,pool:()=>Kj,pow:()=>ej,powStrict:()=>tj,prelu:()=>gU,print:()=>mF,prod:()=>hU,profile:()=>eI,rand:()=>TF,randomGamma:()=>IF,randomNormal:()=>OF,randomUniform:()=>FF,range:()=>GI,ready:()=>oI,real:()=>TI,reciprocal:()=>rL,registerBackend:()=>fI,registerGradient:()=>EM,registerKernel:()=>wM,relu:()=>vU,relu6:()=>yU,removeBackend:()=>uI,reshape:()=>RF,reverse:()=>Lj,reverse1d:()=>jj,reverse2d:()=>Uj,reverse3d:()=>qj,reverse4d:()=>Wj,rfft:()=>TU,round:()=>iL,rsqrt:()=>aL,scalar:()=>RI,scatterND:()=>DU,scatter_util:()=>eR,selu:()=>bU,separableConv2d:()=>Ij,serialization:()=>zW,setBackend:()=>aI,setPlatform:()=>hI,setdiff1dAsync:()=>qF,sigmoid:()=>oL,sign:()=>sL,signal:()=>VU,sin:()=>fL,sinh:()=>pL,slice:()=>Jj,slice1d:()=>Zj,slice2d:()=>Qj,slice3d:()=>eU,slice4d:()=>tU,slice_util:()=>uR,softmax:()=>gR,softplus:()=>hL,spaceToBatchND:()=>BF,sparseToDense:()=>FU,spectral:()=>IU,split:()=>tF,sqrt:()=>dL,square:()=>RP,squaredDifference:()=>zP,squaredDifferenceStrict:()=>nj,squeeze:()=>zF,stack:()=>PF,step:()=>mL,stft:()=>WU,stridedSlice:()=>AU,sub:()=>rj,subStrict:()=>ij,sum:()=>pU,sumOutType:()=>FT,tan:()=>gL,tanh:()=>vL,tensor:()=>II,tensor1d:()=>BI,tensor2d:()=>zI,tensor3d:()=>PI,tensor4d:()=>LI,tensor5d:()=>jI,tensor6d:()=>UI,tensor_util:()=>LT,test_util:()=>UW,tidy:()=>tI,tile:()=>LF,time:()=>iI,topk:()=>kU,train:()=>QW,transpose:()=>xU,truncatedNormal:()=>jF,unregisterGradient:()=>SM,unregisterKernel:()=>CM,unsortedSegmentSum:()=>xj,unstack:()=>UF,util:()=>mT,valueAndGrad:()=>fR,valueAndGrads:()=>pR,variable:()=>qI,variableGrads:()=>hR,version_core:()=>qW,webgl:()=>WW,where:()=>BL,whereAsync:()=>zL,zeros:()=>VI,zerosLike:()=>XI});var f={};n.r(f),n.d(f,{computeReshapedDimensions:()=>bV,getCenterPoint:()=>xV,isDimensions:()=>yV,isEven:()=>gV,isFloat:()=>mV,isTensor:()=>lV,isTensor1D:()=>fV,isTensor2D:()=>pV,isTensor3D:()=>hV,isTensor4D:()=>dV,isValidNumber:()=>EV,isValidProbablitiy:()=>CV,range:()=>wV,round:()=>vV});var p={};n.r(p),n.d(p,{AnchorPosition:()=>t$,DrawBox:()=>u$,DrawBoxOptions:()=>s$,DrawFaceLandmarks:()=>aH,DrawFaceLandmarksOptions:()=>iH,DrawTextField:()=>o$,DrawTextFieldOptions:()=>a$,drawContour:()=>nV,drawDetections:()=>c$,drawFaceExpressions:()=>tH,drawFaceLandmarks:()=>oH});var h={};n.r(h),n.d(h,{AgeGenderNet:()=>fH,BoundingBox:()=>AV,Box:()=>NV,ComposableTask:()=>QH,ComputeAllFaceDescriptorsTask:()=>KG,ComputeFaceDescriptorsTaskBase:()=>GG,ComputeSingleFaceDescriptorTask:()=>XG,DetectAllFaceLandmarksTask:()=>JG,DetectAllFacesTask:()=>eK,DetectFaceLandmarksTaskBase:()=>YG,DetectFacesTaskBase:()=>QG,DetectSingleFaceLandmarksTask:()=>ZG,DetectSingleFaceTask:()=>tK,Dimensions:()=>cV,FACE_EXPRESSION_LABELS:()=>Y$,FaceDetection:()=>DV,FaceDetectionNet:()=>LH,FaceExpressionNet:()=>Z$,FaceExpressions:()=>J$,FaceLandmark68Net:()=>hH,FaceLandmark68TinyNet:()=>mH,FaceLandmarkNet:()=>gH,FaceLandmarks:()=>LV,FaceLandmarks5:()=>jV,FaceLandmarks68:()=>UV,FaceMatch:()=>qV,FaceMatcher:()=>cK,FaceRecognitionNet:()=>CH,Gender:()=>cH,LabeledBox:()=>WV,LabeledFaceDescriptors:()=>VV,Mtcnn:()=>fG,MtcnnOptions:()=>MH,NetInput:()=>b$,NeuralNetwork:()=>M$,ObjectDetection:()=>kV,Point:()=>SV,PredictedBox:()=>$V,Rect:()=>PV,SsdMobilenetv1:()=>RH,SsdMobilenetv1Options:()=>FH,TinyFaceDetector:()=>dG,TinyFaceDetectorOptions:()=>ZH,TinyYolov2:()=>YH,TinyYolov2Options:()=>KH,TinyYolov2SizeType:()=>PH,allFaces:()=>sK,allFacesMtcnn:()=>oK,allFacesSsdMobilenetv1:()=>iK,allFacesTinyYolov2:()=>aK,awaitMediaLoaded:()=>f$,bufferToImage:()=>p$,computeFaceDescriptor:()=>EG,createCanvas:()=>d$,createCanvasFromMedia:()=>m$,createFaceDetectionNet:()=>zH,createFaceRecognitionNet:()=>SH,createMtcnn:()=>lK,createSsdMobilenetv1:()=>BH,createTinyFaceDetector:()=>fK,createTinyYolov2:()=>JH,detectAllFaces:()=>rK,detectFaceLandmarks:()=>xG,detectFaceLandmarksTiny:()=>wG,detectLandmarks:()=>BG,detectSingleFace:()=>nK,draw:()=>p,env:()=>n$,euclideanDistance:()=>uK,extendWithAge:()=>kH,extendWithFaceDescriptor:()=>NH,extendWithFaceDetection:()=>GV,extendWithFaceExpressions:()=>eH,extendWithFaceLandmarks:()=>rH,extendWithGender:()=>_H,extractFaceTensors:()=>E$,extractFaces:()=>w$,fetchImage:()=>S$,fetchJson:()=>N$,fetchNetWeights:()=>A$,fetchOrThrow:()=>C$,getContext2dOrThrow:()=>i$,getMediaDimensions:()=>h$,imageTensorToCanvas:()=>g$,imageToSquare:()=>y$,inverseSigmoid:()=>BV,iou:()=>_V,isMediaElement:()=>v$,isMediaLoaded:()=>l$,isWithAge:()=>AH,isWithFaceDetection:()=>HV,isWithFaceExpressions:()=>Q$,isWithFaceLandmarks:()=>nH,isWithGender:()=>DH,loadAgeGenderModel:()=>IG,loadFaceDetectionModel:()=>FG,loadFaceExpressionModel:()=>OG,loadFaceLandmarkModel:()=>_G,loadFaceLandmarkTinyModel:()=>MG,loadFaceRecognitionModel:()=>TG,loadMtcnnModel:()=>kG,loadSsdMobilenetv1Model:()=>NG,loadTinyFaceDetectorModel:()=>AG,loadTinyYolov2Model:()=>DG,loadWeightMap:()=>D$,locateFaces:()=>RG,matchDimensions:()=>_$,minBbox:()=>MV,mtcnn:()=>bG,nets:()=>mG,nonMaxSuppression:()=>TV,normalize:()=>OV,padToSquare:()=>IV,predictAgeAndGender:()=>SG,recognizeFaceExpressions:()=>CG,resizeResults:()=>pK,resolveInput:()=>r$,shuffleArray:()=>FV,sigmoid:()=>RV,ssdMobilenetv1:()=>gG,tf:()=>l,tinyFaceDetector:()=>vG,tinyYolov2:()=>yG,toNetInput:()=>x$,utils:()=>f,validateConfig:()=>VH});var d={};n.r(d),n.d(d,{getImageData:()=>wX,getRobin:()=>xX});var m=n(2099);function g(){return g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},g.apply(this,arguments)}var v={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};function y(e){return"number"==typeof e}function b(e){return!(!e||"object"!=typeof e||"function"!=typeof e.constructor)&&(!0===e.isBigNumber&&"object"==typeof e.constructor.prototype&&!0===e.constructor.prototype.isBigNumber||"function"==typeof e.constructor.isDecimal&&!0===e.constructor.isDecimal(e))}function x(e){return e&&"object"==typeof e&&!0===Object.getPrototypeOf(e).isComplex||!1}function w(e){return e&&"object"==typeof e&&!0===Object.getPrototypeOf(e).isFraction||!1}function E(e){return e&&!0===e.constructor.prototype.isUnit||!1}function C(e){return"string"==typeof e}var S=Array.isArray;function N(e){return e&&!0===e.constructor.prototype.isMatrix||!1}function A(e){return Array.isArray(e)||N(e)}function k(e){return e&&e.isDenseMatrix&&!0===e.constructor.prototype.isMatrix||!1}function D(e){return e&&e.isSparseMatrix&&!0===e.constructor.prototype.isMatrix||!1}function _(e){return e&&!0===e.constructor.prototype.isRange||!1}function M(e){return e&&!0===e.constructor.prototype.isIndex||!1}function T(e){return"boolean"==typeof e}function O(e){return e&&!0===e.constructor.prototype.isResultSet||!1}function I(e){return e&&!0===e.constructor.prototype.isHelp||!1}function F(e){return"function"==typeof e}function R(e){return e instanceof Date}function B(e){return e instanceof RegExp}function z(e){return!(!e||"object"!=typeof e||e.constructor!==Object||x(e)||w(e))}function P(e){return null===e}function L(e){return void 0===e}function j(e){return e&&!0===e.isAccessorNode&&!0===e.constructor.prototype.isNode||!1}function U(e){return e&&!0===e.isArrayNode&&!0===e.constructor.prototype.isNode||!1}function q(e){return e&&!0===e.isAssignmentNode&&!0===e.constructor.prototype.isNode||!1}function W(e){return e&&!0===e.isBlockNode&&!0===e.constructor.prototype.isNode||!1}function V(e){return e&&!0===e.isConditionalNode&&!0===e.constructor.prototype.isNode||!1}function $(e){return e&&!0===e.isConstantNode&&!0===e.constructor.prototype.isNode||!1}function H(e){return e&&!0===e.isFunctionAssignmentNode&&!0===e.constructor.prototype.isNode||!1}function G(e){return e&&!0===e.isFunctionNode&&!0===e.constructor.prototype.isNode||!1}function K(e){return e&&!0===e.isIndexNode&&!0===e.constructor.prototype.isNode||!1}function X(e){return e&&!0===e.isNode&&!0===e.constructor.prototype.isNode||!1}function Y(e){return e&&!0===e.isObjectNode&&!0===e.constructor.prototype.isNode||!1}function J(e){return e&&!0===e.isOperatorNode&&!0===e.constructor.prototype.isNode||!1}function Z(e){return e&&!0===e.isParenthesisNode&&!0===e.constructor.prototype.isNode||!1}function Q(e){return e&&!0===e.isRangeNode&&!0===e.constructor.prototype.isNode||!1}function ee(e){return e&&!0===e.isSymbolNode&&!0===e.constructor.prototype.isNode||!1}function te(e){return e&&!0===e.constructor.prototype.isChain||!1}function ne(e){var t=typeof e;return"object"===t?null===e?"null":Array.isArray(e)?"Array":e instanceof Date?"Date":e instanceof RegExp?"RegExp":b(e)?"BigNumber":x(e)?"Complex":w(e)?"Fraction":N(e)?"Matrix":E(e)?"Unit":M(e)?"Index":_(e)?"Range":O(e)?"ResultSet":X(e)?e.type:te(e)?"Chain":I(e)?"Help":"Object":"function"===t?"Function":t}function re(e){var t=typeof e;if("number"===t||"string"===t||"boolean"===t||null==e)return e;if("function"==typeof e.clone)return e.clone();if(Array.isArray(e))return e.map((function(e){return re(e)}));if(e instanceof Date)return new Date(e.valueOf());if(b(e))return e;if(e instanceof RegExp)throw new TypeError("Cannot clone "+e);return ie(e,re)}function ie(e,t){var n={};for(var r in e)fe(e,r)&&(n[r]=t(e[r]));return n}function ae(e,t){for(var n in t)fe(t,n)&&(e[n]=t[n]);return e}function oe(e,t){if(Array.isArray(t))throw new TypeError("Arrays are not supported by deepExtend");for(var n in t)if(fe(t,n)&&!(n in Object.prototype)&&!(n in Function.prototype))if(t[n]&&t[n].constructor===Object)void 0===e[n]&&(e[n]={}),e[n]&&e[n].constructor===Object?oe(e[n],t[n]):e[n]=t[n];else{if(Array.isArray(t[n]))throw new TypeError("Arrays are not supported by deepExtend");e[n]=t[n]}return e}function se(e,t){var n,r,i;if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(r=0,i=e.length;r<i;r++)if(!se(e[r],t[r]))return!1;return!0}if("function"==typeof e)return e===t;if(e instanceof Object){if(Array.isArray(t)||!(t instanceof Object))return!1;for(n in e)if(!(n in t)||!se(e[n],t[n]))return!1;for(n in t)if(!(n in e))return!1;return!0}return e===t}function ue(e){var t={};return ce(e,t),t}function ce(e,t){for(var n in e)if(fe(e,n)){var r=e[n];"object"==typeof r&&null!==r?ce(r,t):t[n]=r}}function le(e,t,n){var r,i=!0;Object.defineProperty(e,t,{get:function(){return i&&(r=n(),i=!1),r},set:function(e){r=e,i=!1},configurable:!0,enumerable:!0})}function fe(e,t){return e&&Object.hasOwnProperty.call(e,t)}function pe(e){return Object.keys(e).map((t=>e[t]))}var he=["Matrix","Array"],de=["number","BigNumber","Fraction"];function me(e,t){function n(n){if(n){var r=ie(e,re);ge(n,"matrix",he),ge(n,"number",de),oe(e,n);var i=ie(e,re),a=ie(n,re);return t("config",i,r,a),i}return ie(e,re)}return n.MATRIX_OPTIONS=he,n.NUMBER_OPTIONS=de,Object.keys(v).forEach((t=>{Object.defineProperty(n,t,{get:()=>e[t],enumerable:!0,configurable:!0})})),n}function ge(e,t,n){var r,i;void 0===e[t]||(r=n,i=e[t],-1!==r.indexOf(i))||console.warn('Warning: Unknown value "'+e[t]+'" for configuration option "'+t+'". Available options: '+n.map((e=>JSON.stringify(e))).join(", ")+".")}var ve=function(e){if(e)throw new Error("The global config is readonly. \nPlease create a mathjs instance if you want to change the default configuration. \nExample:\n\n  import { create, all } from 'mathjs';\n  const mathjs = create(all);\n  mathjs.config({ number: 'BigNumber' });\n");return Object.freeze(v)};g(ve,v,{MATRIX_OPTIONS:he,NUMBER_OPTIONS:de});var ye=n(3776);function be(e,t,n,r){function i(r){var i=function(e,t){for(var n={},r=0;r<t.length;r++){var i=t[r],a=e[i];void 0!==a&&(n[i]=a)}return n}(r,t.map(we));return function(e,t,n){if(!t.filter((e=>!function(e){return e&&"?"===e[0]}(e))).every((e=>void 0!==n[e]))){var r=t.filter((e=>void 0===n[e]));throw new Error('Cannot create function "'.concat(e,'", ')+"some dependencies are missing: ".concat(r.map((e=>'"'.concat(e,'"'))).join(", "),"."))}}(e,t,r),n(i)}return i.isFactory=!0,i.fn=e,i.dependencies=t.slice().sort(),r&&(i.meta=r),i}function xe(e){return"function"==typeof e&&"string"==typeof e.fn&&Array.isArray(e.dependencies)}function we(e){return e&&"?"===e[0]?e.slice(1):e}var Ee=be("BigNumber",["?on","config"],(e=>{var{on:t,config:n}=e,r=ye.clone({precision:n.precision,modulo:ye.EUCLID});return r.prototype=Object.create(r.prototype),r.prototype.type="BigNumber",r.prototype.isBigNumber=!0,r.prototype.toJSON=function(){return{mathjs:"BigNumber",value:this.toString()}},r.fromJSON=function(e){return new r(e.value)},t&&t("config",(function(e,t){e.precision!==t.precision&&r.config({precision:e.precision})})),r}),{isClass:!0}),Ce=n(1977);function Se(e){return"boolean"==typeof e||!!isFinite(e)&&e===Math.round(e)}var Ne=Math.sign||function(e){return e>0?1:e<0?-1:0},Ae=Math.log2||function(e){return Math.log(e)/Math.LN2},ke=Math.log10||function(e){return Math.log(e)/Math.LN10},De=Math.log1p||function(e){return Math.log(e+1)},_e=Math.cbrt||function(e){if(0===e)return e;var t,n=e<0;return n&&(e=-e),t=isFinite(e)?(e/((t=Math.exp(Math.log(e)/3))*t)+2*t)/3:e,n?-t:t},Me=Math.expm1||function(e){return e>=2e-4||e<=-2e-4?Math.exp(e)-1:e+e*e/2+e*e*e/6};function Te(e,t,n){var r={2:"0b",8:"0o",16:"0x"}[t],i="";if(n){if(n<1)throw new Error("size must be in greater than 0");if(!Se(n))throw new Error("size must be an integer");if(e>2**(n-1)-1||e<-(2**(n-1)))throw new Error("Value must be in range [-2^".concat(n-1,", 2^").concat(n-1,"-1]"));if(!Se(e))throw new Error("Value must be an integer");e<0&&(e+=2**n),i="i".concat(n)}var a="";return e<0&&(e=-e,a="-"),"".concat(a).concat(r).concat(e.toString(t)).concat(i)}function Oe(e,t){if("function"==typeof t)return t(e);if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN";var n,r,i="auto";if(t&&(t.notation&&(i=t.notation),y(t)?n=t:y(t.precision)&&(n=t.precision),t.wordSize&&"number"!=typeof(r=t.wordSize)))throw new Error('Option "wordSize" must be a number');switch(i){case"fixed":return Fe(e,n);case"exponential":return Re(e,n);case"engineering":return function(e,t){if(isNaN(e)||!isFinite(e))return String(e);var n=Be(Ie(e),t),r=n.exponent,i=n.coefficients,a=r%3==0?r:r<0?r-3-r%3:r-r%3;if(y(t))for(;t>i.length||r-a+1>i.length;)i.push(0);else for(var o=Math.abs(r-a)-(i.length-1),s=0;s<o;s++)i.push(0);for(var u=Math.abs(r-a),c=1;u>0;)c++,u--;var l=i.slice(c).join(""),f=y(t)&&l.length||l.match(/[1-9]/)?"."+l:"",p=i.slice(0,c).join("")+f+"e"+(r>=0?"+":"")+a.toString();return n.sign+p}(e,n);case"bin":return Te(e,2,r);case"oct":return Te(e,8,r);case"hex":return Te(e,16,r);case"auto":return function(e,t,n){if(isNaN(e)||!isFinite(e))return String(e);var r=n&&void 0!==n.lowerExp?n.lowerExp:-3,i=n&&void 0!==n.upperExp?n.upperExp:5,a=Ie(e),o=t?Be(a,t):a;if(o.exponent<r||o.exponent>=i)return Re(e,t);var s=o.coefficients,u=o.exponent;s.length<t&&(s=s.concat(ze(t-s.length))),s=s.concat(ze(u-s.length+1+(s.length<t?t-s.length:0)));var c=u>0?u:0;return c<(s=ze(-u).concat(s)).length-1&&s.splice(c+1,0,"."),o.sign+s.join("")}(e,n,t&&t).replace(/((\.\d*?)(0+))($|e)/,(function(){var e=arguments[2],t=arguments[4];return"."!==e?e+t:t}));default:throw new Error('Unknown notation "'+i+'". Choose "auto", "exponential", "fixed", "bin", "oct", or "hex.')}}function Ie(e){var t=String(e).toLowerCase().match(/^(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!t)throw new SyntaxError("Invalid number "+e);var n=t[1],r=t[2],i=parseFloat(t[4]||"0"),a=r.indexOf(".");i+=-1!==a?a-1:r.length-1;var o=r.replace(".","").replace(/^0*/,(function(e){return i-=e.length,""})).replace(/0*$/,"").split("").map((function(e){return parseInt(e)}));return 0===o.length&&(o.push(0),i++),{sign:n,coefficients:o,exponent:i}}function Fe(e,t){if(isNaN(e)||!isFinite(e))return String(e);var n=Ie(e),r="number"==typeof t?Be(n,n.exponent+1+t):n,i=r.coefficients,a=r.exponent+1,o=a+(t||0);return i.length<o&&(i=i.concat(ze(o-i.length))),a<0&&(i=ze(1-a).concat(i),a=1),a<i.length&&i.splice(a,0,0===a?"0.":"."),r.sign+i.join("")}function Re(e,t){if(isNaN(e)||!isFinite(e))return String(e);var n=Ie(e),r=t?Be(n,t):n,i=r.coefficients,a=r.exponent;i.length<t&&(i=i.concat(ze(t-i.length)));var o=i.shift();return r.sign+o+(i.length>0?"."+i.join(""):"")+"e"+(a>=0?"+":"")+a}function Be(e,t){for(var n={sign:e.sign,coefficients:e.coefficients,exponent:e.exponent},r=n.coefficients;t<=0;)r.unshift(0),n.exponent++,t++;if(r.length>t&&r.splice(t,r.length-t)[0]>=5){var i=t-1;for(r[i]++;10===r[i];)r.pop(),0===i&&(r.unshift(0),n.exponent++,i++),r[--i]++}return n}function ze(e){for(var t=[],n=0;n<e;n++)t.push(0);return t}var Pe=Number.EPSILON||2220446049250313e-31;function Le(e,t,n){if(null==n)return e===t;if(e===t)return!0;if(isNaN(e)||isNaN(t))return!1;if(isFinite(e)&&isFinite(t)){var r=Math.abs(e-t);return r<Pe||r<=Math.max(Math.abs(e),Math.abs(t))*n}return!1}var je=Math.acosh||function(e){return Math.log(Math.sqrt(e*e-1)+e)},Ue=Math.asinh||function(e){return Math.log(Math.sqrt(e*e+1)+e)},qe=Math.atanh||function(e){return Math.log((1+e)/(1-e))/2},We=Math.cosh||function(e){return(Math.exp(e)+Math.exp(-e))/2},Ve=Math.sinh||function(e){return(Math.exp(e)-Math.exp(-e))/2},$e=Math.tanh||function(e){var t=Math.exp(2*e);return(t-1)/(t+1)},He=be("Complex",[],(()=>(Ce.prototype.type="Complex",Ce.prototype.isComplex=!0,Ce.prototype.toJSON=function(){return{mathjs:"Complex",re:this.re,im:this.im}},Ce.prototype.toPolar=function(){return{r:this.abs(),phi:this.arg()}},Ce.prototype.format=function(e){var t=this.im,n=this.re,r=Oe(this.re,e),i=Oe(this.im,e),a=y(e)?e:e?e.precision:null;if(null!==a){var o=Math.pow(10,-a);Math.abs(n/t)<o&&(n=0),Math.abs(t/n)<o&&(t=0)}return 0===t?r:0===n?1===t?"i":-1===t?"-i":i+"i":t<0?-1===t?r+" - i":r+" - "+i.substring(1)+"i":1===t?r+" + i":r+" + "+i+"i"},Ce.fromPolar=function(e){switch(arguments.length){case 1:var t=arguments[0];if("object"==typeof t)return Ce(t);throw new TypeError("Input has to be an object with r and phi keys.");case 2:var n=arguments[0],r=arguments[1];if(y(n)){if(E(r)&&r.hasBase("ANGLE")&&(r=r.toNumber("rad")),y(r))return new Ce({r:n,phi:r});throw new TypeError("Phi is not a number nor an angle unit.")}throw new TypeError("Radius r is not a number.");default:throw new SyntaxError("Wrong number of arguments in function fromPolar")}},Ce.prototype.valueOf=Ce.prototype.toString,Ce.fromJSON=function(e){return new Ce(e)},Ce.compare=function(e,t){return e.re>t.re?1:e.re<t.re?-1:e.im>t.im?1:e.im<t.im?-1:0},Ce)),{isClass:!0});function Ge(e){var t=0,n=1,r=Object.create(null),i=Object.create(null),a=0,o=function(e){var o=i[e];if(o&&(delete r[o],delete i[e],--t,n===o)){if(!t)return a=0,void(n=1);for(;!hasOwnProperty.call(r,++n););}};return e=Math.abs(e),{hit:function(s){var u=i[s],c=++a;if(r[c]=s,i[s]=c,!u){if(++t<=e)return;return s=r[n],o(s),s}if(delete r[u],n===u)for(;!hasOwnProperty.call(r,++n););},delete:o,clear:function(){t=a=0,n=1,r=Object.create(null),i=Object.create(null)}}}function Ke(e){var{hasher:t,limit:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=null==n?Number.POSITIVE_INFINITY:n,t=null==t?JSON.stringify:t,function r(){"object"!=typeof r.cache&&(r.cache={values:new Map,lru:Ge(n||Number.POSITIVE_INFINITY)});for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o=t(i);if(r.cache.values.has(o))return r.cache.lru.hit(o),r.cache.values.get(o);var s=e.apply(e,i);return r.cache.values.set(o,s),r.cache.values.delete(r.cache.lru.hit(o)),s}}function Xe(e){return Object.keys(e.signatures||{}).reduce((function(e,t){var n=(t.match(/,/g)||[]).length+1;return Math.max(e,n)}),-1)}var Ye=Ke((function(e){return new e(1).exp()}),{hasher:et}),Je=Ke((function(e){return new e(1).plus(new e(5).sqrt()).div(2)}),{hasher:et}),Ze=Ke((function(e){return e.acos(-1)}),{hasher:et}),Qe=Ke((function(e){return Ze(e).times(2)}),{hasher:et});function et(e){return e[0].precision}var tt=Math.PI,nt=2*Math.PI,rt=Math.E,it=be("true",[],(()=>!0)),at=be("false",[],(()=>!1)),ot=be("null",[],(()=>null)),st=Ct("Infinity",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?new n(1/0):1/0})),ut=Ct("NaN",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?new n(NaN):NaN})),ct=Ct("pi",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?Ze(n):tt})),lt=Ct("tau",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?Qe(n):nt})),ft=Ct("e",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?Ye(n):rt})),pt=Ct("phi",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?Je(n):1.618033988749895})),ht=Ct("LN2",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?new n(2).ln():Math.LN2})),dt=Ct("LN10",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?new n(10).ln():Math.LN10})),mt=Ct("LOG2E",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?new n(1).div(new n(2).ln()):Math.LOG2E})),gt=Ct("LOG10E",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?new n(1).div(new n(10).ln()):Math.LOG10E})),vt=Ct("SQRT1_2",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?new n("0.5").sqrt():Math.SQRT1_2})),yt=Ct("SQRT2",["config","?BigNumber"],(e=>{var{config:t,BigNumber:n}=e;return"BigNumber"===t.number?new n(2).sqrt():Math.SQRT2})),bt=Ct("i",["Complex"],(e=>{var{Complex:t}=e;return t.I})),xt=be("PI",["pi"],(e=>{var{pi:t}=e;return t})),wt=be("E",["e"],(e=>{var{e:t}=e;return t})),Et=be("version",[],(()=>"10.1.0"));function Ct(e,t,n){return be(e,t,n,{recreateOnConfigChange:!0})}var St=wn("speedOfLight","299792458","m s^-1"),Nt=wn("gravitationConstant","6.67430e-11","m^3 kg^-1 s^-2"),At=wn("planckConstant","6.62607015e-34","J s"),kt=wn("reducedPlanckConstant","1.0545718176461565e-34","J s"),Dt=wn("magneticConstant","1.25663706212e-6","N A^-2"),_t=wn("electricConstant","8.8541878128e-12","F m^-1"),Mt=wn("vacuumImpedance","376.730313667","ohm"),Tt=wn("coulomb","8.987551792261171e9","N m^2 C^-2"),Ot=wn("elementaryCharge","1.602176634e-19","C"),It=wn("bohrMagneton","9.2740100783e-24","J T^-1"),Ft=wn("conductanceQuantum","7.748091729863649e-5","S"),Rt=wn("inverseConductanceQuantum","12906.403729652257","ohm"),Bt=wn("magneticFluxQuantum","2.0678338484619295e-15","Wb"),zt=wn("nuclearMagneton","5.0507837461e-27","J T^-1"),Pt=wn("klitzing","25812.807459304513","ohm"),Lt=wn("bohrRadius","5.29177210903e-11","m"),jt=wn("classicalElectronRadius","2.8179403262e-15","m"),Ut=wn("electronMass","9.1093837015e-31","kg"),qt=wn("fermiCoupling","1.1663787e-5","GeV^-2"),Wt=En("fineStructure",.0072973525693),Vt=wn("hartreeEnergy","4.3597447222071e-18","J"),$t=wn("protonMass","1.67262192369e-27","kg"),Ht=wn("deuteronMass","3.3435830926e-27","kg"),Gt=wn("neutronMass","1.6749271613e-27","kg"),Kt=wn("quantumOfCirculation","3.6369475516e-4","m^2 s^-1"),Xt=wn("rydberg","10973731.568160","m^-1"),Yt=wn("thomsonCrossSection","6.6524587321e-29","m^2"),Jt=En("weakMixingAngle",.2229),Zt=En("efimovFactor",22.7),Qt=wn("atomicMass","1.66053906660e-27","kg"),en=wn("avogadro","6.02214076e23","mol^-1"),tn=wn("boltzmann","1.380649e-23","J K^-1"),nn=wn("faraday","96485.33212331001","C mol^-1"),rn=wn("firstRadiation","3.7417718521927573e-16","W m^2"),an=wn("loschmidt","2.686780111798444e25","m^-3"),on=wn("gasConstant","8.31446261815324","J K^-1 mol^-1"),sn=wn("molarPlanckConstant","3.990312712893431e-10","J s mol^-1"),un=wn("molarVolume","0.022413969545014137","m^3 mol^-1"),cn=En("sackurTetrode",-1.16487052358),ln=wn("secondRadiation","0.014387768775039337","m K"),fn=wn("stefanBoltzmann","5.67037441918443e-8","W m^-2 K^-4"),pn=wn("wienDisplacement","2.897771955e-3","m K"),hn=wn("molarMass","0.99999999965e-3","kg mol^-1"),dn=wn("molarMassC12","11.9999999958e-3","kg mol^-1"),mn=wn("gravity","9.80665","m s^-2"),gn=wn("planckLength","1.616255e-35","m"),vn=wn("planckMass","2.176435e-8","kg"),yn=wn("planckTime","5.391245e-44","s"),bn=wn("planckCharge","1.87554603778e-18","C"),xn=wn("planckTemperature","1.416785e+32","K");function wn(e,t,n){return be(e,["config","Unit","BigNumber"],(e=>{var{config:r,Unit:i,BigNumber:a}=e,o=new i("BigNumber"===r.number?new a(t):parseFloat(t),n);return o.fixPrefix=!0,o}))}function En(e,t){return be(e,["config","BigNumber"],(e=>{var{config:n,BigNumber:r}=e;return"BigNumber"===n.number?new r(t):t}))}var Cn=n(5628),Sn=be("Fraction",[],(()=>(Cn.prototype.type="Fraction",Cn.prototype.isFraction=!0,Cn.prototype.toJSON=function(){return{mathjs:"Fraction",n:this.s*this.n,d:this.d}},Cn.fromJSON=function(e){return new Cn(e)},Cn)),{isClass:!0}),Nn=be("Matrix",[],(()=>{function e(){if(!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator")}return e.prototype.type="Matrix",e.prototype.isMatrix=!0,e.prototype.storage=function(){throw new Error("Cannot invoke storage on a Matrix interface")},e.prototype.datatype=function(){throw new Error("Cannot invoke datatype on a Matrix interface")},e.prototype.create=function(e,t){throw new Error("Cannot invoke create on a Matrix interface")},e.prototype.subset=function(e,t,n){throw new Error("Cannot invoke subset on a Matrix interface")},e.prototype.get=function(e){throw new Error("Cannot invoke get on a Matrix interface")},e.prototype.set=function(e,t,n){throw new Error("Cannot invoke set on a Matrix interface")},e.prototype.resize=function(e,t){throw new Error("Cannot invoke resize on a Matrix interface")},e.prototype.reshape=function(e,t){throw new Error("Cannot invoke reshape on a Matrix interface")},e.prototype.clone=function(){throw new Error("Cannot invoke clone on a Matrix interface")},e.prototype.size=function(){throw new Error("Cannot invoke size on a Matrix interface")},e.prototype.map=function(e,t){throw new Error("Cannot invoke map on a Matrix interface")},e.prototype.forEach=function(e){throw new Error("Cannot invoke forEach on a Matrix interface")},e.prototype[Symbol.iterator]=function(){throw new Error("Cannot iterate a Matrix interface")},e.prototype.toArray=function(){throw new Error("Cannot invoke toArray on a Matrix interface")},e.prototype.valueOf=function(){throw new Error("Cannot invoke valueOf on a Matrix interface")},e.prototype.format=function(e){throw new Error("Cannot invoke format on a Matrix interface")},e.prototype.toString=function(){throw new Error("Cannot invoke toString on a Matrix interface")},e}),{isClass:!0}),An=be("Range",[],(()=>{function e(t,n,r){if(!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator");var i=null!=t,a=null!=n,o=null!=r;if(i)if(b(t))t=t.toNumber();else if("number"!=typeof t)throw new TypeError("Parameter start must be a number");if(a)if(b(n))n=n.toNumber();else if("number"!=typeof n)throw new TypeError("Parameter end must be a number");if(o)if(b(r))r=r.toNumber();else if("number"!=typeof r)throw new TypeError("Parameter step must be a number");this.start=i?parseFloat(t):0,this.end=a?parseFloat(n):0,this.step=o?parseFloat(r):1}return e.prototype.type="Range",e.prototype.isRange=!0,e.parse=function(t){if("string"!=typeof t)return null;var n=t.split(":").map((function(e){return parseFloat(e)})),r=n.some((function(e){return isNaN(e)}));if(r)return null;switch(n.length){case 2:return new e(n[0],n[1]);case 3:return new e(n[0],n[2],n[1]);default:return null}},e.prototype.clone=function(){return new e(this.start,this.end,this.step)},e.prototype.size=function(){var e=0,t=this.start,n=this.step,r=this.end-t;return Ne(n)===Ne(r)?e=Math.ceil(r/n):0===r&&(e=0),isNaN(e)&&(e=0),[e]},e.prototype.min=function(){var e=this.size()[0];return e>0?this.step>0?this.start:this.start+(e-1)*this.step:void 0},e.prototype.max=function(){var e=this.size()[0];return e>0?this.step>0?this.start+(e-1)*this.step:this.start:void 0},e.prototype.forEach=function(e){var t=this.start,n=this.step,r=this.end,i=0;if(n>0)for(;t<r;)e(t,[i],this),t+=n,i++;else if(n<0)for(;t>r;)e(t,[i],this),t+=n,i++},e.prototype.map=function(e){var t=[];return this.forEach((function(n,r,i){t[r[0]]=e(n,r,i)})),t},e.prototype.toArray=function(){var e=[];return this.forEach((function(t,n){e[n[0]]=t})),e},e.prototype.valueOf=function(){return this.toArray()},e.prototype.format=function(e){var t=Oe(this.start,e);return 1!==this.step&&(t+=":"+Oe(this.step,e)),t+":"+Oe(this.end,e)},e.prototype.toString=function(){return this.format()},e.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}},e.fromJSON=function(t){return new e(t.start,t.end,t.step)},e}),{isClass:!0}),kn=be("ResultSet",[],(()=>{function e(t){if(!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator");this.entries=t||[]}return e.prototype.type="ResultSet",e.prototype.isResultSet=!0,e.prototype.valueOf=function(){return this.entries},e.prototype.toString=function(){return"["+this.entries.join(", ")+"]"},e.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}},e.fromJSON=function(t){return new e(t.entries)},e}),{isClass:!0});function Dn(e,t,n){var r=new(0,e.constructor)(2),i="";if(n){if(n<1)throw new Error("size must be in greater than 0");if(!Se(n))throw new Error("size must be an integer");if(e.greaterThan(r.pow(n-1).sub(1))||e.lessThan(r.pow(n-1).mul(-1)))throw new Error("Value must be in range [-2^".concat(n-1,", 2^").concat(n-1,"-1]"));if(!e.isInteger())throw new Error("Value must be an integer");e.lessThan(0)&&(e=e.add(r.pow(n))),i="i".concat(n)}switch(t){case 2:return"".concat(e.toBinary()).concat(i);case 8:return"".concat(e.toOctal()).concat(i);case 16:return"".concat(e.toHexadecimal()).concat(i);default:throw new Error("Base ".concat(t," not supported "))}}function _n(e,t){return void 0!==t?e.toExponential(t-1):e.toExponential()}function Mn(e,t){var n=e.length-t.length,r=e.length;return e.substring(n,r)===t}function Tn(e,t){return"number"==typeof e?Oe(e,t):b(e)?function(e,t){if("function"==typeof t)return t(e);if(!e.isFinite())return e.isNaN()?"NaN":e.gt(0)?"Infinity":"-Infinity";var n,r,i="auto";if(void 0!==t&&(t.notation&&(i=t.notation),"number"==typeof t?n=t:t.precision&&(n=t.precision),t.wordSize&&"number"!=typeof(r=t.wordSize)))throw new Error('Option "wordSize" must be a number');switch(i){case"fixed":return function(e,t){return e.toFixed(t)}(e,n);case"exponential":return _n(e,n);case"engineering":return function(e,t){var n=e.e,r=n%3==0?n:n<0?n-3-n%3:n-n%3,i=e.mul(Math.pow(10,-r)),a=i.toPrecision(t);return-1!==a.indexOf("e")&&(a=i.toString()),a+"e"+(n>=0?"+":"")+r.toString()}(e,n);case"bin":return Dn(e,2,r);case"oct":return Dn(e,8,r);case"hex":return Dn(e,16,r);case"auto":var a=t&&void 0!==t.lowerExp?t.lowerExp:-3,o=t&&void 0!==t.upperExp?t.upperExp:5;if(e.isZero())return"0";var s=e.toSignificantDigits(n),u=s.e;return(u>=a&&u<o?s.toFixed():_n(e,n)).replace(/((\.\d*?)(0+))($|e)/,(function(){var e=arguments[2],t=arguments[4];return"."!==e?e+t:t}));default:throw new Error('Unknown notation "'+i+'". Choose "auto", "exponential", "fixed", "bin", "oct", or "hex.')}}(e,t):function(e){return e&&"object"==typeof e&&"number"==typeof e.s&&"number"==typeof e.n&&"number"==typeof e.d||!1}(e)?t&&"decimal"===t.fraction?e.toString():e.s*e.n+"/"+e.d:Array.isArray(e)?Fn(e,t):C(e)?'"'+e+'"':"function"==typeof e?e.syntax?String(e.syntax):"function":e&&"object"==typeof e?"function"==typeof e.format?e.format(t):e&&e.toString(t)!=={}.toString()?e.toString(t):"{"+Object.keys(e).map((n=>'"'+n+'": '+Tn(e[n],t))).join(", ")+"}":String(e)}function On(e){for(var t=String(e),n="",r=0;r<t.length;){var i=t.charAt(r);"\\"===i?(n+=i,r++,""!==(i=t.charAt(r))&&-1!=='"\\/bfnrtu'.indexOf(i)||(n+="\\"),n+=i):n+='"'===i?'\\"':i,r++}return'"'+n+'"'}function In(e){var t=String(e);return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Fn(e,t){if(Array.isArray(e)){for(var n="[",r=e.length,i=0;i<r;i++)0!==i&&(n+=", "),n+=Fn(e[i],t);return n+"]"}return Tn(e,t)}function Rn(e,t){if(!C(e))throw new TypeError("Unexpected type of argument in function compareText (expected: string or Array or Matrix, actual: "+ne(e)+", index: 0)");if(!C(t))throw new TypeError("Unexpected type of argument in function compareText (expected: string or Array or Matrix, actual: "+ne(t)+", index: 1)");return e===t?0:e>t?1:-1}function Bn(e,t,n){if(!(this instanceof Bn))throw new SyntaxError("Constructor must be called with the new operator");this.actual=e,this.expected=t,this.relation=n,this.message="Dimension mismatch ("+(Array.isArray(e)?"["+e.join(", ")+"]":e)+" "+(this.relation||"!=")+" "+(Array.isArray(t)?"["+t.join(", ")+"]":t)+")",this.stack=(new Error).stack}function zn(e,t,n){if(!(this instanceof zn))throw new SyntaxError("Constructor must be called with the new operator");this.index=e,arguments.length<3?(this.min=0,this.max=t):(this.min=t,this.max=n),void 0!==this.min&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":void 0!==this.max&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=(new Error).stack}function Pn(e){for(var t=[];Array.isArray(e);)t.push(e.length),e=e[0];return t}function Ln(e,t,n){var r,i=e.length;if(i!==t[n])throw new Bn(i,t[n]);if(n<t.length-1){var a=n+1;for(r=0;r<i;r++){var o=e[r];if(!Array.isArray(o))throw new Bn(t.length-1,t.length,"<");Ln(e[r],t,a)}}else for(r=0;r<i;r++)if(Array.isArray(e[r]))throw new Bn(t.length+1,t.length,">")}function jn(e,t){if(0===t.length){if(Array.isArray(e))throw new Bn(e.length,0)}else Ln(e,t,0)}function Un(e,t){if(!y(e)||!Se(e))throw new TypeError("Index must be an integer (value: "+e+")");if(e<0||"number"==typeof t&&e>=t)throw new zn(e,t)}function qn(e,t,n){if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Array expected");if(0===t.length)throw new Error("Resizing to scalar is not supported");return t.forEach((function(e){if(!y(e)||!Se(e)||e<0)throw new TypeError("Invalid size, must contain positive integers (size: "+Tn(t)+")")})),Wn(e,t,0,void 0!==n?n:0),e}function Wn(e,t,n,r){var i,a,o=e.length,s=t[n],u=Math.min(o,s);if(e.length=s,n<t.length-1){var c=n+1;for(i=0;i<u;i++)a=e[i],Array.isArray(a)||(a=[a],e[i]=a),Wn(a,t,c,r);for(i=u;i<s;i++)a=[],e[i]=a,Wn(a,t,c,r)}else{for(i=0;i<u;i++)for(;Array.isArray(e[i]);)e[i]=e[i][0];for(i=u;i<s;i++)e[i]=r}}function Vn(e,t){var n=Jn(e),r=n.length;if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Array expected");if(0===t.length)throw new Bn(0,r,"!=");var i=Hn(t=$n(t,r));if(r!==i)throw new Bn(i,r,"!=");try{return function(e,t){for(var n,r=e,i=t.length-1;i>0;i--){var a=t[i];n=[];for(var o=r.length/a,s=0;s<o;s++)n.push(r.slice(s*a,(s+1)*a));r=n}return r}(n,t)}catch(e){if(e instanceof Bn)throw new Bn(i,r,"!=");throw e}}function $n(e,t){var n=Hn(e),r=e.slice(),i=e.indexOf(-1);if(e.indexOf(-1,i+1)>=0)throw new Error("More than one wildcard in sizes");if(i>=0){if(t%n!=0)throw new Error("Could not replace wildcard, since "+t+" is no multiple of "+-n);r[i]=-t/n}return r}function Hn(e){return e.reduce(((e,t)=>e*t),1)}function Gn(e,t){for(var n=t||Pn(e);Array.isArray(e)&&1===e.length;)e=e[0],n.shift();for(var r=n.length;1===n[r-1];)r--;return r<n.length&&(e=Kn(e,r,0),n.length=r),e}function Kn(e,t,n){var r,i;if(n<t){var a=n+1;for(r=0,i=e.length;r<i;r++)e[r]=Kn(e[r],t,a)}else for(;Array.isArray(e);)e=e[0];return e}function Xn(e,t,n,r){var i=r||Pn(e);if(n)for(var a=0;a<n;a++)e=[e],i.unshift(1);for(e=Yn(e,t,0);i.length<t;)i.push(1);return e}function Yn(e,t,n){var r,i;if(Array.isArray(e)){var a=n+1;for(r=0,i=e.length;r<i;r++)e[r]=Yn(e[r],t,a)}else for(var o=n;o<t;o++)e=[e];return e}function Jn(e){if(!Array.isArray(e))return e;var t=[];return e.forEach((function e(n){Array.isArray(n)?n.forEach(e):t.push(n)})),t}function Zn(e,t){return Array.prototype.map.call(e,t)}function Qn(e,t){Array.prototype.forEach.call(e,t)}function er(e,t){if(1!==Pn(e).length)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(e,t)}function tr(e,t){if(1!==Pn(e).length)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(e,(e=>t.test(e)))}function nr(e,t){return Array.prototype.join.call(e,t)}function rr(e){if(!Array.isArray(e))throw new TypeError("Array input expected");if(0===e.length)return e;var t=[],n=0;t[0]={value:e[0],identifier:0};for(var r=1;r<e.length;r++)e[r]===e[r-1]?n++:n=0,t.push({value:e[r],identifier:n});return t}function ir(e){if(!Array.isArray(e))throw new TypeError("Array input expected");if(0===e.length)return e;for(var t=[],n=0;n<e.length;n++)t.push(e[n].value);return t}function ar(e,t){for(var n,r=0,i=0;i<e.length;i++){var a=e[i],o=Array.isArray(a);if(0===i&&o&&(r=a.length),o&&a.length!==r)return;var s=o?ar(a,t):t(a);if(void 0===n)n=s;else if(n!==s)return"mixed"}return n}function or(e,t){return-1!==e.indexOf(t)}Bn.prototype=new RangeError,Bn.prototype.constructor=RangeError,Bn.prototype.name="DimensionError",Bn.prototype.isDimensionError=!0,zn.prototype=new RangeError,zn.prototype.constructor=RangeError,zn.prototype.name="IndexError",zn.prototype.isIndexError=!0;var sr=be("DenseMatrix",["Matrix"],(e=>{var{Matrix:t}=e;function n(e,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(t&&!C(t))throw new Error("Invalid datatype: "+t);if(N(e))"DenseMatrix"===e.type?(this._data=re(e._data),this._size=re(e._size),this._datatype=t||e._datatype):(this._data=e.toArray(),this._size=e.size(),this._datatype=t||e._datatype);else if(e&&S(e.data)&&S(e.size))this._data=e.data,this._size=e.size,jn(this._data,this._size),this._datatype=t||e.datatype;else if(S(e))this._data=c(e),this._size=Pn(this._data),jn(this._data,this._size),this._datatype=t;else{if(e)throw new TypeError("Unsupported type of data ("+ne(e)+")");this._data=[],this._size=[0],this._datatype=t}}function r(e,t){if(!M(t))throw new TypeError("Invalid index");if(t.isScalar())return e.get(t.min());var r=t.size();if(r.length!==e._size.length)throw new Bn(r.length,e._size.length);for(var a=t.min(),o=t.max(),s=0,u=e._size.length;s<u;s++)Un(a[s],e._size[s]),Un(o[s],e._size[s]);return new n(i(e._data,t,r.length,0),e._datatype)}function i(e,t,n,r){var a=r===n-1,o=t.dimension(r);return a?o.map((function(t){return Un(t,e.length),e[t]})).valueOf():o.map((function(a){return Un(a,e.length),i(e[a],t,n,r+1)})).valueOf()}function a(e,t,n,r){if(!t||!0!==t.isIndex)throw new TypeError("Invalid index");var i,a=t.size(),s=t.isScalar();if(N(n)?(i=n.size(),n=n.valueOf()):i=Pn(n),s){if(0!==i.length)throw new TypeError("Scalar expected");e.set(t.min(),n,r)}else{if(a.length<e._size.length)throw new Bn(a.length,e._size.length,"<");if(i.length<a.length){for(var c=0,l=0;1===a[c]&&1===i[c];)c++;for(;1===a[c];)l++,c++;n=Xn(n,a.length,l,i)}if(!se(a,i))throw new Bn(a,i,">");var f=t.max().map((function(e){return e+1}));u(e,f,r);var p=a.length;o(e._data,t,n,p,0)}return e}function o(e,t,n,r,i){var a=i===r-1,s=t.dimension(i);a?s.forEach((function(t,r){Un(t),e[t]=n[r[0]]})):s.forEach((function(a,s){Un(a),o(e[a],t,n[s[0]],r,i+1)}))}function s(e,t,n){if(0===t.length){for(var r=e._data;S(r);)r=r[0];return r}return e._size=t.slice(0),e._data=qn(e._data,e._size,n),e}function u(e,t,n){for(var r=e._size.slice(0),i=!1;r.length<t.length;)r.push(0),i=!0;for(var a=0,o=t.length;a<o;a++)t[a]>r[a]&&(r[a]=t[a],i=!0);i&&s(e,r,n)}function c(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];S(r)?e[t]=c(r):r&&!0===r.isMatrix&&(e[t]=c(r.valueOf()))}return e}return n.prototype=new t,n.prototype.createDenseMatrix=function(e,t){return new n(e,t)},n.prototype.type="DenseMatrix",n.prototype.isDenseMatrix=!0,n.prototype.getDataType=function(){return ar(this._data,ne)},n.prototype.storage=function(){return"dense"},n.prototype.datatype=function(){return this._datatype},n.prototype.create=function(e,t){return new n(e,t)},n.prototype.subset=function(e,t,n){switch(arguments.length){case 1:return r(this,e);case 2:case 3:return a(this,e,t,n);default:throw new SyntaxError("Wrong number of arguments")}},n.prototype.get=function(e){if(!S(e))throw new TypeError("Array expected");if(e.length!==this._size.length)throw new Bn(e.length,this._size.length);for(var t=0;t<e.length;t++)Un(e[t],this._size[t]);for(var n=this._data,r=0,i=e.length;r<i;r++){var a=e[r];Un(a,n.length),n=n[a]}return n},n.prototype.set=function(e,t,n){if(!S(e))throw new TypeError("Array expected");if(e.length<this._size.length)throw new Bn(e.length,this._size.length,"<");var r,i,a,o=e.map((function(e){return e+1}));u(this,o,n);var s=this._data;for(r=0,i=e.length-1;r<i;r++)Un(a=e[r],s.length),s=s[a];return Un(a=e[e.length-1],s.length),s[a]=t,this},n.prototype.resize=function(e,t,n){if(!A(e))throw new TypeError("Array or Matrix expected");var r=e.valueOf().map((e=>Array.isArray(e)&&1===e.length?e[0]:e));return s(n?this.clone():this,r,t)},n.prototype.reshape=function(e,t){var n=t?this.clone():this;n._data=Vn(n._data,e);var r=n._size.reduce(((e,t)=>e*t));return n._size=$n(e,r),n},n.prototype.clone=function(){return new n({data:re(this._data),size:re(this._size),datatype:this._datatype})},n.prototype.size=function(){return this._size.slice(0)},n.prototype.map=function(e){var t=this,r=function n(r,i){return S(r)?r.map((function(e,t){return n(e,i.concat(t))})):e(r,i,t)}(this._data,[]);return new n(r,void 0!==this._datatype?ar(r,ne):void 0)},n.prototype.forEach=function(e){var t=this;!function n(r,i){S(r)?r.forEach((function(e,t){n(e,i.concat(t))})):e(r,i,t)}(this._data,[])},n.prototype[Symbol.iterator]=function*(){yield*function*e(t,n){if(S(t))for(var r=0;r<t.length;r++)yield*e(t[r],n.concat(r));else yield{value:t,index:n}}(this._data,[])},n.prototype.rows=function(){var e=[];if(2!==this.size().length)throw new TypeError("Rows can only be returned for a 2D matrix.");var t=this._data;for(var r of t)e.push(new n([r],this._datatype));return e},n.prototype.columns=function(){var e=this,t=[],r=this.size();if(2!==r.length)throw new TypeError("Rows can only be returned for a 2D matrix.");for(var i=this._data,a=function(r){var a=i.map((e=>[e[r]]));t.push(new n(a,e._datatype))},o=0;o<r[1];o++)a(o);return t},n.prototype.toArray=function(){return re(this._data)},n.prototype.valueOf=function(){return this._data},n.prototype.format=function(e){return Tn(this._data,e)},n.prototype.toString=function(){return Tn(this._data)},n.prototype.toJSON=function(){return{mathjs:"DenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},n.prototype.diagonal=function(e){if(e){if(b(e)&&(e=e.toNumber()),!y(e)||!Se(e))throw new TypeError("The parameter k must be an integer number")}else e=0;for(var t=e>0?e:0,r=e<0?-e:0,i=this._size[0],a=this._size[1],o=Math.min(i-r,a-t),s=[],u=0;u<o;u++)s[u]=this._data[u+r][u+t];return new n({data:s,size:[o],datatype:this._datatype})},n.diagonal=function(e,t,r,i){if(!S(e))throw new TypeError("Array expected, size parameter");if(2!==e.length)throw new Error("Only two dimensions matrix are supported");if(e=e.map((function(e){if(b(e)&&(e=e.toNumber()),!y(e)||!Se(e)||e<1)throw new Error("Size values must be positive integers");return e})),r){if(b(r)&&(r=r.toNumber()),!y(r)||!Se(r))throw new TypeError("The parameter k must be an integer number")}else r=0;var a,o=r>0?r:0,s=r<0?-r:0,u=e[0],c=e[1],l=Math.min(u-s,c-o);if(S(t)){if(t.length!==l)throw new Error("Invalid value array length");a=function(e){return t[e]}}else if(N(t)){var f=t.size();if(1!==f.length||f[0]!==l)throw new Error("Invalid matrix length");a=function(e){return t.get([e])}}else a=function(){return t};i||(i=b(a(0))?a(0).mul(0):0);var p=[];if(e.length>0){p=qn(p,e,i);for(var h=0;h<l;h++)p[h+s][h+o]=a(h)}return new n({data:p,size:[u,c]})},n.fromJSON=function(e){return new n(e)},n.prototype.swapRows=function(e,t){if(!(y(e)&&Se(e)&&y(t)&&Se(t)))throw new Error("Row index must be positive integers");if(2!==this._size.length)throw new Error("Only two dimensional matrix is supported");return Un(e,this._size[0]),Un(t,this._size[0]),n._swapRows(e,t,this._data),this},n._swapRows=function(e,t,n){var r=n[e];n[e]=n[t],n[t]=r},n}),{isClass:!0}),ur=be("replacer",[],(()=>function(e,t){return"number"!=typeof t||isFinite(t)&&!isNaN(t)?t:{mathjs:"number",value:String(t)}})),cr=n(2287);function lr(e,t){if(dr(e)&&pr(e,t))return e[t];if("function"==typeof e[t]&&hr(e,t))throw new Error('Cannot access method "'+t+'" as a property');throw new Error('No access to property "'+t+'"')}function fr(e,t,n){if(dr(e)&&pr(e,t))return e[t]=n,n;throw new Error('No access to property "'+t+'"')}function pr(e,t){return!(!e||"object"!=typeof e||!fe(mr,t)&&(t in Object.prototype||t in Function.prototype))}function hr(e,t){return!(null==e||"function"!=typeof e[t]||fe(e,t)&&Object.getPrototypeOf&&t in Object.getPrototypeOf(e)||!fe(gr,t)&&(t in Object.prototype||t in Function.prototype))}function dr(e){return"object"==typeof e&&e&&e.constructor===Object}var mr={length:!0,name:!0},gr={toString:!0,valueOf:!0,toLocaleString:!0};class vr{constructor(e){this.wrappedObject=e}keys(){return Object.keys(this.wrappedObject)}get(e){return lr(this.wrappedObject,e)}set(e,t){return fr(this.wrappedObject,e,t),this}has(e){return e in this.wrappedObject}}function yr(){return new Map}function br(e){if(!e)return yr();if(xr(e))return e;if(z(e))return new vr(e);throw new Error("createMap can create maps from objects or Maps")}function xr(e){return!!e&&(e instanceof Map||e instanceof vr||"function"==typeof e.set&&"function"==typeof e.get&&"function"==typeof e.keys&&"function"==typeof e.has)}function wr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i of n)if(i)if(xr(i))for(var a of i.keys())e.set(a,i.get(a));else if(z(i))for(var o of Object.keys(i))e.set(o,i[o]);return e}var Er=function(){return Er=cr.create,cr},Cr=be("typed",["?BigNumber","?Complex","?DenseMatrix","?Fraction"],(function(e){var{BigNumber:t,Complex:n,DenseMatrix:r,Fraction:i}=e,a=Er();return a.types=[{name:"number",test:y},{name:"Complex",test:x},{name:"BigNumber",test:b},{name:"Fraction",test:w},{name:"Unit",test:E},{name:"string",test:C},{name:"Chain",test:te},{name:"Array",test:S},{name:"Matrix",test:N},{name:"DenseMatrix",test:k},{name:"SparseMatrix",test:D},{name:"Range",test:_},{name:"Index",test:M},{name:"boolean",test:T},{name:"ResultSet",test:O},{name:"Help",test:I},{name:"function",test:F},{name:"Date",test:R},{name:"RegExp",test:B},{name:"null",test:P},{name:"undefined",test:L},{name:"AccessorNode",test:j},{name:"ArrayNode",test:U},{name:"AssignmentNode",test:q},{name:"BlockNode",test:W},{name:"ConditionalNode",test:V},{name:"ConstantNode",test:$},{name:"FunctionNode",test:G},{name:"FunctionAssignmentNode",test:H},{name:"IndexNode",test:K},{name:"Node",test:X},{name:"ObjectNode",test:Y},{name:"OperatorNode",test:J},{name:"ParenthesisNode",test:Z},{name:"RangeNode",test:Q},{name:"SymbolNode",test:ee},{name:"Map",test:xr},{name:"Object",test:z}],a.conversions=[{from:"number",to:"BigNumber",convert:function(e){if(t||Sr(e),e.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+e+"). Use function bignumber(x) to convert to BigNumber.");return new t(e)}},{from:"number",to:"Complex",convert:function(e){return n||Nr(e),new n(e,0)}},{from:"number",to:"string",convert:function(e){return e+""}},{from:"BigNumber",to:"Complex",convert:function(e){return n||Nr(e),new n(e.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(e){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(e){return n||Nr(e),new n(e.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(e){i||Ar(e);var t=new i(e);if(t.valueOf()!==e)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+e+"). Use function fraction(x) to convert to Fraction.");return t}},{from:"string",to:"number",convert:function(e){var t=Number(e);if(isNaN(t))throw new Error('Cannot convert "'+e+'" to a number');return t}},{from:"string",to:"BigNumber",convert:function(e){t||Sr(e);try{return new t(e)}catch(t){throw new Error('Cannot convert "'+e+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(e){i||Ar(e);try{return new i(e)}catch(t){throw new Error('Cannot convert "'+e+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(e){n||Nr(e);try{return new n(e)}catch(t){throw new Error('Cannot convert "'+e+'" to Complex')}}},{from:"boolean",to:"number",convert:function(e){return+e}},{from:"boolean",to:"BigNumber",convert:function(e){return t||Sr(e),new t(+e)}},{from:"boolean",to:"Fraction",convert:function(e){return i||Ar(e),new i(+e)}},{from:"boolean",to:"string",convert:function(e){return String(e)}},{from:"Array",to:"Matrix",convert:function(e){return r||function(){throw new Error("Cannot convert array into a Matrix: no class 'DenseMatrix' provided")}(),new r(e)}},{from:"Matrix",to:"Array",convert:function(e){return e.valueOf()}}],a}));function Sr(e){throw new Error("Cannot convert value ".concat(e," into a BigNumber: no class 'BigNumber' provided"))}function Nr(e){throw new Error("Cannot convert value ".concat(e," into a Complex number: no class 'Complex' provided"))}function Ar(e){throw new Error("Cannot convert value ".concat(e," into a Fraction, no class 'Fraction' provided."))}function kr(e){for(var t=0;t<e.length;t++)if(A(e[t]))return!0;return!1}function Dr(e,t){N(e)&&(e=e.valueOf());for(var n=0,r=e.length;n<r;n++){var i=e[n];Array.isArray(i)?Dr(i,t):t(i)}}function _r(e,t,n){return e&&"function"==typeof e.map?e.map((function(e){return _r(e,t,n)})):t(e)}function Mr(e,t,n){var r=Array.isArray(e)?Pn(e):e.size();if(t<0||t>=r.length)throw new zn(t,r.length);return N(e)?e.create(Tr(e.valueOf(),t,n)):Tr(e,t,n)}function Tr(e,t,n){var r,i,a,o;if(t<=0){if(Array.isArray(e[0])){for(o=function(e){var t,n,r=e.length,i=e[0].length,a=[];for(n=0;n<i;n++){var o=[];for(t=0;t<r;t++)o.push(e[t][n]);a.push(o)}return a}(e),i=[],r=0;r<o.length;r++)i[r]=Tr(o[r],t-1,n);return i}for(a=e[0],r=1;r<e.length;r++)a=n(a,e[r]);return a}for(i=[],r=0;r<e.length;r++)i[r]=Tr(e[r],t-1,n);return i}function Or(e,t,n,r,i,a,o,s,u,c,l){var f,p,h,d,m=e._values,g=e._index,v=e._ptr;if(r)for(p=v[t],h=v[t+1],f=p;f<h;f++)n[d=g[f]]!==a?(n[d]=a,o.push(d),c?(r[d]=u?s(m[f],l):s(l,m[f]),i[d]=a):r[d]=m[f]):(r[d]=u?s(m[f],r[d]):s(r[d],m[f]),i[d]=a);else for(p=v[t],h=v[t+1],f=p;f<h;f++)n[d=g[f]]!==a?(n[d]=a,o.push(d)):i[d]=a}var Ir="number",Fr="number, number";function Rr(e){return Math.abs(e)}function Br(e,t){return e+t}function zr(e,t){return e*t}function Pr(e){return-e}function Lr(e){return e}function jr(e){return _e(e)}function Ur(e){return Math.ceil(e)}function qr(e){return e*e*e}function Wr(e){return Math.exp(e)}function Vr(e){return Me(e)}function $r(e,t){if(!Se(e)||!Se(t))throw new Error("Parameters in function gcd must be integer numbers");for(var n;0!==t;)n=e%t,e=t,t=n;return e<0?-e:e}function Hr(e,t){if(!Se(e)||!Se(t))throw new Error("Parameters in function lcm must be integer numbers");if(0===e||0===t)return 0;for(var n,r=e*t;0!==t;)t=e%(n=t),e=n;return Math.abs(r/e)}function Gr(e){return Math.log(e)}function Kr(e){return ke(e)}function Xr(e){return Ae(e)}function Yr(e,t){if(t>0)return e-t*Math.floor(e/t);if(0===t)return e;throw new Error("Cannot calculate mod for a negative divisor")}function Jr(e,t){var n=t<0;if(n&&(t=-t),0===t)throw new Error("Root must be non-zero");if(e<0&&Math.abs(t)%2!=1)throw new Error("Root must be odd when a is negative.");if(0===e)return n?1/0:0;if(!isFinite(e))return n?0:e;var r=Math.pow(Math.abs(e),1/t);return r=e<0?-r:r,n?1/r:r}function Zr(e){return Ne(e)}function Qr(e){return e*e}function ei(e,t){var n,r,i,a=0,o=1,s=1,u=0;if(!Se(e)||!Se(t))throw new Error("Parameters in function xgcd must be integer numbers");for(;t;)i=e-(r=Math.floor(e/t))*t,n=a,a=o-r*a,o=n,n=s,s=u-r*s,u=n,e=t,t=i;return e<0?[-e,-o,-u]:[e,e?o:0,u]}function ti(e,t){return e*e<1&&t===1/0||e*e>1&&t===-1/0?0:Math.pow(e,t)}function ni(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return parseFloat(Fe(e,t))}Rr.signature=Ir,Br.signature=Fr,zr.signature=Fr,Pr.signature=Ir,Lr.signature=Ir,jr.signature=Ir,Ur.signature=Ir,qr.signature=Ir,Wr.signature=Ir,Vr.signature=Ir,$r.signature=Fr,Hr.signature=Fr,Gr.signature=Ir,Kr.signature=Ir,Xr.signature=Ir,Yr.signature=Fr,Jr.signature=Fr,Zr.signature=Ir,Qr.signature=Ir,ei.signature=Fr,ti.signature=Fr,ni.signature=Fr;var ri="unaryPlus",ii=be(ri,["typed","config","BigNumber"],(e=>{var{typed:t,config:n,BigNumber:r}=e;return t(ri,{number:Lr,Complex:function(e){return e},BigNumber:function(e){return e},Fraction:function(e){return e},Unit:function(e){return e.clone()},"Array | Matrix":function(e){return _r(e,this,!0)},"boolean | string":function(e){return"BigNumber"===n.number?new r(+e):+e}})})),ai=be("abs",["typed"],(e=>{var{typed:t}=e;return t("abs",{number:Rr,Complex:function(e){return e.abs()},BigNumber:function(e){return e.abs()},Fraction:function(e){return e.abs()},"Array | Matrix":function(e){return _r(e,this,!0)},Unit:function(e){return e.abs()}})})),oi="acos",si=be(oi,["typed","config","Complex"],(e=>{var{typed:t,config:n,Complex:r}=e;return t(oi,{number:function(e){return e>=-1&&e<=1||n.predictable?Math.acos(e):new r(e,0).acos()},Complex:function(e){return e.acos()},BigNumber:function(e){return e.acos()},"Array | Matrix":function(e){return _r(e,this)}})})),ui="number";function ci(e){return je(e)}function li(e){return Math.atan(1/e)}function fi(e){return isFinite(e)?(Math.log((e+1)/e)+Math.log(e/(e-1)))/2:0}function pi(e){return Math.asin(1/e)}function hi(e){var t=1/e;return Math.log(t+Math.sqrt(t*t+1))}function di(e){return Math.acos(1/e)}function mi(e){var t=1/e,n=Math.sqrt(t*t-1);return Math.log(n+t)}function gi(e){return Ue(e)}function vi(e){return qe(e)}function yi(e){return 1/Math.tan(e)}function bi(e){var t=Math.exp(2*e);return(t+1)/(t-1)}function xi(e){return 1/Math.sin(e)}function wi(e){return 0===e?Number.POSITIVE_INFINITY:Math.abs(2/(Math.exp(e)-Math.exp(-e)))*Ne(e)}function Ei(e){return 1/Math.cos(e)}function Ci(e){return 2/(Math.exp(e)+Math.exp(-e))}function Si(e){return Ve(e)}ci.signature=ui,li.signature=ui,fi.signature=ui,pi.signature=ui,hi.signature=ui,di.signature=ui,mi.signature=ui,gi.signature=ui,vi.signature=ui,yi.signature=ui,bi.signature=ui,xi.signature=ui,wi.signature=ui,Ei.signature=ui,Ci.signature=ui,Si.signature=ui;var Ni="acot",Ai=be(Ni,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t(Ni,{number:li,Complex:function(e){return e.acot()},BigNumber:function(e){return new n(1).div(e).atan()},"Array | Matrix":function(e){return _r(e,this)}})})),ki="acsc",Di=be(ki,["typed","config","Complex","BigNumber"],(e=>{var{typed:t,config:n,Complex:r,BigNumber:i}=e;return t(ki,{number:function(e){return e<=-1||e>=1||n.predictable?pi(e):new r(e,0).acsc()},Complex:function(e){return e.acsc()},BigNumber:function(e){return new i(1).div(e).asin()},"Array | Matrix":function(e){return _r(e,this)}})})),_i="addScalar",Mi=be(_i,["typed"],(e=>{var{typed:t}=e;return t(_i,{"number, number":Br,"Complex, Complex":function(e,t){return e.add(t)},"BigNumber, BigNumber":function(e,t){return e.plus(t)},"Fraction, Fraction":function(e,t){return e.add(t)},"Unit, Unit":function(e,t){if(null===e.value||void 0===e.value)throw new Error("Parameter x contains a unit with undefined value");if(null===t.value||void 0===t.value)throw new Error("Parameter y contains a unit with undefined value");if(!e.equalBase(t))throw new Error("Units do not match");var n=e.clone();return n.value=this(n.value,t.value),n.fixPrefix=!1,n}})})),Ti=be("arg",["typed"],(e=>{var{typed:t}=e;return t("arg",{number:function(e){return Math.atan2(0,e)},BigNumber:function(e){return e.constructor.atan2(0,e)},Complex:function(e){return e.arg()},"Array | Matrix":function(e){return _r(e,this)}})})),Oi="asech",Ii=be(Oi,["typed","config","Complex","BigNumber"],(e=>{var{typed:t,config:n,Complex:r,BigNumber:i}=e;return t(Oi,{number:function(e){if(e<=1&&e>=-1||n.predictable){var t=1/e;if(t>0||n.predictable)return mi(e);var i=Math.sqrt(t*t-1);return new r(Math.log(i-t),Math.PI)}return new r(e,0).asech()},Complex:function(e){return e.asech()},BigNumber:function(e){return new i(1).div(e).acosh()},"Array | Matrix":function(e){return _r(e,this)}})})),Fi=be("asinh",["typed"],(e=>{var{typed:t}=e;return t("asinh",{number:gi,Complex:function(e){return e.asinh()},BigNumber:function(e){return e.asinh()},"Array | Matrix":function(e){return _r(e,this,!0)}})})),Ri=be("atan",["typed"],(e=>{var{typed:t}=e;return t("atan",{number:function(e){return Math.atan(e)},Complex:function(e){return e.atan()},BigNumber:function(e){return e.atan()},"Array | Matrix":function(e){return _r(e,this,!0)}})})),Bi="atanh",zi=be(Bi,["typed","config","Complex"],(e=>{var{typed:t,config:n,Complex:r}=e;return t(Bi,{number:function(e){return e<=1&&e>=-1||n.predictable?vi(e):new r(e,0).atanh()},Complex:function(e){return e.atanh()},BigNumber:function(e){return e.atanh()},"Array | Matrix":function(e){return _r(e,this,!0)}})})),Pi=be("bignumber",["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t("bignumber",{"":function(){return new n(0)},number:function(e){return new n(e+"")},string:function(e){var t=e.match(/(0[box][0-9a-fA-F]*)i([0-9]*)/);if(t){var r=t[2],i=n(t[1]),a=new n(2).pow(Number(r));if(i.gt(a.sub(1)))throw new SyntaxError('String "'.concat(e,'" is out of range'));var o=new n(2).pow(Number(r)-1);return i.gte(o)?i.sub(a):i}return new n(e)},BigNumber:function(e){return e},Fraction:function(e){return new n(e.n).div(e.d).times(e.s)},null:function(e){return new n(0)},"Array | Matrix":function(e){return _r(e,this)}})}));function Li(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitAnd");var n=e.constructor;if(e.isNaN()||t.isNaN())return new n(NaN);if(e.isZero()||t.eq(-1)||e.eq(t))return e;if(t.isZero()||e.eq(-1))return t;if(!e.isFinite()||!t.isFinite()){if(!e.isFinite()&&!t.isFinite())return e.isNegative()===t.isNegative()?e:new n(0);if(!e.isFinite())return t.isNegative()?e:e.isNegative()?new n(0):t;if(!t.isFinite())return e.isNegative()?t:t.isNegative()?new n(0):e}return qi(e,t,(function(e,t){return e&t}))}function ji(e){if(e.isFinite()&&!e.isInteger())throw new Error("Integer expected in function bitNot");var t=e.constructor,n=t.precision;t.config({precision:1e9});var r=e.plus(new t(1));return r.s=-r.s||null,t.config({precision:n}),r}function Ui(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitOr");var n=e.constructor;if(e.isNaN()||t.isNaN())return new n(NaN);var r=new n(-1);return e.isZero()||t.eq(r)||e.eq(t)?t:t.isZero()||e.eq(r)?e:e.isFinite()&&t.isFinite()?qi(e,t,(function(e,t){return e|t})):!e.isFinite()&&!e.isNegative()&&t.isNegative()||e.isNegative()&&!t.isNegative()&&!t.isFinite()?r:e.isNegative()&&t.isNegative()?e.isFinite()?e:t:e.isFinite()?t:e}function qi(e,t,n){var r,i,a,o,s,u=e.constructor,c=+(e.s<0),l=+(t.s<0);if(c){r=Wi(ji(e));for(var f=0;f<r.length;++f)r[f]^=1}else r=Wi(e);if(l){i=Wi(ji(t));for(var p=0;p<i.length;++p)i[p]^=1}else i=Wi(t);r.length<=i.length?(a=r,o=i,s=c):(a=i,o=r,s=l);var h=a.length,d=o.length,m=1^n(c,l),g=new u(1^m),v=new u(1),y=new u(2),b=u.precision;for(u.config({precision:1e9});h>0;)n(a[--h],o[--d])===m&&(g=g.plus(v)),v=v.times(y);for(;d>0;)n(s,o[--d])===m&&(g=g.plus(v)),v=v.times(y);return u.config({precision:b}),0===m&&(g.s=-g.s),g}function Wi(e){for(var t=e.d,n=t[0]+"",r=1;r<t.length;++r){for(var i=t[r]+"",a=7-i.length;a--;)i="0"+i;n+=i}for(var o=n.length;"0"===n.charAt(o);)o--;var s=e.e,u=n.slice(0,o+1||1),c=u.length;if(s>0)if(++s>c)for(s-=c;s--;)u+="0";else s<c&&(u=u.slice(0,s)+"."+u.slice(s));for(var l=[0],f=0;f<u.length;){for(var p=l.length;p--;)l[p]*=10;l[0]+=parseInt(u.charAt(f++));for(var h=0;h<l.length;++h)l[h]>1&&(null!==l[h+1]&&void 0!==l[h+1]||(l[h+1]=0),l[h+1]+=l[h]>>1,l[h]&=1)}return l.reverse()}function Vi(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitXor");var n=e.constructor;if(e.isNaN()||t.isNaN())return new n(NaN);if(e.isZero())return t;if(t.isZero())return e;if(e.eq(t))return new n(0);var r=new n(-1);return e.eq(r)?ji(t):t.eq(r)?ji(e):e.isFinite()&&t.isFinite()?qi(e,t,(function(e,t){return e^t})):e.isFinite()||t.isFinite()?new n(e.isNegative()===t.isNegative()?1/0:-1/0):r}function $i(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function leftShift");var n=e.constructor;return e.isNaN()||t.isNaN()||t.isNegative()&&!t.isZero()?new n(NaN):e.isZero()||t.isZero()?e:e.isFinite()||t.isFinite()?t.lt(55)?e.times(Math.pow(2,t.toNumber())+""):e.times(new n(2).pow(t)):new n(NaN)}function Hi(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function rightArithShift");var n=e.constructor;return e.isNaN()||t.isNaN()||t.isNegative()&&!t.isZero()?new n(NaN):e.isZero()||t.isZero()?e:t.isFinite()?t.lt(55)?e.div(Math.pow(2,t.toNumber())+"").floor():e.div(new n(2).pow(t)).floor():e.isNegative()?new n(-1):e.isFinite()?new n(0):new n(NaN)}var Gi="number, number";function Ki(e,t){if(!Se(e)||!Se(t))throw new Error("Integers expected in function bitAnd");return e&t}function Xi(e){if(!Se(e))throw new Error("Integer expected in function bitNot");return~e}function Yi(e,t){if(!Se(e)||!Se(t))throw new Error("Integers expected in function bitOr");return e|t}function Ji(e,t){if(!Se(e)||!Se(t))throw new Error("Integers expected in function bitXor");return e^t}function Zi(e,t){if(!Se(e)||!Se(t))throw new Error("Integers expected in function leftShift");return e<<t}function Qi(e,t){if(!Se(e)||!Se(t))throw new Error("Integers expected in function rightArithShift");return e>>t}function ea(e,t){if(!Se(e)||!Se(t))throw new Error("Integers expected in function rightLogShift");return e>>>t}Ki.signature=Gi,Xi.signature="number",Yi.signature=Gi,Ji.signature=Gi,Zi.signature=Gi,Qi.signature=Gi,ea.signature=Gi;var ta="bitNot",na=be(ta,["typed"],(e=>{var{typed:t}=e;return t(ta,{number:Xi,BigNumber:ji,"Array | Matrix":function(e){return _r(e,this)}})})),ra="boolean",ia=be(ra,["typed"],(e=>{var{typed:t}=e;return t(ra,{"":function(){return!1},boolean:function(e){return e},number:function(e){return!!e},null:function(e){return!1},BigNumber:function(e){return!e.isZero()},string:function(e){var t=e.toLowerCase();if("true"===t)return!0;if("false"===t)return!1;var n=Number(e);if(""!==e&&!isNaN(n))return!!n;throw new Error('Cannot convert "'+e+'" to a boolean')},"Array | Matrix":function(e){return _r(e,this)}})})),aa="clone",oa=be(aa,["typed"],(e=>{var{typed:t}=e;return t(aa,{any:re})}));function sa(e,t){if(t<e)return 1;if(t===e)return t;var n=t+e>>1;return sa(e,n)*sa(n+1,t)}function ua(e,t){if(!Se(e)||e<0)throw new TypeError("Positive integer value expected in function combinations");if(!Se(t)||t<0)throw new TypeError("Positive integer value expected in function combinations");if(t>e)throw new TypeError("k must be less than or equal to n");var n=e-t;return t<n?sa(n+1,e)/sa(1,t):sa(t+1,e)/sa(1,n)}ua.signature="number, number";var ca="combinations",la=be(ca,["typed"],(e=>{var{typed:t}=e;return t(ca,{"number, number":ua,"BigNumber, BigNumber":function(e,t){var n,r,i=e.constructor,a=e.minus(t),o=new i(1);if(!fa(e)||!fa(t))throw new TypeError("Positive integer value expected in function combinations");if(t.gt(e))throw new TypeError("k must be less than n in function combinations");if(n=o,t.lt(a))for(r=o;r.lte(a);r=r.plus(o))n=n.times(t.plus(r)).dividedBy(r);else for(r=o;r.lte(t);r=r.plus(o))n=n.times(a.plus(r)).dividedBy(r);return n}})}));function fa(e){return e.isInteger()&&e.gte(0)}var pa=be("complex",["typed","Complex"],(e=>{var{typed:t,Complex:n}=e;return t("complex",{"":function(){return n.ZERO},number:function(e){return new n(e,0)},"number, number":function(e,t){return new n(e,t)},"BigNumber, BigNumber":function(e,t){return new n(e.toNumber(),t.toNumber())},Fraction:function(e){return new n(e.valueOf(),0)},Complex:function(e){return e.clone()},string:function(e){return n(e)},null:function(e){return n(0)},Object:function(e){if("re"in e&&"im"in e)return new n(e.re,e.im);if("r"in e&&"phi"in e||"abs"in e&&"arg"in e)return new n(e);throw new Error("Expected object with properties (re and im) or (r and phi) or (abs and arg)")},"Array | Matrix":function(e){return _r(e,this)}})})),ha="conj",da=be(ha,["typed"],(e=>{var{typed:t}=e;return t(ha,{number:function(e){return e},BigNumber:function(e){return e},Complex:function(e){return e.conjugate()},"Array | Matrix":function(e){return _r(e,this)}})})),ma="cosh",ga=be(ma,["typed"],(e=>{var{typed:t}=e;return t(ma,{number:We,Complex:function(e){return e.cosh()},BigNumber:function(e){return e.cosh()},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cosh is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),va="coth",ya=be(va,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t(va,{number:bi,Complex:function(e){return e.coth()},BigNumber:function(e){return new n(1).div(e.tanh())},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function coth is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),ba=be("csc",["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t("csc",{number:xi,Complex:function(e){return e.csc()},BigNumber:function(e){return new n(1).div(e.sin())},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function csc is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),xa="cube",wa=be(xa,["typed"],(e=>{var{typed:t}=e;return t(xa,{number:qr,Complex:function(e){return e.mul(e).mul(e)},BigNumber:function(e){return e.times(e).times(e)},Fraction:function(e){return e.pow(3)},"Array | Matrix":function(e){return _r(e,this,!0)},Unit:function(e){return e.pow(3)}})}));function Ea(e,t,n){if(null==n)return e.eq(t);if(e.eq(t))return!0;if(e.isNaN()||t.isNaN())return!1;if(e.isFinite()&&t.isFinite()){var r=e.minus(t).abs();if(r.isZero())return!0;var i=e.constructor.max(e.abs(),t.abs());return r.lte(i.times(n))}return!1}var Ca="equalScalar",Sa=be(Ca,["typed","config"],(e=>{var{typed:t,config:n}=e;return t(Ca,{"boolean, boolean":function(e,t){return e===t},"number, number":function(e,t){return Le(e,t,n.epsilon)},"BigNumber, BigNumber":function(e,t){return e.eq(t)||Ea(e,t,n.epsilon)},"Fraction, Fraction":function(e,t){return e.equals(t)},"Complex, Complex":function(e,t){return function(e,t,n){return Le(e.re,t.re,n)&&Le(e.im,t.im,n)}(e,t,n.epsilon)},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return this(e.value,t.value)}})})),Na=(be(Ca,["typed","config"],(e=>{var{typed:t,config:n}=e;return t(Ca,{"number, number":function(e,t){return Le(e,t,n.epsilon)}})})),be("erf",["typed"],(e=>{var{typed:t}=e;return t("name",{number:function(e){var t=Math.abs(e);return t>=Ma?Ne(e):t<=Aa?Ne(e)*function(e){var t,n=e*e,r=Da[0][4]*n,i=n;for(t=0;t<3;t+=1)r=(r+Da[0][t])*n,i=(i+_a[0][t])*n;return e*(r+Da[0][3])/(i+_a[0][3])}(t):t<=4?Ne(e)*(1-function(e){var t,n=Da[1][8]*e,r=e;for(t=0;t<7;t+=1)n=(n+Da[1][t])*e,r=(r+_a[1][t])*e;var i=(n+Da[1][7])/(r+_a[1][7]),a=parseInt(16*e)/16,o=(e-a)*(e+a);return Math.exp(-a*a)*Math.exp(-o)*i}(t)):Ne(e)*(1-function(e){var t,n=1/(e*e),r=Da[2][5]*n,i=n;for(t=0;t<4;t+=1)r=(r+Da[2][t])*n,i=(i+_a[2][t])*n;var a=n*(r+Da[2][4])/(i+_a[2][4]);a=(ka-a)/e;var o=(e-(n=parseInt(16*e)/16))*(e+n);return Math.exp(-n*n)*Math.exp(-o)*a}(t))},"Array | Matrix":function(e){return _r(e,this)}})}))),Aa=.46875,ka=.5641895835477563,Da=[[3.1611237438705655,113.86415415105016,377.485237685302,3209.3775891384694,.18577770618460315],[.5641884969886701,8.883149794388377,66.11919063714163,298.6351381974001,881.952221241769,1712.0476126340707,2051.0783778260716,1230.3393547979972,2.1531153547440383e-8],[.30532663496123236,.36034489994980445,.12578172611122926,.016083785148742275,.0006587491615298378,.016315387137302097]],_a=[[23.601290952344122,244.02463793444417,1282.6165260773723,2844.236833439171],[15.744926110709835,117.6939508913125,537.1811018620099,1621.3895745666903,3290.7992357334597,4362.619090143247,3439.3676741437216,1230.3393548037495],[2.568520192289822,1.8729528499234604,.5279051029514285,.06051834131244132,.0023352049762686918]],Ma=Math.pow(2,53),Ta=be("exp",["typed"],(e=>{var{typed:t}=e;return t("exp",{number:Wr,Complex:function(e){return e.exp()},BigNumber:function(e){return e.exp()},"Array | Matrix":function(e){return _r(e,this)}})})),Oa="expm1",Ia=be(Oa,["typed","Complex"],(e=>{var{typed:t,Complex:n}=e;return t(Oa,{number:Vr,Complex:function(e){var t=Math.exp(e.re);return new n(t*Math.cos(e.im)-1,t*Math.sin(e.im))},BigNumber:function(e){return e.exp().minus(1)},"Array | Matrix":function(e){return _r(e,this)}})})),Fa=be("filter",["typed"],(e=>{var{typed:t}=e;return t("filter",{"Array, function":Ra,"Matrix, function":function(e,t){return e.create(Ra(e.toArray(),t))},"Array, RegExp":tr,"Matrix, RegExp":function(e,t){return e.create(tr(e.toArray(),t))}})}));function Ra(e,t){var n=Xe(t);return er(e,(function(e,r,i){return 1===n?t(e):2===n?t(e,[r]):t(e,[r],i)}))}var Ba="forEach",za=be(Ba,["typed"],(e=>{var{typed:t}=e;return t(Ba,{"Array, function":Pa,"Matrix, function":function(e,t){return e.forEach(t)}})}));function Pa(e,t){var n=Xe(t);!function r(i,a){Array.isArray(i)?Qn(i,(function(e,t){r(e,a.concat(t))})):1===n?t(i):2===n?t(i,a):t(i,a,e)}(e,[])}var La="format",ja=be(La,["typed"],(e=>{var{typed:t}=e;return t(La,{any:Tn,"any, Object | function | number":Tn})})),Ua="getMatrixDataType",qa=be(Ua,["typed"],(e=>{var{typed:t}=e;return t(Ua,{Array:function(e){return ar(e,ne)},Matrix:function(e){return e.getDataType()}})})),Wa=be("hex",["typed","format"],(e=>{var{typed:t,format:n}=e;return t("hex",{"number | BigNumber":function(e){return n(e,{notation:"hex"})},"number | BigNumber, number":function(e,t){return n(e,{notation:"hex",wordSize:t})}})})),Va=be("im",["typed"],(e=>{var{typed:t}=e;return t("im",{number:function(e){return 0},BigNumber:function(e){return e.mul(0)},Fraction:function(e){return e.mul(0)},Complex:function(e){return e.im},"Array | Matrix":function(e){return _r(e,this)}})})),$a="isInteger",Ha=be($a,["typed"],(e=>{var{typed:t}=e;return t($a,{number:Se,BigNumber:function(e){return e.isInt()},Fraction:function(e){return 1===e.d&&isFinite(e.n)},"Array | Matrix":function(e){return _r(e,this)}})})),Ga="number";function Ka(e){return e<0}function Xa(e){return e>0}function Ya(e){return 0===e}function Ja(e){return Number.isNaN(e)}Ka.signature=Ga,Xa.signature=Ga,Ya.signature=Ga,Ja.signature=Ga;var Za="isNegative",Qa=be(Za,["typed"],(e=>{var{typed:t}=e;return t(Za,{number:Ka,BigNumber:function(e){return e.isNeg()&&!e.isZero()&&!e.isNaN()},Fraction:function(e){return e.s<0},Unit:function(e){return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),eo="isPositive",to=be(eo,["typed"],(e=>{var{typed:t}=e;return t(eo,{number:Xa,BigNumber:function(e){return!e.isNeg()&&!e.isZero()&&!e.isNaN()},Fraction:function(e){return e.s>0&&e.n>0},Unit:function(e){return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),no="isZero",ro=be(no,["typed"],(e=>{var{typed:t}=e;return t(no,{number:Ya,BigNumber:function(e){return e.isZero()},Complex:function(e){return 0===e.re&&0===e.im},Fraction:function(e){return 1===e.d&&0===e.n},Unit:function(e){return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),io="log10",ao=be(io,["typed","config","Complex"],(e=>{var{typed:t,config:n,Complex:r}=e;return t(io,{number:function(e){return e>=0||n.predictable?Kr(e):new r(e,0).log().div(Math.LN10)},Complex:function(e){return new r(e).log().div(Math.LN10)},BigNumber:function(e){return!e.isNegative()||n.predictable?e.log():new r(e.toNumber(),0).log().div(Math.LN10)},"Array | Matrix":function(e){return _r(e,this)}})})),oo="log2",so=be(oo,["typed","config","Complex"],(e=>{var{typed:t,config:n,Complex:r}=e;return t(oo,{number:function(e){return e>=0||n.predictable?Xr(e):i(new r(e,0))},Complex:i,BigNumber:function(e){return!e.isNegative()||n.predictable?e.log(2):i(new r(e.toNumber(),0))},"Array | Matrix":function(e){return _r(e,this)}});function i(e){var t=Math.sqrt(e.re*e.re+e.im*e.im);return new r(Math.log2?Math.log2(t):Math.log(t)/Math.LN2,Math.atan2(e.im,e.re)/Math.LN2)}})),uo=be("map",["typed"],(e=>{var{typed:t}=e;return t("map",{"Array, function":co,"Matrix, function":function(e,t){return e.map(t)}})}));function co(e,t){var n=Xe(t);return function r(i,a){return Array.isArray(i)?i.map((function(e,t){return r(e,a.concat(t))})):1===n?t(i):2===n?t(i,a):t(i,a,e)}(e,[])}var lo=be("multiplyScalar",["typed"],(e=>{var{typed:t}=e;return t("multiplyScalar",{"number, number":zr,"Complex, Complex":function(e,t){return e.mul(t)},"BigNumber, BigNumber":function(e,t){return e.times(t)},"Fraction, Fraction":function(e,t){return e.mul(t)},"number | Fraction | BigNumber | Complex, Unit":function(e,t){var n=t.clone();return n.value=null===n.value?n._normalize(e):this(n.value,e),n},"Unit, number | Fraction | BigNumber | Complex":function(e,t){var n=e.clone();return n.value=null===n.value?n._normalize(t):this(n.value,t),n},"Unit, Unit":function(e,t){return e.multiply(t)}})})),fo="number, number";function po(e){return!e}function ho(e,t){return!(!e&&!t)}function mo(e,t){return!!e!=!!t}function go(e,t){return!(!e||!t)}po.signature="number",ho.signature=fo,mo.signature=fo,go.signature=fo;var vo=be("not",["typed"],(e=>{var{typed:t}=e;return t("not",{number:po,Complex:function(e){return 0===e.re&&0===e.im},BigNumber:function(e){return e.isZero()||e.isNaN()},Unit:function(e){return null===e.value||this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),yo=be("number",["typed"],(e=>{var{typed:t}=e,n=t("number",{"":function(){return 0},number:function(e){return e},string:function(e){if("NaN"===e)return NaN;var t,n,r=(n=(t=e).match(/(0[box])([0-9a-fA-F]*)\.([0-9a-fA-F]*)/))?{input:t,radix:{"0b":2,"0o":8,"0x":16}[n[1]],integerPart:n[2],fractionalPart:n[3]}:null;if(r)return function(e){for(var t=parseInt(e.integerPart,e.radix),n=0,r=0;r<e.fractionalPart.length;r++)n+=parseInt(e.fractionalPart[r],e.radix)/Math.pow(e.radix,r+1);var i=t+n;if(isNaN(i))throw new SyntaxError('String "'+e.input+'" is no valid number');return i}(r);var i=0,a=e.match(/(0[box][0-9a-fA-F]*)i([0-9]*)/);a&&(i=Number(a[2]),e=a[1]);var o=Number(e);if(isNaN(o))throw new SyntaxError('String "'+e+'" is no valid number');if(a){if(o>2**i-1)throw new SyntaxError('String "'.concat(e,'" is out of range'));o>=2**(i-1)&&(o-=2**i)}return o},BigNumber:function(e){return e.toNumber()},Fraction:function(e){return e.valueOf()},Unit:function(e){throw new Error("Second argument with valueless unit expected")},null:function(e){return 0},"Unit, string | Unit":function(e,t){return e.toNumber(t)},"Array | Matrix":function(e){return _r(e,this)}});return n.fromJSON=function(e){return parseFloat(e.value)},n})),bo=be("oct",["typed","format"],(e=>{var{typed:t,format:n}=e;return t("oct",{"number | BigNumber":function(e){return n(e,{notation:"oct"})},"number | BigNumber, number":function(e,t){return n(e,{notation:"oct",wordSize:t})}})})),xo=n(4676),wo=xo(Date.now());function Eo(e){var t,n;return t=null===(n=e)?wo:xo(String(n)),function(){return t()}}var Co="pickRandom",So=be(Co,["typed","config","?on"],(e=>{var{typed:t,config:n,on:r}=e,i=Eo(n.randomSeed);return r&&r("config",(function(e,t){e.randomSeed!==t.randomSeed&&(i=Eo(e.randomSeed))})),t(Co,{"Array | Matrix":function(e){return a(e,{})},"Array | Matrix, Object":function(e,t){return a(e,t)},"Array | Matrix, number":function(e,t){return a(e,{number:t})},"Array | Matrix, Array | Matrix":function(e,t){return a(e,{weights:t})},"Array | Matrix, Array | Matrix, number":function(e,t,n){return a(e,{number:n,weights:t})},"Array | Matrix, number, Array | Matrix":function(e,t,n){return a(e,{number:t,weights:n})}});function a(e,t){var{number:n,weights:r,elementWise:a=!0}=t,o=void 0===n;o&&(n=1);var s=N(e)?e.create:N(r)?r.create:null;e=e.valueOf(),r&&(r=r.valueOf()),!0===a&&(e=Jn(e),r=Jn(r));var u=0;if(void 0!==r){if(r.length!==e.length)throw new Error("Weights must have the same length as possibles");for(var c=0,l=r.length;c<l;c++){if(!y(r[c])||r[c]<0)throw new Error("Weights must be an array of positive numbers");u+=r[c]}}for(var f,p=e.length,h=[];h.length<n;){if(void 0===r)f=e[Math.floor(i()*p)];else for(var d=i()*u,m=0,g=e.length;m<g;m++)if((d-=r[m])<0){f=e[m];break}h.push(f)}return o?h[0]:s?s(h):h}})),No="print",Ao=be(No,["typed"],(e=>{var{typed:t}=e;return t(No,{"string, Object | Array":ko,"string, Object | Array, number | Object":ko})}));function ko(e,t,n){return e.replace(/\$([\w.]+)/g,(function(e,r){for(var i=r.split("."),a=t[i.shift()];i.length&&void 0!==a;){var o=i.shift();a=o?a[o]:a+"."}return void 0!==a?C(a)?a:Tn(a,n):e}))}function Do(e,t){var n=[];if((e=e.slice(0)).length>1)for(var r=0,i=e.shift();r<i;r++)n.push(Do(e,t));else for(var a=0,o=e.shift();a<o;a++)n.push(t());return n}var _o="random",Mo=be(_o,["typed","config","?on"],(e=>{var{typed:t,config:n,on:r}=e,i=Eo(n.randomSeed);return r&&r("config",(function(e,t){e.randomSeed!==t.randomSeed&&(i=Eo(e.randomSeed))})),t(_o,{"":()=>o(0,1),number:e=>o(0,e),"number, number":(e,t)=>o(e,t),"Array | Matrix":e=>a(e,0,1),"Array | Matrix, number":(e,t)=>a(e,0,t),"Array | Matrix, number, number":(e,t,n)=>a(e,t,n)});function a(e,t,n){var r=Do(e.valueOf(),(()=>o(t,n)));return N(e)?e.create(r):r}function o(e,t){return e+i()*(t-e)}})),To=be("re",["typed"],(e=>{var{typed:t}=e;return t("re",{number:function(e){return e},BigNumber:function(e){return e},Fraction:function(e){return e},Complex:function(e){return e.re},"Array | Matrix":function(e){return _r(e,this)}})})),Oo=be("sec",["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t("sec",{number:Ei,Complex:function(e){return e.sec()},BigNumber:function(e){return new n(1).div(e.cos())},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sec is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),Io="sign",Fo=be(Io,["typed","BigNumber","Fraction","complex"],(e=>{var{typed:t,BigNumber:n,complex:r,Fraction:i}=e;return t(Io,{number:Zr,Complex:function(e){return 0===e.im?r(Zr(e.re)):e.sign()},BigNumber:function(e){return new n(e.cmp(0))},Fraction:function(e){return new i(e.s,1)},"Array | Matrix":function(e){return _r(e,this,!0)},Unit:function(e){return this(e.value)}})})),Ro=be("sin",["typed"],(e=>{var{typed:t}=e;return t("sin",{number:Math.sin,Complex:function(e){return e.sin()},BigNumber:function(e){return e.sin()},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sin is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this,!0)}})})),Bo=be("SparseMatrix",["typed","equalScalar","Matrix"],(e=>{var{typed:t,equalScalar:n,Matrix:r}=e;function i(e,t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(t&&!C(t))throw new Error("Invalid datatype: "+t);if(N(e))!function(e,t,n){"SparseMatrix"===t.type?(e._values=t._values?re(t._values):void 0,e._index=re(t._index),e._ptr=re(t._ptr),e._size=re(t._size),e._datatype=n||t._datatype):a(e,t.valueOf(),n||t._datatype)}(this,e,t);else if(e&&S(e.index)&&S(e.ptr)&&S(e.size))this._values=e.values,this._index=e.index,this._ptr=e.ptr,this._size=e.size,this._datatype=t||e.datatype;else if(S(e))a(this,e,t);else{if(e)throw new TypeError("Unsupported type of data ("+ne(e)+")");this._values=[],this._index=[],this._ptr=[0],this._size=[0,0],this._datatype=t}}function a(e,r,i){e._values=[],e._index=[],e._ptr=[],e._datatype=i;var a=r.length,o=0,s=n,u=0;if(C(i)&&(s=t.find(n,[i,i])||n,u=t.convert(0,i)),a>0){var c=0;do{e._ptr.push(e._index.length);for(var l=0;l<a;l++){var f=r[l];if(S(f)){if(0===c&&o<f.length&&(o=f.length),c<f.length){var p=f[c];s(p,u)||(e._values.push(p),e._index.push(l))}}else 0===c&&o<1&&(o=1),s(f,u)||(e._values.push(f),e._index.push(l))}c++}while(c<o)}e._ptr.push(e._index.length),e._size=[a,o]}function o(e,t){if(!M(t))throw new TypeError("Invalid index");if(t.isScalar())return e.get(t.min());var n,r,a,o,s=t.size();if(s.length!==e._size.length)throw new Bn(s.length,e._size.length);var u=t.min(),c=t.max();for(n=0,r=e._size.length;n<r;n++)Un(u[n],e._size[n]),Un(c[n],e._size[n]);var l=e._values,f=e._index,p=e._ptr,h=t.dimension(0),d=t.dimension(1),m=[],g=[];h.forEach((function(e,t){g[e]=t[0],m[e]=!0}));var v=l?[]:void 0,y=[],b=[];return d.forEach((function(e){for(b.push(y.length),a=p[e],o=p[e+1];a<o;a++)n=f[a],!0===m[n]&&(y.push(g[n]),v&&v.push(l[a]))})),b.push(y.length),new i({values:v,index:y,ptr:b,size:s,datatype:e._datatype})}function s(e,t,n,r){if(!t||!0!==t.isIndex)throw new TypeError("Invalid index");var i,a=t.size(),o=t.isScalar();if(N(n)?(i=n.size(),n=n.toArray()):i=Pn(n),o){if(0!==i.length)throw new TypeError("Scalar expected");e.set(t.min(),n,r)}else{if(1!==a.length&&2!==a.length)throw new Bn(a.length,e._size.length,"<");if(i.length<a.length){for(var s=0,u=0;1===a[s]&&1===i[s];)s++;for(;1===a[s];)u++,s++;n=Xn(n,a.length,u,i)}if(!se(a,i))throw new Bn(a,i,">");if(1===a.length)t.dimension(0).forEach((function(t,i){Un(t),e.set([t,0],n[i[0]],r)}));else{var c=t.dimension(0),l=t.dimension(1);c.forEach((function(t,i){Un(t),l.forEach((function(a,o){Un(a),e.set([t,a],n[i[0]][o[0]],r)}))}))}}return e}function u(e,t,n,r){if(n-t==0)return n;for(var i=t;i<n;i++)if(r[i]===e)return i;return t}function c(e,t,n,r,i,a,o){i.splice(e,0,r),a.splice(e,0,t);for(var s=n+1;s<o.length;s++)o[s]++}function l(e,r,i,a){var o=a||0,s=n,u=0;C(e._datatype)&&(s=t.find(n,[e._datatype,e._datatype])||n,u=t.convert(0,e._datatype),o=t.convert(o,e._datatype));var c,l,f,p=!s(o,u),h=e._size[0],d=e._size[1];if(i>d){for(l=d;l<i;l++)if(e._ptr[l]=e._values.length,p)for(c=0;c<h;c++)e._values.push(o),e._index.push(c);e._ptr[i]=e._values.length}else i<d&&(e._ptr.splice(i+1,d-i),e._values.splice(e._ptr[i],e._values.length),e._index.splice(e._ptr[i],e._index.length));if(d=i,r>h){if(p){var m=0;for(l=0;l<d;l++){e._ptr[l]=e._ptr[l]+m,f=e._ptr[l+1]+m;var g=0;for(c=h;c<r;c++,g++)e._values.splice(f+g,0,o),e._index.splice(f+g,0,c),m++}e._ptr[d]=e._values.length}}else if(r<h){var v=0;for(l=0;l<d;l++){e._ptr[l]=e._ptr[l]-v;var y=e._ptr[l],b=e._ptr[l+1]-v;for(f=y;f<b;f++)(c=e._index[f])>r-1&&(e._values.splice(f,1),e._index.splice(f,1),v++)}e._ptr[l]=e._values.length}return e._size[0]=r,e._size[1]=i,e}function f(e,t,n,r,i){var a,o,s=r[0],u=r[1],c=[];for(a=0;a<s;a++)for(c[a]=[],o=0;o<u;o++)c[a][o]=0;for(o=0;o<u;o++)for(var l=n[o],f=n[o+1],p=l;p<f;p++)c[a=t[p]][o]=e?i?re(e[p]):e[p]:1;return c}return i.prototype=new r,i.prototype.createSparseMatrix=function(e,t){return new i(e,t)},i.prototype.type="SparseMatrix",i.prototype.isSparseMatrix=!0,i.prototype.getDataType=function(){return ar(this._values,ne)},i.prototype.storage=function(){return"sparse"},i.prototype.datatype=function(){return this._datatype},i.prototype.create=function(e,t){return new i(e,t)},i.prototype.density=function(){var e=this._size[0],t=this._size[1];return 0!==e&&0!==t?this._index.length/(e*t):0},i.prototype.subset=function(e,t,n){if(!this._values)throw new Error("Cannot invoke subset on a Pattern only matrix");switch(arguments.length){case 1:return o(this,e);case 2:case 3:return s(this,e,t,n);default:throw new SyntaxError("Wrong number of arguments")}},i.prototype.get=function(e){if(!S(e))throw new TypeError("Array expected");if(e.length!==this._size.length)throw new Bn(e.length,this._size.length);if(!this._values)throw new Error("Cannot invoke get on a Pattern only matrix");var t=e[0],n=e[1];Un(t,this._size[0]),Un(n,this._size[1]);var r=u(t,this._ptr[n],this._ptr[n+1],this._index);return r<this._ptr[n+1]&&this._index[r]===t?this._values[r]:0},i.prototype.set=function(e,r,i){if(!S(e))throw new TypeError("Array expected");if(e.length!==this._size.length)throw new Bn(e.length,this._size.length);if(!this._values)throw new Error("Cannot invoke set on a Pattern only matrix");var a=e[0],o=e[1],s=this._size[0],f=this._size[1],p=n,h=0;C(this._datatype)&&(p=t.find(n,[this._datatype,this._datatype])||n,h=t.convert(0,this._datatype)),(a>s-1||o>f-1)&&(l(this,Math.max(a+1,s),Math.max(o+1,f),i),s=this._size[0],f=this._size[1]),Un(a,s),Un(o,f);var d=u(a,this._ptr[o],this._ptr[o+1],this._index);return d<this._ptr[o+1]&&this._index[d]===a?p(r,h)?function(e,t,n,r,i){n.splice(e,1),r.splice(e,1);for(var a=t+1;a<i.length;a++)i[a]--}(d,o,this._values,this._index,this._ptr):this._values[d]=r:c(d,a,o,r,this._values,this._index,this._ptr),this},i.prototype.resize=function(e,t,n){if(!A(e))throw new TypeError("Array or Matrix expected");var r=e.valueOf().map((e=>Array.isArray(e)&&1===e.length?e[0]:e));if(2!==r.length)throw new Error("Only two dimensions matrix are supported");return r.forEach((function(e){if(!y(e)||!Se(e)||e<0)throw new TypeError("Invalid size, must contain positive integers (size: "+Tn(r)+")")})),l(n?this.clone():this,r[0],r[1],t)},i.prototype.reshape=function(e,t){if(!S(e))throw new TypeError("Array expected");if(2!==e.length)throw new Error("Sparse matrices can only be reshaped in two dimensions");e.forEach((function(t){if(!y(t)||!Se(t)||t<=-2||0===t)throw new TypeError("Invalid size, must contain positive integers or -1 (size: "+Tn(e)+")")}));var n=this._size[0]*this._size[1];if(n!==(e=$n(e,n))[0]*e[1])throw new Error("Reshaping sparse matrix will result in the wrong number of elements");var r=t?this.clone():this;if(this._size[0]===e[0]&&this._size[1]===e[1])return r;for(var i=[],a=0;a<r._ptr.length;a++)for(var o=0;o<r._ptr[a+1]-r._ptr[a];o++)i.push(a);for(var s=r._values.slice(),l=r._index.slice(),f=0;f<r._index.length;f++){var p=l[f],h=i[f],d=p*r._size[1]+h;i[f]=d%e[1],l[f]=Math.floor(d/e[1])}r._values.length=0,r._index.length=0,r._ptr.length=e[1]+1,r._size=e.slice();for(var m=0;m<r._ptr.length;m++)r._ptr[m]=0;for(var g=0;g<s.length;g++){var v=l[g],b=i[g],x=s[g];c(u(v,r._ptr[b],r._ptr[b+1],r._index),v,b,x,r._values,r._index,r._ptr)}return r},i.prototype.clone=function(){return new i({values:this._values?re(this._values):void 0,index:re(this._index),ptr:re(this._ptr),size:re(this._size),datatype:this._datatype})},i.prototype.size=function(){return this._size.slice(0)},i.prototype.map=function(e,r){if(!this._values)throw new Error("Cannot invoke map on a Pattern only matrix");var a=this;return function(e,r,a,o,s,u,c){var l=[],f=[],p=[],h=n,d=0;C(e._datatype)&&(h=t.find(n,[e._datatype,e._datatype])||n,d=t.convert(0,e._datatype));for(var m=function(e,t,n){e=u(e,t,n),h(e,d)||(l.push(e),f.push(t))},g=0;g<=s;g++){p.push(l.length);var v=e._ptr[g],y=e._ptr[g+1];if(c)for(var b=v;b<y;b++){var x=e._index[b];x>=0&&x<=a&&m(e._values[b],x-0,g-0)}else{for(var w={},E=v;E<y;E++)w[e._index[E]]=e._values[E];for(var S=0;S<=a;S++)m(S in w?w[S]:0,S-0,g-0)}}return p.push(l.length),new i({values:l,index:f,ptr:p,size:[a-0+1,s-0+1]})}(this,0,this._size[0]-1,0,this._size[1]-1,(function(t,n,r){return e(t,[n,r],a)}),r)},i.prototype.forEach=function(e,t){if(!this._values)throw new Error("Cannot invoke forEach on a Pattern only matrix");for(var n=this._size[0],r=this._size[1],i=0;i<r;i++){var a=this._ptr[i],o=this._ptr[i+1];if(t)for(var s=a;s<o;s++){var u=this._index[s];e(this._values[s],[u,i],this)}else{for(var c={},l=a;l<o;l++)c[this._index[l]]=this._values[l];for(var f=0;f<n;f++)e(f in c?c[f]:0,[f,i],this)}}},i.prototype[Symbol.iterator]=function*(){if(!this._values)throw new Error("Cannot iterate a Pattern only matrix");for(var e=this._size[1],t=0;t<e;t++)for(var n=this._ptr[t],r=this._ptr[t+1],i=n;i<r;i++){var a=this._index[i];yield{value:this._values[i],index:[a,t]}}},i.prototype.toArray=function(){return f(this._values,this._index,this._ptr,this._size,!0)},i.prototype.valueOf=function(){return f(this._values,this._index,this._ptr,this._size,!1)},i.prototype.format=function(e){for(var t=this._size[0],n=this._size[1],r=this.density(),i="Sparse Matrix ["+Tn(t,e)+" x "+Tn(n,e)+"] density: "+Tn(r,e)+"\n",a=0;a<n;a++)for(var o=this._ptr[a],s=this._ptr[a+1],u=o;u<s;u++)i+="\n    ("+Tn(this._index[u],e)+", "+Tn(a,e)+") ==> "+(this._values?Tn(this._values[u],e):"X");return i},i.prototype.toString=function(){return Tn(this.toArray())},i.prototype.toJSON=function(){return{mathjs:"SparseMatrix",values:this._values,index:this._index,ptr:this._ptr,size:this._size,datatype:this._datatype}},i.prototype.diagonal=function(e){if(e){if(b(e)&&(e=e.toNumber()),!y(e)||!Se(e))throw new TypeError("The parameter k must be an integer number")}else e=0;var t=e>0?e:0,n=e<0?-e:0,r=this._size[0],a=this._size[1],o=Math.min(r-n,a-t),s=[],u=[],c=[];c[0]=0;for(var l=t;l<a&&s.length<o;l++)for(var f=this._ptr[l],p=this._ptr[l+1],h=f;h<p;h++){var d=this._index[h];if(d===l-t+n){s.push(this._values[h]),u[s.length-1]=d-n;break}}return c.push(s.length),new i({values:s,index:u,ptr:c,size:[o,1]})},i.fromJSON=function(e){return new i(e)},i.diagonal=function(e,r,a,o,s){if(!S(e))throw new TypeError("Array expected, size parameter");if(2!==e.length)throw new Error("Only two dimensions matrix are supported");if(e=e.map((function(e){if(b(e)&&(e=e.toNumber()),!y(e)||!Se(e)||e<1)throw new Error("Size values must be positive integers");return e})),a){if(b(a)&&(a=a.toNumber()),!y(a)||!Se(a))throw new TypeError("The parameter k must be an integer number")}else a=0;var u=n,c=0;C(s)&&(u=t.find(n,[s,s])||n,c=t.convert(0,s));var l,f=a>0?a:0,p=a<0?-a:0,h=e[0],d=e[1],m=Math.min(h-p,d-f);if(S(r)){if(r.length!==m)throw new Error("Invalid value array length");l=function(e){return r[e]}}else if(N(r)){var g=r.size();if(1!==g.length||g[0]!==m)throw new Error("Invalid matrix length");l=function(e){return r.get([e])}}else l=function(){return r};for(var v=[],x=[],w=[],E=0;E<d;E++){w.push(v.length);var A=E-f;if(A>=0&&A<m){var k=l(A);u(k,c)||(x.push(A+p),v.push(k))}}return w.push(v.length),new i({values:v,index:x,ptr:w,size:[h,d]})},i.prototype.swapRows=function(e,t){if(!(y(e)&&Se(e)&&y(t)&&Se(t)))throw new Error("Row index must be positive integers");if(2!==this._size.length)throw new Error("Only two dimensional matrix is supported");return Un(e,this._size[0]),Un(t,this._size[0]),i._swapRows(e,t,this._size[1],this._values,this._index,this._ptr),this},i._forEachRow=function(e,t,n,r,i){for(var a=r[e],o=r[e+1],s=a;s<o;s++)i(n[s],t[s])},i._swapRows=function(e,t,n,r,i,a){for(var o=0;o<n;o++){var s=a[o],c=a[o+1],l=u(e,s,c,i),f=u(t,s,c,i);if(l<c&&f<c&&i[l]===e&&i[f]===t){if(r){var p=r[l];r[l]=r[f],r[f]=p}}else if(l<c&&i[l]===e&&(f>=c||i[f]!==t)){var h=r?r[l]:void 0;i.splice(f,0,t),r&&r.splice(f,0,h),i.splice(f<=l?l+1:l,1),r&&r.splice(f<=l?l+1:l,1)}else if(f<c&&i[f]===t&&(l>=c||i[l]!==e)){var d=r?r[f]:void 0;i.splice(l,0,e),r&&r.splice(l,0,d),i.splice(l<=f?f+1:f,1),r&&r.splice(l<=f?f+1:f,1)}}},i}),{isClass:!0}),zo="splitUnit",Po=be(zo,["typed"],(e=>{var{typed:t}=e;return t(zo,{"Unit, Array":function(e,t){return e.splitUnit(t)}})})),Lo="square",jo=be(Lo,["typed"],(e=>{var{typed:t}=e;return t(Lo,{number:Qr,Complex:function(e){return e.mul(e)},BigNumber:function(e){return e.times(e)},Fraction:function(e){return e.mul(e)},"Array | Matrix":function(e){return _r(e,this,!0)},Unit:function(e){return e.pow(2)}})})),Uo="string",qo=be(Uo,["typed"],(e=>{var{typed:t}=e;return t(Uo,{"":function(){return""},number:Oe,null:function(e){return"null"},boolean:function(e){return e+""},string:function(e){return e},"Array | Matrix":function(e){return _r(e,this)},any:function(e){return String(e)}})})),Wo=be("tan",["typed"],(e=>{var{typed:t}=e;return t("tan",{number:Math.tan,Complex:function(e){return e.tan()},BigNumber:function(e){return e.tan()},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function tan is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this,!0)}})})),Vo="typeOf",$o=be(Vo,["typed"],(e=>{var{typed:t}=e;return t(Vo,{any:ne})})),Ho="acosh",Go=be(Ho,["typed","config","Complex"],(e=>{var{typed:t,config:n,Complex:r}=e;return t(Ho,{number:function(e){return e>=1||n.predictable?ci(e):e<=-1?new r(Math.log(Math.sqrt(e*e-1)-e),Math.PI):new r(e,0).acosh()},Complex:function(e){return e.acosh()},BigNumber:function(e){return e.acosh()},"Array | Matrix":function(e){return _r(e,this)}})})),Ko="acsch",Xo=be(Ko,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t(Ko,{number:hi,Complex:function(e){return e.acsch()},BigNumber:function(e){return new n(1).div(e).asinh()},"Array | Matrix":function(e){return _r(e,this)}})})),Yo="apply",Jo=be(Yo,["typed","isInteger"],(e=>{var{typed:t,isInteger:n}=e;return t(Yo,{"Array | Matrix, number | BigNumber, function":function(e,t,r){if(!n(t))throw new TypeError("Integer number expected for dimension");var i=Array.isArray(e)?Pn(e):e.size();if(t<0||t>=i.length)throw new zn(t,i.length);return N(e)?e.create(Zo(e.valueOf(),t,r)):Zo(e,t,r)}})}));function Zo(e,t,n){var r,i,a;if(t<=0){if(Array.isArray(e[0])){for(a=function(e){var t,n,r=e.length,i=e[0].length,a=[];for(n=0;n<i;n++){var o=[];for(t=0;t<r;t++)o.push(e[t][n]);a.push(o)}return a}(e),i=[],r=0;r<a.length;r++)i[r]=Zo(a[r],t-1,n);return i}return n(e)}for(i=[],r=0;r<e.length;r++)i[r]=Zo(e[r],t-1,n);return i}var Qo="asec",es=be(Qo,["typed","config","Complex","BigNumber"],(e=>{var{typed:t,config:n,Complex:r,BigNumber:i}=e;return t(Qo,{number:function(e){return e<=-1||e>=1||n.predictable?di(e):new r(e,0).asec()},Complex:function(e){return e.asec()},BigNumber:function(e){return new i(1).div(e).acos()},"Array | Matrix":function(e){return _r(e,this)}})})),ts=be("bin",["typed","format"],(e=>{var{typed:t,format:n}=e;return t("bin",{"number | BigNumber":function(e){return n(e,{notation:"bin"})},"number | BigNumber, number":function(e,t){return n(e,{notation:"bin",wordSize:t})}})})),ns="combinationsWithRep",rs=be(ns,["typed"],(e=>{var{typed:t}=e;return t(ns,{"number, number":function(e,t){if(!Se(e)||e<0)throw new TypeError("Positive integer value expected in function combinationsWithRep");if(!Se(t)||t<0)throw new TypeError("Positive integer value expected in function combinationsWithRep");if(e<1)throw new TypeError("k must be less than or equal to n + k - 1");return t<e-1?sa(e,e+t-1)/sa(1,t):sa(t+1,e+t-1)/sa(1,e-1)},"BigNumber, BigNumber":function(e,t){var n,r,i=new(0,e.constructor)(1),a=e.minus(i);if(!is(e)||!is(t))throw new TypeError("Positive integer value expected in function combinationsWithRep");if(e.lt(i))throw new TypeError("k must be less than or equal to n + k - 1 in function combinationsWithRep");if(n=i,t.lt(a))for(r=i;r.lte(a);r=r.plus(i))n=n.times(t.plus(r)).dividedBy(r);else for(r=i;r.lte(t);r=r.plus(i))n=n.times(a.plus(r)).dividedBy(r);return n}})}));function is(e){return e.isInteger()&&e.gte(0)}var as=be("cos",["typed"],(e=>{var{typed:t}=e;return t("cos",{number:Math.cos,Complex:function(e){return e.cos()},BigNumber:function(e){return e.cos()},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cos is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),os="csch",ss=be(os,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t(os,{number:wi,Complex:function(e){return e.csch()},BigNumber:function(e){return new n(1).div(e.sinh())},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function csch is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),us="isNaN",cs=be(us,["typed"],(e=>{var{typed:t}=e;return t(us,{number:Ja,BigNumber:function(e){return e.isNaN()},Fraction:function(e){return!1},Complex:function(e){return e.isNaN()},Unit:function(e){return Number.isNaN(e.value)},"Array | Matrix":function(e){return _r(e,Number.isNaN)}})})),ls="isPrime",fs=be(ls,["typed"],(e=>{var{typed:t}=e;return t(ls,{number:function(e){if(0*e!=0)return!1;if(e<=3)return e>1;if(e%2==0||e%3==0)return!1;for(var t=5;t*t<=e;t+=6)if(e%t==0||e%(t+2)==0)return!1;return!0},BigNumber:function(e){if(0*e.toNumber()!=0)return!1;if(e.lte(3))return e.gt(1);if(e.mod(2).eq(0)||e.mod(3).eq(0))return!1;if(e.lt(Math.pow(2,32))){for(var t=e.toNumber(),n=5;n*n<=t;n+=6)if(t%n==0||t%(n+2)==0)return!1;return!0}function r(e,t,n){for(var r=1;!t.eq(0);)t.mod(2).eq(0)?(t=t.div(2),e=e.mul(e).mod(n)):(t=t.sub(1),r=e.mul(r).mod(n));return r}for(var i=e.constructor.clone({precision:2*e.toFixed(0).length}),a=0,o=(e=new i(e)).sub(1);o.mod(2).eq(0);)o=o.div(2),a+=1;var s=null;if(e.lt("3317044064679887385961981"))s=[2,3,5,7,11,13,17,19,23,29,31,37,41].filter((t=>t<e));else{var u=Math.min(e.toNumber()-2,Math.floor(2*Math.pow(e.toFixed(0).length*Math.log(10),2)));s=[];for(var c=2;c<=u;c+=1)s.push(u)}for(var l=0;l<s.length;l+=1){var f=s[l],p=r(e.sub(e).add(f),o,e);if(!p.eq(1))for(var h=0,d=p;!d.eq(e.sub(1));h+=1,d=d.mul(d).mod(e))if(h===a-1)return!1}return!0},"Array | Matrix":function(e){return _r(e,this)}})})),ps="randomInt",hs=be(ps,["typed","config","?on"],(e=>{var{typed:t,config:n,on:r}=e,i=Eo(n.randomSeed);return r&&r("config",(function(e,t){e.randomSeed!==t.randomSeed&&(i=Eo(e.randomSeed))})),t(ps,{"":()=>o(0,1),number:e=>o(0,e),"number, number":(e,t)=>o(e,t),"Array | Matrix":e=>a(e,0,1),"Array | Matrix, number":(e,t)=>a(e,0,t),"Array | Matrix, number, number":(e,t,n)=>a(e,t,n)});function a(e,t,n){var r=Do(e.valueOf(),(()=>o(t,n)));return N(e)?e.create(r):r}function o(e,t){return Math.floor(e+i()*(t-e))}})),ds="sech",ms=be(ds,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t(ds,{number:Ci,Complex:function(e){return e.sech()},BigNumber:function(e){return new n(1).div(e.cosh())},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sech is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),gs="sinh",vs=be(gs,["typed"],(e=>{var{typed:t}=e;return t(gs,{number:Si,Complex:function(e){return e.sinh()},BigNumber:function(e){return e.sinh()},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sinh is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this,!0)}})})),ys="sparse",bs=be(ys,["typed","SparseMatrix"],(e=>{var{typed:t,SparseMatrix:n}=e;return t(ys,{"":function(){return new n([])},string:function(e){return new n([],e)},"Array | Matrix":function(e){return new n(e)},"Array | Matrix, string":function(e,t){return new n(e,t)}})})),xs=be("sqrt",["config","typed","Complex"],(e=>{var{config:t,typed:n,Complex:r}=e;return n("sqrt",{number:i,Complex:function(e){return e.sqrt()},BigNumber:function(e){return!e.isNegative()||t.predictable?e.sqrt():i(e.toNumber())},"Array | Matrix":function(e){return _r(e,this,!0)},Unit:function(e){return e.pow(.5)}});function i(e){return isNaN(e)?NaN:e>=0||t.predictable?Math.sqrt(e):new r(e,0).sqrt()}})),ws=be("tanh",["typed"],(e=>{var{typed:t}=e;return t("tanh",{number:$e,Complex:function(e){return e.tanh()},BigNumber:function(e){return e.tanh()},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function tanh is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this,!0)}})})),Es="unaryMinus",Cs=be(Es,["typed"],(e=>{var{typed:t}=e;return t(Es,{number:Pr,Complex:function(e){return e.neg()},BigNumber:function(e){return e.neg()},Fraction:function(e){return e.neg()},Unit:function(e){var t=e.clone();return t.value=this(e.value),t},"Array | Matrix":function(e){return _r(e,this,!0)}})})),Ss="acoth",Ns=be(Ss,["typed","config","Complex","BigNumber"],(e=>{var{typed:t,config:n,Complex:r,BigNumber:i}=e;return t(Ss,{number:function(e){return e>=1||e<=-1||n.predictable?fi(e):new r(e,0).acoth()},Complex:function(e){return e.acoth()},BigNumber:function(e){return new i(1).div(e).atanh()},"Array | Matrix":function(e){return _r(e,this)}})})),As=be("cot",["typed","BigNumber"],(e=>{var{typed:t,BigNumber:n}=e;return t("cot",{number:yi,Complex:function(e){return e.cot()},BigNumber:function(e){return new n(1).div(e.tan())},Unit:function(e){if(!e.hasBase(e.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cot is no angle");return this(e.value)},"Array | Matrix":function(e){return _r(e,this)}})})),ks=be("fraction",["typed","Fraction"],(e=>{var{typed:t,Fraction:n}=e;return t("fraction",{number:function(e){if(!isFinite(e)||isNaN(e))throw new Error(e+" cannot be represented as a fraction");return new n(e)},string:function(e){return new n(e)},"number, number":function(e,t){return new n(e,t)},null:function(e){return new n(0)},BigNumber:function(e){return new n(e.toString())},Fraction:function(e){return e},Object:function(e){return new n(e)},"Array | Matrix":function(e){return _r(e,this)}})})),Ds="isNumeric",_s=be(Ds,["typed"],(e=>{var{typed:t}=e;return t(Ds,{"number | BigNumber | Fraction | boolean":function(){return!0},"Complex | Unit | string | null | undefined | Node":function(){return!1},"Array | Matrix":function(e){return _r(e,this)}})})),Ms="matrix",Ts=be(Ms,["typed","Matrix","DenseMatrix","SparseMatrix"],(e=>{var{typed:t,Matrix:n,DenseMatrix:r,SparseMatrix:i}=e;return t(Ms,{"":function(){return a([])},string:function(e){return a([],e)},"string, string":function(e,t){return a([],e,t)},Array:function(e){return a(e)},Matrix:function(e){return a(e,e.storage())},"Array | Matrix, string":a,"Array | Matrix, string, string":a});function a(e,t,n){if("dense"===t||"default"===t||void 0===t)return new r(e,n);if("sparse"===t)return new i(e,n);throw new TypeError("Unknown matrix type "+JSON.stringify(t)+".")}})),Os="matrixFromFunction",Is=be(Os,["typed","matrix","isZero"],(e=>{var{typed:t,matrix:n,isZero:r}=e;return t(Os,{"Array | Matrix, function, string, string":function(e,t,n,r){return i(e,t,n,r)},"Array | Matrix, function, string":function(e,t,n){return i(e,t,n)},"Matrix, function":function(e,t){return i(e,t,"dense")},"Array, function":function(e,t){return i(e,t,"dense").toArray()},"Array | Matrix, string, function":function(e,t,n){return i(e,n,t)},"Array | Matrix, string, string, function":function(e,t,n,r){return i(e,r,t,n)}});function i(e,t,i,a){var o;return(o=void 0!==a?n(i,a):n(i)).resize(e),o.forEach((function(e,n){var i=t(n);r(i)||o.set(n,i)})),o}})),Fs=be("algorithm02",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return function(e,r,i,a){var o=e._data,s=e._size,u=e._datatype,c=r._values,l=r._index,f=r._ptr,p=r._size,h=r._datatype;if(s.length!==p.length)throw new Bn(s.length,p.length);if(s[0]!==p[0]||s[1]!==p[1])throw new RangeError("Dimension mismatch. Matrix A ("+s+") must match Matrix B ("+p+")");if(!c)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var d,m=s[0],g=s[1],v=n,y=0,b=i;"string"==typeof u&&u===h&&(d=u,v=t.find(n,[d,d]),y=t.convert(0,d),b=t.find(i,[d,d]));for(var x=[],w=[],E=[],C=0;C<g;C++){E[C]=w.length;for(var S=f[C],N=f[C+1],A=S;A<N;A++){var k=l[A],D=a?b(c[A],o[k][C]):b(o[k][C],c[A]);v(D,y)||(w.push(k),x.push(D))}}return E[g]=w.length,r.createSparseMatrix({values:x,index:w,ptr:E,size:[m,g],datatype:d})}})),Rs=be("algorithm03",["typed"],(e=>{var{typed:t}=e;return function(e,n,r,i){var a=e._data,o=e._size,s=e._datatype,u=n._values,c=n._index,l=n._ptr,f=n._size,p=n._datatype;if(o.length!==f.length)throw new Bn(o.length,f.length);if(o[0]!==f[0]||o[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+o+") must match Matrix B ("+f+")");if(!u)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var h,d=o[0],m=o[1],g=0,v=r;"string"==typeof s&&s===p&&(h=s,g=t.convert(0,h),v=t.find(r,[h,h]));for(var y=[],b=0;b<d;b++)y[b]=[];for(var x=[],w=[],E=0;E<m;E++){for(var C=E+1,S=l[E],N=l[E+1],A=S;A<N;A++){var k=c[A];x[k]=i?v(u[A],a[k][E]):v(a[k][E],u[A]),w[k]=C}for(var D=0;D<d;D++)w[D]===C?y[D][E]=x[D]:y[D][E]=i?v(g,a[D][E]):v(a[D][E],g)}return e.createDenseMatrix({data:y,size:[d,m],datatype:h})}})),Bs=be("algorithm05",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return function(e,r,i){var a=e._values,o=e._index,s=e._ptr,u=e._size,c=e._datatype,l=r._values,f=r._index,p=r._ptr,h=r._size,d=r._datatype;if(u.length!==h.length)throw new Bn(u.length,h.length);if(u[0]!==h[0]||u[1]!==h[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+h+")");var m,g=u[0],v=u[1],y=n,b=0,x=i;"string"==typeof c&&c===d&&(m=c,y=t.find(n,[m,m]),b=t.convert(0,m),x=t.find(i,[m,m]));var w,E,C,S,N=a&&l?[]:void 0,A=[],k=[],D=N?[]:void 0,_=N?[]:void 0,M=[],T=[];for(E=0;E<v;E++){k[E]=A.length;var O=E+1;for(C=s[E],S=s[E+1];C<S;C++)w=o[C],A.push(w),M[w]=O,D&&(D[w]=a[C]);for(C=p[E],S=p[E+1];C<S;C++)M[w=f[C]]!==O&&A.push(w),T[w]=O,_&&(_[w]=l[C]);if(N)for(C=k[E];C<A.length;){var I=M[w=A[C]],F=T[w];if(I===O||F===O){var R=x(I===O?D[w]:b,F===O?_[w]:b);y(R,b)?A.splice(C,1):(N.push(R),C++)}}}return k[v]=A.length,e.createSparseMatrix({values:N,index:A,ptr:k,size:[g,v],datatype:m})}})),zs=be("algorithm11",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return function(e,r,i,a){var o=e._values,s=e._index,u=e._ptr,c=e._size,l=e._datatype;if(!o)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var f,p=c[0],h=c[1],d=n,m=0,g=i;"string"==typeof l&&(f=l,d=t.find(n,[f,f]),m=t.convert(0,f),r=t.convert(r,f),g=t.find(i,[f,f]));for(var v=[],y=[],b=[],x=0;x<h;x++){b[x]=y.length;for(var w=u[x],E=u[x+1],C=w;C<E;C++){var S=s[C],N=a?g(r,o[C]):g(o[C],r);d(N,m)||(y.push(S),v.push(N))}}return b[h]=y.length,e.createSparseMatrix({values:v,index:y,ptr:b,size:[p,h],datatype:f})}})),Ps=be("algorithm12",["typed","DenseMatrix"],(e=>{var{typed:t,DenseMatrix:n}=e;return function(e,r,i,a){var o=e._values,s=e._index,u=e._ptr,c=e._size,l=e._datatype;if(!o)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var f,p=c[0],h=c[1],d=i;"string"==typeof l&&(f=l,r=t.convert(r,f),d=t.find(i,[f,f]));for(var m=[],g=[],v=[],y=0;y<h;y++){for(var b=y+1,x=u[y],w=u[y+1],E=x;E<w;E++){var C=s[E];g[C]=o[E],v[C]=b}for(var S=0;S<p;S++)0===y&&(m[S]=[]),v[S]===b?m[S][y]=a?d(r,g[S]):d(g[S],r):m[S][y]=a?d(r,0):d(0,r)}return new n({data:m,size:[p,h],datatype:f})}})),Ls=be("algorithm13",["typed"],(e=>{var{typed:t}=e;return function(e,r,i){var a,o=e._data,s=e._size,u=e._datatype,c=r._data,l=r._size,f=r._datatype,p=[];if(s.length!==l.length)throw new Bn(s.length,l.length);for(var h=0;h<s.length;h++){if(s[h]!==l[h])throw new RangeError("Dimension mismatch. Matrix A ("+s+") must match Matrix B ("+l+")");p[h]=s[h]}var d=i;"string"==typeof u&&u===f&&(a=u,d=t.find(i,[a,a]));var m=p.length>0?n(d,0,p,p[0],o,c):[];return e.createDenseMatrix({data:m,size:p,datatype:a})};function n(e,t,r,i,a,o){var s=[];if(t===r.length-1)for(var u=0;u<i;u++)s[u]=e(a[u],o[u]);else for(var c=0;c<i;c++)s[c]=n(e,t+1,r,r[t+1],a[c],o[c]);return s}})),js=be("algorithm14",["typed"],(e=>{var{typed:t}=e;return function(e,r,i,a){var o,s=e._data,u=e._size,c=e._datatype,l=i;"string"==typeof c&&(o=c,r=t.convert(r,o),l=t.find(i,[o,o]));var f=u.length>0?n(l,0,u,u[0],s,r,a):[];return e.createDenseMatrix({data:f,size:re(u),datatype:o})};function n(e,t,r,i,a,o,s){var u=[];if(t===r.length-1)for(var c=0;c<i;c++)u[c]=s?e(o,a[c]):e(a[c],o);else for(var l=0;l<i;l++)u[l]=n(e,t+1,r,r[t+1],a[l],o,s);return u}})),Us=be("mod",["typed","matrix","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,DenseMatrix:i}=e,a=Fs({typed:t,equalScalar:r}),o=Rs({typed:t}),s=Bs({typed:t,equalScalar:r}),u=zs({typed:t,equalScalar:r}),c=Ps({typed:t,DenseMatrix:i}),l=Ls({typed:t}),f=js({typed:t});return t("mod",{"number, number":Yr,"BigNumber, BigNumber":function(e,t){if(t.isNeg())throw new Error("Cannot calculate mod for a negative divisor");return t.isZero()?e:e.mod(t)},"Fraction, Fraction":function(e,t){if(t.compare(0)<0)throw new Error("Cannot calculate mod for a negative divisor");return e.compare(0)>=0?e.mod(t):e.mod(t).add(t).mod(t)},"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,this,!1)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return u(e,t,this,!1)},"DenseMatrix, any":function(e,t){return f(e,t,this,!1)},"any, SparseMatrix":function(e,t){return c(t,e,this,!0)},"any, DenseMatrix":function(e,t){return f(t,e,this,!0)},"Array, any":function(e,t){return f(n(e),t,this,!1).valueOf()},"any, Array":function(e,t){return f(n(t),e,this,!0).valueOf()}})})),qs=be("algorithm01",["typed"],(e=>{var{typed:t}=e;return function(e,n,r,i){var a=e._data,o=e._size,s=e._datatype,u=n._values,c=n._index,l=n._ptr,f=n._size,p=n._datatype;if(o.length!==f.length)throw new Bn(o.length,f.length);if(o[0]!==f[0]||o[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+o+") must match Matrix B ("+f+")");if(!u)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var h,d,m=o[0],g=o[1],v="string"==typeof s&&s===p?s:void 0,y=v?t.find(r,[v,v]):r,b=[];for(h=0;h<m;h++)b[h]=[];var x=[],w=[];for(d=0;d<g;d++){for(var E=d+1,C=l[d],S=l[d+1],N=C;N<S;N++)x[h=c[N]]=i?y(u[N],a[h][d]):y(a[h][d],u[N]),w[h]=E;for(h=0;h<m;h++)w[h]===E?b[h][d]=x[h]:b[h][d]=a[h][d]}return e.createDenseMatrix({data:b,size:[m,g],datatype:v})}})),Ws=be("algorithm06",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return function(e,r,i){var a=e._values,o=e._size,s=e._datatype,u=r._values,c=r._size,l=r._datatype;if(o.length!==c.length)throw new Bn(o.length,c.length);if(o[0]!==c[0]||o[1]!==c[1])throw new RangeError("Dimension mismatch. Matrix A ("+o+") must match Matrix B ("+c+")");var f,p=o[0],h=o[1],d=n,m=0,g=i;"string"==typeof s&&s===l&&(f=s,d=t.find(n,[f,f]),m=t.convert(0,f),g=t.find(i,[f,f]));for(var v=a&&u?[]:void 0,y=[],b=[],x=v?[]:void 0,w=[],E=[],C=0;C<h;C++){b[C]=y.length;var S=C+1;if(Or(e,C,w,x,E,S,y,g),Or(r,C,w,x,E,S,y,g),x)for(var N=b[C];N<y.length;){var A=y[N];if(E[A]===S){var k=x[A];d(k,m)?y.splice(N,1):(v.push(k),N++)}else y.splice(N,1)}else for(var D=b[C];D<y.length;)E[y[D]]!==S?y.splice(D,1):D++}return b[h]=y.length,e.createSparseMatrix({values:v,index:y,ptr:b,size:[p,h],datatype:f})}})),Vs="nthRoot",$s=be(Vs,["typed","matrix","equalScalar","BigNumber"],(e=>{var{typed:t,matrix:n,equalScalar:r,BigNumber:i}=e,a=qs({typed:t}),o=Fs({typed:t,equalScalar:r}),s=Ws({typed:t,equalScalar:r}),u=zs({typed:t,equalScalar:r}),c=Ls({typed:t}),l=js({typed:t}),f="Complex number not supported in function nthRoot. Use nthRoots instead.";return t(Vs,{number:function(e){return Jr(e,2)},"number, number":Jr,BigNumber:function(e){return p(e,new i(2))},Complex:function(e){throw new Error(f)},"Complex, number":function(e,t){throw new Error(f)},"BigNumber, BigNumber":p,"Array | Matrix":function(e){return this(e,2)},"SparseMatrix, SparseMatrix":function(e,t){if(1===t.density())return s(e,t,this);throw new Error("Root must be non-zero")},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){if(1===t.density())return a(e,t,this,!1);throw new Error("Root must be non-zero")},"DenseMatrix, DenseMatrix":function(e,t){return c(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, number | BigNumber":function(e,t){return u(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return l(e,t,this,!1)},"number | BigNumber, SparseMatrix":function(e,t){if(1===t.density())return u(t,e,this,!0);throw new Error("Root must be non-zero")},"number | BigNumber, DenseMatrix":function(e,t){return l(t,e,this,!0)},"Array, number | BigNumber":function(e,t){return this(n(e),t).valueOf()},"number | BigNumber, Array":function(e,t){return this(e,n(t)).valueOf()}});function p(e,t){var n=i.precision,r=i.clone({precision:n+2}),a=new i(0),o=new r(1),s=t.isNegative();if(s&&(t=t.neg()),t.isZero())throw new Error("Root must be non-zero");if(e.isNegative()&&!t.abs().mod(2).equals(1))throw new Error("Root must be odd when a is negative.");if(e.isZero())return s?new r(1/0):0;if(!e.isFinite())return s?a:e;var u=e.abs().pow(o.div(t));return u=e.isNeg()?u.neg():u,new i((s?o.div(u):u).toPrecision(n))}}));function Hs(){throw new Error('No "bignumber" implementation available')}function Gs(){throw new Error('No "fraction" implementation available')}function Ks(){throw new Error('No "matrix" implementation available')}var Xs=be("numeric",["number","?bignumber","?fraction"],(e=>{var{number:t,bignumber:n,fraction:r}=e,i={string:!0,number:!0,BigNumber:!0,Fraction:!0},a={number:e=>t(e),BigNumber:n?e=>n(e):Hs,Fraction:r?e=>r(e):Gs};return function(e,t){var n=ne(e);if(!(n in i))throw new TypeError("Cannot convert "+e+' of type "'+n+'"; valid input types are '+Object.keys(i).join(", "));if(!(t in a))throw new TypeError("Cannot convert "+e+' to type "'+t+'"; valid output types are '+Object.keys(a).join(", "));return t===n?e:a[t](e)}})),Ys=be("or",["typed","matrix","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,DenseMatrix:i}=e,a=Rs({typed:t}),o=Bs({typed:t,equalScalar:r}),s=Ps({typed:t,DenseMatrix:i}),u=Ls({typed:t}),c=js({typed:t});return t("or",{"number, number":ho,"Complex, Complex":function(e,t){return 0!==e.re||0!==e.im||0!==t.re||0!==t.im},"BigNumber, BigNumber":function(e,t){return!e.isZero()&&!e.isNaN()||!t.isZero()&&!t.isNaN()},"Unit, Unit":function(e,t){return this(e.value||0,t.value||0)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return a(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return s(e,t,this,!1)},"DenseMatrix, any":function(e,t){return c(e,t,this,!1)},"any, SparseMatrix":function(e,t){return s(t,e,this,!0)},"any, DenseMatrix":function(e,t){return c(t,e,this,!0)},"Array, any":function(e,t){return c(n(e),t,this,!1).valueOf()},"any, Array":function(e,t){return c(n(t),e,this,!0).valueOf()}})}));function Js(e,t,n){var r;return-1!==String(e).indexOf("Unexpected type")?(r=arguments.length>2?" (type: "+ne(n)+", value: "+JSON.stringify(n)+")":" (type: "+e.data.actual+")",new TypeError("Cannot calculate "+t+", unexpected type of argument"+r)):-1!==String(e).indexOf("complex numbers")?(r=arguments.length>2?" (type: "+ne(n)+", value: "+JSON.stringify(n)+")":"",new TypeError("Cannot calculate "+t+", no ordering relation is defined for complex numbers"+r)):e}var Zs="prod",Qs=be(Zs,["typed","config","multiplyScalar","numeric"],(e=>{var{typed:t,config:n,multiplyScalar:r,numeric:i}=e;return t(Zs,{"Array | Matrix":a,"Array | Matrix, number | BigNumber":function(e,t){throw new Error("prod(A, dim) is not yet supported")},"...":function(e){return a(e)}});function a(e){var t;if(Dr(e,(function(e){try{t=void 0===t?e:r(t,e)}catch(t){throw Js(t,"prod",e)}})),"string"==typeof t&&(t=i(t,n.number)),void 0===t)throw new Error("Cannot calculate prod of an empty array");return t}})),eu="reshape",tu=be(eu,["typed","isInteger","matrix"],(e=>{var{typed:t,isInteger:n}=e;return t(eu,{"Matrix, Array":function(e,t){return e.reshape(t)},"Array, Array":function(e,t){return t.forEach((function(e){if(!n(e))throw new TypeError("Invalid size for dimension: "+e)})),Vn(e,t)}})})),nu="size",ru=be(nu,["typed","config","?matrix"],(e=>{var{typed:t,config:n,matrix:r}=e;return t(nu,{Matrix:function(e){return e.create(e.size())},Array:Pn,string:function(e){return"Array"===n.matrix?[e.length]:r([e.length])},"number | Complex | BigNumber | Unit | boolean | null":function(e){return"Array"===n.matrix?[]:r?r([]):Ks()}})})),iu=be("algorithm07",["typed","DenseMatrix"],(e=>{var{typed:t,DenseMatrix:n}=e;return function(e,i,a){var o=e._size,s=e._datatype,u=i._size,c=i._datatype;if(o.length!==u.length)throw new Bn(o.length,u.length);if(o[0]!==u[0]||o[1]!==u[1])throw new RangeError("Dimension mismatch. Matrix A ("+o+") must match Matrix B ("+u+")");var l,f,p,h=o[0],d=o[1],m=0,g=a;"string"==typeof s&&s===c&&(l=s,m=t.convert(0,l),g=t.find(a,[l,l]));var v=[];for(f=0;f<h;f++)v[f]=[];var y=[],b=[],x=[],w=[];for(p=0;p<d;p++){var E=p+1;for(r(e,p,x,y,E),r(i,p,w,b,E),f=0;f<h;f++){var C=x[f]===E?y[f]:m,S=w[f]===E?b[f]:m;v[f][p]=g(C,S)}}return new n({data:v,size:[h,d],datatype:l})};function r(e,t,n,r,i){for(var a=e._values,o=e._index,s=e._ptr,u=s[t],c=s[t+1];u<c;u++){var l=o[u];n[l]=i,r[l]=a[u]}}})),au="smaller",ou=be(au,["typed","config","matrix","DenseMatrix"],(e=>{var{typed:t,config:n,matrix:r,DenseMatrix:i}=e,a=Rs({typed:t}),o=iu({typed:t,DenseMatrix:i}),s=Ps({typed:t,DenseMatrix:i}),u=Ls({typed:t}),c=js({typed:t});return t(au,{"boolean, boolean":function(e,t){return e<t},"number, number":function(e,t){return e<t&&!Le(e,t,n.epsilon)},"BigNumber, BigNumber":function(e,t){return e.lt(t)&&!Ea(e,t,n.epsilon)},"Fraction, Fraction":function(e,t){return-1===e.compare(t)},"Complex, Complex":function(e,t){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return this(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return a(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,this)},"Array, Array":function(e,t){return this(r(e),r(t)).valueOf()},"Array, Matrix":function(e,t){return this(r(e),t)},"Matrix, Array":function(e,t){return this(e,r(t))},"SparseMatrix, any":function(e,t){return s(e,t,this,!1)},"DenseMatrix, any":function(e,t){return c(e,t,this,!1)},"any, SparseMatrix":function(e,t){return s(t,e,this,!0)},"any, DenseMatrix":function(e,t){return c(t,e,this,!0)},"Array, any":function(e,t){return c(r(e),t,this,!1).valueOf()},"any, Array":function(e,t){return c(r(t),e,this,!0).valueOf()}})})),su="squeeze",uu=be(su,["typed","matrix"],(e=>{var{typed:t,matrix:n}=e;return t(su,{Array:function(e){return Gn(re(e))},Matrix:function(e){var t=Gn(e.toArray());return Array.isArray(t)?n(t):t},any:function(e){return re(e)}})})),cu="subset",lu=be(cu,["typed","matrix"],(e=>{var{typed:t,matrix:n}=e;return t(cu,{"Array, Index":function(e,t){var r=n(e).subset(t);return t.isScalar()?r:r.valueOf()},"Matrix, Index":function(e,t){return e.subset(t)},"Object, Index":hu,"string, Index":fu,"Array, Index, any":function(e,t,r){return n(re(e)).subset(t,r,void 0).valueOf()},"Array, Index, any, any":function(e,t,r,i){return n(re(e)).subset(t,r,i).valueOf()},"Matrix, Index, any":function(e,t,n){return e.clone().subset(t,n)},"Matrix, Index, any, any":function(e,t,n,r){return e.clone().subset(t,n,r)},"string, Index, string":pu,"string, Index, string, string":pu,"Object, Index, any":du})}));function fu(e,t){if(!M(t))throw new TypeError("Index expected");if(1!==t.size().length)throw new Bn(t.size().length,1);var n=e.length;Un(t.min()[0],n),Un(t.max()[0],n);var r=t.dimension(0),i="";return r.forEach((function(t){i+=e.charAt(t)})),i}function pu(e,t,n,r){if(!t||!0!==t.isIndex)throw new TypeError("Index expected");if(1!==t.size().length)throw new Bn(t.size().length,1);if(void 0!==r){if("string"!=typeof r||1!==r.length)throw new TypeError("Single character expected as defaultValue")}else r=" ";var i=t.dimension(0);if(i.size()[0]!==n.length)throw new Bn(i.size()[0],n.length);var a=e.length;Un(t.min()[0]),Un(t.max()[0]);for(var o=[],s=0;s<a;s++)o[s]=e.charAt(s);if(i.forEach((function(e,t){o[e]=n.charAt(t[0])})),o.length>a)for(var u=a-1,c=o.length;u<c;u++)o[u]||(o[u]=r);return o.join("")}function hu(e,t){if(1!==t.size().length)throw new Bn(t.size(),1);var n=t.dimension(0);if("string"!=typeof n)throw new TypeError("String expected as index to retrieve an object property");return lr(e,n)}function du(e,t,n){if(1!==t.size().length)throw new Bn(t.size(),1);var r=t.dimension(0);if("string"!=typeof r)throw new TypeError("String expected as index to retrieve an object property");var i=re(e);return fr(i,r,n),i}var mu=be("algorithm10",["typed","DenseMatrix"],(e=>{var{typed:t,DenseMatrix:n}=e;return function(e,r,i,a){var o=e._values,s=e._index,u=e._ptr,c=e._size,l=e._datatype;if(!o)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var f,p=c[0],h=c[1],d=i;"string"==typeof l&&(f=l,r=t.convert(r,f),d=t.find(i,[f,f]));for(var m=[],g=[],v=[],y=0;y<h;y++){for(var b=y+1,x=u[y],w=u[y+1],E=x;E<w;E++){var C=s[E];g[C]=o[E],v[C]=b}for(var S=0;S<p;S++)0===y&&(m[S]=[]),v[S]===b?m[S][y]=a?d(r,g[S]):d(g[S],r):m[S][y]=r}return new n({data:m,size:[p,h],datatype:f})}})),gu="subtract",vu=be(gu,["typed","matrix","equalScalar","addScalar","unaryMinus","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,addScalar:i,unaryMinus:a,DenseMatrix:o}=e,s=qs({typed:t}),u=Rs({typed:t}),c=Bs({typed:t,equalScalar:r}),l=mu({typed:t,DenseMatrix:o}),f=Ls({typed:t}),p=js({typed:t});return t(gu,{"number, number":function(e,t){return e-t},"Complex, Complex":function(e,t){return e.sub(t)},"BigNumber, BigNumber":function(e,t){return e.minus(t)},"Fraction, Fraction":function(e,t){return e.sub(t)},"Unit, Unit":function(e,t){if(null===e.value)throw new Error("Parameter x contains a unit with undefined value");if(null===t.value)throw new Error("Parameter y contains a unit with undefined value");if(!e.equalBase(t))throw new Error("Units do not match");var n=e.clone();return n.value=this(n.value,t.value),n.fixPrefix=!1,n},"SparseMatrix, SparseMatrix":function(e,t){return yu(e,t),c(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return yu(e,t),u(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return yu(e,t),s(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return yu(e,t),f(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return l(e,a(t),i)},"DenseMatrix, any":function(e,t){return p(e,t,this)},"any, SparseMatrix":function(e,t){return l(t,e,this,!0)},"any, DenseMatrix":function(e,t){return p(t,e,this,!0)},"Array, any":function(e,t){return p(n(e),t,this,!1).valueOf()},"any, Array":function(e,t){return p(n(t),e,this,!0).valueOf()}})}));function yu(e,t){var n=e.size(),r=t.size();if(n.length!==r.length)throw new Bn(n.length,r.length)}var bu=be("to",["typed","matrix"],(e=>{var{typed:t,matrix:n}=e,r=Ls({typed:t}),i=js({typed:t});return t("to",{"Unit, Unit | string":function(e,t){return e.to(t)},"Matrix, Matrix":function(e,t){return r(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"Matrix, any":function(e,t){return i(e,t,this,!1)},"any, Matrix":function(e,t){return i(t,e,this,!0)},"Array, any":function(e,t){return i(n(e),t,this,!1).valueOf()},"any, Array":function(e,t){return i(n(t),e,this,!0).valueOf()}})})),xu=be("transpose",["typed","matrix"],(e=>{var{typed:t,matrix:n}=e;return t("transpose",{Array:function(e){return this(n(e)).valueOf()},Matrix:function(e){var t,n=e.size();switch(n.length){case 1:t=e.clone();break;case 2:var r=n[0],i=n[1];if(0===i)throw new RangeError("Cannot transpose a 2D matrix with no columns (size: "+Tn(n)+")");switch(e.storage()){case"dense":t=function(e,t,n){for(var r,i=e._data,a=[],o=0;o<n;o++){r=a[o]=[];for(var s=0;s<t;s++)r[s]=re(i[s][o])}return e.createDenseMatrix({data:a,size:[n,t],datatype:e._datatype})}(e,r,i);break;case"sparse":t=function(e,t,n){for(var r,i,a,o=e._values,s=e._index,u=e._ptr,c=o?[]:void 0,l=[],f=[],p=[],h=0;h<t;h++)p[h]=0;for(r=0,i=s.length;r<i;r++)p[s[r]]++;for(var d=0,m=0;m<t;m++)f.push(d),d+=p[m],p[m]=f[m];for(f.push(d),a=0;a<n;a++)for(var g=u[a],v=u[a+1],y=g;y<v;y++){var b=p[s[y]]++;l[b]=a,o&&(c[b]=re(o[y]))}return e.createSparseMatrix({values:c,index:l,ptr:f,size:[n,t],datatype:e._datatype})}(e,r,i)}break;default:throw new RangeError("Matrix must be a vector or two dimensional (size: "+Tn(this._size)+")")}return t},any:function(e){return re(e)}})})),wu="xgcd",Eu=be(wu,["typed","config","matrix","BigNumber"],(e=>{var{typed:t,config:n,matrix:r,BigNumber:i}=e;return t(wu,{"number, number":function(e,t){var i=ei(e,t);return"Array"===n.matrix?i:r(i)},"BigNumber, BigNumber":function(e,t){var a,o,s,u,c=new i(0),l=new i(1),f=c,p=l,h=l,d=c;if(!e.isInt()||!t.isInt())throw new Error("Parameters in function xgcd must be integer numbers");for(;!t.isZero();)o=e.div(t).floor(),s=e.mod(t),a=f,f=p.minus(o.times(f)),p=a,a=h,h=d.minus(o.times(h)),d=a,e=t,t=s;return u=e.lt(c)?[e.neg(),p.neg(),d.neg()]:[e,e.isZero()?0:p,d],"Array"===n.matrix?u:r(u)}})})),Cu="zeros",Su=be(Cu,["typed","config","matrix","BigNumber"],(e=>{var{typed:t,config:n,matrix:r,BigNumber:i}=e;return t(Cu,{"":function(){return"Array"===n.matrix?a([]):a([],"default")},"...number | BigNumber | string":function(e){if("string"==typeof e[e.length-1]){var t=e.pop();return a(e,t)}return"Array"===n.matrix?a(e):a(e,"default")},Array:a,Matrix:function(e){var t=e.storage();return a(e.valueOf(),t)},"Array | Matrix, string":function(e,t){return a(e.valueOf(),t)}});function a(e,t){var n=function(e){var t=!1;return e.forEach((function(e,n,r){b(e)&&(t=!0,r[n]=e.toNumber())})),t}(e),a=n?new i(0):0;if(function(e){e.forEach((function(e){if("number"!=typeof e||!Se(e)||e<0)throw new Error("Parameters in function zeros must be positive integers")}))}(e),t){var o=r(t);return e.length>0?o.resize(e,a):o}var s=[];return e.length>0?qn(s,e,a):s}})),Nu=be("and",["typed","matrix","equalScalar","zeros","not"],(e=>{var{typed:t,matrix:n,equalScalar:r,zeros:i,not:a}=e,o=Fs({typed:t,equalScalar:r}),s=Ws({typed:t,equalScalar:r}),u=zs({typed:t,equalScalar:r}),c=Ls({typed:t}),l=js({typed:t});return t("and",{"number, number":go,"Complex, Complex":function(e,t){return!(0===e.re&&0===e.im||0===t.re&&0===t.im)},"BigNumber, BigNumber":function(e,t){return!(e.isZero()||t.isZero()||e.isNaN()||t.isNaN())},"Unit, Unit":function(e,t){return this(e.value||0,t.value||0)},"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,this,!1)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return c(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return a(t)?i(e.size(),e.storage()):u(e,t,this,!1)},"DenseMatrix, any":function(e,t){return a(t)?i(e.size(),e.storage()):l(e,t,this,!1)},"any, SparseMatrix":function(e,t){return a(e)?i(e.size(),e.storage()):u(t,e,this,!0)},"any, DenseMatrix":function(e,t){return a(e)?i(e.size(),e.storage()):l(t,e,this,!0)},"Array, any":function(e,t){return this(n(e),t).valueOf()},"any, Array":function(e,t){return this(e,n(t)).valueOf()}})})),Au="bitAnd",ku=be(Au,["typed","matrix","equalScalar"],(e=>{var{typed:t,matrix:n,equalScalar:r}=e,i=Fs({typed:t,equalScalar:r}),a=Ws({typed:t,equalScalar:r}),o=zs({typed:t,equalScalar:r}),s=Ls({typed:t}),u=js({typed:t});return t(Au,{"number, number":Ki,"BigNumber, BigNumber":Li,"SparseMatrix, SparseMatrix":function(e,t){return a(e,t,this,!1)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return s(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return o(e,t,this,!1)},"DenseMatrix, any":function(e,t){return u(e,t,this,!1)},"any, SparseMatrix":function(e,t){return o(t,e,this,!0)},"any, DenseMatrix":function(e,t){return u(t,e,this,!0)},"Array, any":function(e,t){return u(n(e),t,this,!1).valueOf()},"any, Array":function(e,t){return u(n(t),e,this,!0).valueOf()}})})),Du="bitXor",_u=be(Du,["typed","matrix","DenseMatrix"],(e=>{var{typed:t,matrix:n,DenseMatrix:r}=e,i=Rs({typed:t}),a=iu({typed:t,DenseMatrix:r}),o=Ps({typed:t,DenseMatrix:r}),s=Ls({typed:t}),u=js({typed:t});return t(Du,{"number, number":Ji,"BigNumber, BigNumber":Vi,"SparseMatrix, SparseMatrix":function(e,t){return a(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return s(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return o(e,t,this,!1)},"DenseMatrix, any":function(e,t){return u(e,t,this,!1)},"any, SparseMatrix":function(e,t){return o(t,e,this,!0)},"any, DenseMatrix":function(e,t){return u(t,e,this,!0)},"Array, any":function(e,t){return u(n(e),t,this,!1).valueOf()},"any, Array":function(e,t){return u(n(t),e,this,!0).valueOf()}})})),Mu="cbrt",Tu=be(Mu,["config","typed","isNegative","unaryMinus","matrix","Complex","BigNumber","Fraction"],(e=>{var{config:t,typed:n,isNegative:r,unaryMinus:i,matrix:a,Complex:o,BigNumber:s,Fraction:u}=e;return n(Mu,{number:jr,Complex:c,"Complex, boolean":c,BigNumber:function(e){return e.cbrt()},Unit:function(e){if(e.value&&x(e.value)){var t=e.clone();return t.value=1,(t=t.pow(1/3)).value=c(e.value),t}var n,a=r(e.value);a&&(e.value=i(e.value)),n=b(e.value)?new s(1).div(3):w(e.value)?new u(1,3):1/3;var o=e.pow(n);return a&&(o.value=i(o.value)),o},"Array | Matrix":function(e){return _r(e,this,!0)}});function c(e,n){var r=e.arg()/3,i=e.abs(),s=new o(jr(i),0).mul(new o(0,r).exp());if(n){var u=[s,new o(jr(i),0).mul(new o(0,r+2*Math.PI/3).exp()),new o(jr(i),0).mul(new o(0,r-2*Math.PI/3).exp())];return"Array"===t.matrix?u:a(u)}return s}})),Ou="compare",Iu=be(Ou,["typed","config","matrix","equalScalar","BigNumber","Fraction","DenseMatrix"],(e=>{var{typed:t,config:n,equalScalar:r,matrix:i,BigNumber:a,Fraction:o,DenseMatrix:s}=e,u=Rs({typed:t}),c=Bs({typed:t,equalScalar:r}),l=Ps({typed:t,DenseMatrix:s}),f=Ls({typed:t}),p=js({typed:t});return t(Ou,{"boolean, boolean":function(e,t){return e===t?0:e>t?1:-1},"number, number":function(e,t){return Le(e,t,n.epsilon)?0:e>t?1:-1},"BigNumber, BigNumber":function(e,t){return Ea(e,t,n.epsilon)?new a(0):new a(e.cmp(t))},"Fraction, Fraction":function(e,t){return new o(e.compare(t))},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return this(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return c(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return u(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return u(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return f(e,t,this)},"Array, Array":function(e,t){return this(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return this(i(e),t)},"Matrix, Array":function(e,t){return this(e,i(t))},"SparseMatrix, any":function(e,t){return l(e,t,this,!1)},"DenseMatrix, any":function(e,t){return p(e,t,this,!1)},"any, SparseMatrix":function(e,t){return l(t,e,this,!0)},"any, DenseMatrix":function(e,t){return p(t,e,this,!0)},"Array, any":function(e,t){return p(i(e),t,this,!1).valueOf()},"any, Array":function(e,t){return p(i(t),e,this,!0).valueOf()}})})),Fu="compareText",Ru=be(Fu,["typed","matrix"],(e=>{var{typed:t,matrix:n}=e,r=Ls({typed:t}),i=js({typed:t});return t(Fu,{"any, any":Rn,"DenseMatrix, DenseMatrix":function(e,t){return r(e,t,Rn)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"DenseMatrix, any":function(e,t){return i(e,t,Rn,!1)},"any, DenseMatrix":function(e,t){return i(t,e,Rn,!0)},"Array, any":function(e,t){return i(n(e),t,Rn,!1).valueOf()},"any, Array":function(e,t){return i(n(t),e,Rn,!0).valueOf()}})})),Bu="concat",zu=be(Bu,["typed","matrix","isInteger"],(e=>{var{typed:t,matrix:n,isInteger:r}=e;return t(Bu,{"...Array | Matrix | number | BigNumber":function(e){var t,i,a=e.length,o=-1,s=!1,u=[];for(t=0;t<a;t++){var c=e[t];if(N(c)&&(s=!0),y(c)||b(c)){if(t!==a-1)throw new Error("Dimension must be specified as last argument");if(i=o,o=c.valueOf(),!r(o))throw new TypeError("Integer number expected for dimension");if(o<0||t>0&&o>i)throw new zn(o,i+1)}else{var l=re(c).valueOf(),f=Pn(l);if(u[t]=l,i=o,o=f.length-1,t>0&&o!==i)throw new Bn(i+1,o+1)}}if(0===u.length)throw new SyntaxError("At least one matrix expected");for(var p=u.shift();u.length;)p=Pu(p,u.shift(),o,0);return s?n(p):p},"...string":function(e){return e.join("")}})}));function Pu(e,t,n,r){if(r<n){if(e.length!==t.length)throw new Bn(e.length,t.length);for(var i=[],a=0;a<e.length;a++)i[a]=Pu(e[a],t[a],n,r+1);return i}return e.concat(t)}var Lu="count",ju=be(Lu,["typed","size","prod"],(e=>{var{typed:t,size:n,prod:r}=e;return t(Lu,{string:function(e){return e.length},"Matrix | Array":function(e){return r(n(e))}})})),Uu="ctranspose",qu=be(Uu,["typed","transpose","conj"],(e=>{var{typed:t,transpose:n,conj:r}=e;return t(Uu,{any:function(e){return r(n(e))}})})),Wu="diag",Vu=be(Wu,["typed","matrix","DenseMatrix","SparseMatrix"],(e=>{var{typed:t,matrix:n,DenseMatrix:r,SparseMatrix:i}=e;return t(Wu,{Array:function(e){return a(e,0,Pn(e),null)},"Array, number":function(e,t){return a(e,t,Pn(e),null)},"Array, BigNumber":function(e,t){return a(e,t.toNumber(),Pn(e),null)},"Array, string":function(e,t){return a(e,0,Pn(e),t)},"Array, number, string":function(e,t,n){return a(e,t,Pn(e),n)},"Array, BigNumber, string":function(e,t,n){return a(e,t.toNumber(),Pn(e),n)},Matrix:function(e){return a(e,0,e.size(),e.storage())},"Matrix, number":function(e,t){return a(e,t,e.size(),e.storage())},"Matrix, BigNumber":function(e,t){return a(e,t.toNumber(),e.size(),e.storage())},"Matrix, string":function(e,t){return a(e,0,e.size(),t)},"Matrix, number, string":function(e,t,n){return a(e,t,e.size(),n)},"Matrix, BigNumber, string":function(e,t,n){return a(e,t.toNumber(),e.size(),n)}});function a(e,t,a,o){if(!Se(t))throw new TypeError("Second parameter in function diag must be an integer");var s=t>0?t:0,u=t<0?-t:0;switch(a.length){case 1:return function(e,t,n,a,o,s){var u=[a+o,a+s];if(n&&"sparse"!==n&&"dense"!==n)throw new TypeError("Unknown matrix type ".concat(n,'"'));var c="sparse"===n?i.diagonal(u,e,t):r.diagonal(u,e,t);return null!==n?c:c.valueOf()}(e,t,o,a[0],u,s);case 2:return function(e,t,r,i,a,o){if(N(e)){var s=e.diagonal(t);return null!==r?r!==s.storage()?n(s,r):s:s.valueOf()}for(var u=Math.min(i[0]-a,i[1]-o),c=[],l=0;l<u;l++)c[l]=e[l+a][l+o];return null!==r?n(c):c}(e,t,o,a,u,s)}throw new RangeError("Matrix for function diag must be 2 dimensional")}})),$u="divideScalar",Hu=be($u,["typed","numeric"],(e=>{var{typed:t,numeric:n}=e;return t($u,{"number, number":function(e,t){return e/t},"Complex, Complex":function(e,t){return e.div(t)},"BigNumber, BigNumber":function(e,t){return e.div(t)},"Fraction, Fraction":function(e,t){return e.div(t)},"Unit, number | Fraction | BigNumber":function(e,t){var r=e.clone(),i=n(1,ne(t));return r.value=this(null===r.value?r._normalize(i):r.value,t),r},"number | Fraction | BigNumber, Unit":function(e,t){var r=t.clone();r=r.pow(-1);var i=n(1,ne(e));return r.value=this(e,null===t.value?t._normalize(i):t.value),r},"Unit, Unit":function(e,t){return e.divide(t)}})})),Gu="dotDivide",Ku=be(Gu,["typed","matrix","equalScalar","divideScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,divideScalar:i,DenseMatrix:a}=e,o=Fs({typed:t,equalScalar:r}),s=Rs({typed:t}),u=iu({typed:t,DenseMatrix:a}),c=zs({typed:t,equalScalar:r}),l=Ps({typed:t,DenseMatrix:a}),f=Ls({typed:t}),p=js({typed:t});return t(Gu,{"any, any":i,"SparseMatrix, SparseMatrix":function(e,t){return u(e,t,i,!1)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,i,!0)},"DenseMatrix, SparseMatrix":function(e,t){return s(e,t,i,!1)},"DenseMatrix, DenseMatrix":function(e,t){return f(e,t,i)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return c(e,t,i,!1)},"DenseMatrix, any":function(e,t){return p(e,t,i,!1)},"any, SparseMatrix":function(e,t){return l(t,e,i,!0)},"any, DenseMatrix":function(e,t){return p(t,e,i,!0)},"Array, any":function(e,t){return p(n(e),t,i,!1).valueOf()},"any, Array":function(e,t){return p(n(t),e,i,!0).valueOf()}})})),Xu="equal",Yu=be(Xu,["typed","matrix","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,DenseMatrix:i}=e,a=Rs({typed:t}),o=iu({typed:t,DenseMatrix:i}),s=Ps({typed:t,DenseMatrix:i}),u=Ls({typed:t}),c=js({typed:t});return t(Xu,{"any, any":function(e,t){return null===e?null===t:null===t?null===e:void 0===e?void 0===t:void 0===t?void 0===e:r(e,t)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,r)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,r,!0)},"DenseMatrix, SparseMatrix":function(e,t){return a(e,t,r,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,r)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return s(e,t,r,!1)},"DenseMatrix, any":function(e,t){return c(e,t,r,!1)},"any, SparseMatrix":function(e,t){return s(t,e,r,!0)},"any, DenseMatrix":function(e,t){return c(t,e,r,!0)},"Array, any":function(e,t){return c(n(e),t,r,!1).valueOf()},"any, Array":function(e,t){return c(n(t),e,r,!0).valueOf()}})})),Ju=(be(Xu,["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return t(Xu,{"any, any":function(e,t){return null===e?null===t:null===t?null===e:void 0===e?void 0===t:void 0===t?void 0===e:n(e,t)}})})),"flatten"),Zu=be(Ju,["typed","matrix"],(e=>{var{typed:t,matrix:n}=e;return t(Ju,{Array:function(e){return Jn(re(e))},Matrix:function(e){var t=Jn(re(e.toArray()));return n(t)}})})),Qu=be("algorithm04",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return function(e,r,i){var a=e._values,o=e._index,s=e._ptr,u=e._size,c=e._datatype,l=r._values,f=r._index,p=r._ptr,h=r._size,d=r._datatype;if(u.length!==h.length)throw new Bn(u.length,h.length);if(u[0]!==h[0]||u[1]!==h[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+h+")");var m,g=u[0],v=u[1],y=n,b=0,x=i;"string"==typeof c&&c===d&&(m=c,y=t.find(n,[m,m]),b=t.convert(0,m),x=t.find(i,[m,m]));var w,E,C,S,N,A=a&&l?[]:void 0,k=[],D=[],_=a&&l?[]:void 0,M=a&&l?[]:void 0,T=[],O=[];for(E=0;E<v;E++){D[E]=k.length;var I=E+1;for(S=s[E],N=s[E+1],C=S;C<N;C++)w=o[C],k.push(w),T[w]=I,_&&(_[w]=a[C]);for(S=p[E],N=p[E+1],C=S;C<N;C++)if(T[w=f[C]]===I){if(_){var F=x(_[w],l[C]);y(F,b)?T[w]=null:_[w]=F}}else k.push(w),O[w]=I,M&&(M[w]=l[C]);if(_&&M)for(C=D[E];C<k.length;)T[w=k[C]]===I?(A[C]=_[w],C++):O[w]===I?(A[C]=M[w],C++):k.splice(C,1)}return D[v]=k.length,e.createSparseMatrix({values:A,index:k,ptr:D,size:[g,v],datatype:m})}})),ec=be("gcd",["typed","matrix","equalScalar","BigNumber","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,BigNumber:i,DenseMatrix:a}=e,o=qs({typed:t}),s=Qu({typed:t,equalScalar:r}),u=mu({typed:t,DenseMatrix:a}),c=Ls({typed:t}),l=js({typed:t});return t("gcd",{"number, number":$r,"BigNumber, BigNumber":function(e,t){if(!e.isInt()||!t.isInt())throw new Error("Parameters in function gcd must be integer numbers");for(var n=new i(0);!t.isZero();){var r=e.mod(t);e=t,t=r}return e.lt(n)?e.neg():e},"Fraction, Fraction":function(e,t){return e.gcd(t)},"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return c(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, number | BigNumber":function(e,t){return u(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return l(e,t,this,!1)},"number | BigNumber, SparseMatrix":function(e,t){return u(t,e,this,!0)},"number | BigNumber, DenseMatrix":function(e,t){return l(t,e,this,!0)},"Array, number | BigNumber":function(e,t){return l(n(e),t,this,!1).valueOf()},"number | BigNumber, Array":function(e,t){return l(n(t),e,this,!0).valueOf()},"Array | Matrix | number | BigNumber, Array | Matrix | number | BigNumber, ...Array | Matrix | number | BigNumber":function(e,t,n){for(var r=this(e,t),i=0;i<n.length;i++)r=this(r,n[i]);return r}})})),tc="hasNumericValue",nc=be(tc,["typed","isNumeric"],(e=>{var{typed:t,isNumeric:n}=e;return t(tc,{string:function(e){return e.trim().length>0&&!isNaN(Number(e))},any:function(e){return n(e)}})})),rc="hypot",ic=be(rc,["typed","abs","addScalar","divideScalar","multiplyScalar","sqrt","smaller","isPositive"],(e=>{var{typed:t,abs:n,addScalar:r,divideScalar:i,multiplyScalar:a,sqrt:o,smaller:s,isPositive:u}=e;return t(rc,{"... number | BigNumber":function(e){for(var t=0,c=0,l=0;l<e.length;l++){var f=n(e[l]);s(c,f)?(t=a(t,a(i(c,f),i(c,f))),t=r(t,1),c=f):t=r(t,u(f)?a(i(f,c),i(f,c)):f)}return a(c,o(t))},Array:function(e){return this.apply(this,Jn(e))},Matrix:function(e){return this.apply(this,Jn(e.toArray()))}})})),ac=be("ImmutableDenseMatrix",["smaller","DenseMatrix"],(e=>{var{smaller:t,DenseMatrix:n}=e;function r(e,t){if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");if(t&&!C(t))throw new Error("Invalid datatype: "+t);if(N(e)||S(e)){var i=new n(e,t);this._data=i._data,this._size=i._size,this._datatype=i._datatype,this._min=null,this._max=null}else if(e&&S(e.data)&&S(e.size))this._data=e.data,this._size=e.size,this._datatype=e.datatype,this._min=void 0!==e.min?e.min:null,this._max=void 0!==e.max?e.max:null;else{if(e)throw new TypeError("Unsupported type of data ("+ne(e)+")");this._data=[],this._size=[0],this._datatype=t,this._min=null,this._max=null}}return r.prototype=new n,r.prototype.type="ImmutableDenseMatrix",r.prototype.isImmutableDenseMatrix=!0,r.prototype.subset=function(e){switch(arguments.length){case 1:var t=n.prototype.subset.call(this,e);return N(t)?new r({data:t._data,size:t._size,datatype:t._datatype}):t;case 2:case 3:throw new Error("Cannot invoke set subset on an Immutable Matrix instance");default:throw new SyntaxError("Wrong number of arguments")}},r.prototype.set=function(){throw new Error("Cannot invoke set on an Immutable Matrix instance")},r.prototype.resize=function(){throw new Error("Cannot invoke resize on an Immutable Matrix instance")},r.prototype.reshape=function(){throw new Error("Cannot invoke reshape on an Immutable Matrix instance")},r.prototype.clone=function(){return new r({data:re(this._data),size:re(this._size),datatype:this._datatype})},r.prototype.toJSON=function(){return{mathjs:"ImmutableDenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},r.fromJSON=function(e){return new r(e)},r.prototype.swapRows=function(){throw new Error("Cannot invoke swapRows on an Immutable Matrix instance")},r.prototype.min=function(){if(null===this._min){var e=null;this.forEach((function(n){(null===e||t(n,e))&&(e=n)})),this._min=null!==e?e:void 0}return this._min},r.prototype.max=function(){if(null===this._max){var e=null;this.forEach((function(n){(null===e||t(e,n))&&(e=n)})),this._max=null!==e?e:void 0}return this._max},r}),{isClass:!0}),oc=be("Index",["ImmutableDenseMatrix"],(e=>{var{ImmutableDenseMatrix:t}=e;function n(e){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this._dimensions=[],this._isScalar=!0;for(var t=0,i=arguments.length;t<i;t++){var a=arguments[t];if(_(a))this._dimensions.push(a),this._isScalar=!1;else if(Array.isArray(a)||N(a)){var o=r(a.valueOf());this._dimensions.push(o);var s=o.size();1===s.length&&1===s[0]||(this._isScalar=!1)}else if("number"==typeof a)this._dimensions.push(r([a]));else{if("string"!=typeof a)throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");this._dimensions.push(a)}}}function r(e){for(var n=0,r=e.length;n<r;n++)if("number"!=typeof e[n]||!Se(e[n]))throw new TypeError("Index parameters must be positive integer numbers");return new t(e)}return n.prototype.type="Index",n.prototype.isIndex=!0,n.prototype.clone=function(){var e=new n;return e._dimensions=re(this._dimensions),e._isScalar=this._isScalar,e},n.create=function(e){var t=new n;return n.apply(t,e),t},n.prototype.size=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];e[t]="string"==typeof r?1:r.size()[0]}return e},n.prototype.max=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];e[t]="string"==typeof r?r:r.max()}return e},n.prototype.min=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];e[t]="string"==typeof r?r:r.min()}return e},n.prototype.forEach=function(e){for(var t=0,n=this._dimensions.length;t<n;t++)e(this._dimensions[t],t,this)},n.prototype.dimension=function(e){return this._dimensions[e]||null},n.prototype.isObjectProperty=function(){return 1===this._dimensions.length&&"string"==typeof this._dimensions[0]},n.prototype.getObjectProperty=function(){return this.isObjectProperty()?this._dimensions[0]:null},n.prototype.isScalar=function(){return this._isScalar},n.prototype.toArray=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];e.push("string"==typeof r?r:r.toArray())}return e},n.prototype.valueOf=n.prototype.toArray,n.prototype.toString=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];"string"==typeof r?e.push(JSON.stringify(r)):e.push(r.toString())}return"["+e.join(", ")+"]"},n.prototype.toJSON=function(){return{mathjs:"Index",dimensions:this._dimensions}},n.fromJSON=function(e){return n.create(e.dimensions)},n}),{isClass:!0}),sc="kron",uc=be(sc,["typed","matrix","multiplyScalar"],(e=>{var{typed:t,matrix:n,multiplyScalar:r}=e;return t(sc,{"Matrix, Matrix":function(e,t){return n(i(e.toArray(),t.toArray()))},"Matrix, Array":function(e,t){return n(i(e.toArray(),t))},"Array, Matrix":function(e,t){return n(i(e,t.toArray()))},"Array, Array":i});function i(e,t){if(1===Pn(e).length&&(e=[e]),1===Pn(t).length&&(t=[t]),Pn(e).length>2||Pn(t).length>2)throw new RangeError("Vectors with dimensions greater then 2 are not supported expected (Size x = "+JSON.stringify(e.length)+", y = "+JSON.stringify(t.length)+")");var n=[],i=[];return e.map((function(e){return t.map((function(t){return i=[],n.push(i),e.map((function(e){return t.map((function(t){return i.push(r(e,t))}))}))}))}))&&n}})),cc="largerEq",lc=be(cc,["typed","config","matrix","DenseMatrix"],(e=>{var{typed:t,config:n,matrix:r,DenseMatrix:i}=e,a=Rs({typed:t}),o=iu({typed:t,DenseMatrix:i}),s=Ps({typed:t,DenseMatrix:i}),u=Ls({typed:t}),c=js({typed:t});return t(cc,{"boolean, boolean":function(e,t){return e>=t},"number, number":function(e,t){return e>=t||Le(e,t,n.epsilon)},"BigNumber, BigNumber":function(e,t){return e.gte(t)||Ea(e,t,n.epsilon)},"Fraction, Fraction":function(e,t){return-1!==e.compare(t)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return this(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return a(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,this)},"Array, Array":function(e,t){return this(r(e),r(t)).valueOf()},"Array, Matrix":function(e,t){return this(r(e),t)},"Matrix, Array":function(e,t){return this(e,r(t))},"SparseMatrix, any":function(e,t){return s(e,t,this,!1)},"DenseMatrix, any":function(e,t){return c(e,t,this,!1)},"any, SparseMatrix":function(e,t){return s(t,e,this,!0)},"any, DenseMatrix":function(e,t){return c(t,e,this,!0)},"Array, any":function(e,t){return c(r(e),t,this,!1).valueOf()},"any, Array":function(e,t){return c(r(t),e,this,!0).valueOf()}})})),fc=be("algorithm08",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return function(e,r,i){var a=e._values,o=e._index,s=e._ptr,u=e._size,c=e._datatype,l=r._values,f=r._index,p=r._ptr,h=r._size,d=r._datatype;if(u.length!==h.length)throw new Bn(u.length,h.length);if(u[0]!==h[0]||u[1]!==h[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+h+")");if(!a||!l)throw new Error("Cannot perform operation on Pattern Sparse Matrices");var m,g=u[0],v=u[1],y=n,b=0,x=i;"string"==typeof c&&c===d&&(m=c,y=t.find(n,[m,m]),b=t.convert(0,m),x=t.find(i,[m,m]));for(var w,E,C,S,N=[],A=[],k=[],D=[],_=[],M=0;M<v;M++){k[M]=A.length;var T=M+1;for(E=s[M],C=s[M+1],w=E;w<C;w++)_[S=o[w]]=T,D[S]=a[w],A.push(S);for(E=p[M],C=p[M+1],w=E;w<C;w++)_[S=f[w]]===T&&(D[S]=x(D[S],l[w]));for(w=k[M];w<A.length;){var O=D[S=A[w]];y(O,b)?A.splice(w,1):(N.push(O),w++)}}return k[v]=A.length,e.createSparseMatrix({values:N,index:A,ptr:k,size:[g,v],datatype:m})}})),pc="leftShift",hc=be(pc,["typed","matrix","equalScalar","zeros","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,zeros:i,DenseMatrix:a}=e,o=qs({typed:t}),s=Fs({typed:t,equalScalar:r}),u=fc({typed:t,equalScalar:r}),c=mu({typed:t,DenseMatrix:a}),l=zs({typed:t,equalScalar:r}),f=Ls({typed:t}),p=js({typed:t});return t(pc,{"number, number":Zi,"BigNumber, BigNumber":$i,"SparseMatrix, SparseMatrix":function(e,t){return u(e,t,this,!1)},"SparseMatrix, DenseMatrix":function(e,t){return s(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return f(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, number | BigNumber":function(e,t){return r(t,0)?e.clone():l(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return r(t,0)?e.clone():p(e,t,this,!1)},"number | BigNumber, SparseMatrix":function(e,t){return r(e,0)?i(t.size(),t.storage()):c(t,e,this,!0)},"number | BigNumber, DenseMatrix":function(e,t){return r(e,0)?i(t.size(),t.storage()):p(t,e,this,!0)},"Array, number | BigNumber":function(e,t){return this(n(e),t).valueOf()},"number | BigNumber, Array":function(e,t){return this(e,n(t)).valueOf()}})}));function dc(e){var{DenseMatrix:t}=e;return function(e,n,r){var i=e.size();if(2!==i.length)throw new RangeError("Matrix must be two dimensional (size: "+Tn(i)+")");var a=i[0];if(a!==i[1])throw new RangeError("Matrix must be square (size: "+Tn(i)+")");var o=[];if(N(n)){var s=n.size(),u=n._data;if(1===s.length){if(s[0]!==a)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var c=0;c<a;c++)o[c]=[u[c]];return new t({data:o,size:[a,1],datatype:n._datatype})}if(2===s.length){if(s[0]!==a||1!==s[1])throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");if(k(n)){if(r){o=[];for(var l=0;l<a;l++)o[l]=[u[l][0]];return new t({data:o,size:[a,1],datatype:n._datatype})}return n}if(D(n)){for(var f=0;f<a;f++)o[f]=[0];for(var p=n._values,h=n._index,d=n._ptr,m=d[1],g=d[0];g<m;g++)o[h[g]][0]=p[g];return new t({data:o,size:[a,1],datatype:n._datatype})}}throw new RangeError("Dimension mismatch. The right side has to be either 1- or 2-dimensional vector.")}if(S(n)){var v=Pn(n);if(1===v.length){if(v[0]!==a)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var y=0;y<a;y++)o[y]=[n[y]];return new t({data:o,size:[a,1]})}if(2===v.length){if(v[0]!==a||1!==v[1])throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var b=0;b<a;b++)o[b]=[n[b][0]];return new t({data:o,size:[a,1]})}throw new RangeError("Dimension mismatch. The right side has to be either 1- or 2-dimensional vector.")}}}var mc="lsolve",gc=be(mc,["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,divideScalar:r,multiplyScalar:i,subtract:a,equalScalar:o,DenseMatrix:s}=e,u=dc({DenseMatrix:s});return t(mc,{"SparseMatrix, Array | Matrix":function(e,t){return function(e,t){for(var n=(t=u(e,t,!0))._data,c=e._size[0],l=e._size[1],f=e._values,p=e._index,h=e._ptr,d=[],m=0;m<l;m++){var g=n[m][0]||0;if(o(g,0))d[m]=[0];else{for(var v=0,y=[],b=[],x=h[m],w=h[m+1],E=x;E<w;E++){var C=p[E];C===m?v=f[E]:C>m&&(y.push(f[E]),b.push(C))}if(o(v,0))throw new Error("Linear system cannot be solved since matrix is singular");for(var S=r(g,v),N=0,A=b.length;N<A;N++){var k=b[N];n[k]=[a(n[k][0]||0,i(S,y[N]))]}d[m]=[S]}}return new s({data:d,size:[c,1]})}(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return c(e,t)},"Array, Array | Matrix":function(e,t){return c(n(e),t).valueOf()}});function c(e,t){for(var n=(t=u(e,t,!0))._data,c=e._size[0],l=e._size[1],f=[],p=e._data,h=0;h<l;h++){var d=n[h][0]||0,m=void 0;if(o(d,0))m=0;else{var g=p[h][h];if(o(g,0))throw new Error("Linear system cannot be solved since matrix is singular");m=r(d,g);for(var v=h+1;v<c;v++)n[v]=[a(n[v][0]||0,i(m,p[v][h]))]}f[h]=[m]}return new s({data:f,size:[c,1]})}})),vc="matrixFromColumns",yc=be(vc,["typed","matrix","flatten","size"],(e=>{var{typed:t,matrix:n,flatten:r,size:i}=e;return t(vc,{"...Array":function(e){return a(e)},"...Matrix":function(e){return n(a(e.map((e=>e.toArray()))))}});function a(e){if(0===e.length)throw new TypeError("At least one column is needed to construct a matrix.");for(var t=o(e[0]),n=[],i=0;i<t;i++)n[i]=[];for(var a of e){var s=o(a);if(s!==t)throw new TypeError("The vectors had different length: "+(0|t)+"  "+(0|s));for(var u=r(a),c=0;c<t;c++)n[c].push(u[c])}return n}function o(e){var t=i(e);if(1===t.length)return t[0];if(2===t.length){if(1===t[0])return t[1];if(1===t[1])return t[0];throw new TypeError("At least one of the arguments is not a vector.")}throw new TypeError("Only one- or two-dimensional vectors are supported.")}})),bc=be("min",["typed","config","numeric","smaller"],(e=>{var{typed:t,config:n,numeric:r,smaller:i}=e;return t("min",{"Array | Matrix":o,"Array | Matrix, number | BigNumber":function(e,t){return Mr(e,t.valueOf(),a)},"...":function(e){if(kr(e))throw new TypeError("Scalar values expected in function min");return o(e)}});function a(e,t){try{return i(e,t)?e:t}catch(e){throw Js(e,"min",t)}}function o(e){var t;if(Dr(e,(function(e){try{isNaN(e)&&"number"==typeof e?t=NaN:(void 0===t||i(e,t))&&(t=e)}catch(t){throw Js(t,"min",e)}})),void 0===t)throw new Error("Cannot calculate min of an empty array");return"string"==typeof t&&(t=r(t,n.number)),t}})),xc="mode",wc=be(xc,["typed","isNaN","isNumeric"],(e=>{var{typed:t,isNaN:n,isNumeric:r}=e;return t(xc,{"Array | Matrix":i,"...":function(e){return i(e)}});function i(e){if(0===(e=Jn(e.valueOf())).length)throw new Error("Cannot calculate mode of an empty array");for(var t={},i=[],a=0,o=0;o<e.length;o++){var s=e[o];if(r(s)&&n(s))throw new Error("Cannot calculate mode of an array containing NaN values");s in t||(t[s]=0),t[s]++,t[s]===a?i.push(s):t[s]>a&&(a=t[s],i=[s])}return i}})),Ec="nthRoots",Cc=be(Ec,["config","typed","divideScalar","Complex"],(e=>{var{typed:t,config:n,divideScalar:r,Complex:i}=e,a=[function(e){return new i(e,0)},function(e){return new i(0,e)},function(e){return new i(-e,0)},function(e){return new i(0,-e)}];function o(e,t){if(t<0)throw new Error("Root must be greater than zero");if(0===t)throw new Error("Root must be non-zero");if(t%1!=0)throw new Error("Root must be an integer");if(0===e||0===e.abs())return[new i(0,0)];var n,r="number"==typeof e;(r||0===e.re||0===e.im)&&(n=r?2*+(e<0):0===e.im?2*+(e.re<0):2*+(e.im<0)+1);for(var o=e.arg(),s=e.abs(),u=[],c=Math.pow(s,1/t),l=0;l<t;l++){var f=(n+4*l)/t;f!==Math.round(f)?u.push(new i({r:c,phi:(o+2*Math.PI*l)/t})):u.push(a[f%4](c))}return u}return t(Ec,{Complex:function(e){return o(e,2)},"Complex, number":o})})),Sc=be("ones",["typed","config","matrix","BigNumber"],(e=>{var{typed:t,config:n,matrix:r,BigNumber:i}=e;return t("ones",{"":function(){return"Array"===n.matrix?a([]):a([],"default")},"...number | BigNumber | string":function(e){if("string"==typeof e[e.length-1]){var t=e.pop();return a(e,t)}return"Array"===n.matrix?a(e):a(e,"default")},Array:a,Matrix:function(e){var t=e.storage();return a(e.valueOf(),t)},"Array | Matrix, string":function(e,t){return a(e.valueOf(),t)}});function a(e,t){var n=function(e){var t=!1;return e.forEach((function(e,n,r){b(e)&&(t=!0,r[n]=e.toNumber())})),t}(e),a=n?new i(1):1;if(function(e){e.forEach((function(e){if("number"!=typeof e||!Se(e)||e<0)throw new Error("Parameters in function ones must be positive integers")}))}(e),t){var o=r(t);return e.length>0?o.resize(e,a):o}var s=[];return e.length>0?qn(s,e,a):s}})),Nc="partitionSelect",Ac=be(Nc,["typed","isNumeric","isNaN","compare"],(e=>{var{typed:t,isNumeric:n,isNaN:r,compare:i}=e,a=i,o=(e,t)=>-i(e,t);return t(Nc,{"Array | Matrix, number":function(e,t){return s(e,t,a)},"Array | Matrix, number, string":function(e,t,n){if("asc"===n)return s(e,t,a);if("desc"===n)return s(e,t,o);throw new Error('Compare string must be "asc" or "desc"')},"Array | Matrix, number, function":s});function s(e,t,n){if(!Se(t)||t<0)throw new Error("k must be a non-negative integer");if(N(e)){if(e.size().length>1)throw new Error("Only one dimensional matrices supported");return u(e.valueOf(),t,n)}if(Array.isArray(e))return u(e,t,n)}function u(e,t,i){if(t>=e.length)throw new Error("k out of bounds");for(var a=0;a<e.length;a++)if(n(e[a])&&r(e[a]))return e[a];for(var o=0,s=e.length-1;o<s;){for(var u=o,c=s,l=e[Math.floor(Math.random()*(s-o+1))+o];u<c;)if(i(e[u],l)>=0){var f=e[c];e[c]=e[u],e[u]=f,--c}else++u;i(e[u],l)>0&&--u,t<=u?s=u:o=u+1}return e[t]}}));function kc(e,t,n,r){if(!(this instanceof kc))throw new SyntaxError("Constructor must be called with the new operator");this.fn=e,this.count=t,this.min=n,this.max=r,this.message="Wrong number of arguments in function "+e+" ("+t+" provided, "+n+(null!=r?"-"+r:"")+" expected)",this.stack=(new Error).stack}kc.prototype=new Error,kc.prototype.constructor=Error,kc.prototype.name="ArgumentsError",kc.prototype.isArgumentsError=!0;var Dc=be("resize",["config","matrix"],(e=>{var{config:t,matrix:n}=e;return function(e,i,a){if(2!==arguments.length&&3!==arguments.length)throw new kc("resize",arguments.length,2,3);if(N(i)&&(i=i.valueOf()),b(i[0])&&(i=i.map((function(e){return b(e)?e.toNumber():e}))),N(e))return e.resize(i,a,!0);if("string"==typeof e)return r(e,i,a);var o=!Array.isArray(e)&&"Array"!==t.matrix;if(0===i.length){for(;Array.isArray(e);)e=e[0];return re(e)}Array.isArray(e)||(e=[e]);var s=qn(e=re(e),i,a);return o?n(s):s};function r(e,t,n){if(void 0!==n){if("string"!=typeof n||1!==n.length)throw new TypeError("Single character expected as defaultValue")}else n=" ";if(1!==t.length)throw new Bn(t.length,1);var r=t[0];if("number"!=typeof r||!Se(r))throw new TypeError("Invalid size, must contain positive integers (size: "+Tn(t)+")");if(e.length>r)return e.substring(0,r);if(e.length<r){for(var i=e,a=0,o=r-e.length;a<o;a++)i+=n;return i}return e}})),_c="rightLogShift",Mc=be(_c,["typed","matrix","equalScalar","zeros","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,zeros:i,DenseMatrix:a}=e,o=qs({typed:t}),s=Fs({typed:t,equalScalar:r}),u=fc({typed:t,equalScalar:r}),c=mu({typed:t,DenseMatrix:a}),l=zs({typed:t,equalScalar:r}),f=Ls({typed:t}),p=js({typed:t});return t(_c,{"number, number":ea,"SparseMatrix, SparseMatrix":function(e,t){return u(e,t,this,!1)},"SparseMatrix, DenseMatrix":function(e,t){return s(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return f(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, number | BigNumber":function(e,t){return r(t,0)?e.clone():l(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return r(t,0)?e.clone():p(e,t,this,!1)},"number | BigNumber, SparseMatrix":function(e,t){return r(e,0)?i(t.size(),t.storage()):c(t,e,this,!0)},"number | BigNumber, DenseMatrix":function(e,t){return r(e,0)?i(t.size(),t.storage()):p(t,e,this,!0)},"Array, number | BigNumber":function(e,t){return this(n(e),t).valueOf()},"number | BigNumber, Array":function(e,t){return this(e,n(t)).valueOf()}})}));function Tc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ic(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oc(Object(n),!0).forEach((function(t){Tc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fc="Number of decimals in function round must be an integer",Rc="round",Bc=be(Rc,["typed","matrix","equalScalar","zeros","BigNumber","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,zeros:i,BigNumber:a,DenseMatrix:o}=e,s=zs({typed:t,equalScalar:r}),u=Ps({typed:t,DenseMatrix:o}),c=js({typed:t});return t(Rc,Ic(Ic({},zc),{},{Complex:function(e){return e.round()},"Complex, number":function(e,t){if(t%1)throw new TypeError(Fc);return e.round(t)},"Complex, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(Fc);var n=t.toNumber();return e.round(n)},"number, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(Fc);return new a(e).toDecimalPlaces(t.toNumber())},BigNumber:function(e){return e.toDecimalPlaces(0)},"BigNumber, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(Fc);return e.toDecimalPlaces(t.toNumber())},Fraction:function(e){return e.round()},"Fraction, number":function(e,t){if(t%1)throw new TypeError(Fc);return e.round(t)},"Array | Matrix":function(e){return _r(e,this,!0)},"SparseMatrix, number | BigNumber":function(e,t){return s(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return c(e,t,this,!1)},"number | Complex | BigNumber, SparseMatrix":function(e,t){return r(e,0)?i(t.size(),t.storage()):u(t,e,this,!0)},"number | Complex | BigNumber, DenseMatrix":function(e,t){return r(e,0)?i(t.size(),t.storage()):c(t,e,this,!0)},"Array, number | BigNumber":function(e,t){return c(n(e),t,this,!1).valueOf()},"number | Complex | BigNumber, Array":function(e,t){return c(n(t),e,this,!0).valueOf()}}))})),zc={number:ni,"number, number":function(e,t){if(!Se(t))throw new TypeError(Fc);if(t<0||t>15)throw new Error("Number of decimals in function round must be in the range of 0-15");return ni(e,t)}},Pc="smallerEq",Lc=be(Pc,["typed","config","matrix","DenseMatrix"],(e=>{var{typed:t,config:n,matrix:r,DenseMatrix:i}=e,a=Rs({typed:t}),o=iu({typed:t,DenseMatrix:i}),s=Ps({typed:t,DenseMatrix:i}),u=Ls({typed:t}),c=js({typed:t});return t(Pc,{"boolean, boolean":function(e,t){return e<=t},"number, number":function(e,t){return e<=t||Le(e,t,n.epsilon)},"BigNumber, BigNumber":function(e,t){return e.lte(t)||Ea(e,t,n.epsilon)},"Fraction, Fraction":function(e,t){return 1!==e.compare(t)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return this(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return a(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,this)},"Array, Array":function(e,t){return this(r(e),r(t)).valueOf()},"Array, Matrix":function(e,t){return this(r(e),t)},"Matrix, Array":function(e,t){return this(e,r(t))},"SparseMatrix, any":function(e,t){return s(e,t,this,!1)},"DenseMatrix, any":function(e,t){return c(e,t,this,!1)},"any, SparseMatrix":function(e,t){return s(t,e,this,!0)},"any, DenseMatrix":function(e,t){return c(t,e,this,!0)},"Array, any":function(e,t){return c(r(e),t,this,!1).valueOf()},"any, Array":function(e,t){return c(r(t),e,this,!0).valueOf()}})})),jc="unequal",Uc=be(jc,["typed","config","equalScalar","matrix","DenseMatrix"],(e=>{var{typed:t,config:n,equalScalar:r,matrix:i,DenseMatrix:a}=e,o=Rs({typed:t}),s=iu({typed:t,DenseMatrix:a}),u=Ps({typed:t,DenseMatrix:a}),c=Ls({typed:t}),l=js({typed:t});return t("unequal",{"any, any":function(e,t){return null===e?null!==t:null===t?null!==e:void 0===e?void 0!==t:void 0===t?void 0!==e:f(e,t)},"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,f)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,f,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,f,!1)},"DenseMatrix, DenseMatrix":function(e,t){return c(e,t,f)},"Array, Array":function(e,t){return this(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return this(i(e),t)},"Matrix, Array":function(e,t){return this(e,i(t))},"SparseMatrix, any":function(e,t){return u(e,t,f,!1)},"DenseMatrix, any":function(e,t){return l(e,t,f,!1)},"any, SparseMatrix":function(e,t){return u(t,e,f,!0)},"any, DenseMatrix":function(e,t){return l(t,e,f,!0)},"Array, any":function(e,t){return l(i(e),t,f,!1).valueOf()},"any, Array":function(e,t){return l(i(t),e,f,!0).valueOf()}});function f(e,t){return!r(e,t)}})),qc=(be(jc,["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return t(jc,{"any, any":function(e,t){return null===e?null!==t:null===t?null!==e:void 0===e?void 0!==t:void 0===t?void 0!==e:!n(e,t)}})})),"usolve"),Wc=be(qc,["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,divideScalar:r,multiplyScalar:i,subtract:a,equalScalar:o,DenseMatrix:s}=e,u=dc({DenseMatrix:s});return t(qc,{"SparseMatrix, Array | Matrix":function(e,t){return function(e,t){for(var n=(t=u(e,t,!0))._data,c=e._size[0],l=e._size[1],f=e._values,p=e._index,h=e._ptr,d=[],m=l-1;m>=0;m--){var g=n[m][0]||0;if(o(g,0))d[m]=[0];else{for(var v=0,y=[],b=[],x=h[m],w=h[m+1]-1;w>=x;w--){var E=p[w];E===m?v=f[w]:E<m&&(y.push(f[w]),b.push(E))}if(o(v,0))throw new Error("Linear system cannot be solved since matrix is singular");for(var C=r(g,v),S=0,N=b.length;S<N;S++){var A=b[S];n[A]=[a(n[A][0],i(C,y[S]))]}d[m]=[C]}}return new s({data:d,size:[c,1]})}(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return c(e,t)},"Array, Array | Matrix":function(e,t){return c(n(e),t).valueOf()}});function c(e,t){for(var n=(t=u(e,t,!0))._data,c=e._size[0],l=e._size[1],f=[],p=e._data,h=l-1;h>=0;h--){var d=n[h][0]||0,m=void 0;if(o(d,0))m=0;else{var g=p[h][h];if(o(g,0))throw new Error("Linear system cannot be solved since matrix is singular");m=r(d,g);for(var v=h-1;v>=0;v--)n[v]=[a(n[v][0]||0,i(m,p[v][h]))]}f[h]=[m]}return new s({data:f,size:[c,1]})}})),Vc=be("xor",["typed","matrix","DenseMatrix"],(e=>{var{typed:t,matrix:n,DenseMatrix:r}=e,i=Rs({typed:t}),a=iu({typed:t,DenseMatrix:r}),o=Ps({typed:t,DenseMatrix:r}),s=Ls({typed:t}),u=js({typed:t});return t("xor",{"number, number":mo,"Complex, Complex":function(e,t){return(0!==e.re||0!==e.im)!=(0!==t.re||0!==t.im)},"BigNumber, BigNumber":function(e,t){return(!e.isZero()&&!e.isNaN())!=(!t.isZero()&&!t.isNaN())},"Unit, Unit":function(e,t){return this(e.value||0,t.value||0)},"SparseMatrix, SparseMatrix":function(e,t){return a(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return s(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return o(e,t,this,!1)},"DenseMatrix, any":function(e,t){return u(e,t,this,!1)},"any, SparseMatrix":function(e,t){return o(t,e,this,!0)},"any, DenseMatrix":function(e,t){return u(t,e,this,!0)},"Array, any":function(e,t){return u(n(e),t,this,!1).valueOf()},"any, Array":function(e,t){return u(n(t),e,this,!0).valueOf()}})})),$c=be("add",["typed","matrix","addScalar","equalScalar","DenseMatrix","SparseMatrix"],(e=>{var{typed:t,matrix:n,addScalar:r,equalScalar:i,DenseMatrix:a,SparseMatrix:o}=e,s=qs({typed:t}),u=Qu({typed:t,equalScalar:i}),c=mu({typed:t,DenseMatrix:a}),l=Ls({typed:t}),f=js({typed:t});return t("add",ae({"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,r)},"DenseMatrix, SparseMatrix":function(e,t){return s(e,t,r,!1)},"SparseMatrix, DenseMatrix":function(e,t){return s(t,e,r,!0)},"SparseMatrix, SparseMatrix":function(e,t){return u(e,t,r)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"DenseMatrix, any":function(e,t){return f(e,t,r,!1)},"SparseMatrix, any":function(e,t){return c(e,t,r,!1)},"any, DenseMatrix":function(e,t){return f(t,e,r,!0)},"any, SparseMatrix":function(e,t){return c(t,e,r,!0)},"Array, any":function(e,t){return f(n(e),t,r,!1).valueOf()},"any, Array":function(e,t){return f(n(t),e,r,!0).valueOf()},"any, any":r,"any, any, ...any":function(e,t,n){for(var r=this(e,t),i=0;i<n.length;i++)r=this(r,n[i]);return r}},r.signatures))})),Hc=be("algorithm09",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:n}=e;return function(e,r,i){var a=e._values,o=e._index,s=e._ptr,u=e._size,c=e._datatype,l=r._values,f=r._index,p=r._ptr,h=r._size,d=r._datatype;if(u.length!==h.length)throw new Bn(u.length,h.length);if(u[0]!==h[0]||u[1]!==h[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+h+")");var m,g=u[0],v=u[1],y=n,b=0,x=i;"string"==typeof c&&c===d&&(m=c,y=t.find(n,[m,m]),b=t.convert(0,m),x=t.find(i,[m,m]));var w,E,C,S,N,A=a&&l?[]:void 0,k=[],D=[],_=A?[]:void 0,M=[];for(E=0;E<v;E++){D[E]=k.length;var T=E+1;if(_)for(S=p[E],N=p[E+1],C=S;C<N;C++)M[w=f[C]]=T,_[w]=l[C];for(S=s[E],N=s[E+1],C=S;C<N;C++)if(w=o[C],_){var O=M[w]===T?_[w]:b,I=x(a[C],O);y(I,b)||(k.push(w),A.push(I))}else k.push(w)}return D[v]=k.length,e.createSparseMatrix({values:A,index:k,ptr:D,size:[g,v],datatype:m})}})),Gc="atan2",Kc=be(Gc,["typed","matrix","equalScalar","BigNumber","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,BigNumber:i,DenseMatrix:a}=e,o=Fs({typed:t,equalScalar:r}),s=Rs({typed:t}),u=Hc({typed:t,equalScalar:r}),c=zs({typed:t,equalScalar:r}),l=Ps({typed:t,DenseMatrix:a}),f=Ls({typed:t}),p=js({typed:t});return t(Gc,{"number, number":Math.atan2,"BigNumber, BigNumber":function(e,t){return i.atan2(e,t)},"SparseMatrix, SparseMatrix":function(e,t){return u(e,t,this,!1)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return s(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return f(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, number | BigNumber":function(e,t){return c(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return p(e,t,this,!1)},"number | BigNumber, SparseMatrix":function(e,t){return l(t,e,this,!0)},"number | BigNumber, DenseMatrix":function(e,t){return p(t,e,this,!0)},"Array, number | BigNumber":function(e,t){return p(n(e),t,this,!1).valueOf()},"number | BigNumber, Array":function(e,t){return p(n(t),e,this,!0).valueOf()}})})),Xc="bitOr",Yc=be(Xc,["typed","matrix","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,DenseMatrix:i}=e,a=qs({typed:t}),o=Qu({typed:t,equalScalar:r}),s=mu({typed:t,DenseMatrix:i}),u=Ls({typed:t}),c=js({typed:t});return t(Xc,{"number, number":Yi,"BigNumber, BigNumber":Ui,"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return a(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return s(e,t,this,!1)},"DenseMatrix, any":function(e,t){return c(e,t,this,!1)},"any, SparseMatrix":function(e,t){return s(t,e,this,!0)},"any, DenseMatrix":function(e,t){return c(t,e,this,!0)},"Array, any":function(e,t){return c(n(e),t,this,!1).valueOf()},"any, Array":function(e,t){return c(n(t),e,this,!0).valueOf()}})})),Jc="catalan",Zc=be(Jc,["typed","addScalar","divideScalar","multiplyScalar","combinations","isNegative","isInteger"],(e=>{var{typed:t,addScalar:n,divideScalar:r,multiplyScalar:i,combinations:a,isNegative:o,isInteger:s}=e;return t(Jc,{"number | BigNumber":function(e){if(!s(e)||o(e))throw new TypeError("Non-negative integer value expected in function catalan");return r(a(i(e,2),e),n(e,1))}})})),Qc=n(3228),el="compareNatural",tl=be(el,["typed","compare"],(e=>{var{typed:t,compare:n}=e,r=n.signatures["boolean,boolean"];return t(el,{"any, any":function(e,t){var o,s=ne(e),u=ne(t);if(!("number"!==s&&"BigNumber"!==s&&"Fraction"!==s||"number"!==u&&"BigNumber"!==u&&"Fraction"!==u))return"0"!==(o=n(e,t)).toString()?o>0?1:-1:Qc(s,u);if("Array"===s||"Matrix"===s||"Array"===u||"Matrix"===u)return 0!==(o=i(this,e,t))?o:Qc(s,u);if(s!==u)return Qc(s,u);if("Complex"===s)return function(e,t){return e.re>t.re?1:e.re<t.re?-1:e.im>t.im?1:e.im<t.im?-1:0}(e,t);if("Unit"===s)return e.equalBase(t)?this(e.value,t.value):a(this,e.formatUnits(),t.formatUnits());if("boolean"===s)return r(e,t);if("string"===s)return Qc(e,t);if("Object"===s)return function(e,t,n){var r=Object.keys(t),i=Object.keys(n);r.sort(Qc),i.sort(Qc);var o=a(e,r,i);if(0!==o)return o;for(var s=0;s<r.length;s++){var u=e(t[r[s]],n[i[s]]);if(0!==u)return u}return 0}(this,e,t);if("null"===s)return 0;if("undefined"===s)return 0;throw new TypeError('Unsupported type of value "'+s+'"')}});function i(e,t,n){return D(t)&&D(n)?a(e,t.toJSON().values,n.toJSON().values):D(t)?i(e,t.toArray(),n):D(n)?i(e,t,n.toArray()):k(t)?i(e,t.toJSON().data,n):k(n)?i(e,t,n.toJSON().data):Array.isArray(t)?Array.isArray(n)?a(e,t,n):i(e,t,[n]):i(e,[t],n)}function a(e,t,n){for(var r=0,i=Math.min(t.length,n.length);r<i;r++){var a=e(t[r],n[r]);if(0!==a)return a}return t.length>n.length?1:t.length<n.length?-1:0}})),nl="deepEqual",rl=be(nl,["typed","equal"],(e=>{var{typed:t,equal:n}=e;return t(nl,{"any, any":function(e,t){return r(e.valueOf(),t.valueOf())}});function r(e,t){if(Array.isArray(e)){if(Array.isArray(t)){var i=e.length;if(i!==t.length)return!1;for(var a=0;a<i;a++)if(!r(e[a],t[a]))return!1;return!0}return!1}return!Array.isArray(t)&&n(e,t)}})),il="diff",al=be(il,["typed","matrix","subtract","number"],(e=>{var{typed:t,matrix:n,subtract:r,number:i}=e;return t(il,{"Array | Matrix":function(e){return N(e)?n(o(e.toArray())):o(e)},"Array | Matrix, number":function(e,t){if(!Se(t))throw new RangeError("Dimension must be a whole number");return N(e)?n(a(e.toArray(),t)):a(e,t)},"Array | Matrix, BigNumber":function(e,t){return this(e,i(t))}});function a(e,t){if(N(e)&&(e=e.toArray()),!Array.isArray(e))throw RangeError("Array/Matrix does not have that many dimensions");if(t>0){var n=[];return e.forEach((e=>{n.push(a(e,t-1))})),n}if(0===t)return o(e);throw RangeError("Cannot have negative dimension")}function o(e){var t=[],n=e.length;if(n<2)return e;for(var r=1;r<n;r++)t.push(s(e[r-1],e[r]));return t}function s(e,t){N(e)&&(e=e.toArray()),N(t)&&(t=t.toArray());var n=Array.isArray(e),i=Array.isArray(t);if(n&&i)return function(e,t){if(e.length!==t.length)throw RangeError("Not all sub-arrays have the same length");for(var n=[],r=e.length,i=0;i<r;i++)n.push(s(e[i],t[i]));return n}(e,t);if(!n&&!i)return r(t,e);throw TypeError("Cannot calculate difference between 1 array and 1 non-array")}})),ol=be("dot",["typed","addScalar","multiplyScalar","conj","size"],(e=>{var{typed:t,addScalar:n,multiplyScalar:r,conj:i,size:a}=e;return t("dot",{"Array | DenseMatrix, Array | DenseMatrix":function(e,a){var u=o(e,a),c=N(e)?e._data:e,l=N(e)?e._datatype:void 0,f=N(a)?a._data:a,p=N(a)?a._datatype:void 0,h=2===s(e).length,d=2===s(a).length,m=n,g=r;if(l&&p&&l===p&&"string"==typeof l){var v=l;m=t.find(n,[v,v]),g=t.find(r,[v,v])}if(!h&&!d){for(var y=g(i(c[0]),f[0]),b=1;b<u;b++)y=m(y,g(i(c[b]),f[b]));return y}if(!h&&d){for(var x=g(i(c[0]),f[0][0]),w=1;w<u;w++)x=m(x,g(i(c[w]),f[w][0]));return x}if(h&&!d){for(var E=g(i(c[0][0]),f[0]),C=1;C<u;C++)E=m(E,g(i(c[C][0]),f[C]));return E}if(h&&d){for(var S=g(i(c[0][0]),f[0][0]),A=1;A<u;A++)S=m(S,g(i(c[A][0]),f[A][0]));return S}},"SparseMatrix, SparseMatrix":function(e,t){o(e,t);for(var i=e._index,a=e._values,s=t._index,u=t._values,c=0,l=n,f=r,p=0,h=0;p<i.length&&h<s.length;){var d=i[p],m=s[h];d<m?p++:d>m?h++:d===m&&(c=l(c,f(a[p],u[h])),p++,h++)}return c}});function o(e,t){var n,r,i=s(e),a=s(t);if(1===i.length)n=i[0];else{if(2!==i.length||1!==i[1])throw new RangeError("Expected a column vector, instead got a matrix of size ("+i.join(", ")+")");n=i[0]}if(1===a.length)r=a[0];else{if(2!==a.length||1!==a[1])throw new RangeError("Expected a column vector, instead got a matrix of size ("+a.join(", ")+")");r=a[0]}if(n!==r)throw new RangeError("Vectors must have equal length ("+n+" != "+r+")");if(0===n)throw new RangeError("Cannot calculate the dot product of empty vectors");return n}function s(e){return N(e)?e.size():a(e)}})),sl="equalText",ul=be(sl,["typed","compareText","isZero"],(e=>{var{typed:t,compareText:n,isZero:r}=e;return t(sl,{"any, any":function(e,t){return r(n(e,t))}})})),cl=be("floor",["typed","config","round","matrix","equalScalar"],(e=>{var{typed:t,config:n,round:r,matrix:i,equalScalar:a}=e,o=zs({typed:t,equalScalar:a}),s=js({typed:t});return t("floor",{number:function(e){return Le(e,r(e),n.epsilon)?r(e):Math.floor(e)},"number, number":function(e,t){if(Le(e,r(e,t),n.epsilon))return r(e,t);var[i,a]="".concat(e,"e").split("e"),o=Math.floor(Number("".concat(i,"e").concat(Number(a)+t)));return[i,a]="".concat(o,"e").split("e"),Number("".concat(i,"e").concat(Number(a)-t))},Complex:function(e){return e.floor()},"Complex, number":function(e,t){return e.floor(t)},BigNumber:function(e){return Ea(e,r(e),n.epsilon)?r(e):e.floor()},"BigNumber, BigNumber":function(e,t){return Ea(e,r(e,t),n.epsilon)?r(e,t):e.toDecimalPlaces(t.toNumber(),ye.ROUND_FLOOR)},Fraction:function(e){return e.floor()},"Fraction, number":function(e,t){return e.floor(t)},"Array | Matrix":function(e){return _r(e,this,!0)},"Array | Matrix, number":function(e,t){return _r(e,(e=>this(e,t)),!0)},"SparseMatrix, number | BigNumber":function(e,t){return o(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return s(e,t,this,!1)},"number | Complex | BigNumber, Array":function(e,t){return s(i(t),e,this,!0).valueOf()}})})),ll="identity",fl=be(ll,["typed","config","matrix","BigNumber","DenseMatrix","SparseMatrix"],(e=>{var{typed:t,config:n,matrix:r,BigNumber:i,DenseMatrix:a,SparseMatrix:o}=e;return t(ll,{"":function(){return"Matrix"===n.matrix?r([]):[]},string:function(e){return r(e)},"number | BigNumber":function(e){return u(e,e,"Matrix"===n.matrix?"dense":void 0)},"number | BigNumber, string":function(e,t){return u(e,e,t)},"number | BigNumber, number | BigNumber":function(e,t){return u(e,t,"Matrix"===n.matrix?"dense":void 0)},"number | BigNumber, number | BigNumber, string":function(e,t,n){return u(e,t,n)},Array:function(e){return s(e)},"Array, string":function(e,t){return s(e,t)},Matrix:function(e){return s(e.valueOf(),e.storage())},"Matrix, string":function(e,t){return s(e.valueOf(),t)}});function s(e,t){switch(e.length){case 0:return t?r(t):[];case 1:return u(e[0],e[0],t);case 2:return u(e[0],e[1],t);default:throw new Error("Vector containing two values expected")}}function u(e,t,n){var r=b(e)||b(t)?i:null;if(b(e)&&(e=e.toNumber()),b(t)&&(t=t.toNumber()),!Se(e)||e<1)throw new Error("Parameters in function identity must be positive integers");if(!Se(t)||t<1)throw new Error("Parameters in function identity must be positive integers");var s=r?new i(1):1,u=r?new r(0):0,c=[e,t];if(n){if("sparse"===n)return o.diagonal(c,s,0,u);if("dense"===n)return a.diagonal(c,s,0,u);throw new TypeError('Unknown matrix type "'.concat(n,'"'))}for(var l=qn([],c,u),f=e<t?e:t,p=0;p<f;p++)l[p][p]=s;return l}})),pl="invmod",hl=be(pl,["typed","config","BigNumber","xgcd","equal","smaller","mod","add","isInteger"],(e=>{var{typed:t,config:n,BigNumber:r,xgcd:i,equal:a,smaller:o,mod:s,add:u,isInteger:c}=e;return t(pl,{"number, number":l,"BigNumber, BigNumber":l});function l(e,t){if(!c(e)||!c(t))throw new Error("Parameters in function invmod must be integer numbers");if(e=s(e,t),a(t,0))throw new Error("Divisor must be non zero");var n=i(e,t);n=n.valueOf();var[l,f]=n;return a(l,r(1))?(f=s(f,t),o(f,r(0))&&(f=u(f,t)),f):NaN}})),dl="larger",ml=be(dl,["typed","config","matrix","DenseMatrix"],(e=>{var{typed:t,config:n,matrix:r,DenseMatrix:i}=e,a=Rs({typed:t}),o=iu({typed:t,DenseMatrix:i}),s=Ps({typed:t,DenseMatrix:i}),u=Ls({typed:t}),c=js({typed:t});return t(dl,{"boolean, boolean":function(e,t){return e>t},"number, number":function(e,t){return e>t&&!Le(e,t,n.epsilon)},"BigNumber, BigNumber":function(e,t){return e.gt(t)&&!Ea(e,t,n.epsilon)},"Fraction, Fraction":function(e,t){return 1===e.compare(t)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return this(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return a(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,this)},"Array, Array":function(e,t){return this(r(e),r(t)).valueOf()},"Array, Matrix":function(e,t){return this(r(e),t)},"Matrix, Array":function(e,t){return this(e,r(t))},"SparseMatrix, any":function(e,t){return s(e,t,this,!1)},"DenseMatrix, any":function(e,t){return c(e,t,this,!1)},"any, SparseMatrix":function(e,t){return s(t,e,this,!0)},"any, DenseMatrix":function(e,t){return c(t,e,this,!0)},"Array, any":function(e,t){return c(r(e),t,this,!1).valueOf()},"any, Array":function(e,t){return c(r(t),e,this,!0).valueOf()}})})),gl=be("log",["config","typed","divideScalar","Complex"],(e=>{var{typed:t,config:n,divideScalar:r,Complex:i}=e;return t("log",{number:function(e){return e>=0||n.predictable?Gr(e):new i(e,0).log()},Complex:function(e){return e.log()},BigNumber:function(e){return!e.isNegative()||n.predictable?e.ln():new i(e.toNumber(),0).log()},"Array | Matrix":function(e){return _r(e,this)},"any, any":function(e,t){return r(this(e),this(t))}})})),vl="lsolveAll",yl=be(vl,["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,divideScalar:r,multiplyScalar:i,subtract:a,equalScalar:o,DenseMatrix:s}=e,u=dc({DenseMatrix:s});return t(vl,{"SparseMatrix, Array | Matrix":function(e,t){return function(e,t){for(var n=[u(e,t,!0)._data.map((e=>e[0]))],c=e._size[0],l=e._size[1],f=e._values,p=e._index,h=e._ptr,d=0;d<l;d++)for(var m=n.length,g=0;g<m;g++){for(var v=n[g],y=[],b=[],x=h[d],w=h[d+1],E=0,C=x;C<w;C++){var S=p[C];S===d?E=f[C]:S>d&&(y.push(f[C]),b.push(S))}if(o(E,0))if(o(v[d],0)){if(0===g){var N=[...v];N[d]=1;for(var A=0,k=b.length;A<k;A++){var D=b[A];N[D]=a(N[D],y[A])}n.push(N)}}else{if(0===g)return[];n.splice(g,1),g-=1,m-=1}else{v[d]=r(v[d],E);for(var _=0,M=b.length;_<M;_++){var T=b[_];v[T]=a(v[T],i(v[d],y[_]))}}}return n.map((e=>new s({data:e.map((e=>[e])),size:[c,1]})))}(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return c(e,t)},"Array, Array | Matrix":function(e,t){return c(n(e),t).map((e=>e.valueOf()))}});function c(e,t){for(var n=[u(e,t,!0)._data.map((e=>e[0]))],c=e._data,l=e._size[0],f=e._size[1],p=0;p<f;p++)for(var h=n.length,d=0;d<h;d++){var m=n[d];if(o(c[p][p],0))if(o(m[p],0)){if(0===d){var g=[...m];g[p]=1;for(var v=p+1;v<f;v++)g[v]=a(g[v],c[v][p]);n.push(g)}}else{if(0===d)return[];n.splice(d,1),d-=1,h-=1}else{m[p]=r(m[p],c[p][p]);for(var y=p+1;y<f;y++)m[y]=a(m[y],i(m[p],c[y][p]))}}return n.map((e=>new s({data:e.map((e=>[e])),size:[l,1]})))}})),bl="matrixFromRows",xl=be(bl,["typed","matrix","flatten","size"],(e=>{var{typed:t,matrix:n,flatten:r,size:i}=e;return t(bl,{"...Array":function(e){return a(e)},"...Matrix":function(e){return n(a(e.map((e=>e.toArray()))))}});function a(e){if(0===e.length)throw new TypeError("At least one row is needed to construct a matrix.");var t=o(e[0]),n=[];for(var i of e){var a=o(i);if(a!==t)throw new TypeError("The vectors had different length: "+(0|t)+"  "+(0|a));n.push(r(i))}return n}function o(e){var t=i(e);if(1===t.length)return t[0];if(2===t.length){if(1===t[0])return t[1];if(1===t[1])return t[0];throw new TypeError("At least one of the arguments is not a vector.")}throw new TypeError("Only one- or two-dimensional vectors are supported.")}})),wl="multiply",El=be(wl,["typed","matrix","addScalar","multiplyScalar","equalScalar","dot"],(e=>{var{typed:t,matrix:n,addScalar:r,multiplyScalar:i,equalScalar:a,dot:o}=e,s=zs({typed:t,equalScalar:a}),u=js({typed:t});function c(e,t){switch(e.length){case 1:switch(t.length){case 1:if(e[0]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Vectors must have the same length");break;case 2:if(e[0]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Vector length ("+e[0]+") must match Matrix rows ("+t[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+t.length+" dimensions)")}break;case 2:switch(t.length){case 1:if(e[1]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Matrix columns ("+e[1]+") must match Vector length ("+t[0]+")");break;case 2:if(e[1]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Matrix A columns ("+e[1]+") must match Matrix B rows ("+t[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+t.length+" dimensions)")}break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix A has "+e.length+" dimensions)")}}var l=t("_multiplyMatrixVector",{"DenseMatrix, any":function(e,n){var a,o=e._data,s=e._size,u=e._datatype,c=n._data,l=n._datatype,f=s[0],p=s[1],h=r,d=i;u&&l&&u===l&&"string"==typeof u&&(a=u,h=t.find(r,[a,a]),d=t.find(i,[a,a]));for(var m=[],g=0;g<f;g++){for(var v=o[g],y=d(v[0],c[0]),b=1;b<p;b++)y=h(y,d(v[b],c[b]));m[g]=y}return e.createDenseMatrix({data:m,size:[f],datatype:a})},"SparseMatrix, any":function(e,n){var o=e._values,s=e._index,u=e._ptr,c=e._datatype;if(!o)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var l,f=n._data,p=n._datatype,h=e._size[0],d=n._size[0],m=[],g=[],v=[],y=r,b=i,x=a,w=0;c&&p&&c===p&&"string"==typeof c&&(l=c,y=t.find(r,[l,l]),b=t.find(i,[l,l]),x=t.find(a,[l,l]),w=t.convert(0,l));var E=[],C=[];v[0]=0;for(var S=0;S<d;S++){var N=f[S];if(!x(N,w))for(var A=u[S],k=u[S+1],D=A;D<k;D++){var _=s[D];C[_]?E[_]=y(E[_],b(N,o[D])):(C[_]=!0,g.push(_),E[_]=b(N,o[D]))}}for(var M=g.length,T=0;T<M;T++){var O=g[T];m[T]=E[O]}return v[1]=g.length,e.createSparseMatrix({values:m,index:g,ptr:v,size:[h,1],datatype:l})}}),f=t("_multiplyMatrixMatrix",{"DenseMatrix, DenseMatrix":function(e,n){var a,o=e._data,s=e._size,u=e._datatype,c=n._data,l=n._size,f=n._datatype,p=s[0],h=s[1],d=l[1],m=r,g=i;u&&f&&u===f&&"string"==typeof u&&(a=u,m=t.find(r,[a,a]),g=t.find(i,[a,a]));for(var v=[],y=0;y<p;y++){var b=o[y];v[y]=[];for(var x=0;x<d;x++){for(var w=g(b[0],c[0][x]),E=1;E<h;E++)w=m(w,g(b[E],c[E][x]));v[y][x]=w}}return e.createDenseMatrix({data:v,size:[p,d],datatype:a})},"DenseMatrix, SparseMatrix":function(e,n){var o=e._data,s=e._size,u=e._datatype,c=n._values,l=n._index,f=n._ptr,p=n._size,h=n._datatype;if(!c)throw new Error("Cannot multiply Dense Matrix times Pattern only Matrix");var d,m=s[0],g=p[1],v=r,y=i,b=a,x=0;u&&h&&u===h&&"string"==typeof u&&(d=u,v=t.find(r,[d,d]),y=t.find(i,[d,d]),b=t.find(a,[d,d]),x=t.convert(0,d));for(var w=[],E=[],C=[],S=n.createSparseMatrix({values:w,index:E,ptr:C,size:[m,g],datatype:d}),N=0;N<g;N++){C[N]=E.length;var A=f[N],k=f[N+1];if(k>A)for(var D=0,_=0;_<m;_++){for(var M=_+1,T=void 0,O=A;O<k;O++){var I=l[O];D!==M?(T=y(o[_][I],c[O]),D=M):T=v(T,y(o[_][I],c[O]))}D!==M||b(T,x)||(E.push(_),w.push(T))}}return C[g]=E.length,S},"SparseMatrix, DenseMatrix":function(e,n){var o=e._values,s=e._index,u=e._ptr,c=e._datatype;if(!o)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var l,f=n._data,p=n._datatype,h=e._size[0],d=n._size[0],m=n._size[1],g=r,v=i,y=a,b=0;c&&p&&c===p&&"string"==typeof c&&(l=c,g=t.find(r,[l,l]),v=t.find(i,[l,l]),y=t.find(a,[l,l]),b=t.convert(0,l));for(var x=[],w=[],E=[],C=e.createSparseMatrix({values:x,index:w,ptr:E,size:[h,m],datatype:l}),S=[],N=[],A=0;A<m;A++){E[A]=w.length;for(var k=A+1,D=0;D<d;D++){var _=f[D][A];if(!y(_,b))for(var M=u[D],T=u[D+1],O=M;O<T;O++){var I=s[O];N[I]!==k?(N[I]=k,w.push(I),S[I]=v(_,o[O])):S[I]=g(S[I],v(_,o[O]))}}for(var F=E[A],R=w.length,B=F;B<R;B++){var z=w[B];x[B]=S[z]}}return E[m]=w.length,C},"SparseMatrix, SparseMatrix":function(e,n){var a,o=e._values,s=e._index,u=e._ptr,c=e._datatype,l=n._values,f=n._index,p=n._ptr,h=n._datatype,d=e._size[0],m=n._size[1],g=o&&l,v=r,y=i;c&&h&&c===h&&"string"==typeof c&&(a=c,v=t.find(r,[a,a]),y=t.find(i,[a,a]));for(var b,x,w,E,C,S,N,A,k=g?[]:void 0,D=[],_=[],M=e.createSparseMatrix({values:k,index:D,ptr:_,size:[d,m],datatype:a}),T=g?[]:void 0,O=[],I=0;I<m;I++){_[I]=D.length;var F=I+1;for(C=p[I],S=p[I+1],E=C;E<S;E++)if(A=f[E],g)for(x=u[A],w=u[A+1],b=x;b<w;b++)O[N=s[b]]!==F?(O[N]=F,D.push(N),T[N]=y(l[E],o[b])):T[N]=v(T[N],y(l[E],o[b]));else for(x=u[A],w=u[A+1],b=x;b<w;b++)O[N=s[b]]!==F&&(O[N]=F,D.push(N));if(g)for(var R=_[I],B=D.length,z=R;z<B;z++){var P=D[z];k[z]=T[P]}}return _[m]=D.length,M}});return t(wl,ae({"Array, Array":function(e,t){c(Pn(e),Pn(t));var r=this(n(e),n(t));return N(r)?r.valueOf():r},"Matrix, Matrix":function(e,n){var a=e.size(),s=n.size();return c(a,s),1===a.length?1===s.length?function(e,t,n){if(0===n)throw new Error("Cannot multiply two empty vectors");return o(e,t)}(e,n,a[0]):function(e,n){if("dense"!==n.storage())throw new Error("Support for SparseMatrix not implemented");return function(e,n){var a,o=e._data,s=e._size,u=e._datatype,c=n._data,l=n._size,f=n._datatype,p=s[0],h=l[1],d=r,m=i;u&&f&&u===f&&"string"==typeof u&&(a=u,d=t.find(r,[a,a]),m=t.find(i,[a,a]));for(var g=[],v=0;v<h;v++){for(var y=m(o[0],c[0][v]),b=1;b<p;b++)y=d(y,m(o[b],c[b][v]));g[v]=y}return e.createDenseMatrix({data:g,size:[h],datatype:a})}(e,n)}(e,n):1===s.length?l(e,n):f(e,n)},"Matrix, Array":function(e,t){return this(e,n(t))},"Array, Matrix":function(e,t){return this(n(e,t.storage()),t)},"SparseMatrix, any":function(e,t){return s(e,t,i,!1)},"DenseMatrix, any":function(e,t){return u(e,t,i,!1)},"any, SparseMatrix":function(e,t){return s(t,e,i,!0)},"any, DenseMatrix":function(e,t){return u(t,e,i,!0)},"Array, any":function(e,t){return u(n(e),t,i,!1).valueOf()},"any, Array":function(e,t){return u(n(t),e,i,!0).valueOf()},"any, any":i,"any, any, ...any":function(e,t,n){for(var r=this(e,t),i=0;i<n.length;i++)r=this(r,n[i]);return r}},i.signatures))})),Cl=be("pow",["typed","config","identity","multiply","matrix","fraction","number","Complex"],(e=>{var{typed:t,config:n,identity:r,multiply:i,matrix:a,number:o,fraction:s,Complex:u}=e;return t("pow",{"number, number":c,"Complex, Complex":function(e,t){return e.pow(t)},"BigNumber, BigNumber":function(e,t){return t.isInteger()||e>=0||n.predictable?e.pow(t):new u(e.toNumber(),0).pow(t.toNumber(),0)},"Fraction, Fraction":function(e,t){var r=e.pow(t);if(null!=r)return r;if(n.predictable)throw new Error("Result of pow is non-rational and cannot be expressed as a fraction");return c(e.valueOf(),t.valueOf())},"Array, number":l,"Array, BigNumber":function(e,t){return l(e,t.toNumber())},"Matrix, number":f,"Matrix, BigNumber":function(e,t){return f(e,t.toNumber())},"Unit, number | BigNumber":function(e,t){return e.pow(t)}});function c(e,t){if(n.predictable&&!Se(t)&&e<0)try{var r=s(t),i=o(r);if((t===i||Math.abs((t-i)/t)<1e-14)&&r.d%2==1)return(r.n%2==0?1:-1)*Math.pow(-e,t)}catch(e){}return n.predictable&&(e<-1&&t===1/0||e>-1&&e<0&&t===-1/0)?NaN:Se(t)||e>=0||n.predictable?ti(e,t):e*e<1&&t===1/0||e*e>1&&t===-1/0?0:new u(e,0).pow(t,0)}function l(e,t){if(!Se(t)||t<0)throw new TypeError("For A^b, b must be a positive integer (value is "+t+")");var n=Pn(e);if(2!==n.length)throw new Error("For A^b, A must be 2 dimensional (A has "+n.length+" dimensions)");if(n[0]!==n[1])throw new Error("For A^b, A must be square (size is "+n[0]+"x"+n[1]+")");for(var a=r(n[0]).valueOf(),o=e;t>=1;)1==(1&t)&&(a=i(o,a)),t>>=1,o=i(o,o);return a}function f(e,t){return a(l(e.valueOf(),t))}})),Sl=be("qr",["typed","matrix","zeros","identity","isZero","equal","sign","sqrt","conj","unaryMinus","addScalar","divideScalar","multiplyScalar","subtract","complex"],(e=>{var{typed:t,matrix:n,zeros:r,identity:i,isZero:a,equal:o,sign:s,sqrt:u,conj:c,unaryMinus:l,addScalar:f,divideScalar:p,multiplyScalar:h,subtract:d,complex:m}=e;return g(t("qr",{DenseMatrix:function(e){return y(e)},SparseMatrix:function(e){return function(e){throw new Error("qr not implemented for sparse matrices yet")}()},Array:function(e){var t=y(n(e));return{Q:t.Q.valueOf(),R:t.R.valueOf()}}}),{_denseQRimpl:v});function v(e){var t,n,m,g=e._size[0],v=e._size[1],y=i([g],"dense"),b=y._data,x=e.clone(),w=x._data,E=r([g],"");for(m=0;m<Math.min(v,g);++m){var C=w[m][m],S=l(o(C,0)?1:s(C)),N=c(S),A=0;for(t=m;t<g;t++)A=f(A,h(w[t][m],c(w[t][m])));var k=h(S,u(A));if(!a(k)){var D=d(C,k);for(E[m]=1,t=m+1;t<g;t++)E[t]=p(w[t][m],D);var _=l(c(p(D,k))),M=void 0;for(n=m;n<v;n++){for(M=0,t=m;t<g;t++)M=f(M,h(c(E[t]),w[t][n]));for(M=h(M,_),t=m;t<g;t++)w[t][n]=h(d(w[t][n],h(E[t],M)),N)}for(t=0;t<g;t++){for(M=0,n=m;n<g;n++)M=f(M,h(b[t][n],E[n]));for(M=h(M,_),n=m;n<g;++n)b[t][n]=p(d(b[t][n],h(M,c(E[n]))),N)}}}return{Q:y,R:x,toString:function(){return"Q: "+this.Q.toString()+"\nR: "+this.R.toString()}}}function y(e){var t=v(e),n=t.R._data;if(e._data.length>0)for(var r="Complex"===n[0][0].type?m(0):0,i=0;i<n.length;++i)for(var a=0;a<i&&a<(n[0]||[]).length;++a)n[i][a]=r;return t}})),Nl="range",Al=be(Nl,["typed","config","?matrix","?bignumber","smaller","smallerEq","larger","largerEq"],(e=>{var{typed:t,config:n,matrix:r,bignumber:i,smaller:a,smallerEq:o,larger:s,largerEq:u}=e;return t(Nl,{string:l,"string, boolean":l,"number, number":function(e,t){return c(f(e,t,1))},"number, number, number":function(e,t,n){return c(f(e,t,n))},"number, number, boolean":function(e,t,n){return c(n?p(e,t,1):f(e,t,1))},"number, number, number, boolean":function(e,t,n,r){return c(r?p(e,t,n):f(e,t,n))},"BigNumber, BigNumber":function(e,t){return c(h(e,t,new(0,e.constructor)(1)))},"BigNumber, BigNumber, BigNumber":function(e,t,n){return c(h(e,t,n))},"BigNumber, BigNumber, boolean":function(e,t,n){var r=e.constructor;return c(n?d(e,t,new r(1)):h(e,t,new r(1)))},"BigNumber, BigNumber, BigNumber, boolean":function(e,t,n,r){return c(r?d(e,t,n):h(e,t,n))}});function c(e){return"Matrix"===n.matrix?r?r(e):Ks():e}function l(e,t){var r=function(e){var t=e.split(":").map((function(e){return Number(e)})),n=t.some((function(e){return isNaN(e)}));if(n)return null;switch(t.length){case 2:return{start:t[0],end:t[1],step:1};case 3:return{start:t[0],end:t[2],step:t[1]};default:return null}}(e);if(!r)throw new SyntaxError('String "'+e+'" is no valid range');return"BigNumber"===n.number?(void 0===i&&Hs(),c((t?d:h)(i(r.start),i(r.end),i(r.step)))):c((t?p:f)(r.start,r.end,r.step))}function f(e,t,n){var r=[],i=e;if(n>0)for(;a(i,t);)r.push(i),i+=n;else if(n<0)for(;s(i,t);)r.push(i),i+=n;return r}function p(e,t,n){var r=[],i=e;if(n>0)for(;o(i,t);)r.push(i),i+=n;else if(n<0)for(;u(i,t);)r.push(i),i+=n;return r}function h(e,t,n){var r=i(0),o=[],u=e;if(n.gt(r))for(;a(u,t);)o.push(u),u=u.plus(n);else if(n.lt(r))for(;s(u,t);)o.push(u),u=u.plus(n);return o}function d(e,t,n){var r=i(0),a=[],s=e;if(n.gt(r))for(;o(s,t);)a.push(s),s=s.plus(n);else if(n.lt(r))for(;u(s,t);)a.push(s),s=s.plus(n);return a}})),kl="rightArithShift",Dl=be(kl,["typed","matrix","equalScalar","zeros","DenseMatrix"],(e=>{var{typed:t,matrix:n,equalScalar:r,zeros:i,DenseMatrix:a}=e,o=qs({typed:t}),s=Fs({typed:t,equalScalar:r}),u=fc({typed:t,equalScalar:r}),c=mu({typed:t,DenseMatrix:a}),l=zs({typed:t,equalScalar:r}),f=Ls({typed:t}),p=js({typed:t});return t(kl,{"number, number":Qi,"BigNumber, BigNumber":Hi,"SparseMatrix, SparseMatrix":function(e,t){return u(e,t,this,!1)},"SparseMatrix, DenseMatrix":function(e,t){return s(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return f(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, number | BigNumber":function(e,t){return r(t,0)?e.clone():l(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return r(t,0)?e.clone():p(e,t,this,!1)},"number | BigNumber, SparseMatrix":function(e,t){return r(e,0)?i(t.size(),t.storage()):c(t,e,this,!0)},"number | BigNumber, DenseMatrix":function(e,t){return r(e,0)?i(t.size(),t.storage()):p(t,e,this,!0)},"Array, number | BigNumber":function(e,t){return this(n(e),t).valueOf()},"number | BigNumber, Array":function(e,t){return this(e,n(t)).valueOf()}})})),_l=be("row",["typed","Index","matrix","range"],(e=>{var{typed:t,Index:n,matrix:r,range:i}=e;return t("row",{"Matrix, number":a,"Array, number":function(e,t){return a(r(re(e)),t).valueOf()}});function a(e,t){if(2!==e.size().length)throw new Error("Only two dimensional matrix is supported");Un(t,e.size()[0]);var r=i(0,e.size()[1]),a=new n(t,r);return e.subset(a)}})),Ml="setCartesian",Tl=be(Ml,["typed","size","subset","compareNatural","Index","DenseMatrix"],(e=>{var{typed:t,size:n,subset:r,compareNatural:i,Index:a,DenseMatrix:o}=e;return t(Ml,{"Array | Matrix, Array | Matrix":function(e,t){var s=[];if(0!==r(n(e),new a(0))&&0!==r(n(t),new a(0))){var u=Jn(Array.isArray(e)?e:e.toArray()).sort(i),c=Jn(Array.isArray(t)?t:t.toArray()).sort(i);s=[];for(var l=0;l<u.length;l++)for(var f=0;f<c.length;f++)s.push([u[l],c[f]])}return Array.isArray(e)&&Array.isArray(t)?s:new o(s)}})})),Ol="setDistinct",Il=be(Ol,["typed","size","subset","compareNatural","Index","DenseMatrix"],(e=>{var{typed:t,size:n,subset:r,compareNatural:i,Index:a,DenseMatrix:o}=e;return t(Ol,{"Array | Matrix":function(e){var t;if(0===r(n(e),new a(0)))t=[];else{var s=Jn(Array.isArray(e)?e:e.toArray()).sort(i);(t=[]).push(s[0]);for(var u=1;u<s.length;u++)0!==i(s[u],s[u-1])&&t.push(s[u])}return Array.isArray(e)?t:new o(t)}})})),Fl="setIsSubset",Rl=be(Fl,["typed","size","subset","compareNatural","Index"],(e=>{var{typed:t,size:n,subset:r,compareNatural:i,Index:a}=e;return t(Fl,{"Array | Matrix, Array | Matrix":function(e,t){if(0===r(n(e),new a(0)))return!0;if(0===r(n(t),new a(0)))return!1;for(var o,s=rr(Jn(Array.isArray(e)?e:e.toArray()).sort(i)),u=rr(Jn(Array.isArray(t)?t:t.toArray()).sort(i)),c=0;c<s.length;c++){o=!1;for(var l=0;l<u.length;l++)if(0===i(s[c].value,u[l].value)&&s[c].identifier===u[l].identifier){o=!0;break}if(!1===o)return!1}return!0}})})),Bl="setPowerset",zl=be(Bl,["typed","size","subset","compareNatural","Index"],(e=>{var{typed:t,size:n,subset:r,compareNatural:i,Index:a}=e;return t(Bl,{"Array | Matrix":function(e){if(0===r(n(e),new a(0)))return[];for(var t=Jn(Array.isArray(e)?e:e.toArray()).sort(i),s=[],u=0;u.toString(2).length<=t.length;)s.push(o(t,u.toString(2).split("").reverse())),u++;return function(e){for(var t=[],n=e.length-1;n>0;n--)for(var r=0;r<n;r++)e[r].length>e[r+1].length&&(t=e[r],e[r]=e[r+1],e[r+1]=t);return e}(s)}});function o(e,t){for(var n=[],r=0;r<t.length;r++)"1"===t[r]&&n.push(e[r]);return n}}));function Pl(e,t,n,r,i,a,o){var s=0;for(n[o]=e;s>=0;){var u=n[o+s],c=n[r+u];-1===c?(s--,a[t++]=u):(n[r+u]=n[i+c],n[o+ ++s]=c)}return t}function Ll(e){return-e-2}var jl=be("csAmd",["add","multiply","transpose"],(e=>{var{add:t,multiply:n,transpose:r}=e;return function(e,o){if(!o||e<=0||e>3)return null;var s=o._size,u=s[0],c=s[1],l=0,f=Math.max(16,10*Math.sqrt(c)),p=function(e,i,a,o,s){var u=r(i);if(1===e&&o===a)return t(i,u);if(2===e){for(var c=u._index,l=u._ptr,f=0,p=0;p<a;p++){var h=l[p];if(l[p]=f,!(l[p+1]-h>s))for(var d=l[p+1];h<d;h++)c[f++]=c[h]}return l[a]=f,i=r(u),n(u,i)}return n(u,i)}(e,o,u,c,f=Math.min(c-2,f));!function(e,t,n){for(var r=e._values,i=e._index,a=e._ptr,o=e._size[1],s=0,u=0;u<o;u++){var c=a[u];for(a[u]=s;c<a[u+1];c++)t(i[c],u,r?r[c]:1,null)&&(i[s]=i[c],r&&(r[s]=r[c]),s++)}a[o]=s,i.splice(s,i.length-s),r&&r.splice(s,r.length-s)}(p,a);for(var h,d,m,g,v,y,b,x,w,E,C,S,N,A,k,D,_=p._index,M=p._ptr,T=M[c],O=[],I=[],F=c+1,R=2*(c+1),B=3*(c+1),z=4*(c+1),P=5*(c+1),L=6*(c+1),j=7*(c+1),U=O,q=function(e,t,n,r,a,o,s,u,c,l,f,p){for(var h=0;h<e;h++)n[0+h]=t[h+1]-t[h];n[0+e]=0;for(var d=0;d<=e;d++)n[a+d]=-1,o[d]=-1,n[s+d]=-1,n[u+d]=-1,n[c+d]=1,n[l+d]=1,n[f+d]=0,n[p+d]=n[0+d];var m=i(0,0,n,l,e);return n[f+e]=-2,t[e]=-1,n[l+e]=0,m}(c,M,I,0,B,U,R,j,F,L,z,P),W=function(e,t,n,r,i,a,o,s,u,c,l){for(var f=0,p=0;p<e;p++){var h=n[r+p];if(0===h)n[i+p]=-2,f++,t[p]=-1,n[a+p]=0;else if(h>o)n[s+p]=0,n[i+p]=-1,f++,t[p]=Ll(e),n[s+e]++;else{var d=n[u+h];-1!==d&&(c[d]=p),n[l+p]=n[u+h],n[u+h]=p}}return f}(c,M,I,P,z,L,f,F,B,U,R),V=0;W<c;){for(m=-1;V<c&&-1===(m=I[B+V]);V++);-1!==I[R+m]&&(U[I[R+m]]=-1),I[B+V]=I[R+m];var $=I[z+m],H=I[F+m];W+=H;var G=0;I[F+m]=-H;var K=M[m],X=0===$?K:T,Y=X;for(g=1;g<=$+1;g++){for(g>$?(y=m,b=K,x=I[0+m]-$):(b=M[y=_[K++]],x=I[0+y]),v=1;v<=x;v++)(w=I[F+(h=_[b++])])<=0||(G+=w,I[F+h]=-w,_[Y++]=h,-1!==I[R+h]&&(U[I[R+h]]=U[h]),-1!==U[h]?I[R+U[h]]=I[R+h]:I[B+I[P+h]]=I[R+h]);y!==m&&(M[y]=Ll(m),I[L+y]=0)}for(0!==$&&(T=Y),I[P+m]=G,M[m]=X,I[0+m]=Y-X,I[z+m]=-2,q=i(q,l,I,L,c),E=X;E<Y;E++)if(!((C=I[z+(h=_[E])])<=0)){var J=q-(w=-I[F+h]);for(K=M[h],S=M[h]+C-1;K<=S;K++)I[L+(y=_[K])]>=q?I[L+y]-=w:0!==I[L+y]&&(I[L+y]=I[P+y]+J)}for(E=X;E<Y;E++){for(N=(S=M[h=_[E]])+I[z+h]-1,A=S,k=0,D=0,K=S;K<=N;K++)if(0!==I[L+(y=_[K])]){var Z=I[L+y]-q;Z>0?(D+=Z,_[A++]=y,k+=y):(M[y]=Ll(m),I[L+y]=0)}I[z+h]=A-S+1;var Q=A,ee=S+I[0+h];for(K=N+1;K<ee;K++){var te=I[F+(d=_[K])];te<=0||(D+=te,_[A++]=d,k+=d)}0===D?(M[h]=Ll(m),G-=w=-I[F+h],H+=w,W+=w,I[F+h]=0,I[z+h]=-1):(I[P+h]=Math.min(I[P+h],D),_[A]=_[Q],_[Q]=_[S],_[S]=m,I[0+h]=A-S+1,k=(k<0?-k:k)%c,I[R+h]=I[j+k],I[j+k]=h,U[h]=k)}for(I[P+m]=G,q=i(q+(l=Math.max(l,G)),l,I,L,c),E=X;E<Y;E++)if(!(I[F+(h=_[E])]>=0))for(h=I[j+(k=U[h])],I[j+k]=-1;-1!==h&&-1!==I[R+h];h=I[R+h],q++){for(x=I[0+h],C=I[z+h],K=M[h]+1;K<=M[h]+x-1;K++)I[L+_[K]]=q;var ne=h;for(d=I[R+h];-1!==d;){var re=I[0+d]===x&&I[z+d]===C;for(K=M[d]+1;re&&K<=M[d]+x-1;K++)I[L+_[K]]!==q&&(re=0);re?(M[d]=Ll(h),I[F+h]+=I[F+d],I[F+d]=0,I[z+d]=-1,d=I[R+d],I[R+ne]=d):(ne=d,d=I[R+d])}}for(K=X,E=X;E<Y;E++)(w=-I[F+(h=_[E])])<=0||(I[F+h]=w,D=I[P+h]+G-w,-1!==I[B+(D=Math.min(D,c-W-w))]&&(U[I[B+D]]=h),I[R+h]=I[B+D],U[h]=-1,I[B+D]=h,V=Math.min(V,D),I[P+h]=D,_[K++]=h);I[F+m]=H,0==(I[0+m]=K-X)&&(M[m]=-1,I[L+m]=0),0!==$&&(T=K)}for(h=0;h<c;h++)M[h]=Ll(M[h]);for(d=0;d<=c;d++)I[B+d]=-1;for(d=c;d>=0;d--)I[F+d]>0||(I[R+d]=I[B+M[d]],I[B+M[d]]=d);for(y=c;y>=0;y--)I[F+y]<=0||-1!==M[y]&&(I[R+y]=I[B+M[y]],I[B+M[y]]=y);for(m=0,h=0;h<=c;h++)-1===M[h]&&(m=Pl(h,m,I,B,R,O,L));return O.splice(O.length-1,1),O};function i(e,t,n,r,i){if(e<2||e+t<0){for(var a=0;a<i;a++)0!==n[r+a]&&(n[r+a]=1);e=2}return e}function a(e,t){return e!==t}}));function Ul(e,t,n,r,i,a,o){var s,u,c,l=0;if(e<=t||n[r+t]<=n[i+e])return-1;n[i+e]=n[r+t];var f=n[a+e];if(n[a+e]=t,-1===f)l=1,c=e;else{for(l=2,c=f;c!==n[o+c];c=n[o+c]);for(s=f;s!==c;s=u)u=n[o+s],n[o+s]=c}return{jleaf:l,q:c}}var ql=be("csCounts",["transpose"],(e=>{var{transpose:t}=e;return function(e,n,r,i){if(!e||!n||!r)return null;var a,o,s,u,c,l,f,p=e._size,h=p[0],d=p[1],m=4*d+(i?d+h+1:0),g=[],v=d,y=2*d,b=3*d,x=4*d,w=5*d+1;for(s=0;s<m;s++)g[s]=-1;var E=[],C=t(e),S=C._index,N=C._ptr;for(s=0;s<d;s++)for(E[o=r[s]]=-1===g[b+o]?1:0;-1!==o&&-1===g[b+o];o=n[o])g[b+o]=s;if(i){for(s=0;s<d;s++)g[r[s]]=s;for(a=0;a<h;a++){for(s=d,l=N[a],f=N[a+1],c=l;c<f;c++)s=Math.min(s,g[S[c]]);g[w+a]=g[x+s],g[x+s]=a}}for(a=0;a<d;a++)g[0+a]=a;for(s=0;s<d;s++){for(-1!==n[o=r[s]]&&E[n[o]]--,u=i?g[x+s]:o;-1!==u;u=i?g[w+u]:-1)for(c=N[u];c<N[u+1];c++){var A=Ul(a=S[c],o,g,b,v,y,0);A.jleaf>=1&&E[o]++,2===A.jleaf&&E[A.q]--}-1!==n[o]&&(g[0+o]=n[o])}for(o=0;o<d;o++)-1!==n[o]&&(E[n[o]]+=E[o]);return E}})),Wl=be("csSqr",["add","multiply","transpose"],(e=>{var{add:t,multiply:n,transpose:r}=e,i=jl({add:t,multiply:n,transpose:r}),a=ql({transpose:r});return function(e,t,n){var r,o=t._ptr,s=t._size[1],u={};if(u.q=i(e,t),e&&!u.q)return null;if(n){var c=e?function(e,t,n,r){for(var i=e._values,a=e._index,o=e._ptr,s=e._size,u=e._datatype,c=s[0],l=s[1],f=null,p=[],h=[],d=0,m=0;m<l;m++){h[m]=d;for(var g=n?n[m]:m,v=o[g],y=o[g+1],b=v;b<y;b++){var x=a[b];p[d]=x,f&&(f[d]=i[b]),d++}}return h[l]=d,e.createSparseMatrix({values:f,index:p,ptr:h,size:[c,l],datatype:u})}(t,0,u.q):t;u.parent=function(e,t){if(!e)return null;var n,r,i=e._index,a=e._ptr,o=e._size,s=o[0],u=o[1],c=[],l=[],f=u;for(n=0;n<s;n++)l[f+n]=-1;for(var p=0;p<u;p++){c[p]=-1,l[0+p]=-1;for(var h=a[p],d=a[p+1],m=h;m<d;m++){var g=i[m];for(n=l[f+g];-1!==n&&n<p;n=r)r=l[0+n],l[0+n]=p,-1===r&&(c[n]=p);l[f+g]=p}}return c}(c);var l=function(e,t){if(!e)return null;var n,r=0,i=[],a=[],o=t,s=2*t;for(n=0;n<t;n++)a[0+n]=-1;for(n=t-1;n>=0;n--)-1!==e[n]&&(a[o+n]=a[0+e[n]],a[0+e[n]]=n);for(n=0;n<t;n++)-1===e[n]&&(r=Pl(n,r,a,0,o,i,s));return i}(u.parent,s);if(u.cp=a(c,u.parent,l,1),c&&u.parent&&u.cp&&function(e,t){var n=e._ptr,r=e._index,i=e._size,a=i[0],o=i[1];t.pinv=[],t.leftmost=[];var s,u,c,l,f,p=t.parent,h=t.pinv,d=t.leftmost,m=[],g=a,v=a+o,y=a+2*o;for(u=0;u<o;u++)m[g+u]=-1,m[v+u]=-1,m[y+u]=0;for(s=0;s<a;s++)d[s]=-1;for(u=o-1;u>=0;u--)for(l=n[u],f=n[u+1],c=l;c<f;c++)d[r[c]]=u;for(s=a-1;s>=0;s--)h[s]=-1,-1!==(u=d[s])&&(0==m[y+u]++&&(m[v+u]=s),m[0+s]=m[g+u],m[g+u]=s);for(t.lnz=0,t.m2=a,u=0;u<o;u++)if(s=m[g+u],t.lnz++,s<0&&(s=t.m2++),h[s]=u,!(--y[u]<=0)){t.lnz+=m[y+u];var b=p[u];-1!==b&&(0===m[y+b]&&(m[v+b]=m[v+u]),m[0+m[v+u]]=m[g+b],m[g+b]=m[0+s],m[y+b]+=m[y+u])}for(s=0;s<a;s++)h[s]<0&&(h[s]=u++);return!0}(c,u))for(u.unz=0,r=0;r<s;r++)u.unz+=u.cp[r]}else u.unz=4*o[s]+s,u.lnz=u.unz;return u}}));function Vl(e,t){return e[t]<0}function $l(e,t){e[t]=Ll(e[t])}function Hl(e){return e<0?Ll(e):e}function Gl(e,t,n,r,i){var a,o,s,u=t._index,c=t._ptr,l=t._size[1],f=0;for(r[0]=e;f>=0;){e=r[f];var p=i?i[e]:e;Vl(c,e)||($l(c,e),r[l+f]=p<0?0:Hl(c[p]));var h=1;for(o=r[l+f],s=p<0?0:Hl(c[p+1]);o<s;o++)if(!Vl(c,a=u[o])){r[l+f]=o,r[++f]=a,h=0;break}h&&(f--,r[--n]=e)}return n}var Kl=be("csSpsolve",["divideScalar","multiply","subtract"],(e=>{var{divideScalar:t,multiply:n,subtract:r}=e;return function(e,i,a,o,s,u,c){var l,f,p,h,d=e._values,m=e._index,g=e._ptr,v=e._size[1],y=i._values,b=i._index,x=i._ptr,w=function(e,t,n,r,i){var a,o,s,u=e._ptr,c=e._size,l=t._index,f=t._ptr,p=c[1],h=p;for(o=f[n],s=f[n+1],a=o;a<s;a++){var d=l[a];Vl(u,d)||(h=Gl(d,e,h,r,i))}for(a=h;a<p;a++)$l(u,r[a]);return h}(e,i,a,o,u);for(l=w;l<v;l++)s[o[l]]=0;for(f=x[a],p=x[a+1],l=f;l<p;l++)s[b[l]]=y[l];for(var E=w;E<v;E++){var C=o[E],S=u?u[C]:C;if(!(S<0))for(f=g[S],p=g[S+1],s[C]=t(s[C],d[c?f:p-1]),l=c?f+1:f,h=c?p:p-1;l<h;l++){var N=m[l];s[N]=r(s[N],n(d[l],s[C]))}}return w}})),Xl=be("csLu",["abs","divideScalar","multiply","subtract","larger","largerEq","SparseMatrix"],(e=>{var{abs:t,divideScalar:n,multiply:r,subtract:i,larger:a,largerEq:o,SparseMatrix:s}=e,u=Kl({divideScalar:n,multiply:r,subtract:i});return function(e,i,c){if(!e)return null;var l,f=e._size[1],p=100,h=100;i&&(l=i.q,p=i.lnz||p,h=i.unz||h);var d,m,g=[],v=[],y=[],b=new s({values:g,index:v,ptr:y,size:[f,f]}),x=[],w=[],E=[],C=new s({values:x,index:w,ptr:E,size:[f,f]}),S=[],N=[],A=[];for(d=0;d<f;d++)N[d]=0,S[d]=-1,y[d+1]=0;p=0,h=0;for(var k=0;k<f;k++){y[k]=p,E[k]=h;var D=l?l[k]:k,_=u(b,e,D,A,N,S,1),M=-1,T=-1;for(m=_;m<f;m++)if(S[d=A[m]]<0){var O=t(N[d]);a(O,T)&&(T=O,M=d)}else w[h]=S[d],x[h++]=N[d];if(-1===M||T<=0)return null;S[D]<0&&o(t(N[D]),r(T,c))&&(M=D);var I=N[M];for(w[h]=k,x[h++]=I,S[M]=k,v[p]=M,g[p++]=1,m=_;m<f;m++)S[d=A[m]]<0&&(v[p]=d,g[p++]=n(N[d],I)),N[d]=0}for(y[f]=p,E[f]=h,m=0;m<p;m++)v[m]=S[v[m]];return g.splice(p,g.length-p),v.splice(p,v.length-p),x.splice(h,x.length-h),w.splice(h,w.length-h),{L:b,U:C,pinv:S}}})),Yl=be("slu",["typed","abs","add","multiply","transpose","divideScalar","subtract","larger","largerEq","SparseMatrix"],(e=>{var{typed:t,abs:n,add:r,multiply:i,transpose:a,divideScalar:o,subtract:s,larger:u,largerEq:c,SparseMatrix:l}=e,f=Wl({add:r,multiply:i,transpose:a}),p=Xl({abs:n,divideScalar:o,multiply:i,subtract:s,larger:u,largerEq:c,SparseMatrix:l});return t("slu",{"SparseMatrix, number, number":function(e,t,n){if(!Se(t)||t<0||t>3)throw new Error("Symbolic Ordering and Analysis order must be an integer number in the interval [0, 3]");if(n<0||n>1)throw new Error("Partial pivoting threshold must be a number from 0 to 1");var r=f(t,e,!1),i=p(e,r,n);return{L:i.L,U:i.U,p:i.pinv,q:r.q,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\np: "+this.p.toString()+(this.q?"\nq: "+this.q.toString():"")+"\n"}}}})})),Jl=be("sum",["typed","config","add","numeric"],(e=>{var{typed:t,config:n,add:r,numeric:i}=e;return t("sum",{"Array | Matrix":a,"Array | Matrix, number | BigNumber":function(e,t){try{return Mr(e,t,r)}catch(e){throw Js(e,"sum")}},"...":function(e){if(kr(e))throw new TypeError("Scalar values expected in function sum");return a(e)}});function a(e){var t;return Dr(e,(function(e){try{t=void 0===t?e:r(t,e)}catch(t){throw Js(t,"sum",e)}})),void 0===t&&(t=i(0,n.number)),"string"==typeof t&&(t=i(t,n.number)),t}})),Zl=be("trace",["typed","matrix","add"],(e=>{var{typed:t,matrix:n,add:r}=e;return t("trace",{Array:function(e){return i(n(e))},SparseMatrix:function(e){var t=e._values,n=e._index,i=e._ptr,a=e._size,o=a[0],s=a[1];if(o===s){var u=0;if(t.length>0)for(var c=0;c<s;c++)for(var l=i[c],f=i[c+1],p=l;p<f;p++){var h=n[p];if(h===c){u=r(u,t[p]);break}if(h>c)break}return u}throw new RangeError("Matrix must be square (size: "+Tn(a)+")")},DenseMatrix:i,any:re});function i(e){var t=e._size,n=e._data;switch(t.length){case 1:if(1===t[0])return re(n[0]);throw new RangeError("Matrix must be square (size: "+Tn(t)+")");case 2:var i=t[0];if(i===t[1]){for(var a=0,o=0;o<i;o++)a=r(a,n[o][o]);return a}throw new RangeError("Matrix must be square (size: "+Tn(t)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+Tn(t)+")")}}})),Ql="usolveAll",ef=be(Ql,["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:n,divideScalar:r,multiplyScalar:i,subtract:a,equalScalar:o,DenseMatrix:s}=e,u=dc({DenseMatrix:s});return t(Ql,{"SparseMatrix, Array | Matrix":function(e,t){return function(e,t){for(var n=[u(e,t,!0)._data.map((e=>e[0]))],c=e._size[0],l=e._size[1],f=e._values,p=e._index,h=e._ptr,d=l-1;d>=0;d--)for(var m=n.length,g=0;g<m;g++){for(var v=n[g],y=[],b=[],x=h[d],w=0,E=h[d+1]-1;E>=x;E--){var C=p[E];C===d?w=f[E]:C<d&&(y.push(f[E]),b.push(C))}if(o(w,0))if(o(v[d],0)){if(0===g){var S=[...v];S[d]=1;for(var N=0,A=b.length;N<A;N++){var k=b[N];S[k]=a(S[k],y[N])}n.push(S)}}else{if(0===g)return[];n.splice(g,1),g-=1,m-=1}else{v[d]=r(v[d],w);for(var D=0,_=b.length;D<_;D++){var M=b[D];v[M]=a(v[M],i(v[d],y[D]))}}}return n.map((e=>new s({data:e.map((e=>[e])),size:[c,1]})))}(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return c(e,t)},"Array, Array | Matrix":function(e,t){return c(n(e),t).map((e=>e.valueOf()))}});function c(e,t){for(var n=[u(e,t,!0)._data.map((e=>e[0]))],c=e._data,l=e._size[0],f=e._size[1]-1;f>=0;f--)for(var p=n.length,h=0;h<p;h++){var d=n[h];if(o(c[f][f],0))if(o(d[f],0)){if(0===h){var m=[...d];m[f]=1;for(var g=f-1;g>=0;g--)m[g]=a(m[g],c[g][f]);n.push(m)}}else{if(0===h)return[];n.splice(h,1),h-=1,p-=1}else{d[f]=r(d[f],c[f][f]);for(var v=f-1;v>=0;v--)d[v]=a(d[v],i(d[f],c[v][f]))}}return n.map((e=>new s({data:e.map((e=>[e])),size:[l,1]})))}})),tf="asin",nf=be(tf,["typed","config","Complex"],(e=>{var{typed:t,config:n,Complex:r}=e;return t(tf,{number:function(e){return e>=-1&&e<=1||n.predictable?Math.asin(e):new r(e,0).asin()},Complex:function(e){return e.asin()},BigNumber:function(e){return e.asin()},"Array | Matrix":function(e){return _r(e,this,!0)}})})),rf=be("ceil",["typed","config","round","matrix","equalScalar"],(e=>{var{typed:t,config:n,round:r,matrix:i,equalScalar:a}=e,o=zs({typed:t,equalScalar:a}),s=js({typed:t});return t("ceil",{number:function(e){return Le(e,r(e),n.epsilon)?r(e):Ur(e)},"number, number":function(e,t){if(Le(e,r(e,t),n.epsilon))return r(e,t);var[i,a]="".concat(e,"e").split("e"),o=Math.ceil(Number("".concat(i,"e").concat(Number(a)+t)));return[i,a]="".concat(o,"e").split("e"),Number("".concat(i,"e").concat(Number(a)-t))},Complex:function(e){return e.ceil()},"Complex, number":function(e,t){return e.ceil(t)},BigNumber:function(e){return Ea(e,r(e),n.epsilon)?r(e):e.ceil()},"BigNumber, BigNumber":function(e,t){return Ea(e,r(e,t),n.epsilon)?r(e,t):e.toDecimalPlaces(t.toNumber(),ye.ROUND_CEIL)},Fraction:function(e){return e.ceil()},"Fraction, number":function(e,t){return e.ceil(t)},"Array | Matrix":function(e){return _r(e,this,!0)},"Array | Matrix, number":function(e,t){return _r(e,(e=>this(e,t)),!0)},"SparseMatrix, number | BigNumber":function(e,t){return o(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return s(e,t,this,!1)},"number | Complex | BigNumber, Array":function(e,t){return s(i(t),e,this,!0).valueOf()}})})),af="column",of=be(af,["typed","Index","matrix","range"],(e=>{var{typed:t,Index:n,matrix:r,range:i}=e;return t(af,{"Matrix, number":a,"Array, number":function(e,t){return a(r(re(e)),t).valueOf()}});function a(e,t){if(2!==e.size().length)throw new Error("Only two dimensional matrix is supported");Un(t,e.size()[1]);var r=i(0,e.size()[0]),a=new n(r,t);return e.subset(a)}})),sf="composition",uf=be(sf,["typed","addScalar","combinations","isNegative","isPositive","isInteger","larger"],(e=>{var{typed:t,addScalar:n,combinations:r,isPositive:i,isNegative:a,isInteger:o,larger:s}=e;return t(sf,{"number | BigNumber, number | BigNumber":function(e,t){if(!(o(e)&&i(e)&&o(t)&&i(t)))throw new TypeError("Positive integer value expected in function composition");if(s(t,e))throw new TypeError("k must be less than or equal to n in function composition");return r(n(e,-1),n(t,-1))}})})),cf="cross",lf=be(cf,["typed","matrix","subtract","multiply"],(e=>{var{typed:t,matrix:n,subtract:r,multiply:i}=e;return t(cf,{"Matrix, Matrix":function(e,t){return n(a(e.toArray(),t.toArray()))},"Matrix, Array":function(e,t){return n(a(e.toArray(),t))},"Array, Matrix":function(e,t){return n(a(e,t.toArray()))},"Array, Array":a});function a(e,t){var n=Math.max(Pn(e).length,Pn(t).length);e=Gn(e),t=Gn(t);var a=Pn(e),o=Pn(t);if(1!==a.length||1!==o.length||3!==a[0]||3!==o[0])throw new RangeError("Vectors with length 3 expected (Size A = ["+a.join(", ")+"], B = ["+o.join(", ")+"])");var s=[r(i(e[1],t[2]),i(e[2],t[1])),r(i(e[2],t[0]),i(e[0],t[2])),r(i(e[0],t[1]),i(e[1],t[0]))];return n>1?[s]:s}})),ff="distance",pf=be(ff,["typed","addScalar","subtract","divideScalar","multiplyScalar","unaryMinus","sqrt","abs"],(e=>{var{typed:t,addScalar:n,subtract:r,multiplyScalar:i,divideScalar:a,unaryMinus:o,sqrt:s,abs:u}=e;return t(ff,{"Array, Array, Array":function(e,t,n){if(2===e.length&&2===t.length&&2===n.length){if(!l(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!l(t))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");if(!l(n))throw new TypeError("Array with 2 numbers or BigNumbers expected for third argument");var s=a(r(n[1],n[0]),r(t[1],t[0])),u=i(i(s,s),t[0]),c=o(i(s,t[0])),f=e[1];return m(e[0],e[1],u,c,f)}throw new TypeError("Invalid Arguments: Try again")},"Object, Object, Object":function(e,t,n){if(2===Object.keys(e).length&&2===Object.keys(t).length&&2===Object.keys(n).length){if(!l(e))throw new TypeError("Values of pointX and pointY should be numbers or BigNumbers");if(!l(t))throw new TypeError("Values of lineOnePtX and lineOnePtY should be numbers or BigNumbers");if(!l(n))throw new TypeError("Values of lineTwoPtX and lineTwoPtY should be numbers or BigNumbers");if("pointX"in e&&"pointY"in e&&"lineOnePtX"in t&&"lineOnePtY"in t&&"lineTwoPtX"in n&&"lineTwoPtY"in n){var s=a(r(n.lineTwoPtY,n.lineTwoPtX),r(t.lineOnePtY,t.lineOnePtX)),u=i(i(s,s),t.lineOnePtX),c=o(i(s,t.lineOnePtX)),f=e.pointX;return m(e.pointX,e.pointY,u,c,f)}throw new TypeError("Key names do not match")}throw new TypeError("Invalid Arguments: Try again")},"Array, Array":function(e,t){if(2===e.length&&3===t.length){if(!l(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!f(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");return m(e[0],e[1],t[0],t[1],t[2])}if(3===e.length&&6===t.length){if(!f(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!h(t))throw new TypeError("Array with 6 numbers or BigNumbers expected for second argument");return g(e[0],e[1],e[2],t[0],t[1],t[2],t[3],t[4],t[5])}if(e.length===t.length&&e.length>0){if(!p(e))throw new TypeError("All values of an array should be numbers or BigNumbers");if(!p(t))throw new TypeError("All values of an array should be numbers or BigNumbers");return v(e,t)}throw new TypeError("Invalid Arguments: Try again")},"Object, Object":function(e,t){if(2===Object.keys(e).length&&3===Object.keys(t).length){if(!l(e))throw new TypeError("Values of pointX and pointY should be numbers or BigNumbers");if(!f(t))throw new TypeError("Values of xCoeffLine, yCoeffLine and constant should be numbers or BigNumbers");if("pointX"in e&&"pointY"in e&&"xCoeffLine"in t&&"yCoeffLine"in t&&"constant"in t)return m(e.pointX,e.pointY,t.xCoeffLine,t.yCoeffLine,t.constant);throw new TypeError("Key names do not match")}if(3===Object.keys(e).length&&6===Object.keys(t).length){if(!f(e))throw new TypeError("Values of pointX, pointY and pointZ should be numbers or BigNumbers");if(!h(t))throw new TypeError("Values of x0, y0, z0, a, b and c should be numbers or BigNumbers");if("pointX"in e&&"pointY"in e&&"x0"in t&&"y0"in t&&"z0"in t&&"a"in t&&"b"in t&&"c"in t)return g(e.pointX,e.pointY,e.pointZ,t.x0,t.y0,t.z0,t.a,t.b,t.c);throw new TypeError("Key names do not match")}if(2===Object.keys(e).length&&2===Object.keys(t).length){if(!l(e))throw new TypeError("Values of pointOneX and pointOneY should be numbers or BigNumbers");if(!l(t))throw new TypeError("Values of pointTwoX and pointTwoY should be numbers or BigNumbers");if("pointOneX"in e&&"pointOneY"in e&&"pointTwoX"in t&&"pointTwoY"in t)return v([e.pointOneX,e.pointOneY],[t.pointTwoX,t.pointTwoY]);throw new TypeError("Key names do not match")}if(3===Object.keys(e).length&&3===Object.keys(t).length){if(!f(e))throw new TypeError("Values of pointOneX, pointOneY and pointOneZ should be numbers or BigNumbers");if(!f(t))throw new TypeError("Values of pointTwoX, pointTwoY and pointTwoZ should be numbers or BigNumbers");if("pointOneX"in e&&"pointOneY"in e&&"pointOneZ"in e&&"pointTwoX"in t&&"pointTwoY"in t&&"pointTwoZ"in t)return v([e.pointOneX,e.pointOneY,e.pointOneZ],[t.pointTwoX,t.pointTwoY,t.pointTwoZ]);throw new TypeError("Key names do not match")}throw new TypeError("Invalid Arguments: Try again")},Array:function(e){if(!function(e){if(2===e[0].length&&c(e[0][0])&&c(e[0][1])){if(e.some((e=>2!==e.length||!c(e[0])||!c(e[1]))))return!1}else{if(!(3===e[0].length&&c(e[0][0])&&c(e[0][1])&&c(e[0][2])))return!1;if(e.some((e=>3!==e.length||!c(e[0])||!c(e[1])||!c(e[2]))))return!1}return!0}(e))throw new TypeError("Incorrect array format entered for pairwise distance calculation");return function(e){for(var t=[],n=[],r=[],i=0;i<e.length-1;i++)for(var a=i+1;a<e.length;a++)2===e[0].length?(n=[e[i][0],e[i][1]],r=[e[a][0],e[a][1]]):3===e[0].length&&(n=[e[i][0],e[i][1],e[i][2]],r=[e[a][0],e[a][1],e[a][2]]),t.push(v(n,r));return t}(e)}});function c(e){return"number"==typeof e||b(e)}function l(e){return e.constructor!==Array&&(e=d(e)),c(e[0])&&c(e[1])}function f(e){return e.constructor!==Array&&(e=d(e)),c(e[0])&&c(e[1])&&c(e[2])}function p(e){return Array.isArray(e)||(e=d(e)),e.every(c)}function h(e){return e.constructor!==Array&&(e=d(e)),c(e[0])&&c(e[1])&&c(e[2])&&c(e[3])&&c(e[4])&&c(e[5])}function d(e){for(var t=Object.keys(e),n=[],r=0;r<t.length;r++)n.push(e[t[r]]);return n}function m(e,t,r,o,c){var l=u(n(n(i(r,e),i(o,t)),c)),f=s(n(i(r,r),i(o,o)));return a(l,f)}function g(e,t,o,u,c,l,f,p,h){var d=[r(i(r(c,t),h),i(r(l,o),p)),r(i(r(l,o),f),i(r(u,e),h)),r(i(r(u,e),p),i(r(c,t),f))];d=s(n(n(i(d[0],d[0]),i(d[1],d[1])),i(d[2],d[2])));var m=s(n(n(i(f,f),i(p,p)),i(h,h)));return a(d,m)}function v(e,t){for(var a=e.length,o=0,u=0,c=0;c<a;c++)u=r(e[c],t[c]),o=n(i(u,u),o);return s(o)}})),hf="dotMultiply",df=be(hf,["typed","matrix","equalScalar","multiplyScalar"],(e=>{var{typed:t,matrix:n,equalScalar:r,multiplyScalar:i}=e,a=Fs({typed:t,equalScalar:r}),o=Hc({typed:t,equalScalar:r}),s=zs({typed:t,equalScalar:r}),u=Ls({typed:t}),c=js({typed:t});return t(hf,{"any, any":i,"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,i,!1)},"SparseMatrix, DenseMatrix":function(e,t){return a(t,e,i,!0)},"DenseMatrix, SparseMatrix":function(e,t){return a(e,t,i,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,i)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, any":function(e,t){return s(e,t,i,!1)},"DenseMatrix, any":function(e,t){return c(e,t,i,!1)},"any, SparseMatrix":function(e,t){return s(t,e,i,!0)},"any, DenseMatrix":function(e,t){return c(t,e,i,!0)},"Array, any":function(e,t){return c(n(e),t,i,!1).valueOf()},"any, Array":function(e,t){return c(n(t),e,i,!0).valueOf()}})})),mf=be("FibonacciHeap",["smaller","larger"],(e=>{var{smaller:t,larger:n}=e,r=1/Math.log((1+Math.sqrt(5))/2);function i(){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");this._minimum=null,this._size=0}function a(e,t,n){t.left.right=t.right,t.right.left=t.left,n.degree--,n.child===t&&(n.child=t.right),0===n.degree&&(n.child=null),t.left=e,t.right=e.right,e.right=t,t.right.left=t,t.parent=null,t.mark=!1}function o(e,t){var n=t.parent;n&&(t.mark?(a(e,t,n),o(n)):t.mark=!0)}i.prototype.type="FibonacciHeap",i.prototype.isFibonacciHeap=!0,i.prototype.insert=function(e,n){var r={key:e,value:n,degree:0};if(this._minimum){var i=this._minimum;r.left=i,r.right=i.right,i.right=r,r.right.left=r,t(e,i.key)&&(this._minimum=r)}else r.left=r,r.right=r,this._minimum=r;return this._size++,r},i.prototype.size=function(){return this._size},i.prototype.clear=function(){this._minimum=null,this._size=0},i.prototype.isEmpty=function(){return 0===this._size},i.prototype.extractMinimum=function(){var e=this._minimum;if(null===e)return e;for(var i=this._minimum,a=e.degree,o=e.child;a>0;){var u=o.right;o.left.right=o.right,o.right.left=o.left,o.left=i,o.right=i.right,i.right=o,o.right.left=o,o.parent=null,o=u,a--}return e.left.right=e.right,e.right.left=e.left,i=e===e.right?null:function(e,i){var a,o=Math.floor(Math.log(i)*r)+1,u=new Array(o),c=0,l=e;if(l)for(c++,l=l.right;l!==e;)c++,l=l.right;for(;c>0;){for(var f=l.degree,p=l.right;a=u[f];){if(n(l.key,a.key)){var h=a;a=l,l=h}s(a,l),u[f]=null,f++}u[f]=l,l=p,c--}e=null;for(var d=0;d<o;d++)(a=u[d])&&(e?(a.left.right=a.right,a.right.left=a.left,a.left=e,a.right=e.right,e.right=a,a.right.left=a,t(a.key,e.key)&&(e=a)):e=a);return e}(i=e.right,this._size),this._size--,this._minimum=i,e},i.prototype.remove=function(e){this._minimum=function(e,n,r){n.key=-1;var i=n.parent;return i&&t(n.key,i.key)&&(a(e,n,i),o(e,i)),t(n.key,e.key)&&(e=n),e}(this._minimum,e),this.extractMinimum()};var s=function(e,t){e.left.right=e.right,e.right.left=e.left,e.parent=t,t.child?(e.left=t.child,e.right=t.child.right,t.child.right=e,e.right.left=e):(t.child=e,e.right=e,e.left=e),t.degree++,e.mark=!1};return i}),{isClass:!0}),gf=be("fix",["typed","Complex","matrix","ceil","floor"],(e=>{var{typed:t,Complex:n,matrix:r,ceil:i,floor:a}=e,o=js({typed:t});return t("fix",{number:function(e){return e>0?a(e):i(e)},"number, number | BigNumber":function(e,t){return e>0?a(e,t):i(e,t)},Complex:function(e){return new n(e.re>0?Math.floor(e.re):Math.ceil(e.re),e.im>0?Math.floor(e.im):Math.ceil(e.im))},"Complex, number | BigNumber":function(e,t){return new n(e.re>0?a(e.re,t):i(e.re,t),e.im>0?a(e.im,t):i(e.im,t))},BigNumber:function(e){return e.isNegative()?i(e):a(e)},"BigNumber, number | BigNumber":function(e,t){return e.isNegative()?i(e,t):a(e,t)},Fraction:function(e){return e.s<0?e.ceil():e.floor()},"Fraction, number | BigNumber":function(e,t){return e.s<0?e.ceil(t):e.floor(t)},"Array | Matrix":function(e){return _r(e,this,!0)},"Array | Matrix, number | BigNumber":function(e,t){return _r(e,(e=>this(e,t)),!0)},"number | Complex | BigNumber, Array":function(e,t){return o(r(t),e,this,!0).valueOf()}})}));function vf(e){var t;if(Se(e))return e<=0?isFinite(e)?1/0:NaN:e>171?1/0:sa(1,e-1);if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*vf(1-e));if(e>=171.35)return 1/0;if(e>85){var n=e*e,r=n*e,i=r*e,a=i*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*n)-139/(51840*r)-571/(2488320*i)+163879/(209018880*a)+5246819/(75246796800*a*e))}--e,t=bf[0];for(var o=1;o<bf.length;++o)t+=bf[o]/(e+o);var s=e+yf+.5;return Math.sqrt(2*Math.PI)*Math.pow(s,e+.5)*Math.exp(-s)*t}vf.signature="number";var yf=4.7421875,bf=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22],xf="gamma",wf=be(xf,["typed","config","multiplyScalar","pow","BigNumber","Complex"],(e=>{var{typed:t,config:n,multiplyScalar:r,pow:i,BigNumber:a,Complex:o}=e;return t(xf,{number:vf,Complex:function(e){if(0===e.im)return this(e.re);if(e.re<.5){var t=new o(1-e.re,-e.im),n=new o(Math.PI*e.re,Math.PI*e.im);return new o(Math.PI).div(n.sin()).div(this(t))}e=new o(e.re-1,e.im);for(var r=new o(bf[0],0),i=1;i<bf.length;++i){var a=new o(bf[i],0);r=r.add(a.div(e.add(i)))}var s=new o(e.re+yf+.5,e.im),u=Math.sqrt(2*Math.PI),c=s.pow(e.add(.5)),l=s.neg().exp();return r.mul(u).mul(c).mul(l)},BigNumber:function(e){if(e.isInteger())return e.isNegative()||e.isZero()?new a(1/0):s(e.minus(1));if(!e.isFinite())return new a(e.isNegative()?NaN:1/0);throw new Error("Integer BigNumber expected")},"Array | Matrix":function(e){return _r(e,this)}});function s(e){if(e<8)return new a([1,1,2,6,24,120,720,5040][e]);var t=n.precision+(0|Math.log(e.toNumber())),r=a.clone({precision:t});if(e%2==1)return e.times(s(new a(e-1)));for(var i=e,o=new r(e),u=e.toNumber();i>2;)u+=i-=2,o=o.times(u);return new a(o.toPrecision(a.precision))}})),Ef="index",Cf=be(Ef,["typed","Index"],(e=>{var{typed:t,Index:n}=e;return t(Ef,{"...number | string | BigNumber | Range | Array | Matrix":function(e){var t=e.map((function(e){return b(e)?e.toNumber():Array.isArray(e)||N(e)?e.map((function(e){return b(e)?e.toNumber():e})):e})),r=new n;return n.apply(r,t),r}})})),Sf=be("lcm",["typed","matrix","equalScalar"],(e=>{var{typed:t,matrix:n,equalScalar:r}=e,i=Fs({typed:t,equalScalar:r}),a=Ws({typed:t,equalScalar:r}),o=zs({typed:t,equalScalar:r}),s=Ls({typed:t}),u=js({typed:t});return t("lcm",{"number, number":Hr,"BigNumber, BigNumber":function(e,t){if(!e.isInt()||!t.isInt())throw new Error("Parameters in function lcm must be integer numbers");if(e.isZero())return e;if(t.isZero())return t;for(var n=e.times(t);!t.isZero();){var r=t;t=e.mod(r),e=r}return n.div(e).abs()},"Fraction, Fraction":function(e,t){return e.lcm(t)},"SparseMatrix, SparseMatrix":function(e,t){return a(e,t,this)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,this,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,this,!1)},"DenseMatrix, DenseMatrix":function(e,t){return s(e,t,this)},"Array, Array":function(e,t){return this(n(e),n(t)).valueOf()},"Array, Matrix":function(e,t){return this(n(e),t)},"Matrix, Array":function(e,t){return this(e,n(t))},"SparseMatrix, number | BigNumber":function(e,t){return o(e,t,this,!1)},"DenseMatrix, number | BigNumber":function(e,t){return u(e,t,this,!1)},"number | BigNumber, SparseMatrix":function(e,t){return o(t,e,this,!0)},"number | BigNumber, DenseMatrix":function(e,t){return u(t,e,this,!0)},"Array, number | BigNumber":function(e,t){return u(n(e),t,this,!1).valueOf()},"number | BigNumber, Array":function(e,t){return u(n(t),e,this,!0).valueOf()},"Array | Matrix | number | BigNumber, Array | Matrix | number | BigNumber, ...Array | Matrix | number | BigNumber":function(e,t,n){for(var r=this(e,t),i=0;i<n.length;i++)r=this(r,n[i]);return r}})})),Nf=be("max",["typed","config","numeric","larger"],(e=>{var{typed:t,config:n,numeric:r,larger:i}=e;return t("max",{"Array | Matrix":o,"Array | Matrix, number | BigNumber":function(e,t){return Mr(e,t.valueOf(),a)},"...":function(e){if(kr(e))throw new TypeError("Scalar values expected in function max");return o(e)}});function a(e,t){try{return i(e,t)?e:t}catch(e){throw Js(e,"max",t)}}function o(e){var t;if(Dr(e,(function(e){try{isNaN(e)&&"number"==typeof e?t=NaN:(void 0===t||i(e,t))&&(t=e)}catch(t){throw Js(t,"max",e)}})),void 0===t)throw new Error("Cannot calculate max of an empty array");return"string"==typeof t&&(t=r(t,n.number)),t}})),Af=be("quantileSeq",["typed","add","multiply","partitionSelect","compare"],(e=>{var{typed:t,add:n,multiply:r,partitionSelect:i,compare:a}=e;function o(e,t,o){var u=Jn(e),c=u.length;if(0===c)throw new Error("Cannot calculate quantile of an empty sequence");if(y(t)){var l=t*(c-1),f=l%1;if(0===f){var p=o?u[l]:i(u,l);return s(p),p}var h,d,m=Math.floor(l);if(o)h=u[m],d=u[m+1];else{d=i(u,m+1),h=u[m];for(var g=0;g<m;++g)a(u[g],h)>0&&(h=u[g])}return s(h),s(d),n(r(h,1-f),r(d,f))}var v=t.times(c-1);if(v.isInteger()){v=v.toNumber();var b=o?u[v]:i(u,v);return s(b),b}var x,w,E=v.floor(),C=v.minus(E),S=E.toNumber();if(o)x=u[S],w=u[S+1];else{w=i(u,S+1),x=u[S];for(var N=0;N<S;++N)a(u[N],x)>0&&(x=u[N])}s(x),s(w);var A=new C.constructor(1);return n(r(x,A.minus(C)),r(w,C))}var s=t({"number | BigNumber | Unit":function(e){return e}});return function(e,t,n){var r,i,a;if(arguments.length<2||arguments.length>3)throw new SyntaxError("Function quantileSeq requires two or three parameters");if(A(e)){if("boolean"==typeof(n=n||!1)){if(i=e.valueOf(),y(t)){if(t<0)throw new Error("N/prob must be non-negative");if(t<=1)return o(i,t,n);if(t>1){if(!Se(t))throw new Error("N must be a positive integer");var s=t+1;r=new Array(t);for(var u=0;u<t;)r[u]=o(i,++u/s,n);return r}}if(b(t)){var c=t.constructor;if(t.isNegative())throw new Error("N/prob must be non-negative");if(a=new c(1),t.lte(a))return new c(o(i,t,n));if(t.gt(a)){if(!t.isInteger())throw new Error("N must be a positive integer");var l=t.toNumber();if(l>4294967295)throw new Error("N must be less than or equal to 2^32-1, as that is the maximum length of an Array");var f=new c(l+1);r=new Array(l);for(var p=0;p<l;)r[p]=new c(o(i,new c(++p).div(f),n));return r}}if(Array.isArray(t)){r=new Array(t.length);for(var h=0;h<r.length;++h){var d=t[h];if(y(d)){if(d<0||d>1)throw new Error("Probability must be between 0 and 1, inclusive")}else{if(!b(d))throw new TypeError("Unexpected type of argument in function quantileSeq");if(a=new d.constructor(1),d.isNegative()||d.gt(a))throw new Error("Probability must be between 0 and 1, inclusive")}r[h]=o(i,d,n)}return r}throw new TypeError("Unexpected type of argument in function quantileSeq")}throw new TypeError("Unexpected type of argument in function quantileSeq")}throw new TypeError("Unexpected type of argument in function quantileSeq")}})),kf="setDifference",Df=be(kf,["typed","size","subset","compareNatural","Index","DenseMatrix"],(e=>{var{typed:t,size:n,subset:r,compareNatural:i,Index:a,DenseMatrix:o}=e;return t(kf,{"Array | Matrix, Array | Matrix":function(e,t){var s;if(0===r(n(e),new a(0)))s=[];else{if(0===r(n(t),new a(0)))return Jn(e.toArray());var u,c=rr(Jn(Array.isArray(e)?e:e.toArray()).sort(i)),l=rr(Jn(Array.isArray(t)?t:t.toArray()).sort(i));s=[];for(var f=0;f<c.length;f++){u=!1;for(var p=0;p<l.length;p++)if(0===i(c[f].value,l[p].value)&&c[f].identifier===l[p].identifier){u=!0;break}u||s.push(c[f])}}return Array.isArray(e)&&Array.isArray(t)?ir(s):new o(ir(s))}})})),_f="setMultiplicity",Mf=be(_f,["typed","size","subset","compareNatural","Index"],(e=>{var{typed:t,size:n,subset:r,compareNatural:i,Index:a}=e;return t(_f,{"number | BigNumber | Fraction | Complex, Array | Matrix":function(e,t){if(0===r(n(t),new a(0)))return 0;for(var o=Jn(Array.isArray(t)?t:t.toArray()),s=0,u=0;u<o.length;u++)0===i(o[u],e)&&s++;return s}})})),Tf="setSymDifference",Of=be(Tf,["typed","size","concat","subset","setDifference","Index"],(e=>{var{typed:t,size:n,concat:r,subset:i,setDifference:a,Index:o}=e;return t(Tf,{"Array | Matrix, Array | Matrix":function(e,t){if(0===i(n(e),new o(0)))return Jn(t);if(0===i(n(t),new o(0)))return Jn(e);var s=Jn(e),u=Jn(t);return r(a(s,u),a(u,s))}})})),If="sort",Ff=be(If,["typed","matrix","compare","compareNatural"],(e=>{var{typed:t,matrix:n,compare:r,compareNatural:i}=e,a=r,o=(e,t)=>-r(e,t);return t(If,{Array:function(e){return u(e),e.sort(a)},Matrix:function(e){return c(e),n(e.toArray().sort(a),e.storage())},"Array, function":function(e,t){return u(e),e.sort(t)},"Matrix, function":function(e,t){return c(e),n(e.toArray().sort(t),e.storage())},"Array, string":function(e,t){return u(e),e.sort(s(t))},"Matrix, string":function(e,t){return c(e),n(e.toArray().sort(s(t)),e.storage())}});function s(e){if("asc"===e)return a;if("desc"===e)return o;if("natural"===e)return i;throw new Error('String "asc", "desc", or "natural" expected')}function u(e){if(1!==Pn(e).length)throw new Error("One dimensional array expected")}function c(e){if(1!==e.size().length)throw new Error("One dimensional matrix expected")}}));function Rf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rf(Object(n),!0).forEach((function(t){Tc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zf=be("Unit",["?on","config","addScalar","subtract","multiplyScalar","divideScalar","pow","abs","fix","round","equal","isNumeric","format","number","Complex","BigNumber","Fraction"],(e=>{var t,n,r,{on:i,config:a,addScalar:o,subtract:s,multiplyScalar:u,divideScalar:c,pow:l,abs:f,fix:p,round:h,equal:d,isNumeric:m,format:v,number:y,Complex:b,BigNumber:w,Fraction:C}=e,S=y;function N(e,t){if(!(this instanceof N))throw new Error("Constructor must be called with the new operator");if(null!=e&&!m(e)&&!x(e))throw new TypeError("First parameter in Unit constructor must be number, BigNumber, Fraction, Complex, or undefined");if(void 0!==t&&("string"!=typeof t||""===t))throw new TypeError("Second parameter in Unit constructor must be a string");if(void 0!==t){var n=N.parse(t);this.units=n.units,this.dimensions=n.dimensions}else{this.units=[{unit:L,prefix:R.NONE,power:0}],this.dimensions=[];for(var r=0;r<B.length;r++)this.dimensions[r]=0}this.value=null!=e?this._normalize(e):null,this.fixPrefix=!1,this.skipAutomaticSimplification=!0}function A(){for(;" "===r||"\t"===r;)D()}function k(e){return e>="0"&&e<="9"}function D(){n++,r=t.charAt(n)}function _(e){n=e,r=t.charAt(n)}function M(){var e="",t=n;if("+"===r?D():"-"===r&&(e+=r,D()),!function(e){return e>="0"&&e<="9"||"."===e}(r))return _(t),null;if("."===r){if(e+=r,D(),!k(r))return _(t),null}else{for(;k(r);)e+=r,D();"."===r&&(e+=r,D())}for(;k(r);)e+=r,D();if("E"===r||"e"===r){var i="",a=n;if(i+=r,D(),"+"!==r&&"-"!==r||(i+=r,D()),!k(r))return _(a),e;for(e+=i;k(r);)e+=r,D()}return e}function T(){for(var e="";k(r)||N.isValidAlpha(r);)e+=r,D();var t=e.charAt(0);return N.isValidAlpha(t)?e:null}function O(e){return r===e?(D(),e):null}N.prototype.type="Unit",N.prototype.isUnit=!0,N.parse=function(e,i){if(i=i||{},n=-1,r="","string"!=typeof(t=e))throw new TypeError("Invalid argument in Unit.parse, string expected");var o=new N;o.units=[];var s=1,u=!1;D(),A();var c=M(),l=null;if(c){if("BigNumber"===a.number)l=new w(c);else if("Fraction"===a.number)try{l=new C(c)}catch(e){l=parseFloat(c)}else l=parseFloat(c);A(),O("*")?(s=1,u=!0):O("/")&&(s=-1,u=!0)}for(var f=[],p=1;;){for(A();"("===r;)f.push(s),p*=s,s=1,D(),A();var h;if(!r)break;var d=r;if(null===(h=T()))throw new SyntaxError('Unexpected "'+d+'" in "'+t+'" at index '+n.toString());var m=I(h);if(null===m)throw new SyntaxError('Unit "'+h+'" not found.');var g=s*p;if(A(),O("^")){A();var v=M();if(null===v)throw new SyntaxError('In "'+e+'", "^" must be followed by a floating-point number');g*=v}o.units.push({unit:m.unit,prefix:m.prefix,power:g});for(var y=0;y<B.length;y++)o.dimensions[y]+=(m.unit.dimensions[y]||0)*g;for(A();")"===r;){if(0===f.length)throw new SyntaxError('Unmatched ")" in "'+t+'" at index '+n.toString());p/=f.pop(),D(),A()}if(u=!1,O("*")?(s=1,u=!0):O("/")?(s=-1,u=!0):s=1,m.unit.base){var b=m.unit.base.key;W.auto[b]={unit:m.unit,prefix:m.prefix}}}if(A(),r)throw new SyntaxError('Could not parse: "'+e+'"');if(u)throw new SyntaxError('Trailing characters: "'+e+'"');if(0!==f.length)throw new SyntaxError('Unmatched "(" in "'+t+'"');if(0===o.units.length&&!i.allowNoUnits)throw new SyntaxError('"'+e+'" contains no units');return o.value=void 0!==l?o._normalize(l):null,o},N.prototype.clone=function(){var e=new N;e.fixPrefix=this.fixPrefix,e.skipAutomaticSimplification=this.skipAutomaticSimplification,e.value=re(this.value),e.dimensions=this.dimensions.slice(0),e.units=[];for(var t=0;t<this.units.length;t++)for(var n in e.units[t]={},this.units[t])fe(this.units[t],n)&&(e.units[t][n]=this.units[t][n]);return e},N.prototype._isDerived=function(){return 0!==this.units.length&&(this.units.length>1||Math.abs(this.units[0].power-1)>1e-15)},N.prototype._normalize=function(e){var t,n,r,i,a;if(null==e||0===this.units.length)return e;if(this._isDerived()){var s=e;a=N._getNumberConverter(ne(e));for(var c=0;c<this.units.length;c++)t=a(this.units[c].unit.value),i=a(this.units[c].prefix.value),r=a(this.units[c].power),s=u(s,l(u(t,i),r));return s}return t=(a=N._getNumberConverter(ne(e)))(this.units[0].unit.value),n=a(this.units[0].unit.offset),i=a(this.units[0].prefix.value),u(o(e,n),u(t,i))},N.prototype._denormalize=function(e,t){var n,r,i,a,o;if(null==e||0===this.units.length)return e;if(this._isDerived()){var f=e;o=N._getNumberConverter(ne(e));for(var p=0;p<this.units.length;p++)n=o(this.units[p].unit.value),a=o(this.units[p].prefix.value),i=o(this.units[p].power),f=c(f,l(u(n,a),i));return f}return n=(o=N._getNumberConverter(ne(e)))(this.units[0].unit.value),a=o(this.units[0].prefix.value),r=o(this.units[0].unit.offset),s(c(c(e,n),null==t?a:t),r)};var I=Ke((e=>{if(fe(j,e)){var t=j[e];return{unit:t,prefix:t.prefixes[""]}}for(var n in j)if(fe(j,n)&&Mn(e,n)){var r=j[n],i=e.length-n.length,a=e.substring(0,i),o=fe(r.prefixes,a)?r.prefixes[a]:void 0;if(void 0!==o)return{unit:r,prefix:o}}return null}),{hasher:e=>e[0],limit:100});function F(e){return e.equalBase(z.NONE)&&null!==e.value&&!a.predictable?e.value:e}N.isValuelessUnit=function(e){return null!==I(e)},N.prototype.hasBase=function(e){if("string"==typeof e&&(e=z[e]),!e)return!1;for(var t=0;t<B.length;t++)if(Math.abs((this.dimensions[t]||0)-(e.dimensions[t]||0))>1e-12)return!1;return!0},N.prototype.equalBase=function(e){for(var t=0;t<B.length;t++)if(Math.abs((this.dimensions[t]||0)-(e.dimensions[t]||0))>1e-12)return!1;return!0},N.prototype.equals=function(e){return this.equalBase(e)&&d(this.value,e.value)},N.prototype.multiply=function(e){for(var t=this.clone(),n=0;n<B.length;n++)t.dimensions[n]=(this.dimensions[n]||0)+(e.dimensions[n]||0);for(var r=0;r<e.units.length;r++){var i=Bf({},e.units[r]);t.units.push(i)}if(null!==this.value||null!==e.value){var a=null===this.value?this._normalize(1):this.value,o=null===e.value?e._normalize(1):e.value;t.value=u(a,o)}else t.value=null;return t.skipAutomaticSimplification=!1,F(t)},N.prototype.divide=function(e){for(var t=this.clone(),n=0;n<B.length;n++)t.dimensions[n]=(this.dimensions[n]||0)-(e.dimensions[n]||0);for(var r=0;r<e.units.length;r++){var i=Bf(Bf({},e.units[r]),{},{power:-e.units[r].power});t.units.push(i)}if(null!==this.value||null!==e.value){var a=null===this.value?this._normalize(1):this.value,o=null===e.value?e._normalize(1):e.value;t.value=c(a,o)}else t.value=null;return t.skipAutomaticSimplification=!1,F(t)},N.prototype.pow=function(e){for(var t=this.clone(),n=0;n<B.length;n++)t.dimensions[n]=(this.dimensions[n]||0)*e;for(var r=0;r<t.units.length;r++)t.units[r].power*=e;return null!==t.value?t.value=l(t.value,e):t.value=null,t.skipAutomaticSimplification=!1,F(t)},N.prototype.abs=function(){var e=this.clone();for(var t in e.value=null!==e.value?f(e.value):null,e.units)"VA"!==e.units[t].unit.name&&"VAR"!==e.units[t].unit.name||(e.units[t].unit=j.W);return e},N.prototype.to=function(e){var t,n=null===this.value?this._normalize(1):this.value;if("string"==typeof e){if(t=N.parse(e),!this.equalBase(t))throw new Error("Units do not match ('".concat(t.toString(),"' != '").concat(this.toString(),"')"));if(null!==t.value)throw new Error("Cannot convert to a unit with a value");return t.value=re(n),t.fixPrefix=!0,t.skipAutomaticSimplification=!0,t}if(E(e)){if(!this.equalBase(e))throw new Error("Units do not match ('".concat(e.toString(),"' != '").concat(this.toString(),"')"));if(null!==e.value)throw new Error("Cannot convert to a unit with a value");return(t=e.clone()).value=re(n),t.fixPrefix=!0,t.skipAutomaticSimplification=!0,t}throw new Error("String or Unit expected as parameter")},N.prototype.toNumber=function(e){return S(this.toNumeric(e))},N.prototype.toNumeric=function(e){var t;return(t=e?this.to(e):this.clone())._isDerived()||0===t.units.length?t._denormalize(t.value):t._denormalize(t.value,t.units[0].prefix.value)},N.prototype.toString=function(){return this.format()},N.prototype.toJSON=function(){return{mathjs:"Unit",value:this._denormalize(this.value),unit:this.formatUnits(),fixPrefix:this.fixPrefix}},N.fromJSON=function(e){var t=new N(e.value,e.unit);return t.fixPrefix=e.fixPrefix||!1,t},N.prototype.valueOf=N.prototype.toString,N.prototype.simplify=function(){var e,t,n=this.clone(),r=[];for(var i in V)if(fe(V,i)&&n.hasBase(z[i])){e=i;break}if("NONE"===e)n.units=[];else if(e&&fe(V,e)&&(t=V[e]),t)n.units=[{unit:t.unit,prefix:t.prefix,power:1}];else{for(var a=!1,o=0;o<B.length;o++){var s=B[o];Math.abs(n.dimensions[o]||0)>1e-12&&(fe(V,s)?r.push({unit:V[s].unit,prefix:V[s].prefix,power:n.dimensions[o]||0}):a=!0)}r.length<n.units.length&&!a&&(n.units=r)}return n},N.prototype.toSI=function(){for(var e=this.clone(),t=[],n=0;n<B.length;n++){var r=B[n];if(Math.abs(e.dimensions[n]||0)>1e-12){if(!fe(W.si,r))throw new Error("Cannot express custom unit "+r+" in SI units");t.push({unit:W.si[r].unit,prefix:W.si[r].prefix,power:e.dimensions[n]||0})}}return e.units=t,e.fixPrefix=!0,e.skipAutomaticSimplification=!0,e},N.prototype.formatUnits=function(){for(var e="",t="",n=0,r=0,i=0;i<this.units.length;i++)this.units[i].power>0?(n++,e+=" "+this.units[i].prefix.name+this.units[i].unit.name,Math.abs(this.units[i].power-1)>1e-15&&(e+="^"+this.units[i].power)):this.units[i].power<0&&r++;if(r>0)for(var a=0;a<this.units.length;a++)this.units[a].power<0&&(n>0?(t+=" "+this.units[a].prefix.name+this.units[a].unit.name,Math.abs(this.units[a].power+1)>1e-15&&(t+="^"+-this.units[a].power)):(t+=" "+this.units[a].prefix.name+this.units[a].unit.name,t+="^"+this.units[a].power));e=e.substr(1),t=t.substr(1),n>1&&r>0&&(e="("+e+")"),r>1&&n>0&&(t="("+t+")");var o=e;return n>0&&r>0&&(o+=" / "),o+t},N.prototype.format=function(e){var t=this.skipAutomaticSimplification||null===this.value?this.clone():this.simplify(),n=!1;for(var r in void 0!==t.value&&null!==t.value&&x(t.value)&&(n=Math.abs(t.value.re)<1e-14),t.units)fe(t.units,r)&&t.units[r].unit&&("VA"===t.units[r].unit.name&&n?t.units[r].unit=j.VAR:"VAR"!==t.units[r].unit.name||n||(t.units[r].unit=j.VA));1!==t.units.length||t.fixPrefix||Math.abs(t.units[0].power-Math.round(t.units[0].power))<1e-14&&(t.units[0].prefix=t._bestPrefix());var i=t._denormalize(t.value),a=null!==t.value?v(i,e||{}):"",o=t.formatUnits();return t.value&&x(t.value)&&(a="("+a+")"),o.length>0&&a.length>0&&(a+=" "),a+o},N.prototype._bestPrefix=function(){if(1!==this.units.length)throw new Error("Can only compute the best prefix for single units with integer powers, like kg, s^2, N^-1, and so forth!");if(Math.abs(this.units[0].power-Math.round(this.units[0].power))>=1e-14)throw new Error("Can only compute the best prefix for single units with integer powers, like kg, s^2, N^-1, and so forth!");var e=null!==this.value?f(this.value):0,t=f(this.units[0].unit.value),n=this.units[0].prefix;if(0===e)return n;var r=this.units[0].power,i=Math.log(e/Math.pow(n.value*t,r))/Math.LN10-1.2;if(i>-2.200001&&i<1.800001)return n;i=Math.abs(i);var a=this.units[0].unit.prefixes;for(var o in a)if(fe(a,o)){var s=a[o];if(s.scientific){var u=Math.abs(Math.log(e/Math.pow(s.value*t,r))/Math.LN10-1.2);(u<i||u===i&&s.name.length<n.name.length)&&(n=s,i=u)}}return n},N.prototype.splitUnit=function(e){for(var t=this.clone(),n=[],r=0;r<e.length&&(t=t.to(e[r]),r!==e.length-1);r++){var i=t.toNumeric(),a=h(i),u=new N(d(a,i)?a:p(t.toNumeric()),e[r].toString());n.push(u),t=s(t,u)}for(var c=0,l=0;l<n.length;l++)c=o(c,n[l].value);return d(c,this.value)&&(t.value=0),n.push(t),n};var R={NONE:{"":{name:"",value:1,scientific:!0}},SHORT:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:10,scientific:!1},h:{name:"h",value:100,scientific:!1},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0},d:{name:"d",value:.1,scientific:!1},c:{name:"c",value:.01,scientific:!1},m:{name:"m",value:.001,scientific:!0},u:{name:"u",value:1e-6,scientific:!0},n:{name:"n",value:1e-9,scientific:!0},p:{name:"p",value:1e-12,scientific:!0},f:{name:"f",value:1e-15,scientific:!0},a:{name:"a",value:1e-18,scientific:!0},z:{name:"z",value:1e-21,scientific:!0},y:{name:"y",value:1e-24,scientific:!0}},LONG:{"":{name:"",value:1,scientific:!0},deca:{name:"deca",value:10,scientific:!1},hecto:{name:"hecto",value:100,scientific:!1},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0},deci:{name:"deci",value:.1,scientific:!1},centi:{name:"centi",value:.01,scientific:!1},milli:{name:"milli",value:.001,scientific:!0},micro:{name:"micro",value:1e-6,scientific:!0},nano:{name:"nano",value:1e-9,scientific:!0},pico:{name:"pico",value:1e-12,scientific:!0},femto:{name:"femto",value:1e-15,scientific:!0},atto:{name:"atto",value:1e-18,scientific:!0},zepto:{name:"zepto",value:1e-21,scientific:!0},yocto:{name:"yocto",value:1e-24,scientific:!0}},SQUARED:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:100,scientific:!1},h:{name:"h",value:1e4,scientific:!1},k:{name:"k",value:1e6,scientific:!0},M:{name:"M",value:1e12,scientific:!0},G:{name:"G",value:1e18,scientific:!0},T:{name:"T",value:1e24,scientific:!0},P:{name:"P",value:1e30,scientific:!0},E:{name:"E",value:1e36,scientific:!0},Z:{name:"Z",value:1e42,scientific:!0},Y:{name:"Y",value:1e48,scientific:!0},d:{name:"d",value:.01,scientific:!1},c:{name:"c",value:1e-4,scientific:!1},m:{name:"m",value:1e-6,scientific:!0},u:{name:"u",value:1e-12,scientific:!0},n:{name:"n",value:1e-18,scientific:!0},p:{name:"p",value:1e-24,scientific:!0},f:{name:"f",value:1e-30,scientific:!0},a:{name:"a",value:1e-36,scientific:!0},z:{name:"z",value:1e-42,scientific:!0},y:{name:"y",value:1e-48,scientific:!0}},CUBIC:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:1e3,scientific:!1},h:{name:"h",value:1e6,scientific:!1},k:{name:"k",value:1e9,scientific:!0},M:{name:"M",value:1e18,scientific:!0},G:{name:"G",value:1e27,scientific:!0},T:{name:"T",value:1e36,scientific:!0},P:{name:"P",value:1e45,scientific:!0},E:{name:"E",value:1e54,scientific:!0},Z:{name:"Z",value:1e63,scientific:!0},Y:{name:"Y",value:1e72,scientific:!0},d:{name:"d",value:.001,scientific:!1},c:{name:"c",value:1e-6,scientific:!1},m:{name:"m",value:1e-9,scientific:!0},u:{name:"u",value:1e-18,scientific:!0},n:{name:"n",value:1e-27,scientific:!0},p:{name:"p",value:1e-36,scientific:!0},f:{name:"f",value:1e-45,scientific:!0},a:{name:"a",value:1e-54,scientific:!0},z:{name:"z",value:1e-63,scientific:!0},y:{name:"y",value:1e-72,scientific:!0}},BINARY_SHORT_SI:{"":{name:"",value:1,scientific:!0},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0}},BINARY_SHORT_IEC:{"":{name:"",value:1,scientific:!0},Ki:{name:"Ki",value:1024,scientific:!0},Mi:{name:"Mi",value:Math.pow(1024,2),scientific:!0},Gi:{name:"Gi",value:Math.pow(1024,3),scientific:!0},Ti:{name:"Ti",value:Math.pow(1024,4),scientific:!0},Pi:{name:"Pi",value:Math.pow(1024,5),scientific:!0},Ei:{name:"Ei",value:Math.pow(1024,6),scientific:!0},Zi:{name:"Zi",value:Math.pow(1024,7),scientific:!0},Yi:{name:"Yi",value:Math.pow(1024,8),scientific:!0}},BINARY_LONG_SI:{"":{name:"",value:1,scientific:!0},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0}},BINARY_LONG_IEC:{"":{name:"",value:1,scientific:!0},kibi:{name:"kibi",value:1024,scientific:!0},mebi:{name:"mebi",value:Math.pow(1024,2),scientific:!0},gibi:{name:"gibi",value:Math.pow(1024,3),scientific:!0},tebi:{name:"tebi",value:Math.pow(1024,4),scientific:!0},pebi:{name:"pebi",value:Math.pow(1024,5),scientific:!0},exi:{name:"exi",value:Math.pow(1024,6),scientific:!0},zebi:{name:"zebi",value:Math.pow(1024,7),scientific:!0},yobi:{name:"yobi",value:Math.pow(1024,8),scientific:!0}},BTU:{"":{name:"",value:1,scientific:!0},MM:{name:"MM",value:1e6,scientific:!0}}};R.SHORTLONG=g({},R.SHORT,R.LONG),R.BINARY_SHORT=g({},R.BINARY_SHORT_SI,R.BINARY_SHORT_IEC),R.BINARY_LONG=g({},R.BINARY_LONG_SI,R.BINARY_LONG_IEC);var B=["MASS","LENGTH","TIME","CURRENT","TEMPERATURE","LUMINOUS_INTENSITY","AMOUNT_OF_SUBSTANCE","ANGLE","BIT"],z={NONE:{dimensions:[0,0,0,0,0,0,0,0,0]},MASS:{dimensions:[1,0,0,0,0,0,0,0,0]},LENGTH:{dimensions:[0,1,0,0,0,0,0,0,0]},TIME:{dimensions:[0,0,1,0,0,0,0,0,0]},CURRENT:{dimensions:[0,0,0,1,0,0,0,0,0]},TEMPERATURE:{dimensions:[0,0,0,0,1,0,0,0,0]},LUMINOUS_INTENSITY:{dimensions:[0,0,0,0,0,1,0,0,0]},AMOUNT_OF_SUBSTANCE:{dimensions:[0,0,0,0,0,0,1,0,0]},FORCE:{dimensions:[1,1,-2,0,0,0,0,0,0]},SURFACE:{dimensions:[0,2,0,0,0,0,0,0,0]},VOLUME:{dimensions:[0,3,0,0,0,0,0,0,0]},ENERGY:{dimensions:[1,2,-2,0,0,0,0,0,0]},POWER:{dimensions:[1,2,-3,0,0,0,0,0,0]},PRESSURE:{dimensions:[1,-1,-2,0,0,0,0,0,0]},ELECTRIC_CHARGE:{dimensions:[0,0,1,1,0,0,0,0,0]},ELECTRIC_CAPACITANCE:{dimensions:[-1,-2,4,2,0,0,0,0,0]},ELECTRIC_POTENTIAL:{dimensions:[1,2,-3,-1,0,0,0,0,0]},ELECTRIC_RESISTANCE:{dimensions:[1,2,-3,-2,0,0,0,0,0]},ELECTRIC_INDUCTANCE:{dimensions:[1,2,-2,-2,0,0,0,0,0]},ELECTRIC_CONDUCTANCE:{dimensions:[-1,-2,3,2,0,0,0,0,0]},MAGNETIC_FLUX:{dimensions:[1,2,-2,-1,0,0,0,0,0]},MAGNETIC_FLUX_DENSITY:{dimensions:[1,0,-2,-1,0,0,0,0,0]},FREQUENCY:{dimensions:[0,0,-1,0,0,0,0,0,0]},ANGLE:{dimensions:[0,0,0,0,0,0,0,1,0]},BIT:{dimensions:[0,0,0,0,0,0,0,0,1]}};for(var P in z)fe(z,P)&&(z[P].key=P);var L={name:"",base:{},value:1,offset:0,dimensions:B.map((e=>0))},j={meter:{name:"meter",base:z.LENGTH,prefixes:R.LONG,value:1,offset:0},inch:{name:"inch",base:z.LENGTH,prefixes:R.NONE,value:.0254,offset:0},foot:{name:"foot",base:z.LENGTH,prefixes:R.NONE,value:.3048,offset:0},yard:{name:"yard",base:z.LENGTH,prefixes:R.NONE,value:.9144,offset:0},mile:{name:"mile",base:z.LENGTH,prefixes:R.NONE,value:1609.344,offset:0},link:{name:"link",base:z.LENGTH,prefixes:R.NONE,value:.201168,offset:0},rod:{name:"rod",base:z.LENGTH,prefixes:R.NONE,value:5.0292,offset:0},chain:{name:"chain",base:z.LENGTH,prefixes:R.NONE,value:20.1168,offset:0},angstrom:{name:"angstrom",base:z.LENGTH,prefixes:R.NONE,value:1e-10,offset:0},m:{name:"m",base:z.LENGTH,prefixes:R.SHORT,value:1,offset:0},in:{name:"in",base:z.LENGTH,prefixes:R.NONE,value:.0254,offset:0},ft:{name:"ft",base:z.LENGTH,prefixes:R.NONE,value:.3048,offset:0},yd:{name:"yd",base:z.LENGTH,prefixes:R.NONE,value:.9144,offset:0},mi:{name:"mi",base:z.LENGTH,prefixes:R.NONE,value:1609.344,offset:0},li:{name:"li",base:z.LENGTH,prefixes:R.NONE,value:.201168,offset:0},rd:{name:"rd",base:z.LENGTH,prefixes:R.NONE,value:5.02921,offset:0},ch:{name:"ch",base:z.LENGTH,prefixes:R.NONE,value:20.1168,offset:0},mil:{name:"mil",base:z.LENGTH,prefixes:R.NONE,value:254e-7,offset:0},m2:{name:"m2",base:z.SURFACE,prefixes:R.SQUARED,value:1,offset:0},sqin:{name:"sqin",base:z.SURFACE,prefixes:R.NONE,value:64516e-8,offset:0},sqft:{name:"sqft",base:z.SURFACE,prefixes:R.NONE,value:.09290304,offset:0},sqyd:{name:"sqyd",base:z.SURFACE,prefixes:R.NONE,value:.83612736,offset:0},sqmi:{name:"sqmi",base:z.SURFACE,prefixes:R.NONE,value:2589988.110336,offset:0},sqrd:{name:"sqrd",base:z.SURFACE,prefixes:R.NONE,value:25.29295,offset:0},sqch:{name:"sqch",base:z.SURFACE,prefixes:R.NONE,value:404.6873,offset:0},sqmil:{name:"sqmil",base:z.SURFACE,prefixes:R.NONE,value:6.4516e-10,offset:0},acre:{name:"acre",base:z.SURFACE,prefixes:R.NONE,value:4046.86,offset:0},hectare:{name:"hectare",base:z.SURFACE,prefixes:R.NONE,value:1e4,offset:0},m3:{name:"m3",base:z.VOLUME,prefixes:R.CUBIC,value:1,offset:0},L:{name:"L",base:z.VOLUME,prefixes:R.SHORT,value:.001,offset:0},l:{name:"l",base:z.VOLUME,prefixes:R.SHORT,value:.001,offset:0},litre:{name:"litre",base:z.VOLUME,prefixes:R.LONG,value:.001,offset:0},cuin:{name:"cuin",base:z.VOLUME,prefixes:R.NONE,value:16387064e-12,offset:0},cuft:{name:"cuft",base:z.VOLUME,prefixes:R.NONE,value:.028316846592,offset:0},cuyd:{name:"cuyd",base:z.VOLUME,prefixes:R.NONE,value:.764554857984,offset:0},teaspoon:{name:"teaspoon",base:z.VOLUME,prefixes:R.NONE,value:5e-6,offset:0},tablespoon:{name:"tablespoon",base:z.VOLUME,prefixes:R.NONE,value:15e-6,offset:0},drop:{name:"drop",base:z.VOLUME,prefixes:R.NONE,value:5e-8,offset:0},gtt:{name:"gtt",base:z.VOLUME,prefixes:R.NONE,value:5e-8,offset:0},minim:{name:"minim",base:z.VOLUME,prefixes:R.NONE,value:6.161152e-8,offset:0},fluiddram:{name:"fluiddram",base:z.VOLUME,prefixes:R.NONE,value:36966911e-13,offset:0},fluidounce:{name:"fluidounce",base:z.VOLUME,prefixes:R.NONE,value:2957353e-11,offset:0},gill:{name:"gill",base:z.VOLUME,prefixes:R.NONE,value:.0001182941,offset:0},cc:{name:"cc",base:z.VOLUME,prefixes:R.NONE,value:1e-6,offset:0},cup:{name:"cup",base:z.VOLUME,prefixes:R.NONE,value:.0002365882,offset:0},pint:{name:"pint",base:z.VOLUME,prefixes:R.NONE,value:.0004731765,offset:0},quart:{name:"quart",base:z.VOLUME,prefixes:R.NONE,value:.0009463529,offset:0},gallon:{name:"gallon",base:z.VOLUME,prefixes:R.NONE,value:.003785412,offset:0},beerbarrel:{name:"beerbarrel",base:z.VOLUME,prefixes:R.NONE,value:.1173478,offset:0},oilbarrel:{name:"oilbarrel",base:z.VOLUME,prefixes:R.NONE,value:.1589873,offset:0},hogshead:{name:"hogshead",base:z.VOLUME,prefixes:R.NONE,value:.238481,offset:0},fldr:{name:"fldr",base:z.VOLUME,prefixes:R.NONE,value:36966911e-13,offset:0},floz:{name:"floz",base:z.VOLUME,prefixes:R.NONE,value:2957353e-11,offset:0},gi:{name:"gi",base:z.VOLUME,prefixes:R.NONE,value:.0001182941,offset:0},cp:{name:"cp",base:z.VOLUME,prefixes:R.NONE,value:.0002365882,offset:0},pt:{name:"pt",base:z.VOLUME,prefixes:R.NONE,value:.0004731765,offset:0},qt:{name:"qt",base:z.VOLUME,prefixes:R.NONE,value:.0009463529,offset:0},gal:{name:"gal",base:z.VOLUME,prefixes:R.NONE,value:.003785412,offset:0},bbl:{name:"bbl",base:z.VOLUME,prefixes:R.NONE,value:.1173478,offset:0},obl:{name:"obl",base:z.VOLUME,prefixes:R.NONE,value:.1589873,offset:0},g:{name:"g",base:z.MASS,prefixes:R.SHORT,value:.001,offset:0},gram:{name:"gram",base:z.MASS,prefixes:R.LONG,value:.001,offset:0},ton:{name:"ton",base:z.MASS,prefixes:R.SHORT,value:907.18474,offset:0},t:{name:"t",base:z.MASS,prefixes:R.SHORT,value:1e3,offset:0},tonne:{name:"tonne",base:z.MASS,prefixes:R.LONG,value:1e3,offset:0},grain:{name:"grain",base:z.MASS,prefixes:R.NONE,value:6479891e-11,offset:0},dram:{name:"dram",base:z.MASS,prefixes:R.NONE,value:.0017718451953125,offset:0},ounce:{name:"ounce",base:z.MASS,prefixes:R.NONE,value:.028349523125,offset:0},poundmass:{name:"poundmass",base:z.MASS,prefixes:R.NONE,value:.45359237,offset:0},hundredweight:{name:"hundredweight",base:z.MASS,prefixes:R.NONE,value:45.359237,offset:0},stick:{name:"stick",base:z.MASS,prefixes:R.NONE,value:.115,offset:0},stone:{name:"stone",base:z.MASS,prefixes:R.NONE,value:6.35029318,offset:0},gr:{name:"gr",base:z.MASS,prefixes:R.NONE,value:6479891e-11,offset:0},dr:{name:"dr",base:z.MASS,prefixes:R.NONE,value:.0017718451953125,offset:0},oz:{name:"oz",base:z.MASS,prefixes:R.NONE,value:.028349523125,offset:0},lbm:{name:"lbm",base:z.MASS,prefixes:R.NONE,value:.45359237,offset:0},cwt:{name:"cwt",base:z.MASS,prefixes:R.NONE,value:45.359237,offset:0},s:{name:"s",base:z.TIME,prefixes:R.SHORT,value:1,offset:0},min:{name:"min",base:z.TIME,prefixes:R.NONE,value:60,offset:0},h:{name:"h",base:z.TIME,prefixes:R.NONE,value:3600,offset:0},second:{name:"second",base:z.TIME,prefixes:R.LONG,value:1,offset:0},sec:{name:"sec",base:z.TIME,prefixes:R.LONG,value:1,offset:0},minute:{name:"minute",base:z.TIME,prefixes:R.NONE,value:60,offset:0},hour:{name:"hour",base:z.TIME,prefixes:R.NONE,value:3600,offset:0},day:{name:"day",base:z.TIME,prefixes:R.NONE,value:86400,offset:0},week:{name:"week",base:z.TIME,prefixes:R.NONE,value:604800,offset:0},month:{name:"month",base:z.TIME,prefixes:R.NONE,value:2629800,offset:0},year:{name:"year",base:z.TIME,prefixes:R.NONE,value:31557600,offset:0},decade:{name:"decade",base:z.TIME,prefixes:R.NONE,value:315576e3,offset:0},century:{name:"century",base:z.TIME,prefixes:R.NONE,value:315576e4,offset:0},millennium:{name:"millennium",base:z.TIME,prefixes:R.NONE,value:315576e5,offset:0},hertz:{name:"Hertz",base:z.FREQUENCY,prefixes:R.LONG,value:1,offset:0,reciprocal:!0},Hz:{name:"Hz",base:z.FREQUENCY,prefixes:R.SHORT,value:1,offset:0,reciprocal:!0},rad:{name:"rad",base:z.ANGLE,prefixes:R.SHORT,value:1,offset:0},radian:{name:"radian",base:z.ANGLE,prefixes:R.LONG,value:1,offset:0},deg:{name:"deg",base:z.ANGLE,prefixes:R.SHORT,value:null,offset:0},degree:{name:"degree",base:z.ANGLE,prefixes:R.LONG,value:null,offset:0},grad:{name:"grad",base:z.ANGLE,prefixes:R.SHORT,value:null,offset:0},gradian:{name:"gradian",base:z.ANGLE,prefixes:R.LONG,value:null,offset:0},cycle:{name:"cycle",base:z.ANGLE,prefixes:R.NONE,value:null,offset:0},arcsec:{name:"arcsec",base:z.ANGLE,prefixes:R.NONE,value:null,offset:0},arcmin:{name:"arcmin",base:z.ANGLE,prefixes:R.NONE,value:null,offset:0},A:{name:"A",base:z.CURRENT,prefixes:R.SHORT,value:1,offset:0},ampere:{name:"ampere",base:z.CURRENT,prefixes:R.LONG,value:1,offset:0},K:{name:"K",base:z.TEMPERATURE,prefixes:R.NONE,value:1,offset:0},degC:{name:"degC",base:z.TEMPERATURE,prefixes:R.NONE,value:1,offset:273.15},degF:{name:"degF",base:z.TEMPERATURE,prefixes:R.NONE,value:1/1.8,offset:459.67},degR:{name:"degR",base:z.TEMPERATURE,prefixes:R.NONE,value:1/1.8,offset:0},kelvin:{name:"kelvin",base:z.TEMPERATURE,prefixes:R.NONE,value:1,offset:0},celsius:{name:"celsius",base:z.TEMPERATURE,prefixes:R.NONE,value:1,offset:273.15},fahrenheit:{name:"fahrenheit",base:z.TEMPERATURE,prefixes:R.NONE,value:1/1.8,offset:459.67},rankine:{name:"rankine",base:z.TEMPERATURE,prefixes:R.NONE,value:1/1.8,offset:0},mol:{name:"mol",base:z.AMOUNT_OF_SUBSTANCE,prefixes:R.SHORT,value:1,offset:0},mole:{name:"mole",base:z.AMOUNT_OF_SUBSTANCE,prefixes:R.LONG,value:1,offset:0},cd:{name:"cd",base:z.LUMINOUS_INTENSITY,prefixes:R.SHORT,value:1,offset:0},candela:{name:"candela",base:z.LUMINOUS_INTENSITY,prefixes:R.LONG,value:1,offset:0},N:{name:"N",base:z.FORCE,prefixes:R.SHORT,value:1,offset:0},newton:{name:"newton",base:z.FORCE,prefixes:R.LONG,value:1,offset:0},dyn:{name:"dyn",base:z.FORCE,prefixes:R.SHORT,value:1e-5,offset:0},dyne:{name:"dyne",base:z.FORCE,prefixes:R.LONG,value:1e-5,offset:0},lbf:{name:"lbf",base:z.FORCE,prefixes:R.NONE,value:4.4482216152605,offset:0},poundforce:{name:"poundforce",base:z.FORCE,prefixes:R.NONE,value:4.4482216152605,offset:0},kip:{name:"kip",base:z.FORCE,prefixes:R.LONG,value:4448.2216,offset:0},kilogramforce:{name:"kilogramforce",base:z.FORCE,prefixes:R.NONE,value:9.80665,offset:0},J:{name:"J",base:z.ENERGY,prefixes:R.SHORT,value:1,offset:0},joule:{name:"joule",base:z.ENERGY,prefixes:R.SHORT,value:1,offset:0},erg:{name:"erg",base:z.ENERGY,prefixes:R.NONE,value:1e-7,offset:0},Wh:{name:"Wh",base:z.ENERGY,prefixes:R.SHORT,value:3600,offset:0},BTU:{name:"BTU",base:z.ENERGY,prefixes:R.BTU,value:1055.05585262,offset:0},eV:{name:"eV",base:z.ENERGY,prefixes:R.SHORT,value:1602176565e-28,offset:0},electronvolt:{name:"electronvolt",base:z.ENERGY,prefixes:R.LONG,value:1602176565e-28,offset:0},W:{name:"W",base:z.POWER,prefixes:R.SHORT,value:1,offset:0},watt:{name:"watt",base:z.POWER,prefixes:R.LONG,value:1,offset:0},hp:{name:"hp",base:z.POWER,prefixes:R.NONE,value:745.6998715386,offset:0},VAR:{name:"VAR",base:z.POWER,prefixes:R.SHORT,value:b.I,offset:0},VA:{name:"VA",base:z.POWER,prefixes:R.SHORT,value:1,offset:0},Pa:{name:"Pa",base:z.PRESSURE,prefixes:R.SHORT,value:1,offset:0},psi:{name:"psi",base:z.PRESSURE,prefixes:R.NONE,value:6894.75729276459,offset:0},atm:{name:"atm",base:z.PRESSURE,prefixes:R.NONE,value:101325,offset:0},bar:{name:"bar",base:z.PRESSURE,prefixes:R.SHORTLONG,value:1e5,offset:0},torr:{name:"torr",base:z.PRESSURE,prefixes:R.NONE,value:133.322,offset:0},mmHg:{name:"mmHg",base:z.PRESSURE,prefixes:R.NONE,value:133.322,offset:0},mmH2O:{name:"mmH2O",base:z.PRESSURE,prefixes:R.NONE,value:9.80665,offset:0},cmH2O:{name:"cmH2O",base:z.PRESSURE,prefixes:R.NONE,value:98.0665,offset:0},coulomb:{name:"coulomb",base:z.ELECTRIC_CHARGE,prefixes:R.LONG,value:1,offset:0},C:{name:"C",base:z.ELECTRIC_CHARGE,prefixes:R.SHORT,value:1,offset:0},farad:{name:"farad",base:z.ELECTRIC_CAPACITANCE,prefixes:R.LONG,value:1,offset:0},F:{name:"F",base:z.ELECTRIC_CAPACITANCE,prefixes:R.SHORT,value:1,offset:0},volt:{name:"volt",base:z.ELECTRIC_POTENTIAL,prefixes:R.LONG,value:1,offset:0},V:{name:"V",base:z.ELECTRIC_POTENTIAL,prefixes:R.SHORT,value:1,offset:0},ohm:{name:"ohm",base:z.ELECTRIC_RESISTANCE,prefixes:R.SHORTLONG,value:1,offset:0},henry:{name:"henry",base:z.ELECTRIC_INDUCTANCE,prefixes:R.LONG,value:1,offset:0},H:{name:"H",base:z.ELECTRIC_INDUCTANCE,prefixes:R.SHORT,value:1,offset:0},siemens:{name:"siemens",base:z.ELECTRIC_CONDUCTANCE,prefixes:R.LONG,value:1,offset:0},S:{name:"S",base:z.ELECTRIC_CONDUCTANCE,prefixes:R.SHORT,value:1,offset:0},weber:{name:"weber",base:z.MAGNETIC_FLUX,prefixes:R.LONG,value:1,offset:0},Wb:{name:"Wb",base:z.MAGNETIC_FLUX,prefixes:R.SHORT,value:1,offset:0},tesla:{name:"tesla",base:z.MAGNETIC_FLUX_DENSITY,prefixes:R.LONG,value:1,offset:0},T:{name:"T",base:z.MAGNETIC_FLUX_DENSITY,prefixes:R.SHORT,value:1,offset:0},b:{name:"b",base:z.BIT,prefixes:R.BINARY_SHORT,value:1,offset:0},bits:{name:"bits",base:z.BIT,prefixes:R.BINARY_LONG,value:1,offset:0},B:{name:"B",base:z.BIT,prefixes:R.BINARY_SHORT,value:8,offset:0},bytes:{name:"bytes",base:z.BIT,prefixes:R.BINARY_LONG,value:8,offset:0}},U={meters:"meter",inches:"inch",feet:"foot",yards:"yard",miles:"mile",links:"link",rods:"rod",chains:"chain",angstroms:"angstrom",lt:"l",litres:"litre",liter:"litre",liters:"litre",teaspoons:"teaspoon",tablespoons:"tablespoon",minims:"minim",fluiddrams:"fluiddram",fluidounces:"fluidounce",gills:"gill",cups:"cup",pints:"pint",quarts:"quart",gallons:"gallon",beerbarrels:"beerbarrel",oilbarrels:"oilbarrel",hogsheads:"hogshead",gtts:"gtt",grams:"gram",tons:"ton",tonnes:"tonne",grains:"grain",drams:"dram",ounces:"ounce",poundmasses:"poundmass",hundredweights:"hundredweight",sticks:"stick",lb:"lbm",lbs:"lbm",kips:"kip",kgf:"kilogramforce",acres:"acre",hectares:"hectare",sqfeet:"sqft",sqyard:"sqyd",sqmile:"sqmi",sqmiles:"sqmi",mmhg:"mmHg",mmh2o:"mmH2O",cmh2o:"cmH2O",seconds:"second",secs:"second",minutes:"minute",mins:"minute",hours:"hour",hr:"hour",hrs:"hour",days:"day",weeks:"week",months:"month",years:"year",decades:"decade",centuries:"century",millennia:"millennium",hertz:"hertz",radians:"radian",degrees:"degree",gradians:"gradian",cycles:"cycle",arcsecond:"arcsec",arcseconds:"arcsec",arcminute:"arcmin",arcminutes:"arcmin",BTUs:"BTU",watts:"watt",joules:"joule",amperes:"ampere",coulombs:"coulomb",volts:"volt",ohms:"ohm",farads:"farad",webers:"weber",teslas:"tesla",electronvolts:"electronvolt",moles:"mole",bit:"bits",byte:"bytes"};function q(e){if("BigNumber"===e.number){var t=Ze(w);j.rad.value=new w(1),j.deg.value=t.div(180),j.grad.value=t.div(200),j.cycle.value=t.times(2),j.arcsec.value=t.div(648e3),j.arcmin.value=t.div(10800)}else j.rad.value=1,j.deg.value=Math.PI/180,j.grad.value=Math.PI/200,j.cycle.value=2*Math.PI,j.arcsec.value=Math.PI/648e3,j.arcmin.value=Math.PI/10800;j.radian.value=j.rad.value,j.degree.value=j.deg.value,j.gradian.value=j.grad.value}q(a),i&&i("config",(function(e,t){e.number!==t.number&&q(e)}));var W={si:{NONE:{unit:L,prefix:R.NONE[""]},LENGTH:{unit:j.m,prefix:R.SHORT[""]},MASS:{unit:j.g,prefix:R.SHORT.k},TIME:{unit:j.s,prefix:R.SHORT[""]},CURRENT:{unit:j.A,prefix:R.SHORT[""]},TEMPERATURE:{unit:j.K,prefix:R.SHORT[""]},LUMINOUS_INTENSITY:{unit:j.cd,prefix:R.SHORT[""]},AMOUNT_OF_SUBSTANCE:{unit:j.mol,prefix:R.SHORT[""]},ANGLE:{unit:j.rad,prefix:R.SHORT[""]},BIT:{unit:j.bits,prefix:R.SHORT[""]},FORCE:{unit:j.N,prefix:R.SHORT[""]},ENERGY:{unit:j.J,prefix:R.SHORT[""]},POWER:{unit:j.W,prefix:R.SHORT[""]},PRESSURE:{unit:j.Pa,prefix:R.SHORT[""]},ELECTRIC_CHARGE:{unit:j.C,prefix:R.SHORT[""]},ELECTRIC_CAPACITANCE:{unit:j.F,prefix:R.SHORT[""]},ELECTRIC_POTENTIAL:{unit:j.V,prefix:R.SHORT[""]},ELECTRIC_RESISTANCE:{unit:j.ohm,prefix:R.SHORT[""]},ELECTRIC_INDUCTANCE:{unit:j.H,prefix:R.SHORT[""]},ELECTRIC_CONDUCTANCE:{unit:j.S,prefix:R.SHORT[""]},MAGNETIC_FLUX:{unit:j.Wb,prefix:R.SHORT[""]},MAGNETIC_FLUX_DENSITY:{unit:j.T,prefix:R.SHORT[""]},FREQUENCY:{unit:j.Hz,prefix:R.SHORT[""]}}};W.cgs=JSON.parse(JSON.stringify(W.si)),W.cgs.LENGTH={unit:j.m,prefix:R.SHORT.c},W.cgs.MASS={unit:j.g,prefix:R.SHORT[""]},W.cgs.FORCE={unit:j.dyn,prefix:R.SHORT[""]},W.cgs.ENERGY={unit:j.erg,prefix:R.NONE[""]},W.us=JSON.parse(JSON.stringify(W.si)),W.us.LENGTH={unit:j.ft,prefix:R.NONE[""]},W.us.MASS={unit:j.lbm,prefix:R.NONE[""]},W.us.TEMPERATURE={unit:j.degF,prefix:R.NONE[""]},W.us.FORCE={unit:j.lbf,prefix:R.NONE[""]},W.us.ENERGY={unit:j.BTU,prefix:R.BTU[""]},W.us.POWER={unit:j.hp,prefix:R.NONE[""]},W.us.PRESSURE={unit:j.psi,prefix:R.NONE[""]},W.auto=JSON.parse(JSON.stringify(W.si));var V=W.auto;for(var $ in N.setUnitSystem=function(e){if(!fe(W,e))throw new Error("Unit system "+e+" does not exist. Choices are: "+Object.keys(W).join(", "));V=W[e]},N.getUnitSystem=function(){for(var e in W)if(fe(W,e)&&W[e]===V)return e},N.typeConverters={BigNumber:function(e){return new w(e+"")},Fraction:function(e){return new C(e)},Complex:function(e){return e},number:function(e){return e}},N._getNumberConverter=function(e){if(!N.typeConverters[e])throw new TypeError('Unsupported type "'+e+'"');return N.typeConverters[e]},j)if(fe(j,$)){var H=j[$];H.dimensions=H.base.dimensions}for(var G in U)if(fe(U,G)){var K=j[U[G]],X={};for(var Y in K)fe(K,Y)&&(X[Y]=K[Y]);X.name=G,j[G]=X}return N.isValidAlpha=function(e){return/^[a-zA-Z]$/.test(e)},N.createUnit=function(e,t){if("object"!=typeof e)throw new TypeError("createUnit expects first parameter to be of type 'Object'");if(t&&t.override)for(var n in e)if(fe(e,n)&&N.deleteUnit(n),e[n].aliases)for(var r=0;r<e[n].aliases.length;r++)N.deleteUnit(e[n].aliases[r]);var i;for(var a in e)fe(e,a)&&(i=N.createUnitSingle(a,e[a]));return i},N.createUnitSingle=function(e,t,n){if(null==t&&(t={}),"string"!=typeof e)throw new TypeError("createUnitSingle expects first parameter to be of type 'string'");if(fe(j,e))throw new Error('Cannot create unit "'+e+'": a unit with that name already exists');!function(e){for(var t=0;t<e.length;t++){if(r=e.charAt(t),0===t&&!N.isValidAlpha(r))throw new Error('Invalid unit name (must begin with alpha character): "'+e+'"');if(t>0&&!N.isValidAlpha(r)&&!k(r))throw new Error('Invalid unit name (only alphanumeric characters are allowed): "'+e+'"')}}(e);var i,a,o,s=null,u=[],c=0;if(t&&"Unit"===t.type)s=t.clone();else if("string"==typeof t)""!==t&&(i=t);else{if("object"!=typeof t)throw new TypeError('Cannot create unit "'+e+'" from "'+t.toString()+'": expecting "string" or "Unit" or "Object"');i=t.definition,a=t.prefixes,c=t.offset,o=t.baseName,t.aliases&&(u=t.aliases.valueOf())}if(u)for(var l=0;l<u.length;l++)if(fe(j,u[l]))throw new Error('Cannot create alias "'+u[l]+'": a unit with that name already exists');if(i&&"string"==typeof i&&!s)try{s=N.parse(i,{allowNoUnits:!0})}catch(t){throw t.message='Could not create unit "'+e+'" from "'+i+'": '+t.message,t}else i&&"Unit"===i.type&&(s=i.clone());u=u||[],c=c||0,a=a&&a.toUpperCase&&R[a.toUpperCase()]||R.NONE;var f={};if(s){f={name:e,value:s.value,dimensions:s.dimensions.slice(0),prefixes:a,offset:c};var p=!1;for(var h in z)if(fe(z,h)){for(var d=!0,m=0;m<B.length;m++)if(Math.abs((f.dimensions[m]||0)-(z[h].dimensions[m]||0))>1e-12){d=!1;break}if(d){p=!0,f.base=z[h];break}}if(!p){o=o||e+"_STUFF";var g={dimensions:s.dimensions.slice(0)};g.key=o,z[o]=g,V[o]={unit:f,prefix:R.NONE[""]},f.base=z[o]}}else{if(o=o||e+"_STUFF",B.indexOf(o)>=0)throw new Error('Cannot create new base unit "'+e+'": a base unit with that name already exists (and cannot be overridden)');for(var v in B.push(o),z)fe(z,v)&&(z[v].dimensions[B.length-1]=0);for(var y={dimensions:[]},b=0;b<B.length;b++)y.dimensions[b]=0;y.dimensions[B.length-1]=1,y.key=o,z[o]=y,f={name:e,value:1,dimensions:z[o].dimensions.slice(0),prefixes:a,offset:c,base:z[o]},V[o]={unit:f,prefix:R.NONE[""]}}N.UNITS[e]=f;for(var x=0;x<u.length;x++){var w=u[x],E={};for(var C in f)fe(f,C)&&(E[C]=f[C]);E.name=w,N.UNITS[w]=E}return delete I.cache,new N(null,e)},N.deleteUnit=function(e){delete N.UNITS[e]},N.PREFIXES=R,N.BASE_DIMENSIONS=B,N.BASE_UNITS=z,N.UNIT_SYSTEMS=W,N.UNITS=j,N}),{isClass:!0}),Pf="createUnit",Lf=be(Pf,["typed","Unit"],(e=>{var{typed:t,Unit:n}=e;return t(Pf,{"Object, Object":function(e,t){return n.createUnit(e,t)},Object:function(e){return n.createUnit(e,{})},"string, Unit | string | Object, Object":function(e,t,r){var i={};return i[e]=t,n.createUnit(i,r)},"string, Unit | string | Object":function(e,t){var r={};return r[e]=t,n.createUnit(r,{})},string:function(e){var t={};return t[e]={},n.createUnit(t,{})}})})),jf="dotPow",Uf=be(jf,["typed","equalScalar","matrix","pow","DenseMatrix"],(e=>{var{typed:t,equalScalar:n,matrix:r,pow:i,DenseMatrix:a}=e,o=Rs({typed:t}),s=iu({typed:t,DenseMatrix:a}),u=zs({typed:t,equalScalar:n}),c=Ps({typed:t,DenseMatrix:a}),l=Ls({typed:t}),f=js({typed:t});return t(jf,{"any, any":i,"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,i,!1)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,i,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,i,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,i)},"Array, Array":function(e,t){return this(r(e),r(t)).valueOf()},"Array, Matrix":function(e,t){return this(r(e),t)},"Matrix, Array":function(e,t){return this(e,r(t))},"SparseMatrix, any":function(e,t){return u(e,t,this,!1)},"DenseMatrix, any":function(e,t){return f(e,t,this,!1)},"any, SparseMatrix":function(e,t){return c(t,e,this,!0)},"any, DenseMatrix":function(e,t){return f(t,e,this,!0)},"Array, any":function(e,t){return f(r(e),t,this,!1).valueOf()},"any, Array":function(e,t){return f(r(t),e,this,!0).valueOf()}})})),qf="factorial",Wf=be(qf,["typed","gamma"],(e=>{var{typed:t,gamma:n}=e;return t(qf,{number:function(e){if(e<0)throw new Error("Value must be non-negative");return n(e+1)},BigNumber:function(e){if(e.isNegative())throw new Error("Value must be non-negative");return n(e.plus(1))},"Array | Matrix":function(e){return _r(e,this)}})})),Vf=be("intersect",["typed","config","abs","add","addScalar","matrix","multiply","multiplyScalar","divideScalar","subtract","smaller","equalScalar","flatten","isZero","isNumeric"],(e=>{var{typed:t,config:n,abs:r,add:i,addScalar:a,matrix:o,multiply:s,multiplyScalar:u,divideScalar:c,subtract:l,smaller:f,equalScalar:p,flatten:h,isZero:d,isNumeric:m}=e;return t("intersect",{"Array, Array, Array":g,"Array, Array, Array, Array":v,"Matrix, Matrix, Matrix":function(e,t,n){var r=g(e.valueOf(),t.valueOf(),n.valueOf());return null===r?null:o(r)},"Matrix, Matrix, Matrix, Matrix":function(e,t,n,r){var i=v(e.valueOf(),t.valueOf(),n.valueOf(),r.valueOf());return null===i?null:o(i)}});function g(e,t,n){if(e=y(e),t=y(t),n=y(n),!x(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!x(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");if(!function(e){return 4===e.length&&m(e[0])&&m(e[1])&&m(e[2])&&m(e[3])}(n))throw new TypeError("Array with 4 numbers expected as third argument");return function(e,t,n,r,i,o,s,f,p,h){var d=u(e,s),m=u(r,s),g=u(t,f),v=u(i,f),y=u(n,p),b=u(o,p),x=l(l(l(h,d),g),y),w=l(l(l(a(a(m,v),b),d),g),y),E=c(x,w);return[a(e,u(E,l(r,e))),a(t,u(E,l(i,t))),a(n,u(E,l(o,n)))]}(e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2],n[3])}function v(e,t,o,h){if(e=y(e),t=y(t),o=y(o),h=y(h),2===e.length){if(!b(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!b(t))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");if(!b(o))throw new TypeError("Array with 2 numbers or BigNumbers expected for third argument");if(!b(h))throw new TypeError("Array with 2 numbers or BigNumbers expected for fourth argument");return function(e,t,o,p){var h=e,m=o,g=l(h,t),v=l(m,p),y=l(u(g[0],v[1]),u(v[0],g[1]));if(d(y))return null;if(f(r(y),n.epsilon))return null;var b=u(v[0],h[1]),x=u(v[1],h[0]),w=u(v[0],m[1]),E=u(v[1],m[0]),C=c(a(l(l(b,x),w),E),y);return i(s(g,C),h)}(e,t,o,h)}if(3===e.length){if(!x(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!x(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");if(!x(o))throw new TypeError("Array with 3 numbers or BigNumbers expected for third argument");if(!x(h))throw new TypeError("Array with 3 numbers or BigNumbers expected for fourth argument");return function(e,t,n,r,i,o,s,f,h,m,g,v){var y=w(e,s,m,s,t,f,g,f,n,h,v,h),b=w(m,s,r,e,g,f,i,t,v,h,o,n),x=w(e,s,r,e,t,f,i,t,n,h,o,n),E=w(m,s,m,s,g,f,g,f,v,h,v,h),C=w(r,e,r,e,i,t,i,t,o,n,o,n),S=l(u(y,b),u(x,E)),N=l(u(C,E),u(b,b));if(d(N))return null;var A=c(S,N),k=c(a(y,u(A,b)),E),D=a(e,u(A,l(r,e))),_=a(t,u(A,l(i,t))),M=a(n,u(A,l(o,n))),T=a(s,u(k,l(m,s))),O=a(f,u(k,l(g,f))),I=a(h,u(k,l(v,h)));return p(D,T)&&p(_,O)&&p(M,I)?[D,_,M]:null}(e[0],e[1],e[2],t[0],t[1],t[2],o[0],o[1],o[2],h[0],h[1],h[2])}throw new TypeError("Arrays with two or thee dimensional points expected")}function y(e){return 1===e.length?e[0]:e.length>1&&Array.isArray(e[0])&&e.every((e=>Array.isArray(e)&&1===e.length))?h(e):e}function b(e){return 2===e.length&&m(e[0])&&m(e[1])}function x(e){return 3===e.length&&m(e[0])&&m(e[1])&&m(e[2])}function w(e,t,n,r,i,o,s,c,f,p,h,d){var m=u(l(e,t),l(n,r)),g=u(l(i,o),l(s,c)),v=u(l(f,p),l(h,d));return a(a(m,g),v)}})),$f="permutations",Hf=be($f,["typed","factorial"],(e=>{var{typed:t,factorial:n}=e;return t($f,{"number | BigNumber":n,"number, number":function(e,t){if(!Se(e)||e<0)throw new TypeError("Positive integer value expected in function permutations");if(!Se(t)||t<0)throw new TypeError("Positive integer value expected in function permutations");if(t>e)throw new TypeError("second argument k must be less than or equal to first argument n");return sa(e-t+1,e)},"BigNumber, BigNumber":function(e,t){var n,r;if(!Gf(e)||!Gf(t))throw new TypeError("Positive integer value expected in function permutations");if(t.gt(e))throw new TypeError("second argument k must be less than or equal to first argument n");for(n=e.mul(0).add(1),r=e.minus(t).plus(1);r.lte(e);r=r.plus(1))n=n.times(r);return n}})}));function Gf(e){return e.isInteger()&&e.gte(0)}var Kf="setIntersect",Xf=be(Kf,["typed","size","subset","compareNatural","Index","DenseMatrix"],(e=>{var{typed:t,size:n,subset:r,compareNatural:i,Index:a,DenseMatrix:o}=e;return t(Kf,{"Array | Matrix, Array | Matrix":function(e,t){var s;if(0===r(n(e),new a(0))||0===r(n(t),new a(0)))s=[];else{var u=rr(Jn(Array.isArray(e)?e:e.toArray()).sort(i)),c=rr(Jn(Array.isArray(t)?t:t.toArray()).sort(i));s=[];for(var l=0;l<u.length;l++)for(var f=0;f<c.length;f++)if(0===i(u[l].value,c[f].value)&&u[l].identifier===c[f].identifier){s.push(u[l]);break}}return Array.isArray(e)&&Array.isArray(t)?ir(s):new o(ir(s))}})})),Yf="setUnion",Jf=be(Yf,["typed","size","concat","subset","setIntersect","setSymDifference","Index"],(e=>{var{typed:t,size:n,concat:r,subset:i,setIntersect:a,setSymDifference:o,Index:s}=e;return t(Yf,{"Array | Matrix, Array | Matrix":function(e,t){if(0===i(n(e),new s(0)))return Jn(t);if(0===i(n(t),new s(0)))return Jn(e);var u=Jn(e),c=Jn(t);return r(o(u,c),a(u,c))}})})),Zf=be("Spa",["addScalar","equalScalar","FibonacciHeap"],(e=>{var{addScalar:t,equalScalar:n,FibonacciHeap:r}=e;function i(){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");this._values=[],this._heap=new r}return i.prototype.type="Spa",i.prototype.isSpa=!0,i.prototype.set=function(e,t){if(this._values[e])this._values[e].value=t;else{var n=this._heap.insert(e,t);this._values[e]=n}},i.prototype.get=function(e){var t=this._values[e];return t?t.value:0},i.prototype.accumulate=function(e,n){var r=this._values[e];r?r.value=t(r.value,n):(r=this._heap.insert(e,n),this._values[e]=r)},i.prototype.forEach=function(e,t,r){var i=this._heap,a=this._values,o=[],s=i.extractMinimum();for(s&&o.push(s);s&&s.key<=t;)s.key>=e&&(n(s.value,0)||r(s.key,s.value,this)),(s=i.extractMinimum())&&o.push(s);for(var u=0;u<o.length;u++){var c=o[u];a[(s=i.insert(c.key,c.value)).key]=s}},i.prototype.swap=function(e,t){var n=this._values[e],r=this._values[t];if(!n&&r)n=this._heap.insert(e,r.value),this._heap.remove(r),this._values[e]=n,this._values[t]=void 0;else if(n&&!r)r=this._heap.insert(t,n.value),this._heap.remove(n),this._values[t]=r,this._values[e]=void 0;else if(n&&r){var i=n.value;n.value=r.value,r.value=i}},i}),{isClass:!0}),Qf="unit",ep=be(Qf,["typed","Unit"],(e=>{var{typed:t,Unit:n}=e;return t(Qf,{Unit:function(e){return e.clone()},string:function(e){return n.isValuelessUnit(e)?new n(null,e):n.parse(e,{allowNoUnits:!0})},"number | BigNumber | Fraction | Complex, string":function(e,t){return new n(e,t)},"Array | Matrix":function(e){return _r(e,this)}})})),tp="log1p",np=be(tp,["typed","config","divideScalar","log","Complex"],(e=>{var{typed:t,config:n,divideScalar:r,log:i,Complex:a}=e;return t(tp,{number:function(e){return e>=-1||n.predictable?De(e):o(new a(e,0))},Complex:o,BigNumber:function(e){var t=e.plus(1);return!t.isNegative()||n.predictable?t.ln():o(new a(e.toNumber(),0))},"Array | Matrix":function(e){return _r(e,this)},"any, any":function(e,t){return r(this(e),i(t))}});function o(e){var t=e.re+1;return new a(Math.log(Math.sqrt(t*t+e.im*e.im)),Math.atan2(e.im,t))}})),rp="stirlingS2",ip=be(rp,["typed","addScalar","subtract","multiplyScalar","divideScalar","pow","factorial","combinations","isNegative","isInteger","larger"],(e=>{var{typed:t,addScalar:n,subtract:r,multiplyScalar:i,divideScalar:a,pow:o,factorial:s,combinations:u,isNegative:c,isInteger:l,larger:f}=e;return t(rp,{"number | BigNumber, number | BigNumber":function(e,t){if(!l(e)||c(e)||!l(t)||c(t))throw new TypeError("Non-negative integer value expected in function stirlingS2");if(f(t,e))throw new TypeError("k must be less than or equal to n in function stirlingS2");for(var p=s(t),h=0,d=0;d<=t;d++){var m=o(-1,r(t,d)),g=u(t,d),v=o(d,e);h=n(h,i(i(g,v),m))}return a(h,p)}})})),ap="bellNumbers",op=be(ap,["typed","addScalar","isNegative","isInteger","stirlingS2"],(e=>{var{typed:t,addScalar:n,isNegative:r,isInteger:i,stirlingS2:a}=e;return t(ap,{"number | BigNumber":function(e){if(!i(e)||r(e))throw new TypeError("Non-negative integer value expected in function bellNumbers");for(var t=0,o=0;o<=e;o++)t=n(t,a(e,o));return t}})})),sp=be("lup",["typed","matrix","abs","addScalar","divideScalar","multiplyScalar","subtract","larger","equalScalar","unaryMinus","DenseMatrix","SparseMatrix","Spa"],(e=>{var{typed:t,matrix:n,abs:r,addScalar:i,divideScalar:a,multiplyScalar:o,subtract:s,larger:u,equalScalar:c,unaryMinus:l,DenseMatrix:f,SparseMatrix:p,Spa:h}=e;return t("lup",{DenseMatrix:function(e){return d(e)},SparseMatrix:function(e){return function(e){var t,n,i,s=e._size[0],f=e._size[1],d=Math.min(s,f),m=e._values,g=e._index,v=e._ptr,y=[],b=[],x=[],w=[s,d],E=[],C=[],S=[],N=[d,f],A=[],k=[];for(t=0;t<s;t++)A[t]=t,k[t]=t;var D=function(){var e=new h;n<s&&(x.push(y.length),y.push(1),b.push(n)),S.push(E.length);var f=v[n],d=v[n+1];for(i=f;i<d;i++)t=g[i],e.set(A[t],m[i]);n>0&&e.forEach(0,n-1,(function(t,n){p._forEachRow(t,y,b,x,(function(r,i){r>t&&e.accumulate(r,l(o(i,n)))}))}));var D=n,_=e.get(n),M=r(_);e.forEach(n+1,s-1,(function(e,t){var n=r(t);u(n,M)&&(D=e,M=n,_=t)})),n!==D&&(p._swapRows(n,D,w[1],y,b,x),p._swapRows(n,D,N[1],E,C,S),e.swap(n,D),function(e,t){var n=k[e],r=k[t];A[n]=t,A[r]=e,k[e]=r,k[t]=n}(n,D)),e.forEach(0,s-1,(function(e,t){e<=n?(E.push(t),C.push(e)):(t=a(t,_),c(t,0)||(y.push(t),b.push(e)))}))};for(n=0;n<f;n++)D();return S.push(E.length),x.push(y.length),{L:new p({values:y,index:b,ptr:x,size:w}),U:new p({values:E,index:C,ptr:S,size:N}),p:A,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}}(e)},Array:function(e){var t=d(n(e));return{L:t.L.valueOf(),U:t.U.valueOf(),p:t.p}}});function d(e){var t,n,l,p=e._size[0],h=e._size[1],d=Math.min(p,h),m=re(e._data),g=[],v=[p,d],y=[],b=[d,h],x=[];for(t=0;t<p;t++)x[t]=t;for(n=0;n<h;n++){if(n>0)for(t=0;t<p;t++){var w=Math.min(t,n),E=0;for(l=0;l<w;l++)E=i(E,o(m[t][l],m[l][n]));m[t][n]=s(m[t][n],E)}var C=n,S=0,N=0;for(t=n;t<p;t++){var A=m[t][n],k=r(A);u(k,S)&&(C=t,S=k,N=A)}if(n!==C&&(x[n]=[x[C],x[C]=x[n]][0],f._swapRows(n,C,m)),n<p)for(t=n+1;t<p;t++){var D=m[t][n];c(D,0)||(m[t][n]=a(m[t][n],N))}}for(n=0;n<h;n++)for(t=0;t<p;t++)0===n&&(t<h&&(y[t]=[]),g[t]=[]),t<n?(t<h&&(y[t][n]=m[t][n]),n<p&&(g[t][n]=0)):t!==n?(t<h&&(y[t][n]=0),n<p&&(g[t][n]=m[t][n])):(t<h&&(y[t][n]=m[t][n]),n<p&&(g[t][n]=1));var _=new f({data:g,size:v}),M=new f({data:y,size:b}),T=[];for(t=0,d=x.length;t<d;t++)T[x[t]]=t;return{L:_,U:M,p:T,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}}})),up="setSize",cp=be(up,["typed","compareNatural"],(e=>{var{typed:t,compareNatural:n}=e;return t(up,{"Array | Matrix":function(e){return Array.isArray(e)?Jn(e).length:Jn(e.toArray()).length},"Array | Matrix, boolean":function(e,t){if(!1===t||0===e.length)return Array.isArray(e)?Jn(e).length:Jn(e.toArray()).length;for(var r=Jn(Array.isArray(e)?e:e.toArray()).sort(n),i=1,a=1;a<r.length;a++)0!==n(r[a],r[a-1])&&i++;return i}})})),lp=be("det",["typed","matrix","subtract","multiply","unaryMinus","lup"],(e=>{var{typed:t,matrix:n,subtract:r,multiply:i,unaryMinus:a,lup:o}=e;return t("det",{any:function(e){return re(e)},"Array | Matrix":function(e){var t;switch((t=N(e)?e.size():Array.isArray(e)?(e=n(e)).size():[]).length){case 0:return re(e);case 1:if(1===t[0])return re(e.valueOf()[0]);throw new RangeError("Matrix must be square (size: "+Tn(t)+")");case 2:var s=t[0];if(s===t[1])return function(e,t,n){if(1===t)return re(e[0][0]);if(2===t)return r(i(e[0][0],e[1][1]),i(e[1][0],e[0][1]));for(var s=o(e),u=s.U[0][0],c=1;c<t;c++)u=i(u,s.U[c][c]);for(var l=0,f=0,p=[];;){for(;p[f];)f++;if(f>=t)break;for(var h=f,d=0;!p[s.p[h]];)p[s.p[h]]=!0,h=s.p[h],d++;d%2==0&&l++}return l%2==0?u:a(u)}(e.clone().valueOf(),s);throw new RangeError("Matrix must be square (size: "+Tn(t)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+Tn(t)+")")}}})})),fp=be("inv",["typed","matrix","divideScalar","addScalar","multiply","unaryMinus","det","identity","abs"],(e=>{var{typed:t,matrix:n,divideScalar:r,addScalar:i,multiply:a,unaryMinus:o,det:s,identity:u,abs:c}=e;return t("inv",{"Array | Matrix":function(e){var t=N(e)?e.size():Pn(e);switch(t.length){case 1:if(1===t[0])return N(e)?n([r(1,e.valueOf()[0])]):[r(1,e[0])];throw new RangeError("Matrix must be square (size: "+Tn(t)+")");case 2:var i=t[0],a=t[1];if(i===a)return N(e)?n(l(e.valueOf(),i,a),e.storage()):l(e,i,a);throw new RangeError("Matrix must be square (size: "+Tn(t)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+Tn(t)+")")}},any:function(e){return r(1,e)}});function l(e,t,n){var l,f,p,h,d;if(1===t){if(0===(h=e[0][0]))throw Error("Cannot calculate inverse, determinant is zero");return[[r(1,h)]]}if(2===t){var m=s(e);if(0===m)throw Error("Cannot calculate inverse, determinant is zero");return[[r(e[1][1],m),r(o(e[0][1]),m)],[r(o(e[1][0]),m),r(e[0][0],m)]]}var g=e.concat();for(l=0;l<t;l++)g[l]=g[l].concat();for(var v=u(t).valueOf(),y=0;y<n;y++){var b=c(g[y][y]),x=y;for(l=y+1;l<t;)c(g[l][y])>b&&(b=c(g[l][y]),x=l),l++;if(0===b)throw Error("Cannot calculate inverse, determinant is zero");(l=x)!==y&&(d=g[y],g[y]=g[l],g[l]=d,d=v[y],v[y]=v[l],v[l]=d);var w=g[y],E=v[y];for(l=0;l<t;l++){var C=g[l],S=v[l];if(l!==y){if(0!==C[y]){for(p=r(o(C[y]),w[y]),f=y;f<n;f++)C[f]=i(C[f],a(p,w[f]));for(f=0;f<n;f++)S[f]=i(S[f],a(p,E[f]))}}else{for(p=w[y],f=y;f<n;f++)C[f]=r(C[f],p);for(f=0;f<n;f++)S[f]=r(S[f],p)}}}return v}}));function pp(e,t){var n,r=t.length,i=[];if(e)for(n=0;n<r;n++)i[e[n]]=t[n];else for(n=0;n<r;n++)i[n]=t[n];return i}var hp="lusolve",dp=be(hp,["typed","matrix","lup","slu","usolve","lsolve","DenseMatrix"],(e=>{var{typed:t,matrix:n,lup:r,slu:i,usolve:a,lsolve:o,DenseMatrix:s}=e,u=dc({DenseMatrix:s});return t(hp,{"Array, Array | Matrix":function(e,t){e=n(e);var i=r(e);return l(i.L,i.U,i.p,null,t).valueOf()},"DenseMatrix, Array | Matrix":function(e,t){var n=r(e);return l(n.L,n.U,n.p,null,t)},"SparseMatrix, Array | Matrix":function(e,t){var n=r(e);return l(n.L,n.U,n.p,null,t)},"SparseMatrix, Array | Matrix, number, number":function(e,t,n,r){var a=i(e,n,r);return l(a.L,a.U,a.p,a.q,t)},"Object, Array | Matrix":function(e,t){return l(e.L,e.U,e.p,e.q,t)}});function c(e){if(N(e))return e;if(S(e))return n(e);throw new TypeError("Invalid Matrix LU decomposition")}function l(e,t,n,r,i){e=c(e),t=c(t),n&&((i=u(e,i,!0))._data=pp(n,i._data));var s=o(e,i),l=a(t,s);return r&&(l._data=pp(r,l._data)),l}})),mp="sqrtm",gp=be(mp,["typed","abs","add","multiply","sqrt","subtract","inv","size","max","identity"],(e=>{var{typed:t,abs:n,add:r,multiply:i,sqrt:a,subtract:o,inv:s,size:u,max:c,identity:l}=e,f=1e-6;function p(e){var t,a=0,p=e,h=l(u(e));do{var d=p;if(p=i(.5,r(d,s(h))),h=i(.5,r(h,s(d))),(t=c(n(o(p,d))))>f&&++a>1e3)throw new Error("computing square root of matrix: iterative method could not converge")}while(t>f);return p}return t(mp,{"Array | Matrix":function(e){var t=N(e)?e.size():Pn(e);switch(t.length){case 1:if(1===t[0])return a(e);throw new RangeError("Matrix must be square (size: "+Tn(t)+")");case 2:if(t[0]===t[1])return p(e);throw new RangeError("Matrix must be square (size: "+Tn(t)+")");default:throw new RangeError("Matrix must be at most two dimensional (size: "+Tn(t)+")")}}})})),vp=be("divide",["typed","matrix","multiply","equalScalar","divideScalar","inv"],(e=>{var{typed:t,matrix:n,multiply:r,equalScalar:i,divideScalar:a,inv:o}=e,s=zs({typed:t,equalScalar:i}),u=js({typed:t});return t("divide",ae({"Array | Matrix, Array | Matrix":function(e,t){return r(e,o(t))},"DenseMatrix, any":function(e,t){return u(e,t,a,!1)},"SparseMatrix, any":function(e,t){return s(e,t,a,!1)},"Array, any":function(e,t){return u(n(e),t,a,!1).valueOf()},"any, Array | Matrix":function(e,t){return r(e,o(t))}},a.signatures))})),yp="expm",bp=be(yp,["typed","abs","add","identity","inv","multiply"],(e=>{var{typed:t,abs:n,add:r,identity:i,inv:a,multiply:o}=e;return t(yp,{Matrix:function(e){var t=e.size();if(2!==t.length||t[0]!==t[1])throw new RangeError("Matrix must be square (size: "+Tn(t)+")");for(var u=t[0],c=function(e){for(var t=e.size()[0],r=0,i=0;i<t;i++){for(var a=0,o=0;o<t;o++)a+=n(e.get([i,o]));r=Math.max(a,r)}return r}(e),l=function(e,t){for(var n=0;n<30;n++)for(var r=0;r<=n;r++){var i=n-r;if(s(e,r,i)<1e-15)return{q:r,j:i}}throw new Error("Could not find acceptable parameters to compute the matrix exponential (try increasing maxSearchSize in expm.js)")}(c),f=l.q,p=l.j,h=o(e,Math.pow(2,-p)),d=i(u),m=i(u),g=1,v=h,y=-1,b=1;b<=f;b++)b>1&&(v=o(v,h),y=-y),d=r(d,o(g=g*(f-b+1)/((2*f-b+1)*b),v)),m=r(m,o(g*y,v));for(var x=o(a(m),d),w=0;w<p;w++)x=o(x,x);return D(e)?e.createSparseMatrix(x):x}});function s(e,t,n){for(var r=1,i=2;i<=t;i++)r*=i;for(var a=r,o=t+1;o<=2*t;o++)a*=o;var s=a*(2*t+1);return 8*Math.pow(e/Math.pow(2,n),2*t)*r*r/(a*s)}})),xp="kldivergence",wp=be(xp,["typed","matrix","divide","sum","multiply","dotDivide","log","isNumeric"],(e=>{var{typed:t,matrix:n,divide:r,sum:i,multiply:a,dotDivide:o,log:s,isNumeric:u}=e;return t(xp,{"Array, Array":function(e,t){return c(n(e),n(t))},"Matrix, Array":function(e,t){return c(e,n(t))},"Array, Matrix":function(e,t){return c(n(e),t)},"Matrix, Matrix":function(e,t){return c(e,t)}});function c(e,t){var n=t.size().length,c=e.size().length;if(n>1)throw new Error("first object must be one dimensional");if(c>1)throw new Error("second object must be one dimensional");if(n!==c)throw new Error("Length of two vectors must be equal");if(0===i(e))throw new Error("Sum of elements in first object must be non zero");if(0===i(t))throw new Error("Sum of elements in second object must be non zero");var l=r(e,i(e)),f=r(t,i(t)),p=i(a(l,s(o(l,f))));return u(p)?p:Number.NaN}})),Ep="mean",Cp=be(Ep,["typed","add","divide"],(e=>{var{typed:t,add:n,divide:r}=e;return t(Ep,{"Array | Matrix":i,"Array | Matrix, number | BigNumber":function(e,t){try{var i=Mr(e,t,n),a=Array.isArray(e)?Pn(e):e.size();return r(i,a[t])}catch(e){throw Js(e,"mean")}},"...":function(e){if(kr(e))throw new TypeError("Scalar values expected in function mean");return i(e)}});function i(e){var t,i=0;if(Dr(e,(function(e){try{t=void 0===t?e:n(t,e),i++}catch(t){throw Js(t,"mean",e)}})),0===i)throw new Error("Cannot calculate the mean of an empty array");return r(t,i)}})),Sp="median",Np=be(Sp,["typed","add","divide","compare","partitionSelect"],(e=>{var{typed:t,add:n,divide:r,compare:i,partitionSelect:a}=e;function o(e){try{var t=(e=Jn(e.valueOf())).length;if(0===t)throw new Error("Cannot calculate median of an empty array");if(t%2==0){for(var n=t/2-1,r=a(e,n+1),o=e[n],c=0;c<n;++c)i(e[c],o)>0&&(o=e[c]);return u(o,r)}var l=a(e,(t-1)/2);return s(l)}catch(e){throw Js(e,"median")}}var s=t({"number | BigNumber | Complex | Unit":function(e){return e}}),u=t({"number | BigNumber | Complex | Unit, number | BigNumber | Complex | Unit":function(e,t){return r(n(e,t),2)}});return t(Sp,{"Array | Matrix":o,"Array | Matrix, number | BigNumber":function(e,t){throw new Error("median(A, dim) is not yet supported")},"...":function(e){if(kr(e))throw new TypeError("Scalar values expected in function median");return o(e)}})})),Ap="unbiased",kp="variance",Dp=be(kp,["typed","add","subtract","multiply","divide","apply","isNaN"],(e=>{var{typed:t,add:n,subtract:r,multiply:i,divide:a,apply:o,isNaN:s}=e;return t(kp,{"Array | Matrix":function(e){return u(e,Ap)},"Array | Matrix, string":u,"Array | Matrix, number | BigNumber":function(e,t){return c(e,t,Ap)},"Array | Matrix, number | BigNumber, string":c,"...":function(e){return u(e,Ap)}});function u(e,t){var o,u=0;if(0===e.length)throw new SyntaxError("Function variance requires one or more parameters (0 provided)");if(Dr(e,(function(e){try{o=void 0===o?e:n(o,e),u++}catch(t){throw Js(t,"variance",e)}})),0===u)throw new Error("Cannot calculate variance of an empty array");var c=a(o,u);if(o=void 0,Dr(e,(function(e){var t=r(e,c);o=void 0===o?i(t,t):n(o,i(t,t))})),s(o))return o;switch(t){case"uncorrected":return a(o,u);case"biased":return a(o,u+1);case"unbiased":var l=b(o)?o.mul(0):0;return 1===u?l:a(o,u-1);default:throw new Error('Unknown normalization "'+t+'". Choose "unbiased" (default), "uncorrected", or "biased".')}}function c(e,t,n){try{if(0===e.length)throw new SyntaxError("Function variance requires one or more parameters (0 provided)");return o(e,t,(e=>u(e,n)))}catch(e){throw Js(e,"variance")}}})),_p=be("std",["typed","sqrt","variance"],(e=>{var{typed:t,sqrt:n,variance:r}=e;return t("std",{"Array | Matrix":i,"Array | Matrix, string":i,"Array | Matrix, number | BigNumber":i,"Array | Matrix, number | BigNumber, string":i,"...":function(e){return i(e)}});function i(e,t){if(0===e.length)throw new SyntaxError("Function std requires one or more parameters (0 provided)");try{return n(r.apply(null,arguments))}catch(e){throw e instanceof TypeError&&-1!==e.message.indexOf(" variance")?new TypeError(e.message.replace(" variance"," std")):e}}}));var Mp=["config","typed","matrix","addScalar","equal","subtract","abs","atan","cos","sin","multiplyScalar","divideScalar","inv","bignumber","multiply","add","larger","column","flatten","number","complex","sqrt","diag","qr","usolve","usolveAll","im","re","smaller","matrixFromColumns","dot"],Tp=be("eigs",Mp,(e=>{var{config:t,typed:n,matrix:r,addScalar:i,subtract:a,equal:o,abs:s,atan:u,cos:c,sin:l,multiplyScalar:f,divideScalar:p,inv:h,bignumber:d,multiply:m,add:g,larger:v,column:E,flatten:C,number:S,complex:N,sqrt:A,diag:k,qr:D,usolve:_,usolveAll:M,im:T,re:O,smaller:I,matrixFromColumns:F,dot:R}=e,B=function(e){var{config:t,addScalar:n,subtract:r,abs:i,atan:a,cos:o,sin:s,multiplyScalar:u,inv:c,bignumber:l,multiply:f,add:p}=e;function h(e,n){for(var r,i=e.length,a=Math.abs(n/i),o=new Array(i),s=0;s<i;s++)o[s]=E(i,0),o[s][s]=1;for(var u=b(e);Math.abs(u[1])>=Math.abs(a);){var c=u[0][0],l=u[0][1];e=y(e,(f=e[c][c],p=e[l][l],h=e[c][l],d=void 0,d=p-f,r=Math.abs(d)<=t.epsilon?Math.PI/4:.5*Math.atan(2*h/(p-f))),c,l),o=m(o,r,c,l),u=b(e)}for(var f,p,h,d,g=E(i,0),v=0;v<i;v++)g[v]=e[v][v];return w(re(g),re(o))}function d(e,n){for(var o,s=e.length,p=i(n/s),h=new Array(s),d=0;d<s;d++)h[d]=E(s,0),h[d][d]=1;for(var m=x(e);i(m[1])>=i(p);){var y=m[0][0],b=m[0][1];e=v(e,(C=e[y][y],S=e[b][b],N=e[y][b],A=void 0,A=r(S,C),o=i(A)<=t.epsilon?l(-1).acos().div(4):u(.5,a(f(2,N,c(A))))),y,b),h=g(h,o,y,b),m=x(e)}for(var C,S,N,A,k=E(s,0),D=0;D<s;D++)k[D]=e[D][D];return w(re(k),re(h))}function m(e,t,n,r){for(var i=e.length,a=Math.cos(t),o=Math.sin(t),s=E(i,0),u=E(i,0),c=0;c<i;c++)s[c]=a*e[c][n]-o*e[c][r],u[c]=o*e[c][n]+a*e[c][r];for(var l=0;l<i;l++)e[l][n]=s[l],e[l][r]=u[l];return e}function g(e,t,i,a){for(var c=e.length,f=o(t),p=s(t),h=E(c,l(0)),d=E(c,l(0)),m=0;m<c;m++)h[m]=r(u(f,e[m][i]),u(p,e[m][a])),d[m]=n(u(p,e[m][i]),u(f,e[m][a]));for(var g=0;g<c;g++)e[g][i]=h[g],e[g][a]=d[g];return e}function v(e,t,i,a){for(var c=e.length,h=l(o(t)),d=l(s(t)),m=u(h,h),g=u(d,d),v=E(c,l(0)),y=E(c,l(0)),b=f(l(2),h,d,e[i][a]),x=n(r(u(m,e[i][i]),b),u(g,e[a][a])),w=p(u(g,e[i][i]),b,u(m,e[a][a])),C=0;C<c;C++)v[C]=r(u(h,e[i][C]),u(d,e[a][C])),y[C]=n(u(d,e[i][C]),u(h,e[a][C]));e[i][i]=x,e[a][a]=w,e[i][a]=l(0),e[a][i]=l(0);for(var S=0;S<c;S++)S!==i&&S!==a&&(e[i][S]=v[S],e[S][i]=v[S],e[a][S]=y[S],e[S][a]=y[S]);return e}function y(e,t,n,r){for(var i=e.length,a=Math.cos(t),o=Math.sin(t),s=a*a,u=o*o,c=E(i,0),l=E(i,0),f=s*e[n][n]-2*a*o*e[n][r]+u*e[r][r],p=u*e[n][n]+2*a*o*e[n][r]+s*e[r][r],h=0;h<i;h++)c[h]=a*e[n][h]-o*e[r][h],l[h]=o*e[n][h]+a*e[r][h];e[n][n]=f,e[r][r]=p,e[n][r]=0,e[r][n]=0;for(var d=0;d<i;d++)d!==n&&d!==r&&(e[n][d]=c[d],e[d][n]=c[d],e[r][d]=l[d],e[d][r]=l[d]);return e}function b(e){for(var t=e.length,n=0,r=[0,1],i=0;i<t;i++)for(var a=i+1;a<t;a++)Math.abs(n)<Math.abs(e[i][a])&&(n=Math.abs(e[i][a]),r=[i,a]);return[r,n]}function x(e){for(var t=e.length,n=0,r=[0,1],a=0;a<t;a++)for(var o=a+1;o<t;o++)i(n)<i(e[a][o])&&(n=i(e[a][o]),r=[a,o]);return[r,n]}function w(e,t){for(var n=e.length,r=Array(n),a=Array(n),o=0;o<n;o++)a[o]=Array(n);for(var s=0;s<n;s++){for(var u=0,c=e[0],l=0;l<e.length;l++)i(e[l])<i(c)&&(c=e[u=l]);r[s]=e.splice(u,1)[0];for(var f=0;f<n;f++)a[f][s]=t[f][u],t[f].splice(u,1)}return{values:r,vectors:a}}function E(e,t){for(var n=new Array(e),r=0;r<e;r++)n[r]=t;return n}return function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.epsilon,i=arguments.length>3?arguments[3]:void 0;if("number"===i)return h(e,r);if("BigNumber"===i)return d(e,r);throw TypeError("Unsupported data type: "+i)}}({config:t,addScalar:i,subtract:a,column:E,flatten:C,equal:o,abs:s,atan:u,cos:c,sin:l,multiplyScalar:f,inv:h,bignumber:d,complex:N,multiply:m,add:g}),z=function(e){var{addScalar:t,subtract:n,flatten:r,multiply:i,multiplyScalar:a,divideScalar:o,sqrt:s,abs:u,bignumber:c,diag:l,inv:f,qr:p,usolve:h,usolveAll:d,equal:m,complex:g,larger:v,smaller:y,matrixFromColumns:b,dot:x}=e;function w(e,r,i,o){var u=t(e,o),c=n(a(e,o),a(r,i)),l=a(u,.5),f=a(s(n(a(u,u),a(4,c))),.5);return[t(l,f),n(l,f)]}function E(e,t,r,i,a,o,s,l){var f="BigNumber"===l,p="Complex"===l,h=f?c(0):p?g(0):0,d=f?c(1):p?g(1):1;if(y(u(r),s))return[[d,h],[h,d]];if(v(u(n(a,o)),s))return[[n(a,i),n(o,i)],[r,r]];var m=n(e,a),b=n(t,a),x=n(r,a),w=n(i,a);return y(u(b),s)?[[m,d],[x,h]]:[[b,h],[w,d]]}function C(e,t){for(var n=0;n<e.length;n++)e[n].push(...Array(t-e[n].length).fill(0));for(var r=e.length;r<t;r++)e.push(Array(t).fill(0)),e[r][r]=1;return e}function S(e,t,n){for(var r=0;r<e.length;r++)if(n(e[r],t))return r;return-1}function N(e,t,n,r,i){for(var a,o="BigNumber"===i?c(1e3):1e3,s=0;a=A(t,n,i),a=h(e,a),!v(D(a),o);)if(++s>=5)return null;for(s=0;;){var u=h(e,a);if(y(D(k(a,[u])),r))break;if(++s>=10)return null;a=_(u)}return a}function A(e,t,n){var r="BigNumber"===n,i="Complex"===n,a=Array(e).fill(0).map((e=>2*Math.random()-1));return r&&(a=a.map((e=>c(e)))),i&&(a=a.map((e=>g(e)))),_(a=k(a,t),n)}function k(e,t){for(var r of t)e=n(e,i(o(x(r,e),x(r,r)),r));return e}function D(e){return u(s(x(e,e)))}function _(e,t){var n="Complex"===t,r="BigNumber"===t?c(1):n?g(1):1;return i(o(r,D(e)),e)}return function(e,s,h,x,A){void 0===A&&(A=!0);var k=function(e,n,r,i,s){var f,p="BigNumber"===i,h="Complex"===i,d=p?c(0):h?g(0):0,b=p?c(1):h?g(1):1,x=p?c(10):2,w=a(x,x);s&&(f=Array(n).fill(b));for(var E=!1;!E;){E=!0;for(var C=0;C<n;C++){for(var S=d,N=d,A=0;A<n;A++)if(C!==A){var k=u(e[C][A]);S=t(S,k),N=t(N,k)}if(!m(S,0)&&!m(N,0)){for(var D=b,_=S,M=o(N,x),T=a(N,x);y(_,M);)_=a(_,w),D=a(D,x);for(;v(_,T);)_=o(_,w),D=o(D,x);if(y(o(t(_,N),D),a(t(S,N),.95))){E=!1;for(var O=o(1,D),I=0;I<n;I++)C!==I&&(e[C][I]=a(e[C][I],D),e[I][C]=a(e[I][C],O));s&&(f[C]=a(f[C],D))}}}}return l(f)}(e,s,0,x,A);!function(e,r,i,s,l,f){var p="BigNumber"===s,h="Complex"===s,d=p?c(0):h?g(0):0;p&&(i=c(i));for(var m=0;m<r-2;m++){for(var v=0,b=d,x=m+1;x<r;x++){var w=e[x][m];y(u(b),u(w))&&(b=w,v=x)}if(!y(u(b),i)){if(v!==m+1){var E=e[v];e[v]=e[m+1],e[m+1]=E;for(var C=0;C<r;C++){var S=e[C][v];e[C][v]=e[C][m+1],e[C][m+1]=S}if(l){var N=f[v];f[v]=f[m+1],f[m+1]=N}}for(var A=m+2;A<r;A++){var k=o(e[A][m],b);if(0!==k){for(var D=0;D<r;D++)e[A][D]=n(e[A][D],a(k,e[m+1][D]));for(var _=0;_<r;_++)e[_][m+1]=t(e[_][m+1],a(k,e[_][A]));if(l)for(var M=0;M<r;M++)f[A][M]=n(f[A][M],a(k,f[m+1][M]))}}}}}(e,s,h,x,A,k);var D,{values:_,C:M}=function(e,r,a,o,s){var f="BigNumber"===o,h="Complex"===o,d=f?c(1):h?g(1):1;f&&(a=c(a));for(var m=re(e),v=[],b=r,x=[],S=s?l(Array(r).fill(d)):void 0,N=s?l(Array(b).fill(d)):void 0,A=0;A<=100;){A+=1;for(var k=0;k<b;k++)m[k][k]=n(m[k][k],0);var{Q:D,R:_}=p(m);m=i(_,D);for(var M=0;M<b;M++)m[M][M]=t(m[M][M],0);if(s&&(N=i(N,D)),1===b||y(u(m[b-1][b-2]),a)){A=0,v.push(m[b-1][b-1]),s&&(x.unshift([[1]]),C(N,r),S=i(S,N),b>1&&(N=l(Array(b-1).fill(d)))),b-=1,m.pop();for(var T=0;T<b;T++)m[T].pop()}else if(2===b||y(u(m[b-2][b-3]),a)){A=0;var O=w(m[b-2][b-2],m[b-2][b-1],m[b-1][b-2],m[b-1][b-1]);v.push(...O),s&&(x.unshift(E(m[b-2][b-2],m[b-2][b-1],m[b-1][b-2],m[b-1][b-1],O[0],O[1],a,o)),C(N,r),S=i(S,N),b>2&&(N=l(Array(b-2).fill(d)))),b-=2,m.pop(),m.pop();for(var I=0;I<b;I++)m[I].pop(),m[I].pop()}if(0===b)break}if(v.sort(((e,t)=>+n(u(e),u(t)))),A>100){var F=Error("The eigenvalues failed to converge. Only found these eigenvalues: "+v.join(", "));throw F.values=v,F.vectors=[],F}var R=s?i(S,function(e,t){for(var n=[],r=0;r<t;r++)n[r]=Array(t).fill(0);var i=0;for(var a of e){for(var o=a.length,s=0;s<o;s++)for(var u=0;u<o;u++)n[i+s][i+u]=a[s][u];i+=o}return n}(x,r)):void 0;return{values:v,C:R}}(e,s,h,x,A);return M=i(f(k),M),A&&(D=function(e,t,a,o,s,u){var p=f(a),h=i(p,e,a),v="BigNumber"===u,y="Complex"===u,b=v?c(0):y?g(0):0,x=v?c(1):y?g(1):1,w=[],E=[];for(var C of o){var A=S(w,C,m);-1===A?(w.push(C),E.push(1)):E[A]+=1}for(var k=[],D=w.length,_=Array(t).fill(b),M=l(Array(t).fill(x)),T=[],O=0;O<D;O++){var I=w[O],F=n(h,i(I,M)),R=d(F,_);for(R=R.map((e=>i(a,e))),R.shift();R.length<E[O];){var B=N(F,t,R,s,u);if(null==B){T.push(I);break}R.push(B)}k.push(...R.map((e=>r(e))))}if(0!==T.length){var z=new Error("Failed to find eigenvectors for the following eigenvalues: "+T.join(", "));throw z.values=o,z.vectors=k,z}return k}(e,s,M,_,h,x),D=b(...D)),{values:_,vectors:D}}}({config:t,addScalar:i,subtract:a,multiply:m,multiplyScalar:f,flatten:C,divideScalar:p,sqrt:A,abs:s,bignumber:d,diag:k,qr:D,inv:h,usolve:_,usolveAll:M,equal:o,complex:N,larger:v,smaller:I,matrixFromColumns:F,dot:R});return n("eigs",{Array:function(e){return P(r(e))},"Array, number|BigNumber":function(e,t){return P(r(e),t)},Matrix:function(e){var{values:t,vectors:n}=P(e);return{values:r(t),vectors:r(n)}},"Matrix, number|BigNumber":function(e,t){var{values:n,vectors:i}=P(e,t);return{values:r(n),vectors:r(i)}}});function P(e,n){void 0===n&&(n=t.epsilon);var r=e.size();if(2!==r.length||r[0]!==r[1])throw new RangeError("Matrix must be square (size: "+Tn(r)+")");var i=e.toArray(),o=r[0];if(function(e,t,n){for(var r=0;r<t;r++)for(var i=0;i<t;i++)if(v(d(s(T(e[r][i]))),n))return!1;return!0}(i,o,n)&&(function(e,t){for(var n=0;n<t;n++)for(var r=0;r<t;r++)e[n][r]=O(e[n][r])}(i,o),function(e,t,n){for(var r=0;r<t;r++)for(var i=r;i<t;i++)if(v(d(s(a(e[r][i],e[i][r]))),n))return!1;return!0}(i,o,n))){var u=L(e,i,o);return B(i,o,n,u)}var c=L(e,i,o);return z(i,o,n,c)}function L(e,t,n){var r=e.datatype();if("number"===r||"BigNumber"===r||"Complex"===r)return r;for(var i=!1,a=!1,o=!1,s=0;s<n;s++)for(var u=0;u<n;u++){var c=t[s][u];if(y(c)||w(c))i=!0;else if(b(c))a=!0;else{if(!x(c))throw TypeError("Unsupported type in Matrix: "+ne(c));o=!0}}if(a&&o&&console.warn("Complex BigNumbers not supported, this operation will lose precission."),o){for(var l=0;l<n;l++)for(var f=0;f<n;f++)t[l][f]=N(t[l][f]);return"Complex"}if(a){for(var p=0;p<n;p++)for(var h=0;h<n;h++)t[p][h]=d(t[p][h]);return"BigNumber"}if(i){for(var m=0;m<n;m++)for(var g=0;g<n;g++)t[m][g]=S(t[m][g]);return"number"}throw TypeError("Matrix contains unsupported types only.")}})),Op="multinomial",Ip=["typed","add","divide","multiply","factorial","isInteger","isPositive"],Fp=be(Op,Ip,(e=>{var{typed:t,add:n,divide:r,multiply:i,factorial:a,isInteger:o,isPositive:s}=e;return t(Op,{"Array | Matrix":function(e){var t=0,u=1;return Dr(e,(function(e){if(!o(e)||!s(e))throw new TypeError("Positive integer value expected in function multinomial");t=n(t,e),u=i(u,a(e))})),r(a(t),u)}})})),Rp=["typed","abs","map","median","subtract"],Bp=be("mad",Rp,(e=>{var{typed:t,abs:n,map:r,median:i,subtract:a}=e;return t("mad",{"Array | Matrix":o,"...":function(e){return o(e)}});function o(e){if(0===(e=Jn(e.valueOf())).length)throw new Error("Cannot calculate median absolute deviation (mad) of an empty array");try{var t=i(e);return i(r(e,(function(e){return n(a(e,t))})))}catch(e){throw e instanceof TypeError&&-1!==e.message.indexOf("median")?new TypeError(e.message.replace("median","mad")):Js(e,"mad")}}})),zp="norm",Pp=["typed","abs","add","pow","conj","sqrt","multiply","equalScalar","larger","smaller","matrix","ctranspose","eigs"],Lp=be(zp,Pp,(e=>{var{typed:t,abs:n,add:r,pow:i,conj:a,sqrt:o,multiply:s,equalScalar:u,larger:c,smaller:l,matrix:f,ctranspose:p,eigs:h}=e;return t(zp,{number:Math.abs,Complex:function(e){return e.abs()},BigNumber:function(e){return e.abs()},boolean:function(e){return Math.abs(e)},Array:function(e){return d(f(e),2)},Matrix:function(e){return d(e,2)},"number | Complex | BigNumber | boolean, number | BigNumber | string":function(e){return this(e)},"Array, number | BigNumber | string":function(e,t){return d(f(e),t)},"Matrix, number | BigNumber | string":function(e,t){return d(e,t)}});function d(e,t){var f=e.size();if(1===f.length)return function(e,t){if(t===Number.POSITIVE_INFINITY||"inf"===t)return function(e){var t=0;return e.forEach((function(e){var r=n(e);c(r,t)&&(t=r)}),!0),t}(e);if(t===Number.NEGATIVE_INFINITY||"-inf"===t)return function(e){var t;return e.forEach((function(e){var r=n(e);t&&!l(r,t)||(t=r)}),!0),t||0}(e);if("fro"===t)return d(e,2);if("number"==typeof t&&!isNaN(t)){if(!u(t,0)){var a=0;return e.forEach((function(e){a=r(i(n(e),t),a)}),!0),i(a,1/t)}return Number.POSITIVE_INFINITY}throw new Error("Unsupported parameter value")}(e,t);if(2===f.length){if(f[0]&&f[1])return function(e,t){if(1===t)return function(e){var t=[],i=0;return e.forEach((function(e,a){var o=a[1],s=r(t[o]||0,n(e));c(s,i)&&(i=s),t[o]=s}),!0),i}(e);if(t===Number.POSITIVE_INFINITY||"inf"===t)return function(e){var t=[],i=0;return e.forEach((function(e,a){var o=a[0],s=r(t[o]||0,n(e));c(s,i)&&(i=s),t[o]=s}),!0),i}(e);if("fro"===t)return function(e){var t=0;return e.forEach((function(e,n){t=r(t,s(e,a(e)))})),n(o(t))}(e);if(2===t)return function(e){var t=e.size();if(t[0]!==t[1])throw new RangeError("Invalid matrix dimensions");var r=p(e),i=s(r,e),a=h(i).values.toArray(),u=a[a.length-1];return n(o(u))}(e);throw new Error("Unsupported parameter value "+t)}(e,t);throw new RangeError("Invalid matrix dimensions")}}})),jp="rotationMatrix",Up=["typed","config","multiplyScalar","addScalar","unaryMinus","norm","matrix","BigNumber","DenseMatrix","SparseMatrix","cos","sin"],qp=be(jp,Up,(e=>{var{typed:t,config:n,multiplyScalar:r,addScalar:i,unaryMinus:a,norm:o,BigNumber:s,matrix:u,DenseMatrix:c,SparseMatrix:l,cos:f,sin:p}=e;return t(jp,{"":function(){return"Matrix"===n.matrix?u([]):[]},string:function(e){return u(e)},"number | BigNumber | Complex | Unit":function(e){return h(e,"Matrix"===n.matrix?"dense":void 0)},"number | BigNumber | Complex | Unit, string":function(e,t){return h(e,t)},"number | BigNumber | Complex | Unit, Array":function(e,t){var n=u(t);return d(n),v(e,n,void 0)},"number | BigNumber | Complex | Unit, Matrix":function(e,t){d(t);var r=t.storage()||("Matrix"===n.matrix?"dense":void 0);return v(e,t,r)},"number | BigNumber | Complex | Unit, Array, string":function(e,t,n){var r=u(t);return d(r),v(e,r,n)},"number | BigNumber | Complex | Unit, Matrix, string":function(e,t,n){return d(t),v(e,t,n)}});function h(e,t){var n=b(e)?new s(-1):-1,i=f(e),a=p(e);return g([[i,r(n,a)],[a,i]],t)}function d(e){var t=e.size();if(t.length<1||3!==t[0])throw new RangeError("Vector must be of dimensions 1x3")}function m(e){return e.reduce(((e,t)=>r(e,t)))}function g(e,t){if(t){if("sparse"===t)return new l(e);if("dense"===t)return new c(e);throw new TypeError('Unknown matrix type "'.concat(t,'"'))}return e}function v(e,t,n){var r=o(t);if(0===r)throw new RangeError("Rotation around zero vector");var u=b(e)?s:null,c=u?new u(1):1,l=u?new u(-1):-1,h=u?new u(t.get([0])/r):t.get([0])/r,d=u?new u(t.get([1])/r):t.get([1])/r,v=u?new u(t.get([2])/r):t.get([2])/r,y=f(e),x=i(c,a(y)),w=p(e);return g([[i(y,m([h,h,x])),i(m([h,d,x]),m([l,v,w])),i(m([h,v,x]),m([d,w]))],[i(m([h,d,x]),m([v,w])),i(y,m([d,d,x])),i(m([d,v,x]),m([l,h,w]))],[i(m([h,v,x]),m([l,d,w])),i(m([d,v,x]),m([h,w])),i(y,m([v,v,x]))]],n)}})),Wp="rotate",Vp=["typed","multiply","rotationMatrix"],$p=be(Wp,Vp,(e=>{var{typed:t,multiply:n,rotationMatrix:r}=e;return t(Wp,{"Array , number | BigNumber | Complex | Unit":function(e,t){return i(e,2),n(r(t),e).toArray()},"Matrix , number | BigNumber | Complex | Unit":function(e,t){return i(e,2),n(r(t),e)},"Array, number | BigNumber | Complex | Unit, Array | Matrix":function(e,t,a){return i(e,3),n(r(t,a),e)},"Matrix, number | BigNumber | Complex | Unit, Array | Matrix":function(e,t,a){return i(e,3),n(r(t,a),e)}});function i(e,t){var n=Array.isArray(e)?Pn(e):e.size();if(n.length>2)throw new RangeError("Vector must be of dimensions 1x".concat(t));if(2===n.length&&1!==n[1])throw new RangeError("Vector must be of dimensions 1x".concat(t));if(n[0]!==t)throw new RangeError("Vector must be of dimensions 1x".concat(t))}})),Hp=Ee({config:ve}),Gp=He({}),Kp=ft({BigNumber:Hp,config:ve}),Xp=at({}),Yp=Wt({BigNumber:Hp,config:ve}),Jp=Sn({}),Zp=bt({Complex:Gp}),Qp=st({BigNumber:Hp,config:ve}),eh=dt({BigNumber:Hp,config:ve}),th=gt({BigNumber:Hp,config:ve}),nh=Nn({}),rh=ut({BigNumber:Hp,config:ve}),ih=ot({}),ah=pt({BigNumber:Hp,config:ve}),oh=An({}),sh=kn({}),uh=vt({BigNumber:Hp,config:ve}),ch=cn({BigNumber:Hp,config:ve}),lh=lt({BigNumber:Hp,config:ve}),fh=it({}),ph=Et({}),hh=sr({Matrix:nh}),dh=Zt({BigNumber:Hp,config:ve}),mh=ht({BigNumber:Hp,config:ve}),gh=ct({BigNumber:Hp,config:ve}),vh=ur({}),yh=yt({BigNumber:Hp,config:ve}),bh=Cr({BigNumber:Hp,Complex:Gp,DenseMatrix:hh,Fraction:Jp}),xh=ii({BigNumber:Hp,config:ve,typed:bh}),wh=Jt({BigNumber:Hp,config:ve}),Eh=ai({typed:bh}),Ch=si({Complex:Gp,config:ve,typed:bh}),Sh=Ai({BigNumber:Hp,typed:bh}),Nh=Di({BigNumber:Hp,Complex:Gp,config:ve,typed:bh}),Ah=Mi({typed:bh}),kh=Ti({typed:bh}),Dh=Ii({BigNumber:Hp,Complex:Gp,config:ve,typed:bh}),_h=Fi({typed:bh}),Mh=Ri({typed:bh}),Th=zi({Complex:Gp,config:ve,typed:bh}),Oh=Pi({BigNumber:Hp,typed:bh}),Ih=na({typed:bh}),Fh=ia({typed:bh}),Rh=oa({typed:bh}),Bh=la({typed:bh}),zh=pa({Complex:Gp,typed:bh}),Ph=da({typed:bh}),Lh=ga({typed:bh}),jh=ya({BigNumber:Hp,typed:bh}),Uh=ba({BigNumber:Hp,typed:bh}),qh=wa({typed:bh}),Wh=Sa({config:ve,typed:bh}),Vh=Na({typed:bh}),$h=Ta({typed:bh}),Hh=Ia({Complex:Gp,typed:bh}),Gh=Fa({typed:bh}),Kh=za({typed:bh}),Xh=ja({typed:bh}),Yh=qa({typed:bh}),Jh=Wa({format:Xh,typed:bh}),Zh=Va({typed:bh}),Qh=Ha({typed:bh}),ed=Qa({typed:bh}),td=to({typed:bh}),nd=ro({typed:bh}),rd=mt({BigNumber:Hp,config:ve}),id=ao({Complex:Gp,config:ve,typed:bh}),ad=so({Complex:Gp,config:ve,typed:bh}),od=uo({typed:bh}),sd=lo({typed:bh}),ud=vo({typed:bh}),cd=yo({typed:bh}),ld=bo({format:Xh,typed:bh}),fd=So({config:ve,typed:bh}),pd=Ao({typed:bh}),hd=Mo({config:ve,typed:bh}),dd=To({typed:bh}),md=Oo({BigNumber:Hp,typed:bh}),gd=Fo({BigNumber:Hp,Fraction:Jp,complex:zh,typed:bh}),vd=Ro({typed:bh}),yd=Bo({Matrix:nh,equalScalar:Wh,typed:bh}),bd=Po({typed:bh}),xd=jo({typed:bh}),wd=qo({typed:bh}),Ed=Wo({typed:bh}),Cd=$o({typed:bh}),Sd=Go({Complex:Gp,config:ve,typed:bh}),Nd=Xo({BigNumber:Hp,typed:bh}),Ad=Jo({isInteger:Qh,typed:bh}),kd=es({BigNumber:Hp,Complex:Gp,config:ve,typed:bh}),Dd=ts({format:Xh,typed:bh}),_d=rs({typed:bh}),Md=as({typed:bh}),Td=ss({BigNumber:Hp,typed:bh}),Od=cs({typed:bh}),Id=fs({typed:bh}),Fd=hs({config:ve,typed:bh}),Rd=ms({BigNumber:Hp,typed:bh}),Bd=vs({typed:bh}),zd=bs({SparseMatrix:yd,typed:bh}),Pd=xs({Complex:Gp,config:ve,typed:bh}),Ld=ws({typed:bh}),jd=Cs({typed:bh}),Ud=Ns({BigNumber:Hp,Complex:Gp,config:ve,typed:bh}),qd=As({BigNumber:Hp,typed:bh}),Wd=ks({Fraction:Jp,typed:bh}),Vd=_s({typed:bh}),$d=Ts({DenseMatrix:hh,Matrix:nh,SparseMatrix:yd,typed:bh}),Hd=Is({isZero:nd,matrix:$d,typed:bh}),Gd=Us({DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh}),Kd=$s({BigNumber:Hp,equalScalar:Wh,matrix:$d,typed:bh}),Xd=Xs({bignumber:Oh,fraction:Wd,number:cd}),Yd=Ys({DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh}),Jd=Qs({config:ve,multiplyScalar:sd,numeric:Xd,typed:bh}),Zd=tu({isInteger:Qh,matrix:$d,typed:bh}),Qd=ru({matrix:$d,config:ve,typed:bh}),em=ou({DenseMatrix:hh,config:ve,matrix:$d,typed:bh}),tm=uu({matrix:$d,typed:bh}),nm=lu({matrix:$d,typed:bh}),rm=vu({DenseMatrix:hh,addScalar:Ah,equalScalar:Wh,matrix:$d,typed:bh,unaryMinus:jd}),im=bu({matrix:$d,typed:bh}),am=xu({matrix:$d,typed:bh}),om=Eu({BigNumber:Hp,config:ve,matrix:$d,typed:bh}),sm=Su({BigNumber:Hp,config:ve,matrix:$d,typed:bh}),um=Nu({equalScalar:Wh,matrix:$d,not:ud,typed:bh,zeros:sm}),cm=ku({equalScalar:Wh,matrix:$d,typed:bh}),lm=_u({DenseMatrix:hh,matrix:$d,typed:bh}),fm=Tu({BigNumber:Hp,Complex:Gp,Fraction:Jp,config:ve,isNegative:ed,matrix:$d,typed:bh,unaryMinus:jd}),pm=Iu({BigNumber:Hp,DenseMatrix:hh,Fraction:Jp,config:ve,equalScalar:Wh,matrix:$d,typed:bh}),hm=Ru({matrix:$d,typed:bh}),dm=zu({isInteger:Qh,matrix:$d,typed:bh}),mm=ju({prod:Jd,size:Qd,typed:bh}),gm=qu({conj:Ph,transpose:am,typed:bh}),vm=Vu({DenseMatrix:hh,SparseMatrix:yd,matrix:$d,typed:bh}),ym=Hu({numeric:Xd,typed:bh}),bm=Ku({DenseMatrix:hh,divideScalar:ym,equalScalar:Wh,matrix:$d,typed:bh}),xm=Yu({DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh}),wm=Zu({matrix:$d,typed:bh}),Em=ec({BigNumber:Hp,DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh}),Cm=nc({isNumeric:Vd,typed:bh}),Sm=ic({abs:Eh,addScalar:Ah,divideScalar:ym,isPositive:td,multiplyScalar:sd,smaller:em,sqrt:Pd,typed:bh}),Nm=ac({DenseMatrix:hh,smaller:em}),Am=oc({ImmutableDenseMatrix:Nm}),km=uc({matrix:$d,multiplyScalar:sd,typed:bh}),Dm=lc({DenseMatrix:hh,config:ve,matrix:$d,typed:bh}),_m=hc({DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh,zeros:sm}),Mm=gc({DenseMatrix:hh,divideScalar:ym,equalScalar:Wh,matrix:$d,multiplyScalar:sd,subtract:rm,typed:bh}),Tm=yc({flatten:wm,matrix:$d,size:Qd,typed:bh}),Om=bc({config:ve,numeric:Xd,smaller:em,typed:bh}),Im=wc({isNaN:Od,isNumeric:Vd,typed:bh}),Fm=Cc({Complex:Gp,config:ve,divideScalar:ym,typed:bh}),Rm=Sc({BigNumber:Hp,config:ve,matrix:$d,typed:bh}),Bm=Ac({compare:pm,isNaN:Od,isNumeric:Vd,typed:bh}),zm=Dc({config:ve,matrix:$d}),Pm=Mc({DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh,zeros:sm}),Lm=Bc({BigNumber:Hp,DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh,zeros:sm}),jm=Lc({DenseMatrix:hh,config:ve,matrix:$d,typed:bh}),Um=Uc({DenseMatrix:hh,config:ve,equalScalar:Wh,matrix:$d,typed:bh}),qm=Wc({DenseMatrix:hh,divideScalar:ym,equalScalar:Wh,matrix:$d,multiplyScalar:sd,subtract:rm,typed:bh}),Wm=Vc({DenseMatrix:hh,matrix:$d,typed:bh}),Vm=$c({DenseMatrix:hh,SparseMatrix:yd,addScalar:Ah,equalScalar:Wh,matrix:$d,typed:bh}),$m=Kc({BigNumber:Hp,DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh}),Hm=Yc({DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh}),Gm=Zc({addScalar:Ah,combinations:Bh,divideScalar:ym,isInteger:Qh,isNegative:ed,multiplyScalar:sd,typed:bh}),Km=tl({compare:pm,typed:bh}),Xm=rl({equal:xm,typed:bh}),Ym=al({matrix:$d,number:cd,subtract:rm,typed:bh}),Jm=ol({addScalar:Ah,conj:Ph,multiplyScalar:sd,size:Qd,typed:bh}),Zm=ul({compareText:hm,isZero:nd,typed:bh}),Qm=cl({config:ve,equalScalar:Wh,matrix:$d,round:Lm,typed:bh}),eg=fl({BigNumber:Hp,DenseMatrix:hh,SparseMatrix:yd,config:ve,matrix:$d,typed:bh}),tg=hl({BigNumber:Hp,add:Vm,config:ve,equal:xm,isInteger:Qh,mod:Gd,smaller:em,typed:bh,xgcd:om}),ng=ml({DenseMatrix:hh,config:ve,matrix:$d,typed:bh}),rg=gl({Complex:Gp,config:ve,divideScalar:ym,typed:bh}),ig=yl({DenseMatrix:hh,divideScalar:ym,equalScalar:Wh,matrix:$d,multiplyScalar:sd,subtract:rm,typed:bh}),ag=xl({flatten:wm,matrix:$d,size:Qd,typed:bh}),og=El({addScalar:Ah,dot:Jm,equalScalar:Wh,matrix:$d,multiplyScalar:sd,typed:bh}),sg=Cl({Complex:Gp,config:ve,fraction:Wd,identity:eg,matrix:$d,multiply:og,number:cd,typed:bh}),ug=Sl({addScalar:Ah,complex:zh,conj:Ph,divideScalar:ym,equal:xm,identity:eg,isZero:nd,matrix:$d,multiplyScalar:sd,sign:gd,sqrt:Pd,subtract:rm,typed:bh,unaryMinus:jd,zeros:sm}),cg=Al({bignumber:Oh,matrix:$d,config:ve,larger:ng,largerEq:Dm,smaller:em,smallerEq:jm,typed:bh}),lg=Dl({DenseMatrix:hh,equalScalar:Wh,matrix:$d,typed:bh,zeros:sm}),fg=_l({Index:Am,matrix:$d,range:cg,typed:bh}),pg=Tl({DenseMatrix:hh,Index:Am,compareNatural:Km,size:Qd,subset:nm,typed:bh}),hg=Il({DenseMatrix:hh,Index:Am,compareNatural:Km,size:Qd,subset:nm,typed:bh}),dg=Rl({Index:Am,compareNatural:Km,size:Qd,subset:nm,typed:bh}),mg=zl({Index:Am,compareNatural:Km,size:Qd,subset:nm,typed:bh}),gg=Yl({SparseMatrix:yd,abs:Eh,add:Vm,divideScalar:ym,larger:ng,largerEq:Dm,multiply:og,subtract:rm,transpose:am,typed:bh}),vg=Jl({add:Vm,config:ve,numeric:Xd,typed:bh}),yg=Zl({add:Vm,matrix:$d,typed:bh}),bg=ef({DenseMatrix:hh,divideScalar:ym,equalScalar:Wh,matrix:$d,multiplyScalar:sd,subtract:rm,typed:bh}),xg=nf({Complex:Gp,config:ve,typed:bh}),wg=rf({config:ve,equalScalar:Wh,matrix:$d,round:Lm,typed:bh}),Eg=of({Index:Am,matrix:$d,range:cg,typed:bh}),Cg=uf({addScalar:Ah,combinations:Bh,isInteger:Qh,isNegative:ed,isPositive:td,larger:ng,typed:bh}),Sg=lf({matrix:$d,multiply:og,subtract:rm,typed:bh}),Ng=pf({abs:Eh,addScalar:Ah,divideScalar:ym,multiplyScalar:sd,sqrt:Pd,subtract:rm,typed:bh,unaryMinus:jd}),Ag=df({equalScalar:Wh,matrix:$d,multiplyScalar:sd,typed:bh}),kg=mf({larger:ng,smaller:em}),Dg=gf({Complex:Gp,ceil:wg,floor:Qm,matrix:$d,typed:bh}),_g=wf({BigNumber:Hp,Complex:Gp,config:ve,multiplyScalar:sd,pow:sg,typed:bh}),Mg=Cf({Index:Am,typed:bh}),Tg=Sf({equalScalar:Wh,matrix:$d,typed:bh}),Og=Nf({config:ve,larger:ng,numeric:Xd,typed:bh}),Ig=Af({add:Vm,compare:pm,multiply:og,partitionSelect:Bm,typed:bh}),Fg=Df({DenseMatrix:hh,Index:Am,compareNatural:Km,size:Qd,subset:nm,typed:bh}),Rg=Mf({Index:Am,compareNatural:Km,size:Qd,subset:nm,typed:bh}),Bg=Of({Index:Am,concat:dm,setDifference:Fg,size:Qd,subset:nm,typed:bh}),zg=Ff({compare:pm,compareNatural:Km,matrix:$d,typed:bh}),Pg=zf({BigNumber:Hp,Complex:Gp,Fraction:Jp,abs:Eh,addScalar:Ah,config:ve,divideScalar:ym,equal:xm,fix:Dg,format:Xh,isNumeric:Vd,multiplyScalar:sd,number:cd,pow:sg,round:Lm,subtract:rm}),Lg=Mt({BigNumber:Hp,Unit:Pg,config:ve}),jg=pn({BigNumber:Hp,Unit:Pg,config:ve}),Ug=Qt({BigNumber:Hp,Unit:Pg,config:ve}),qg=It({BigNumber:Hp,Unit:Pg,config:ve}),Wg=tn({BigNumber:Hp,Unit:Pg,config:ve}),Vg=Ft({BigNumber:Hp,Unit:Pg,config:ve}),$g=Lf({Unit:Pg,typed:bh}),Hg=Ht({BigNumber:Hp,Unit:Pg,config:ve}),Gg=Uf({DenseMatrix:hh,equalScalar:Wh,matrix:$d,pow:sg,typed:bh}),Kg=_t({BigNumber:Hp,Unit:Pg,config:ve}),Xg=Ot({BigNumber:Hp,Unit:Pg,config:ve}),Yg=Wf({gamma:_g,typed:bh}),Jg=qt({BigNumber:Hp,Unit:Pg,config:ve}),Zg=on({BigNumber:Hp,Unit:Pg,config:ve}),Qg=mn({BigNumber:Hp,Unit:Pg,config:ve}),ev=Vf({abs:Eh,add:Vm,addScalar:Ah,config:ve,divideScalar:ym,equalScalar:Wh,flatten:wm,isNumeric:Vd,isZero:nd,matrix:$d,multiply:og,multiplyScalar:sd,smaller:em,subtract:rm,typed:bh}),tv=Rt({BigNumber:Hp,Unit:Pg,config:ve}),nv=Pt({BigNumber:Hp,Unit:Pg,config:ve}),rv=an({BigNumber:Hp,Unit:Pg,config:ve}),iv=Dt({BigNumber:Hp,Unit:Pg,config:ve}),av=hn({BigNumber:Hp,Unit:Pg,config:ve}),ov=sn({BigNumber:Hp,Unit:Pg,config:ve}),sv=Gt({BigNumber:Hp,Unit:Pg,config:ve}),uv=zt({BigNumber:Hp,Unit:Pg,config:ve}),cv=Hf({factorial:Yg,typed:bh}),lv=At({BigNumber:Hp,Unit:Pg,config:ve}),fv=vn({BigNumber:Hp,Unit:Pg,config:ve}),pv=yn({BigNumber:Hp,Unit:Pg,config:ve}),hv=Kt({BigNumber:Hp,Unit:Pg,config:ve}),dv=kt({BigNumber:Hp,Unit:Pg,config:ve}),mv=Xt({BigNumber:Hp,Unit:Pg,config:ve}),gv=Xf({DenseMatrix:hh,Index:Am,compareNatural:Km,size:Qd,subset:nm,typed:bh}),vv=Jf({Index:Am,concat:dm,setIntersect:gv,setSymDifference:Bg,size:Qd,subset:nm,typed:bh}),yv=Zf({FibonacciHeap:kg,addScalar:Ah,equalScalar:Wh}),bv=fn({BigNumber:Hp,Unit:Pg,config:ve}),xv=ep({Unit:Pg,typed:bh}),wv=en({BigNumber:Hp,Unit:Pg,config:ve}),Ev=Lt({BigNumber:Hp,Unit:Pg,config:ve}),Cv=Tt({BigNumber:Hp,Unit:Pg,config:ve}),Sv=Ut({BigNumber:Hp,Unit:Pg,config:ve}),Nv=nn({BigNumber:Hp,Unit:Pg,config:ve}),Av=Vt({BigNumber:Hp,Unit:Pg,config:ve}),kv=np({Complex:Gp,config:ve,divideScalar:ym,log:rg,typed:bh}),Dv=Bt({BigNumber:Hp,Unit:Pg,config:ve}),_v=dn({BigNumber:Hp,Unit:Pg,config:ve}),Mv=bn({BigNumber:Hp,Unit:Pg,config:ve}),Tv=xn({BigNumber:Hp,Unit:Pg,config:ve}),Ov=ln({BigNumber:Hp,Unit:Pg,config:ve}),Iv=St({BigNumber:Hp,Unit:Pg,config:ve}),Fv=ip({addScalar:Ah,combinations:Bh,divideScalar:ym,factorial:Yg,isInteger:Qh,isNegative:ed,larger:ng,multiplyScalar:sd,pow:sg,subtract:rm,typed:bh}),Rv=op({addScalar:Ah,isInteger:Qh,isNegative:ed,stirlingS2:Fv,typed:bh}),Bv=rn({BigNumber:Hp,Unit:Pg,config:ve}),zv=sp({DenseMatrix:hh,Spa:yv,SparseMatrix:yd,abs:Eh,addScalar:Ah,divideScalar:ym,equalScalar:Wh,larger:ng,matrix:$d,multiplyScalar:sd,subtract:rm,typed:bh,unaryMinus:jd}),Pv=un({BigNumber:Hp,Unit:Pg,config:ve}),Lv=$t({BigNumber:Hp,Unit:Pg,config:ve}),jv=cp({compareNatural:Km,typed:bh}),Uv=Yt({BigNumber:Hp,Unit:Pg,config:ve}),qv=jt({BigNumber:Hp,Unit:Pg,config:ve}),Wv=lp({lup:zv,matrix:$d,multiply:og,subtract:rm,typed:bh,unaryMinus:jd}),Vv=Nt({BigNumber:Hp,Unit:Pg,config:ve}),$v=fp({abs:Eh,addScalar:Ah,det:Wv,divideScalar:ym,identity:eg,matrix:$d,multiply:og,typed:bh,unaryMinus:jd}),Hv=dp({DenseMatrix:hh,lsolve:Mm,lup:zv,matrix:$d,slu:gg,typed:bh,usolve:qm}),Gv=gp({abs:Eh,add:Vm,identity:eg,inv:$v,max:Og,multiply:og,size:Qd,sqrt:Pd,subtract:rm,typed:bh}),Kv=vp({divideScalar:ym,equalScalar:Wh,inv:$v,matrix:$d,multiply:og,typed:bh}),Xv=bp({abs:Eh,add:Vm,identity:eg,inv:$v,multiply:og,typed:bh}),Yv=wp({divide:Kv,dotDivide:bm,isNumeric:Vd,log:rg,matrix:$d,multiply:og,sum:vg,typed:bh}),Jv=Cp({add:Vm,divide:Kv,typed:bh}),Zv=Np({add:Vm,compare:pm,divide:Kv,partitionSelect:Bm,typed:bh}),Qv=gn({BigNumber:Hp,Unit:Pg,config:ve}),ey=Dp({add:Vm,apply:Ad,divide:Kv,isNaN:Od,multiply:og,subtract:rm,typed:bh}),ty=_p({sqrt:Pd,typed:bh,variance:ey}),ny=Tp({abs:Eh,add:Vm,addScalar:Ah,atan:Mh,bignumber:Oh,column:Eg,complex:zh,config:ve,cos:Md,diag:vm,divideScalar:ym,dot:Jm,equal:xm,flatten:wm,im:Zh,inv:$v,larger:ng,matrix:$d,matrixFromColumns:Tm,multiply:og,multiplyScalar:sd,number:cd,qr:ug,re:dd,sin:vd,smaller:em,sqrt:Pd,subtract:rm,typed:bh,usolve:qm,usolveAll:bg}),ry=Fp({add:Vm,divide:Kv,factorial:Yg,isInteger:Qh,isPositive:td,multiply:og,typed:bh}),iy=Bp({abs:Eh,map:od,median:Zv,subtract:rm,typed:bh}),ay=Lp({abs:Eh,add:Vm,conj:Ph,ctranspose:gm,eigs:ny,equalScalar:Wh,larger:ng,matrix:$d,multiply:og,pow:sg,smaller:em,sqrt:Pd,typed:bh}),oy=qp({BigNumber:Hp,DenseMatrix:hh,SparseMatrix:yd,addScalar:Ah,config:ve,cos:Md,matrix:$d,multiplyScalar:sd,norm:ay,sin:vd,typed:bh,unaryMinus:jd}),sy=$p({multiply:og,rotationMatrix:oy,typed:bh}),uy=be("Chain",["?on","math"],(e=>{var{on:t,math:n}=e;function r(e){if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");te(e)?this.value=e.value:this.value=e}function i(e,t){le(r.prototype,e,(function(){var e=t();if("function"==typeof e)return a(e)}))}function a(e){return function(){for(var t=[this.value],n=0;n<arguments.length;n++)t[n+1]=arguments[n];return new r(e.apply(e,t))}}r.prototype.type="Chain",r.prototype.isChain=!0,r.prototype.done=function(){return this.value},r.prototype.valueOf=function(){return this.value},r.prototype.toString=function(){return Tn(this.value)},r.prototype.toJSON=function(){return{mathjs:"Chain",value:this.value}},r.fromJSON=function(e){return new r(e.value)},r.createProxy=function(e,t){if("string"==typeof e)!function(e,t){"function"==typeof t&&(r.prototype[e]=a(t))}(e,t);else{var n=function(t){fe(e,t)&&void 0===o[t]&&i(t,(()=>e[t]))};for(var s in e)n(s)}};var o={expression:!0,docs:!0,type:!0,classes:!0,json:!0,error:!0,isChain:!0};return r.createProxy(n),t&&t("import",(function(e,t,n){n||i(e,t)})),r}),{isClass:!0}),cy=new Set(["end"]),ly=be("Node",["mathWithTransform"],(e=>{var{mathWithTransform:t}=e;function n(){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator")}return n.prototype.evaluate=function(e){return this.compile().evaluate(e)},n.prototype.type="Node",n.prototype.isNode=!0,n.prototype.comment="",n.prototype.compile=function(){var e=this._compile(t,{}),n={};return{evaluate:function(t){var r=br(t);return function(e){for(var t of[...cy])if(e.has(t))throw new Error('Scope contains an illegal symbol, "'+t+'" is a reserved keyword')}(r),e(r,n,null)}}},n.prototype._compile=function(e,t){throw new Error("Method _compile should be implemented by type "+this.type)},n.prototype.forEach=function(e){throw new Error("Cannot run forEach on a Node interface")},n.prototype.map=function(e){throw new Error("Cannot run map on a Node interface")},n.prototype._ifNode=function(e){if(!X(e))throw new TypeError("Callback function must return a Node");return e},n.prototype.traverse=function(e){e(this,null,null),function e(t,n){t.forEach((function(t,r,i){n(t,r,i),e(t,n)}))}(this,e)},n.prototype.transform=function(e){return function t(n,r,i){var a=e(n,r,i);return a!==n?a:n.map(t)}(this,null,null)},n.prototype.filter=function(e){var t=[];return this.traverse((function(n,r,i){e(n,r,i)&&t.push(n)})),t},n.prototype.clone=function(){throw new Error("Cannot clone a Node interface")},n.prototype.cloneDeep=function(){return this.map((function(e){return e.cloneDeep()}))},n.prototype.equals=function(e){return!!e&&se(this,e)},n.prototype.toString=function(e){var t=this._getCustomString(e);return void 0!==t?t:this._toString(e)},n.prototype.toJSON=function(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)},n.prototype.toHTML=function(e){var t=this._getCustomString(e);return void 0!==t?t:this.toHTML(e)},n.prototype._toString=function(){throw new Error("_toString not implemented for "+this.type)},n.prototype.toTex=function(e){var t=this._getCustomString(e);return void 0!==t?t:this._toTex(e)},n.prototype._toTex=function(e){throw new Error("_toTex not implemented for "+this.type)},n.prototype._getCustomString=function(e){if(e&&"object"==typeof e)switch(typeof e.handler){case"object":case"undefined":return;case"function":return e.handler(this,e);default:throw new TypeError("Object or function expected as callback")}},n.prototype.getIdentifier=function(){return this.type},n.prototype.getContent=function(){return this},n}),{isClass:!0,isNode:!0}),fy=be("ObjectNode",["Node"],(e=>{var{Node:t}=e;function n(e){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(this.properties=e||{},e&&("object"!=typeof e||!Object.keys(e).every((function(t){return X(e[t])}))))throw new TypeError("Object containing Nodes expected")}return n.prototype=new t,n.prototype.type="ObjectNode",n.prototype.isObjectNode=!0,n.prototype._compile=function(e,t){var n={};for(var r in this.properties)if(fe(this.properties,r)){var i=On(r),a=JSON.parse(i);if(!pr(this.properties,a))throw new Error('No access to property "'+a+'"');n[a]=this.properties[r]._compile(e,t)}return function(e,t,r){var i={};for(var a in n)fe(n,a)&&(i[a]=n[a](e,t,r));return i}},n.prototype.forEach=function(e){for(var t in this.properties)fe(this.properties,t)&&e(this.properties[t],"properties["+On(t)+"]",this)},n.prototype.map=function(e){var t={};for(var r in this.properties)fe(this.properties,r)&&(t[r]=this._ifNode(e(this.properties[r],"properties["+On(r)+"]",this)));return new n(t)},n.prototype.clone=function(){var e={};for(var t in this.properties)fe(this.properties,t)&&(e[t]=this.properties[t]);return new n(e)},n.prototype._toString=function(e){var t=[];for(var n in this.properties)fe(this.properties,n)&&t.push(On(n)+": "+this.properties[n].toString(e));return"{"+t.join(", ")+"}"},n.prototype.toJSON=function(){return{mathjs:"ObjectNode",properties:this.properties}},n.fromJSON=function(e){return new n(e.properties)},n.prototype.toHTML=function(e){var t=[];for(var n in this.properties)fe(this.properties,n)&&t.push('<span class="math-symbol math-property">'+In(n)+'</span><span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[n].toHTML(e));return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'},n.prototype._toTex=function(e){var t=[];for(var n in this.properties)fe(this.properties,n)&&t.push("\\mathbf{"+n+":} & "+this.properties[n].toTex(e)+"\\\\");return"\\left\\{\\begin{array}{ll}".concat(t.join("\n"),"\\end{array}\\right\\}")},n}),{isClass:!0,isNode:!0}),py=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:!1,latexRightParens:!1,latexParens:!1}},{"OperatorNode:or":{associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{associativity:"left",associativeWith:[]}},{"OperatorNode:and":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{associativity:"left",associativeWith:[]},"OperatorNode:unequal":{associativity:"left",associativeWith:[]},"OperatorNode:smaller":{associativity:"left",associativeWith:[]},"OperatorNode:larger":{associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{associativity:"left",associativeWith:[]},RelationalNode:{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{associativity:"left",associativeWith:[]}},{"OperatorNode:to":{associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{associativity:"left",associativeWith:[],latexLeftParens:!1,latexRightParens:!1,latexParens:!1},"OperatorNode:dotMultiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{associativity:"left",associativeWith:[]},"OperatorNode:mod":{associativity:"left",associativeWith:[]}},{"OperatorNode:unaryPlus":{associativity:"right"},"OperatorNode:unaryMinus":{associativity:"right"},"OperatorNode:bitNot":{associativity:"right"},"OperatorNode:not":{associativity:"right"}},{"OperatorNode:pow":{associativity:"right",associativeWith:[],latexRightParens:!1},"OperatorNode:dotPow":{associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{associativity:"left"}},{"OperatorNode:transpose":{associativity:"left"}}];function hy(e,t){var n=e;"keep"!==t&&(n=e.getContent());for(var r=n.getIdentifier(),i=0;i<py.length;i++)if(r in py[i])return i;return null}function dy(e,t){var n=e;"keep"!==t&&(n=e.getContent());var r=n.getIdentifier(),i=hy(n,t);if(null===i)return null;var a=py[i][r];if(fe(a,"associativity")){if("left"===a.associativity)return"left";if("right"===a.associativity)return"right";throw Error("'"+r+"' has the invalid associativity '"+a.associativity+"'.")}return null}function my(e,t,n){var r="keep"!==n?e.getContent():e,i="keep"!==n?e.getContent():t,a=r.getIdentifier(),o=i.getIdentifier(),s=hy(r,n);if(null===s)return null;var u=py[s][a];if(fe(u,"associativeWith")&&u.associativeWith instanceof Array){for(var c=0;c<u.associativeWith.length;c++)if(u.associativeWith[c]===o)return!0;return!1}return null}var gy=n(7928),vy={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"},yy={transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"},by={abs:{1:"\\left|${args[0]}\\right|"},add:{2:"\\left(${args[0]}".concat(yy.add,"${args[1]}\\right)")},cbrt:{1:"\\sqrt[3]{${args[0]}}"},ceil:{1:"\\left\\lceil${args[0]}\\right\\rceil"},cube:{1:"\\left(${args[0]}\\right)^3"},divide:{2:"\\frac{${args[0]}}{${args[1]}}"},dotDivide:{2:"\\left(${args[0]}".concat(yy.dotDivide,"${args[1]}\\right)")},dotMultiply:{2:"\\left(${args[0]}".concat(yy.dotMultiply,"${args[1]}\\right)")},dotPow:{2:"\\left(${args[0]}".concat(yy.dotPow,"${args[1]}\\right)")},exp:{1:"\\exp\\left(${args[0]}\\right)"},expm1:"\\left(e".concat(yy.pow,"{${args[0]}}-1\\right)"),fix:{1:"\\mathrm{${name}}\\left(${args[0]}\\right)"},floor:{1:"\\left\\lfloor${args[0]}\\right\\rfloor"},gcd:"\\gcd\\left(${args}\\right)",hypot:"\\hypot\\left(${args}\\right)",log:{1:"\\ln\\left(${args[0]}\\right)",2:"\\log_{${args[1]}}\\left(${args[0]}\\right)"},log10:{1:"\\log_{10}\\left(${args[0]}\\right)"},log1p:{1:"\\ln\\left(${args[0]}+1\\right)",2:"\\log_{${args[1]}}\\left(${args[0]}+1\\right)"},log2:"\\log_{2}\\left(${args[0]}\\right)",mod:{2:"\\left(${args[0]}".concat(yy.mod,"${args[1]}\\right)")},multiply:{2:"\\left(${args[0]}".concat(yy.multiply,"${args[1]}\\right)")},norm:{1:"\\left\\|${args[0]}\\right\\|",2:void 0},nthRoot:{2:"\\sqrt[${args[1]}]{${args[0]}}"},nthRoots:{2:"\\{y : $y^{args[1]} = {${args[0]}}\\}"},pow:{2:"\\left(${args[0]}\\right)".concat(yy.pow,"{${args[1]}}")},round:{1:"\\left\\lfloor${args[0]}\\right\\rceil",2:void 0},sign:{1:"\\mathrm{${name}}\\left(${args[0]}\\right)"},sqrt:{1:"\\sqrt{${args[0]}}"},square:{1:"\\left(${args[0]}\\right)^2"},subtract:{2:"\\left(${args[0]}".concat(yy.subtract,"${args[1]}\\right)")},unaryMinus:{1:"".concat(yy.unaryMinus,"\\left(${args[0]}\\right)")},unaryPlus:{1:"".concat(yy.unaryPlus,"\\left(${args[0]}\\right)")},bitAnd:{2:"\\left(${args[0]}".concat(yy.bitAnd,"${args[1]}\\right)")},bitNot:{1:yy.bitNot+"\\left(${args[0]}\\right)"},bitOr:{2:"\\left(${args[0]}".concat(yy.bitOr,"${args[1]}\\right)")},bitXor:{2:"\\left(${args[0]}".concat(yy.bitXor,"${args[1]}\\right)")},leftShift:{2:"\\left(${args[0]}".concat(yy.leftShift,"${args[1]}\\right)")},rightArithShift:{2:"\\left(${args[0]}".concat(yy.rightArithShift,"${args[1]}\\right)")},rightLogShift:{2:"\\left(${args[0]}".concat(yy.rightLogShift,"${args[1]}\\right)")},bellNumbers:{1:"\\mathrm{B}_{${args[0]}}"},catalan:{1:"\\mathrm{C}_{${args[0]}}"},stirlingS2:{2:"\\mathrm{S}\\left(${args}\\right)"},arg:{1:"\\arg\\left(${args[0]}\\right)"},conj:{1:"\\left(${args[0]}\\right)^*"},im:{1:"\\Im\\left\\lbrace${args[0]}\\right\\rbrace"},re:{1:"\\Re\\left\\lbrace${args[0]}\\right\\rbrace"},and:{2:"\\left(${args[0]}".concat(yy.and,"${args[1]}\\right)")},not:{1:yy.not+"\\left(${args[0]}\\right)"},or:{2:"\\left(${args[0]}".concat(yy.or,"${args[1]}\\right)")},xor:{2:"\\left(${args[0]}".concat(yy.xor,"${args[1]}\\right)")},cross:{2:"\\left(${args[0]}\\right)\\times\\left(${args[1]}\\right)"},ctranspose:{1:"\\left(${args[0]}\\right)".concat(yy.ctranspose)},det:{1:"\\det\\left(${args[0]}\\right)"},dot:{2:"\\left(${args[0]}\\cdot${args[1]}\\right)"},expm:{1:"\\exp\\left(${args[0]}\\right)"},inv:{1:"\\left(${args[0]}\\right)^{-1}"},sqrtm:{1:"{${args[0]}}".concat(yy.pow,"{\\frac{1}{2}}")},trace:{1:"\\mathrm{tr}\\left(${args[0]}\\right)"},transpose:{1:"\\left(${args[0]}\\right)".concat(yy.transpose)},combinations:{2:"\\binom{${args[0]}}{${args[1]}}"},combinationsWithRep:{2:"\\left(\\!\\!{\\binom{${args[0]}}{${args[1]}}}\\!\\!\\right)"},factorial:{1:"\\left(${args[0]}\\right)".concat(yy.factorial)},gamma:{1:"\\Gamma\\left(${args[0]}\\right)"},equal:{2:"\\left(${args[0]}".concat(yy.equal,"${args[1]}\\right)")},larger:{2:"\\left(${args[0]}".concat(yy.larger,"${args[1]}\\right)")},largerEq:{2:"\\left(${args[0]}".concat(yy.largerEq,"${args[1]}\\right)")},smaller:{2:"\\left(${args[0]}".concat(yy.smaller,"${args[1]}\\right)")},smallerEq:{2:"\\left(${args[0]}".concat(yy.smallerEq,"${args[1]}\\right)")},unequal:{2:"\\left(${args[0]}".concat(yy.unequal,"${args[1]}\\right)")},erf:{1:"erf\\left(${args[0]}\\right)"},max:"\\max\\left(${args}\\right)",min:"\\min\\left(${args}\\right)",variance:"\\mathrm{Var}\\left(${args}\\right)",acos:{1:"\\cos^{-1}\\left(${args[0]}\\right)"},acosh:{1:"\\cosh^{-1}\\left(${args[0]}\\right)"},acot:{1:"\\cot^{-1}\\left(${args[0]}\\right)"},acoth:{1:"\\coth^{-1}\\left(${args[0]}\\right)"},acsc:{1:"\\csc^{-1}\\left(${args[0]}\\right)"},acsch:{1:"\\mathrm{csch}^{-1}\\left(${args[0]}\\right)"},asec:{1:"\\sec^{-1}\\left(${args[0]}\\right)"},asech:{1:"\\mathrm{sech}^{-1}\\left(${args[0]}\\right)"},asin:{1:"\\sin^{-1}\\left(${args[0]}\\right)"},asinh:{1:"\\sinh^{-1}\\left(${args[0]}\\right)"},atan:{1:"\\tan^{-1}\\left(${args[0]}\\right)"},atan2:{2:"\\mathrm{atan2}\\left(${args}\\right)"},atanh:{1:"\\tanh^{-1}\\left(${args[0]}\\right)"},cos:{1:"\\cos\\left(${args[0]}\\right)"},cosh:{1:"\\cosh\\left(${args[0]}\\right)"},cot:{1:"\\cot\\left(${args[0]}\\right)"},coth:{1:"\\coth\\left(${args[0]}\\right)"},csc:{1:"\\csc\\left(${args[0]}\\right)"},csch:{1:"\\mathrm{csch}\\left(${args[0]}\\right)"},sec:{1:"\\sec\\left(${args[0]}\\right)"},sech:{1:"\\mathrm{sech}\\left(${args[0]}\\right)"},sin:{1:"\\sin\\left(${args[0]}\\right)"},sinh:{1:"\\sinh\\left(${args[0]}\\right)"},tan:{1:"\\tan\\left(${args[0]}\\right)"},tanh:{1:"\\tanh\\left(${args[0]}\\right)"},to:{2:"\\left(${args[0]}".concat(yy.to,"${args[1]}\\right)")},numeric:function(e,t){return e.args[0].toTex()},number:{0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},string:{0:'\\mathtt{""}',1:"\\mathrm{string}\\left(${args[0]}\\right)"},bignumber:{0:"0",1:"\\left(${args[0]}\\right)"},complex:{0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)+".concat(vy.i,"\\cdot\\left(${args[1]}\\right)\\right)")},matrix:{0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"},sparse:{0:"\\begin{bsparse}\\end{bsparse}",1:"\\left(${args[0]}\\right)"},unit:{1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"}},xy={deg:"^\\circ"};function wy(e){return gy(e,{preserveFormatting:!0})}function Ey(e,t){return(t=void 0!==t&&t)?fe(xy,e)?xy[e]:"\\mathrm{"+wy(e)+"}":fe(vy,e)?vy[e]:wy(e)}var Cy=be("OperatorNode",["Node"],(e=>{var{Node:t}=e;function n(e,t,r,i,a){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof e)throw new TypeError('string expected for parameter "op"');if("string"!=typeof t)throw new TypeError('string expected for parameter "fn"');if(!Array.isArray(r)||!r.every(X))throw new TypeError('Array containing Nodes expected for parameter "args"');this.implicit=!0===i,this.isPercentage=!0===a,this.op=e,this.fn=t,this.args=r||[]}function r(e,t,n,r,i){var a,o=hy(e,t),s=dy(e,t);if("all"===t||r.length>2&&"OperatorNode:add"!==e.getIdentifier()&&"OperatorNode:multiply"!==e.getIdentifier())return r.map((function(e){switch(e.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return!1;default:return!0}}));switch(r.length){case 0:a=[];break;case 1:var u=hy(r[0],t);if(i&&null!==u){var c,l;if("keep"===t?(c=r[0].getIdentifier(),l=e.getIdentifier()):(c=r[0].getContent().getIdentifier(),l=e.getContent().getIdentifier()),!1===py[o][l].latexLeftParens){a=[!1];break}if(!1===py[u][c].latexParens){a=[!1];break}}if(null===u){a=[!1];break}if(u<=o){a=[!0];break}a=[!1];break;case 2:var f,p,h=hy(r[0],t),d=my(e,r[0],t);f=null!==h&&(h===o&&"right"===s&&!d||h<o);var m,g,v,y=hy(r[1],t),b=my(e,r[1],t);p=null!==y&&(y===o&&"left"===s&&!b||y<o),i&&("keep"===t?(m=e.getIdentifier(),g=e.args[0].getIdentifier(),v=e.args[1].getIdentifier()):(m=e.getContent().getIdentifier(),g=e.args[0].getContent().getIdentifier(),v=e.args[1].getContent().getIdentifier()),null!==h&&(!1===py[o][m].latexLeftParens&&(f=!1),!1===py[h][g].latexParens&&(f=!1)),null!==y&&(!1===py[o][m].latexRightParens&&(p=!1),!1===py[y][v].latexParens&&(p=!1))),a=[f,p];break;default:"OperatorNode:add"!==e.getIdentifier()&&"OperatorNode:multiply"!==e.getIdentifier()||(a=r.map((function(n){var r=hy(n,t),i=my(e,n,t),a=dy(n,t);return null!==r&&(o===r&&s===a&&!i||r<o)})))}return r.length>=2&&"OperatorNode:multiply"===e.getIdentifier()&&e.implicit&&"auto"===t&&"hide"===n&&(a=r.map((function(e,t){var n="ParenthesisNode"===e.getIdentifier();return!(!a[t]&&!n)}))),a}return n.prototype=new t,n.prototype.type="OperatorNode",n.prototype.isOperatorNode=!0,n.prototype._compile=function(e,t){if("string"!=typeof this.fn||!hr(e,this.fn))throw e[this.fn]?new Error('No access to function "'+this.fn+'"'):new Error("Function "+this.fn+' missing in provided namespace "math"');var n=lr(e,this.fn),r=Zn(this.args,(function(n){return n._compile(e,t)}));if(1===r.length){var i=r[0];return function(e,t,r){return n(i(e,t,r))}}if(2===r.length){var a=r[0],o=r[1];return function(e,t,r){return n(a(e,t,r),o(e,t,r))}}return function(e,t,i){return n.apply(null,Zn(r,(function(n){return n(e,t,i)})))}},n.prototype.forEach=function(e){for(var t=0;t<this.args.length;t++)e(this.args[t],"args["+t+"]",this)},n.prototype.map=function(e){for(var t=[],r=0;r<this.args.length;r++)t[r]=this._ifNode(e(this.args[r],"args["+r+"]",this));return new n(this.op,this.fn,t,this.implicit,this.isPercentage)},n.prototype.clone=function(){return new n(this.op,this.fn,this.args.slice(0),this.implicit,this.isPercentage)},n.prototype.isUnary=function(){return 1===this.args.length},n.prototype.isBinary=function(){return 2===this.args.length},n.prototype._toString=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=e&&e.implicit?e.implicit:"hide",i=this.args,a=r(this,t,n,i,!1);if(1===i.length){var o=dy(this,t),s=i[0].toString(e);a[0]&&(s="("+s+")");var u=/[a-zA-Z]+/.test(this.op);return"right"===o?this.op+(u?" ":"")+s:"left"===o?s+(u?" ":"")+this.op:s+this.op}if(2===i.length){var c=i[0].toString(e),l=i[1].toString(e);return a[0]&&(c="("+c+")"),a[1]&&(l="("+l+")"),this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===n?c+" "+l:c+" "+this.op+" "+l}if(i.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var f=i.map((function(t,n){return t=t.toString(e),a[n]&&(t="("+t+")"),t}));return this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===n?f.join(" "):f.join(" "+this.op+" ")}return this.fn+"("+this.args.join(", ")+")"},n.prototype.toJSON=function(){return{mathjs:"OperatorNode",op:this.op,fn:this.fn,args:this.args,implicit:this.implicit,isPercentage:this.isPercentage}},n.fromJSON=function(e){return new n(e.op,e.fn,e.args,e.implicit,e.isPercentage)},n.prototype.toHTML=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=e&&e.implicit?e.implicit:"hide",i=this.args,a=r(this,t,n,i,!1);if(1===i.length){var o=dy(this,t),s=i[0].toHTML(e);return a[0]&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>'),"right"===o?'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+In(this.op)+"</span>"+s:s+'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+In(this.op)+"</span>"}if(2===i.length){var u=i[0].toHTML(e),c=i[1].toHTML(e);return a[0]&&(u='<span class="math-parenthesis math-round-parenthesis">(</span>'+u+'<span class="math-parenthesis math-round-parenthesis">)</span>'),a[1]&&(c='<span class="math-parenthesis math-round-parenthesis">(</span>'+c+'<span class="math-parenthesis math-round-parenthesis">)</span>'),this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===n?u+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+c:u+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+In(this.op)+"</span>"+c}var l=i.map((function(t,n){return t=t.toHTML(e),a[n]&&(t='<span class="math-parenthesis math-round-parenthesis">(</span>'+t+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t}));return i.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())?this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===n?l.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'):l.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+In(this.op)+"</span>"):'<span class="math-function">'+In(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+l.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'},n.prototype._toTex=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=e&&e.implicit?e.implicit:"hide",i=this.args,a=r(this,t,n,i,!0),o=yy[this.fn];if(o=void 0===o?this.op:o,1===i.length){var s=dy(this,t),u=i[0].toTex(e);return a[0]&&(u="\\left(".concat(u,"\\right)")),"right"===s?o+u:u+o}if(2===i.length){var c=i[0],l=c.toTex(e);a[0]&&(l="\\left(".concat(l,"\\right)"));var f,p=i[1].toTex(e);switch(a[1]&&(p="\\left(".concat(p,"\\right)")),f="keep"===t?c.getIdentifier():c.getContent().getIdentifier(),this.getIdentifier()){case"OperatorNode:divide":return o+"{"+l+"}{"+p+"}";case"OperatorNode:pow":switch(l="{"+l+"}",p="{"+p+"}",f){case"ConditionalNode":case"OperatorNode:divide":l="\\left(".concat(l,"\\right)")}break;case"OperatorNode:multiply":if(this.implicit&&"hide"===n)return l+"~"+p}return l+o+p}if(i.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var h=i.map((function(t,n){return t=t.toTex(e),a[n]&&(t="\\left(".concat(t,"\\right)")),t}));return"OperatorNode:multiply"===this.getIdentifier()&&this.implicit?h.join("~"):h.join(o)}return"\\mathrm{"+this.fn+"}\\left("+i.map((function(t){return t.toTex(e)})).join(",")+"\\right)"},n.prototype.getIdentifier=function(){return this.type+":"+this.fn},n}),{isClass:!0,isNode:!0}),Sy=be("ParenthesisNode",["Node"],(e=>{var{Node:t}=e;function n(e){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(!X(e))throw new TypeError('Node expected for parameter "content"');this.content=e}return n.prototype=new t,n.prototype.type="ParenthesisNode",n.prototype.isParenthesisNode=!0,n.prototype._compile=function(e,t){return this.content._compile(e,t)},n.prototype.getContent=function(){return this.content.getContent()},n.prototype.forEach=function(e){e(this.content,"content",this)},n.prototype.map=function(e){return new n(e(this.content,"content",this))},n.prototype.clone=function(){return new n(this.content)},n.prototype._toString=function(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?"("+this.content.toString(e)+")":this.content.toString(e)},n.prototype.toJSON=function(){return{mathjs:"ParenthesisNode",content:this.content}},n.fromJSON=function(e){return new n(e.content)},n.prototype.toHTML=function(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(e)+'<span class="math-parenthesis math-round-parenthesis">)</span>':this.content.toHTML(e)},n.prototype._toTex=function(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?"\\left(".concat(this.content.toTex(e),"\\right)"):this.content.toTex(e)},n}),{isClass:!0,isNode:!0}),Ny=be("RelationalNode",["Node"],(e=>{var{Node:t}=e;function n(e,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(e))throw new TypeError("Parameter conditionals must be an array");if(!Array.isArray(t))throw new TypeError("Parameter params must be an array");if(e.length!==t.length-1)throw new TypeError("Parameter params must contain exactly one more element than parameter conditionals");this.conditionals=e,this.params=t}return n.prototype=new t,n.prototype.type="RelationalNode",n.prototype.isRelationalNode=!0,n.prototype._compile=function(e,t){var n=this,r=this.params.map((n=>n._compile(e,t)));return function(t,i,a){for(var o,s=r[0](t,i,a),u=0;u<n.conditionals.length;u++)if(o=s,s=r[u+1](t,i,a),!lr(e,n.conditionals[u])(o,s))return!1;return!0}},n.prototype.forEach=function(e){this.params.forEach(((t,n)=>e(t,"params["+n+"]",this)),this)},n.prototype.map=function(e){return new n(this.conditionals.slice(),this.params.map(((t,n)=>this._ifNode(e(t,"params["+n+"]",this))),this))},n.prototype.clone=function(){return new n(this.conditionals,this.params)},n.prototype._toString=function(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",n=hy(this,t),r=this.params.map((function(r,i){var a=hy(r,t);return"all"===t||null!==a&&a<=n?"("+r.toString(e)+")":r.toString(e)})),i={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},a=r[0],o=0;o<this.conditionals.length;o++)a+=" "+i[this.conditionals[o]]+" "+r[o+1];return a},n.prototype.toJSON=function(){return{mathjs:"RelationalNode",conditionals:this.conditionals,params:this.params}},n.fromJSON=function(e){return new n(e.conditionals,e.params)},n.prototype.toHTML=function(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",n=hy(this,t),r=this.params.map((function(r,i){var a=hy(r,t);return"all"===t||null!==a&&a<=n?'<span class="math-parenthesis math-round-parenthesis">(</span>'+r.toHTML(e)+'<span class="math-parenthesis math-round-parenthesis">)</span>':r.toHTML(e)})),i={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},a=r[0],o=0;o<this.conditionals.length;o++)a+='<span class="math-operator math-binary-operator math-explicit-binary-operator">'+In(i[this.conditionals[o]])+"</span>"+r[o+1];return a},n.prototype._toTex=function(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",n=hy(this,t),r=this.params.map((function(r,i){var a=hy(r,t);return"all"===t||null!==a&&a<=n?"\\left("+r.toTex(e)+"\right)":r.toTex(e)})),i=r[0],a=0;a<this.conditionals.length;a++)i+=yy[this.conditionals[a]]+r[a+1];return i},n}),{isClass:!0,isNode:!0}),Ay=be("ArrayNode",["Node"],(e=>{var{Node:t}=e;function n(e){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(this.items=e||[],!Array.isArray(this.items)||!this.items.every(X))throw new TypeError("Array containing Nodes expected")}return n.prototype=new t,n.prototype.type="ArrayNode",n.prototype.isArrayNode=!0,n.prototype._compile=function(e,t){var n=Zn(this.items,(function(n){return n._compile(e,t)}));if("Array"!==e.config.matrix){var r=e.matrix;return function(e,t,i){return r(Zn(n,(function(n){return n(e,t,i)})))}}return function(e,t,r){return Zn(n,(function(n){return n(e,t,r)}))}},n.prototype.forEach=function(e){for(var t=0;t<this.items.length;t++)e(this.items[t],"items["+t+"]",this)},n.prototype.map=function(e){for(var t=[],r=0;r<this.items.length;r++)t[r]=this._ifNode(e(this.items[r],"items["+r+"]",this));return new n(t)},n.prototype.clone=function(){return new n(this.items.slice(0))},n.prototype._toString=function(e){return"["+this.items.map((function(t){return t.toString(e)})).join(", ")+"]"},n.prototype.toJSON=function(){return{mathjs:"ArrayNode",items:this.items}},n.fromJSON=function(e){return new n(e.items)},n.prototype.toHTML=function(e){return'<span class="math-parenthesis math-square-parenthesis">[</span>'+this.items.map((function(t){return t.toHTML(e)})).join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},n.prototype._toTex=function(e){return function t(n,r){var i=n.some(U)&&!n.every(U),a=r||i,o=a?"&":"\\\\",s=n.map((function(n){return n.items?t(n.items,!r):n.toTex(e)})).join(o);return i||!a||a&&!r?"\\begin{bmatrix}"+s+"\\end{bmatrix}":s}(this.items,!1)},n}),{isClass:!0,isNode:!0}),ky=be("BlockNode",["ResultSet","Node"],(e=>{var{ResultSet:t,Node:n}=e;function r(e){if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(e))throw new Error("Array expected");this.blocks=e.map((function(e){var t=e&&e.node,n=!e||void 0===e.visible||e.visible;if(!X(t))throw new TypeError('Property "node" must be a Node');if("boolean"!=typeof n)throw new TypeError('Property "visible" must be a boolean');return{node:t,visible:n}}))}return r.prototype=new n,r.prototype.type="BlockNode",r.prototype.isBlockNode=!0,r.prototype._compile=function(e,n){var r=Zn(this.blocks,(function(t){return{evaluate:t.node._compile(e,n),visible:t.visible}}));return function(e,n,i){var a=[];return Qn(r,(function(t){var r=t.evaluate(e,n,i);t.visible&&a.push(r)})),new t(a)}},r.prototype.forEach=function(e){for(var t=0;t<this.blocks.length;t++)e(this.blocks[t].node,"blocks["+t+"].node",this)},r.prototype.map=function(e){for(var t=[],n=0;n<this.blocks.length;n++){var i=this.blocks[n],a=this._ifNode(e(i.node,"blocks["+n+"].node",this));t[n]={node:a,visible:i.visible}}return new r(t)},r.prototype.clone=function(){return new r(this.blocks.map((function(e){return{node:e.node,visible:e.visible}})))},r.prototype._toString=function(e){return this.blocks.map((function(t){return t.node.toString(e)+(t.visible?"":";")})).join("\n")},r.prototype.toJSON=function(){return{mathjs:"BlockNode",blocks:this.blocks}},r.fromJSON=function(e){return new r(e.blocks)},r.prototype.toHTML=function(e){return this.blocks.map((function(t){return t.node.toHTML(e)+(t.visible?"":'<span class="math-separator">;</span>')})).join('<span class="math-separator"><br /></span>')},r.prototype._toTex=function(e){return this.blocks.map((function(t){return t.node.toTex(e)+(t.visible?"":";")})).join("\\;\\;\n")},r}),{isClass:!0,isNode:!0}),Dy=be("ConditionalNode",["Node"],(e=>{var{Node:t}=e;function n(e,t,r){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(!X(e))throw new TypeError("Parameter condition must be a Node");if(!X(t))throw new TypeError("Parameter trueExpr must be a Node");if(!X(r))throw new TypeError("Parameter falseExpr must be a Node");this.condition=e,this.trueExpr=t,this.falseExpr=r}return n.prototype=new t,n.prototype.type="ConditionalNode",n.prototype.isConditionalNode=!0,n.prototype._compile=function(e,t){var n=this.condition._compile(e,t),r=this.trueExpr._compile(e,t),i=this.falseExpr._compile(e,t);return function(e,t,a){return function(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e)return!!e;if(e){if(b(e))return!e.isZero();if(x(e))return!(!e.re&&!e.im);if(E(e))return!!e.value}if(null==e)return!1;throw new TypeError('Unsupported type of condition "'+ne(e)+'"')}(n(e,t,a))?r(e,t,a):i(e,t,a)}},n.prototype.forEach=function(e){e(this.condition,"condition",this),e(this.trueExpr,"trueExpr",this),e(this.falseExpr,"falseExpr",this)},n.prototype.map=function(e){return new n(this._ifNode(e(this.condition,"condition",this)),this._ifNode(e(this.trueExpr,"trueExpr",this)),this._ifNode(e(this.falseExpr,"falseExpr",this)))},n.prototype.clone=function(){return new n(this.condition,this.trueExpr,this.falseExpr)},n.prototype._toString=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=hy(this,t),r=this.condition.toString(e),i=hy(this.condition,t);("all"===t||"OperatorNode"===this.condition.type||null!==i&&i<=n)&&(r="("+r+")");var a=this.trueExpr.toString(e),o=hy(this.trueExpr,t);("all"===t||"OperatorNode"===this.trueExpr.type||null!==o&&o<=n)&&(a="("+a+")");var s=this.falseExpr.toString(e),u=hy(this.falseExpr,t);return("all"===t||"OperatorNode"===this.falseExpr.type||null!==u&&u<=n)&&(s="("+s+")"),r+" ? "+a+" : "+s},n.prototype.toJSON=function(){return{mathjs:"ConditionalNode",condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}},n.fromJSON=function(e){return new n(e.condition,e.trueExpr,e.falseExpr)},n.prototype.toHTML=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=hy(this,t),r=this.condition.toHTML(e),i=hy(this.condition,t);("all"===t||"OperatorNode"===this.condition.type||null!==i&&i<=n)&&(r='<span class="math-parenthesis math-round-parenthesis">(</span>'+r+'<span class="math-parenthesis math-round-parenthesis">)</span>');var a=this.trueExpr.toHTML(e),o=hy(this.trueExpr,t);("all"===t||"OperatorNode"===this.trueExpr.type||null!==o&&o<=n)&&(a='<span class="math-parenthesis math-round-parenthesis">(</span>'+a+'<span class="math-parenthesis math-round-parenthesis">)</span>');var s=this.falseExpr.toHTML(e),u=hy(this.falseExpr,t);return("all"===t||"OperatorNode"===this.falseExpr.type||null!==u&&u<=n)&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>'),r+'<span class="math-operator math-conditional-operator">?</span>'+a+'<span class="math-operator math-conditional-operator">:</span>'+s},n.prototype._toTex=function(e){return"\\begin{cases} {"+this.trueExpr.toTex(e)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(e)+"}\\\\{"+this.falseExpr.toTex(e)+"}, &\\quad{\\text{otherwise}}\\end{cases}"},n}),{isClass:!0,isNode:!0}),_y=be("ConstantNode",["Node"],(e=>{var{Node:t}=e;function n(e){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");this.value=e}return n.prototype=new t,n.prototype.type="ConstantNode",n.prototype.isConstantNode=!0,n.prototype._compile=function(e,t){var n=this.value;return function(){return n}},n.prototype.forEach=function(e){},n.prototype.map=function(e){return this.clone()},n.prototype.clone=function(){return new n(this.value)},n.prototype._toString=function(e){return Tn(this.value,e)},n.prototype.toHTML=function(e){var t=this._toString(e);switch(ne(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+t+"</span>";case"string":return'<span class="math-string">'+t+"</span>";case"boolean":return'<span class="math-boolean">'+t+"</span>";case"null":return'<span class="math-null-symbol">'+t+"</span>";case"undefined":return'<span class="math-undefined">'+t+"</span>";default:return'<span class="math-symbol">'+t+"</span>"}},n.prototype.toJSON=function(){return{mathjs:"ConstantNode",value:this.value}},n.fromJSON=function(e){return new n(e.value)},n.prototype._toTex=function(e){var t=this._toString(e);switch(ne(this.value)){case"string":return"\\mathtt{"+wy(t)+"}";case"number":case"BigNumber":if(!isFinite(this.value))return this.value.valueOf()<0?"-\\infty":"\\infty";var n=t.toLowerCase().indexOf("e");return-1!==n?t.substring(0,n)+"\\cdot10^{"+t.substring(n+1)+"}":t;case"Fraction":return this.value.toLatex();default:return t}},n}),{isClass:!0,isNode:!0}),My=be("RangeNode",["Node"],(e=>{var{Node:t}=e;function n(e,t,r){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(!X(e))throw new TypeError("Node expected");if(!X(t))throw new TypeError("Node expected");if(r&&!X(r))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=e,this.end=t,this.step=r||null}function r(e,t){var n=hy(e,t),r={},i=hy(e.start,t);if(r.start=null!==i&&i<=n||"all"===t,e.step){var a=hy(e.step,t);r.step=null!==a&&a<=n||"all"===t}var o=hy(e.end,t);return r.end=null!==o&&o<=n||"all"===t,r}return n.prototype=new t,n.prototype.type="RangeNode",n.prototype.isRangeNode=!0,n.prototype.needsEnd=function(){return this.filter((function(e){return ee(e)&&"end"===e.name})).length>0},n.prototype._compile=function(e,t){var n=e.range,r=this.start._compile(e,t),i=this.end._compile(e,t);if(this.step){var a=this.step._compile(e,t);return function(e,t,o){return n(r(e,t,o),i(e,t,o),a(e,t,o))}}return function(e,t,a){return n(r(e,t,a),i(e,t,a))}},n.prototype.forEach=function(e){e(this.start,"start",this),e(this.end,"end",this),this.step&&e(this.step,"step",this)},n.prototype.map=function(e){return new n(this._ifNode(e(this.start,"start",this)),this._ifNode(e(this.end,"end",this)),this.step&&this._ifNode(e(this.step,"step",this)))},n.prototype.clone=function(){return new n(this.start,this.end,this.step&&this.step)},n.prototype._toString=function(e){var t,n=r(this,e&&e.parenthesis?e.parenthesis:"keep"),i=this.start.toString(e);if(n.start&&(i="("+i+")"),t=i,this.step){var a=this.step.toString(e);n.step&&(a="("+a+")"),t+=":"+a}var o=this.end.toString(e);return n.end&&(o="("+o+")"),t+":"+o},n.prototype.toJSON=function(){return{mathjs:"RangeNode",start:this.start,end:this.end,step:this.step}},n.fromJSON=function(e){return new n(e.start,e.end,e.step)},n.prototype.toHTML=function(e){var t,n=r(this,e&&e.parenthesis?e.parenthesis:"keep"),i=this.start.toHTML(e);if(n.start&&(i='<span class="math-parenthesis math-round-parenthesis">(</span>'+i+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t=i,this.step){var a=this.step.toHTML(e);n.step&&(a='<span class="math-parenthesis math-round-parenthesis">(</span>'+a+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+='<span class="math-operator math-range-operator">:</span>'+a}var o=this.end.toHTML(e);return n.end&&(o='<span class="math-parenthesis math-round-parenthesis">(</span>'+o+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+'<span class="math-operator math-range-operator">:</span>'+o},n.prototype._toTex=function(e){var t=r(this,e&&e.parenthesis?e.parenthesis:"keep"),n=this.start.toTex(e);if(t.start&&(n="\\left(".concat(n,"\\right)")),this.step){var i=this.step.toTex(e);t.step&&(i="\\left(".concat(i,"\\right)")),n+=":"+i}var a=this.end.toTex(e);return t.end&&(a="\\left(".concat(a,"\\right)")),n+":"+a},n}),{isClass:!0,isNode:!0}),Ty=be("reviver",["classes"],(e=>{var{classes:t}=e;return function(e,n){var r=t[n&&n.mathjs];return r&&"function"==typeof r.fromJSON?r.fromJSON(n):n}})),Oy="chain",Iy=be(Oy,["typed","Chain"],(e=>{var{typed:t,Chain:n}=e;return t(Oy,{"":function(){return new n},any:function(e){return new n(e)}})})),Fy=be("FunctionAssignmentNode",["typed","Node"],(e=>{var{typed:t,Node:n}=e;function r(e,t,n){if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof e)throw new TypeError('String expected for parameter "name"');if(!Array.isArray(t))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!X(n))throw new TypeError('Node expected for parameter "expr"');if(cy.has(e))throw new Error('Illegal function name, "'+e+'" is a reserved keyword');this.name=e,this.params=t.map((function(e){return e&&e.name||e})),this.types=t.map((function(e){return e&&e.type||"any"})),this.expr=n}function i(e,t){var n=hy(e,t),r=hy(e.expr,t);return"all"===t||null!==r&&r<=n}return r.prototype=new n,r.prototype.type="FunctionAssignmentNode",r.prototype.isFunctionAssignmentNode=!0,r.prototype._compile=function(e,n){var r=Object.create(n);Qn(this.params,(function(e){r[e]=!0}));var i=this.expr._compile(e,r),a=this.name,o=this.params,s=nr(this.types,","),u=a+"("+nr(this.params,", ")+")";return function(e,n,r){var c={};c[s]=function(){for(var t=Object.create(n),a=0;a<o.length;a++)t[o[a]]=arguments[a];return i(e,t,r)};var l=t(a,c);return l.syntax=u,e.set(a,l),l}},r.prototype.forEach=function(e){e(this.expr,"expr",this)},r.prototype.map=function(e){var t=this._ifNode(e(this.expr,"expr",this));return new r(this.name,this.params.slice(0),t)},r.prototype.clone=function(){return new r(this.name,this.params.slice(0),this.expr)},r.prototype._toString=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=this.expr.toString(e);return i(this,t)&&(n="("+n+")"),this.name+"("+this.params.join(", ")+") = "+n},r.prototype.toJSON=function(){var e=this.types;return{mathjs:"FunctionAssignmentNode",name:this.name,params:this.params.map((function(t,n){return{name:t,type:e[n]}})),expr:this.expr}},r.fromJSON=function(e){return new r(e.name,e.params,e.expr)},r.prototype.toHTML=function(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",n=[],r=0;r<this.params.length;r++)n.push('<span class="math-symbol math-parameter">'+In(this.params[r])+"</span>");var a=this.expr.toHTML(e);return i(this,t)&&(a='<span class="math-parenthesis math-round-parenthesis">(</span>'+a+'<span class="math-parenthesis math-round-parenthesis">)</span>'),'<span class="math-function">'+In(this.name)+'</span><span class="math-parenthesis math-round-parenthesis">(</span>'+n.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+a},r.prototype._toTex=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=this.expr.toTex(e);return i(this,t)&&(n="\\left(".concat(n,"\\right)")),"\\mathrm{"+this.name+"}\\left("+this.params.map(Ey).join(",")+"\\right):="+n},r}),{isClass:!0,isNode:!0});function Ry(e){return e&&e.isIndexError?new zn(e.index+1,e.min+1,void 0!==e.max?e.max+1:void 0):e}function By(e){var{subset:t}=e;return function(e,n){try{if(Array.isArray(e))return t(e,n);if(e&&"function"==typeof e.subset)return e.subset(n);if("string"==typeof e)return t(e,n);if("object"==typeof e){if(!n.isObjectProperty())throw new TypeError("Cannot apply a numeric index as object property");return lr(e,n.getObjectProperty())}throw new TypeError("Cannot apply index: unsupported type of object")}catch(e){throw Ry(e)}}}var zy=be("AccessorNode",["subset","Node"],(e=>{var{subset:t,Node:n}=e,r=By({subset:t});function i(e,t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(!X(e))throw new TypeError('Node expected for parameter "object"');if(!K(t))throw new TypeError('IndexNode expected for parameter "index"');this.object=e||null,this.index=t,Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}function a(e){return!(j(e)||U(e)||$(e)||G(e)||Y(e)||Z(e)||ee(e))}return i.prototype=new n,i.prototype.type="AccessorNode",i.prototype.isAccessorNode=!0,i.prototype._compile=function(e,t){var n=this.object._compile(e,t),i=this.index._compile(e,t);if(this.index.isObjectProperty()){var a=this.index.getObjectProperty();return function(e,t,r){return lr(n(e,t,r),a)}}return function(e,t,a){var o=n(e,t,a),s=i(e,t,o);return r(o,s)}},i.prototype.forEach=function(e){e(this.object,"object",this),e(this.index,"index",this)},i.prototype.map=function(e){return new i(this._ifNode(e(this.object,"object",this)),this._ifNode(e(this.index,"index",this)))},i.prototype.clone=function(){return new i(this.object,this.index)},i.prototype._toString=function(e){var t=this.object.toString(e);return a(this.object)&&(t="("+t+")"),t+this.index.toString(e)},i.prototype.toHTML=function(e){var t=this.object.toHTML(e);return a(this.object)&&(t='<span class="math-parenthesis math-round-parenthesis">(</span>'+t+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+this.index.toHTML(e)},i.prototype._toTex=function(e){var t=this.object.toTex(e);return a(this.object)&&(t="\\left(' + object + '\\right)"),t+this.index.toTex(e)},i.prototype.toJSON=function(){return{mathjs:"AccessorNode",object:this.object,index:this.index}},i.fromJSON=function(e){return new i(e.object,e.index)},i}),{isClass:!0,isNode:!0}),Py=be("AssignmentNode",["subset","?matrix","Node"],(e=>{var{subset:t,matrix:n,Node:r}=e,i=By({subset:t}),a=function(e){var{subset:t,matrix:n}=e;return function(e,r,i){try{if(Array.isArray(e))return n(e).subset(r,i).valueOf();if(e&&"function"==typeof e.subset)return e.subset(r,i);if("string"==typeof e)return t(e,r,i);if("object"==typeof e){if(!r.isObjectProperty())throw TypeError("Cannot apply a numeric index as object property");return fr(e,r.getObjectProperty(),i),e}throw new TypeError("Cannot apply index: unsupported type of object")}catch(e){throw Ry(e)}}}({subset:t,matrix:n});function o(e,t,n){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");if(this.object=e,this.index=n?t:null,this.value=n||t,!ee(e)&&!j(e))throw new TypeError('SymbolNode or AccessorNode expected as "object"');if(ee(e)&&"end"===e.name)throw new Error('Cannot assign to symbol "end"');if(this.index&&!K(this.index))throw new TypeError('IndexNode expected as "index"');if(!X(this.value))throw new TypeError('Node expected as "value"');Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}function s(e,t){t||(t="keep");var n=hy(e,t),r=hy(e.value,t);return"all"===t||null!==r&&r<=n}return o.prototype=new r,o.prototype.type="AssignmentNode",o.prototype.isAssignmentNode=!0,o.prototype._compile=function(e,t){var n=this.object._compile(e,t),r=this.index?this.index._compile(e,t):null,o=this.value._compile(e,t),s=this.object.name;if(this.index){if(this.index.isObjectProperty()){var u=this.index.getObjectProperty();return function(e,t,r){var i=n(e,t,r),a=o(e,t,r);return fr(i,u,a),a}}if(ee(this.object))return function(e,t,i){var u=n(e,t,i),c=o(e,t,i),l=r(e,t,u);return e.set(s,a(u,l,c)),c};var c=this.object.object._compile(e,t);if(this.object.index.isObjectProperty()){var l=this.object.index.getObjectProperty();return function(e,t,n){var i=c(e,t,n),s=lr(i,l),u=r(e,t,s),f=o(e,t,n);return fr(i,l,a(s,u,f)),f}}var f=this.object.index._compile(e,t);return function(e,t,n){var s=c(e,t,n),u=f(e,t,s),l=i(s,u),p=r(e,t,l),h=o(e,t,n);return a(s,u,a(l,p,h)),h}}if(!ee(this.object))throw new TypeError("SymbolNode expected as object");return function(e,t,n){var r=o(e,t,n);return e.set(s,r),r}},o.prototype.forEach=function(e){e(this.object,"object",this),this.index&&e(this.index,"index",this),e(this.value,"value",this)},o.prototype.map=function(e){return new o(this._ifNode(e(this.object,"object",this)),this.index?this._ifNode(e(this.index,"index",this)):null,this._ifNode(e(this.value,"value",this)))},o.prototype.clone=function(){return new o(this.object,this.index,this.value)},o.prototype._toString=function(e){var t=this.object.toString(e),n=this.index?this.index.toString(e):"",r=this.value.toString(e);return s(this,e&&e.parenthesis)&&(r="("+r+")"),t+n+" = "+r},o.prototype.toJSON=function(){return{mathjs:"AssignmentNode",object:this.object,index:this.index,value:this.value}},o.fromJSON=function(e){return new o(e.object,e.index,e.value)},o.prototype.toHTML=function(e){var t=this.object.toHTML(e),n=this.index?this.index.toHTML(e):"",r=this.value.toHTML(e);return s(this,e&&e.parenthesis)&&(r='<span class="math-paranthesis math-round-parenthesis">(</span>'+r+'<span class="math-paranthesis math-round-parenthesis">)</span>'),t+n+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+r},o.prototype._toTex=function(e){var t=this.object.toTex(e),n=this.index?this.index.toTex(e):"",r=this.value.toTex(e);return s(this,e&&e.parenthesis)&&(r="\\left(".concat(r,"\\right)")),t+n+":="+r},o}),{isClass:!0,isNode:!0}),Ly=be("IndexNode",["Range","Node","size"],(e=>{var{Range:t,Node:n,size:r}=e;function i(e,t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(this.dimensions=e,this.dotNotation=t||!1,!Array.isArray(e)||!e.every(X))throw new TypeError('Array containing Nodes expected for parameter "dimensions"');if(this.dotNotation&&!this.isObjectProperty())throw new Error("dotNotation only applicable for object properties")}function a(e,n,r){return new t(b(e)?e.toNumber():e,b(n)?n.toNumber():n,b(r)?r.toNumber():r)}return i.prototype=new n,i.prototype.type="IndexNode",i.prototype.isIndexNode=!0,i.prototype._compile=function(e,t){var n=Zn(this.dimensions,(function(n,i){if(Q(n)){if(n.needsEnd()){var o=Object.create(t);o.end=!0;var s=n.start._compile(e,o),u=n.end._compile(e,o),c=n.step?n.step._compile(e,o):function(){return 1};return function(e,t,n){var o=r(n).valueOf(),l=Object.create(t);return l.end=o[i],a(s(e,l,n),u(e,l,n),c(e,l,n))}}var l=n.start._compile(e,t),f=n.end._compile(e,t),p=n.step?n.step._compile(e,t):function(){return 1};return function(e,t,n){return a(l(e,t,n),f(e,t,n),p(e,t,n))}}if(ee(n)&&"end"===n.name){var h=Object.create(t);h.end=!0;var d=n._compile(e,h);return function(e,t,n){var a=r(n).valueOf(),o=Object.create(t);return o.end=a[i],d(e,o,n)}}var m=n._compile(e,t);return function(e,t,n){return m(e,t,n)}})),i=lr(e,"index");return function(e,t,r){var a=Zn(n,(function(n){return n(e,t,r)}));return i(...a)}},i.prototype.forEach=function(e){for(var t=0;t<this.dimensions.length;t++)e(this.dimensions[t],"dimensions["+t+"]",this)},i.prototype.map=function(e){for(var t=[],n=0;n<this.dimensions.length;n++)t[n]=this._ifNode(e(this.dimensions[n],"dimensions["+n+"]",this));return new i(t,this.dotNotation)},i.prototype.clone=function(){return new i(this.dimensions.slice(0),this.dotNotation)},i.prototype.isObjectProperty=function(){return 1===this.dimensions.length&&$(this.dimensions[0])&&"string"==typeof this.dimensions[0].value},i.prototype.getObjectProperty=function(){return this.isObjectProperty()?this.dimensions[0].value:null},i.prototype._toString=function(e){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"},i.prototype.toJSON=function(){return{mathjs:"IndexNode",dimensions:this.dimensions,dotNotation:this.dotNotation}},i.fromJSON=function(e){return new i(e.dimensions,e.dotNotation)},i.prototype.toHTML=function(e){for(var t=[],n=0;n<this.dimensions.length;n++)t[n]=this.dimensions[n].toHTML();return this.dotNotation?'<span class="math-operator math-accessor-operator">.</span><span class="math-symbol math-property">'+In(this.getObjectProperty())+"</span>":'<span class="math-parenthesis math-square-parenthesis">[</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},i.prototype._toTex=function(e){var t=this.dimensions.map((function(t){return t.toTex(e)}));return this.dotNotation?"."+this.getObjectProperty():"_{"+t.join(",")+"}"},i}),{isClass:!0,isNode:!0}),jy=be("SymbolNode",["math","?Unit","Node"],(e=>{var{math:t,Unit:n,Node:r}=e;function i(e){return!!n&&n.isValuelessUnit(e)}function a(e){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof e)throw new TypeError('String expected for parameter "name"');this.name=e}return a.prototype=new r,a.prototype.type="SymbolNode",a.prototype.isSymbolNode=!0,a.prototype._compile=function(e,t){var r=this.name;if(!0===t[r])return function(e,t,n){return t[r]};if(r in e)return function(t,n,i){return t.has(r)?t.get(r):lr(e,r)};var o=i(r);return function(e,t,i){return e.has(r)?e.get(r):o?new n(null,r):a.onUndefinedSymbol(r)}},a.prototype.forEach=function(e){},a.prototype.map=function(e){return this.clone()},a.onUndefinedSymbol=function(e){throw new Error("Undefined symbol "+e)},a.prototype.clone=function(){return new a(this.name)},a.prototype._toString=function(e){return this.name},a.prototype.toHTML=function(e){var t=In(this.name);return"true"===t||"false"===t?'<span class="math-symbol math-boolean">'+t+"</span>":"i"===t?'<span class="math-symbol math-imaginary-symbol">'+t+"</span>":"Infinity"===t?'<span class="math-symbol math-infinity-symbol">'+t+"</span>":"NaN"===t?'<span class="math-symbol math-nan-symbol">'+t+"</span>":"null"===t?'<span class="math-symbol math-null-symbol">'+t+"</span>":"undefined"===t?'<span class="math-symbol math-undefined-symbol">'+t+"</span>":'<span class="math-symbol">'+t+"</span>"},a.prototype.toJSON=function(){return{mathjs:"SymbolNode",name:this.name}},a.fromJSON=function(e){return new a(e.name)},a.prototype._toTex=function(e){var n=!1;void 0===t[this.name]&&i(this.name)&&(n=!0);var r=Ey(this.name,n);return"\\"===r[0]?r:" "+r},a}),{isClass:!0,isNode:!0});function Uy(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"==typeof e.createSubScope?wr(e.createSubScope(),...n):wr(yr(),e,...n)}var qy=be("FunctionNode",["math","Node","SymbolNode"],(e=>{var{math:t,Node:n,SymbolNode:r}=e;function i(e,t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("string"==typeof e&&(e=new r(e)),!X(e))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(t)||!t.every(X))throw new TypeError('Array containing Nodes expected for parameter "args"');this.fn=e,this.args=t||[],Object.defineProperty(this,"name",{get:function(){return this.fn.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}i.prototype=new n,i.prototype.type="FunctionNode",i.prototype.isFunctionNode=!0,i.prototype._compile=function(e,t){if(!(this instanceof i))throw new TypeError("No valid FunctionNode");var n=this.args.map((n=>n._compile(e,t)));if(!ee(this.fn)){if(j(this.fn)&&K(this.fn.index)&&this.fn.index.isObjectProperty()){var r=this.fn.object._compile(e,t),a=this.fn.index.getObjectProperty(),o=this.args;return function(t,i,s){var u=r(t,i,s);if(function(e,t){if(!hr(e,t))throw new Error('No access to method "'+t+'"')}(u,a),u[a]&&u[a].rawArgs)return u[a](o,e,Uy(t,i),t);var c=n.map((e=>e(t,i,s)));return u[a].apply(u,c)}}var s=this.fn._compile(e,t),u=this.args;return function(t,r,i){var a=s(t,r,i);if(a&&a.rawArgs)return a(u,e,Uy(t,r),t);var o=n.map((e=>e(t,r,i)));return a.apply(a,o)}}var c=this.fn.name,l=c in e?lr(e,c):void 0,f="function"==typeof l&&!0===l.rawArgs,p=t=>t.has(c)?t.get(c):c in e?lr(e,c):i.onUndefinedFunction(c);if(f){var h=this.args;return function(t,n,r){return p(t)(h,e,Uy(t,n),t)}}switch(n.length){case 0:return function(e,t,n){return p(e)()};case 1:return function(e,t,r){return p(e)((0,n[0])(e,t,r))};case 2:return function(e,t,r){var i=p(e),a=n[0],o=n[1];return i(a(e,t,r),o(e,t,r))};default:return function(e,t,r){return p(e)(...n.map((n=>n(e,t,r))))}}},i.prototype.forEach=function(e){e(this.fn,"fn",this);for(var t=0;t<this.args.length;t++)e(this.args[t],"args["+t+"]",this)},i.prototype.map=function(e){for(var t=this._ifNode(e(this.fn,"fn",this)),n=[],r=0;r<this.args.length;r++)n[r]=this._ifNode(e(this.args[r],"args["+r+"]",this));return new i(t,n)},i.prototype.clone=function(){return new i(this.fn,this.args.slice(0))},i.onUndefinedFunction=function(e){throw new Error("Undefined function "+e)};var a=i.prototype.toString;function o(e,t,n){for(var r,i="",a=/\$(?:\{([a-z_][a-z_0-9]*)(?:\[([0-9]+)\])?\}|\$)/gi,o=0;null!==(r=a.exec(e));)if(i+=e.substring(o,r.index),o=r.index,"$$"===r[0])i+="$",o++;else{o+=r[0].length;var s=t[r[1]];if(!s)throw new ReferenceError("Template: Property "+r[1]+" does not exist.");if(void 0===r[2])switch(typeof s){case"string":i+=s;break;case"object":if(X(s))i+=s.toTex(n);else{if(!Array.isArray(s))throw new TypeError("Template: "+r[1]+" has to be a Node, String or array of Nodes");i+=s.map((function(e,t){if(X(e))return e.toTex(n);throw new TypeError("Template: "+r[1]+"["+t+"] is not a Node.")})).join(",")}break;default:throw new TypeError("Template: "+r[1]+" has to be a Node, String or array of Nodes")}else{if(!X(s[r[2]]&&s[r[2]]))throw new TypeError("Template: "+r[1]+"["+r[2]+"] is not a Node.");i+=s[r[2]].toTex(n)}}return i+e.slice(o)}i.prototype.toString=function(e){var t,n=this.fn.toString(e);return e&&"object"==typeof e.handler&&fe(e.handler,n)&&(t=e.handler[n](this,e)),void 0!==t?t:a.call(this,e)},i.prototype._toString=function(e){var t=this.args.map((function(t){return t.toString(e)}));return(H(this.fn)?"("+this.fn.toString(e)+")":this.fn.toString(e))+"("+t.join(", ")+")"},i.prototype.toJSON=function(){return{mathjs:"FunctionNode",fn:this.fn,args:this.args}},i.fromJSON=function(e){return new i(e.fn,e.args)},i.prototype.toHTML=function(e){var t=this.args.map((function(t){return t.toHTML(e)}));return'<span class="math-function">'+In(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'};var s=i.prototype.toTex;return i.prototype.toTex=function(e){var t;return e&&"object"==typeof e.handler&&fe(e.handler,this.name)&&(t=e.handler[this.name](this,e)),void 0!==t?t:s.call(this,e)},i.prototype._toTex=function(e){var n,r,i=this.args.map((function(t){return t.toTex(e)}));switch(by[this.name]&&(n=by[this.name]),!t[this.name]||"function"!=typeof t[this.name].toTex&&"object"!=typeof t[this.name].toTex&&"string"!=typeof t[this.name].toTex||(n=t[this.name].toTex),typeof n){case"function":r=n(this,e);break;case"string":r=o(n,this,e);break;case"object":switch(typeof n[i.length]){case"function":r=n[i.length](this,e);break;case"string":r=o(n[i.length],this,e)}}return void 0!==r?r:o("\\mathrm{${name}}\\left(${args}\\right)",this,e)},i.prototype.getIdentifier=function(){return this.type+":"+this.name},i}),{isClass:!0,isNode:!0}),Wy="parse",Vy=be(Wy,["typed","numeric","config","AccessorNode","ArrayNode","AssignmentNode","BlockNode","ConditionalNode","ConstantNode","FunctionAssignmentNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode","RangeNode","RelationalNode","SymbolNode"],(e=>{var{typed:t,numeric:n,config:r,AccessorNode:i,ArrayNode:a,AssignmentNode:o,BlockNode:s,ConditionalNode:u,ConstantNode:c,FunctionAssignmentNode:l,FunctionNode:f,IndexNode:p,ObjectNode:h,OperatorNode:d,ParenthesisNode:m,RangeNode:v,RelationalNode:y,SymbolNode:b}=e,x=t(Wy,{string:function(e){return R(e,{})},"Array | Matrix":function(e){return w(e,{})},"string, Object":function(e,t){return R(e,void 0!==t.nodes?t.nodes:{})},"Array | Matrix, Object":w});function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=void 0!==t.nodes?t.nodes:{};return _r(e,(function(e){if("string"!=typeof e)throw new TypeError("String expected");return R(e,n)}))}var E={",":!0,"(":!0,")":!0,"[":!0,"]":!0,"{":!0,"}":!0,'"':!0,"'":!0,";":!0,"+":!0,"-":!0,"*":!0,".*":!0,"/":!0,"./":!0,"%":!0,"^":!0,".^":!0,"~":!0,"!":!0,"&":!0,"|":!0,"^|":!0,"=":!0,":":!0,"?":!0,"==":!0,"!=":!0,"<":!0,">":!0,"<=":!0,">=":!0,"<<":!0,">>":!0,">>>":!0},C={mod:!0,to:!0,in:!0,and:!0,xor:!0,or:!0,not:!0},S={true:!0,false:!1,null:null,undefined:void 0},N=["NaN","Infinity"];function A(e,t){return e.expression.substr(e.index,t)}function k(e){return A(e,1)}function D(e){e.index++}function _(e){return e.expression.charAt(e.index-1)}function M(e){return e.expression.charAt(e.index+1)}function T(e){for(e.tokenType=0,e.token="",e.comment="";x.isWhitespace(k(e),e.nestingLevel);)D(e);if("#"===k(e))for(;"\n"!==k(e)&&""!==k(e);)e.comment+=k(e),D(e);if(""!==k(e)){if("\n"===k(e)&&!e.nestingLevel)return e.tokenType=1,e.token=k(e),void D(e);var t=k(e),n=A(e,2),r=A(e,3);if(3===r.length&&E[r])return e.tokenType=1,e.token=r,D(e),D(e),void D(e);if(2===n.length&&E[n])return e.tokenType=1,e.token=n,D(e),void D(e);if(E[t])return e.tokenType=1,e.token=t,void D(e);if(x.isDigitDot(t)){e.tokenType=2;var i=A(e,2);if("0b"===i||"0o"===i||"0x"===i){for(e.token+=k(e),D(e),e.token+=k(e),D(e);x.isHexDigit(k(e));)e.token+=k(e),D(e);if("."===k(e))for(e.token+=".",D(e);x.isHexDigit(k(e));)e.token+=k(e),D(e);else if("i"===k(e))for(e.token+="i",D(e);x.isDigit(k(e));)e.token+=k(e),D(e);return}if("."===k(e)){if(e.token+=k(e),D(e),!x.isDigit(k(e)))return void(e.tokenType=1)}else{for(;x.isDigit(k(e));)e.token+=k(e),D(e);x.isDecimalMark(k(e),M(e))&&(e.token+=k(e),D(e))}for(;x.isDigit(k(e));)e.token+=k(e),D(e);if("E"===k(e)||"e"===k(e))if(x.isDigit(M(e))||"-"===M(e)||"+"===M(e)){if(e.token+=k(e),D(e),"+"!==k(e)&&"-"!==k(e)||(e.token+=k(e),D(e)),!x.isDigit(k(e)))throw ue(e,'Digit expected, got "'+k(e)+'"');for(;x.isDigit(k(e));)e.token+=k(e),D(e);if(x.isDecimalMark(k(e),M(e)))throw ue(e,'Digit expected, got "'+k(e)+'"')}else if("."===M(e))throw D(e),ue(e,'Digit expected, got "'+k(e)+'"')}else{if(!x.isAlpha(k(e),_(e),M(e))){for(e.tokenType=4;""!==k(e);)e.token+=k(e),D(e);throw ue(e,'Syntax error in part "'+e.token+'"')}for(;x.isAlpha(k(e),_(e),M(e))||x.isDigit(k(e));)e.token+=k(e),D(e);fe(C,e.token)?e.tokenType=1:e.tokenType=3}}else e.tokenType=1}function O(e){do{T(e)}while("\n"===e.token)}function I(e){e.nestingLevel++}function F(e){e.nestingLevel--}function R(e,t){var n={extraNodes:{},expression:"",comment:"",index:0,token:"",tokenType:0,nestingLevel:0,conditionalLevel:null};g(n,{expression:e,extraNodes:t}),T(n);var r=function(e){var t,n,r=[];for(""!==e.token&&"\n"!==e.token&&";"!==e.token&&((t=B(e)).comment=e.comment);"\n"===e.token||";"===e.token;)0===r.length&&t&&(n=";"!==e.token,r.push({node:t,visible:n})),T(e),"\n"!==e.token&&";"!==e.token&&""!==e.token&&((t=B(e)).comment=e.comment,n=";"!==e.token,r.push({node:t,visible:n}));return r.length>0?new s(r):(t||((t=new c(void 0)).comment=e.comment),t)}(n);if(""!==n.token)throw 1===n.tokenType?ce(n,"Unexpected operator "+n.token):ue(n,'Unexpected part "'+n.token+'"');return r}function B(e){var t,n,r,i,a=function(e){for(var t=function(e){for(var t=z(e);"or"===e.token;)O(e),t=new d("or","or",[t,z(e)]);return t}(e);"?"===e.token;){var n=e.conditionalLevel;e.conditionalLevel=e.nestingLevel,O(e);var r=t,i=B(e);if(":"!==e.token)throw ue(e,"False part of conditional expression expected");e.conditionalLevel=null,O(e);var a=B(e);t=new u(r,i,a),e.conditionalLevel=n}return t}(e);if("="===e.token){if(ee(a))return t=a.name,O(e),r=B(e),new o(new b(t),r);if(j(a))return O(e),r=B(e),new o(a.object,a.index,r);if(G(a)&&ee(a.fn)&&(i=!0,n=[],t=a.name,a.args.forEach((function(e,t){ee(e)?n[t]=e.name:i=!1})),i))return O(e),r=B(e),new l(t,n,r);throw ue(e,"Invalid left hand side of assignment operator =")}return a}function z(e){for(var t=P(e);"xor"===e.token;)O(e),t=new d("xor","xor",[t,P(e)]);return t}function P(e){for(var t=L(e);"and"===e.token;)O(e),t=new d("and","and",[t,L(e)]);return t}function L(e){for(var t=U(e);"|"===e.token;)O(e),t=new d("|","bitOr",[t,U(e)]);return t}function U(e){for(var t=q(e);"^|"===e.token;)O(e),t=new d("^|","bitXor",[t,q(e)]);return t}function q(e){for(var t=W(e);"&"===e.token;)O(e),t=new d("&","bitAnd",[t,W(e)]);return t}function W(e){for(var t=[V(e)],n=[],r={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};fe(r,e.token);){var i={name:e.token,fn:r[e.token]};n.push(i),O(e),t.push(V(e))}return 1===t.length?t[0]:2===t.length?new d(n[0].name,n[0].fn,t):new y(n.map((e=>e.fn)),t)}function V(e){var t,n,r,i;t=H(e);for(var a={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};fe(a,e.token);)r=a[n=e.token],O(e),i=[t,H(e)],t=new d(n,r,i);return t}function H(e){var t,n,r,i;t=K(e);for(var a={to:"to",in:"to"};fe(a,e.token);)r=a[n=e.token],O(e),"in"===n&&""===e.token?t=new d("*","multiply",[t,new b("in")],!0):(i=[t,K(e)],t=new d(n,r,i));return t}function K(e){var t,n=[];if(t=":"===e.token?new c(1):X(e),":"===e.token&&e.conditionalLevel!==e.nestingLevel){for(n.push(t);":"===e.token&&n.length<3;)O(e),")"===e.token||"]"===e.token||","===e.token||""===e.token?n.push(new b("end")):n.push(X(e));t=3===n.length?new v(n[0],n[2],n[1]):new v(n[0],n[1])}return t}function X(e){var t,n,r,i;t=Y(e);for(var a={"+":"add","-":"subtract"};fe(a,e.token);){r=a[n=e.token],O(e);var o=Y(e);i=o.isPercentage?[t,new d("*","multiply",[t,o])]:[t,o],t=new d(n,r,i)}return t}function Y(e){var t,n,r,i;n=t=Z(e);for(var a={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide"};fe(a,e.token);)i=a[r=e.token],O(e),n=Z(e),t=new d(r,i,[t,n]);return t}function Z(e){var t,n;for(n=t=Q(e);3===e.tokenType||"in"===e.token&&$(t)||!(2!==e.tokenType||$(n)||J(n)&&"!"!==n.op)||"("===e.token;)n=Q(e),t=new d("*","multiply",[t,n],!0);return t}function Q(e){for(var t=te(e),n=t,r=[];"/"===e.token&&$(n);){if(r.push(g({},e)),O(e),2!==e.tokenType){g(e,r.pop());break}if(r.push(g({},e)),O(e),3!==e.tokenType&&"("!==e.token){r.pop(),g(e,r.pop());break}g(e,r.pop()),r.pop(),n=te(e),t=new d("/","divide",[t,n])}return t}function te(e){var t,n,r,i;t=ne(e);for(var a={"%":"mod",mod:"mod"};fe(a,e.token);)r=a[n=e.token],O(e),"%"===n&&1===e.tokenType&&"("!==e.token?t=new d("/","divide",[t,new c(100)],!1,!0):(i=[t,ne(e)],t=new d(n,r,i));return t}function ne(e){var t,i,o,s={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};return fe(s,e.token)?(o=s[e.token],t=e.token,O(e),i=[ne(e)],new d(t,o,i)):function(e){var t,i,o,s;return t=function(e){var t,i,o;t=function(e){var t=[];if(3===e.tokenType&&fe(e.extraNodes,e.token)){var i=e.extraNodes[e.token];if(T(e),"("===e.token){if(t=[],I(e),T(e),")"!==e.token)for(t.push(B(e));","===e.token;)T(e),t.push(B(e));if(")"!==e.token)throw ue(e,"Parenthesis ) expected");F(e),T(e)}return new i(t)}return function(e){var t;return 3===e.tokenType||1===e.tokenType&&e.token in C?(t=e.token,T(e),re(e,fe(S,t)?new c(S[t]):-1!==N.indexOf(t)?new c(n(t,"number")):new b(t))):function(e){var t;return'"'===e.token?(t=ie(e),re(e,new c(t))):function(e){var t;return"'"===e.token?(t=ae(e),re(e,new c(t))):function(e){var t,i,o,s;if("["===e.token){if(I(e),T(e),"]"!==e.token){var u=oe(e);if(";"===e.token){for(o=1,i=[u];";"===e.token;)T(e),i[o]=oe(e),o++;if("]"!==e.token)throw ue(e,"End of matrix ] expected");F(e),T(e),s=i[0].items.length;for(var l=1;l<o;l++)if(i[l].items.length!==s)throw ce(e,"Column dimensions mismatch ("+i[l].items.length+" !== "+s+")");t=new a(i)}else{if("]"!==e.token)throw ue(e,"End of matrix ] expected");F(e),T(e),t=u}}else F(e),T(e),t=new a([]);return re(e,t)}return function(e){if("{"===e.token){var t;I(e);var i={};do{if(T(e),"}"!==e.token){if('"'===e.token)t=ie(e);else if("'"===e.token)t=ae(e);else{if(!(3===e.tokenType||1===e.tokenType&&e.token in C))throw ue(e,"Symbol or string expected as object key");t=e.token,T(e)}if(":"!==e.token)throw ue(e,"Colon : expected after object key");T(e),i[t]=B(e)}}while(","===e.token);if("}"!==e.token)throw ue(e,"Comma , or bracket } expected after object value");F(e),T(e);var a=new h(i);return re(e,a)}return function(e){var t;return 2===e.tokenType?(t=e.token,T(e),new c(n(t,r.number))):function(e){var t;if("("===e.token){if(I(e),T(e),t=B(e),")"!==e.token)throw ue(e,"Parenthesis ) expected");return F(e),T(e),re(e,t=new m(t))}return function(e){throw""===e.token?ue(e,"Unexpected end of expression"):ue(e,"Value expected")}(e)}(e)}(e)}(e)}(e)}(e)}(e)}(e)}(e);for(var s={"!":"factorial","'":"ctranspose"};fe(s,e.token);)o=s[i=e.token],T(e),t=re(e,t=new d(i,o,[t]));return t}(e),("^"===e.token||".^"===e.token)&&(o="^"===(i=e.token)?"pow":"dotPow",O(e),s=[t,ne(e)],t=new d(i,o,s)),t}(e)}function re(e,t,n){for(var r;!("("!==e.token&&"["!==e.token&&"."!==e.token||n&&-1===n.indexOf(e.token));)if(r=[],"("===e.token){if(!ee(t)&&!j(t))return t;if(I(e),T(e),")"!==e.token)for(r.push(B(e));","===e.token;)T(e),r.push(B(e));if(")"!==e.token)throw ue(e,"Parenthesis ) expected");F(e),T(e),t=new f(t,r)}else if("["===e.token){if(I(e),T(e),"]"!==e.token)for(r.push(B(e));","===e.token;)T(e),r.push(B(e));if("]"!==e.token)throw ue(e,"Parenthesis ] expected");F(e),T(e),t=new i(t,new p(r))}else{if(T(e),3!==e.tokenType)throw ue(e,"Property name expected after dot");r.push(new c(e.token)),T(e),t=new i(t,new p(r,!0))}return t}function ie(e){for(var t="";""!==k(e)&&'"'!==k(e);)"\\"===k(e)&&(t+=k(e),D(e)),t+=k(e),D(e);if(T(e),'"'!==e.token)throw ue(e,'End of string " expected');return T(e),JSON.parse('"'+t+'"')}function ae(e){for(var t="";""!==k(e)&&"'"!==k(e);)"\\"===k(e)&&(t+=k(e),D(e)),t+=k(e),D(e);if(T(e),"'"!==e.token)throw ue(e,"End of string ' expected");return T(e),JSON.parse('"'+t+'"')}function oe(e){for(var t=[B(e)],n=1;","===e.token;)T(e),t[n]=B(e),n++;return new a(t)}function se(e){return e.index-e.token.length+1}function ue(e,t){var n=se(e),r=new SyntaxError(t+" (char "+n+")");return r.char=n,r}function ce(e,t){var n=se(e),r=new SyntaxError(t+" (char "+n+")");return r.char=n,r}return x.isAlpha=function(e,t,n){return x.isValidLatinOrGreek(e)||x.isValidMathSymbol(e,n)||x.isValidMathSymbol(t,e)},x.isValidLatinOrGreek=function(e){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(e)},x.isValidMathSymbol=function(e,t){return/^[\uD835]$/.test(e)&&/^[\uDC00-\uDFFF]$/.test(t)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(t)},x.isWhitespace=function(e,t){return" "===e||"\t"===e||"\n"===e&&t>0},x.isDecimalMark=function(e,t){return"."===e&&"/"!==t&&"*"!==t&&"^"!==t},x.isDigitDot=function(e){return e>="0"&&e<="9"||"."===e},x.isDigit=function(e){return e>="0"&&e<="9"},x.isHexDigit=function(e){return e>="0"&&e<="9"||e>="a"&&e<="f"||e>="A"&&e<="F"},x})),$y="compile",Hy=be($y,["typed","parse"],(e=>{var{typed:t,parse:n}=e;return t($y,{string:function(e){return n(e).compile()},"Array | Matrix":function(e){return _r(e,(function(e){return n(e).compile()}))}})})),Gy="evaluate",Ky=be(Gy,["typed","parse"],(e=>{var{typed:t,parse:n}=e;return t(Gy,{string:function(e){var t=yr();return n(e).compile().evaluate(t)},"string, Map | Object":function(e,t){return n(e).compile().evaluate(t)},"Array | Matrix":function(e){var t=yr();return _r(e,(function(e){return n(e).compile().evaluate(t)}))},"Array | Matrix, Map | Object":function(e,t){return _r(e,(function(e){return n(e).compile().evaluate(t)}))}})})),Xy=be("Help",["parse"],(e=>{var{parse:t}=e;function n(e){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(!e)throw new Error('Argument "doc" missing');this.doc=e}return n.prototype.type="Help",n.prototype.isHelp=!0,n.prototype.toString=function(){var e=this.doc||{},n="\n";if(e.name&&(n+="Name: "+e.name+"\n\n"),e.category&&(n+="Category: "+e.category+"\n\n"),e.description&&(n+="Description:\n    "+e.description+"\n\n"),e.syntax&&(n+="Syntax:\n    "+e.syntax.join("\n    ")+"\n\n"),e.examples){n+="Examples:\n";for(var r={},i=0;i<e.examples.length;i++){var a=e.examples[i];n+="    "+a+"\n";var o=void 0;try{o=t(a).compile().evaluate(r)}catch(e){o=e}void 0===o||I(o)||(n+="        "+Tn(o,{precision:14})+"\n")}n+="\n"}return e.seealso&&e.seealso.length&&(n+="See also: "+e.seealso.join(", ")+"\n"),n},n.prototype.toJSON=function(){var e=re(this.doc);return e.mathjs="Help",e},n.fromJSON=function(e){var t={};return Object.keys(e).filter((e=>"mathjs"!==e)).forEach((n=>{t[n]=e[n]})),new n(t)},n.prototype.valueOf=n.prototype.toString,n}),{isClass:!0}),Yy=be("Parser",["evaluate"],(e=>{var{evaluate:t}=e;function n(){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");Object.defineProperty(this,"scope",{value:yr(),writable:!1})}return n.prototype.type="Parser",n.prototype.isParser=!0,n.prototype.evaluate=function(e){return t(e,this.scope)},n.prototype.get=function(e){if(this.scope.has(e))return this.scope.get(e)},n.prototype.getAll=function(){return function(e){if(e instanceof vr)return e.wrappedObject;var t={};for(var n of e.keys())fr(t,n,e.get(n));return t}(this.scope)},n.prototype.getAllAsMap=function(){return this.scope},n.prototype.set=function(e,t){return this.scope.set(e,t),t},n.prototype.remove=function(e){this.scope.delete(e)},n.prototype.clear=function(){this.scope.clear()},n}),{isClass:!0}),Jy="parser",Zy=be(Jy,["typed","Parser"],(e=>{var{typed:t,Parser:n}=e;return t(Jy,{"":function(){return new n}})})),Qy=be("simplifyUtil",["FunctionNode","OperatorNode","SymbolNode"],(e=>{var{FunctionNode:t,OperatorNode:n,SymbolNode:r}=e,i={add:!0,multiply:!0},a={add:!0,multiply:!0};function o(e,t){if(!J(e))return!1;var n=e.fn.toString();return t&&fe(t,n)&&fe(t[n],"associative")?t[n].associative:a[n]||!1}function s(e){var t,n=[];return o(e)?(t=e.op,function e(r){for(var i=0;i<r.args.length;i++){var a=r.args[i];J(a)&&t===a.op?e(a):n.push(a)}}(e),n):e.args}function u(e){return J(e)?function(t){try{return new n(e.op,e.fn,t,e.implicit)}catch(e){return console.error(e),[]}}:function(n){return new t(new r(e.name),n)}}return{createMakeNodeFunction:u,isCommutative:function(e,t){if(!J(e))return!0;var n=e.fn.toString();return t&&fe(t,n)&&fe(t[n],"commutative")?t[n].commutative:i[n]||!1},isAssociative:o,flatten:function e(t){if(!t.args||0===t.args.length)return t;t.args=s(t);for(var n=0;n<t.args.length;n++)e(t.args[n])},allChildren:s,unflattenr:function e(t){if(t.args&&0!==t.args.length){for(var n=u(t),r=t.args.length,i=0;i<r;i++)e(t.args[i]);if(r>2&&o(t)){for(var a=t.args.pop();t.args.length>0;)a=n([t.args.pop(),a]);t.args=a.args}}},unflattenl:function e(t){if(t.args&&0!==t.args.length){for(var n=u(t),r=t.args.length,i=0;i<r;i++)e(t.args[i]);if(r>2&&o(t)){for(var a=t.args.shift();t.args.length>0;)a=n([a,t.args.shift()]);t.args=a.args}}}}})),eb=be("simplifyCore",["equal","isZero","add","subtract","multiply","divide","pow","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode"],(e=>{var{equal:t,isZero:n,add:r,subtract:i,multiply:a,divide:o,pow:s,AccessorNode:u,ArrayNode:c,ConstantNode:l,FunctionNode:f,IndexNode:p,ObjectNode:h,OperatorNode:d,ParenthesisNode:m}=e,g=new l(0),v=new l(1);function y(e){return e.map(b).map((function(e){return Z(e)?e.content:e}))}function b(e){if(J(e)&&e.isUnary()){var x=b(e.args[0]);if("+"===e.op)return x;if("-"===e.op){if(J(x)){if(x.isUnary()&&"-"===x.op)return x.args[0];if(x.isBinary()&&"subtract"===x.fn)return new d("-","subtract",[x.args[1],x.args[0]])}return new d(e.op,e.fn,[x])}}else if(J(e)&&e.isBinary()){var w=b(e.args[0]),E=b(e.args[1]);if("+"===e.op){if($(w)){if(n(w.value))return E;if($(E))return new l(r(w.value,E.value))}return $(E)&&n(E.value)?w:J(E)&&E.isUnary()&&"-"===E.op?new d("-","subtract",[w,E.args[0]]):new d(e.op,e.fn,E?[w,E]:[w])}if("-"===e.op){if($(w)&&E){if($(E))return new l(i(w.value,E.value));if(n(w.value))return new d("-","unaryMinus",[E])}if("subtract"===e.fn)return $(E)&&n(E.value)?w:J(E)&&E.isUnary()&&"-"===E.op?b(new d("+","add",[w,E.args[0]])):new d(e.op,e.fn,[w,E])}else{if("*"===e.op){if($(w)){if(n(w.value))return g;if(t(w.value,1))return E;if($(E))return new l(a(w.value,E.value))}if($(E)){if(n(E.value))return g;if(t(E.value,1))return w;if(J(w)&&w.isBinary()&&w.op===e.op){var C=w.args[0];if($(C)){var S=new l(a(C.value,E.value));return new d(e.op,e.fn,[S,w.args[1]],e.implicit)}}return new d(e.op,e.fn,[E,w],e.implicit)}return new d(e.op,e.fn,[w,E],e.implicit)}if("/"===e.op){if($(w)){if(n(w.value))return g;if($(E)&&(t(E.value,1)||t(E.value,2)||t(E.value,4)))return new l(o(w.value,E.value))}return new d(e.op,e.fn,[w,E])}if("^"===e.op){if($(E)){if(n(E.value))return v;if(t(E.value,1))return w;if($(w))return new l(s(w.value,E.value));if(J(w)&&w.isBinary()&&"^"===w.op){var N=w.args[1];if($(N))return new d(e.op,e.fn,[w.args[0],new l(a(N.value,E.value))])}}return new d(e.op,e.fn,[w,E])}}}else{if(Z(e)){var A=b(e.content);return Z(A)||ee(A)||$(A)?A:new m(A)}if(G(e))return new f(b(e.fn),y(e.args));if(U(e))return new c(y(e.items));if(j(e)){var k=y(e.object);return Z(k)&&(k=k.content),new u(k,b(e.index))}if(K(e))return new p(y(e.dimensions));if(Y(e)){var D={};for(var _ in e.properties)D[_]=b(e.properties[_]);return new h(D)}}return e}return b})),tb=be("simplifyConstant",["typed","config","mathWithTransform","matrix","?fraction","?bignumber","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","SymbolNode"],(e=>{var{typed:t,config:n,mathWithTransform:r,matrix:i,fraction:a,bignumber:o,AccessorNode:s,ArrayNode:u,ConstantNode:c,FunctionNode:l,IndexNode:f,ObjectNode:p,OperatorNode:h,SymbolNode:d}=e,{isCommutative:m,isAssociative:g,allChildren:v,createMakeNodeFunction:y}=Qy({FunctionNode:l,OperatorNode:h,SymbolNode:d});function b(e,t){return S(M(e,t))}function x(e){return w(e)?e.valueOf():e instanceof Array?e.map(x):N(e)?i(x(e.valueOf())):e}function E(e,t,n){try{return r[e].apply(null,t)}catch(i){return t=t.map(x),k(r[e].apply(null,t),n)}}var C=t({Fraction:function(e){var t,n=e.s*e.n;return t=n<0?new h("-","unaryMinus",[new c(-n)]):new c(n),1===e.d?t:new h("/","divide",[t,new c(e.d)])},number:function(e){return e<0?D(new c(-e)):new c(e)},BigNumber:function(e){return e<0?D(new c(-e)):new c(e)},Complex:function(e){throw new Error("Cannot convert Complex number to Node")},string:function(e){return new c(e)},Matrix:function(e){return new u(e.valueOf().map((e=>C(e))))}});function S(e){return X(e)?e:C(e)}function A(e,t){if(t&&!1!==t.exactFractions&&isFinite(e)&&a){var n=a(e),r=t&&"number"==typeof t.fractionsLimit?t.fractionsLimit:1/0;if(n.valueOf()===e&&n.n<r&&n.d<r)return n}return e}var k=t({"string, Object":function(e,t){return"BigNumber"===n.number?(void 0===o&&Hs(),o(e)):"Fraction"===n.number?(void 0===a&&Gs(),a(e)):A(parseFloat(e),t)},"Fraction, Object":function(e,t){return e},"BigNumber, Object":function(e,t){return e},"number, Object":function(e,t){return A(e,t)},"Complex, Object":function(e,t){return 0!==e.im?e:A(e.re,t)},"Matrix, Object":function(e,t){return i(A(e.valueOf()))},"Array, Object":function(e,t){return e.map(A)}});function D(e){return new h("-","unaryMinus",[e])}function _(e,t,n,r){return t.reduce((function(t,i){if(X(t)||X(i))X(t)?X(i)||(i=C(i)):t=C(t);else{try{return E(e,[t,i],r)}catch(e){}t=C(t),i=C(i)}return n([t,i])}))}function M(e,t){switch(e.type){case"SymbolNode":return e;case"ConstantNode":switch(typeof e.value){case"number":return k(e.value,t);case"string":return e.value;default:if(!isNaN(e.value))return k(e.value,t)}return e;case"FunctionNode":if(r[e.name]&&r[e.name].rawArgs)return e;if(-1===["add","multiply"].indexOf(e.name)){var n=e.args.map((e=>M(e,t)));if(!n.some(X))try{return E(e.name,n,t)}catch(e){}if("size"===e.name&&1===n.length&&U(n[0])){for(var a=[],o=n[0];U(o);)a.push(o.items.length),o=o.items[0];return i(a)}return new l(e.name,n.map(S))}case"OperatorNode":var h,d,x=e.fn.toString(),w=y(e);if(J(e)&&e.isUnary())d=X((h=[M(e.args[0],t)])[0])?w(h):E(x,h,t);else if(g(e))if(h=(h=v(e)).map((e=>M(e,t))),m(x)){for(var C=[],A=[],D=0;D<h.length;D++)X(h[D])?A.push(h[D]):C.push(h[D]);C.length>1?(d=_(x,C,w,t),A.unshift(d),d=_(x,A,w,t)):d=_(x,h,w,t)}else d=_(x,h,w,t);else h=e.args.map((e=>M(e,t))),d=_(x,h,w,t);return d;case"ParenthesisNode":return M(e.content,t);case"AccessorNode":return function(e,t,n){if(!K(t))return new s(S(e),S(t));if(U(e)||N(e)){for(var r=Array.from(t.dimensions);r.length>0;)if($(r[0])&&"string"!=typeof r[0].value){var a=k(r.shift().value,n);U(e)?e=e.items[a-1]:(e=e.valueOf()[a-1])instanceof Array&&(e=i(e))}else{if(!(r.length>1&&$(r[1])&&"string"!=typeof r[1].value))break;var o=k(r[1].value,n),l=[],p=U(e)?e.items:e.valueOf();for(var h of p)if(U(h))l.push(h.items[o-1]);else{if(!N(e))break;l.push(h[o-1])}if(l.length!==p.length)break;e=U(e)?new u(l):i(l),r.splice(1,1)}return r.length===t.dimensions.length?new s(S(e),t):r.length>0?(t=new f(r),new s(S(e),t)):e}if(Y(e)&&1===t.dimensions.length&&$(t.dimensions[0])){var d=t.dimensions[0].value;return d in e.properties?e.properties[d]:new c}return new s(S(e),t)}(M(e.object,t),M(e.index,t),t);case"ArrayNode":var T=e.items.map((e=>M(e,t)));return T.some(X)?new u(T.map(S)):i(T);case"IndexNode":return new f(e.dimensions.map((e=>b(e,t))));case"ObjectNode":var O={};for(var I in e.properties)O[I]=b(e.properties[I],t);return new p(O);default:throw new Error("Unimplemented node type in simplifyConstant: ".concat(e.type))}}return b})),nb=be("resolve",["parse","FunctionNode","OperatorNode","ParenthesisNode"],(e=>{var{parse:t,FunctionNode:n,OperatorNode:r,ParenthesisNode:i}=e;return function e(a,o){if(!o)return a;if(xr(o)||(o=br(o)),ee(a)){var s=o.get(a.name);if(X(s))return e(s,o);if("number"==typeof s)return t(String(s))}else{if(J(a)){var u=a.args.map((function(t){return e(t,o)}));return new r(a.op,a.fn,u,a.implicit)}if(Z(a))return new i(e(a.content,o));if(G(a)){var c=a.args.map((function(t){return e(t,o)}));return new n(a.name,c)}}return a}})),rb=be("simplify",["config","typed","parse","add","subtract","multiply","divide","pow","isZero","equal","?fraction","?bignumber","mathWithTransform","matrix","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode","SymbolNode"],(e=>{var{config:t,typed:n,parse:r,add:i,subtract:a,multiply:o,divide:s,pow:u,isZero:c,equal:l,fraction:f,bignumber:p,mathWithTransform:h,matrix:d,AccessorNode:m,ArrayNode:g,ConstantNode:v,FunctionNode:y,IndexNode:b,ObjectNode:x,OperatorNode:w,ParenthesisNode:E,SymbolNode:C}=e,S=tb({typed:n,config:t,mathWithTransform:h,matrix:d,fraction:f,bignumber:p,AccessorNode:m,ArrayNode:g,ConstantNode:v,FunctionNode:y,IndexNode:b,ObjectNode:x,OperatorNode:w,SymbolNode:C}),N=eb({equal:l,isZero:c,add:i,subtract:a,multiply:o,divide:s,pow:u,AccessorNode:m,ArrayNode:g,ConstantNode:v,FunctionNode:y,IndexNode:b,ObjectNode:x,OperatorNode:w,ParenthesisNode:E}),A=nb({parse:r,FunctionNode:y,OperatorNode:w,ParenthesisNode:E}),{isCommutative:k,isAssociative:D,flatten:_,unflattenr:M,unflattenl:T,createMakeNodeFunction:O}=Qy({FunctionNode:y,OperatorNode:w,SymbolNode:C}),I=n("simplify",{string:function(e){return this(r(e),this.rules,yr(),{})},"string, Map | Object":function(e,t){return this(r(e),this.rules,t,{})},"string, Map | Object, Object":function(e,t,n){return this(r(e),this.rules,t,n)},"string, Array":function(e,t){return this(r(e),t,yr(),{})},"string, Array, Map | Object":function(e,t,n){return this(r(e),t,n,{})},"string, Array, Map | Object, Object":function(e,t,n,i){return this(r(e),t,n,i)},"Node, Map | Object":function(e,t){return this(e,this.rules,t,{})},"Node, Map | Object, Object":function(e,t,n){return this(e,this.rules,t,n)},Node:function(e){return this(e,this.rules,yr(),{})},"Node, Array":function(e,t){return this(e,t,yr(),{})},"Node, Array, Map | Object":function(e,t,n){return this(e,t,n,{})},"Node, Array, Object, Object":function(e,t,n,r){return this(e,t,br(n),r)},"Node, Array, Map, Object":function(e,t,n,i){t=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=void 0,o=typeof i;switch(o){case"string":var s=i.split("->");if(2!==s.length)throw SyntaxError("Could not parse rule: "+i);i={l:s[0],r:s[1]};case"object":if(a={l:F(r(i.l)),r:F(r(i.r))},i.context&&(a.context=i.context),i.evaluate&&(a.evaluate=r(i.evaluate)),D(a.l)){var u=O(a.l),c=new C("_p"+B++);a.expanded={},a.expanded.l=u([a.l.clone(),c]),_(a.expanded.l),M(a.expanded.l),a.expanded.r=u([a.r,c])}break;case"function":a=i;break;default:throw TypeError("Unsupported type of rule: "+o)}t.push(a)}return t}(t);for(var a=A(e,n),o={},s=(a=F(a)).toString({parenthesis:"all"});!o[s];){o[s]=!0,B=0;for(var u=0;u<t.length;u++)"function"==typeof t[u]?a=t[u](a,i):(_(a),a=P(a,t[u])),T(a);s=a.toString({parenthesis:"all"})}return a}});function F(e){return e.transform((function(e,t,n){return Z(e)?F(e.content):e}))}I.simplifyCore=N,I.resolve=A;var R={true:!0,false:!0,e:!0,i:!0,Infinity:!0,LN2:!0,LN10:!0,LOG2E:!0,LOG10E:!0,NaN:!0,phi:!0,pi:!0,SQRT1_2:!0,SQRT2:!0,tau:!0};I.rules=[N,{l:"log(e)",r:"1"},{l:"n-n1",r:"n+-n1"},{l:"-(c*v)",r:"v * (-c)"},{l:"-v",r:"v * (-1)"},{l:"n/n1^n2",r:"n*n1^-n2"},{l:"n/n1",r:"n*n1^-1"},{l:"n1 + (n2 + n3)*(-1)",r:"n1 + n2*(-1) + n3*(-1)"},{l:"(-1) * c",r:"-c"},{l:"(-1) * (-c)",r:"c"},{l:"(n ^ n1) ^ n2",r:"n ^ (n1 * n2)"},{l:"n*n",r:"n^2"},{l:"n * n^n1",r:"n^(n1+1)"},{l:"n^n1 * n^n2",r:"n^(n1+n2)"},{l:"n+n",r:"2*n"},{l:"n+-n",r:"0"},{l:"v*n + v",r:"v*(n+1)"},{l:"n3*n1 + n3*n2",r:"n3*(n1+n2)"},{l:"n*c + c",r:"(n+1)*c"},S,{l:"(-n)*n1",r:"-(n*n1)"},{l:"c+v",r:"v+c",context:{add:{commutative:!1}}},{l:"v*c",r:"c*v",context:{multiply:{commutative:!1}}},{l:"n+-n1",r:"n-n1"},{l:"n*(n1^-1)",r:"n/n1"},{l:"n*n1^-n2",r:"n/n1^n2"},{l:"n1^-1",r:"1/n1"},{l:"n*(n1/n2)",r:"(n*n1)/n2"},{l:"n-(n1+n2)",r:"n-n1-n2"},{l:"1*n",r:"n"},{l:"n1/(n2/n3)",r:"(n1*n3)/n2"},{l:"n1/(-n2)",r:"-n1/n2"}];var B=0;function z(e,t){if(e)for(var n=0;n<e.length;++n)e[n]=P(e[n],t)}var P=n("applyRule",{"Node, Object":function(e,t){var n=e;if(n instanceof w||n instanceof y)z(n.args,t);else if(n instanceof E)n.content&&(n.content=P(n.content,t));else if(n instanceof g)z(n.items,t);else if(n instanceof m)n.object&&(n.object=P(n.object,t)),n.index&&(n.index=P(n.index,t));else if(n instanceof b)z(n.dimensions,t);else if(n instanceof x)for(var r in n.properties)n.properties[r]=P(n.properties[r],t);var i=t.r,a=U(t.l,n)[0];if(!a&&t.expanded&&(i=t.expanded.r,a=U(t.expanded.l,n)[0]),a){var o=n.implicit;n=i.clone(),o&&"implicit"in i&&(n.implicit=!0),n=n.transform((function(e){return e.isSymbolNode&&fe(a.placeholders,e.name)?a.placeholders[e.name].clone():e}))}return n}});function L(e,t){var n={placeholders:{}};if(!e.placeholders&&!t.placeholders)return n;if(!e.placeholders)return t;if(!t.placeholders)return e;for(var r in e.placeholders)if(fe(e.placeholders,r)&&(n.placeholders[r]=e.placeholders[r],fe(t.placeholders,r)&&!q(e.placeholders[r],t.placeholders[r])))return null;for(var i in t.placeholders)fe(t.placeholders,i)&&(n.placeholders[i]=t.placeholders[i]);return n}function j(e,t){var n,r=[];if(0===e.length||0===t.length)return r;for(var i=0;i<e.length;i++)for(var a=0;a<t.length;a++)(n=L(e[i],t[a]))&&r.push(n);return r}function U(e,t,n){var r=[{placeholders:{}}];if(e instanceof w&&t instanceof w||e instanceof y&&t instanceof y){if(e instanceof w){if(e.op!==t.op||e.fn!==t.fn)return[]}else if(e instanceof y&&e.name!==t.name)return[];if(!(1===t.args.length&&1===e.args.length||!D(t)&&t.args.length===e.args.length||n)){if(t.args.length>=2&&2===e.args.length){for(var i=function(e,t){var n,r,i=[],a=O(e);if(k(e,t))for(var o=0;o<e.args.length;o++)(r=e.args.slice(0)).splice(o,1),n=1===r.length?r[0]:a(r),i.push(a([e.args[o],n]));else n=1===(r=e.args.slice(1)).length?r[0]:a(r),i.push(a([e.args[0],n]));return i}(t,e.context),a=[],o=0;o<i.length;o++){var s=U(e,i[o],!0);a=a.concat(s)}return a}if(e.args.length>2)throw Error("Unexpected non-binary associative function: "+e.toString());return[]}for(var u=[],c=0;c<e.args.length;c++){var f=U(e.args[c],t.args[c]);if(0===f.length)return[];u.push(f)}r=function(e){if(0===e.length)return e;for(var t=e.reduce(j),n=[],r={},i=0;i<t.length;i++){var a=JSON.stringify(t[i]);r[a]||(r[a]=!0,n.push(t[i]))}return n}(u)}else if(e instanceof C){if(0===e.name.length)throw new Error("Symbol in rule has 0 length...!?");if(R[e.name]){if(e.name!==t.name)return[]}else if("n"===e.name[0]||"_p"===e.name.substring(0,2))r[0].placeholders[e.name]=t;else if("v"===e.name[0]){if($(t))return[];r[0].placeholders[e.name]=t}else{if("c"!==e.name[0])throw new Error("Invalid symbol in rule: "+e.name);if(!(t instanceof v))return[];r[0].placeholders[e.name]=t}}else{if(!(e instanceof v))return[];if(!l(e.value,t.value))return[]}return r}function q(e,t){if(e instanceof v&&t instanceof v){if(!l(e.value,t.value))return!1}else if(e instanceof C&&t instanceof C){if(e.name!==t.name)return!1}else{if(!(e instanceof w&&t instanceof w||e instanceof y&&t instanceof y))return!1;if(e instanceof w){if(e.op!==t.op||e.fn!==t.fn)return!1}else if(e instanceof y&&e.name!==t.name)return!1;if(e.args.length!==t.args.length)return!1;for(var n=0;n<e.args.length;n++)if(!q(e.args[n],t.args[n]))return!1}return!0}return I})),ib=be("derivative",["typed","config","parse","simplify","equal","isZero","numeric","ConstantNode","FunctionNode","OperatorNode","ParenthesisNode","SymbolNode"],(e=>{var{typed:t,config:n,parse:r,simplify:i,equal:a,isZero:o,numeric:s,ConstantNode:u,FunctionNode:c,OperatorNode:l,ParenthesisNode:f,SymbolNode:p}=e,h=t("derivative",{"Node, SymbolNode, Object":function(e,t,n){var r={};m(r,e,t.name);var a=g(e,r);return n.simplify?i(a):a},"Node, SymbolNode":function(e,t){return this(e,t,{simplify:!0})},"string, SymbolNode":function(e,t){return this(r(e),t)},"string, SymbolNode, Object":function(e,t,n){return this(r(e),t,n)},"string, string":function(e,t){return this(r(e),r(t))},"string, string, Object":function(e,t,n){return this(r(e),r(t),n)},"Node, string":function(e,t){return this(e,r(t))},"Node, string, Object":function(e,t,n){return this(e,r(t),n)}});h._simplify=!0,h.toTex=function(e){return d.apply(null,e.args)};var d=t("_derivTex",{"Node, SymbolNode":function(e,t){return $(e)&&"string"===ne(e.value)?d(r(e.value).toString(),t.toString(),1):d(e.toString(),t.toString(),1)},"Node, ConstantNode":function(e,t){if("string"===ne(t.value))return d(e,r(t.value));throw new Error("The second parameter to 'derivative' is a non-string constant")},"Node, SymbolNode, ConstantNode":function(e,t,n){return d(e.toString(),t.name,n.value)},"string, string, number":function(e,t,n){return(1===n?"{d\\over d"+t+"}":"{d^{"+n+"}\\over d"+t+"^{"+n+"}}")+"\\left[".concat(e,"\\right]")}}),m=t("constTag",{"Object, ConstantNode, string":function(e,t){return e[t]=!0,!0},"Object, SymbolNode, string":function(e,t,n){return t.name!==n&&(e[t]=!0,!0)},"Object, ParenthesisNode, string":function(e,t,n){return m(e,t.content,n)},"Object, FunctionAssignmentNode, string":function(e,t,n){return-1===t.params.indexOf(n)?(e[t]=!0,!0):m(e,t.expr,n)},"Object, FunctionNode | OperatorNode, string":function(e,t,n){if(t.args.length>0){for(var r=m(e,t.args[0],n),i=1;i<t.args.length;++i)r=m(e,t.args[i],n)&&r;if(r)return e[t]=!0,!0}return!1}}),g=t("_derivative",{"ConstantNode, Object":function(e){return v(0)},"SymbolNode, Object":function(e,t){return void 0!==t[e]?v(0):v(1)},"ParenthesisNode, Object":function(e,t){return new f(g(e.content,t))},"FunctionAssignmentNode, Object":function(e,t){return void 0!==t[e]?v(0):g(e.expr,t)},"FunctionNode, Object":function(e,t){if(1!==e.args.length&&function(e){if("log"!==e.name&&"nthRoot"!==e.name&&"pow"!==e.name||2!==e.args.length){for(var t=0;t<e.args.length;++t)e.args[t]=v(0);throw e.compile().evaluate(),new Error("Expected TypeError, but none found")}}(e),void 0!==t[e])return v(0);var n,r,i,a,o=e.args[0],s=!1,u=!1;switch(e.name){case"cbrt":s=!0,r=new l("*","multiply",[v(3),new l("^","pow",[o,new l("/","divide",[v(2),v(3)])])]);break;case"sqrt":case"nthRoot":if(1===e.args.length)s=!0,r=new l("*","multiply",[v(2),new c("sqrt",[o])]);else if(2===e.args.length)return t[n=new l("/","divide",[v(1),e.args[1]])]=t[e.args[1]],g(new l("^","pow",[o,n]),t);break;case"log10":n=v(10);case"log":if(n||1!==e.args.length){if(1===e.args.length&&n||2===e.args.length&&void 0!==t[e.args[1]])r=new l("*","multiply",[o.clone(),new c("log",[n||e.args[1]])]),s=!0;else if(2===e.args.length)return g(new l("/","divide",[new c("log",[o]),new c("log",[e.args[1]])]),t)}else r=o.clone(),s=!0;break;case"pow":return t[n]=t[e.args[1]],g(new l("^","pow",[o,e.args[1]]),t);case"exp":r=new c("exp",[o.clone()]);break;case"sin":r=new c("cos",[o.clone()]);break;case"cos":r=new l("-","unaryMinus",[new c("sin",[o.clone()])]);break;case"tan":r=new l("^","pow",[new c("sec",[o.clone()]),v(2)]);break;case"sec":r=new l("*","multiply",[e,new c("tan",[o.clone()])]);break;case"csc":u=!0,r=new l("*","multiply",[e,new c("cot",[o.clone()])]);break;case"cot":u=!0,r=new l("^","pow",[new c("csc",[o.clone()]),v(2)]);break;case"asin":s=!0,r=new c("sqrt",[new l("-","subtract",[v(1),new l("^","pow",[o.clone(),v(2)])])]);break;case"acos":s=!0,u=!0,r=new c("sqrt",[new l("-","subtract",[v(1),new l("^","pow",[o.clone(),v(2)])])]);break;case"atan":s=!0,r=new l("+","add",[new l("^","pow",[o.clone(),v(2)]),v(1)]);break;case"asec":s=!0,r=new l("*","multiply",[new c("abs",[o.clone()]),new c("sqrt",[new l("-","subtract",[new l("^","pow",[o.clone(),v(2)]),v(1)])])]);break;case"acsc":s=!0,u=!0,r=new l("*","multiply",[new c("abs",[o.clone()]),new c("sqrt",[new l("-","subtract",[new l("^","pow",[o.clone(),v(2)]),v(1)])])]);break;case"acot":s=!0,u=!0,r=new l("+","add",[new l("^","pow",[o.clone(),v(2)]),v(1)]);break;case"sinh":r=new c("cosh",[o.clone()]);break;case"cosh":r=new c("sinh",[o.clone()]);break;case"tanh":r=new l("^","pow",[new c("sech",[o.clone()]),v(2)]);break;case"sech":u=!0,r=new l("*","multiply",[e,new c("tanh",[o.clone()])]);break;case"csch":u=!0,r=new l("*","multiply",[e,new c("coth",[o.clone()])]);break;case"coth":u=!0,r=new l("^","pow",[new c("csch",[o.clone()]),v(2)]);break;case"asinh":s=!0,r=new c("sqrt",[new l("+","add",[new l("^","pow",[o.clone(),v(2)]),v(1)])]);break;case"acosh":s=!0,r=new c("sqrt",[new l("-","subtract",[new l("^","pow",[o.clone(),v(2)]),v(1)])]);break;case"atanh":s=!0,r=new l("-","subtract",[v(1),new l("^","pow",[o.clone(),v(2)])]);break;case"asech":s=!0,u=!0,r=new l("*","multiply",[o.clone(),new c("sqrt",[new l("-","subtract",[v(1),new l("^","pow",[o.clone(),v(2)])])])]);break;case"acsch":s=!0,u=!0,r=new l("*","multiply",[new c("abs",[o.clone()]),new c("sqrt",[new l("+","add",[new l("^","pow",[o.clone(),v(2)]),v(1)])])]);break;case"acoth":s=!0,u=!0,r=new l("-","subtract",[v(1),new l("^","pow",[o.clone(),v(2)])]);break;case"abs":r=new l("/","divide",[new c(new p("abs"),[o.clone()]),o.clone()]);break;default:throw new Error('Function "'+e.name+'" is not supported by derivative, or a wrong number of arguments is passed')}s?(i="/",a="divide"):(i="*",a="multiply");var f=g(o,t);return u&&(f=new l("-","unaryMinus",[f])),new l(i,a,[f,r])},"OperatorNode, Object":function(e,t){if(void 0!==t[e])return v(0);if("+"===e.op)return new l(e.op,e.fn,e.args.map((function(e){return g(e,t)})));if("-"===e.op){if(e.isUnary())return new l(e.op,e.fn,[g(e.args[0],t)]);if(e.isBinary())return new l(e.op,e.fn,[g(e.args[0],t),g(e.args[1],t)])}if("*"===e.op){var n=e.args.filter((function(e){return void 0!==t[e]}));if(n.length>0){var r=e.args.filter((function(e){return void 0===t[e]})),i=1===r.length?r[0]:new l("*","multiply",r),s=n.concat(g(i,t));return new l("*","multiply",s)}return new l("+","add",e.args.map((function(n){return new l("*","multiply",e.args.map((function(e){return e===n?g(e,t):e.clone()})))})))}if("/"===e.op&&e.isBinary()){var u=e.args[0],f=e.args[1];return void 0!==t[f]?new l("/","divide",[g(u,t),f]):void 0!==t[u]?new l("*","multiply",[new l("-","unaryMinus",[u]),new l("/","divide",[g(f,t),new l("^","pow",[f.clone(),v(2)])])]):new l("/","divide",[new l("-","subtract",[new l("*","multiply",[g(u,t),f.clone()]),new l("*","multiply",[u.clone(),g(f,t)])]),new l("^","pow",[f.clone(),v(2)])])}if("^"===e.op&&e.isBinary()){var p=e.args[0],h=e.args[1];if(void 0!==t[p])return $(p)&&(o(p.value)||a(p.value,1))?v(0):new l("*","multiply",[e,new l("*","multiply",[new c("log",[p.clone()]),g(h.clone(),t)])]);if(void 0!==t[h]){if($(h)){if(o(h.value))return v(0);if(a(h.value,1))return g(p,t)}var d=new l("^","pow",[p.clone(),new l("-","subtract",[h,v(1)])]);return new l("*","multiply",[h.clone(),new l("*","multiply",[g(p,t),d])])}return new l("*","multiply",[new l("^","pow",[p.clone(),h.clone()]),new l("+","add",[new l("*","multiply",[g(p,t),new l("/","divide",[h.clone(),p.clone()])]),new l("*","multiply",[g(h,t),new c("log",[p.clone()])])])])}throw new Error('Operator "'+e.op+'" is not supported by derivative, or a wrong number of arguments is passed')}});function v(e,t){return new u(s(e,t||n.number))}return h})),ab={name:"pi",category:"Constants",syntax:["pi"],description:"The number pi is a mathematical constant that is the ratio of a circle's circumference to its diameter, and is approximately equal to 3.14159",examples:["pi","sin(pi/2)"],seealso:["tau"]},ob={name:"e",category:"Constants",syntax:["e"],description:"Euler's number, the base of the natural logarithm. Approximately equal to 2.71828",examples:["e","e ^ 2","exp(2)","log(e)"],seealso:["exp"]},sb={bignumber:{name:"bignumber",category:"Construction",syntax:["bignumber(x)"],description:"Create a big number from a number or string.",examples:["0.1 + 0.2","bignumber(0.1) + bignumber(0.2)",'bignumber("7.2")','bignumber("7.2e500")',"bignumber([0.1, 0.2, 0.3])"],seealso:["boolean","complex","fraction","index","matrix","string","unit"]},boolean:{name:"boolean",category:"Construction",syntax:["x","boolean(x)"],description:"Convert a string or number into a boolean.",examples:["boolean(0)","boolean(1)","boolean(3)",'boolean("true")','boolean("false")',"boolean([1, 0, 1, 1])"],seealso:["bignumber","complex","index","matrix","number","string","unit"]},complex:{name:"complex",category:"Construction",syntax:["complex()","complex(re, im)","complex(string)"],description:"Create a complex number.",examples:["complex()","complex(2, 3)",'complex("7 - 2i")'],seealso:["bignumber","boolean","index","matrix","number","string","unit"]},createUnit:{name:"createUnit",category:"Construction",syntax:["createUnit(definitions)","createUnit(name, definition)"],description:"Create a user-defined unit and register it with the Unit type.",examples:['createUnit("foo")','createUnit("knot", {definition: "0.514444444 m/s", aliases: ["knots", "kt", "kts"]})','createUnit("mph", "1 mile/hour")'],seealso:["unit","splitUnit"]},fraction:{name:"fraction",category:"Construction",syntax:["fraction(num)","fraction(num,den)"],description:"Create a fraction from a number or from a numerator and denominator.",examples:["fraction(0.125)","fraction(1, 3) + fraction(2, 5)"],seealso:["bignumber","boolean","complex","index","matrix","string","unit"]},index:{name:"index",category:"Construction",syntax:["[start]","[start:end]","[start:step:end]","[start1, start 2, ...]","[start1:end1, start2:end2, ...]","[start1:step1:end1, start2:step2:end2, ...]"],description:"Create an index to get or replace a subset of a matrix",examples:["[]","[1, 2, 3]","A = [1, 2, 3; 4, 5, 6]","A[1, :]","A[1, 2] = 50","A[0:2, 0:2] = ones(2, 2)"],seealso:["bignumber","boolean","complex","matrix,","number","range","string","unit"]},matrix:{name:"matrix",category:"Construction",syntax:["[]","[a1, b1, ...; a2, b2, ...]","matrix()",'matrix("dense")',"matrix([...])"],description:"Create a matrix.",examples:["[]","[1, 2, 3]","[1, 2, 3; 4, 5, 6]","matrix()","matrix([3, 4])",'matrix([3, 4; 5, 6], "sparse")','matrix([3, 4; 5, 6], "sparse", "number")'],seealso:["bignumber","boolean","complex","index","number","string","unit","sparse"]},number:{name:"number",category:"Construction",syntax:["x","number(x)","number(unit, valuelessUnit)"],description:"Create a number or convert a string or boolean into a number.",examples:["2","2e3","4.05","number(2)",'number("7.2")',"number(true)","number([true, false, true, true])",'number(unit("52cm"), "m")'],seealso:["bignumber","boolean","complex","fraction","index","matrix","string","unit"]},sparse:{name:"sparse",category:"Construction",syntax:["sparse()","sparse([a1, b1, ...; a1, b2, ...])",'sparse([a1, b1, ...; a1, b2, ...], "number")'],description:"Create a sparse matrix.",examples:["sparse()","sparse([3, 4; 5, 6])",'sparse([3, 0; 5, 0], "number")'],seealso:["bignumber","boolean","complex","index","number","string","unit","matrix"]},splitUnit:{name:"splitUnit",category:"Construction",syntax:["splitUnit(unit: Unit, parts: Unit[])"],description:"Split a unit in an array of units whose sum is equal to the original unit.",examples:['splitUnit(1 m, ["feet", "inch"])'],seealso:["unit","createUnit"]},string:{name:"string",category:"Construction",syntax:['"text"',"string(x)"],description:"Create a string or convert a value to a string",examples:['"Hello World!"',"string(4.2)","string(3 + 2i)"],seealso:["bignumber","boolean","complex","index","matrix","number","unit"]},unit:{name:"unit",category:"Construction",syntax:["value unit","unit(value, unit)","unit(string)"],description:"Create a unit.",examples:["5.5 mm","3 inch",'unit(7.1, "kilogram")','unit("23 deg")'],seealso:["bignumber","boolean","complex","index","matrix","number","string"]},e:ob,E:ob,false:{name:"false",category:"Constants",syntax:["false"],description:"Boolean value false",examples:["false"],seealso:["true"]},i:{name:"i",category:"Constants",syntax:["i"],description:"Imaginary unit, defined as i*i=-1. A complex number is described as a + b*i, where a is the real part, and b is the imaginary part.",examples:["i","i * i","sqrt(-1)"],seealso:[]},Infinity:{name:"Infinity",category:"Constants",syntax:["Infinity"],description:"Infinity, a number which is larger than the maximum number that can be handled by a floating point number.",examples:["Infinity","1 / 0"],seealso:[]},LN2:{name:"LN2",category:"Constants",syntax:["LN2"],description:"Returns the natural logarithm of 2, approximately equal to 0.693",examples:["LN2","log(2)"],seealso:[]},LN10:{name:"LN10",category:"Constants",syntax:["LN10"],description:"Returns the natural logarithm of 10, approximately equal to 2.302",examples:["LN10","log(10)"],seealso:[]},LOG2E:{name:"LOG2E",category:"Constants",syntax:["LOG2E"],description:"Returns the base-2 logarithm of E, approximately equal to 1.442",examples:["LOG2E","log(e, 2)"],seealso:[]},LOG10E:{name:"LOG10E",category:"Constants",syntax:["LOG10E"],description:"Returns the base-10 logarithm of E, approximately equal to 0.434",examples:["LOG10E","log(e, 10)"],seealso:[]},NaN:{name:"NaN",category:"Constants",syntax:["NaN"],description:"Not a number",examples:["NaN","0 / 0"],seealso:[]},null:{name:"null",category:"Constants",syntax:["null"],description:"Value null",examples:["null"],seealso:["true","false"]},pi:ab,PI:ab,phi:{name:"phi",category:"Constants",syntax:["phi"],description:"Phi is the golden ratio. Two quantities are in the golden ratio if their ratio is the same as the ratio of their sum to the larger of the two quantities. Phi is defined as `(1 + sqrt(5)) / 2` and is approximately 1.618034...",examples:["phi"],seealso:[]},SQRT1_2:{name:"SQRT1_2",category:"Constants",syntax:["SQRT1_2"],description:"Returns the square root of 1/2, approximately equal to 0.707",examples:["SQRT1_2","sqrt(1/2)"],seealso:[]},SQRT2:{name:"SQRT2",category:"Constants",syntax:["SQRT2"],description:"Returns the square root of 2, approximately equal to 1.414",examples:["SQRT2","sqrt(2)"],seealso:[]},tau:{name:"tau",category:"Constants",syntax:["tau"],description:"Tau is the ratio constant of a circle's circumference to radius, equal to 2 * pi, approximately 6.2832.",examples:["tau","2 * pi"],seealso:["pi"]},true:{name:"true",category:"Constants",syntax:["true"],description:"Boolean value true",examples:["true"],seealso:["false"]},version:{name:"version",category:"Constants",syntax:["version"],description:"A string with the version number of math.js",examples:["version"],seealso:[]},speedOfLight:{description:"Speed of light in vacuum",examples:["speedOfLight"]},gravitationConstant:{description:"Newtonian constant of gravitation",examples:["gravitationConstant"]},planckConstant:{description:"Planck constant",examples:["planckConstant"]},reducedPlanckConstant:{description:"Reduced Planck constant",examples:["reducedPlanckConstant"]},magneticConstant:{description:"Magnetic constant (vacuum permeability)",examples:["magneticConstant"]},electricConstant:{description:"Electric constant (vacuum permeability)",examples:["electricConstant"]},vacuumImpedance:{description:"Characteristic impedance of vacuum",examples:["vacuumImpedance"]},coulomb:{description:"Coulomb's constant",examples:["coulomb"]},elementaryCharge:{description:"Elementary charge",examples:["elementaryCharge"]},bohrMagneton:{description:"Borh magneton",examples:["bohrMagneton"]},conductanceQuantum:{description:"Conductance quantum",examples:["conductanceQuantum"]},inverseConductanceQuantum:{description:"Inverse conductance quantum",examples:["inverseConductanceQuantum"]},magneticFluxQuantum:{description:"Magnetic flux quantum",examples:["magneticFluxQuantum"]},nuclearMagneton:{description:"Nuclear magneton",examples:["nuclearMagneton"]},klitzing:{description:"Von Klitzing constant",examples:["klitzing"]},bohrRadius:{description:"Borh radius",examples:["bohrRadius"]},classicalElectronRadius:{description:"Classical electron radius",examples:["classicalElectronRadius"]},electronMass:{description:"Electron mass",examples:["electronMass"]},fermiCoupling:{description:"Fermi coupling constant",examples:["fermiCoupling"]},fineStructure:{description:"Fine-structure constant",examples:["fineStructure"]},hartreeEnergy:{description:"Hartree energy",examples:["hartreeEnergy"]},protonMass:{description:"Proton mass",examples:["protonMass"]},deuteronMass:{description:"Deuteron Mass",examples:["deuteronMass"]},neutronMass:{description:"Neutron mass",examples:["neutronMass"]},quantumOfCirculation:{description:"Quantum of circulation",examples:["quantumOfCirculation"]},rydberg:{description:"Rydberg constant",examples:["rydberg"]},thomsonCrossSection:{description:"Thomson cross section",examples:["thomsonCrossSection"]},weakMixingAngle:{description:"Weak mixing angle",examples:["weakMixingAngle"]},efimovFactor:{description:"Efimov factor",examples:["efimovFactor"]},atomicMass:{description:"Atomic mass constant",examples:["atomicMass"]},avogadro:{description:"Avogadro's number",examples:["avogadro"]},boltzmann:{description:"Boltzmann constant",examples:["boltzmann"]},faraday:{description:"Faraday constant",examples:["faraday"]},firstRadiation:{description:"First radiation constant",examples:["firstRadiation"]},loschmidt:{description:"Loschmidt constant at T=273.15 K and p=101.325 kPa",examples:["loschmidt"]},gasConstant:{description:"Gas constant",examples:["gasConstant"]},molarPlanckConstant:{description:"Molar Planck constant",examples:["molarPlanckConstant"]},molarVolume:{description:"Molar volume of an ideal gas at T=273.15 K and p=101.325 kPa",examples:["molarVolume"]},sackurTetrode:{description:"Sackur-Tetrode constant at T=1 K and p=101.325 kPa",examples:["sackurTetrode"]},secondRadiation:{description:"Second radiation constant",examples:["secondRadiation"]},stefanBoltzmann:{description:"Stefan-Boltzmann constant",examples:["stefanBoltzmann"]},wienDisplacement:{description:"Wien displacement law constant",examples:["wienDisplacement"]},molarMass:{description:"Molar mass constant",examples:["molarMass"]},molarMassC12:{description:"Molar mass constant of carbon-12",examples:["molarMassC12"]},gravity:{description:"Standard acceleration of gravity (standard acceleration of free-fall on Earth)",examples:["gravity"]},planckLength:{description:"Planck length",examples:["planckLength"]},planckMass:{description:"Planck mass",examples:["planckMass"]},planckTime:{description:"Planck time",examples:["planckTime"]},planckCharge:{description:"Planck charge",examples:["planckCharge"]},planckTemperature:{description:"Planck temperature",examples:["planckTemperature"]},derivative:{name:"derivative",category:"Algebra",syntax:["derivative(expr, variable)","derivative(expr, variable, {simplify: boolean})"],description:"Takes the derivative of an expression expressed in parser Nodes. The derivative will be taken over the supplied variable in the second parameter. If there are multiple variables in the expression, it will return a partial derivative.",examples:['derivative("2x^3", "x")','derivative("2x^3", "x", {simplify: false})','derivative("2x^2 + 3x + 4", "x")','derivative("sin(2x)", "x")','f = parse("x^2 + x")','x = parse("x")',"df = derivative(f, x)","df.evaluate({x: 3})"],seealso:["simplify","parse","evaluate"]},lsolve:{name:"lsolve",category:"Algebra",syntax:["x=lsolve(L, b)"],description:"Finds one solution of the linear system L * x = b where L is an [n x n] lower triangular matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lsolve(a, b)"],seealso:["lsolveAll","lup","lusolve","usolve","matrix","sparse"]},lsolveAll:{name:"lsolveAll",category:"Algebra",syntax:["x=lsolveAll(L, b)"],description:"Finds all solutions of the linear system L * x = b where L is an [n x n] lower triangular matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lsolve(a, b)"],seealso:["lsolve","lup","lusolve","usolve","matrix","sparse"]},lup:{name:"lup",category:"Algebra",syntax:["lup(m)"],description:"Calculate the Matrix LU decomposition with partial pivoting. Matrix A is decomposed in three matrices (L, U, P) where P * A = L * U",examples:["lup([[2, 1], [1, 4]])","lup(matrix([[2, 1], [1, 4]]))","lup(sparse([[2, 1], [1, 4]]))"],seealso:["lusolve","lsolve","usolve","matrix","sparse","slu","qr"]},lusolve:{name:"lusolve",category:"Algebra",syntax:["x=lusolve(A, b)","x=lusolve(lu, b)"],description:"Solves the linear system A * x = b where A is an [n x n] matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lusolve(a, b)"],seealso:["lup","slu","lsolve","usolve","matrix","sparse"]},simplify:{name:"simplify",category:"Algebra",syntax:["simplify(expr)","simplify(expr, rules)"],description:"Simplify an expression tree.",examples:['simplify("3 + 2 / 4")','simplify("2x + x")','f = parse("x * (x + 2 + x)")',"simplified = simplify(f)","simplified.evaluate({x: 2})"],seealso:["derivative","parse","evaluate"]},rationalize:{name:"rationalize",category:"Algebra",syntax:["rationalize(expr)","rationalize(expr, scope)","rationalize(expr, scope, detailed)"],description:"Transform a rationalizable expression in a rational fraction. If rational fraction is one variable polynomial then converts the numerator and denominator in canonical form, with decreasing exponents, returning the coefficients of numerator.",examples:['rationalize("2x/y - y/(x+1)")','rationalize("2x/y - y/(x+1)", true)'],seealso:["simplify"]},slu:{name:"slu",category:"Algebra",syntax:["slu(A, order, threshold)"],description:"Calculate the Matrix LU decomposition with full pivoting. Matrix A is decomposed in two matrices (L, U) and two permutation vectors (pinv, q) where P * A * Q = L * U",examples:["slu(sparse([4.5, 0, 3.2, 0; 3.1, 2.9, 0, 0.9; 0, 1.7, 3, 0; 3.5, 0.4, 0, 1]), 1, 0.001)"],seealso:["lusolve","lsolve","usolve","matrix","sparse","lup","qr"]},usolve:{name:"usolve",category:"Algebra",syntax:["x=usolve(U, b)"],description:"Finds one solution of the linear system U * x = b where U is an [n x n] upper triangular matrix and b is a [n] column vector.",examples:["x=usolve(sparse([1, 1, 1, 1; 0, 1, 1, 1; 0, 0, 1, 1; 0, 0, 0, 1]), [1; 2; 3; 4])"],seealso:["usolveAll","lup","lusolve","lsolve","matrix","sparse"]},usolveAll:{name:"usolveAll",category:"Algebra",syntax:["x=usolve(U, b)"],description:"Finds all solutions of the linear system U * x = b where U is an [n x n] upper triangular matrix and b is a [n] column vector.",examples:["x=usolve(sparse([1, 1, 1, 1; 0, 1, 1, 1; 0, 0, 1, 1; 0, 0, 0, 1]), [1; 2; 3; 4])"],seealso:["usolve","lup","lusolve","lsolve","matrix","sparse"]},qr:{name:"qr",category:"Algebra",syntax:["qr(A)"],description:"Calculates the Matrix QR decomposition. Matrix `A` is decomposed in two matrices (`Q`, `R`) where `Q` is an orthogonal matrix and `R` is an upper triangular matrix.",examples:["qr([[1, -1,  4], [1,  4, -2], [1,  4,  2], [1,  -1, 0]])"],seealso:["lup","slu","matrix"]},abs:{name:"abs",category:"Arithmetic",syntax:["abs(x)"],description:"Compute the absolute value.",examples:["abs(3.5)","abs(-4.2)"],seealso:["sign"]},add:{name:"add",category:"Operators",syntax:["x + y","add(x, y)"],description:"Add two values.",examples:["a = 2.1 + 3.6","a - 3.6","3 + 2i","3 cm + 2 inch",'"2.3" + "4"'],seealso:["subtract"]},cbrt:{name:"cbrt",category:"Arithmetic",syntax:["cbrt(x)","cbrt(x, allRoots)"],description:"Compute the cubic root value. If x = y * y * y, then y is the cubic root of x. When `x` is a number or complex number, an optional second argument `allRoots` can be provided to return all three cubic roots. If not provided, the principal root is returned",examples:["cbrt(64)","cube(4)","cbrt(-8)","cbrt(2 + 3i)","cbrt(8i)","cbrt(8i, true)","cbrt(27 m^3)"],seealso:["square","sqrt","cube","multiply"]},ceil:{name:"ceil",category:"Arithmetic",syntax:["ceil(x)"],description:"Round a value towards plus infinity. If x is complex, both real and imaginary part are rounded towards plus infinity.",examples:["ceil(3.2)","ceil(3.8)","ceil(-4.2)"],seealso:["floor","fix","round"]},cube:{name:"cube",category:"Arithmetic",syntax:["cube(x)"],description:"Compute the cube of a value. The cube of x is x * x * x.",examples:["cube(2)","2^3","2 * 2 * 2"],seealso:["multiply","square","pow"]},divide:{name:"divide",category:"Operators",syntax:["x / y","divide(x, y)"],description:"Divide two values.",examples:["a = 2 / 3","a * 3","4.5 / 2","3 + 4 / 2","(3 + 4) / 2","18 km / 4.5"],seealso:["multiply"]},dotDivide:{name:"dotDivide",category:"Operators",syntax:["x ./ y","dotDivide(x, y)"],description:"Divide two values element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","b = [2, 1, 1; 3, 2, 5]","a ./ b"],seealso:["multiply","dotMultiply","divide"]},dotMultiply:{name:"dotMultiply",category:"Operators",syntax:["x .* y","dotMultiply(x, y)"],description:"Multiply two values element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","b = [2, 1, 1; 3, 2, 5]","a .* b"],seealso:["multiply","divide","dotDivide"]},dotPow:{name:"dotPow",category:"Operators",syntax:["x .^ y","dotPow(x, y)"],description:"Calculates the power of x to y element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","a .^ 2"],seealso:["pow"]},exp:{name:"exp",category:"Arithmetic",syntax:["exp(x)"],description:"Calculate the exponent of a value.",examples:["exp(1.3)","e ^ 1.3","log(exp(1.3))","x = 2.4","(exp(i*x) == cos(x) + i*sin(x))   # Euler's formula"],seealso:["expm","expm1","pow","log"]},expm:{name:"expm",category:"Arithmetic",syntax:["exp(x)"],description:"Compute the matrix exponential, expm(A) = e^A. The matrix must be square. Not to be confused with exp(a), which performs element-wise exponentiation.",examples:["expm([[0,2],[0,0]])"],seealso:["exp"]},expm1:{name:"expm1",category:"Arithmetic",syntax:["expm1(x)"],description:"Calculate the value of subtracting 1 from the exponential value.",examples:["expm1(2)","pow(e, 2) - 1","log(expm1(2) + 1)"],seealso:["exp","pow","log"]},fix:{name:"fix",category:"Arithmetic",syntax:["fix(x)"],description:"Round a value towards zero. If x is complex, both real and imaginary part are rounded towards zero.",examples:["fix(3.2)","fix(3.8)","fix(-4.2)","fix(-4.8)"],seealso:["ceil","floor","round"]},floor:{name:"floor",category:"Arithmetic",syntax:["floor(x)"],description:"Round a value towards minus infinity.If x is complex, both real and imaginary part are rounded towards minus infinity.",examples:["floor(3.2)","floor(3.8)","floor(-4.2)"],seealso:["ceil","fix","round"]},gcd:{name:"gcd",category:"Arithmetic",syntax:["gcd(a, b)","gcd(a, b, c, ...)"],description:"Compute the greatest common divisor.",examples:["gcd(8, 12)","gcd(-4, 6)","gcd(25, 15, -10)"],seealso:["lcm","xgcd"]},hypot:{name:"hypot",category:"Arithmetic",syntax:["hypot(a, b, c, ...)","hypot([a, b, c, ...])"],description:"Calculate the hypotenusa of a list with values. ",examples:["hypot(3, 4)","sqrt(3^2 + 4^2)","hypot(-2)","hypot([3, 4, 5])"],seealso:["abs","norm"]},lcm:{name:"lcm",category:"Arithmetic",syntax:["lcm(x, y)"],description:"Compute the least common multiple.",examples:["lcm(4, 6)","lcm(6, 21)","lcm(6, 21, 5)"],seealso:["gcd"]},log:{name:"log",category:"Arithmetic",syntax:["log(x)","log(x, base)"],description:"Compute the logarithm of a value. If no base is provided, the natural logarithm of x is calculated. If base if provided, the logarithm is calculated for the specified base. log(x, base) is defined as log(x) / log(base).",examples:["log(3.5)","a = log(2.4)","exp(a)","10 ^ 4","log(10000, 10)","log(10000) / log(10)","b = log(1024, 2)","2 ^ b"],seealso:["exp","log1p","log2","log10"]},log2:{name:"log2",category:"Arithmetic",syntax:["log2(x)"],description:"Calculate the 2-base of a value. This is the same as calculating `log(x, 2)`.",examples:["log2(0.03125)","log2(16)","log2(16) / log2(2)","pow(2, 4)"],seealso:["exp","log1p","log","log10"]},log1p:{name:"log1p",category:"Arithmetic",syntax:["log1p(x)","log1p(x, base)"],description:"Calculate the logarithm of a `value+1`",examples:["log1p(2.5)","exp(log1p(1.4))","pow(10, 4)","log1p(9999, 10)","log1p(9999) / log(10)"],seealso:["exp","log","log2","log10"]},log10:{name:"log10",category:"Arithmetic",syntax:["log10(x)"],description:"Compute the 10-base logarithm of a value.",examples:["log10(0.00001)","log10(10000)","10 ^ 4","log(10000) / log(10)","log(10000, 10)"],seealso:["exp","log"]},mod:{name:"mod",category:"Operators",syntax:["x % y","x mod y","mod(x, y)"],description:"Calculates the modulus, the remainder of an integer division.",examples:["7 % 3","11 % 2","10 mod 4","isOdd(x) = x % 2","isOdd(2)","isOdd(3)"],seealso:["divide"]},multiply:{name:"multiply",category:"Operators",syntax:["x * y","multiply(x, y)"],description:"multiply two values.",examples:["a = 2.1 * 3.4","a / 3.4","2 * 3 + 4","2 * (3 + 4)","3 * 2.1 km"],seealso:["divide"]},norm:{name:"norm",category:"Arithmetic",syntax:["norm(x)","norm(x, p)"],description:"Calculate the norm of a number, vector or matrix.",examples:["abs(-3.5)","norm(-3.5)","norm(3 - 4i)","norm([1, 2, -3], Infinity)","norm([1, 2, -3], -Infinity)","norm([3, 4], 2)","norm([[1, 2], [3, 4]], 1)",'norm([[1, 2], [3, 4]], "inf")','norm([[1, 2], [3, 4]], "fro")']},nthRoot:{name:"nthRoot",category:"Arithmetic",syntax:["nthRoot(a)","nthRoot(a, root)"],description:'Calculate the nth root of a value. The principal nth root of a positive real number A, is the positive real solution of the equation "x^root = A".',examples:["4 ^ 3","nthRoot(64, 3)","nthRoot(9, 2)","sqrt(9)"],seealso:["nthRoots","pow","sqrt"]},nthRoots:{name:"nthRoots",category:"Arithmetic",syntax:["nthRoots(A)","nthRoots(A, root)"],description:'Calculate the nth roots of a value. An nth root of a positive real number A, is a positive real solution of the equation "x^root = A". This function returns an array of complex values.',examples:["nthRoots(1)","nthRoots(1, 3)"],seealso:["sqrt","pow","nthRoot"]},pow:{name:"pow",category:"Operators",syntax:["x ^ y","pow(x, y)"],description:"Calculates the power of x to y, x^y.",examples:["2^3","2*2*2","1 + e ^ (pi * i)"],seealso:["multiply","nthRoot","nthRoots","sqrt"]},round:{name:"round",category:"Arithmetic",syntax:["round(x)","round(x, n)"],description:"round a value towards the nearest integer.If x is complex, both real and imaginary part are rounded towards the nearest integer. When n is specified, the value is rounded to n decimals.",examples:["round(3.2)","round(3.8)","round(-4.2)","round(-4.8)","round(pi, 3)","round(123.45678, 2)"],seealso:["ceil","floor","fix"]},sign:{name:"sign",category:"Arithmetic",syntax:["sign(x)"],description:"Compute the sign of a value. The sign of a value x is 1 when x>1, -1 when x<0, and 0 when x=0.",examples:["sign(3.5)","sign(-4.2)","sign(0)"],seealso:["abs"]},sqrt:{name:"sqrt",category:"Arithmetic",syntax:["sqrt(x)"],description:"Compute the square root value. If x = y * y, then y is the square root of x.",examples:["sqrt(25)","5 * 5","sqrt(-1)"],seealso:["square","sqrtm","multiply","nthRoot","nthRoots","pow"]},sqrtm:{name:"sqrtm",category:"Arithmetic",syntax:["sqrtm(x)"],description:"Calculate the principal square root of a square matrix. The principal square root matrix `X` of another matrix `A` is such that `X * X = A`.",examples:["sqrtm([[1, 2], [3, 4]])"],seealso:["sqrt","abs","square","multiply"]},square:{name:"square",category:"Arithmetic",syntax:["square(x)"],description:"Compute the square of a value. The square of x is x * x.",examples:["square(3)","sqrt(9)","3^2","3 * 3"],seealso:["multiply","pow","sqrt","cube"]},subtract:{name:"subtract",category:"Operators",syntax:["x - y","subtract(x, y)"],description:"subtract two values.",examples:["a = 5.3 - 2","a + 2","2/3 - 1/6","2 * 3 - 3","2.1 km - 500m"],seealso:["add"]},unaryMinus:{name:"unaryMinus",category:"Operators",syntax:["-x","unaryMinus(x)"],description:"Inverse the sign of a value. Converts booleans and strings to numbers.",examples:["-4.5","-(-5.6)",'-"22"'],seealso:["add","subtract","unaryPlus"]},unaryPlus:{name:"unaryPlus",category:"Operators",syntax:["+x","unaryPlus(x)"],description:"Converts booleans and strings to numbers.",examples:["+true",'+"2"'],seealso:["add","subtract","unaryMinus"]},xgcd:{name:"xgcd",category:"Arithmetic",syntax:["xgcd(a, b)"],description:"Calculate the extended greatest common divisor for two values. The result is an array [d, x, y] with 3 entries, where d is the greatest common divisor, and d = x * a + y * b.",examples:["xgcd(8, 12)","gcd(8, 12)","xgcd(36163, 21199)"],seealso:["gcd","lcm"]},invmod:{name:"invmod",category:"Arithmetic",syntax:["invmod(a, b)"],description:"Calculate the (modular) multiplicative inverse of a modulo b. Solution to the equation ax  1 (mod b)",examples:["invmod(8, 12)=NaN","invmod(7, 13)=2","math.invmod(15151, 15122)=10429"],seealso:["gcd","xgcd"]},bitAnd:{name:"bitAnd",category:"Bitwise",syntax:["x & y","bitAnd(x, y)"],description:"Bitwise AND operation. Performs the logical AND operation on each pair of the corresponding bits of the two given values by multiplying them. If both bits in the compared position are 1, the bit in the resulting binary representation is 1, otherwise, the result is 0",examples:["5 & 3","bitAnd(53, 131)","[1, 12, 31] & 42"],seealso:["bitNot","bitOr","bitXor","leftShift","rightArithShift","rightLogShift"]},bitNot:{name:"bitNot",category:"Bitwise",syntax:["~x","bitNot(x)"],description:"Bitwise NOT operation. Performs a logical negation on each bit of the given value. Bits that are 0 become 1, and those that are 1 become 0.",examples:["~1","~2","bitNot([2, -3, 4])"],seealso:["bitAnd","bitOr","bitXor","leftShift","rightArithShift","rightLogShift"]},bitOr:{name:"bitOr",category:"Bitwise",syntax:["x | y","bitOr(x, y)"],description:"Bitwise OR operation. Performs the logical inclusive OR operation on each pair of corresponding bits of the two given values. The result in each position is 1 if the first bit is 1 or the second bit is 1 or both bits are 1, otherwise, the result is 0.",examples:["5 | 3","bitOr([1, 2, 3], 4)"],seealso:["bitAnd","bitNot","bitXor","leftShift","rightArithShift","rightLogShift"]},bitXor:{name:"bitXor",category:"Bitwise",syntax:["bitXor(x, y)"],description:"Bitwise XOR operation, exclusive OR. Performs the logical exclusive OR operation on each pair of corresponding bits of the two given values. The result in each position is 1 if only the first bit is 1 or only the second bit is 1, but will be 0 if both are 0 or both are 1.",examples:["bitOr(1, 2)","bitXor([2, 3, 4], 4)"],seealso:["bitAnd","bitNot","bitOr","leftShift","rightArithShift","rightLogShift"]},leftShift:{name:"leftShift",category:"Bitwise",syntax:["x << y","leftShift(x, y)"],description:"Bitwise left logical shift of a value x by y number of bits.",examples:["4 << 1","8 >> 1"],seealso:["bitAnd","bitNot","bitOr","bitXor","rightArithShift","rightLogShift"]},rightArithShift:{name:"rightArithShift",category:"Bitwise",syntax:["x >> y","rightArithShift(x, y)"],description:"Bitwise right arithmetic shift of a value x by y number of bits.",examples:["8 >> 1","4 << 1","-12 >> 2"],seealso:["bitAnd","bitNot","bitOr","bitXor","leftShift","rightLogShift"]},rightLogShift:{name:"rightLogShift",category:"Bitwise",syntax:["x >>> y","rightLogShift(x, y)"],description:"Bitwise right logical shift of a value x by y number of bits.",examples:["8 >>> 1","4 << 1","-12 >>> 2"],seealso:["bitAnd","bitNot","bitOr","bitXor","leftShift","rightArithShift"]},bellNumbers:{name:"bellNumbers",category:"Combinatorics",syntax:["bellNumbers(n)"],description:"The Bell Numbers count the number of partitions of a set. A partition is a pairwise disjoint subset of S whose union is S. `bellNumbers` only takes integer arguments. The following condition must be enforced: n >= 0.",examples:["bellNumbers(3)","bellNumbers(8)"],seealso:["stirlingS2"]},catalan:{name:"catalan",category:"Combinatorics",syntax:["catalan(n)"],description:"The Catalan Numbers enumerate combinatorial structures of many different types. catalan only takes integer arguments. The following condition must be enforced: n >= 0.",examples:["catalan(3)","catalan(8)"],seealso:["bellNumbers"]},composition:{name:"composition",category:"Combinatorics",syntax:["composition(n, k)"],description:"The composition counts of n into k parts. composition only takes integer arguments. The following condition must be enforced: k <= n.",examples:["composition(5, 3)"],seealso:["combinations"]},stirlingS2:{name:"stirlingS2",category:"Combinatorics",syntax:["stirlingS2(n, k)"],description:"he Stirling numbers of the second kind, counts the number of ways to partition a set of n labelled objects into k nonempty unlabelled subsets. `stirlingS2` only takes integer arguments. The following condition must be enforced: k <= n. If n = k or k = 1, then s(n,k) = 1.",examples:["stirlingS2(5, 3)"],seealso:["bellNumbers"]},config:{name:"config",category:"Core",syntax:["config()","config(options)"],description:"Get configuration or change configuration.",examples:["config()","1/3 + 1/4",'config({number: "Fraction"})',"1/3 + 1/4"],seealso:[]},import:{name:"import",category:"Core",syntax:["import(functions)","import(functions, options)"],description:"Import functions or constants from an object.",examples:["import({myFn: f(x)=x^2, myConstant: 32 })","myFn(2)","myConstant"],seealso:[]},typed:{name:"typed",category:"Core",syntax:["typed(signatures)","typed(name, signatures)"],description:"Create a typed function.",examples:['double = typed({ "number, number": f(x)=x+x })',"double(2)",'double("hello")'],seealso:[]},arg:{name:"arg",category:"Complex",syntax:["arg(x)"],description:"Compute the argument of a complex value. If x = a+bi, the argument is computed as atan2(b, a).",examples:["arg(2 + 2i)","atan2(3, 2)","arg(2 + 3i)"],seealso:["re","im","conj","abs"]},conj:{name:"conj",category:"Complex",syntax:["conj(x)"],description:"Compute the complex conjugate of a complex value. If x = a+bi, the complex conjugate is a-bi.",examples:["conj(2 + 3i)","conj(2 - 3i)","conj(-5.2i)"],seealso:["re","im","abs","arg"]},re:{name:"re",category:"Complex",syntax:["re(x)"],description:"Get the real part of a complex number.",examples:["re(2 + 3i)","im(2 + 3i)","re(-5.2i)","re(2.4)"],seealso:["im","conj","abs","arg"]},im:{name:"im",category:"Complex",syntax:["im(x)"],description:"Get the imaginary part of a complex number.",examples:["im(2 + 3i)","re(2 + 3i)","im(-5.2i)","im(2.4)"],seealso:["re","conj","abs","arg"]},evaluate:{name:"evaluate",category:"Expression",syntax:["evaluate(expression)","evaluate([expr1, expr2, expr3, ...])"],description:"Evaluate an expression or an array with expressions.",examples:['evaluate("2 + 3")','evaluate("sqrt(" + 4 + ")")'],seealso:[]},help:{name:"help",category:"Expression",syntax:["help(object)","help(string)"],description:"Display documentation on a function or data type.",examples:["help(sqrt)",'help("complex")'],seealso:[]},distance:{name:"distance",category:"Geometry",syntax:["distance([x1, y1], [x2, y2])","distance([[x1, y1], [x2, y2]])"],description:"Calculates the Euclidean distance between two points.",examples:["distance([0,0], [4,4])","distance([[0,0], [4,4]])"],seealso:[]},intersect:{name:"intersect",category:"Geometry",syntax:["intersect(expr1, expr2, expr3, expr4)","intersect(expr1, expr2, expr3)"],description:"Computes the intersection point of lines and/or planes.",examples:["intersect([0, 0], [10, 10], [10, 0], [0, 10])","intersect([1, 0, 1],  [4, -2, 2], [1, 1, 1, 6])"],seealso:[]},and:{name:"and",category:"Logical",syntax:["x and y","and(x, y)"],description:"Logical and. Test whether two values are both defined with a nonzero/nonempty value.",examples:["true and false","true and true","2 and 4"],seealso:["not","or","xor"]},not:{name:"not",category:"Logical",syntax:["not x","not(x)"],description:"Logical not. Flips the boolean value of given argument.",examples:["not true","not false","not 2","not 0"],seealso:["and","or","xor"]},or:{name:"or",category:"Logical",syntax:["x or y","or(x, y)"],description:"Logical or. Test if at least one value is defined with a nonzero/nonempty value.",examples:["true or false","false or false","0 or 4"],seealso:["not","and","xor"]},xor:{name:"xor",category:"Logical",syntax:["x xor y","xor(x, y)"],description:"Logical exclusive or, xor. Test whether one and only one value is defined with a nonzero/nonempty value.",examples:["true xor false","false xor false","true xor true","0 xor 4"],seealso:["not","and","or"]},concat:{name:"concat",category:"Matrix",syntax:["concat(A, B, C, ...)","concat(A, B, C, ..., dim)"],description:"Concatenate matrices. By default, the matrices are concatenated by the last dimension. The dimension on which to concatenate can be provided as last argument.",examples:["A = [1, 2; 5, 6]","B = [3, 4; 7, 8]","concat(A, B)","concat(A, B, 1)","concat(A, B, 2)"],seealso:["det","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},count:{name:"count",category:"Matrix",syntax:["count(x)"],description:"Count the number of elements of a matrix, array or string.",examples:["a = [1, 2; 3, 4; 5, 6]","count(a)","size(a)",'count("hello world")'],seealso:["size"]},cross:{name:"cross",category:"Matrix",syntax:["cross(A, B)"],description:"Calculate the cross product for two vectors in three dimensional space.",examples:["cross([1, 1, 0],  [0, 1, 1])","cross([3, -3, 1], [4, 9, 2])","cross([2, 3, 4],  [5, 6, 7])"],seealso:["multiply","dot"]},column:{name:"column",category:"Matrix",syntax:["column(x, index)"],description:"Return a column from a matrix or array.",examples:["A = [[1, 2], [3, 4]]","column(A, 1)","column(A, 2)"],seealso:["row","matrixFromColumns"]},ctranspose:{name:"ctranspose",category:"Matrix",syntax:["x'","ctranspose(x)"],description:"Complex Conjugate and Transpose a matrix",examples:["a = [1, 2, 3; 4, 5, 6]","a'","ctranspose(a)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","zeros"]},det:{name:"det",category:"Matrix",syntax:["det(x)"],description:"Calculate the determinant of a matrix",examples:["det([1, 2; 3, 4])","det([-2, 2, 3; -1, 1, 3; 2, 0, -1])"],seealso:["concat","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},diag:{name:"diag",category:"Matrix",syntax:["diag(x)","diag(x, k)"],description:"Create a diagonal matrix or retrieve the diagonal of a matrix. When x is a vector, a matrix with the vector values on the diagonal will be returned. When x is a matrix, a vector with the diagonal values of the matrix is returned. When k is provided, the k-th diagonal will be filled in or retrieved, if k is positive, the values are placed on the super diagonal. When k is negative, the values are placed on the sub diagonal.",examples:["diag(1:3)","diag(1:3, 1)","a = [1, 2, 3; 4, 5, 6; 7, 8, 9]","diag(a)"],seealso:["concat","det","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},diff:{name:"diff",category:"Matrix",syntax:["diff(arr)","diff(arr, dim)"],description:["Create a new matrix or array with the difference of the passed matrix or array.","Dim parameter is optional and used to indicant the dimension of the array/matrix to apply the difference","If no dimension parameter is passed it is assumed as dimension 0","Dimension is zero-based in javascript and one-based in the parser","Arrays must be 'rectangular' meaning arrays like [1, 2]","If something is passed as a matrix it will be returned as a matrix but other than that all matrices are converted to arrays"],examples:["diff([1, 2, 4, 7, 0])","diff([1, 2, 4, 7, 0], 0)","diff(matrix([1, 2, 4, 7, 0]))","diff([[1, 2], [3, 4]])","diff([[1, 2], [3, 4]], 0)","diff([[1, 2], [3, 4]], 1)","diff([[1, 2], [3, 4]], bignumber(1))","diff(matrix([[1, 2], [3, 4]]), 1)","diff([[1, 2], matrix([3, 4])], 1)"],seealso:["subtract","partitionSelect"]},dot:{name:"dot",category:"Matrix",syntax:["dot(A, B)","A * B"],description:"Calculate the dot product of two vectors. The dot product of A = [a1, a2, a3, ..., an] and B = [b1, b2, b3, ..., bn] is defined as dot(A, B) = a1 * b1 + a2 * b2 + a3 * b3 + ... + an * bn",examples:["dot([2, 4, 1], [2, 2, 3])","[2, 4, 1] * [2, 2, 3]"],seealso:["multiply","cross"]},getMatrixDataType:{name:"getMatrixDataType",category:"Matrix",syntax:["getMatrixDataType(x)"],description:'Find the data type of all elements in a matrix or array, for example "number" if all items are a number and "Complex" if all values are complex numbers. If a matrix contains more than one data type, it will return "mixed".',examples:["getMatrixDataType([1, 2, 3])","getMatrixDataType([[5 cm], [2 inch]])",'getMatrixDataType([1, "text"])',"getMatrixDataType([1, bignumber(4)])"],seealso:["matrix","sparse","typeOf"]},identity:{name:"identity",category:"Matrix",syntax:["identity(n)","identity(m, n)","identity([m, n])"],description:"Returns the identity matrix with size m-by-n. The matrix has ones on the diagonal and zeros elsewhere.",examples:["identity(3)","identity(3, 5)","a = [1, 2, 3; 4, 5, 6]","identity(size(a))"],seealso:["concat","det","diag","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},filter:{name:"filter",category:"Matrix",syntax:["filter(x, test)"],description:"Filter items in a matrix.",examples:["isPositive(x) = x > 0","filter([6, -2, -1, 4, 3], isPositive)","filter([6, -2, 0, 1, 0], x != 0)"],seealso:["sort","map","forEach"]},flatten:{name:"flatten",category:"Matrix",syntax:["flatten(x)"],description:"Flatten a multi dimensional matrix into a single dimensional matrix.",examples:["a = [1, 2, 3; 4, 5, 6]","size(a)","b = flatten(a)","size(b)"],seealso:["concat","resize","size","squeeze"]},forEach:{name:"forEach",category:"Matrix",syntax:["forEach(x, callback)"],description:"Iterates over all elements of a matrix/array, and executes the given callback function.",examples:[],seealso:["map","sort","filter"]},inv:{name:"inv",category:"Matrix",syntax:["inv(x)"],description:"Calculate the inverse of a matrix",examples:["inv([1, 2; 3, 4])","inv(4)","1 / 4"],seealso:["concat","det","diag","identity","ones","range","size","squeeze","subset","trace","transpose","zeros"]},eigs:{name:"eigs",category:"Matrix",syntax:["eigs(x)"],description:"Calculate the eigenvalues and eigenvectors of a real symmetric matrix",examples:["eigs([[5, 2.3], [2.3, 1]])"],seealso:["inv"]},kron:{name:"kron",category:"Matrix",syntax:["kron(x, y)"],description:"Calculates the kronecker product of 2 matrices or vectors.",examples:["kron([[1, 0], [0, 1]], [[1, 2], [3, 4]])","kron([1,1], [2,3,4])"],seealso:["multiply","dot","cross"]},matrixFromFunction:{name:"matrixFromFunction",category:"Matrix",syntax:["math.matrixFromFunction(size, fn)","math.matrixFromFunction(size, fn, format)","math.matrixFromFunction(size, fn, format, datatype)","math.matrixFromFunction(size, format, fn)","math.matrixFromFunction(size, format, datatype, fn)"],description:"Create a matrix by evaluating a generating function at each index.",examples:["f(I) = I[1] - I[2]","matrixFromFunction([3,3], f)","g(I) = I[1] - I[2] == 1 ? 4 : 0",'matrixFromFunction([100, 100], "sparse", g)',"matrixFromFunction([5], random)"],seealso:["matrix","matrixFromRows","matrixFromColumns","zeros"]},matrixFromRows:{name:"matrixFromRows",category:"Matrix",syntax:["math.matrixFromRows(...arr)","math.matrixFromRows(row1, row2)","math.matrixFromRows(row1, row2, row3)"],description:"Create a dense matrix from vectors as individual rows.",examples:["matrixFromRows([1, 2, 3], [[4],[5],[6]])"],seealso:["matrix","matrixFromColumns","matrixFromFunction","zeros"]},matrixFromColumns:{name:"matrixFromColumns",category:"Matrix",syntax:["math.matrixFromColumns(...arr)","math.matrixFromColumns(row1, row2)","math.matrixFromColumns(row1, row2, row3)"],description:"Create a dense matrix from vectors as individual columns.",examples:["matrixFromColumns([1, 2, 3], [[4],[5],[6]])"],seealso:["matrix","matrixFromRows","matrixFromFunction","zeros"]},map:{name:"map",category:"Matrix",syntax:["map(x, callback)"],description:"Create a new matrix or array with the results of the callback function executed on each entry of the matrix/array.",examples:["map([1, 2, 3], square)"],seealso:["filter","forEach"]},ones:{name:"ones",category:"Matrix",syntax:["ones(m)","ones(m, n)","ones(m, n, p, ...)","ones([m])","ones([m, n])","ones([m, n, p, ...])"],description:"Create a matrix containing ones.",examples:["ones(3)","ones(3, 5)","ones([2,3]) * 4.5","a = [1, 2, 3; 4, 5, 6]","ones(size(a))"],seealso:["concat","det","diag","identity","inv","range","size","squeeze","subset","trace","transpose","zeros"]},partitionSelect:{name:"partitionSelect",category:"Matrix",syntax:["partitionSelect(x, k)","partitionSelect(x, k, compare)"],description:"Partition-based selection of an array or 1D matrix. Will find the kth smallest value, and mutates the input array. Uses Quickselect.",examples:["partitionSelect([5, 10, 1], 2)",'partitionSelect(["C", "B", "A", "D"], 1)'],seealso:["sort"]},range:{name:"range",category:"Type",syntax:["start:end","start:step:end","range(start, end)","range(start, end, step)","range(string)"],description:"Create a range. Lower bound of the range is included, upper bound is excluded.",examples:["1:5","3:-1:-3","range(3, 7)","range(0, 12, 2)",'range("4:10")',"a = [1, 2, 3, 4; 5, 6, 7, 8]","a[1:2, 1:2]"],seealso:["concat","det","diag","identity","inv","ones","size","squeeze","subset","trace","transpose","zeros"]},resize:{name:"resize",category:"Matrix",syntax:["resize(x, size)","resize(x, size, defaultValue)"],description:"Resize a matrix.",examples:["resize([1,2,3,4,5], [3])","resize([1,2,3], [5])","resize([1,2,3], [5], -1)","resize(2, [2, 3])",'resize("hello", [8], "!")'],seealso:["size","subset","squeeze","reshape"]},reshape:{name:"reshape",category:"Matrix",syntax:["reshape(x, sizes)"],description:"Reshape a multi dimensional array to fit the specified dimensions.",examples:["reshape([1, 2, 3, 4, 5, 6], [2, 3])","reshape([[1, 2], [3, 4]], [1, 4])","reshape([[1, 2], [3, 4]], [4])"],seealso:["size","squeeze","resize"]},rotate:{name:"rotate",category:"Matrix",syntax:["rotate(w, theta)","rotate(w, theta, v)"],description:"Returns a 2-D rotation matrix (2x2) for a given angle (in radians). Returns a 2-D rotation matrix (3x3) of a given angle (in radians) around given axis.",examples:["rotate([1, 0], math.pi / 2)",'rotate(matrix([1, 0]), unit("35deg"))','rotate([1, 0, 0], unit("90deg"), [0, 0, 1])','rotate(matrix([1, 0, 0]), unit("90deg"), matrix([0, 0, 1]))'],seealso:["matrix","rotationMatrix"]},rotationMatrix:{name:"rotationMatrix",category:"Matrix",syntax:["rotationMatrix(theta)","rotationMatrix(theta, v)","rotationMatrix(theta, v, format)"],description:"Returns a 2-D rotation matrix (2x2) for a given angle (in radians). Returns a 2-D rotation matrix (3x3) of a given angle (in radians) around given axis.",examples:["rotationMatrix(pi / 2)",'rotationMatrix(unit("45deg"), [0, 0, 1])','rotationMatrix(1, matrix([0, 0, 1]), "sparse")'],seealso:["cos","sin"]},row:{name:"row",category:"Matrix",syntax:["row(x, index)"],description:"Return a row from a matrix or array.",examples:["A = [[1, 2], [3, 4]]","row(A, 1)","row(A, 2)"],seealso:["column","matrixFromRows"]},size:{name:"size",category:"Matrix",syntax:["size(x)"],description:"Calculate the size of a matrix.",examples:["size(2.3)",'size("hello world")',"a = [1, 2; 3, 4; 5, 6]","size(a)","size(1:6)"],seealso:["concat","count","det","diag","identity","inv","ones","range","squeeze","subset","trace","transpose","zeros"]},sort:{name:"sort",category:"Matrix",syntax:["sort(x)","sort(x, compare)"],description:'Sort the items in a matrix. Compare can be a string "asc", "desc", "natural", or a custom sort function.',examples:["sort([5, 10, 1])",'sort(["C", "B", "A", "D"])',"sortByLength(a, b) = size(a)[1] - size(b)[1]",'sort(["Langdon", "Tom", "Sara"], sortByLength)','sort(["10", "1", "2"], "natural")'],seealso:["map","filter","forEach"]},squeeze:{name:"squeeze",category:"Matrix",syntax:["squeeze(x)"],description:"Remove inner and outer singleton dimensions from a matrix.",examples:["a = zeros(3,2,1)","size(squeeze(a))","b = zeros(1,1,3)","size(squeeze(b))"],seealso:["concat","det","diag","identity","inv","ones","range","size","subset","trace","transpose","zeros"]},subset:{name:"subset",category:"Matrix",syntax:["value(index)","value(index) = replacement","subset(value, [index])","subset(value, [index], replacement)"],description:"Get or set a subset of a matrix or string. Indexes are one-based. Both the ranges lower-bound and upper-bound are included.",examples:["d = [1, 2; 3, 4]","e = []","e[1, 1:2] = [5, 6]","e[2, :] = [7, 8]","f = d * e","f[2, 1]","f[:, 1]"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","trace","transpose","zeros"]},trace:{name:"trace",category:"Matrix",syntax:["trace(A)"],description:"Calculate the trace of a matrix: the sum of the elements on the main diagonal of a square matrix.",examples:["A = [1, 2, 3; -1, 2, 3; 2, 0, 3]","trace(A)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","transpose","zeros"]},transpose:{name:"transpose",category:"Matrix",syntax:["x'","transpose(x)"],description:"Transpose a matrix",examples:["a = [1, 2, 3; 4, 5, 6]","a'","transpose(a)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","zeros"]},zeros:{name:"zeros",category:"Matrix",syntax:["zeros(m)","zeros(m, n)","zeros(m, n, p, ...)","zeros([m])","zeros([m, n])","zeros([m, n, p, ...])"],description:"Create a matrix containing zeros.",examples:["zeros(3)","zeros(3, 5)","a = [1, 2, 3; 4, 5, 6]","zeros(size(a))"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose"]},combinations:{name:"combinations",category:"Probability",syntax:["combinations(n, k)"],description:"Compute the number of combinations of n items taken k at a time",examples:["combinations(7, 5)"],seealso:["combinationsWithRep","permutations","factorial"]},combinationsWithRep:{name:"combinationsWithRep",category:"Probability",syntax:["combinationsWithRep(n, k)"],description:"Compute the number of combinations of n items taken k at a time with replacements.",examples:["combinationsWithRep(7, 5)"],seealso:["combinations","permutations","factorial"]},factorial:{name:"factorial",category:"Probability",syntax:["n!","factorial(n)"],description:"Compute the factorial of a value",examples:["5!","5 * 4 * 3 * 2 * 1","3!"],seealso:["combinations","combinationsWithRep","permutations","gamma"]},gamma:{name:"gamma",category:"Probability",syntax:["gamma(n)"],description:"Compute the gamma function. For small values, the Lanczos approximation is used, and for large values the extended Stirling approximation.",examples:["gamma(4)","3!","gamma(1/2)","sqrt(pi)"],seealso:["factorial"]},kldivergence:{name:"kldivergence",category:"Probability",syntax:["kldivergence(x, y)"],description:"Calculate the Kullback-Leibler (KL) divergence  between two distributions.",examples:["kldivergence([0.7,0.5,0.4], [0.2,0.9,0.5])"],seealso:[]},multinomial:{name:"multinomial",category:"Probability",syntax:["multinomial(A)"],description:"Multinomial Coefficients compute the number of ways of picking a1, a2, ..., ai unordered outcomes from `n` possibilities. multinomial takes one array of integers as an argument. The following condition must be enforced: every ai > 0.",examples:["multinomial([1, 2, 1])"],seealso:["combinations","factorial"]},permutations:{name:"permutations",category:"Probability",syntax:["permutations(n)","permutations(n, k)"],description:"Compute the number of permutations of n items taken k at a time",examples:["permutations(5)","permutations(5, 3)"],seealso:["combinations","combinationsWithRep","factorial"]},pickRandom:{name:"pickRandom",category:"Probability",syntax:["pickRandom(array)","pickRandom(array, number)","pickRandom(array, weights)","pickRandom(array, number, weights)","pickRandom(array, weights, number)"],description:"Pick a random entry from a given array.",examples:["pickRandom(0:10)","pickRandom([1, 3, 1, 6])","pickRandom([1, 3, 1, 6], 2)","pickRandom([1, 3, 1, 6], [2, 3, 2, 1])","pickRandom([1, 3, 1, 6], 2, [2, 3, 2, 1])","pickRandom([1, 3, 1, 6], [2, 3, 2, 1], 2)"],seealso:["random","randomInt"]},random:{name:"random",category:"Probability",syntax:["random()","random(max)","random(min, max)","random(size)","random(size, max)","random(size, min, max)"],description:"Return a random number.",examples:["random()","random(10, 20)","random([2, 3])"],seealso:["pickRandom","randomInt"]},randomInt:{name:"randomInt",category:"Probability",syntax:["randomInt(max)","randomInt(min, max)","randomInt(size)","randomInt(size, max)","randomInt(size, min, max)"],description:"Return a random integer number",examples:["randomInt(10, 20)","randomInt([2, 3], 10)"],seealso:["pickRandom","random"]},compare:{name:"compare",category:"Relational",syntax:["compare(x, y)"],description:"Compare two values. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:["compare(2, 3)","compare(3, 2)","compare(2, 2)","compare(5cm, 40mm)","compare(2, [1, 2, 3])"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compareNatural","compareText"]},compareNatural:{name:"compareNatural",category:"Relational",syntax:["compareNatural(x, y)"],description:"Compare two values of any type in a deterministic, natural way. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:["compareNatural(2, 3)","compareNatural(3, 2)","compareNatural(2, 2)","compareNatural(5cm, 40mm)",'compareNatural("2", "10")',"compareNatural(2 + 3i, 2 + 4i)","compareNatural([1, 2, 4], [1, 2, 3])","compareNatural([1, 5], [1, 2, 3])","compareNatural([1, 2], [1, 2])","compareNatural({a: 2}, {a: 4})"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compare","compareText"]},compareText:{name:"compareText",category:"Relational",syntax:["compareText(x, y)"],description:"Compare two strings lexically. Comparison is case sensitive. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:['compareText("B", "A")','compareText("A", "B")','compareText("A", "A")','compareText("2", "10")','compare("2", "10")',"compare(2, 10)",'compareNatural("2", "10")','compareText("B", ["A", "B", "C"])'],seealso:["compare","compareNatural"]},deepEqual:{name:"deepEqual",category:"Relational",syntax:["deepEqual(x, y)"],description:"Check equality of two matrices element wise. Returns true if the size of both matrices is equal and when and each of the elements are equal.",examples:["deepEqual([1,3,4], [1,3,4])","deepEqual([1,3,4], [1,3])"],seealso:["equal","unequal","smaller","larger","smallerEq","largerEq","compare"]},equal:{name:"equal",category:"Relational",syntax:["x == y","equal(x, y)"],description:"Check equality of two values. Returns true if the values are equal, and false if not.",examples:["2+2 == 3","2+2 == 4","a = 3.2","b = 6-2.8","a == b","50cm == 0.5m"],seealso:["unequal","smaller","larger","smallerEq","largerEq","compare","deepEqual","equalText"]},equalText:{name:"equalText",category:"Relational",syntax:["equalText(x, y)"],description:"Check equality of two strings. Comparison is case sensitive. Returns true if the values are equal, and false if not.",examples:['equalText("Hello", "Hello")','equalText("a", "A")','equal("2e3", "2000")','equalText("2e3", "2000")','equalText("B", ["A", "B", "C"])'],seealso:["compare","compareNatural","compareText","equal"]},larger:{name:"larger",category:"Relational",syntax:["x > y","larger(x, y)"],description:"Check if value x is larger than y. Returns true if x is larger than y, and false if not.",examples:["2 > 3","5 > 2*2","a = 3.3","b = 6-2.8","(a > b)","(b < a)","5 cm > 2 inch"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compare"]},largerEq:{name:"largerEq",category:"Relational",syntax:["x >= y","largerEq(x, y)"],description:"Check if value x is larger or equal to y. Returns true if x is larger or equal to y, and false if not.",examples:["2 >= 1+1","2 > 1+1","a = 3.2","b = 6-2.8","(a >= b)"],seealso:["equal","unequal","smallerEq","smaller","compare"]},smaller:{name:"smaller",category:"Relational",syntax:["x < y","smaller(x, y)"],description:"Check if value x is smaller than value y. Returns true if x is smaller than y, and false if not.",examples:["2 < 3","5 < 2*2","a = 3.3","b = 6-2.8","(a < b)","5 cm < 2 inch"],seealso:["equal","unequal","larger","smallerEq","largerEq","compare"]},smallerEq:{name:"smallerEq",category:"Relational",syntax:["x <= y","smallerEq(x, y)"],description:"Check if value x is smaller or equal to value y. Returns true if x is smaller than y, and false if not.",examples:["2 <= 1+1","2 < 1+1","a = 3.2","b = 6-2.8","(a <= b)"],seealso:["equal","unequal","larger","smaller","largerEq","compare"]},unequal:{name:"unequal",category:"Relational",syntax:["x != y","unequal(x, y)"],description:"Check unequality of two values. Returns true if the values are unequal, and false if they are equal.",examples:["2+2 != 3","2+2 != 4","a = 3.2","b = 6-2.8","a != b","50cm != 0.5m","5 cm != 2 inch"],seealso:["equal","smaller","larger","smallerEq","largerEq","compare","deepEqual"]},setCartesian:{name:"setCartesian",category:"Set",syntax:["setCartesian(set1, set2)"],description:"Create the cartesian product of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays and the values will be sorted in ascending order before the operation.",examples:["setCartesian([1, 2], [3, 4])"],seealso:["setUnion","setIntersect","setDifference","setPowerset"]},setDifference:{name:"setDifference",category:"Set",syntax:["setDifference(set1, set2)"],description:"Create the difference of two (multi)sets: every element of set1, that is not the element of set2. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setDifference([1, 2, 3, 4], [3, 4, 5, 6])","setDifference([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setIntersect","setSymDifference"]},setDistinct:{name:"setDistinct",category:"Set",syntax:["setDistinct(set)"],description:"Collect the distinct elements of a multiset. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setDistinct([1, 1, 1, 2, 2, 3])"],seealso:["setMultiplicity"]},setIntersect:{name:"setIntersect",category:"Set",syntax:["setIntersect(set1, set2)"],description:"Create the intersection of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setIntersect([1, 2, 3, 4], [3, 4, 5, 6])","setIntersect([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setDifference"]},setIsSubset:{name:"setIsSubset",category:"Set",syntax:["setIsSubset(set1, set2)"],description:"Check whether a (multi)set is a subset of another (multi)set: every element of set1 is the element of set2. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setIsSubset([1, 2], [3, 4, 5, 6])","setIsSubset([3, 4], [3, 4, 5, 6])"],seealso:["setUnion","setIntersect","setDifference"]},setMultiplicity:{name:"setMultiplicity",category:"Set",syntax:["setMultiplicity(element, set)"],description:"Count the multiplicity of an element in a multiset. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setMultiplicity(1, [1, 2, 2, 4])","setMultiplicity(2, [1, 2, 2, 4])"],seealso:["setDistinct","setSize"]},setPowerset:{name:"setPowerset",category:"Set",syntax:["setPowerset(set)"],description:"Create the powerset of a (multi)set: the powerset contains very possible subsets of a (multi)set. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setPowerset([1, 2, 3])"],seealso:["setCartesian"]},setSize:{name:"setSize",category:"Set",syntax:["setSize(set)","setSize(set, unique)"],description:'Count the number of elements of a (multi)set. When the second parameter "unique" is true, count only the unique values. A multi-dimension array will be converted to a single-dimension array before the operation.',examples:["setSize([1, 2, 2, 4])","setSize([1, 2, 2, 4], true)"],seealso:["setUnion","setIntersect","setDifference"]},setSymDifference:{name:"setSymDifference",category:"Set",syntax:["setSymDifference(set1, set2)"],description:"Create the symmetric difference of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setSymDifference([1, 2, 3, 4], [3, 4, 5, 6])","setSymDifference([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setIntersect","setDifference"]},setUnion:{name:"setUnion",category:"Set",syntax:["setUnion(set1, set2)"],description:"Create the union of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setUnion([1, 2, 3, 4], [3, 4, 5, 6])","setUnion([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setIntersect","setDifference"]},erf:{name:"erf",category:"Special",syntax:["erf(x)"],description:"Compute the erf function of a value using a rational Chebyshev approximations for different intervals of x",examples:["erf(0.2)","erf(-0.5)","erf(4)"],seealso:[]},mad:{name:"mad",category:"Statistics",syntax:["mad(a, b, c, ...)","mad(A)"],description:"Compute the median absolute deviation of a matrix or a list with values. The median absolute deviation is defined as the median of the absolute deviations from the median.",examples:["mad(10, 20, 30)","mad([1, 2, 3])"],seealso:["mean","median","std","abs"]},max:{name:"max",category:"Statistics",syntax:["max(a, b, c, ...)","max(A)","max(A, dim)"],description:"Compute the maximum value of a list of values.",examples:["max(2, 3, 4, 1)","max([2, 3, 4, 1])","max([2, 5; 4, 3])","max([2, 5; 4, 3], 1)","max([2, 5; 4, 3], 2)","max(2.7, 7.1, -4.5, 2.0, 4.1)","min(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["mean","median","min","prod","std","sum","variance"]},mean:{name:"mean",category:"Statistics",syntax:["mean(a, b, c, ...)","mean(A)","mean(A, dim)"],description:"Compute the arithmetic mean of a list of values.",examples:["mean(2, 3, 4, 1)","mean([2, 3, 4, 1])","mean([2, 5; 4, 3])","mean([2, 5; 4, 3], 1)","mean([2, 5; 4, 3], 2)","mean([1.0, 2.7, 3.2, 4.0])"],seealso:["max","median","min","prod","std","sum","variance"]},median:{name:"median",category:"Statistics",syntax:["median(a, b, c, ...)","median(A)"],description:"Compute the median of all values. The values are sorted and the middle value is returned. In case of an even number of values, the average of the two middle values is returned.",examples:["median(5, 2, 7)","median([3, -1, 5, 7])"],seealso:["max","mean","min","prod","std","sum","variance","quantileSeq"]},min:{name:"min",category:"Statistics",syntax:["min(a, b, c, ...)","min(A)","min(A, dim)"],description:"Compute the minimum value of a list of values.",examples:["min(2, 3, 4, 1)","min([2, 3, 4, 1])","min([2, 5; 4, 3])","min([2, 5; 4, 3], 1)","min([2, 5; 4, 3], 2)","min(2.7, 7.1, -4.5, 2.0, 4.1)","max(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["max","mean","median","prod","std","sum","variance"]},mode:{name:"mode",category:"Statistics",syntax:["mode(a, b, c, ...)","mode(A)","mode(A, a, b, B, c, ...)"],description:"Computes the mode of all values as an array. In case mode being more than one, multiple values are returned in an array.",examples:["mode(2, 1, 4, 3, 1)","mode([1, 2.7, 3.2, 4, 2.7])","mode(1, 4, 6, 1, 6)"],seealso:["max","mean","min","median","prod","std","sum","variance"]},prod:{name:"prod",category:"Statistics",syntax:["prod(a, b, c, ...)","prod(A)"],description:"Compute the product of all values.",examples:["prod(2, 3, 4)","prod([2, 3, 4])","prod([2, 5; 4, 3])"],seealso:["max","mean","min","median","min","std","sum","variance"]},quantileSeq:{name:"quantileSeq",category:"Statistics",syntax:["quantileSeq(A, prob[, sorted])","quantileSeq(A, [prob1, prob2, ...][, sorted])","quantileSeq(A, N[, sorted])"],description:"Compute the prob order quantile of a matrix or a list with values. The sequence is sorted and the middle value is returned. Supported types of sequence values are: Number, BigNumber, Unit Supported types of probablity are: Number, BigNumber. \n\nIn case of a (multi dimensional) array or matrix, the prob order quantile of all elements will be calculated.",examples:["quantileSeq([3, -1, 5, 7], 0.5)","quantileSeq([3, -1, 5, 7], [1/3, 2/3])","quantileSeq([3, -1, 5, 7], 2)","quantileSeq([-1, 3, 5, 7], 0.5, true)"],seealso:["mean","median","min","max","prod","std","sum","variance"]},std:{name:"std",category:"Statistics",syntax:["std(a, b, c, ...)","std(A)","std(A, normalization)"],description:'Compute the standard deviation of all values, defined as std(A) = sqrt(variance(A)). Optional parameter normalization can be "unbiased" (default), "uncorrected", or "biased".',examples:["std(2, 4, 6)","std([2, 4, 6, 8])",'std([2, 4, 6, 8], "uncorrected")','std([2, 4, 6, 8], "biased")',"std([1, 2, 3; 4, 5, 6])"],seealso:["max","mean","min","median","prod","sum","variance"]},sum:{name:"sum",category:"Statistics",syntax:["sum(a, b, c, ...)","sum(A)"],description:"Compute the sum of all values.",examples:["sum(2, 3, 4, 1)","sum([2, 3, 4, 1])","sum([2, 5; 4, 3])"],seealso:["max","mean","median","min","prod","std","sum","variance"]},variance:{name:"variance",category:"Statistics",syntax:["variance(a, b, c, ...)","variance(A)","variance(A, normalization)"],description:'Compute the variance of all values. Optional parameter normalization can be "unbiased" (default), "uncorrected", or "biased".',examples:["variance(2, 4, 6)","variance([2, 4, 6, 8])",'variance([2, 4, 6, 8], "uncorrected")','variance([2, 4, 6, 8], "biased")',"variance([1, 2, 3; 4, 5, 6])"],seealso:["max","mean","min","median","min","prod","std","sum"]},acos:{name:"acos",category:"Trigonometry",syntax:["acos(x)"],description:"Compute the inverse cosine of a value in radians.",examples:["acos(0.5)","acos(cos(2.3))"],seealso:["cos","atan","asin"]},acosh:{name:"acosh",category:"Trigonometry",syntax:["acosh(x)"],description:"Calculate the hyperbolic arccos of a value, defined as `acosh(x) = ln(sqrt(x^2 - 1) + x)`.",examples:["acosh(1.5)"],seealso:["cosh","asinh","atanh"]},acot:{name:"acot",category:"Trigonometry",syntax:["acot(x)"],description:"Calculate the inverse cotangent of a value.",examples:["acot(0.5)","acot(cot(0.5))","acot(2)"],seealso:["cot","atan"]},acoth:{name:"acoth",category:"Trigonometry",syntax:["acoth(x)"],description:"Calculate the hyperbolic arccotangent of a value, defined as `acoth(x) = (ln((x+1)/x) + ln(x/(x-1))) / 2`.",examples:["acoth(2)","acoth(0.5)"],seealso:["acsch","asech"]},acsc:{name:"acsc",category:"Trigonometry",syntax:["acsc(x)"],description:"Calculate the inverse cotangent of a value.",examples:["acsc(2)","acsc(csc(0.5))","acsc(0.5)"],seealso:["csc","asin","asec"]},acsch:{name:"acsch",category:"Trigonometry",syntax:["acsch(x)"],description:"Calculate the hyperbolic arccosecant of a value, defined as `acsch(x) = ln(1/x + sqrt(1/x^2 + 1))`.",examples:["acsch(0.5)"],seealso:["asech","acoth"]},asec:{name:"asec",category:"Trigonometry",syntax:["asec(x)"],description:"Calculate the inverse secant of a value.",examples:["asec(0.5)","asec(sec(0.5))","asec(2)"],seealso:["acos","acot","acsc"]},asech:{name:"asech",category:"Trigonometry",syntax:["asech(x)"],description:"Calculate the inverse secant of a value.",examples:["asech(0.5)"],seealso:["acsch","acoth"]},asin:{name:"asin",category:"Trigonometry",syntax:["asin(x)"],description:"Compute the inverse sine of a value in radians.",examples:["asin(0.5)","asin(sin(0.5))"],seealso:["sin","acos","atan"]},asinh:{name:"asinh",category:"Trigonometry",syntax:["asinh(x)"],description:"Calculate the hyperbolic arcsine of a value, defined as `asinh(x) = ln(x + sqrt(x^2 + 1))`.",examples:["asinh(0.5)"],seealso:["acosh","atanh"]},atan:{name:"atan",category:"Trigonometry",syntax:["atan(x)"],description:"Compute the inverse tangent of a value in radians.",examples:["atan(0.5)","atan(tan(0.5))"],seealso:["tan","acos","asin"]},atanh:{name:"atanh",category:"Trigonometry",syntax:["atanh(x)"],description:"Calculate the hyperbolic arctangent of a value, defined as `atanh(x) = ln((1 + x)/(1 - x)) / 2`.",examples:["atanh(0.5)"],seealso:["acosh","asinh"]},atan2:{name:"atan2",category:"Trigonometry",syntax:["atan2(y, x)"],description:"Computes the principal value of the arc tangent of y/x in radians.",examples:["atan2(2, 2) / pi","angle = 60 deg in rad","x = cos(angle)","y = sin(angle)","atan2(y, x)"],seealso:["sin","cos","tan"]},cos:{name:"cos",category:"Trigonometry",syntax:["cos(x)"],description:"Compute the cosine of x in radians.",examples:["cos(2)","cos(pi / 4) ^ 2","cos(180 deg)","cos(60 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["acos","sin","tan"]},cosh:{name:"cosh",category:"Trigonometry",syntax:["cosh(x)"],description:"Compute the hyperbolic cosine of x in radians.",examples:["cosh(0.5)"],seealso:["sinh","tanh","coth"]},cot:{name:"cot",category:"Trigonometry",syntax:["cot(x)"],description:"Compute the cotangent of x in radians. Defined as 1/tan(x)",examples:["cot(2)","1 / tan(2)"],seealso:["sec","csc","tan"]},coth:{name:"coth",category:"Trigonometry",syntax:["coth(x)"],description:"Compute the hyperbolic cotangent of x in radians.",examples:["coth(2)","1 / tanh(2)"],seealso:["sech","csch","tanh"]},csc:{name:"csc",category:"Trigonometry",syntax:["csc(x)"],description:"Compute the cosecant of x in radians. Defined as 1/sin(x)",examples:["csc(2)","1 / sin(2)"],seealso:["sec","cot","sin"]},csch:{name:"csch",category:"Trigonometry",syntax:["csch(x)"],description:"Compute the hyperbolic cosecant of x in radians. Defined as 1/sinh(x)",examples:["csch(2)","1 / sinh(2)"],seealso:["sech","coth","sinh"]},sec:{name:"sec",category:"Trigonometry",syntax:["sec(x)"],description:"Compute the secant of x in radians. Defined as 1/cos(x)",examples:["sec(2)","1 / cos(2)"],seealso:["cot","csc","cos"]},sech:{name:"sech",category:"Trigonometry",syntax:["sech(x)"],description:"Compute the hyperbolic secant of x in radians. Defined as 1/cosh(x)",examples:["sech(2)","1 / cosh(2)"],seealso:["coth","csch","cosh"]},sin:{name:"sin",category:"Trigonometry",syntax:["sin(x)"],description:"Compute the sine of x in radians.",examples:["sin(2)","sin(pi / 4) ^ 2","sin(90 deg)","sin(30 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["asin","cos","tan"]},sinh:{name:"sinh",category:"Trigonometry",syntax:["sinh(x)"],description:"Compute the hyperbolic sine of x in radians.",examples:["sinh(0.5)"],seealso:["cosh","tanh"]},tan:{name:"tan",category:"Trigonometry",syntax:["tan(x)"],description:"Compute the tangent of x in radians.",examples:["tan(0.5)","sin(0.5) / cos(0.5)","tan(pi / 4)","tan(45 deg)"],seealso:["atan","sin","cos"]},tanh:{name:"tanh",category:"Trigonometry",syntax:["tanh(x)"],description:"Compute the hyperbolic tangent of x in radians.",examples:["tanh(0.5)","sinh(0.5) / cosh(0.5)"],seealso:["sinh","cosh"]},to:{name:"to",category:"Units",syntax:["x to unit","to(x, unit)"],description:"Change the unit of a value.",examples:["5 inch to cm","3.2kg to g","16 bytes in bits"],seealso:[]},clone:{name:"clone",category:"Utils",syntax:["clone(x)"],description:"Clone a variable. Creates a copy of primitive variables,and a deep copy of matrices",examples:["clone(3.5)","clone(2 - 4i)","clone(45 deg)","clone([1, 2; 3, 4])",'clone("hello world")'],seealso:[]},format:{name:"format",category:"Utils",syntax:["format(value)","format(value, precision)"],description:"Format a value of any type as string.",examples:["format(2.3)","format(3 - 4i)","format([])","format(pi, 3)"],seealso:["print"]},bin:{name:"bin",category:"Utils",syntax:["bin(value)"],description:"Format a number as binary",examples:["bin(2)"],seealso:["oct","hex"]},oct:{name:"oct",category:"Utils",syntax:["oct(value)"],description:"Format a number as octal",examples:["oct(56)"],seealso:["bin","hex"]},hex:{name:"hex",category:"Utils",syntax:["hex(value)"],description:"Format a number as hexadecimal",examples:["hex(240)"],seealso:["bin","oct"]},isNaN:{name:"isNaN",category:"Utils",syntax:["isNaN(x)"],description:"Test whether a value is NaN (not a number)",examples:["isNaN(2)","isNaN(0 / 0)","isNaN(NaN)","isNaN(Infinity)"],seealso:["isNegative","isNumeric","isPositive","isZero"]},isInteger:{name:"isInteger",category:"Utils",syntax:["isInteger(x)"],description:"Test whether a value is an integer number.",examples:["isInteger(2)","isInteger(3.5)","isInteger([3, 0.5, -2])"],seealso:["isNegative","isNumeric","isPositive","isZero"]},isNegative:{name:"isNegative",category:"Utils",syntax:["isNegative(x)"],description:"Test whether a value is negative: smaller than zero.",examples:["isNegative(2)","isNegative(0)","isNegative(-4)","isNegative([3, 0.5, -2])"],seealso:["isInteger","isNumeric","isPositive","isZero"]},isNumeric:{name:"isNumeric",category:"Utils",syntax:["isNumeric(x)"],description:"Test whether a value is a numeric value. Returns true when the input is a number, BigNumber, Fraction, or boolean.",examples:["isNumeric(2)",'isNumeric("2")','hasNumericValue("2")',"isNumeric(0)","isNumeric(bignumber(500))","isNumeric(fraction(0.125))","isNumeric(2 + 3i)",'isNumeric([2.3, "foo", false])'],seealso:["isInteger","isZero","isNegative","isPositive","isNaN","hasNumericValue"]},hasNumericValue:{name:"hasNumericValue",category:"Utils",syntax:["hasNumericValue(x)"],description:"Test whether a value is an numeric value. In case of a string, true is returned if the string contains a numeric value.",examples:["hasNumericValue(2)",'hasNumericValue("2")','isNumeric("2")',"hasNumericValue(0)","hasNumericValue(bignumber(500))","hasNumericValue(fraction(0.125))","hasNumericValue(2 + 3i)",'hasNumericValue([2.3, "foo", false])'],seealso:["isInteger","isZero","isNegative","isPositive","isNaN","isNumeric"]},isPositive:{name:"isPositive",category:"Utils",syntax:["isPositive(x)"],description:"Test whether a value is positive: larger than zero.",examples:["isPositive(2)","isPositive(0)","isPositive(-4)","isPositive([3, 0.5, -2])"],seealso:["isInteger","isNumeric","isNegative","isZero"]},isPrime:{name:"isPrime",category:"Utils",syntax:["isPrime(x)"],description:"Test whether a value is prime: has no divisors other than itself and one.",examples:["isPrime(3)","isPrime(-2)","isPrime([2, 17, 100])"],seealso:["isInteger","isNumeric","isNegative","isZero"]},isZero:{name:"isZero",category:"Utils",syntax:["isZero(x)"],description:"Test whether a value is zero.",examples:["isZero(2)","isZero(0)","isZero(-4)","isZero([3, 0, -2, 0])"],seealso:["isInteger","isNumeric","isNegative","isPositive"]},print:{name:"print",category:"Utils",syntax:["print(template, values)","print(template, values, precision)"],description:"Interpolate values into a string template.",examples:['print("Lucy is $age years old", {age: 5})','print("The value of pi is $pi", {pi: pi}, 3)','print("Hello, $user.name!", {user: {name: "John"}})','print("Values: $0, $1, $2", [6, 9, 4])'],seealso:["format"]},typeOf:{name:"typeOf",category:"Utils",syntax:["typeOf(x)"],description:"Get the type of a variable.",examples:["typeOf(3.5)","typeOf(2 - 4i)","typeOf(45 deg)",'typeOf("hello world")'],seealso:["getMatrixDataType"]},numeric:{name:"numeric",category:"Utils",syntax:["numeric(x)"],description:"Convert a numeric input to a specific numeric type: number, BigNumber, or Fraction.",examples:['numeric("4")','numeric("4", "number")','numeric("4", "BigNumber")','numeric("4", "Fraction)','numeric(4, "Fraction")','numeric(fraction(2, 5), "number)'],seealso:["number","fraction","bignumber","string","format"]}},ub="help",cb=be(ub,["typed","mathWithTransform","Help"],(e=>{var{typed:t,mathWithTransform:n,Help:r}=e;return t(ub,{any:function(e){var t,i=e;if("string"!=typeof e)for(t in n)if(fe(n,t)&&e===n[t]){i=t;break}var a=lr(sb,i);if(!a){var o="function"==typeof i?i.name:i;throw new Error('No documentation found on "'+o+'"')}return new r(a)}})})),lb="rationalize",fb=be(lb,["config","typed","equal","isZero","add","subtract","multiply","divide","pow","parse","simplify","?bignumber","?fraction","mathWithTransform","matrix","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","SymbolNode","ParenthesisNode"],(e=>{var{config:t,typed:n,equal:r,isZero:i,add:a,subtract:o,multiply:s,divide:u,pow:c,parse:l,simplify:f,fraction:p,bignumber:h,mathWithTransform:d,matrix:m,AccessorNode:g,ArrayNode:v,ConstantNode:y,FunctionNode:b,IndexNode:x,ObjectNode:w,OperatorNode:E,SymbolNode:C,ParenthesisNode:S}=e,N=tb({typed:n,config:t,mathWithTransform:d,matrix:m,fraction:p,bignumber:h,AccessorNode:g,ArrayNode:v,ConstantNode:y,FunctionNode:b,IndexNode:x,ObjectNode:w,OperatorNode:E,SymbolNode:C}),A=eb({equal:r,isZero:i,add:a,subtract:o,multiply:s,divide:u,pow:c,AccessorNode:g,ArrayNode:v,ConstantNode:y,FunctionNode:b,IndexNode:x,ObjectNode:w,OperatorNode:E,ParenthesisNode:S});return n(lb,{string:function(e){return this(l(e),{},!1)},"string, boolean":function(e,t){return this(l(e),{},t)},"string, Object":function(e,t){return this(l(e),t,!1)},"string, Object, boolean":function(e,t,n){return this(l(e),t,n)},Node:function(e){return this(e,{},!1)},"Node, boolean":function(e,t){return this(e,{},t)},"Node, Object":function(e,t){return this(e,t,!1)},"Node, Object, boolean":function(e,t,n){var r=function(){var e=[A,{l:"n+n",r:"2*n"},{l:"n+-n",r:"0"},N,{l:"n*(n1^-1)",r:"n/n1"},{l:"n*n1^-n2",r:"n/n1^n2"},{l:"n1^-1",r:"1/n1"},{l:"n*(n1/n2)",r:"(n*n1)/n2"},{l:"1*n",r:"n"}],t=[{l:"(-n1)/(-n2)",r:"n1/n2"},{l:"(-n1)*(-n2)",r:"n1*n2"},{l:"n1--n2",r:"n1+n2"},{l:"n1-n2",r:"n1+(-n2)"},{l:"(n1+n2)*n3",r:"(n1*n3 + n2*n3)"},{l:"n1*(n2+n3)",r:"(n1*n2+n1*n3)"},{l:"c1*n + c2*n",r:"(c1+c2)*n"},{l:"c1*n + n",r:"(c1+1)*n"},{l:"c1*n - c2*n",r:"(c1-c2)*n"},{l:"c1*n - n",r:"(c1-1)*n"},{l:"v/c",r:"(1/c)*v"},{l:"v/-c",r:"-(1/c)*v"},{l:"-v*-c",r:"c*v"},{l:"-v*c",r:"-c*v"},{l:"v*-c",r:"-c*v"},{l:"v*c",r:"c*v"},{l:"-(-n1*n2)",r:"(n1*n2)"},{l:"-(n1*n2)",r:"(-n1*n2)"},{l:"-(-n1+n2)",r:"(n1-n2)"},{l:"-(n1+n2)",r:"(-n1-n2)"},{l:"(n1^n2)^n3",r:"(n1^(n2*n3))"},{l:"-(-n1/n2)",r:"(n1/n2)"},{l:"-(n1/n2)",r:"(-n1/n2)"}],n=[{l:"(n1/(n2/n3))",r:"((n1*n3)/n2)"},{l:"(n1/n2/n3)",r:"(n1/(n2*n3))"}],r={};return r.firstRules=e.concat(t,n),r.distrDivRules=[{l:"(n1/n2 + n3/n4)",r:"((n1*n4 + n3*n2)/(n2*n4))"},{l:"(n1/n2 + n3)",r:"((n1 + n3*n2)/n2)"},{l:"(n1 + n2/n3)",r:"((n1*n3 + n2)/n3)"}],r.sucDivRules=n,r.firstRulesAgain=e.concat(t),r.finalRules=[A,{l:"n*-n",r:"-n^2"},{l:"n*n",r:"n^2"},N,{l:"n*-n^n1",r:"-n^(n1+1)"},{l:"n*n^n1",r:"n^(n1+1)"},{l:"n^n1*-n^n2",r:"-n^(n1+n2)"},{l:"n^n1*n^n2",r:"n^(n1+n2)"},{l:"n^n1*-n",r:"-n^(n1+1)"},{l:"n^n1*n",r:"n^(n1+1)"},{l:"n^n1/-n",r:"-n^(n1-1)"},{l:"n^n1/n",r:"n^(n1-1)"},{l:"n/-n^n1",r:"-n^(1-n1)"},{l:"n/n^n1",r:"n^(1-n1)"},{l:"n^n1/-n^n2",r:"n^(n1-n2)"},{l:"n^n1/n^n2",r:"n^(n1-n2)"},{l:"n1+(-n2*n3)",r:"n1-n2*n3"},{l:"v*(-c)",r:"-c*v"},{l:"n1+-n2",r:"n1-n2"},{l:"v*c",r:"c*v"},{l:"(n1^n2)^n3",r:"(n1^(n2*n3))"}],r}(),i=function(e,t,n,r){var i=[],a=f(e,r,t,{exactFractions:!1}),o="+-*"+((n=!!n)?"/":"");!function e(t){var n=t.type;if("FunctionNode"===n)throw new Error("There is an unsolved function call");if("OperatorNode"===n)if("^"===t.op){if("ConstantNode"!==t.args[1].type||!Se(parseFloat(t.args[1].value)))throw new Error("There is a non-integer exponent");e(t.args[0])}else{if(-1===o.indexOf(t.op))throw new Error("Operator "+t.op+" invalid in polynomial expression");for(var r=0;r<t.args.length;r++)e(t.args[r])}else if("SymbolNode"===n){var a=t.name;-1===i.indexOf(a)&&i.push(a)}else if("ParenthesisNode"===n)e(t.content);else if("ConstantNode"!==n)throw new Error("type "+n+" is not allowed in polynomial expression")}(a);var s={};return s.expression=a,s.variables=i,s}(e,t,!0,r.firstRules),a=i.variables.length;if(e=i.expression,a>=1){var o,s;e=k(e);var u,c=!0,l=!1;for(e=f(e,r.firstRules,{},{exactFractions:!1});s=c?r.distrDivRules:r.sucDivRules,c=!c,(u=(e=f(e,s)).toString())!==o;)l=!0,o=u;l&&(e=f(e,r.firstRulesAgain,{},{exactFractions:!1})),e=f(e,r.finalRules,{},{exactFractions:!1})}var p=[],h={};return"OperatorNode"===e.type&&e.isBinary()&&"/"===e.op?(1===a&&(e.args[0]=D(e.args[0],p),e.args[1]=D(e.args[1])),n&&(h.numerator=e.args[0],h.denominator=e.args[1])):(1===a&&(e=D(e,p)),n&&(h.numerator=e,h.denominator=null)),n?(h.coefficients=p,h.variables=i.variables,h.expression=e,h):e}});function k(e,t,n){var r=e.type,i=arguments.length>1;if("OperatorNode"===r&&e.isBinary()){var a,o=!1;if("^"===e.op&&("ParenthesisNode"!==e.args[0].type&&"OperatorNode"!==e.args[0].type||"ConstantNode"!==e.args[1].type||(o=(a=parseFloat(e.args[1].value))>=2&&Se(a))),o){if(a>2){var s=e.args[0],u=new E("^","pow",[e.args[0].cloneDeep(),new y(a-1)]);e=new E("*","multiply",[s,u])}else e=new E("*","multiply",[e.args[0],e.args[0].cloneDeep()]);i&&("content"===n?t.content=e:t.args[n]=e)}}if("ParenthesisNode"===r)k(e.content,e,"content");else if("ConstantNode"!==r&&"SymbolNode"!==r)for(var c=0;c<e.args.length;c++)k(e.args[c],e,c);if(!i)return e}function D(e,t){void 0===t&&(t=[]),t[0]=0;var n=0,r="";!function e(i,a,o){var s=i.type;if("FunctionNode"===s)throw new Error("There is an unsolved function call");if("OperatorNode"===s){if(-1==="+-*^".indexOf(i.op))throw new Error("Operator "+i.op+" invalid");if(null!==a){if(("unaryMinus"===i.fn||"pow"===i.fn)&&"add"!==a.fn&&"subtract"!==a.fn&&"multiply"!==a.fn)throw new Error("Invalid "+i.op+" placing");if(("subtract"===i.fn||"add"===i.fn||"multiply"===i.fn)&&"add"!==a.fn&&"subtract"!==a.fn)throw new Error("Invalid "+i.op+" placing");if(("subtract"===i.fn||"add"===i.fn||"unaryMinus"===i.fn)&&0!==o.noFil)throw new Error("Invalid "+i.op+" placing")}"^"!==i.op&&"*"!==i.op||(o.fire=i.op);for(var u=0;u<i.args.length;u++)"unaryMinus"===i.fn&&(o.oper="-"),"+"!==i.op&&"subtract"!==i.fn||(o.fire="",o.cte=1,o.oper=0===u?"+":i.op),o.noFil=u,e(i.args[u],i,o)}else if("SymbolNode"===s){if(i.name!==r&&""!==r)throw new Error("There is more than one variable");if(r=i.name,null===a)return void(t[1]=1);if("^"===a.op&&0!==o.noFil)throw new Error("In power the variable should be the first parameter");if("*"===a.op&&1!==o.noFil)throw new Error("In multiply the variable should be the second parameter");""!==o.fire&&"*"!==o.fire||(n<1&&(t[1]=0),t[1]+=o.cte*("+"===o.oper?1:-1),n=Math.max(1,n))}else{if("ConstantNode"!==s)throw new Error("Type "+s+" is not allowed");var c=parseFloat(i.value);if(null===a)return void(t[0]=c);if("^"===a.op){if(1!==o.noFil)throw new Error("Constant cannot be powered");if(!Se(c)||c<=0)throw new Error("Non-integer exponent is not allowed");for(var l=n+1;l<c;l++)t[l]=0;return c>n&&(t[c]=0),t[c]+=o.cte*("+"===o.oper?1:-1),void(n=Math.max(c,n))}o.cte=c,""===o.fire&&(t[0]+=o.cte*("+"===o.oper?1:-1))}}(e,null,{cte:1,oper:"+",fire:""});for(var i,a=!0,o=n=t.length-1;o>=0;o--)if(0!==t[o]){var s=new y(a?t[o]:Math.abs(t[o])),u=t[o]<0?"-":"+";if(o>0){var c=new C(r);if(o>1){var l=new y(o);c=new E("^","pow",[c,l])}s=-1===t[o]&&a?new E("-","unaryMinus",[c]):1===Math.abs(t[o])?c:new E("*","multiply",[s,c])}i=a?s:"+"===u?new E("+","add",[i,s]):new E("-","subtract",[i,s]),a=!1}return a?new y(0):i}}));function pb(e,t,n){var r=e.filter((function(e){return ee(e)&&!(e.name in t)&&!n.has(e.name)}))[0];if(!r)throw new Error('No undefined variable found in inline expression "'+e+'"');var i=r.name,a=Uy(n),o=e.compile();return function(e){return a.set(i,e),o.evaluate(a)}}var hb=be("filter",["typed"],(e=>{var{typed:t}=e;function n(e,t,n){var i,a;return e[0]&&(i=e[0].compile().evaluate(n)),e[1]&&(a=ee(e[1])||H(e[1])?e[1].compile().evaluate(n):pb(e[1],t,n)),r(i,a)}n.rawArgs=!0;var r=t("filter",{"Array, function":db,"Matrix, function":function(e,t){return e.create(db(e.toArray(),t))},"Array, RegExp":tr,"Matrix, RegExp":function(e,t){return e.create(tr(e.toArray(),t))}});return n}),{isTransformFunction:!0});function db(e,t){var n=Xe(t);return er(e,(function(e,r,i){return 1===n?t(e):2===n?t(e,[r+1]):t(e,[r+1],i)}))}var mb=be("forEach",["typed"],(e=>{var{typed:t}=e;function n(e,t,n){var i,a;return e[0]&&(i=e[0].compile().evaluate(n)),e[1]&&(a=ee(e[1])||H(e[1])?e[1].compile().evaluate(n):pb(e[1],t,n)),r(i,a)}n.rawArgs=!0;var r=t("forEach",{"Array | Matrix, function":function(e,t){var n=Xe(t);!function r(i,a){Array.isArray(i)?Qn(i,(function(e,t){r(e,a.concat(t+1))})):1===n?t(i):2===n?t(i,a):t(i,a,e)}(e.valueOf(),[])}});return n}),{isTransformFunction:!0}),gb=be("map",["typed"],(e=>{var{typed:t}=e;function n(e,t,n){var i,a;return e[0]&&(i=e[0].compile().evaluate(n)),e[1]&&(a=ee(e[1])||H(e[1])?e[1].compile().evaluate(n):pb(e[1],t,n)),r(i,a)}n.rawArgs=!0;var r=t("map",{"Array, function":function(e,t){return vb(e,t,e)},"Matrix, function":function(e,t){return e.create(vb(e.valueOf(),t,e))}});return n}),{isTransformFunction:!0});function vb(e,t,n){var r=Xe(t);return function e(i,a){return Array.isArray(i)?Zn(i,(function(t,n){return e(t,a.concat(n+1))})):1===r?t(i):2===r?t(i,a):t(i,a,n)}(e,[])}var yb=be("apply",["typed","isInteger"],(e=>{var{typed:t,isInteger:n}=e,r=Jo({typed:t,isInteger:n});return t("apply",{"...any":function(e){var t=e[1];y(t)?e[1]=t-1:b(t)&&(e[1]=t.minus(1));try{return r.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0});function bb(e){if(2===e.length&&A(e[0])){var t=(e=e.slice())[1];y(t)?e[1]=t-1:b(t)&&(e[1]=t.minus(1))}return e}var xb="diff",wb=be(xb,["typed","matrix","subtract","number","bignumber"],(e=>{var{typed:t,matrix:n,subtract:r,number:i,bignumber:a}=e,o=al({typed:t,matrix:n,subtract:r,number:i,bignumber:a});return t(xb,{"...any":function(e){e=bb(e);try{return o.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Eb=be("index",["Index"],(e=>{var{Index:t}=e;return function(){for(var e=[],n=0,r=arguments.length;n<r;n++){var i=arguments[n];if(_(i))i.start--,i.end-=i.step>0?0:2;else if(i&&!0===i.isSet)i=i.map((function(e){return e-1}));else if(S(i)||N(i))i=i.map((function(e){return e-1}));else if(y(i))i--;else if(b(i))i=i.toNumber()-1;else if("string"!=typeof i)throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");e[n]=i}var a=new t;return t.apply(a,e),a}}),{isTransformFunction:!0}),Cb=be("subset",["typed","matrix"],(e=>{var{typed:t,matrix:n}=e,r=lu({typed:t,matrix:n});return t("subset",{"...any":function(e){try{return r.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Sb=be("concat",["typed","matrix","isInteger"],(e=>{var{typed:t,matrix:n,isInteger:r}=e,i=zu({typed:t,matrix:n,isInteger:r});return t("concat",{"...any":function(e){var t=e.length-1,n=e[t];y(n)?e[t]=n-1:b(n)&&(e[t]=n.minus(1));try{return i.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Nb=be("max",["typed","config","numeric","larger"],(e=>{var{typed:t,config:n,numeric:r,larger:i}=e,a=Nf({typed:t,config:n,numeric:r,larger:i});return t("max",{"...any":function(e){e=bb(e);try{return a.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Ab=be("min",["typed","config","numeric","smaller"],(e=>{var{typed:t,config:n,numeric:r,smaller:i}=e,a=bc({typed:t,config:n,numeric:r,smaller:i});return t("min",{"...any":function(e){e=bb(e);try{return a.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),kb=be("range",["typed","config","?matrix","?bignumber","smaller","smallerEq","larger","largerEq"],(e=>{var{typed:t,config:n,matrix:r,bignumber:i,smaller:a,smallerEq:o,larger:s,largerEq:u}=e,c=Al({typed:t,config:n,matrix:r,bignumber:i,smaller:a,smallerEq:o,larger:s,largerEq:u});return t("range",{"...any":function(e){return"boolean"!=typeof e[e.length-1]&&e.push(!0),c.apply(null,e)}})}),{isTransformFunction:!0}),Db=be("row",["typed","Index","matrix","range"],(e=>{var{typed:t,Index:n,matrix:r,range:i}=e,a=_l({typed:t,Index:n,matrix:r,range:i});return t("row",{"...any":function(e){var t=e.length-1,n=e[t];y(n)&&(e[t]=n-1);try{return a.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),_b=be("sum",["typed","config","add","numeric"],(e=>{var{typed:t,config:n,add:r,numeric:i}=e,a=Jl({typed:t,config:n,add:r,numeric:i});return t("sum",{"...any":function(e){e=bb(e);try{return a.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Mb=be("column",["typed","Index","matrix","range"],(e=>{var{typed:t,Index:n,matrix:r,range:i}=e,a=of({typed:t,Index:n,matrix:r,range:i});return t("column",{"...any":function(e){var t=e.length-1,n=e[t];y(n)&&(e[t]=n-1);try{return a.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Tb=be("mean",["typed","add","divide"],(e=>{var{typed:t,add:n,divide:r}=e,i=Cp({typed:t,add:n,divide:r});return t("mean",{"...any":function(e){e=bb(e);try{return i.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Ob="variance",Ib=be(Ob,["typed","add","subtract","multiply","divide","apply","isNaN"],(e=>{var{typed:t,add:n,subtract:r,multiply:i,divide:a,apply:o,isNaN:s}=e,u=Dp({typed:t,add:n,subtract:r,multiply:i,divide:a,apply:o,isNaN:s});return t(Ob,{"...any":function(e){e=bb(e);try{return u.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Fb=be("std",["typed","sqrt","variance"],(e=>{var{typed:t,sqrt:n,variance:r}=e,i=_p({typed:t,sqrt:n,variance:r});return t("std",{"...any":function(e){e=bb(e);try{return i.apply(null,e)}catch(e){throw Ry(e)}}})}),{isTransformFunction:!0}),Rb={},Bb={},zb={},Pb=uy({math:Rb}),Lb=ly({mathWithTransform:Bb}),jb=fy({Node:Lb}),Ub=Cy({Node:Lb}),qb=Sy({Node:Lb}),Wb=Ny({Node:Lb}),Vb=Ay({Node:Lb}),$b=ky({Node:Lb,ResultSet:sh}),Hb=Dy({Node:Lb}),Gb=_y({Node:Lb}),Kb=My({Node:Lb}),Xb=Ty({classes:zb}),Yb=Iy({Chain:Pb,typed:bh}),Jb=Fy({Node:Lb,typed:bh}),Zb=zy({Node:Lb,subset:nm}),Qb=Py({matrix:$d,Node:Lb,subset:nm}),ex=Ly({Node:Lb,Range:oh,size:Qd}),tx=jy({Unit:Pg,Node:Lb,math:Rb}),nx=qy({Node:Lb,SymbolNode:tx,math:Rb}),rx=Vy({AccessorNode:Zb,ArrayNode:Vb,AssignmentNode:Qb,BlockNode:$b,ConditionalNode:Hb,ConstantNode:Gb,FunctionAssignmentNode:Jb,FunctionNode:nx,IndexNode:ex,ObjectNode:jb,OperatorNode:Ub,ParenthesisNode:qb,RangeNode:Kb,RelationalNode:Wb,SymbolNode:tx,config:ve,numeric:Xd,typed:bh}),ix=Hy({parse:rx,typed:bh}),ax=Ky({parse:rx,typed:bh}),ox=Xy({parse:rx}),sx=Yy({evaluate:ax}),ux=Zy({Parser:sx,typed:bh}),cx=rb({bignumber:Oh,fraction:Wd,AccessorNode:Zb,ArrayNode:Vb,ConstantNode:Gb,FunctionNode:nx,IndexNode:ex,ObjectNode:jb,OperatorNode:Ub,ParenthesisNode:qb,SymbolNode:tx,add:Vm,config:ve,divide:Kv,equal:xm,isZero:nd,mathWithTransform:Bb,matrix:$d,multiply:og,parse:rx,pow:sg,subtract:rm,typed:bh}),lx=ib({ConstantNode:Gb,FunctionNode:nx,OperatorNode:Ub,ParenthesisNode:qb,SymbolNode:tx,config:ve,equal:xm,isZero:nd,numeric:Xd,parse:rx,simplify:cx,typed:bh}),fx=cb({Help:ox,mathWithTransform:Bb,typed:bh}),px=fb({bignumber:Oh,fraction:Wd,AccessorNode:Zb,ArrayNode:Vb,ConstantNode:Gb,FunctionNode:nx,IndexNode:ex,ObjectNode:jb,OperatorNode:Ub,ParenthesisNode:qb,SymbolNode:tx,add:Vm,config:ve,divide:Kv,equal:xm,isZero:nd,mathWithTransform:Bb,matrix:$d,multiply:og,parse:rx,pow:sg,simplify:cx,subtract:rm,typed:bh});g(Rb,{e:Kp,false:Xp,fineStructure:Yp,i:Zp,Infinity:Qp,LN10:eh,LOG10E:th,NaN:rh,null:ih,phi:ah,SQRT1_2:uh,sackurTetrode:ch,tau:lh,true:fh,E:Kp,version:ph,efimovFactor:dh,LN2:mh,pi:gh,replacer:vh,reviver:Xb,SQRT2:yh,typed:bh,unaryPlus:xh,PI:gh,weakMixingAngle:wh,abs:Eh,acos:Ch,acot:Sh,acsc:Nh,addScalar:Ah,arg:kh,asech:Dh,asinh:_h,atan:Mh,atanh:Th,bignumber:Oh,bitNot:Ih,boolean:Fh,chain:Yb,clone:Rh,combinations:Bh,complex:zh,conj:Ph,cosh:Lh,coth:jh,csc:Uh,cube:qh,equalScalar:Wh,erf:Vh,exp:$h,expm1:Hh,filter:Gh,forEach:Kh,format:Xh,getMatrixDataType:Yh,hex:Jh,im:Zh,isInteger:Qh,isNegative:ed,isPositive:td,isZero:nd,LOG2E:rd,log10:id,log2:ad,map:od,multiplyScalar:sd,not:ud,number:cd,oct:ld,pickRandom:fd,print:pd,random:hd,re:dd,sec:md,sign:gd,sin:vd,splitUnit:bd,square:xd,string:wd,tan:Ed,typeOf:Cd,acosh:Sd,acsch:Nd,apply:Ad,asec:kd,bin:Dd,combinationsWithRep:_d,cos:Md,csch:Td,isNaN:Od,isPrime:Id,randomInt:Fd,sech:Rd,sinh:Bd,sparse:zd,sqrt:Pd,tanh:Ld,unaryMinus:jd,acoth:Ud,cot:qd,fraction:Wd,isNumeric:Vd,matrix:$d,matrixFromFunction:Hd,mod:Gd,nthRoot:Kd,numeric:Xd,or:Yd,prod:Jd,reshape:Zd,size:Qd,smaller:em,squeeze:tm,subset:nm,subtract:rm,to:im,transpose:am,xgcd:om,zeros:sm,and:um,bitAnd:cm,bitXor:lm,cbrt:fm,compare:pm,compareText:hm,concat:dm,count:mm,ctranspose:gm,diag:vm,divideScalar:ym,dotDivide:bm,equal:xm,flatten:wm,gcd:Em,hasNumericValue:Cm,hypot:Sm,kron:km,largerEq:Dm,leftShift:_m,lsolve:Mm,matrixFromColumns:Tm,min:Om,mode:Im,nthRoots:Fm,ones:Rm,partitionSelect:Bm,resize:zm,rightLogShift:Pm,round:Lm,smallerEq:jm,unequal:Um,usolve:qm,xor:Wm,add:Vm,atan2:$m,bitOr:Hm,catalan:Gm,compareNatural:Km,deepEqual:Xm,diff:Ym,dot:Jm,equalText:Zm,floor:Qm,identity:eg,invmod:tg,larger:ng,log:rg,lsolveAll:ig,matrixFromRows:ag,multiply:og,pow:sg,qr:ug,range:cg,rightArithShift:lg,row:fg,setCartesian:pg,setDistinct:hg,setIsSubset:dg,setPowerset:mg,slu:gg,sum:vg,trace:yg,usolveAll:bg,asin:xg,ceil:wg,column:Eg,composition:Cg,cross:Sg,distance:Ng,dotMultiply:Ag,fix:Dg,gamma:_g,index:Mg,lcm:Tg,max:Og,quantileSeq:Ig,setDifference:Fg,setMultiplicity:Rg,setSymDifference:Bg,sort:zg,vacuumImpedance:Lg,wienDisplacement:jg,atomicMass:Ug,bohrMagneton:qg,boltzmann:Wg,conductanceQuantum:Vg,createUnit:$g,deuteronMass:Hg,dotPow:Gg,electricConstant:Kg,elementaryCharge:Xg,factorial:Yg,fermiCoupling:Jg,gasConstant:Zg,gravity:Qg,intersect:ev,inverseConductanceQuantum:tv,klitzing:nv,loschmidt:rv,magneticConstant:iv,molarMass:av,molarPlanckConstant:ov,neutronMass:sv,nuclearMagneton:uv,permutations:cv,planckConstant:lv,planckMass:fv,planckTime:pv,quantumOfCirculation:hv,reducedPlanckConstant:dv,rydberg:mv,setIntersect:gv,setUnion:vv,stefanBoltzmann:bv,unit:xv,avogadro:wv,bohrRadius:Ev,coulomb:Cv,electronMass:Sv,faraday:Nv,hartreeEnergy:Av,log1p:kv,magneticFluxQuantum:Dv,molarMassC12:_v,parse:rx,planckCharge:Mv,planckTemperature:Tv,secondRadiation:Ov,speedOfLight:Iv,stirlingS2:Fv,bellNumbers:Rv,compile:ix,evaluate:ax,firstRadiation:Bv,lup:zv,molarVolume:Pv,protonMass:Lv,setSize:jv,thomsonCrossSection:Uv,classicalElectronRadius:qv,det:Wv,gravitationConstant:Vv,inv:$v,lusolve:Hv,parser:ux,sqrtm:Gv,divide:Kv,expm:Xv,kldivergence:Yv,mean:Jv,median:Zv,planckLength:Qv,simplify:cx,variance:ey,derivative:lx,help:fx,rationalize:px,std:ty,eigs:ny,multinomial:ry,mad:iy,norm:ay,rotationMatrix:oy,rotate:sy,config:ve}),g(Bb,Rb,{filter:hb({typed:bh}),forEach:mb({typed:bh}),map:gb({typed:bh}),apply:yb({isInteger:Qh,typed:bh}),diff:wb({bignumber:Oh,matrix:$d,number:cd,subtract:rm,typed:bh}),index:Eb({Index:Am}),subset:Cb({matrix:$d,typed:bh}),concat:Sb({isInteger:Qh,matrix:$d,typed:bh}),max:Nb({config:ve,larger:ng,numeric:Xd,typed:bh}),min:Ab({config:ve,numeric:Xd,smaller:em,typed:bh}),range:kb({bignumber:Oh,matrix:$d,config:ve,larger:ng,largerEq:Dm,smaller:em,smallerEq:jm,typed:bh}),row:Db({Index:Am,matrix:$d,range:cg,typed:bh}),sum:_b({add:Vm,config:ve,numeric:Xd,typed:bh}),column:Mb({Index:Am,matrix:$d,range:cg,typed:bh}),mean:Tb({add:Vm,divide:Kv,typed:bh}),variance:Ib({add:Vm,apply:Ad,divide:Kv,isNaN:Od,multiply:og,subtract:rm,typed:bh}),std:Fb({sqrt:Pd,typed:bh,variance:ey})}),g(zb,{BigNumber:Hp,Chain:Pb,Complex:Gp,Fraction:Jp,Matrix:nh,Node:Lb,ObjectNode:jb,OperatorNode:Ub,ParenthesisNode:qb,Range:oh,RelationalNode:Wb,ResultSet:sh,ArrayNode:Vb,BlockNode:$b,ConditionalNode:Hb,ConstantNode:Gb,DenseMatrix:hh,RangeNode:Kb,FunctionAssignmentNode:Jb,SparseMatrix:yd,AccessorNode:Zb,AssignmentNode:Qb,ImmutableDenseMatrix:Nm,Index:Am,IndexNode:ex,FibonacciHeap:kg,Unit:Pg,Spa:yv,SymbolNode:tx,FunctionNode:nx,Help:ox,Parser:sx}),Pb.createProxy(Rb);var hx={createBigNumberClass:Ee},dx={createComplexClass:He},mx={createMatrixClass:Nn},gx={MatrixDependencies:mx,createDenseMatrixClass:sr},vx={createFractionClass:Sn},yx={BigNumberDependencies:hx,ComplexDependencies:dx,DenseMatrixDependencies:gx,FractionDependencies:vx,createTyped:Cr},bx={typedDependencies:yx,createAbs:ai},xx={createNode:ly},wx={typedDependencies:yx,createEqualScalar:Sa},Ex={MatrixDependencies:mx,equalScalarDependencies:wx,typedDependencies:yx,createSparseMatrixClass:Bo},Cx={DenseMatrixDependencies:gx,MatrixDependencies:mx,SparseMatrixDependencies:Ex,typedDependencies:yx,createMatrix:Ts},Sx={matrixDependencies:Cx,typedDependencies:yx,createSubset:lu},Nx={NodeDependencies:xx,subsetDependencies:Sx,createAccessorNode:zy},Ax={ComplexDependencies:dx,typedDependencies:yx,createAcos:si},kx={ComplexDependencies:dx,typedDependencies:yx,createAcosh:Go},Dx={BigNumberDependencies:hx,typedDependencies:yx,createAcot:Ai},_x={BigNumberDependencies:hx,ComplexDependencies:dx,typedDependencies:yx,createAcoth:Ns},Mx={BigNumberDependencies:hx,ComplexDependencies:dx,typedDependencies:yx,createAcsc:Di},Tx={BigNumberDependencies:hx,typedDependencies:yx,createAcsch:Xo},Ox={typedDependencies:yx,createAddScalar:Mi},Ix={DenseMatrixDependencies:gx,SparseMatrixDependencies:Ex,addScalarDependencies:Ox,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createAdd:$c},Fx={typedDependencies:yx,createNot:vo},Rx={BigNumberDependencies:hx,matrixDependencies:Cx,typedDependencies:yx,createZeros:Su},Bx={equalScalarDependencies:wx,matrixDependencies:Cx,notDependencies:Fx,typedDependencies:yx,zerosDependencies:Rx,createAnd:Nu},zx={typedDependencies:yx,createIsInteger:Ha},Px={isIntegerDependencies:zx,typedDependencies:yx,createApply:Jo},Lx={isIntegerDependencies:zx,typedDependencies:yx,createApplyTransform:yb},jx={typedDependencies:yx,createArg:Ti},Ux={NodeDependencies:xx,createArrayNode:Ay},qx={BigNumberDependencies:hx,ComplexDependencies:dx,typedDependencies:yx,createAsec:es},Wx={BigNumberDependencies:hx,ComplexDependencies:dx,typedDependencies:yx,createAsech:Ii},Vx={ComplexDependencies:dx,typedDependencies:yx,createAsin:nf},$x={typedDependencies:yx,createAsinh:Fi},Hx={matrixDependencies:Cx,NodeDependencies:xx,subsetDependencies:Sx,createAssignmentNode:Py},Gx={typedDependencies:yx,createAtan:Ri},Kx={BigNumberDependencies:hx,DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createAtan2:Kc},Xx={ComplexDependencies:dx,typedDependencies:yx,createAtanh:zi},Yx={BigNumberDependencies:hx,typedDependencies:yx,createBignumber:Pi},Jx={FractionDependencies:vx,typedDependencies:yx,createFraction:ks},Zx={typedDependencies:yx,createNumber:yo},Qx={bignumberDependencies:Yx,fractionDependencies:Jx,numberDependencies:Zx,createNumeric:Xs},ew={numericDependencies:Qx,typedDependencies:yx,createDivideScalar:Hu},tw={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createEqual:Yu},nw={BigNumberDependencies:hx,DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,zerosDependencies:Rx,createRound:Bc},rw={equalScalarDependencies:wx,matrixDependencies:Cx,roundDependencies:nw,typedDependencies:yx,createCeil:rf},iw={equalScalarDependencies:wx,matrixDependencies:Cx,roundDependencies:nw,typedDependencies:yx,createFloor:cl},aw={ComplexDependencies:dx,ceilDependencies:rw,floorDependencies:iw,matrixDependencies:Cx,typedDependencies:yx,createFix:gf},ow={typedDependencies:yx,createFormat:ja},sw={typedDependencies:yx,createIsNumeric:_s},uw={typedDependencies:yx,createMultiplyScalar:lo},cw={BigNumberDependencies:hx,DenseMatrixDependencies:gx,SparseMatrixDependencies:Ex,matrixDependencies:Cx,typedDependencies:yx,createIdentity:fl},lw={typedDependencies:yx,createConj:da},fw={matrixDependencies:Cx,typedDependencies:yx,createSize:ru},pw={addScalarDependencies:Ox,conjDependencies:lw,multiplyScalarDependencies:uw,sizeDependencies:fw,typedDependencies:yx,createDot:ol},hw={addScalarDependencies:Ox,dotDependencies:pw,equalScalarDependencies:wx,matrixDependencies:Cx,multiplyScalarDependencies:uw,typedDependencies:yx,createMultiply:El},dw={ComplexDependencies:dx,fractionDependencies:Jx,identityDependencies:cw,matrixDependencies:Cx,multiplyDependencies:hw,numberDependencies:Zx,typedDependencies:yx,createPow:Cl},mw={typedDependencies:yx,createUnaryMinus:Cs},gw={DenseMatrixDependencies:gx,addScalarDependencies:Ox,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,unaryMinusDependencies:mw,createSubtract:vu},vw={BigNumberDependencies:hx,ComplexDependencies:dx,FractionDependencies:vx,absDependencies:bx,addScalarDependencies:Ox,divideScalarDependencies:ew,equalDependencies:tw,fixDependencies:aw,formatDependencies:ow,isNumericDependencies:sw,multiplyScalarDependencies:uw,numberDependencies:Zx,powDependencies:dw,roundDependencies:nw,subtractDependencies:gw,createUnitClass:zf},yw={BigNumberDependencies:hx,UnitDependencies:vw,createAtomicMass:Qt},bw={BigNumberDependencies:hx,UnitDependencies:vw,createAvogadro:en},xw={typedDependencies:yx,createIsNegative:Qa},ww={typedDependencies:yx,createCombinations:la},Ew={BigNumberDependencies:hx,ComplexDependencies:dx,multiplyScalarDependencies:uw,powDependencies:dw,typedDependencies:yx,createGamma:wf},Cw={gammaDependencies:Ew,typedDependencies:yx,createFactorial:Wf},Sw={DenseMatrixDependencies:gx,matrixDependencies:Cx,typedDependencies:yx,createLarger:ml},Nw={addScalarDependencies:Ox,combinationsDependencies:ww,divideScalarDependencies:ew,factorialDependencies:Cw,isIntegerDependencies:zx,isNegativeDependencies:xw,largerDependencies:Sw,multiplyScalarDependencies:uw,powDependencies:dw,subtractDependencies:gw,typedDependencies:yx,createStirlingS2:ip},Aw={addScalarDependencies:Ox,isIntegerDependencies:zx,isNegativeDependencies:xw,stirlingS2Dependencies:Nw,typedDependencies:yx,createBellNumbers:op},kw={formatDependencies:ow,typedDependencies:yx,createBin:ts},Dw={equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createBitAnd:ku},_w={typedDependencies:yx,createBitNot:na},Mw={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createBitOr:Yc},Tw={DenseMatrixDependencies:gx,matrixDependencies:Cx,typedDependencies:yx,createBitXor:_u},Ow={createResultSet:kn},Iw={NodeDependencies:xx,ResultSetDependencies:Ow,createBlockNode:ky},Fw={BigNumberDependencies:hx,UnitDependencies:vw,createBohrMagneton:It},Rw={BigNumberDependencies:hx,UnitDependencies:vw,createBohrRadius:Lt},Bw={BigNumberDependencies:hx,UnitDependencies:vw,createBoltzmann:tn},zw={typedDependencies:yx,createBoolean:ia},Pw={addScalarDependencies:Ox,combinationsDependencies:ww,divideScalarDependencies:ew,isIntegerDependencies:zx,isNegativeDependencies:xw,multiplyScalarDependencies:uw,typedDependencies:yx,createCatalan:Zc},Lw={BigNumberDependencies:hx,ComplexDependencies:dx,FractionDependencies:vx,isNegativeDependencies:xw,matrixDependencies:Cx,typedDependencies:yx,unaryMinusDependencies:mw,createCbrt:Tu},jw={createChainClass:uy},Uw={ChainDependencies:jw,typedDependencies:yx,createChain:Iy},qw={BigNumberDependencies:hx,UnitDependencies:vw,createClassicalElectronRadius:jt},Ww={typedDependencies:yx,createClone:oa},Vw={DenseMatrixDependencies:gx,matrixDependencies:Cx,typedDependencies:yx,createSmaller:ou},$w={DenseMatrixDependencies:gx,smallerDependencies:Vw,createImmutableDenseMatrixClass:ac},Hw={ImmutableDenseMatrixDependencies:$w,createIndexClass:oc},Gw={DenseMatrixDependencies:gx,matrixDependencies:Cx,typedDependencies:yx,createLargerEq:lc},Kw={DenseMatrixDependencies:gx,matrixDependencies:Cx,typedDependencies:yx,createSmallerEq:Lc},Xw={bignumberDependencies:Yx,matrixDependencies:Cx,largerDependencies:Sw,largerEqDependencies:Gw,smallerDependencies:Vw,smallerEqDependencies:Kw,typedDependencies:yx,createRange:Al},Yw={IndexDependencies:Hw,matrixDependencies:Cx,rangeDependencies:Xw,typedDependencies:yx,createColumn:of},Jw={IndexDependencies:Hw,matrixDependencies:Cx,rangeDependencies:Xw,typedDependencies:yx,createColumnTransform:Mb},Zw={typedDependencies:yx,createCombinationsWithRep:rs},Qw={BigNumberDependencies:hx,DenseMatrixDependencies:gx,FractionDependencies:vx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createCompare:Iu},eE={compareDependencies:Qw,typedDependencies:yx,createCompareNatural:tl},tE={matrixDependencies:Cx,typedDependencies:yx,createCompareText:Ru},nE={NodeDependencies:xx,createConditionalNode:Dy},rE={NodeDependencies:xx,createConstantNode:_y},iE={NodeDependencies:xx,typedDependencies:yx,createFunctionAssignmentNode:Fy},aE={UnitDependencies:vw,NodeDependencies:xx,createSymbolNode:jy},oE={NodeDependencies:xx,SymbolNodeDependencies:aE,createFunctionNode:qy},sE={createRangeClass:An},uE={NodeDependencies:xx,RangeDependencies:sE,sizeDependencies:fw,createIndexNode:Ly},cE={NodeDependencies:xx,createObjectNode:fy},lE={NodeDependencies:xx,createOperatorNode:Cy},fE={NodeDependencies:xx,createParenthesisNode:Sy},pE={NodeDependencies:xx,createRangeNode:My},hE={NodeDependencies:xx,createRelationalNode:Ny},dE={AccessorNodeDependencies:Nx,ArrayNodeDependencies:Ux,AssignmentNodeDependencies:Hx,BlockNodeDependencies:Iw,ConditionalNodeDependencies:nE,ConstantNodeDependencies:rE,FunctionAssignmentNodeDependencies:iE,FunctionNodeDependencies:oE,IndexNodeDependencies:uE,ObjectNodeDependencies:cE,OperatorNodeDependencies:lE,ParenthesisNodeDependencies:fE,RangeNodeDependencies:pE,RelationalNodeDependencies:hE,SymbolNodeDependencies:aE,numericDependencies:Qx,typedDependencies:yx,createParse:Vy},mE={parseDependencies:dE,typedDependencies:yx,createCompile:Hy},gE={ComplexDependencies:dx,typedDependencies:yx,createComplex:pa},vE={typedDependencies:yx,createIsPositive:to},yE={addScalarDependencies:Ox,combinationsDependencies:ww,isIntegerDependencies:zx,isNegativeDependencies:xw,isPositiveDependencies:vE,largerDependencies:Sw,typedDependencies:yx,createComposition:uf},bE={isIntegerDependencies:zx,matrixDependencies:Cx,typedDependencies:yx,createConcat:zu},xE={isIntegerDependencies:zx,matrixDependencies:Cx,typedDependencies:yx,createConcatTransform:Sb},wE={BigNumberDependencies:hx,UnitDependencies:vw,createConductanceQuantum:Ft},EE={typedDependencies:yx,createCos:as},CE={typedDependencies:yx,createCosh:ga},SE={BigNumberDependencies:hx,typedDependencies:yx,createCot:As},NE={BigNumberDependencies:hx,typedDependencies:yx,createCoth:ya},AE={BigNumberDependencies:hx,UnitDependencies:vw,createCoulomb:Tt},kE={multiplyScalarDependencies:uw,numericDependencies:Qx,typedDependencies:yx,createProd:Qs},DE={prodDependencies:kE,sizeDependencies:fw,typedDependencies:yx,createCount:ju},_E={UnitDependencies:vw,typedDependencies:yx,createCreateUnit:Lf},ME={matrixDependencies:Cx,multiplyDependencies:hw,subtractDependencies:gw,typedDependencies:yx,createCross:lf},TE={BigNumberDependencies:hx,typedDependencies:yx,createCsc:ba},OE={BigNumberDependencies:hx,typedDependencies:yx,createCsch:ss},IE={matrixDependencies:Cx,typedDependencies:yx,createTranspose:xu},FE={conjDependencies:lw,transposeDependencies:IE,typedDependencies:yx,createCtranspose:qu},RE={typedDependencies:yx,createCube:wa},BE={equalDependencies:tw,typedDependencies:yx,createDeepEqual:rl},zE={typedDependencies:yx,createIsZero:ro},PE={largerDependencies:Sw,smallerDependencies:Vw,createFibonacciHeapClass:mf},LE={FibonacciHeapDependencies:PE,addScalarDependencies:Ox,equalScalarDependencies:wx,createSpaClass:Zf},jE={DenseMatrixDependencies:gx,SpaDependencies:LE,SparseMatrixDependencies:Ex,absDependencies:bx,addScalarDependencies:Ox,divideScalarDependencies:ew,equalScalarDependencies:wx,largerDependencies:Sw,matrixDependencies:Cx,multiplyScalarDependencies:uw,subtractDependencies:gw,typedDependencies:yx,unaryMinusDependencies:mw,createLup:sp},UE={lupDependencies:jE,matrixDependencies:Cx,multiplyDependencies:hw,subtractDependencies:gw,typedDependencies:yx,unaryMinusDependencies:mw,createDet:lp},qE={absDependencies:bx,addScalarDependencies:Ox,detDependencies:UE,divideScalarDependencies:ew,identityDependencies:cw,matrixDependencies:Cx,multiplyDependencies:hw,typedDependencies:yx,unaryMinusDependencies:mw,createInv:fp},WE={divideScalarDependencies:ew,equalScalarDependencies:wx,invDependencies:qE,matrixDependencies:Cx,multiplyDependencies:hw,typedDependencies:yx,createDivide:vp},VE={bignumberDependencies:Yx,fractionDependencies:Jx,AccessorNodeDependencies:Nx,ArrayNodeDependencies:Ux,ConstantNodeDependencies:rE,FunctionNodeDependencies:oE,IndexNodeDependencies:uE,ObjectNodeDependencies:cE,OperatorNodeDependencies:lE,ParenthesisNodeDependencies:fE,SymbolNodeDependencies:aE,addDependencies:Ix,divideDependencies:WE,equalDependencies:tw,isZeroDependencies:zE,matrixDependencies:Cx,multiplyDependencies:hw,parseDependencies:dE,powDependencies:dw,subtractDependencies:gw,typedDependencies:yx,createSimplify:rb},$E={ConstantNodeDependencies:rE,FunctionNodeDependencies:oE,OperatorNodeDependencies:lE,ParenthesisNodeDependencies:fE,SymbolNodeDependencies:aE,equalDependencies:tw,isZeroDependencies:zE,numericDependencies:Qx,parseDependencies:dE,simplifyDependencies:VE,typedDependencies:yx,createDerivative:ib},HE={BigNumberDependencies:hx,UnitDependencies:vw,createDeuteronMass:Ht},GE={DenseMatrixDependencies:gx,SparseMatrixDependencies:Ex,matrixDependencies:Cx,typedDependencies:yx,createDiag:Vu},KE={matrixDependencies:Cx,numberDependencies:Zx,subtractDependencies:gw,typedDependencies:yx,createDiff:al},XE={bignumberDependencies:Yx,matrixDependencies:Cx,numberDependencies:Zx,subtractDependencies:gw,typedDependencies:yx,createDiffTransform:wb},YE={ComplexDependencies:dx,typedDependencies:yx,createSqrt:xs},JE={absDependencies:bx,addScalarDependencies:Ox,divideScalarDependencies:ew,multiplyScalarDependencies:uw,sqrtDependencies:YE,subtractDependencies:gw,typedDependencies:yx,unaryMinusDependencies:mw,createDistance:pf},ZE={DenseMatrixDependencies:gx,divideScalarDependencies:ew,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createDotDivide:Ku},QE={equalScalarDependencies:wx,matrixDependencies:Cx,multiplyScalarDependencies:uw,typedDependencies:yx,createDotMultiply:df},eC={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,powDependencies:dw,typedDependencies:yx,createDotPow:Uf},tC={BigNumberDependencies:hx,createE:ft},nC={BigNumberDependencies:hx,createEfimovFactor:Zt},rC={matrixDependencies:Cx,typedDependencies:yx,createFlatten:Zu},iC={typedDependencies:yx,createIm:Va},aC={flattenDependencies:rC,matrixDependencies:Cx,sizeDependencies:fw,typedDependencies:yx,createMatrixFromColumns:yc},oC={BigNumberDependencies:hx,FractionDependencies:vx,complexDependencies:gE,typedDependencies:yx,createSign:Fo},sC={addScalarDependencies:Ox,complexDependencies:gE,conjDependencies:lw,divideScalarDependencies:ew,equalDependencies:tw,identityDependencies:cw,isZeroDependencies:zE,matrixDependencies:Cx,multiplyScalarDependencies:uw,signDependencies:oC,sqrtDependencies:YE,subtractDependencies:gw,typedDependencies:yx,unaryMinusDependencies:mw,zerosDependencies:Rx,createQr:Sl},uC={typedDependencies:yx,createRe:To},cC={typedDependencies:yx,createSin:Ro},lC={DenseMatrixDependencies:gx,divideScalarDependencies:ew,equalScalarDependencies:wx,matrixDependencies:Cx,multiplyScalarDependencies:uw,subtractDependencies:gw,typedDependencies:yx,createUsolve:Wc},fC={DenseMatrixDependencies:gx,divideScalarDependencies:ew,equalScalarDependencies:wx,matrixDependencies:Cx,multiplyScalarDependencies:uw,subtractDependencies:gw,typedDependencies:yx,createUsolveAll:ef},pC={absDependencies:bx,addDependencies:Ix,addScalarDependencies:Ox,atanDependencies:Gx,bignumberDependencies:Yx,columnDependencies:Yw,complexDependencies:gE,cosDependencies:EE,diagDependencies:GE,divideScalarDependencies:ew,dotDependencies:pw,equalDependencies:tw,flattenDependencies:rC,imDependencies:iC,invDependencies:qE,largerDependencies:Sw,matrixDependencies:Cx,matrixFromColumnsDependencies:aC,multiplyDependencies:hw,multiplyScalarDependencies:uw,numberDependencies:Zx,qrDependencies:sC,reDependencies:uC,sinDependencies:cC,smallerDependencies:Vw,sqrtDependencies:YE,subtractDependencies:gw,typedDependencies:yx,usolveDependencies:lC,usolveAllDependencies:fC,createEigs:Tp},hC={BigNumberDependencies:hx,UnitDependencies:vw,createElectricConstant:_t},dC={BigNumberDependencies:hx,UnitDependencies:vw,createElectronMass:Ut},mC={BigNumberDependencies:hx,UnitDependencies:vw,createElementaryCharge:Ot},gC={compareTextDependencies:tE,isZeroDependencies:zE,typedDependencies:yx,createEqualText:ul},vC={typedDependencies:yx,createErf:Na},yC={parseDependencies:dE,typedDependencies:yx,createEvaluate:Ky},bC={typedDependencies:yx,createExp:Ta},xC={absDependencies:bx,addDependencies:Ix,identityDependencies:cw,invDependencies:qE,multiplyDependencies:hw,typedDependencies:yx,createExpm:bp},wC={ComplexDependencies:dx,typedDependencies:yx,createExpm1:Ia},EC={createFalse:at},CC={BigNumberDependencies:hx,UnitDependencies:vw,createFaraday:nn},SC={BigNumberDependencies:hx,UnitDependencies:vw,createFermiCoupling:qt},NC={typedDependencies:yx,createFilter:Fa},AC={typedDependencies:yx,createFilterTransform:hb},kC={BigNumberDependencies:hx,createFineStructure:Wt},DC={BigNumberDependencies:hx,UnitDependencies:vw,createFirstRadiation:rn},_C={typedDependencies:yx,createForEach:za},MC={typedDependencies:yx,createForEachTransform:mb},TC={BigNumberDependencies:hx,UnitDependencies:vw,createGasConstant:on},OC={BigNumberDependencies:hx,DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createGcd:ec},IC={typedDependencies:yx,createGetMatrixDataType:qa},FC={BigNumberDependencies:hx,UnitDependencies:vw,createGravitationConstant:Nt},RC={BigNumberDependencies:hx,UnitDependencies:vw,createGravity:mn},BC={BigNumberDependencies:hx,UnitDependencies:vw,createHartreeEnergy:Vt},zC={isNumericDependencies:sw,typedDependencies:yx,createHasNumericValue:nc},PC={parseDependencies:dE,createHelpClass:Xy},LC={HelpDependencies:PC,typedDependencies:yx,createHelp:cb},jC={formatDependencies:ow,typedDependencies:yx,createHex:Wa},UC={absDependencies:bx,addScalarDependencies:Ox,divideScalarDependencies:ew,isPositiveDependencies:vE,multiplyScalarDependencies:uw,smallerDependencies:Vw,sqrtDependencies:YE,typedDependencies:yx,createHypot:ic},qC={ComplexDependencies:dx,createI:bt},WC={IndexDependencies:Hw,typedDependencies:yx,createIndex:Cf},VC={IndexDependencies:Hw,createIndexTransform:Eb},$C={BigNumberDependencies:hx,createInfinity:st},HC={absDependencies:bx,addDependencies:Ix,addScalarDependencies:Ox,divideScalarDependencies:ew,equalScalarDependencies:wx,flattenDependencies:rC,isNumericDependencies:sw,isZeroDependencies:zE,matrixDependencies:Cx,multiplyDependencies:hw,multiplyScalarDependencies:uw,smallerDependencies:Vw,subtractDependencies:gw,typedDependencies:yx,createIntersect:Vf},GC={BigNumberDependencies:hx,UnitDependencies:vw,createInverseConductanceQuantum:Rt},KC={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createMod:Us},XC={BigNumberDependencies:hx,matrixDependencies:Cx,typedDependencies:yx,createXgcd:Eu},YC={BigNumberDependencies:hx,addDependencies:Ix,equalDependencies:tw,isIntegerDependencies:zx,modDependencies:KC,smallerDependencies:Vw,typedDependencies:yx,xgcdDependencies:XC,createInvmod:hl},JC={typedDependencies:yx,createIsNaN:cs},ZC={typedDependencies:yx,createIsPrime:fs},QC={ComplexDependencies:dx,divideScalarDependencies:ew,typedDependencies:yx,createLog:gl},eS={addDependencies:Ix,numericDependencies:Qx,typedDependencies:yx,createSum:Jl},tS={divideDependencies:WE,dotDivideDependencies:ZE,isNumericDependencies:sw,logDependencies:QC,matrixDependencies:Cx,multiplyDependencies:hw,sumDependencies:eS,typedDependencies:yx,createKldivergence:wp},nS={BigNumberDependencies:hx,UnitDependencies:vw,createKlitzing:Pt},rS={matrixDependencies:Cx,multiplyScalarDependencies:uw,typedDependencies:yx,createKron:uc},iS={BigNumberDependencies:hx,createLN10:dt},aS={BigNumberDependencies:hx,createLN2:ht},oS={BigNumberDependencies:hx,createLOG10E:gt},sS={BigNumberDependencies:hx,createLOG2E:mt},uS={equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createLcm:Sf},cS={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,zerosDependencies:Rx,createLeftShift:hc},lS={ComplexDependencies:dx,typedDependencies:yx,createLog10:ao},fS={ComplexDependencies:dx,divideScalarDependencies:ew,logDependencies:QC,typedDependencies:yx,createLog1p:np},pS={ComplexDependencies:dx,typedDependencies:yx,createLog2:so},hS={BigNumberDependencies:hx,UnitDependencies:vw,createLoschmidt:an},dS={DenseMatrixDependencies:gx,divideScalarDependencies:ew,equalScalarDependencies:wx,matrixDependencies:Cx,multiplyScalarDependencies:uw,subtractDependencies:gw,typedDependencies:yx,createLsolve:gc},mS={DenseMatrixDependencies:gx,divideScalarDependencies:ew,equalScalarDependencies:wx,matrixDependencies:Cx,multiplyScalarDependencies:uw,subtractDependencies:gw,typedDependencies:yx,createLsolveAll:yl},gS={SparseMatrixDependencies:Ex,absDependencies:bx,addDependencies:Ix,divideScalarDependencies:ew,largerDependencies:Sw,largerEqDependencies:Gw,multiplyDependencies:hw,subtractDependencies:gw,transposeDependencies:IE,typedDependencies:yx,createSlu:Yl},vS={DenseMatrixDependencies:gx,lsolveDependencies:dS,lupDependencies:jE,matrixDependencies:Cx,sluDependencies:gS,typedDependencies:yx,usolveDependencies:lC,createLusolve:dp},yS={typedDependencies:yx,createMap:uo},bS={compareDependencies:Qw,isNaNDependencies:JC,isNumericDependencies:sw,typedDependencies:yx,createPartitionSelect:Ac},xS={addDependencies:Ix,compareDependencies:Qw,divideDependencies:WE,partitionSelectDependencies:bS,typedDependencies:yx,createMedian:Np},wS={absDependencies:bx,mapDependencies:yS,medianDependencies:xS,subtractDependencies:gw,typedDependencies:yx,createMad:Bp},ES={BigNumberDependencies:hx,UnitDependencies:vw,createMagneticConstant:Dt},CS={BigNumberDependencies:hx,UnitDependencies:vw,createMagneticFluxQuantum:Bt},SS={typedDependencies:yx,createMapTransform:gb},NS={isZeroDependencies:zE,matrixDependencies:Cx,typedDependencies:yx,createMatrixFromFunction:Is},AS={flattenDependencies:rC,matrixDependencies:Cx,sizeDependencies:fw,typedDependencies:yx,createMatrixFromRows:xl},kS={largerDependencies:Sw,numericDependencies:Qx,typedDependencies:yx,createMax:Nf},DS={largerDependencies:Sw,numericDependencies:Qx,typedDependencies:yx,createMaxTransform:Nb},_S={addDependencies:Ix,divideDependencies:WE,typedDependencies:yx,createMean:Cp},MS={addDependencies:Ix,divideDependencies:WE,typedDependencies:yx,createMeanTransform:Tb},TS={numericDependencies:Qx,smallerDependencies:Vw,typedDependencies:yx,createMin:bc},OS={numericDependencies:Qx,smallerDependencies:Vw,typedDependencies:yx,createMinTransform:Ab},IS={isNaNDependencies:JC,isNumericDependencies:sw,typedDependencies:yx,createMode:wc},FS={BigNumberDependencies:hx,UnitDependencies:vw,createMolarMass:hn},RS={BigNumberDependencies:hx,UnitDependencies:vw,createMolarMassC12:dn},BS={BigNumberDependencies:hx,UnitDependencies:vw,createMolarPlanckConstant:sn},zS={BigNumberDependencies:hx,UnitDependencies:vw,createMolarVolume:un},PS={addDependencies:Ix,divideDependencies:WE,factorialDependencies:Cw,isIntegerDependencies:zx,isPositiveDependencies:vE,multiplyDependencies:hw,typedDependencies:yx,createMultinomial:Fp},LS={BigNumberDependencies:hx,createNaN:ut},jS={BigNumberDependencies:hx,UnitDependencies:vw,createNeutronMass:Gt},US={absDependencies:bx,addDependencies:Ix,conjDependencies:lw,ctransposeDependencies:FE,eigsDependencies:pC,equalScalarDependencies:wx,largerDependencies:Sw,matrixDependencies:Cx,multiplyDependencies:hw,powDependencies:dw,smallerDependencies:Vw,sqrtDependencies:YE,typedDependencies:yx,createNorm:Lp},qS={BigNumberDependencies:hx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createNthRoot:$s},WS={ComplexDependencies:dx,divideScalarDependencies:ew,typedDependencies:yx,createNthRoots:Cc},VS={BigNumberDependencies:hx,UnitDependencies:vw,createNuclearMagneton:zt},$S={createNull:ot},HS={formatDependencies:ow,typedDependencies:yx,createOct:bo},GS={BigNumberDependencies:hx,matrixDependencies:Cx,typedDependencies:yx,createOnes:Sc},KS={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createOr:Ys},XS={evaluateDependencies:yC,createParserClass:Yy},YS={ParserDependencies:XS,typedDependencies:yx,createParser:Zy},JS={factorialDependencies:Cw,typedDependencies:yx,createPermutations:Hf},ZS={BigNumberDependencies:hx,createPhi:pt},QS={BigNumberDependencies:hx,createPi:ct},eN={typedDependencies:yx,createPickRandom:So},tN={BigNumberDependencies:hx,UnitDependencies:vw,createPlanckCharge:bn},nN={BigNumberDependencies:hx,UnitDependencies:vw,createPlanckConstant:At},rN={BigNumberDependencies:hx,UnitDependencies:vw,createPlanckLength:gn},iN={BigNumberDependencies:hx,UnitDependencies:vw,createPlanckMass:vn},aN={BigNumberDependencies:hx,UnitDependencies:vw,createPlanckTemperature:xn},oN={BigNumberDependencies:hx,UnitDependencies:vw,createPlanckTime:yn},sN={typedDependencies:yx,createPrint:Ao},uN={BigNumberDependencies:hx,UnitDependencies:vw,createProtonMass:$t},cN={addDependencies:Ix,compareDependencies:Qw,multiplyDependencies:hw,partitionSelectDependencies:bS,typedDependencies:yx,createQuantileSeq:Af},lN={BigNumberDependencies:hx,UnitDependencies:vw,createQuantumOfCirculation:Kt},fN={typedDependencies:yx,createRandom:Mo},pN={typedDependencies:yx,createRandomInt:hs},hN={bignumberDependencies:Yx,matrixDependencies:Cx,largerDependencies:Sw,largerEqDependencies:Gw,smallerDependencies:Vw,smallerEqDependencies:Kw,typedDependencies:yx,createRangeTransform:kb},dN={bignumberDependencies:Yx,fractionDependencies:Jx,AccessorNodeDependencies:Nx,ArrayNodeDependencies:Ux,ConstantNodeDependencies:rE,FunctionNodeDependencies:oE,IndexNodeDependencies:uE,ObjectNodeDependencies:cE,OperatorNodeDependencies:lE,ParenthesisNodeDependencies:fE,SymbolNodeDependencies:aE,addDependencies:Ix,divideDependencies:WE,equalDependencies:tw,isZeroDependencies:zE,matrixDependencies:Cx,multiplyDependencies:hw,parseDependencies:dE,powDependencies:dw,simplifyDependencies:VE,subtractDependencies:gw,typedDependencies:yx,createRationalize:fb},mN={BigNumberDependencies:hx,UnitDependencies:vw,createReducedPlanckConstant:kt},gN={createReplacer:ur},vN={isIntegerDependencies:zx,matrixDependencies:Cx,typedDependencies:yx,createReshape:tu},yN={matrixDependencies:Cx,createResize:Dc},bN={createReviver:Ty},xN={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,zerosDependencies:Rx,createRightArithShift:Dl},wN={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,zerosDependencies:Rx,createRightLogShift:Mc},EN={BigNumberDependencies:hx,DenseMatrixDependencies:gx,SparseMatrixDependencies:Ex,addScalarDependencies:Ox,cosDependencies:EE,matrixDependencies:Cx,multiplyScalarDependencies:uw,normDependencies:US,sinDependencies:cC,typedDependencies:yx,unaryMinusDependencies:mw,createRotationMatrix:qp},CN={multiplyDependencies:hw,rotationMatrixDependencies:EN,typedDependencies:yx,createRotate:$p},SN={IndexDependencies:Hw,matrixDependencies:Cx,rangeDependencies:Xw,typedDependencies:yx,createRow:_l},NN={IndexDependencies:Hw,matrixDependencies:Cx,rangeDependencies:Xw,typedDependencies:yx,createRowTransform:Db},AN={BigNumberDependencies:hx,UnitDependencies:vw,createRydberg:Xt},kN={BigNumberDependencies:hx,createSQRT1_2:vt},DN={BigNumberDependencies:hx,createSQRT2:yt},_N={BigNumberDependencies:hx,createSackurTetrode:cn},MN={BigNumberDependencies:hx,typedDependencies:yx,createSec:Oo},TN={BigNumberDependencies:hx,typedDependencies:yx,createSech:ms},ON={BigNumberDependencies:hx,UnitDependencies:vw,createSecondRadiation:ln},IN={DenseMatrixDependencies:gx,IndexDependencies:Hw,compareNaturalDependencies:eE,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetCartesian:Tl},FN={DenseMatrixDependencies:gx,IndexDependencies:Hw,compareNaturalDependencies:eE,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetDifference:Df},RN={DenseMatrixDependencies:gx,IndexDependencies:Hw,compareNaturalDependencies:eE,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetDistinct:Il},BN={DenseMatrixDependencies:gx,IndexDependencies:Hw,compareNaturalDependencies:eE,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetIntersect:Xf},zN={IndexDependencies:Hw,compareNaturalDependencies:eE,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetIsSubset:Rl},PN={IndexDependencies:Hw,compareNaturalDependencies:eE,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetMultiplicity:Mf},LN={IndexDependencies:Hw,compareNaturalDependencies:eE,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetPowerset:zl},jN={compareNaturalDependencies:eE,typedDependencies:yx,createSetSize:cp},UN={IndexDependencies:Hw,concatDependencies:bE,setDifferenceDependencies:FN,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetSymDifference:Of},qN={IndexDependencies:Hw,concatDependencies:bE,setIntersectDependencies:BN,setSymDifferenceDependencies:UN,sizeDependencies:fw,subsetDependencies:Sx,typedDependencies:yx,createSetUnion:Jf},WN={typedDependencies:yx,createSinh:vs},VN={compareDependencies:Qw,compareNaturalDependencies:eE,matrixDependencies:Cx,typedDependencies:yx,createSort:Ff},$N={SparseMatrixDependencies:Ex,typedDependencies:yx,createSparse:bs},HN={BigNumberDependencies:hx,UnitDependencies:vw,createSpeedOfLight:St},GN={typedDependencies:yx,createSplitUnit:Po},KN={absDependencies:bx,addDependencies:Ix,identityDependencies:cw,invDependencies:qE,maxDependencies:kS,multiplyDependencies:hw,sizeDependencies:fw,sqrtDependencies:YE,subtractDependencies:gw,typedDependencies:yx,createSqrtm:gp},XN={typedDependencies:yx,createSquare:jo},YN={matrixDependencies:Cx,typedDependencies:yx,createSqueeze:uu},JN={addDependencies:Ix,applyDependencies:Px,divideDependencies:WE,isNaNDependencies:JC,multiplyDependencies:hw,subtractDependencies:gw,typedDependencies:yx,createVariance:Dp},ZN={sqrtDependencies:YE,typedDependencies:yx,varianceDependencies:JN,createStd:_p},QN={sqrtDependencies:YE,typedDependencies:yx,varianceDependencies:JN,createStdTransform:Fb},eA={BigNumberDependencies:hx,UnitDependencies:vw,createStefanBoltzmann:fn},tA={typedDependencies:yx,createString:qo},nA={matrixDependencies:Cx,typedDependencies:yx,createSubsetTransform:Cb},rA={addDependencies:Ix,numericDependencies:Qx,typedDependencies:yx,createSumTransform:_b},iA={typedDependencies:yx,createTan:Wo},aA={typedDependencies:yx,createTanh:ws},oA={BigNumberDependencies:hx,createTau:lt},sA={BigNumberDependencies:hx,UnitDependencies:vw,createThomsonCrossSection:Yt},uA={matrixDependencies:Cx,typedDependencies:yx,createTo:bu},cA={addDependencies:Ix,matrixDependencies:Cx,typedDependencies:yx,createTrace:Zl},lA={createTrue:it},fA={typedDependencies:yx,createTypeOf:$o},pA={BigNumberDependencies:hx,typedDependencies:yx,createUnaryPlus:ii},hA={DenseMatrixDependencies:gx,equalScalarDependencies:wx,matrixDependencies:Cx,typedDependencies:yx,createUnequal:Uc},dA={UnitDependencies:vw,typedDependencies:yx,createUnitFunction:ep},mA={eDependencies:tC,createUppercaseE:wt},gA={piDependencies:QS,createUppercasePi:xt},vA={BigNumberDependencies:hx,UnitDependencies:vw,createVacuumImpedance:Mt},yA={addDependencies:Ix,applyDependencies:Px,divideDependencies:WE,isNaNDependencies:JC,multiplyDependencies:hw,subtractDependencies:gw,typedDependencies:yx,createVarianceTransform:Ib},bA={createVersion:Et},xA={BigNumberDependencies:hx,createWeakMixingAngle:Jt},wA={BigNumberDependencies:hx,UnitDependencies:vw,createWienDisplacement:pn},EA={DenseMatrixDependencies:gx,matrixDependencies:Cx,typedDependencies:yx,createXor:Vc},CA=r,SA=n(4279);function NA(e,t){var n=g({},v,t);if("function"!=typeof Object.create)throw new Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var r,i,a=(r={isNumber:y,isComplex:x,isBigNumber:b,isFraction:w,isUnit:E,isString:C,isArray:S,isMatrix:N,isCollection:A,isDenseMatrix:k,isSparseMatrix:D,isRange:_,isIndex:M,isBoolean:T,isResultSet:O,isHelp:I,isFunction:F,isDate:R,isRegExp:B,isObject:z,isNull:P,isUndefined:L,isAccessorNode:j,isArrayNode:U,isAssignmentNode:q,isBlockNode:W,isConditionalNode:V,isConstantNode:$,isFunctionAssignmentNode:H,isFunctionNode:G,isIndexNode:K,isNode:X,isObjectNode:Y,isOperatorNode:J,isParenthesisNode:Z,isRangeNode:Q,isSymbolNode:ee,isChain:te},i=new SA,r.on=i.on.bind(i),r.off=i.off.bind(i),r.once=i.once.bind(i),r.emit=i.emit.bind(i),r);a.config=me(n,a.emit),a.expression={transform:{},mathWithTransform:{config:a.config}};var o={},s=function(e,t,n,r){function i(t,i,o){if(o.wrap&&"function"==typeof i&&(i=function(e){var t=function(){for(var t=[],r=0,i=arguments.length;r<i;r++){var a=arguments[r];t[r]=a&&a.valueOf()}return e.apply(n,t)};return e.transform&&(t.transform=e.transform),t}(i)),function(e){return"function"==typeof e&&"string"==typeof e.signature}(i)&&(i=e(t,{[i.signature]:i})),c(n[t])&&c(i))return i=o.override?e(t,i.signatures):e(n[t],i),n[t]=i,delete r[t],a(t,i),void n.emit("import",t,(function(){return i}));if(void 0===n[t]||o.override)return n[t]=i,delete r[t],a(t,i),void n.emit("import",t,(function(){return i}));if(!o.silent)throw new Error('Cannot import "'+t+'": already exists')}function a(e,t){t&&"function"==typeof t.transform?(n.expression.transform[e]=t.transform,l(e)&&(n.expression.mathWithTransform[e]=t.transform)):(delete n.expression.transform[e],l(e)&&(n.expression.mathWithTransform[e]=t))}function o(e){delete n.expression.transform[e],l(e)?n.expression.mathWithTransform[e]=n[e]:delete n.expression.mathWithTransform[e]}function s(t,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.fn;if(or(a,"."))throw new Error("Factory name should not contain a nested path. Name: "+JSON.stringify(a));var s=p(t)?n.expression.transform:n,u=a in n.expression.transform,l=fe(s,a)?s[a]:void 0,h=function(){var r={};t.dependencies.map(we).forEach((e=>{if(or(e,"."))throw new Error("Factory dependency should not contain a nested path. Name: "+JSON.stringify(e));"math"===e?r.math=n:"mathWithTransform"===e?r.mathWithTransform=n.expression.mathWithTransform:"classes"===e?r.classes=n:r[e]=n[e]}));var o=t(r);if(o&&"function"==typeof o.transform)throw new Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');if(void 0===l||i.override)return o;if(c(l)&&c(o))return e(l,o);if(i.silent)return l;throw new Error('Cannot import "'+a+'": already exists')};t.meta&&!1===t.meta.lazy?(s[a]=h(),l&&u?o(a):(p(t)||f(t))&&le(n.expression.mathWithTransform,a,(()=>s[a]))):(le(s,a,h),l&&u?o(a):(p(t)||f(t))&&le(n.expression.mathWithTransform,a,(()=>s[a]))),r[a]=t,n.emit("import",a,h)}function u(e){return"function"==typeof e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e||null===e||E(e)||x(e)||b(e)||w(e)||N(e)||Array.isArray(e)}function c(e){return"function"==typeof e&&"object"==typeof e.signatures}function l(e){return!fe(h,e)}function f(e){return!(-1!==e.fn.indexOf(".")||fe(h,e.fn)||e.meta&&e.meta.isClass)}function p(e){return void 0!==e&&void 0!==e.meta&&!0===e.meta.isTransformFunction||!1}var h={expression:!0,type:!0,docs:!0,error:!0,json:!0,chain:!0};return function(e,t){var n=arguments.length;if(1!==n&&2!==n)throw new kc("import",n,1,2);function r(e,n,i){if(Array.isArray(n))n.forEach((t=>r(e,t)));else if("object"==typeof n)for(var a in n)fe(n,a)&&r(e,n[a],a);else if(xe(n)||void 0!==i){var o=xe(n)?p(n)?n.fn+".transform":n.fn:i;if(fe(e,o)&&e[o]!==n&&!t.silent)throw new Error('Cannot import "'+o+'" twice');e[o]=n}else if(!t.silent)throw new TypeError("Factory, Object, or Array expected")}t||(t={});var a={};for(var o in r(a,e),a)if(fe(a,o)){var c=a[o];if(xe(c))s(c,t);else if(u(c))i(o,c,t);else if(!t.silent)throw new TypeError("Factory, Object, or Array expected")}}}((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.typed.apply(a.typed,t)}),0,a,o);return a.import=s,a.on("config",(()=>{pe(o).forEach((e=>{e&&e.meta&&e.meta.recreateOnConfigChange&&s(e,{override:!0})}))})),a.create=NA.bind(null,e),a.factory=be,a.import(pe(ue(e))),a.ArgumentsError=kc,a.DimensionError=Bn,a.IndexError=zn,a}var AA=n(8810);function kA(e,t){return t&&e.then((e=>(t(void 0,e),e))).catch((e=>(t(e),e))),e}class DA{constructor(e,t,n,r){this.model=e,this.audioContext=t,this.stream=n,this.frequency=null,this.ready=kA(this.loadModel(e),r)}async loadModel(e){if(this.model=await m.loadLayersModel(`${e}/model.json`),!this.audioContext)throw new Error("Could not access microphone - getUserMedia not available");return await this.processStream(),this}async processStream(){await m.nextFrame();const e=this.audioContext.createMediaStreamSource(this.stream),t=this.audioContext.sampleRate/16e3*1024;let n=4;for(;n<t;)n*=2;const r=this.audioContext.createScriptProcessor(n,1,1);r.onaudioprocess=this.processMicrophoneBuffer.bind(this);const i=this.audioContext.createGain();i.gain.setValueAtTime(0,this.audioContext.currentTime),e.connect(r),r.connect(i),i.connect(this.audioContext.destination),"running"!==this.audioContext.state&&console.warn("User gesture needed to start AudioContext, please click")}async processMicrophoneBuffer(e){await m.nextFrame(),this.results={},DA.resample(e.inputBuffer,(e=>{m.tidy((()=>{const t=m.add(m.linspace(0,7180,360),m.tensor(1997.379408437619));this.running=!0;const n=m.tensor(e.slice(0,1024)),r=m.sub(n,m.mean(n)),i=m.tensor(m.norm(r).dataSync()/Math.sqrt(1024)),a=m.div(r,i).reshape([1,1024]),o=this.model.predict([a]).reshape([360]),s=o.max().dataSync()[0],u=o.argMax().dataSync()[0];this.results.confidence=s.toFixed(3);const c=Math.max(0,u-4),l=Math.min(360,u+5),f=o.slice([c],[l-c]),p=t.slice([c],[l-c]),h=m.mul(f,p).dataSync().reduce(((e,t)=>e+t),0),d=f.dataSync().reduce(((e,t)=>e+t),0),g=s>.5?10*2**(h/d/1200):null;this.frequency=g}))}))}async getPitch(e){await this.ready,await m.nextFrame();const{frequency:t}=this;return e&&e(void 0,t),t}static resample(e,t){const n=e.sampleRate%16e3!=0,r=e.sampleRate/16e3,i=e.getChannelData(0),a=new Float32Array(1024);for(let e=0;e<1024;e+=1)if(n){const t=Math.floor(e*r),n=t+1,o=e*r-t;a[e]=(1-o)*i[t]+o*i[n]}else a[e]=i[e*r];t(a)}}var _A=n(9669),MA=n.n(_A),TA=n(6946),OA=n(75);function IA(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function FA(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var RA={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},BA=224,zA={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},PA={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function LA(e){return void 0===e&&(e={version:1,alpha:1}),IA(this,void 0,void 0,(function(){var t,n,r,i,a,o;return FA(this,(function(s){switch(s.label){case 0:if(null==OA)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(n=e.version.toFixed(2),r=e.alpha?e.alpha.toFixed(2):"",i=-1,a=1,null==e.modelUrl){if(!(n in PA))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(PA));if(!(r in PA[n]))throw new Error("MobileNet constructed with invalid alpha "+e.alpha+". Valid multipliers for this version are: "+Object.keys(PA[n])+".");t=PA[n][r].inputRange,i=t[0],a=t[1]}return[4,(o=new jA(n,r,e.modelUrl,i,a)).load()];case 1:return s.sent(),[2,o]}}))}))}var jA=function(){function e(e,t,n,r,i){void 0===r&&(r=-1),void 0===i&&(i=1),this.version=e,this.alpha=t,this.modelUrl=n,this.inputMin=r,this.inputMax=i,this.inputRange=i-r}return e.prototype.load=function(){return IA(this,void 0,void 0,(function(){var e,t,n,r,i=this;return FA(this,(function(a){switch(a.label){case 0:return this.modelUrl?(e=this,[4,(0,TA.loadGraphModel)(this.modelUrl)]):[3,2];case 1:return e.model=a.sent(),[3,4];case 2:return t=PA[this.version][this.alpha].url,n=this,[4,(0,TA.loadGraphModel)(t,{fromTFHub:!0})];case 3:n.model=a.sent(),a.label=4;case 4:return[4,(r=(0,OA.tidy)((function(){return i.model.predict((0,OA.zeros)([1,BA,BA,3]))}))).data()];case 5:return a.sent(),r.dispose(),[2]}}))}))},e.prototype.infer=function(e,t){var n=this;return void 0===t&&(t=!1),(0,OA.tidy)((function(){e instanceof OA.Tensor||(e=OA.browser.fromPixels(e));var r=e.toFloat().mul(n.inputRange).add(n.inputMin),i=r;e.shape[0]===BA&&e.shape[1]===BA||(i=OA.image.resizeBilinear(r,[BA,BA],!0));var a,o=i.reshape([-1,BA,BA,3]);if(t){var s=zA[n.version];a=n.model.execute(o,s).squeeze([1,2])}else a=n.model.predict(o).slice([0,1],[-1,1e3]);return a}))},e.prototype.classify=function(e,t){return void 0===t&&(t=3),IA(this,void 0,void 0,(function(){var n,r;return FA(this,(function(i){switch(i.label){case 0:return[4,UA(n=this.infer(e),t)];case 1:return r=i.sent(),n.dispose(),[2,r]}}))}))},e}();function UA(e,t){return IA(this,void 0,void 0,(function(){var n,r,i,a,o,s,u;return FA(this,(function(c){switch(c.label){case 0:return[4,(n=e.softmax()).data()];case 1:for(r=c.sent(),n.dispose(),i=[],u=0;u<r.length;u++)i.push({value:r[u],index:u});for(i.sort((function(e,t){return t.value-e.value})),a=new Float32Array(t),o=new Int32Array(t),u=0;u<t;u++)a[u]=i[u].value,o[u]=i[u].index;for(s=[],u=0;u<o.length;u++)s.push({className:RA[o[u]],probability:a[u]});return[2,s]}}))}))}function qA(e,t,n){const r=[];for(let t=0;t<e.length;t+=1)r.push({value:e[t],index:t});r.sort(((e,t)=>t.value-e.value));const i=new Float32Array(t),a=new Int32Array(t);for(let e=0;e<t;e+=1)i[e]=r[e].value,a[e]=r[e].index;const o=[];for(let e=0;e<a.length;e+=1)o.push({className:n[a[e]],probability:i[e]});return o}async function WA(e,t,n){return qA(await e.data(),t,n)}const VA=["kit fox","English setter","Siberian husky","Australian terrier","English springer","grey whale","lesser panda","Egyptian cat","ibex","Persian cat","cougar","gazelle","porcupine","sea lion","malamute","badger","Great Dane","Walker hound","Welsh springer spaniel","whippet","Scottish deerhound","killer whale","mink","African elephant","Weimaraner","soft-coated wheaten terrier","Dandie Dinmont","red wolf","Old English sheepdog","jaguar","otterhound","bloodhound","Airedale","hyena","meerkat","giant schnauzer","titi","three-toed sloth","sorrel","black-footed ferret","dalmatian","black-and-tan coonhound","papillon","skunk","Staffordshire bullterrier","Mexican hairless","Bouvier des Flandres","weasel","miniature poodle","Cardigan","malinois","bighorn","fox squirrel","colobus","tiger cat","Lhasa","impala","coyote","Yorkshire terrier","Newfoundland","brown bear","red fox","Norwegian elkhound","Rottweiler","hartebeest","Saluki","grey fox","schipperke","Pekinese","Brabancon griffon","West Highland white terrier","Sealyham terrier","guenon","mongoose","indri","tiger","Irish wolfhound","wild boar","EntleBucher","zebra","ram","French bulldog","orangutan","basenji","leopard","Bernese mountain dog","Maltese dog","Norfolk terrier","toy terrier","vizsla","cairn","squirrel monkey","groenendael","clumber","Siamese cat","chimpanzee","komondor","Afghan hound","Japanese spaniel","proboscis monkey","guinea pig","white wolf","ice bear","gorilla","borzoi","toy poodle","Kerry blue terrier","ox","Scotch terrier","Tibetan mastiff","spider monkey","Doberman","Boston bull","Greater Swiss Mountain dog","Appenzeller","Shih-Tzu","Irish water spaniel","Pomeranian","Bedlington terrier","warthog","Arabian camel","siamang","miniature schnauzer","collie","golden retriever","Irish terrier","affenpinscher","Border collie","hare","boxer","silky terrier","beagle","Leonberg","German short-haired pointer","patas","dhole","baboon","macaque","Chesapeake Bay retriever","bull mastiff","kuvasz","capuchin","pug","curly-coated retriever","Norwich terrier","flat-coated retriever","hog","keeshond","Eskimo dog","Brittany spaniel","standard poodle","Lakeland terrier","snow leopard","Gordon setter","dingo","standard schnauzer","hamster","Tibetan terrier","Arctic fox","wire-haired fox terrier","basset","water buffalo","American black bear","Angora","bison","howler monkey","hippopotamus","chow","giant panda","American Staffordshire terrier","Shetland sheepdog","Great Pyrenees","Chihuahua","tabby","marmoset","Labrador retriever","Saint Bernard","armadillo","Samoyed","bluetick","redbone","polecat","marmot","kelpie","gibbon","llama","miniature pinscher","wood rabbit","Italian greyhound","lion","cocker spaniel","Irish setter","dugong","Indian elephant","beaver","Sussex spaniel","Pembroke","Blenheim spaniel","Madagascar cat","Rhodesian ridgeback","lynx","African hunting dog","langur","Ibizan hound","timber wolf","cheetah","English foxhound","briard","sloth bear","Border terrier","German shepherd","otter","koala","tusker","echidna","wallaby","platypus","wombat","revolver","umbrella","schooner","soccer ball","accordion","ant","starfish","chambered nautilus","grand piano","laptop","strawberry","airliner","warplane","airship","balloon","space shuttle","fireboat","gondola","speedboat","lifeboat","canoe","yawl","catamaran","trimaran","container ship","liner","pirate","aircraft carrier","submarine","wreck","half track","tank","missile","bobsled","dogsled","bicycle-built-for-two","mountain bike","freight car","passenger car","barrow","shopping cart","motor scooter","forklift","electric locomotive","steam locomotive","amphibian","ambulance","beach wagon","cab","convertible","jeep","limousine","minivan","Model T","racer","sports car","go-kart","golfcart","moped","snowplow","fire engine","garbage truck","pickup","tow truck","trailer truck","moving van","police van","recreational vehicle","streetcar","snowmobile","tractor","mobile home","tricycle","unicycle","horse cart","jinrikisha","oxcart","bassinet","cradle","crib","four-poster","bookcase","china cabinet","medicine chest","chiffonier","table lamp","file","park bench","barber chair","throne","folding chair","rocking chair","studio couch","toilet seat","desk","pool table","dining table","entertainment center","wardrobe","Granny Smith","orange","lemon","fig","pineapple","banana","jackfruit","custard apple","pomegranate","acorn","hip","ear","rapeseed","corn","buckeye","organ","upright","chime","drum","gong","maraca","marimba","steel drum","banjo","cello","violin","harp","acoustic guitar","electric guitar","cornet","French horn","trombone","harmonica","ocarina","panpipe","bassoon","oboe","sax","flute","daisy","yellow lady's slipper","cliff","valley","alp","volcano","promontory","sandbar","coral reef","lakeside","seashore","geyser","hatchet","cleaver","letter opener","plane","power drill","lawn mower","hammer","corkscrew","can opener","plunger","screwdriver","shovel","plow","chain saw","cock","hen","ostrich","brambling","goldfinch","house finch","junco","indigo bunting","robin","bulbul","jay","magpie","chickadee","water ouzel","kite","bald eagle","vulture","great grey owl","black grouse","ptarmigan","ruffed grouse","prairie chicken","peacock","quail","partridge","African grey","macaw","sulphur-crested cockatoo","lorikeet","coucal","bee eater","hornbill","hummingbird","jacamar","toucan","drake","red-breasted merganser","goose","black swan","white stork","black stork","spoonbill","flamingo","American egret","little blue heron","bittern","crane","limpkin","American coot","bustard","ruddy turnstone","red-backed sandpiper","redshank","dowitcher","oystercatcher","European gallinule","pelican","king penguin","albatross","great white shark","tiger shark","hammerhead","electric ray","stingray","barracouta","coho","tench","goldfish","eel","rock beauty","anemone fish","lionfish","puffer","sturgeon","gar","loggerhead","leatherback turtle","mud turtle","terrapin","box turtle","banded gecko","common iguana","American chameleon","whiptail","agama","frilled lizard","alligator lizard","Gila monster","green lizard","African chameleon","Komodo dragon","triceratops","African crocodile","American alligator","thunder snake","ringneck snake","hognose snake","green snake","king snake","garter snake","water snake","vine snake","night snake","boa constrictor","rock python","Indian cobra","green mamba","sea snake","horned viper","diamondback","sidewinder","European fire salamander","common newt","eft","spotted salamander","axolotl","bullfrog","tree frog","tailed frog","whistle","wing","paintbrush","hand blower","oxygen mask","snorkel","loudspeaker","microphone","screen","mouse","electric fan","oil filter","strainer","space heater","stove","guillotine","barometer","rule","odometer","scale","analog clock","digital clock","wall clock","hourglass","sundial","parking meter","stopwatch","digital watch","stethoscope","syringe","magnetic compass","binoculars","projector","sunglasses","loupe","radio telescope","bow","cannon","assault rifle","rifle","projectile","computer keyboard","typewriter keyboard","crane","lighter","abacus","cash machine","slide rule","desktop computer","hand-held computer","notebook","web site","harvester","thresher","printer","slot","vending machine","sewing machine","joystick","switch","hook","car wheel","paddlewheel","pinwheel","potter's wheel","gas pump","carousel","swing","reel","radiator","puck","hard disc","sunglass","pick","car mirror","solar dish","remote control","disk brake","buckle","hair slide","knot","combination lock","padlock","nail","safety pin","screw","muzzle","seat belt","ski","candle","jack-o'-lantern","spotlight","torch","neck brace","pier","tripod","maypole","mousetrap","spider web","trilobite","harvestman","scorpion","black and gold garden spider","barn spider","garden spider","black widow","tarantula","wolf spider","tick","centipede","isopod","Dungeness crab","rock crab","fiddler crab","king crab","American lobster","spiny lobster","crayfish","hermit crab","tiger beetle","ladybug","ground beetle","long-horned beetle","leaf beetle","dung beetle","rhinoceros beetle","weevil","fly","bee","grasshopper","cricket","walking stick","cockroach","mantis","cicada","leafhopper","lacewing","dragonfly","damselfly","admiral","ringlet","monarch","cabbage butterfly","sulphur butterfly","lycaenid","jellyfish","sea anemone","brain coral","flatworm","nematode","conch","snail","slug","sea slug","chiton","sea urchin","sea cucumber","iron","espresso maker","microwave","Dutch oven","rotisserie","toaster","waffle iron","vacuum","dishwasher","refrigerator","washer","Crock Pot","frying pan","wok","caldron","coffeepot","teapot","spatula","altar","triumphal arch","patio","steel arch bridge","suspension bridge","viaduct","barn","greenhouse","palace","monastery","library","apiary","boathouse","church","mosque","stupa","planetarium","restaurant","cinema","home theater","lumbermill","coil","obelisk","totem pole","castle","prison","grocery store","bakery","barbershop","bookshop","butcher shop","confectionery","shoe shop","tobacco shop","toyshop","fountain","cliff dwelling","yurt","dock","brass","megalith","bannister","breakwater","dam","chainlink fence","picket fence","worm fence","stone wall","grille","sliding door","turnstile","mountain tent","scoreboard","honeycomb","plate rack","pedestal","beacon","mashed potato","bell pepper","head cabbage","broccoli","cauliflower","zucchini","spaghetti squash","acorn squash","butternut squash","cucumber","artichoke","cardoon","mushroom","shower curtain","jean","carton","handkerchief","sandal","ashcan","safe","plate","necklace","croquet ball","fur coat","thimble","pajama","running shoe","cocktail shaker","chest","manhole cover","modem","tub","tray","balance beam","bagel","prayer rug","kimono","hot pot","whiskey jug","knee pad","book jacket","spindle","ski mask","beer bottle","crash helmet","bottlecap","tile roof","mask","maillot","Petri dish","football helmet","bathing cap","teddy","holster","pop bottle","photocopier","vestment","crossword puzzle","golf ball","trifle","suit","water tower","feather boa","cloak","red wine","drumstick","shield","Christmas stocking","hoopskirt","menu","stage","bonnet","meat loaf","baseball","face powder","scabbard","sunscreen","beer glass","hen-of-the-woods","guacamole","lampshade","wool","hay","bow tie","mailbag","water jug","bucket","dishrag","soup bowl","eggnog","mortar","trench coat","paddle","chain","swab","mixing bowl","potpie","wine bottle","shoji","bulletproof vest","drilling platform","binder","cardigan","sweatshirt","pot","birdhouse","hamper","ping-pong ball","pencil box","pay-phone","consomme","apron","punching bag","backpack","groom","bearskin","pencil sharpener","broom","mosquito net","abaya","mortarboard","poncho","crutch","Polaroid camera","space bar","cup","racket","traffic light","quill","radio","dough","cuirass","military uniform","lipstick","shower cap","monitor","oscilloscope","mitten","brassiere","French loaf","vase","milk can","rugby ball","paper towel","earthstar","envelope","miniskirt","cowboy hat","trolleybus","perfume","bathtub","hotdog","coral fungus","bullet train","pillow","toilet tissue","cassette","carpenter's kit","ladle","stinkhorn","lotion","hair spray","academic gown","dome","crate","wig","burrito","pill bottle","chain mail","theater curtain","window shade","barrel","washbasin","ballpoint","basketball","bath towel","cowboy boot","gown","window screen","agaric","cellular telephone","nipple","barbell","mailbox","lab coat","fire screen","minibus","packet","maze","pole","horizontal bar","sombrero","pickelhaube","rain barrel","wallet","cassette player","comic book","piggy bank","street sign","bell cote","fountain pen","Windsor tie","volleyball","overskirt","sarong","purse","bolo tie","bib","parachute","sleeping bag","television","swimming trunks","measuring cup","espresso","pizza","breastplate","shopping basket","wooden spoon","saltshaker","chocolate sauce","ballplayer","goblet","gyromitra","stretcher","water bottle","dial telephone","soap dispenser","jersey","school bus","jigsaw puzzle","plastic bag","reflex camera","diaper","Band Aid","ice lolly","velvet","tennis ball","gasmask","doormat","Loafer","ice cream","pretzel","quilt","maillot","tape player","clog","iPod","bolete","scuba diver","pitcher","matchstick","bikini","sock","CD player","lens cap","thatch","vault","beaker","bubble","cheeseburger","parallel bars","flagpole","coffee mug","rubber eraser","stole","carbonara","dumbbell"];class $A{constructor(e){switch(this.version=e,this.version){case"reference":this.imgSize=256;break;case"tiny":this.imgSize=224}}async load(){switch(this.version){case"reference":this.model=await m.loadLayersModel("https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknetreference/model.json");break;case"tiny":this.model=await m.loadLayersModel("https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknettiny/model.json")}const e=m.tidy((()=>this.model.predict(m.zeros([1,this.imgSize,this.imgSize,3]))));await e.data(),e.dispose()}async classify(e,t=3){const n=m.tidy((()=>{const t=function(e,t){let n;e instanceof m.Tensor?n=e:e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?n=m.browser.fromPixels(e):"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData)&&(n=m.browser.fromPixels(e.elt));const r=n.toFloat().div(m.scalar(255));let i=r;if(r.shape[0]!==t||r.shape[1]!==t){const e=!0;i=m.image.resizeBilinear(r,[t,t],e)}return i.reshape([1,t,t,3])}(e,this.imgSize),n=this.model.predict(t);return m.softmax(n)})),r=await WA(n,t,VA);return n.dispose(),r}}async function HA(e){if("reference"!==e&&"tiny"!==e)throw new Error("Please select a version: darknet-reference or darknet-tiny");const t=new $A(e);return await t.load(),t}const GA=["flashlight","belt","mushroom","pond","strawberry","pineapple","sun","cow","ear","bush","pliers","watermelon","apple","baseball","feather","shoe","leaf","lollipop","crown","ocean","horse","mountain","mosquito","mug","hospital","saw","castle","angel","underwear","traffic_light","cruise_ship","marker","blueberry","flamingo","face","hockey_stick","bucket","campfire","asparagus","skateboard","door","suitcase","skull","cloud","paint_can","hockey_puck","steak","house_plant","sleeping_bag","bench","snowman","arm","crayon","fan","shovel","leg","washing_machine","harp","toothbrush","tree","bear","rake","megaphone","knee","guitar","calculator","hurricane","grapes","paintbrush","couch","nose","square","wristwatch","penguin","bridge","octagon","submarine","screwdriver","rollerskates","ladder","wine_bottle","cake","bracelet","broom","yoga","finger","fish","line","truck","snake","bus","stitches","snorkel","shorts","bowtie","pickup_truck","tooth","snail","foot","crab","school_bus","train","dresser","sock","tractor","map","hedgehog","coffee_cup","computer","matches","beard","frog","crocodile","bathtub","rain","moon","bee","knife","boomerang","lighthouse","chandelier","jail","pool","stethoscope","frying_pan","cell_phone","binoculars","purse","lantern","birthday_cake","clarinet","palm_tree","aircraft_carrier","vase","eraser","shark","skyscraper","bicycle","sink","teapot","circle","tornado","bird","stereo","mouth","key","hot_dog","spoon","laptop","cup","bottlecap","The_Great_Wall_of_China","The_Mona_Lisa","smiley_face","waterslide","eyeglasses","ceiling_fan","lobster","moustache","carrot","garden","police_car","postcard","necklace","helmet","blackberry","beach","golf_club","car","panda","alarm_clock","t-shirt","dog","bread","wine_glass","lighter","flower","bandage","drill","butterfly","swan","owl","raccoon","squiggle","calendar","giraffe","elephant","trumpet","rabbit","trombone","sheep","onion","church","flip_flops","spreadsheet","pear","clock","roller_coaster","parachute","kangaroo","duck","remote_control","compass","monkey","rainbow","tennis_racquet","lion","pencil","string_bean","oven","star","cat","pizza","soccer_ball","syringe","flying_saucer","eye","cookie","floor_lamp","mouse","toilet","toaster","The_Eiffel_Tower","airplane","stove","cello","stop_sign","tent","diving_board","light_bulb","hammer","scorpion","headphones","basket","spider","paper_clip","sweater","ice_cream","envelope","sea_turtle","donut","hat","hourglass","broccoli","jacket","backpack","book","lightning","drums","snowflake","radio","banana","camel","canoe","toothpaste","chair","picture_frame","parrot","sandwich","lipstick","pants","violin","brain","power_outlet","triangle","hamburger","dragon","bulldozer","cannon","dolphin","zebra","animal_migration","camouflage","scissors","basketball","elbow","umbrella","windmill","table","rifle","hexagon","potato","anvil","sword","peanut","axe","television","rhinoceros","baseball_bat","speedboat","sailboat","zigzag","garden_hose","river","house","pillow","ant","tiger","stairs","cooler","see_saw","piano","fireplace","popsicle","dumbbell","mailbox","barn","hot_tub","teddy-bear","fork","dishwasher","peas","hot_air_balloon","keyboard","microwave","wheel","fire_hydrant","van","camera","whale","candle","octopus","pig","swing_set","helicopter","saxophone","passport","bat","ambulance","diamond","goatee","fence","grass","mermaid","motorbike","microphone","toe","cactus","nail","telephone","hand","squirrel","streetlight","bed","firetruck"];class KA{constructor(){this.imgSize=28}async load(){this.model=await m.loadLayersModel("https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/doodlenet/model.json");const e=m.tidy((()=>this.model.predict(m.zeros([1,this.imgSize,this.imgSize,1]))));await e.data(),e.dispose()}async classify(e,t=10){const n=m.tidy((()=>{const t=function(e,t){let n;e instanceof m.Tensor?n=e:e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?n=m.browser.fromPixels(e):"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData)&&(n=m.browser.fromPixels(e.elt));const r=m.scalar(1).sub(n.toFloat().div(m.scalar(255)));let i=r;r.shape[0]===t&&r.shape[1]===t||(i=m.image.resizeBilinear(r,[t,t]));const[a,o,s]=m.split(i,3,3);return a.add(o).add(s).div(m.scalar(3)).floor().reshape([1,t,t,1])}(e,this.imgSize);return this.model.predict(t)})),r=await WA(n,t,GA);return n.dispose(),r}}async function XA(){const e=new KA;return await e.load(),e}const YA=new class{constructor(){this.m_p5Instance=window}setP5Instance(e){this.m_p5Instance=e}get p5Instance(){return void 0!==this.m_p5Instance&&"function"==typeof this.m_p5Instance.loadImage?this.m_p5Instance:void 0!==this.m_p5Instance.p5&&void 0!==this.m_p5Instance.p5.Image&&"function"==typeof this.m_p5Instance.p5.Image?this.m_p5Instance.p5:void 0}checkP5(){return!!this.p5Instance}getBlob(e){return new Promise((t=>{e.toBlob((e=>{t(e)}))}))}loadAsync(e){return new Promise((t=>{this.p5Instance.loadImage(e,(e=>{t(e)}))}))}async rawToBlob(e,t,n){const r=Array.from(e),i=document.createElement("canvas"),a=i.getContext("2d");i.width=t,i.height=n;const o=a.createImageData(t,n),{data:s}=o;for(let e=0;e<t*n*4;e+=1)s[e]=r[e];return a.putImageData(o,0,0),await this.getBlob(i)}async blobToP5Image(e){return this.checkP5()?await this.loadAsync(URL.createObjectURL(e)):null}},JA=YA,ZA=(e,t,n=(()=>{}))=>{const r=e,i=document.createElement("video");return r.onplay=()=>{const e=r.captureStream();i.srcObject=e,i.width=t,i.height=t,i.autoplay=!0,i.playsinline=!0,i.muted=!0,n()},i},QA=e=>{const[t,n]=e.shape,r=e.dataSync(),i=document.createElement("canvas");i.width=n,i.height=t;const a=i.getContext("2d"),o=a.getImageData(0,0,i.width,i.height);for(let e=0;e<n*t;e+=1){const t=4*e,n=3*e;o.data[t+0]=Math.floor(256*r[n+0]),o.data[t+1]=Math.floor(256*r[n+1]),o.data[t+2]=Math.floor(256*r[n+2]),o.data[t+3]=255}a.putImageData(o,0,0);const s=i.toDataURL(),u=document.createElement("img");return u.src=s,u.style.width=n,u.style.height=t,e.dispose(),u},ek=e=>{const t=Math.min(e.shape[0],e.shape[1]),n=e.shape[0]/2-t/2,r=e.shape[1]/2-t/2;return e.slice([n,r,0],[t,t,3])},tk=e=>{let t,n,r;if(r=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData?e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"==typeof e&&e.canvas instanceof HTMLCanvasElement?e.canvas:e,HTMLVideoElement,t=r.width,n=r.height,JA.checkP5()){const r=JA.p5Instance.createGraphics(t,n);return r.push(),r.translate(t,0),r.scale(-1,1),r.image(e,0,0,t,n),r.pop(),r}const i=document.createElement("canvas");i.width=t,i.height=n;const a=i.getContext("2d");return a.drawImage(r,0,0,t,n),a.translate(t,0),a.scale(-1,1),a.drawImage(i,-1*t,0,t,n),i};function nk(e,t=null){return m.tidy((()=>{let n=m.browser.fromPixels(e);return t&&(n=m.image.resizeBilinear(n,t)),ek(n).expandDims(0).toFloat().div(m.scalar(127)).sub(m.scalar(1))}))}function rk(e){return e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function ik(e){let t,n,r;r=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData?e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"==typeof e&&e.canvas instanceof HTMLCanvasElement?e.canvas:e,HTMLVideoElement,t=r.width,n=r.height;const i=document.createElement("canvas");i.width=t,i.height=n;const a=i.getContext("2d");a.drawImage(r,0,0,t,n);const o=a.getImageData(0,0,t,n);return Array.from(o.data)}const ak=2,ok=1,sk=3,uk=["mobilenet","darknet","darknet-tiny","doodlenet"];class ck{constructor(e,t,n,r){if(this.video=t,this.model=null,this.mapStringToIndex=[],"string"==typeof e)if(uk.includes(e))switch(this.modelName=e,this.modelUrl=null,this.modelName){case"mobilenet":this.modelToUse=a,this.version=n.version||ak,this.alpha=n.alpha||ok,this.topk=n.topk||sk;break;case"darknet":this.version="reference",this.modelToUse=o;break;case"darknet-tiny":this.version="tiny",this.modelToUse=o;break;case"doodlenet":this.modelToUse=s;break;default:this.modelToUse=null}else this.modelUrl=e;this.ready=kA(this.loadModel(this.modelUrl),r)}async loadModel(e){return this.model=e?await this.loadModelFrom(e):await this.modelToUse.load({version:this.version,alpha:this.alpha}),this}async loadModelFrom(e=null){try{let t;if(null!==e&&(t=(await MA().get(e)).data),t.ml5Specs&&(this.mapStringToIndex=t.ml5Specs.mapStringToIndex),0===this.mapStringToIndex.length){const t=e.split("/"),n=`${t.slice(0,t.length-1).join("/")}/metadata.json`,r=await MA().get(n).catch((e=>{console.log("Tried to fetch metadata.json, but it seems to be missing.",e)}));if(r){const e=r.data;e.labels&&(this.mapStringToIndex=e.labels)}}return this.model=await m.loadLayersModel(e),this.model}catch(e){return console.error(e),e}}async classifyInternal(e,t){if(await this.ready,await m.nextFrame(),e instanceof HTMLVideoElement&&0===e.readyState){const t=e;await new Promise((e=>{t.onloadeddata=()=>e()}))}this.video&&0===this.video.readyState&&await new Promise((e=>{this.video.onloadeddata=()=>e()}));const n=[224,224];if(this.modelUrl){await m.nextFrame();const t=m.tidy((()=>{const t=nk(e,n),r=this.model.predict(t);return Array.from(r.as1D().dataSync())})),r=await t.map(((e,t)=>({label:this.mapStringToIndex.length>0&&this.mapStringToIndex[t]?this.mapStringToIndex[t]:t,confidence:e}))).sort(((e,t)=>t.confidence-e.confidence));return r}const r=nk(e,n),i=this.model.classify(r,t).then((e=>e.map((e=>({label:e.className,confidence:e.probability})))));return r.dispose(),i}async classify(e,t=null,n){let r,i=this.video,a=this.topk;if("function"==typeof e)i=this.video,r=e;else if("number"==typeof e)i=this.video,a=e;else if(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData)i=e;else if("object"==typeof e&&(e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData))i=e.elt;else if("object"==typeof e&&e.canvas instanceof HTMLCanvasElement)i=e.canvas;else if(!(this.video instanceof HTMLVideoElement))throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");return"number"==typeof t?a=t:"function"==typeof t&&(r=t),"function"==typeof n&&(r=n),kA(this.classifyInternal(i,a),r)}async predict(e,t,n){return this.classify(e,t||null,n)}}var lk=function(e,t){return(lk=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},fk=function(){return(fk=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function pk(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function hk(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function dk(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function mk(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function gk(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(mk(arguments[t]));return e}function vk(e){return pk(this,void 0,void 0,(function(){return hk(this,(function(t){return[2,new Promise((function(t,r){0===e.indexOf("http://")||0===e.indexOf("https://")?fetch(e).then((function(e){e.json().then((function(e){return t(e)}))})):0===e.indexOf("file://")?n(9127).readFile(e.slice("file://".length),{encoding:"utf-8"},(function(e,n){return t(JSON.parse(n))})):r(new Error("Unsupported URL scheme in metadata URL: "+e+". Supported schemes are: http://, https://, and (node.js-only) file://"))}))]}))}))}var yk=null;function bk(e){return null==yk&&(yk=(0,m.backend)().epsilon()),(0,m.tidy)((function(){var t=(0,m.moments)(e),n=t.mean,r=t.variance;return e.sub(n).div(r.sqrt().add(yk))}))}function xk(e){return pk(this,void 0,void 0,(function(){return hk(this,(function(t){switch(t.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:null==e||e,video:!1})];case 1:return[2,t.sent()]}}))}))}var wk=function(){function e(e){var t=this;if(null==e)throw new Error("Required configuration object is missing for BrowserFftFeatureExtractor constructor");if(null==e.spectrogramCallback)throw new Error("spectrogramCallback cannot be null or undefined");if(!(e.numFramesPerSpectrogram>0))throw new Error("Invalid value in numFramesPerSpectrogram: "+e.numFramesPerSpectrogram);if(e.suppressionTimeMillis<0)throw new Error("Expected suppressionTimeMillis to be >= 0, but got "+e.suppressionTimeMillis);if(this.suppressionTimeMillis=e.suppressionTimeMillis,this.spectrogramCallback=e.spectrogramCallback,this.numFrames=e.numFramesPerSpectrogram,this.sampleRateHz=e.sampleRateHz||44100,this.fftSize=e.fftSize||1024,this.frameDurationMillis=this.fftSize/this.sampleRateHz*1e3,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.overlapFactor=e.overlapFactor,this.includeRawAudio=e.includeRawAudio,m.util.assert(this.overlapFactor>=0&&this.overlapFactor<1,(function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+t.overlapFactor})),this.columnTruncateLength>this.fftSize)throw new Error("columnTruncateLength "+this.columnTruncateLength+" exceeds fftSize ("+this.fftSize+").");this.audioContextConstructor=window.AudioContext||window.webkitAudioContext}return e.prototype.start=function(e){return pk(this,void 0,void 0,(function(){var t,n,r;return hk(this,(function(i){switch(i.label){case 0:if(null!=this.frameIntervalTask)throw new Error("Cannot start already-started BrowserFftFeatureExtractor");return t=this,[4,xk(e)];case 1:return t.stream=i.sent(),this.audioContext=new this.audioContextConstructor,this.audioContext.sampleRate!==this.sampleRateHz&&console.warn("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate),n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=0,n.connect(this.analyser),this.freqDataQueue=[],this.freqData=new Float32Array(this.fftSize),this.includeRawAudio&&(this.timeDataQueue=[],this.timeData=new Float32Array(this.fftSize)),r=Math.max(1,Math.round(this.numFrames*(1-this.overlapFactor))),this.tracker=new Sk(r,Math.round(this.suppressionTimeMillis/this.frameDurationMillis)),this.frameIntervalTask=setInterval(this.onAudioFrame.bind(this),this.fftSize/this.sampleRateHz*1e3),[2]}}))}))},e.prototype.onAudioFrame=function(){return pk(this,void 0,void 0,(function(){var e,t,n,r;return hk(this,(function(i){switch(i.label){case 0:return this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0?[2]:(this.freqDataQueue.push(this.freqData.slice(0,this.columnTruncateLength)),this.includeRawAudio&&(this.analyser.getFloatTimeDomainData(this.timeData),this.timeDataQueue.push(this.timeData.slice())),this.freqDataQueue.length>this.numFrames&&this.freqDataQueue.shift(),this.tracker.tick()?(e=Ek(this.freqDataQueue),t=Ck(e,[1,this.numFrames,this.columnTruncateLength,1]),n=void 0,this.includeRawAudio&&(r=Ek(this.timeDataQueue),n=Ck(r,[1,this.numFrames*this.fftSize])),[4,this.spectrogramCallback(t,n)]):[3,2]);case 1:i.sent()&&this.tracker.suppress(),(0,m.dispose)([t,n]),i.label=2;case 2:return[2]}}))}))},e.prototype.stop=function(){return pk(this,void 0,void 0,(function(){return hk(this,(function(e){if(null==this.frameIntervalTask)throw new Error("Cannot stop because there is no ongoing streaming activity.");return clearInterval(this.frameIntervalTask),this.frameIntervalTask=null,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop(),[2]}))}))},e.prototype.setConfig=function(e){throw new Error("setConfig() is not implemented for BrowserFftFeatureExtractor.")},e.prototype.getFeatures=function(){throw new Error("getFeatures() is not implemented for BrowserFftFeatureExtractor. Use the spectrogramCallback field of the constructor config instead.")},e}();function Ek(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}function Ck(e,t){var n=new Float32Array(m.util.sizeFromShape(t));return n.set(e,n.length-e.length),(0,m.tensor)(n,t)}var Sk=function(){function e(e,t){var n=this;this.period=e,this.suppressionTime=null==t?0:t,this.counter=0,m.util.assert(this.period>0,(function(){return"Expected period to be positive, but got "+n.period}))}return e.prototype.tick=function(){return this.counter++,this.counter%this.period==0&&(null==this.suppressionOnset||this.counter-this.suppressionOnset>this.suppressionTime)},e.prototype.suppress=function(){this.suppressionOnset=this.counter},e}();function Nk(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Ak(e){if(null==e)throw new Error("Received null or undefind string");for(var t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n.buffer}function kk(e){if(null==e)throw new Error("Received null or undefind buffer");var t=new Uint8Array(e);return decodeURIComponent(escape(String.fromCharCode.apply(String,gk(t))))}var Dk="TFJSSCDS",_k="_background_noise_",Mk=function(){function e(e){if(this.examples={},this.label2Ids={},null!=e)for(var t=function(e){m.util.assert(null!=e,(function(){return"Received null or undefined buffer"}));var t=0,n=kk(e.slice(t,Dk.length));m.util.assert(n===Dk,(function(){return"Deserialization error: Invalid descriptor"})),t+=Dk.length,t+=4;var r=new Uint32Array(e,t,1),i=t+=4;t=i+r[0];var a=kk(e.slice(i,t));return{manifest:JSON.parse(a),data:e.slice(t)}}(e),n=0,r=0;r<t.manifest.length;++r){var i=t.manifest[r],a=i.spectrogramNumFrames*i.spectrogramFrameSize;null!=i.rawAudioNumSamples&&(a+=i.rawAudioNumSamples),a*=4,this.addExample(Ok({spec:i,data:t.data.slice(n,n+a)})),n+=a}}return e.prototype.addExample=function(e){m.util.assert(null!=e,(function(){return"Got null or undefined example"})),m.util.assert(null!=e.label&&e.label.length>0,(function(){return"Expected label to be a non-empty string, but got "+JSON.stringify(e.label)}));var t=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}();return this.examples[t]=e,e.label in this.label2Ids||(this.label2Ids[e.label]=[]),this.label2Ids[e.label].push(t),t},e.prototype.merge=function(e){var t,n,r,i;m.util.assert(e!==this,(function(){return"Cannot merge a dataset into itself"}));var a=e.getVocabulary();try{for(var o=dk(a),s=o.next();!s.done;s=o.next()){var u=s.value,c=e.getExamples(u);try{for(var l=dk(c),f=l.next();!f.done;f=l.next()){var p=f.value;this.addExample(p.example)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.getExampleCounts=function(){var e={};for(var t in this.examples){var n=this.examples[t];n.label in e||(e[n.label]=0),e[n.label]++}return e},e.prototype.getExamples=function(e){var t=this;m.util.assert(null!=e,(function(){return"Expected label to be a string, but got "+JSON.stringify(e)})),m.util.assert(e in this.label2Ids,(function(){return'No example of label "'+e+'" exists in dataset'}));var n=[];return this.label2Ids[e].forEach((function(e){n.push({uid:e,example:t.examples[e]})})),n},e.prototype.getData=function(e,t){var n=this;m.util.assert(this.size()>0,(function(){return"Cannot get spectrograms as tensors because the dataset is empty"}));var r=this.getVocabulary();null!=e?m.util.assert(-1!==r.indexOf(e),(function(){return"Label "+e+" is not in the vocabulary ("+JSON.stringify(r)+")"})):m.util.assert(r.length>1,(function(){return"One-hot encoding of labels requires the vocabulary to have at least two words, but it has only "+r.length+" word."})),null==t&&(t={});var i,a,o=this.getSortedUniqueNumFrames();1===o.length?(i=null==t.numFrames?o[0]:t.numFrames,a=null==t.hopFrames?1:t.hopFrames):(i=t.numFrames,m.util.assert(null!=i&&Number.isInteger(i)&&i>0,(function(){return"There are "+o.length+" unique lengths among the "+n.size()+" examples of this Dataset, hence numFrames is required. But it is not provided."})),m.util.assert(i<=o[0],(function(){return"numFrames ("+i+") exceeds the minimum numFrames ("+o[0]+") among the examples of the Dataset."})),a=t.hopFrames,m.util.assert(null!=a&&Number.isInteger(a)&&a>0,(function(){return"There are "+o.length+" unique lengths among the "+n.size()+" examples of this Dataset, hence hopFrames is required. But it is not provided."})));var s=null==t.normalize||t.normalize;return(0,m.tidy)((function(){for(var o,u,c,l=[],f=[],p=[],h=0;h<r.length;++h){var d=r[h];if(null==e||d===e){var g=n.label2Ids[d],v=function(r){var o,u,g=n.examples[r].spectrogram,v=g.frameSize;null==c?c=v:m.util.assert(v===c,(function(){return"Mismatch in frameSize  ("+v+" vs "+c+")"}));var y=g.data.length/v,b=null;d!==_k&&(b=null==g.keyFrameIndex?Fk(g).dataSync()[0]:g.keyFrameIndex);var x=(0,m.tensor3d)(g.data,[y,v,1]),w=Ik(y,b,i,a),E=function(n){var r=(0,m.tidy)((function(){var e=x.slice([n[0],0,0],[n[1]-n[0],-1,-1]);return s?bk(e):e}));t.getDataset?f.push(r.dataSync()):l.push(r),null==e&&p.push(h)};try{for(var C=dk(w),S=C.next();!S.done;S=C.next())E(S.value)}catch(e){o={error:e}}finally{try{S&&!S.done&&(u=C.return)&&u.call(C)}finally{if(o)throw o.error}}(0,m.dispose)(x)};try{for(var y=dk(g),b=y.next();!b.done;b=y.next())v(b.value)}catch(e){o={error:e}}finally{try{b&&!b.done&&(u=y.return)&&u.call(y)}finally{if(o)throw o.error}}}}null!=t.augmentByMixingNoiseRatio&&n.augmentByMixingNoise(t.getDataset?f:l,p,t.augmentByMixingNoiseRatio);var x=null==t.shuffle||t.shuffle;if(t.getDataset){var w=null==t.datasetBatchSize?32:t.datasetBatchSize,E=null==t.datasetValidationSplit?.15:t.datasetValidationSplit;m.util.assert(E>0&&E<1,(function(){return"Invalid dataset validation split: "+E}));var C=f.map((function(e,t){return[e,p[t]]}));m.util.shuffle(C),f=C.map((function(e){return e[0]}));var S=C.map((function(e){return e[1]})),N=function(e,t,n){var r,i,a,o,s,u,c,l;m.util.assert(n>0&&n<1,(function(){return"validationSplit is expected to be >0 and <1, but got "+n}));for(var f=!Array.isArray(e[0]),p=t,h=[],d=0;d<p.length;++d){var g=p[d];null==h[g]&&(h[g]=[]),h[g].push(d)}var v=h.length,y=[],b=[];for(h.map((function(e){return m.util.shuffle(e)})),d=0;d<v;++d)for(var x=h[d],w=Math.round(x.length*(1-n)),E=0;E<x.length;++E)E<w?y.push(x[E]):b.push(x[E]);if(f){var C=[],S=[],N=[],A=[];try{for(var k=dk(y),D=k.next();!D.done;D=k.next()){var _=D.value;C.push(e[_]),S.push(t[_])}}catch(e){r={error:e}}finally{try{D&&!D.done&&(i=k.return)&&i.call(k)}finally{if(r)throw r.error}}try{for(var M=dk(b),T=M.next();!T.done;T=M.next())_=T.value,N.push(e[_]),A.push(t[_])}catch(e){a={error:e}}finally{try{T&&!T.done&&(o=M.return)&&o.call(M)}finally{if(a)throw a.error}}return{trainXs:C,trainYs:S,valXs:N,valYs:A}}C=[],S=[],N=[],A=[];try{for(var O=dk(y),I=O.next();!I.done;I=O.next())_=I.value,C.push(e[_]),S.push(t[_])}catch(e){s={error:e}}finally{try{I&&!I.done&&(u=O.return)&&u.call(O)}finally{if(s)throw s.error}}try{for(var F=dk(b),R=F.next();!R.done;R=F.next())_=R.value,N.push(e[_]),A.push(t[_])}catch(e){c={error:e}}finally{try{R&&!R.done&&(l=F.return)&&l.call(F)}finally{if(c)throw c.error}}return{trainXs:C,trainYs:S,valXs:N,valYs:A}}(f,S,E),A=N.trainXs,k=N.trainYs,D=N.valXs,_=N.valYs,M=m.data.array(A).map((function(e){return(0,m.tensor3d)(e,[i,c,1])})),T=m.data.array(k).map((function(e){return(0,m.oneHot)([e],r.length).squeeze([0])})),O=m.data.zip({xs:M,ys:T});x&&(O=O.shuffle(f.length)),O=O.batch(w).prefetch(4);var I=m.data.array(D).map((function(e){return(0,m.tensor3d)(e,[i,c,1])})),F=m.data.array(_).map((function(e){return(0,m.oneHot)([e],r.length).squeeze([0])})),R=m.data.zip({xs:I,ys:F});return[O,R=R.batch(w).prefetch(4)]}if(x){var B=[];l.forEach((function(e,t){B.push({x:e,y:p[t]})})),m.util.shuffle(B),l=B.map((function(e){return e.x})),p=B.map((function(e){return e.y}))}var z=null==e?(0,m.oneHot)((0,m.tensor1d)(p,"int32"),r.length).asType("float32"):void 0;return{xs:(0,m.stack)(l),ys:z}}))},e.prototype.augmentByMixingNoise=function(e,t,n){var r,i;if(null==e||0===e.length)throw new Error("Cannot perform augmentation because data is null or empty");for(var a=e[0]instanceof Float32Array,o=this.getVocabulary(),s=[],u=[],c=0;c<t.length;++c)o[t[c]]===_k?s.push(c):u.push(c);if(0===s.length)throw new Error("Cannot perform augmentation by mixing with noise when there is no example with label _background_noise_");var l=[],f=[],p=function(r){var i=s[function(e,t){return Math.floor((t-0)*Math.random())+0}(0,s.length)],o=a?(0,m.tensor1d)(e[r]):e[r],u=a?(0,m.tensor1d)(e[i]):e[i],c=(0,m.tidy)((function(){return bk(o.add(u.mul(n)))}));a?l.push(c.dataSync()):l.push(c),f.push(t[r])};try{for(var h=dk(u),d=h.next();!d.done;d=h.next())p(d.value)}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}console.log("Data augmentation: mixing noise: added "+l.length+" examples"),l.forEach((function(t){return e.push(t)})),t.push.apply(t,gk(f))},e.prototype.getSortedUniqueNumFrames=function(){for(var e,t,n=new Set,r=this.getVocabulary(),i=0;i<r.length;++i){var a=r[i],o=this.label2Ids[a];try{for(var s=dk(o),u=s.next();!u.done;u=s.next()){var c=u.value,l=this.examples[c].spectrogram,f=l.data.length/l.frameSize;n.add(f)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}}var p=gk(n);return p.sort(),p},e.prototype.removeExample=function(e){if(!(e in this.examples))throw new Error("Nonexistent example UID: "+e);var t=this.examples[e].label;delete this.examples[e];var n=this.label2Ids[t].indexOf(e);this.label2Ids[t].splice(n,1),0===this.label2Ids[t].length&&delete this.label2Ids[t]},e.prototype.setExampleKeyFrameIndex=function(e,t){if(!(e in this.examples))throw new Error("Nonexistent example UID: "+e);var n=this.examples[e].spectrogram,r=n.data.length/n.frameSize;m.util.assert(t>=0&&t<r&&Number.isInteger(t),(function(){return"Invalid keyFrameIndex: "+t+". Must be >= 0, < "+r+", and an integer."})),n.keyFrameIndex=t},e.prototype.size=function(){return Object.keys(this.examples).length},e.prototype.durationMillis=function(){var e=0;for(var t in this.examples){var n=this.examples[t].spectrogram,r=23.22|n.frameDurationMillis;e+=n.data.length/n.frameSize*r}return e},e.prototype.empty=function(){return 0===this.size()},e.prototype.clear=function(){this.examples={}},e.prototype.getVocabulary=function(){var e=new Set;for(var t in this.examples){var n=this.examples[t];e.add(n.label)}var r=gk(e);return r.sort(),r},e.prototype.serialize=function(e){var t,n,r,i,a=this.getVocabulary();m.util.assert(!this.empty(),(function(){return"Cannot serialize empty Dataset"})),null!=e&&(Array.isArray(e)||(e=[e]),e.forEach((function(e){if(-1===a.indexOf(e))throw new Error('Word label "'+e+'" does not exist in the vocabulary of this dataset. The vocabulary is: '+JSON.stringify(a)+".")})));var o=[],s=[];try{for(var u=dk(a),c=u.next();!c.done;c=u.next()){var l=c.value;if(null==e||-1!==e.indexOf(l)){var f=this.label2Ids[l];try{for(var p=dk(f),h=p.next();!h.done;h=p.next()){var d=h.value,g=Tk(this.examples[d]);o.push(g.spec),s.push(g.data)}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return function(e){var t=Ak(JSON.stringify(e.manifest)),n=Ak(Dk),r=new Uint32Array([1]),i=new Uint32Array([t.byteLength]);return Nk([Nk([n,r.buffer,i.buffer]),t,e.data])}({manifest:o,data:Nk(s)})},e}();function Tk(e){var t=null!=e.rawAudio,n={label:e.label,spectrogramNumFrames:e.spectrogram.data.length/e.spectrogram.frameSize,spectrogramFrameSize:e.spectrogram.frameSize};null!=e.spectrogram.keyFrameIndex&&(n.spectrogramKeyFrameIndex=e.spectrogram.keyFrameIndex);var r=e.spectrogram.data.buffer.slice(0);return t&&(n.rawAudioNumSamples=e.rawAudio.data.length,n.rawAudioSampleRateHz=e.rawAudio.sampleRateHz,r=Nk([r,e.rawAudio.data.buffer])),{spec:n,data:r}}function Ok(e){var t={frameSize:e.spec.spectrogramFrameSize,data:new Float32Array(e.data.slice(0,4*e.spec.spectrogramFrameSize*e.spec.spectrogramNumFrames))};null!=e.spec.spectrogramKeyFrameIndex&&(t.keyFrameIndex=e.spec.spectrogramKeyFrameIndex);var n={label:e.spec.label,spectrogram:t};return null!=e.spec.rawAudioNumSamples&&(n.rawAudio={sampleRateHz:e.spec.rawAudioSampleRateHz,data:new Float32Array(e.data.slice(4*e.spec.spectrogramFrameSize*e.spec.spectrogramNumFrames))}),n}function Ik(e,t,n,r){if(m.util.assert(Number.isInteger(e)&&e>0,(function(){return"snippetLength must be a positive integer, but got "+e})),null!=t&&m.util.assert(Number.isInteger(t)&&t>=0,(function(){return"focusIndex must be a non-negative integer, but got "+t})),m.util.assert(Number.isInteger(n)&&n>0,(function(){return"windowLength must be a positive integer, but got "+n})),m.util.assert(Number.isInteger(r)&&r>0,(function(){return"windowHop must be a positive integer, but got "+r})),m.util.assert(n<=e,(function(){return"windowLength ("+n+") exceeds snippetLength ("+e+")"})),m.util.assert(t<e,(function(){return"focusIndex ("+t+") equals or exceeds snippetLength ("+e+")"})),n===e)return[[0,e]];var i=[];if(null==t){for(var a=0;a+n<=e;)i.push([a,a+n]),a+=r;return i}var o=Math.floor(n/2),s=t-o;for(s<0?s=0:s+n>e&&(s=e-n);!(s-r<0||t>=s-r+n);)s-=r;for(;s+n<=e&&!(t<s);)i.push([s,s+n]),s+=r;return i}function Fk(e){return(0,m.tidy)((function(){return function(e){return(0,m.tidy)((function(){var t=e.data.length/e.frameSize;return(0,m.tensor2d)(e.data,[t,e.frameSize]).mean(-1)}))}(e).argMax()}))}var Rk="0.3.9",Bk="tfjs-speech-commands-saved-model-metadata",zk={localStorage:"undefined"==typeof window?null:window.localStorage},Pk=.25,Lk=function(){function e(t,n,r){this.MODEL_URL_PREFIX="https://storage.googleapis.com/tfjs-models/tfjs/speech-commands/v"+function(e){return e.split(".").slice(0,2).join(".")}(Rk)+"/browser_fft",this.SAMPLE_RATE_HZ=44100,this.FFT_SIZE=1024,this.DEFAULT_SUPPRESSION_TIME_MILLIS=0,this.streaming=!1,this.transferRecognizers={},m.util.assert(null==n&&null==r||null!=n&&null!=r,(function(){return"modelURL and metadataURL must be both provided or both not provided."})),null==n?(null==t?t=e.DEFAULT_VOCABULARY_NAME:m.util.assert(-1!==e.VALID_VOCABULARY_NAMES.indexOf(t),(function(){return"Invalid vocabulary name: '"+t+"'"})),this.vocabulary=t,this.modelArtifactsOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/model.json",this.metadataOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/metadata.json"):(m.util.assert(null==t,(function(){return"vocabulary name must be null or undefined when modelURL is provided"})),this.modelArtifactsOrURL=n,this.metadataOrURL=r),this.parameters={sampleRateHz:this.SAMPLE_RATE_HZ,fftSize:this.FFT_SIZE}}return e.prototype.listen=function(e,t){return pk(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return hk(this,(function(u){switch(u.label){case 0:if(this.streaming)throw new Error("Cannot start streaming again when streaming is ongoing.");return[4,this.ensureModelLoaded()];case 1:if(u.sent(),null==t&&(t={}),n=null==t.probabilityThreshold?0:t.probabilityThreshold,t.includeEmbedding&&(n=0),m.util.assert(n>=0&&n<=1,(function(){return"Invalid probabilityThreshold value: "+n})),r=null!=t.invokeCallbackOnNoiseAndUnknown&&t.invokeCallbackOnNoiseAndUnknown,t.includeEmbedding&&(r=!0),t.suppressionTimeMillis<0)throw new Error("suppressionTimeMillis is expected to be >= 0, but got "+t.suppressionTimeMillis);return i=null==t.overlapFactor?.5:t.overlapFactor,m.util.assert(i>=0&&i<1,(function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+i})),a=function(i,a){return pk(s,void 0,void 0,(function(){var a,o,s,u,c,l,f,p,h,d,g;return hk(this,(function(v){switch(v.label){case 0:return o=bk(i),t.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,2];case 1:return v.sent(),a=mk(this.modelWithEmbeddingOutput.predict(o),2),s=a[0],u=a[1],[3,3];case 2:s=this.model.predict(o),v.label=3;case 3:return[4,s.data()];case 4:return c=v.sent(),[4,(l=s.argMax(-1)).data()];case 5:return f=v.sent()[0],p=Math.max.apply(Math,gk(c)),(0,m.dispose)([s,l,o]),p<n?[2,!1]:[3,6];case 6:return h=void 0,t.includeSpectrogram?(d={},[4,i.data()]):[3,8];case 7:d.data=v.sent(),d.frameSize=this.nonBatchInputShape[1],h=d,v.label=8;case 8:return g=!0,r||this.words[f]!==_k&&"_unknown_"!==this.words[f]||(g=!1),g&&e({scores:c,spectrogram:h,embedding:u}),[2,g]}}))}))},o=null==t.suppressionTimeMillis?this.DEFAULT_SUPPRESSION_TIME_MILLIS:t.suppressionTimeMillis,this.audioDataExtractor=new wk({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:o,spectrogramCallback:a,overlapFactor:i}),[4,this.audioDataExtractor.start(t.audioTrackConstraints)];case 2:return u.sent(),this.streaming=!0,[2]}}))}))},e.prototype.ensureModelLoaded=function(){return pk(this,void 0,void 0,(function(){var e,t,n,r,i=this;return hk(this,(function(a){switch(a.label){case 0:return null!=this.model?[2]:[4,this.ensureMetadataLoaded()];case 1:return a.sent(),"string"!=typeof this.modelArtifactsOrURL?[3,3]:[4,(0,m.loadLayersModel)(this.modelArtifactsOrURL)];case 2:return e=a.sent(),[3,5];case 3:return[4,(0,m.loadLayersModel)(m.io.fromMemory(this.modelArtifactsOrURL.modelTopology,this.modelArtifactsOrURL.weightSpecs,this.modelArtifactsOrURL.weightData))];case 4:e=a.sent(),a.label=5;case 5:if(1!==e.inputs.length)throw new Error("Expected model to have 1 input, but got a model with "+e.inputs.length+" inputs");if(4!==e.inputs[0].shape.length)throw new Error("Expected model to have an input shape of rank 4, but got an input shape of rank "+e.inputs[0].shape.length);if(1!==e.inputs[0].shape[3])throw new Error("Expected model to have an input shape with 1 as the last dimension, but got input shape"+JSON.stringify(e.inputs[0].shape[3])+"}");if(2!==(t=e.outputShape).length)throw new Error("Expected loaded model to have an output shape of rank 2,but received shape "+JSON.stringify(t));if(t[1]!==this.words.length)throw new Error("Mismatch between the last dimension of model's output shape ("+t[1]+") and number of words ("+this.words.length+").");return this.model=e,this.freezeModel(),this.nonBatchInputShape=e.inputs[0].shape.slice(1),this.elementsPerExample=1,e.inputs[0].shape.slice(1).forEach((function(e){return i.elementsPerExample*=e})),this.warmUpModel(),n=this.parameters.fftSize/this.parameters.sampleRateHz*1e3,r=e.inputs[0].shape[1],this.parameters.spectrogramDurationMillis=r*n,[2]}}))}))},e.prototype.ensureModelWithEmbeddingOutputCreated=function(){return pk(this,void 0,void 0,(function(){var e,t;return hk(this,(function(n){switch(n.label){case 0:return null!=this.modelWithEmbeddingOutput?[2]:[4,this.ensureModelLoaded()];case 1:for(n.sent(),t=this.model.layers.length-2;t>=0;--t)if("Dense"===this.model.layers[t].getClassName()){e=this.model.layers[t];break}if(null==e)throw new Error("Failed to find second last dense layer in the original model.");return this.modelWithEmbeddingOutput=(0,m.model)({inputs:this.model.inputs,outputs:[this.model.outputs[0],e.output]}),[2]}}))}))},e.prototype.warmUpModel=function(){var e=this;(0,m.tidy)((function(){for(var t=(0,m.zeros)([1].concat(e.nonBatchInputShape)),n=0;n<3;++n)e.model.predict(t)}))},e.prototype.ensureMetadataLoaded=function(){return pk(this,void 0,void 0,(function(){var e,t,n;return hk(this,(function(r){switch(r.label){case 0:return null!=this.words?[2]:"string"!=typeof this.metadataOrURL?[3,2]:[4,vk(this.metadataOrURL)];case 1:return t=r.sent(),[3,3];case 2:t=this.metadataOrURL,r.label=3;case 3:if(null==(e=t).wordLabels){if(null==(n=e.words))throw new Error('Cannot find field "words" or "wordLabels" in metadata JSON file');this.words=n}else this.words=e.wordLabels;return[2]}}))}))},e.prototype.stopListening=function(){return pk(this,void 0,void 0,(function(){return hk(this,(function(e){switch(e.label){case 0:if(!this.streaming)throw new Error("Cannot stop streaming when streaming is not ongoing.");return[4,this.audioDataExtractor.stop()];case 1:return e.sent(),this.streaming=!1,[2]}}))}))},e.prototype.isListening=function(){return this.streaming},e.prototype.wordLabels=function(){return this.words},e.prototype.params=function(){return this.parameters},e.prototype.modelInputShape=function(){if(null==this.model)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognize(), or listen().");return this.model.inputs[0].shape},e.prototype.recognize=function(e,t){return pk(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,p,h,d;return hk(this,(function(g){switch(g.label){case 0:return null==t&&(t={}),[4,this.ensureModelLoaded()];case 1:return g.sent(),null!=e?[3,3]:[4,this.recognizeOnline()];case 2:n=g.sent(),e=n.data,g.label=3;case 3:if(e instanceof m.Tensor)this.checkInputTensorShape(e),i=e,r=e.shape[0];else{if((e=e).length%this.elementsPerExample)throw new Error("The length of the input Float32Array "+e.length+" is not divisible by the number of tensor elements per per example expected by the model "+this.elementsPerExample+".");r=e.length/this.elementsPerExample,i=(0,m.tensor4d)(e,[r].concat(this.nonBatchInputShape))}return o={scores:null},t.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,5];case 4:return g.sent(),s=this.modelWithEmbeddingOutput.predict(i),a=s[0],o.embedding=s[1],[3,6];case 5:a=this.model.predict(i),g.label=6;case 6:return 1!==r?[3,8]:(u=o,[4,a.data()]);case 7:return u.scores=g.sent(),[3,10];case 8:return c=(0,m.unstack)(a),l=c.map((function(e){return e.data()})),f=o,[4,Promise.all(l)];case 9:f.scores=g.sent(),(0,m.dispose)(c),g.label=10;case 10:return t.includeSpectrogram?(p=o,h={},e instanceof m.Tensor?[4,e.data()]:[3,12]):[3,14];case 11:return d=g.sent(),[3,13];case 12:d=e,g.label=13;case 13:p.spectrogram=(h.data=d,h.frameSize=this.nonBatchInputShape[1],h),g.label=14;case 14:return[2,o]}}))}))},e.prototype.recognizeOnline=function(){return pk(this,void 0,void 0,(function(){var e=this;return hk(this,(function(t){return[2,new Promise((function(t,n){e.audioDataExtractor=new wk({sampleRateHz:e.parameters.sampleRateHz,numFramesPerSpectrogram:e.nonBatchInputShape[0],columnTruncateLength:e.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(n){return pk(e,void 0,void 0,(function(){var e,r,i;return hk(this,(function(a){switch(a.label){case 0:return e=bk(n),[4,this.audioDataExtractor.stop()];case 1:return a.sent(),r=t,i={},[4,e.data()];case 2:return r.apply(void 0,[(i.data=a.sent(),i.frameSize=this.nonBatchInputShape[1],i)]),e.dispose(),[2,!1]}}))}))},overlapFactor:0}),e.audioDataExtractor.start()}))]}))}))},e.prototype.createTransfer=function(e){if(null==this.model)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognizer(), or listen().");m.util.assert(null!=e&&"string"==typeof e&&e.length>1,(function(){return"Expected the name for a transfer-learning recognized to be a non-empty string, but got "+JSON.stringify(e)})),m.util.assert(null==this.transferRecognizers[e],(function(){return"There is already a transfer-learning model named '"+e+"'"}));var t=new jk(e,this.parameters,this.model);return this.transferRecognizers[e]=t,t},e.prototype.freezeModel=function(){var e,t;try{for(var n=dk(this.model.layers),r=n.next();!r.done;r=n.next())r.value.trainable=!1}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.checkInputTensorShape=function(e){var t=this.model.inputs[0].shape.length;if(e.shape.length!==t)throw new Error("Expected input Tensor to have rank "+t+", but got rank "+e.shape.length+" that differs ");var n=e.shape.slice(1),r=this.model.inputs[0].shape.slice(1);if(!m.util.arraysEqual(n,r))throw new Error("Expected input to have shape [null,"+r+"], but got shape [null,"+n+"]")},e.VALID_VOCABULARY_NAMES=["18w","directional4w"],e.DEFAULT_VOCABULARY_NAME="18w",e}(),jk=function(e){function t(t,n,r){var i=e.call(this)||this;return i.name=t,i.parameters=n,i.baseModel=r,m.util.assert(null!=t&&"string"==typeof t&&t.length>0,(function(){return"The name of a transfer model must be a non-empty string, but got "+JSON.stringify(t)})),i.nonBatchInputShape=i.baseModel.inputs[0].shape.slice(1),i.words=null,i.dataset=new Mk,i}return function(e,t){function n(){this.constructor=e}lk(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.collectExample=function(e,t){return pk(this,void 0,void 0,(function(){var n,r,i,a,o=this;return hk(this,(function(s){if(m.util.assert(!this.streaming,(function(){return"Cannot start collection of transfer-learning example because a streaming recognition or transfer-learning example collection is ongoing"})),m.util.assert(null!=e&&"string"==typeof e&&e.length>0,(function(){return"Must provide a non-empty string when collecting transfer-learning example"})),null==t&&(t={}),null!=t.durationMultiplier&&null!=t.durationSec)throw new Error("durationMultiplier and durationSec are mutually exclusive, but are both specified.");return null!=t.durationSec?(m.util.assert(t.durationSec>0,(function(){return"Expected durationSec to be > 0, but got "+t.durationSec})),r=this.parameters.fftSize/this.parameters.sampleRateHz,n=Math.ceil(t.durationSec/r)):null!=t.durationMultiplier?(m.util.assert(t.durationMultiplier>=1,(function(){return"Expected duration multiplier to be >= 1, but got "+t.durationMultiplier})),n=Math.round(this.nonBatchInputShape[0]*t.durationMultiplier)):n=this.nonBatchInputShape[0],null!=t.snippetDurationSec&&(m.util.assert(t.snippetDurationSec>0,(function(){return"snippetDurationSec is expected to be > 0, but got "+t.snippetDurationSec})),m.util.assert(null!=t.onSnippet,(function(){return"onSnippet must be provided if snippetDurationSec is provided."}))),null!=t.onSnippet&&m.util.assert(null!=t.snippetDurationSec,(function(){return"snippetDurationSec must be provided if onSnippet is provided."})),i=this.parameters.fftSize/this.parameters.sampleRateHz,a=i*n,this.streaming=!0,[2,new Promise((function(r){var i=null==t.snippetDurationSec?1:t.snippetDurationSec/a,s=1-i,u=Math.round(1/i),c=0,l=-1,f=[];o.audioDataExtractor=new wk({sampleRateHz:o.parameters.sampleRateHz,numFramesPerSpectrogram:n,columnTruncateLength:o.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(n,i){return pk(o,void 0,void 0,(function(){var a,o,s,p,h,d,g,v,y,b,x,w,E,C,S,N,A,k,D,_;return hk(this,(function(M){switch(M.label){case 0:return null!=t.onSnippet?[3,7]:(a=bk(n),s=(o=this.dataset).addExample,p={label:e},h={},[4,a.data()]);case 1:return p.spectrogram=(h.data=M.sent(),h.frameSize=this.nonBatchInputShape[1],h),t.includeRawAudio?(g={},[4,i.data()]):[3,3];case 2:return g.data=M.sent(),g.sampleRateHz=this.audioDataExtractor.sampleRateHz,d=g,[3,4];case 3:d=void 0,M.label=4;case 4:return s.apply(o,[(p.rawAudio=d,p)]),a.dispose(),[4,this.audioDataExtractor.stop()];case 5:return M.sent(),this.streaming=!1,this.collateTransferWords(),v=r,y={},[4,n.data()];case 6:return v.apply(void 0,[(y.data=M.sent(),y.frameSize=this.nonBatchInputShape[1],y)]),[3,13];case 7:return[4,n.data()];case 8:for(b=M.sent(),-1===l&&(l=b.length),x=l-1;0!==b[x]&&x>=0;)x--;return w=l-x-1,l=x+1,E=b.slice(b.length-w,b.length),f.push(E),null!=t.onSnippet&&t.onSnippet({data:E,frameSize:this.nonBatchInputShape[1]}),c++!==u?[3,13]:[4,this.audioDataExtractor.stop()];case 9:return M.sent(),this.streaming=!1,this.collateTransferWords(),C=function(e){if(e.length<2)throw new Error("Cannot normalize a Float32Array with fewer than 2 elements.");return null==yk&&(yk=(0,m.backend)().epsilon()),(0,m.tidy)((function(){var t=(0,m.moments)((0,m.tensor1d)(e)),n=t.mean,r=t.variance,i=n.arraySync(),a=Math.sqrt(r.arraySync()),o=Array.from(e).map((function(e){return(e-i)/(a+yk)}));return new Float32Array(o)}))}(function(e){var t=0;e.forEach((function(e){return t+=e.length}));var n=new Float32Array(t),r=0;return e.forEach((function(e){n.set(e,r),r+=e.length})),n}(f)),S={data:C,frameSize:this.nonBatchInputShape[1]},A=(N=this.dataset).addExample,k={label:e,spectrogram:S},t.includeRawAudio?(_={},[4,i.data()]):[3,11];case 10:return _.data=M.sent(),_.sampleRateHz=this.audioDataExtractor.sampleRateHz,D=_,[3,12];case 11:D=void 0,M.label=12;case 12:A.apply(N,[(k.rawAudio=D,k)]),r(S),M.label=13;case 13:return[2,!1]}}))}))},overlapFactor:s,includeRawAudio:t.includeRawAudio}),o.audioDataExtractor.start(t.audioTrackConstraints)}))]}))}))},t.prototype.clearExamples=function(){var e=this;m.util.assert(null!=this.words&&this.words.length>0&&!this.dataset.empty(),(function(){return"No transfer learning examples exist for model name "+e.name})),this.dataset.clear(),this.words=null},t.prototype.countExamples=function(){if(this.dataset.empty())throw new Error("No examples have been collected for transfer-learning model named '"+this.name+"' yet.");return this.dataset.getExampleCounts()},t.prototype.getExamples=function(e){return this.dataset.getExamples(e)},t.prototype.setExampleKeyFrameIndex=function(e,t){this.dataset.setExampleKeyFrameIndex(e,t)},t.prototype.removeExample=function(e){this.dataset.removeExample(e),this.collateTransferWords()},t.prototype.isDatasetEmpty=function(){return this.dataset.empty()},t.prototype.loadExamples=function(e,t){var n,r,i,a;void 0===t&&(t=!1);var o=new Mk(e);t&&this.clearExamples();var s=o.getVocabulary();try{for(var u=dk(s),c=u.next();!c.done;c=u.next()){var l=c.value,f=o.getExamples(l);try{for(var p=dk(f),h=p.next();!h.done;h=p.next()){var d=h.value;this.dataset.addExample(d.example)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}this.collateTransferWords()},t.prototype.serializeExamples=function(e){return this.dataset.serialize(e)},t.prototype.collateTransferWords=function(){this.words=this.dataset.getVocabulary()},t.prototype.collectTransferDataAsTensors=function(e,t){var n=this.nonBatchInputShape[0];e=e||Pk;var r=Math.round(e*n),i=this.dataset.getData(null,fk({numFrames:n,hopFrames:r},t));return{xs:i.xs,ys:i.ys}},t.prototype.collectTransferDataAsTfDataset=function(e,t,n,r){void 0===t&&(t=.15),void 0===n&&(n=32);var i=this.nonBatchInputShape[0];e=e||Pk;var a=Math.round(e*i);return this.dataset.getData(null,fk({numFrames:i,hopFrames:a,getDataset:!0,datasetBatchSize:n,datasetValidationSplit:t},r))},t.prototype.train=function(e){return pk(this,void 0,void 0,(function(){var t,n=this;return hk(this,(function(r){switch(r.label){case 0:return m.util.assert(null!=this.words&&this.words.length>0,(function(){return"Cannot train transfer-learning model '"+n.name+"' because no transfer learning example has been collected."})),m.util.assert(this.words.length>1,(function(){return"Cannot train transfer-learning model '"+n.name+"' because only 1 word label ('"+JSON.stringify(n.words)+"') has been collected for transfer learning. Requires at least 2."})),null!=e.fineTuningEpochs&&m.util.assert(e.fineTuningEpochs>=0&&Number.isInteger(e.fineTuningEpochs),(function(){return"If specified, fineTuningEpochs must be a non-negative integer, but received "+e.fineTuningEpochs})),null==e&&(e={}),null==this.model&&this.createTransferModelFromBaseModel(),this.secondLastBaseDenseLayer.trainable=!1,this.model.compile({loss:"categoricalCrossentropy",optimizer:e.optimizer||"sgd",metrics:["acc"]}),t=null==e.fitDatasetDurationMillisThreshold?6e4:e.fitDatasetDurationMillisThreshold,this.dataset.durationMillis()>t?(console.log("Detected large dataset: total duration = "+this.dataset.durationMillis()+" ms > "+t+" ms. Training transfer model using fitDataset() instead of fit()"),[4,this.trainOnDataset(e)]):[3,2];case 1:case 3:return[2,r.sent()];case 2:return[4,this.trainOnTensors(e)]}}))}))},t.prototype.trainOnDataset=function(e){return pk(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c;return hk(this,(function(l){switch(l.label){case 0:return m.util.assert(e.epochs>0,(function(){return"Invalid config.epochs"})),t=null==e.batchSize?32:e.batchSize,n=e.windowHopRatio||Pk,r=mk(this.collectTransferDataAsTfDataset(n,e.validationSplit,t,{augmentByMixingNoiseRatio:e.augmentByMixingNoiseRatio}),2),i=r[0],a=r[1],o=m.util.now(),[4,this.model.fitDataset(i,{epochs:e.epochs,validationData:e.validationSplit>0?a:null,callbacks:null==e.callback?null:[e.callback]})];case 1:return s=l.sent(),console.log("fitDataset() took "+(m.util.now()-o).toFixed(2)+" ms"),null!=e.fineTuningEpochs&&e.fineTuningEpochs>0?(u=m.util.now(),[4,this.fineTuningUsingTfDatasets(e,i,a)]):[3,3];case 2:return c=l.sent(),console.log("fitDataset() (fine-tuning) took "+(m.util.now()-u).toFixed(2)+" ms"),[2,[s,c]];case 3:return[2,s]}}))}))},t.prototype.trainOnTensors=function(e){return pk(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c,l;return hk(this,(function(f){switch(f.label){case 0:t=e.windowHopRatio||Pk,n=this.collectTransferDataAsTensors(t,{augmentByMixingNoiseRatio:e.augmentByMixingNoiseRatio}),r=n.xs,i=n.ys,console.log("Training data: xs.shape = "+r.shape+", ys.shape = "+i.shape),f.label=1;case 1:return f.trys.push([1,,6,7]),null!=e.validationSplit?(u=function(e,t,n){return m.util.assert(n>0&&n<1,(function(){return"validationSplit is expected to be >0 and <1, but got "+n})),(0,m.tidy)((function(){for(var r=t.argMax(-1).dataSync(),i=[],a=0;a<r.length;++a){var o=r[a];null==i[o]&&(i[o]=[]),i[o].push(a)}var s=i.length,u=[],c=[];for(i.map((function(e){return m.util.shuffle(e)})),a=0;a<s;++a)for(var l=i[a],f=Math.round(l.length*(1-n)),p=0;p<l.length;++p)p<f?u.push(l[p]):c.push(l[p]);return{trainXs:(0,m.gather)(e,u),trainYs:(0,m.gather)(t,u),valXs:(0,m.gather)(e,c),valYs:(0,m.gather)(t,c)}}))}(r,i,e.validationSplit),a=u.trainXs,o=u.trainYs,s=[u.valXs,u.valYs]):(a=r,o=i),[4,this.model.fit(a,o,{epochs:null==e.epochs?20:e.epochs,validationData:s,batchSize:e.batchSize,callbacks:null==e.callback?null:[e.callback]})];case 2:return c=f.sent(),null!=e.fineTuningEpochs&&e.fineTuningEpochs>0?[4,this.fineTuningUsingTensors(e,a,o,s)]:[3,4];case 3:return l=f.sent(),[2,[c,l]];case 4:return[2,c];case 5:return[3,7];case 6:return(0,m.dispose)([r,i,a,o,s]),[7];case 7:return[2]}}))}))},t.prototype.fineTuningUsingTfDatasets=function(e,t,n){return pk(this,void 0,void 0,(function(){var r,i,a;return hk(this,(function(o){switch(o.label){case 0:return r=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,i=null==e.fineTuningOptimizer?"sgd":e.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:i,metrics:["acc"]}),[4,this.model.fitDataset(t,{epochs:e.fineTuningEpochs,validationData:n,callbacks:null==e.callback?null:[e.callback]})];case 1:return a=o.sent(),this.secondLastBaseDenseLayer.trainable=r,[2,a]}}))}))},t.prototype.fineTuningUsingTensors=function(e,t,n,r){return pk(this,void 0,void 0,(function(){var i,a,o;return hk(this,(function(s){switch(s.label){case 0:return i=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,a=null==e.fineTuningOptimizer?"sgd":e.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:a,metrics:["acc"]}),[4,this.model.fit(t,n,{epochs:e.fineTuningEpochs,validationData:r,batchSize:e.batchSize,callbacks:null==e.fineTuningCallback?null:[e.fineTuningCallback]})];case 1:return o=s.sent(),this.secondLastBaseDenseLayer.trainable=i,[2,o]}}))}))},t.prototype.evaluate=function(e){return pk(this,void 0,void 0,(function(){var t=this;return hk(this,(function(n){return m.util.assert(null!=e.wordProbThresholds&&e.wordProbThresholds.length>0,(function(){return"Received null or empty wordProbThresholds"})),m.util.assert(this.words[0]===_k,(function(){return"Cannot perform evaluation when the first tag is not _background_noise_"})),[2,(0,m.tidy)((function(){for(var n=[],r=0,i=t.collectTransferDataAsTensors(e.windowHopRatio),a=i.xs,o=i.ys.argMax(-1).dataSync(),s=t.model.predict(a),u=s.slice([0,1],[s.shape[0],s.shape[1]-1]).max(-1),c=s.shape[0],l=0;l<e.wordProbThresholds.length;++l){for(var f=e.wordProbThresholds[l],p=u.greater((0,m.scalar)(f)).dataSync(),h=0,d=0,g=0,v=0,y=0;y<c;++y)0===o[y]?(h++,p[y]&&g++):(d++,p[y]&&v++);var b=g/h,x=v/d;n.push({probThreshold:f,fpr:b,tpr:x}),console.log("ROC thresh="+f+": fpr="+b.toFixed(4)+", tpr="+x.toFixed(4)),l>0&&(r+=Math.abs(n[l-1].fpr-n[l].fpr)*(n[l-1].tpr+n[l].tpr)/2)}return{rocCurve:n,auc:r}}))]}))}))},t.prototype.createTransferModelFromBaseModel=function(){var e=this;m.util.assert(null!=this.words,(function(){return"No word example is available for tranfer-learning model of name "+e.name}));for(var t=this.baseModel.layers,n=t.length-2;n>=0&&"dense"!==t[n].getClassName().toLowerCase();)n--;if(n<0)throw new Error("Cannot find a hidden dense layer in the base model.");this.secondLastBaseDenseLayer=t[n];var r=this.secondLastBaseDenseLayer.output;this.transferHead=(0,m.sequential)(),this.transferHead.add(m.layers.dense({units:this.words.length,activation:"softmax",inputShape:r.shape.slice(1),name:"NewHeadDense"}));var i=this.transferHead.apply(r);this.model=(0,m.model)({inputs:this.baseModel.inputs,outputs:i})},t.prototype.modelInputShape=function(){return this.baseModel.inputs[0].shape},t.prototype.getMetadata=function(){return{tfjsSpeechCommandsVersion:Rk,modelName:this.name,timeStamp:(new Date).toISOString(),wordLabels:this.wordLabels()}},t.prototype.save=function(e){return pk(this,void 0,void 0,(function(){var t,n,r;return hk(this,(function(i){return t=null!=e,e=e||Uk(this.name),t||(n=zk.localStorage.getItem(Bk),(r=null==n?{}:JSON.parse(n))[this.name]=this.getMetadata(),zk.localStorage.setItem(Bk,JSON.stringify(r))),console.log("Saving model to "+e),[2,this.model.save(e)]}))}))},t.prototype.load=function(e){return pk(this,void 0,void 0,(function(){var t,n,r;return hk(this,(function(i){switch(i.label){case 0:if(t=null!=e,e=e||Uk(this.name),!t){if(null==(n=JSON.parse(zk.localStorage.getItem(Bk)))||null==n[this.name])throw new Error("Cannot find metadata for transfer model named "+this.name+'"');this.words=n[this.name].wordLabels,console.log("Loaded word list for model named "+this.name+": "+this.words)}return r=this,[4,(0,m.loadLayersModel)(e)];case 1:return r.model=i.sent(),console.log("Loaded model from "+e+":"),this.model.summary(),[2]}}))}))},t.prototype.createTransfer=function(e){throw new Error("Creating transfer-learned recognizer from a transfer-learned recognizer is not supported.")},t}(Lk);function Uk(e){return"indexeddb://tfjs-speech-commands-model/"+e}function qk(e,t,n,r){if(m.util.assert(null==n&&null==r||null!=n&&null!=r,(function(){return"customModelURL and customMetadataURL must be both provided or both not provided."})),null!=n&&m.util.assert(null==t,(function(){return"vocabulary name must be null or undefined when modelURL is provided."})),"BROWSER_FFT"===e)return new Lk(t,n,r);throw"SOFT_FFT"===e?new Error("SOFT_FFT SpeechCommandRecognizer has not been implemented yet."):new Error("Invalid fftType: '"+e+"'")}class Wk{constructor(e){this.options=e}async load(e){if(e){const t=e.split("/"),n=`${t.slice(0,t.length-1).join("/")}/metadata.json`;this.model=qk("BROWSER_FFT",void 0,e,n)}else this.model=qk("BROWSER_FFT");await this.model.ensureModelLoaded(),this.allLabels=this.model.wordLabels()}classify(e=this.allLabels.length,t){return this.model.listen((n=>{if(n.scores){const r=qA(n.scores,e,this.allLabels).map((e=>({label:e.className,confidence:e.probability})));return t(null,r)}return t(`ERROR: Cannot find scores in result: ${n}`)}),this.options).catch((e=>t(`ERROR: ${e.message}`)))}}async function Vk(e,t){const n=new Wk(e);return await n.load(t),n}const $k=["speechcommands18w"];class Hk{constructor(e,t,n){this.model=null,this.options=t,"string"==typeof e&&($k.includes(e)?(this.modelName=e,this.modelUrl=null,"speechcommands18w"===this.modelName?this.modelToUse=c:this.modelToUse=null):(this.modelToUse=c,this.modelUrl=e)),this.ready=kA(this.loadModel(t,this.modelUrl),n)}async loadModel(e){return this.model=await this.modelToUse.load(e,this.modelUrl),this}async classifyInternal(e,t){return await this.ready,await m.nextFrame(),this.model.classify(e,t)}async classify(e=null,t){let n,r=this.topk;return"number"==typeof e?r=e:"function"==typeof e&&(n=e),"function"==typeof t&&(n=t),this.classifyInternal(r,n)}}function Gk(e,t){return null==e&&null==t?null:null==e?t.clone():null===t?e.clone():e.concat(t,0)}function Kk(e,t){for(var n=[],r=0;r<e.length;r++)n.push({value:e[r],index:r});n.sort((function(e,t){return t.value-e.value}));var i=new Float32Array(t),a=new Int32Array(t);for(r=0;r<t;r++)i[r]=n[r].value,a[r]=n[r].index;return{values:i,indices:a}}var Xk=function(){function e(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return e.prototype.addExample=function(e,t){var n=this;if(null==this.exampleShape&&(this.exampleShape=e.shape),!OA.util.arraysEqual(this.exampleShape,e.shape))throw new Error("Example shape provided, "+e.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),t in this.labelToClassId||(this.labelToClassId[t]=this.nextClassId++),(0,OA.tidy)((function(){var r=n.normalizeVectorToUnitLength(e.flatten()),i=r.shape[0];if(null==n.classDatasetMatrices[t])n.classDatasetMatrices[t]=r.as2D(1,i);else{var a=n.classDatasetMatrices[t].as2D(n.classExampleCount[t],i).concat(r.as2D(1,i),0);n.classDatasetMatrices[t].dispose(),n.classDatasetMatrices[t]=a}(0,OA.keep)(n.classDatasetMatrices[t]),null==n.classExampleCount[t]&&(n.classExampleCount[t]=0),n.classExampleCount[t]++}))},e.prototype.similarities=function(e){var t=this;return(0,OA.tidy)((function(){var n=t.normalizeVectorToUnitLength(e.flatten()),r=n.shape[0];if(null==t.trainDatasetMatrix){var i=null;for(var a in t.classDatasetMatrices)i=Gk(i,t.classDatasetMatrices[a]);t.trainDatasetMatrix=i}if(null==t.trainDatasetMatrix)return console.warn("Cannot predict without providing training examples."),null;(0,OA.keep)(t.trainDatasetMatrix);var o=t.getNumExamples();return t.trainDatasetMatrix.as2D(o,r).matMul(n.as2D(r,1)).as1D()}))},e.prototype.predictClass=function(e,t){return void 0===t&&(t=3),function(e,t,n,r){return new(n||(n=Promise))((function(t,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?t(e.value):new n((function(t){t(e.value)})).then(a,o)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function(){var n,r,i,a,o=this;return function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(s){switch(s.label){case 0:if(t<1)throw new Error("Please provide a positive integer k value to predictClass.");if(0===this.getNumExamples())throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return n=(0,OA.tidy)((function(){return o.similarities(e).asType("float32")})),r=Math.min(t,this.getNumExamples()),a=Kk,[4,n.data()];case 1:return i=a.apply(void 0,[s.sent(),r]).indices,n.dispose(),[2,this.calculateTopClass(i,r)]}}))}))},e.prototype.clearClass=function(e){if(null==this.classDatasetMatrices[e])throw new Error("Cannot clear invalid class "+e);delete this.classDatasetMatrices[e],delete this.classExampleCount[e],this.clearTrainDatasetMatrix()},e.prototype.clearAllClasses=function(){for(var e in this.classDatasetMatrices)this.clearClass(e)},e.prototype.getClassExampleCount=function(){return this.classExampleCount},e.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},e.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},e.prototype.setClassifierDataset=function(e){for(var t in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=e,e)this.classExampleCount[t]=e[t].shape[0]},e.prototype.calculateTopClass=function(e,t){var n,r={};if(null==e)return{classIndex:this.labelToClassId[n],label:n,confidences:r};var i={},a=0;for(var o in this.classDatasetMatrices)a+=this.classExampleCount[o],i[o]=a;var s={};for(var o in this.classDatasetMatrices)s[o]=0;for(var u=0;u<e.length;u++){var c=e[u];for(var o in this.classDatasetMatrices)if(c<i[o]){s[o]++;break}}var l=0;for(var o in this.classDatasetMatrices){var f=s[o]/t;f>l&&(l=f,n=o),r[o]=f}return{classIndex:this.labelToClassId[n],label:n,confidences:r}},e.prototype.clearTrainDatasetMatrix=function(){null!=this.trainDatasetMatrix&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},e.prototype.normalizeVectorToUnitLength=function(e){return(0,OA.tidy)((function(){var t=e.norm();return(0,OA.div)(e,t)}))},e.prototype.getNumExamples=function(){var e=0;for(var t in this.classDatasetMatrices)e+=this.classExampleCount[t];return e},e.prototype.dispose=function(){for(var e in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[e].dispose()},e}();const Yk=async(e,t,n)=>{const r=document.createElement("a");r.style.display="none",document.body.appendChild(r);const i=new Blob([e],{type:n});r.href=URL.createObjectURL(i),r.download=t,r.click()};class Jk{constructor(){this.knnClassifier=new Xk,this.mapStringToIndex=[]}addExample(e,t){let n,r;"string"==typeof t?n=this.mapStringToIndex.includes(t)?this.mapStringToIndex.indexOf(t):this.mapStringToIndex.push(t)-1:"number"==typeof t&&(n=t),r=Array.isArray(e)?m.tensor(e):e,this.knnClassifier.addExample(r,n)}async classify(e,t,n){let r,i=3,a=n;return"number"==typeof t?i=t:"function"==typeof t&&(a=t),r=Array.isArray(e)?m.tensor(e):e,kA(this.classifyInternal(r,i),a)}async classifyInternal(e,t){if(this.knnClassifier.getNumClasses()<=0)throw new Error("There is no example in any class");{const n=await this.knnClassifier.predictClass(e,t);if(this.mapStringToIndex.length>0){if(n.classIndex||0===n.classIndex){const e=this.mapStringToIndex[n.classIndex];e&&(n.label=e)}if(n.confidences){n.confidencesByLabel={};const{confidences:e}=n;Object.keys(e).forEach((t=>{const r=this.mapStringToIndex[t];n.confidencesByLabel[r]=e[t]}))}}return n}}clearLabel(e){let t;"string"==typeof e?this.mapStringToIndex.includes(e)&&(t=this.mapStringToIndex.indexOf(e)):"number"==typeof e&&(t=e),this.knnClassifier.clearClass(t)}clearAllLabels(){this.mapStringToIndex=[],this.knnClassifier.clearAllClasses()}getCountByLabel(){const e=this.knnClassifier.getClassExampleCount();if(this.mapStringToIndex.length>0){const t={};return Object.keys(e).forEach((n=>{if(this.mapStringToIndex[n]){const r=this.mapStringToIndex[n];t[r]=e[n]}})),t}return e}getCount(){return this.knnClassifier.getClassExampleCount()}getClassifierDataset(){return this.knnClassifier.getClassifierDataset()}setClassifierDataset(e){this.knnClassifier.setClassifierDataset(e)}getNumLabels(){return this.knnClassifier.getNumClasses()}dispose(){this.knnClassifier.dispose()}async save(e){const t=this.knnClassifier.getClassifierDataset();this.mapStringToIndex.length>0&&Object.keys(t).forEach((e=>{this.mapStringToIndex[e]&&(t[e].label=this.mapStringToIndex[e])}));const n=Object.keys(t).map((e=>{const n=t[e];return n?n.dataSync():null}));let r="myKNN.json";e&&(r=e.endsWith(".json")?e:`${e}.json`),await Yk(JSON.stringify({dataset:t,tensors:n}),r,"application/octet-stream")}async load(e,t){let n;if(n="object"==typeof e?e:await(async(e,t)=>MA().get(e).then((e=>e.data)).then((e=>e)).catch((e=>{throw console.error(`There has been a problem loading the file: ${e.message}`),e})))(e),n){const{dataset:e,tensors:r}=n;this.mapStringToIndex=Object.keys(e).map((t=>e[t].label));const i=r.map(((t,n)=>{if(t){const r=Object.keys(t).map((e=>t[e]));return m.tensor(r,e[n].shape,e[n].dtype)}return null})).reduce(((e,t,n)=>(e[n]=t,e)),{});this.knnClassifier.setClassifierDataset(i),t&&t()}}}const Zk=class{constructor(e,t){this.videoElt=null,this.size=t,this.videoReady=!1,e instanceof HTMLVideoElement?this.videoElt=e:null!==e&&"object"==typeof e&&e.elt instanceof HTMLVideoElement&&(this.videoElt=e.elt)}async loadVideo(){let e;return new Promise((t=>{this.video=document.createElement("video");const n=navigator.userAgent;e=n.indexOf("Firefox")>-1?this.videoElt.mozCaptureStream():this.videoElt.captureStream(),this.video.srcObject=e,this.video.width=this.size,this.video.height=this.size,this.video.autoplay=!0,this.video.playsinline=!0,this.video.muted=!0;const r=this.video.play();void 0!==r&&r.then((()=>{t(this.video)}))}))}},Qk=224,eD=[Qk,Qk],tD={1:{.25:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",.5:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",.75:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",1:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1"},2:{.5:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",.75:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",1:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2"}},nD={1:"module_apply_default/MobilenetV1/Logits/global_pool",2:"module_apply_default/MobilenetV2/Logits/AvgPool"},rD=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","sofa","pottedplant","bed","diningtable","toilet","tvmonitor","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];function iD(e){return!!new RegExp("^(?:[a-z]+:)?//","i").test(e)}const aD={isAbsoluteURL:iD,getModelPath:function(e){return iD(e)?e:window.location.pathname+e}},oD=(e,t)=>{const n=Math.min(e[3],t[3])-Math.max(e[1],t[1]),r=Math.min(e[2],t[2])-Math.max(e[0],t[0]);return n<0||r<0?0:n*r},sD=(e,t)=>oD(e,t)/((e,t)=>{const n=oD(e,t);return(e[3]-e[1])*(e[2]-e[0])+(t[3]-t[1])*(t[2]-t[0])-n})(e,t),uD=416;class cD extends Zk{constructor(e,t,n){super(e,uD),this.modelUrl=t.modelUrl||"https://raw.githubusercontent.com/ml5js/ml5-data-and-training/master/models/YOLO/model.json",this.filterBoxesThreshold=t.filterBoxesThreshold||.01,this.IOUThreshold=t.IOUThreshold||.4,this.classProbThreshold=t.classProbThreshold||.4,this.modelReady=!1,this.isPredicting=!1,this.callback=n,this.ready=kA(this.loadModel(),this.callback),t.disableDeprecationNotice||console.warn("WARNING! Function YOLO has been deprecated, please use the new ObjectDetector function instead")}async loadModel(){if(this.videoElt&&!this.video&&(this.video=await this.loadVideo()),!0===aD.isAbsoluteURL(this.modelUrl))this.model=await m.loadLayersModel(this.modelUrl);else{const e=aD.getModelPath(this.modelUrl);this.modelUrl=`${e}/model.json`,this.model=await m.loadLayersModel(this.modelUrl)}return this.modelReady=!0,this}async detect(e,t){let n;await this.ready;let r=t;if(rk(e))n=e;else if("object"==typeof e&&rk(e.elt))n=e.elt;else if("object"==typeof e&&rk(e.canvas))n=e.canvas;else{if("function"!=typeof e)throw new Error("Detection subject not supported");n=this.video,r=e}return kA(this.detectInternal(n),r)}async detectInternal(e){await this.ready,await m.nextFrame();const t=m.tensor2d([[.57273,.677385],[1.87446,2.06253],[3.33843,5.47434],[7.88282,3.52778],[9.77052,9.16828]]);this.isPredicting=!0;const[n,r,i]=m.tidy((()=>{const n=nk(e,[uD,uD]),r=this.model.predict(n),[i,a,o,s]=(u=r,c=t,80,m.tidy((()=>{const e=c.shape[0],t=m.reshape(c,[1,1,e,2]);let n=u.shape.slice(1,3);const r=n[0],i=n[1];let a=m.range(0,n[0]),o=m.range(0,n[1]);a=m.tile(a,[n[1]]),o=m.tile(m.expandDims(o,0),[n[0],1]),o=m.transpose(o).flatten();let s=m.transpose(m.stack([a,o]));s=m.reshape(s,[n[0],n[1],1,2]),s=m.cast(s,u.dtype),u=m.reshape(u,[n[0],n[1],e,85]),n=m.cast(m.reshape(m.tensor1d(n),[1,1,1,2]),u.dtype);let l=m.sigmoid(u.slice([0,0,0,0],[r,i,e,2])),f=m.exp(u.slice([0,0,0,2],[r,i,e,2]));const p=m.sigmoid(u.slice([0,0,0,4],[r,i,e,1])),h=m.softmax(u.slice([0,0,0,5],[r,i,e,80]));return l=m.div(m.add(l,s),n),f=m.div(m.mul(f,t),n),[l,f,p,h]})));var u,c;const l=((e,t)=>m.tidy((()=>{const n=m.tensor1d([2]),r=m.sub(e,m.div(t,n)),i=m.add(e,m.div(t,n)),a=[r.shape[0],r.shape[1],r.shape[2],1];return m.concat([r.slice([0,0,0,1],a),r.slice([0,0,0,0],a),i.slice([0,0,0,1],a),i.slice([0,0,0,0],a)],3)})))(i,a);return[l,o,s]})),[a,o,s]=await async function(e,t,n,r){return m.tidy((()=>{const i=m.mul(t,n),a=m.argMax(i,-1),o=m.max(i,-1),s=m.greaterEqual(o,m.scalar(r)).dataSync(),u=[];for(let e=0;e<s.length;e+=1)s[e]&&u.push(e);if(0===u.length)return[null,null,null];const c=m.tensor1d(u,"int32");return[m.gather(e.reshape([s.length,4]),c),m.gather(o.flatten(),c),m.gather(a.flatten(),c)]}))}(n,r,i,this.filterBoxesThreshold);return n.dispose(),r.dispose(),i.dispose(),null==a?[]:m.tidy((()=>{const e=m.scalar(uD),n=m.scalar(uD),r=m.stack([n,e,n,e]).reshape([1,4]),i=m.mul(a,r),u=i.dataSync(),c=o.dataSync(),[l,f,p]=((e,t,n)=>m.tidy((()=>{const r=[];for(let n=0;n<t.length;n+=1)r.push([t[n],[e[4*n],e[4*n+1],e[4*n+2],e[4*n+3]],n]);const i=r.sort(((e,t)=>t[0]-e[0])),a=[];return i.forEach((e=>{let t=!0;for(let r=0;r<a.length;r+=1)if(sD(e[1],a[r][1])>n){t=!1;break}t&&a.push(e)})),[a.map((e=>e[2])),a.map((e=>e[1])),a.map((e=>e[0]))]})))(u,c,this.IOUThreshold),h=s.gather(m.tensor1d(l,"int32")).dataSync(),d=[];return h.forEach(((e,t)=>{const n=p[t];if(n<this.classProbThreshold)return;const r=rD[e];let[i,a,o,s]=f[t];i=Math.max(0,i),a=Math.max(0,a),o=Math.min(uD,o)-i,s=Math.min(uD,s)-a;const u={label:r,confidence:n,x:a,y:i,width:s,height:o,normalized:{x:a/uD,y:i/uD,width:s/uD,height:o/uD}};d.push(u)})),this.isPredicting=!1,e.dispose(),n.dispose(),r.dispose(),i.dispose(),a.dispose(),o.dispose(),s.dispose(),t.dispose(),d}))}}const lD=(e,t,n)=>{let r=null,i={},a=n;return e instanceof HTMLVideoElement?r=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement?r=e.elt:"function"==typeof e?a=e:"object"==typeof e&&(i=e),"object"==typeof t?i=t:"function"==typeof t&&(a=t),new cD(r,i,a)};var fD=n(9503);const pD="lite_mobilenet_v2",hD=void 0;class dD{constructor(e,t,n){this.video=e||null,this.modelReady=!1,this.isPredicting=!1,this.config={base:t.base||pD,modelUrl:t.modelUrl||hD},this.callback=n,this.ready=kA(this.loadModel(),this.callback)}async loadModel(){return this.model=await fD.load(this.config),this.modelReady=!0,this}async detectInternal(e){this.isPredicting=!0;const t=(await this.model.detect(e)).map((t=>({label:t.class,confidence:t.score,x:t.bbox[0],y:t.bbox[1],width:t.bbox[2],height:t.bbox[3],normalized:{x:t.bbox[0]/e.width,y:t.bbox[1]/e.height,width:t.bbox[2]/e.width,height:t.bbox[3]/e.height}})));return this.isPredicting=!1,t}async detect(e,t){let n;await this.ready,await m.nextFrame();let r=t;if(rk(e))n=e;else if("object"==typeof e&&rk(e.elt))n=e.elt;else if("object"==typeof e&&rk(e.canvas))n=e.canvas;else{if("function"!=typeof e)throw new Error("Detection subject not supported");n=this.video,r=e}return kA(this.detectInternal(n),r)}}const mD=(e,t,n)=>{let r=null,i={},a=n;return e instanceof HTMLVideoElement?r=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement?r=e.elt:"function"==typeof e?a=e:"object"==typeof e&&(i=e),"object"==typeof t?i=t:"function"==typeof t&&(a=t),new dD(r,i,a)};class gD{constructor(e,t,n,r){return this.video=t,this.modelNameOrUrl=e,this.options=n||{},this.callback=r,"yolo"===e?(this.model=new lD(this.video,{disableDeprecationNotice:!0,...this.options},r),this):(this.model=new mD(this.video,this.options,r),this)}}var vD=n(7187),yD=n.n(vD),bD=function(e,t){return(bD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function xD(e,t){function n(){this.constructor=e}bD(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var wD=function(){return(wD=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function ED(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function CD(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var SD=function(){function e(e,t){this.model=e,this.outputStride=t;var n=this.model.inputs[0].shape;OA.util.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}))}return e.prototype.predict=function(e){var t=this;return(0,OA.tidy)((function(){var n=t.preprocessInput((0,OA.cast)(e,"float32")),r=(0,OA.expandDims)(n,0),i=t.model.predict(r).map((function(e){return(0,OA.squeeze)(e,[0])})),a=t.nameOutputResults(i);return{heatmapScores:(0,OA.sigmoid)(a.heatmap),offsets:a.offsets,displacementFwd:a.displacementFwd,displacementBwd:a.displacementBwd}}))},e.prototype.dispose=function(){this.model.dispose()},e}(),ND=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return xD(t,e),t.prototype.preprocessInput=function(e){return(0,OA.tidy)((function(){return(0,OA.sub)((0,OA.div)(e,127.5),1)}))},t.prototype.nameOutputResults=function(e){return{offsets:e[0],heatmap:e[1],displacementFwd:e[2],displacementBwd:e[3]}},t}(SD);function AD(e){return Math.floor(e/2)}var kD=function(){function e(e,t){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}return e.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},e.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},e.prototype.empty=function(){return-1===this.numberOfElements},e.prototype.size=function(){return this.numberOfElements+1},e.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},e.prototype.max=function(){return this.priorityQueue[0]},e.prototype.swim=function(e){for(;e>0&&this.less(AD(e),e);)this.exchange(e,AD(e)),e=AD(e)},e.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}},e.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},e.prototype.less=function(e,t){return this.getValueAt(e)<this.getValueAt(t)},e.prototype.exchange=function(e,t){var n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n},e}();function DD(e,t,n,r,i,a){for(var o=a.shape,s=o[0],u=o[1],c=!0,l=Math.max(n-i,0),f=Math.min(n+i+1,s),p=l;p<f;++p){for(var h=Math.max(r-i,0),d=Math.min(r+i+1,u),m=h;m<d;++m)if(a.get(p,m,e)>t){c=!1;break}if(!c)break}return c}var _D=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],MD=_D.length,TD=_D.reduce((function(e,t,n){return e[t]=n,e}),{}),OD=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(e){var t=e[0],n=e[1];return[TD[t],TD[n]]}));function ID(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+MD)}}function FD(e,t,n){var r=ID(e.heatmapY,e.heatmapX,e.id,n),i=r.y,a=r.x;return{x:e.heatmapX*t+a,y:e.heatmapY*t+i}}function RD(e,t,n){return e<t?t:e>n?n:e}function BD(e,t){return{x:e.x+t.x,y:e.y+t.y}}var zD=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map((function(e){var t=e[0],n=e[1];return[TD[t],TD[n]]})),PD=zD.map((function(e){return e[1]})),LD=zD.map((function(e){return e[0]}));function jD(e,t,n,r){return{y:RD(Math.round(e.y/t),0,n-1),x:RD(Math.round(e.x/t),0,r-1)}}function UD(e,t,n,r,i,a,o,s){void 0===s&&(s=2);for(var u=r.shape,c=u[0],l=u[1],f=function(e,t,n){var r=n.shape[2]/2;return{y:n.get(t.y,t.x,e),x:n.get(t.y,t.x,r+e)}}(e,jD(t.position,a,c,l),o),p=BD(t.position,f),h=0;h<s;h++){var d=jD(p,a,c,l),m=ID(d.y,d.x,n,i);p=BD({x:d.x*a,y:d.y*a},{x:m.x,y:m.y})}var g=jD(p,a,c,l),v=r.get(g.y,g.x,n);return{position:p,part:_D[n],score:v}}function qD(e,t,n,r,i,a){var o=t.shape[2],s=PD.length,u=new Array(o),c=e.part,l=e.score,f=FD(c,r,n);u[c.id]={score:l,part:_D[c.id],position:f};for(var p=s-1;p>=0;--p){var h=PD[p],d=LD[p];u[h]&&!u[d]&&(u[d]=UD(p,u[h],d,t,n,r,a))}for(p=0;p<s;++p)h=LD[p],d=PD[p],u[h]&&!u[d]&&(u[d]=UD(p,u[h],d,t,n,r,i));return u}function WD(e,t,n,r){var i=n.x,a=n.y;return e.some((function(e){var n=e.keypoints[r].position;return function(e,t,n,r){var i=n-e,a=r-t;return i*i+a*a}(a,i,n.y,n.x)<=t}))}function VD(e,t,n){return n.reduce((function(n,r,i){var a=r.position,o=r.score;return WD(e,t,a,i)||(n+=o),n}),0)/n.length}function $D(e,t,n,r,i,a,o,s){void 0===o&&(o=.5),void 0===s&&(s=20);for(var u=[],c=function(e,t,n){for(var r=n.shape,i=r[0],a=r[1],o=r[2],s=new kD(i*a*o,(function(e){return e.score})),u=0;u<i;++u)for(var c=0;c<a;++c)for(var l=0;l<o;++l){var f=n.get(u,c,l);f<e||DD(l,f,u,c,1,n)&&s.enqueue({score:f,part:{heatmapY:u,heatmapX:c,id:l}})}return s}(o,0,e),l=s*s;u.length<a&&!c.empty();){var f=c.dequeue();if(!WD(u,l,FD(f.part,i,t),f.part.id)){var p=qD(f,e,t,i,n,r),h=VD(u,l,p);u.push({keypoints:p,score:h})}}return u}function HD(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+MD)}}function GD(e,t,n){return(0,OA.tidy)((function(){var r=function(e,t){for(var n=[],r=0;r<MD;r++){var i=HD(e.get(r,0).valueOf(),e.get(r,1).valueOf(),r,t),a=i.x,o=i.y;n.push(o),n.push(a)}return(0,OA.tensor2d)(n,[MD,2])}(e,n);return(0,OA.add)((0,OA.cast)((0,OA.mul)(e.toTensor(),(0,OA.scalar)(t,"int32")),"float32"),r)}))}function KD(e,t,n){return ED(this,void 0,void 0,(function(){var r,i,a,o,s,u,c,l,f,p;return CD(this,(function(h){switch(h.label){case 0:return r=0,i=function(e){var t=e.shape,n=t[0],r=t[1],i=t[2];return(0,OA.tidy)((function(){var t=(0,OA.reshape)(e,[n*r,i]),a=(0,OA.argMax)(t,0),o=(0,OA.expandDims)((0,OA.div)(a,(0,OA.scalar)(r,"int32")),1),s=(0,OA.expandDims)(function(e,t){return(0,OA.tidy)((function(){var n=(0,OA.div)(e,(0,OA.scalar)(t,"int32"));return(0,OA.sub)(e,(0,OA.mul)(n,(0,OA.scalar)(t,"int32")))}))}(a,r),1);return(0,OA.concat)([o,s],1)}))}(e),[4,Promise.all([e.buffer(),t.buffer(),i.buffer()])];case 1:return a=h.sent(),o=a[0],s=a[1],u=a[2],[4,(c=GD(u,n,s)).buffer()];case 2:return l=h.sent(),f=Array.from(function(e,t){for(var n=t.shape[0],r=new Float32Array(n),i=0;i<n;i++){var a=t.get(i,0),o=t.get(i,1);r[i]=e.get(a,o,i)}return r}(o,u)),p=f.map((function(e,t){return r+=e,{position:{y:l.get(t,0),x:l.get(t,1)},part:_D[t],score:e}})),i.dispose(),c.dispose(),[2,{keypoints:p,score:r/p.length}]}}))}))}var XD="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",YD="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/",JD=[-123.15,-115.9,-103.06],ZD=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return xD(t,e),t.prototype.preprocessInput=function(e){return(0,OA.add)(e,JD)},t.prototype.nameOutputResults=function(e){var t=e[0],n=e[1];return{offsets:e[2],heatmap:e[3],displacementFwd:t,displacementBwd:n}},t}(SD);function QD(e){return ED(this,void 0,void 0,(function(){return CD(this,(function(t){return[2,Promise.all(e.map((function(e){return e.buffer()})))]}))}))}function e_(e,t){return i_(e,t)?e:Math.floor(e/t)*t+1}function t_(e){OA.util.assert("number"==typeof e||"object"==typeof e,(function(){return"Invalid inputResolution "+e+". Should be a number or an object with width and height"})),"object"==typeof e&&(OA.util.assert("number"==typeof e.width,(function(){return"inputResolution.width has a value of "+e.width+" which is invalid; it must be a number"})),OA.util.assert("number"==typeof e.height,(function(){return"inputResolution.height has a value of "+e.height+" which is invalid; it must be a number"})))}function n_(e,t){return t_(e),"object"==typeof e?[e_(e.height,t),e_(e.width,t)]:[e_(e,t),e_(e,t)]}Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY;var r_=[8,16,32];function i_(e,t){return(e-1)%t==0}function a_(e){return e instanceof OA.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}function o_(e,t){var n=t[0],r=t[1],i=a_(e),a=i[0],o=i[1],s=r/n,u=[0,0,0,0],c=u[0],l=u[1],f=u[2],p=u[3];return o/a<s?(c=0,l=0,f=Math.round(.5*(s*a-o)),p=Math.round(.5*(s*a-o))):(c=Math.round(.5*(1/s*o-a)),l=Math.round(.5*(1/s*o-a)),f=0,p=0),{resized:(0,OA.tidy)((function(){var t=function(e){return e instanceof OA.Tensor?e:OA.browser.fromPixels(e)}(e);return t=(0,OA.pad3d)(t,[[c,l],[f,p],[0,0]]),OA.image.resizeBilinear(t,[n,r])})),padding:{top:c,left:f,right:p,bottom:l}}}function s_(e,t,n,r,i){var a=t[0],o=t[1],s=n[0],u=n[1],c=function(e,t,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),1===n&&1===t&&0===r&&0===i?e:e.map((function(e){return function(e,t,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),{score:e.score,keypoints:e.keypoints.map((function(e){var a=e.score,o=e.part,s=e.position;return{score:a,part:o,position:{x:s.x*n+i,y:s.y*t+r}}}))}}(e,t,n,r,i)}))}(e,(a+r.top+r.bottom)/s,(o+r.left+r.right)/u,-r.top,-r.left);return i?function(e,t){return t<=0?e:e.map((function(e){return function(e,t){return{score:e.score,keypoints:e.keypoints.map((function(e){var n=e.score,r=e.part,i=e.position;return{score:n,part:r,position:{x:t-1-i.x,y:i.y}}}))}}(e,t)}))}(c,o):c}var u_={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},c_=["MobileNetV1","ResNet50"],l_={MobileNetV1:[8,16,32],ResNet50:[32,16]},f_={MobileNetV1:[.5,.75,1],ResNet50:[1]},p_=[1,2,4],h_={flipHorizontal:!1},d_={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20},m_=function(){function e(e,t){(function(e){OA.util.assert("number"==typeof e,(function(){return"outputStride is not a number"})),OA.util.assert(r_.indexOf(e)>=0,(function(){return"outputStride of "+e+" is invalid. It must be either 8, 16, or 32"}))})(e.outputStride),function(e,t){OA.util.assert("number"==typeof e[0]&&"number"==typeof e[1],(function(){return"both resolution values must be a number but had values "+e})),OA.util.assert(i_(e[0],t),(function(){return"height of "+e[0]+" is invalid for output stride "+t+"."})),OA.util.assert(i_(e[1],t),(function(){return"width of "+e[1]+" is invalid for output stride "+t+"."}))}(t,e.outputStride),this.baseModel=e,this.inputResolution=t}return e.prototype.estimateMultiplePoses=function(e,t){return void 0===t&&(t=d_),ED(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,p,h,d,m,g,v,y,b,x,w,E;return CD(this,(function(C){switch(C.label){case 0:return n=wD({},d_,t),function(e){var t=e.maxDetections,n=e.scoreThreshold,r=e.nmsRadius;if(t<=0)throw new Error("Invalid maxDetections "+t+". Should be > 0");if(n<0||n>1)throw new Error("Invalid scoreThreshold "+n+". Should be in range [0.0, 1.0]");if(r<=0)throw new Error("Invalid nmsRadius "+r+".")}(t),r=this.baseModel.outputStride,i=this.inputResolution,a=a_(e),o=a[0],s=a[1],u=o_(e,i),c=u.resized,l=u.padding,f=this.baseModel.predict(c),p=f.heatmapScores,h=f.offsets,d=f.displacementFwd,m=f.displacementBwd,[4,QD([p,h,d,m])];case 1:return g=C.sent(),v=g[0],y=g[1],b=g[2],x=g[3],[4,$D(v,y,b,x,r,n.maxDetections,n.scoreThreshold,n.nmsRadius)];case 2:return w=C.sent(),E=s_(w,[o,s],i,l,n.flipHorizontal),p.dispose(),h.dispose(),d.dispose(),m.dispose(),c.dispose(),[2,E]}}))}))},e.prototype.estimateSinglePose=function(e,t){return void 0===t&&(t=h_),ED(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,p,h,d,m,g,v;return CD(this,(function(y){switch(y.label){case 0:return n=wD({},h_,t),r=this.baseModel.outputStride,i=this.inputResolution,a=a_(e),o=a[0],s=a[1],u=o_(e,i),c=u.resized,l=u.padding,f=this.baseModel.predict(c),p=f.heatmapScores,h=f.offsets,d=f.displacementFwd,m=f.displacementBwd,[4,KD(p,h,r)];case 1:return g=y.sent(),v=s_([g],[o,s],i,l,n.flipHorizontal),p.dispose(),h.dispose(),d.dispose(),m.dispose(),c.dispose(),[2,v[0]]}}))}))},e.prototype.estimatePoses=function(e,t){return ED(this,void 0,void 0,(function(){return CD(this,(function(n){switch(n.label){case 0:return"single-person"!==t.decodingMethod?[3,2]:[4,this.estimateSinglePose(e,t)];case 1:return[2,[n.sent()]];case 2:return[2,this.estimateMultiplePoses(e,t)]}}))}))},e.prototype.dispose=function(){this.baseModel.dispose()},e}();function g_(e){return ED(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return CD(this,(function(u){switch(u.label){case 0:if(t=e.outputStride,n=e.quantBytes,r=e.multiplier,null==OA)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return i=function(e,t,n){var r={1:"100",.75:"075",.5:"050"},i="model-stride"+e+".json";return 4===n?XD+"float/"+r[t]+"/"+i:XD+"quant"+n+"/"+r[t]+"/"+i}(t,r,n),[4,(0,TA.loadGraphModel)(e.modelUrl||i)];case 1:return a=u.sent(),o=new ND(a,t),s=n_(e.inputResolution,o.outputStride),[2,new m_(o,s)]}}))}))}function v_(e){return ED(this,void 0,void 0,(function(){var t,n,r,i,a,o;return CD(this,(function(s){switch(s.label){case 0:if(t=e.outputStride,n=e.quantBytes,null==OA)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return r=function(e,t){var n="model-stride"+e+".json";return 4===t?YD+"float/"+n:YD+"quant"+t+"/"+n}(t,n),[4,(0,TA.loadGraphModel)(e.modelUrl||r)];case 1:return i=s.sent(),a=new ZD(i,t),o=n_(e.inputResolution,a.outputStride),[2,new m_(a,o)]}}))}))}class y_ extends(yD()){constructor(e,t,n,r){super(),this.video=e,this.modelUrl=t.modelUrl||null,this.architecture=t.architecture||"MobileNetV1",this.detectionType=n||t.detectionType||"multiple",this.outputStride=t.outputStride||16,this.flipHorizontal=t.flipHorizontal||false,this.scoreThreshold=t.scoreThreshold||.5,this.minConfidence=t.minConfidence||.5,this.maxPoseDetections=t.maxPoseDetections||5,this.multiplier=t.multiplier||.75,this.inputResolution=t.inputResolution||256,this.quantBytes=t.quantBytes||2,this.nmsRadius=t.nmsRadius||20,this.ready=kA(this.load(),r)}async load(){let e;return e="mobilenetv1"===this.architecture.toLowerCase()?{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,multiplier:this.multiplier,quantBytes:this.quantBytes,modelUrl:this.modelUrl}:{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,quantBytes:this.quantBytes},this.net=await function(e){return void 0===e&&(e=u_),ED(this,void 0,void 0,(function(){return CD(this,(function(t){return"ResNet50"===(e=function(e){if(null==(e=e||u_).architecture&&(e.architecture="MobileNetV1"),c_.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+c_);if(null==e.inputResolution&&(e.inputResolution=257),t_(e.inputResolution),null==e.outputStride&&(e.outputStride=16),l_[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+l_[e.architecture]+" for architecture "+e.architecture+".");if(null==e.multiplier&&(e.multiplier=1),f_[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+f_[e.architecture]+" for architecture "+e.architecture+".");if(null==e.quantBytes&&(e.quantBytes=4),p_.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+p_+" for architecture "+e.architecture+".");if("MobileNetV1"===e.architecture&&32===e.outputStride&&1!==e.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}(e)).architecture?[2,v_(e)]:"MobileNetV1"===e.architecture?[2,g_(e)]:[2,null]}))}))}(e),this.video&&(0===this.video.readyState&&await new Promise((e=>{this.video.onloadeddata=()=>e()})),"single"===this.detectionType?this.singlePose():this.multiPose()),this}skeleton(e,t=this.minConfidence){return function(e,t){return OD.reduce((function(n,r){var i=r[0],a=r[1];return function(e,t,n){return e<n||t<n}(e[i].score,e[a].score,t)||n.push([e[i],e[a]]),n}),[])}(e,t)}mapParts(e){const t=JSON.parse(JSON.stringify(e));return t.keypoints.forEach((e=>{t[e.part]={x:e.position.x,y:e.position.y,confidence:e.score}})),t}getInput(e){let t;return t=e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"==typeof e&&e.canvas instanceof HTMLCanvasElement?e.canvas:this.video,t}async singlePose(e,t){const n=this.getInput(e),r=await this.net.estimateSinglePose(n,{flipHorizontal:this.flipHorizontal}),i=[{pose:this.mapParts(r),skeleton:this.skeleton(r.keypoints)}];return this.emit("pose",i),this.video?m.nextFrame().then((()=>this.singlePose())):("function"==typeof t&&t(i),i)}async multiPose(e,t){const n=this.getInput(e),r=(await this.net.estimateMultiplePoses(n,{flipHorizontal:this.flipHorizontal,maxDetections:this.maxPoseDetections,scoreThreshold:this.scoreThreshold,nmsRadius:this.nmsRadius})).map((e=>this.mapParts(e))).map((e=>({pose:e,skeleton:this.skeleton(e.keypoints)})));return this.emit("pose",r),this.video?m.nextFrame().then((()=>this.multiPose())):("function"==typeof t&&t(r),r)}}class b_{constructor(e){this.urlPath=e,"/"!==this.urlPath.charAt(this.urlPath.length-1)&&(this.urlPath+="/")}async loadManifest(){return new Promise(((e,t)=>{const n=new XMLHttpRequest;n.open("GET",this.urlPath+"manifest.json"),n.onload=()=>{this.checkpointManifest=JSON.parse(n.responseText),e()},n.onerror=e=>{throw t(),new Error(`manifest.json not found at ${this.urlPath}. ${e}`)},n.send()}))}async getCheckpointManifest(){return null==this.checkpointManifest&&await this.loadManifest(),this.checkpointManifest}async getAllVariables(){if(null!=this.variables)return Promise.resolve(this.variables);await this.getCheckpointManifest();const e=Object.keys(this.checkpointManifest),t=e.map((e=>this.getVariable(e)));return Promise.all(t).then((t=>{this.variables={};for(let n=0;n<t.length;n+=1)this.variables[e[n]]=t[n];return this.variables}))}getVariable(e){if(!(e in this.checkpointManifest))throw new Error(`Cannot load non-existent variable ${e}`);const t=t=>{const n=new XMLHttpRequest;n.responseType="arraybuffer";const r=this.checkpointManifest[e].filename;n.open("GET",this.urlPath+r),n.onload=()=>{if(404===n.status)throw new Error(`Not found variable ${e}`);const r=new Float32Array(n.response),i=m.tensor(r,this.checkpointManifest[e].shape);t(i)},n.onerror=t=>{throw new Error(`Could not fetch variable ${e}: ${t}`)},n.send()};return null==this.checkpointManifest?new Promise((e=>{this.loadManifest().then((()=>{new Promise(t).then(e)}))})):new Promise(t)}}const x_=e=>new Promise((t=>{const n=new Image(200,200);n.onload=()=>t(n),n.src=e.toDataURL()}));class w_ extends Zk{constructor(e,t,n){super(t,200),this.ready=!1,this.variableDictionary={},this.timesScalar=m.scalar(150),this.plusScalar=m.scalar(127.5),this.epsilonScalar=m.scalar(.001),this.video=null,this.ready=kA(this.load(e),n)}async load(e){return this.videoElt&&(await this.loadVideo(),this.videoReady=!0),await this.loadCheckpoints(e),this}async loadCheckpoints(e){const t=new b_(e);this.variables=await t.getAllVariables()}instanceNorm(e,t){return m.tidy((()=>{const[n,r,i]=e.shape,a=m.moments(e,[0,1]),o=a.mean,s=a.variance,u=this.variables[w_.getVariableName(t)],c=this.variables[w_.getVariableName(t+1)],l=this.epsilonScalar,f=m.div(m.sub(e.asType("float32"),o),m.sqrt(m.add(s,l)));return m.add(m.mul(c,f),u).as3D(n,r,i)}))}convLayer(e,t,n,r){const i=m.conv2d(e,this.variables[w_.getVariableName(r)],[t,t],"same"),a=this.instanceNorm(i,r+1);return n?m.relu(a):a}residualBlock(e,t){const n=this.convLayer(e,1,!0,t),r=this.convLayer(n,1,!1,t+3);return m.add(r,e)}convTransposeLayer(e,t,n,r){const[i,a]=e.shape,o=[i*n,a*n,t],s=m.conv2dTranspose(e,this.variables[w_.getVariableName(r)],o,[n,n],"same"),u=this.instanceNorm(s,r+1);return m.relu(u)}async transfer(e,t){let n,r=t;return e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof ImageData?n=e:e instanceof HTMLCanvasElement?n=await x_(e):"object"==typeof e&&e.elt instanceof HTMLCanvasElement?n=await x_(e.elt):"object"==typeof e&&(e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLImageElement||e.elt instanceof ImageData)?n=e.elt:"function"==typeof e&&(n=this.video,r=e),kA(this.transferInternal(n),r)}async transferInternal(e){const t=m.browser.fromPixels(e),n=QA(m.tidy((()=>{const e=this.convLayer(t,1,!0,0),n=this.convLayer(e,2,!0,3),r=this.convLayer(n,2,!0,6),i=this.residualBlock(r,9),a=this.residualBlock(i,15),o=this.residualBlock(a,21),s=this.residualBlock(o,27),u=this.residualBlock(s,33),c=this.convTransposeLayer(u,64,2,39),l=this.convTransposeLayer(c,32,2,42),f=this.convLayer(l,1,!1,45),p=m.tanh(f),h=m.mul(this.timesScalar,p),d=m.add(this.plusScalar,h),g=m.clipByValue(d,0,255);return m.div(g,m.scalar(255))})));return t.dispose(),await m.nextFrame(),n}static getVariableName(e){return 0===e?"Variable":`Variable_${e}`}}const E_=e=>{const t=Math.random();let n,r=0;for(let i=0;i<e.length;i+=1)if(r+=e[i],t<r){n=i;break}return n},C_=/cell_[0-9]|lstm_[0-9]/gi,S_=/weights|weight|kernel|kernels|w/gi,N_=/softmax/gi;class A_{constructor(e,t){this.ready=!1,this.model={},this.cellsAmount=0,this.cells=[],this.zeroState={c:[],h:[]},this.state={c:[],h:[]},this.vocab={},this.vocabSize=0,this.probabilities=[],this.defaults={seed:"a",length:20,temperature:.5,stateful:!1},this.ready=kA(this.loadCheckpoints(e),t)}resetState(){this.state=this.zeroState}setState(e){this.state=e}getState(){return this.state}async loadCheckpoints(e){const t=new b_(e),n=await t.getAllVariables();return Object.keys(n).forEach((e=>{e.match(C_)?e.match(S_)?(this.model[`Kernel_${e.match(/[0-9]/)[0]}`]=n[e],this.cellsAmount+=1):this.model[`Bias_${e.match(/[0-9]/)[0]}`]=n[e]:e.match(N_)?e.match(S_)?this.model.fullyConnectedWeights=n[e]:this.model.fullyConnectedBiases=n[e]:this.model[e]=n[e]})),await this.loadVocab(e),await this.initCells(),this}async loadVocab(e){try{const{data:t}=await MA().get(`${e}/vocab.json`);return this.vocab=t,this.vocabSize=Object.keys(t).length,this.vocab}catch(e){return e}}async initCells(){this.cells=[],this.zeroState={c:[],h:[]};const e=m.tensor(1),t=t=>(n,r,i)=>m.basicLSTMCell(e,this.model[`Kernel_${t}`],this.model[`Bias_${t}`],n,r,i);for(let e=0;e<this.cellsAmount;e+=1)this.zeroState.c.push(m.zeros([1,this.model[`Bias_${e}`].shape[0]/4])),this.zeroState.h.push(m.zeros([1,this.model[`Bias_${e}`].shape[0]/4])),this.cells.push(t(e));this.state=this.zeroState}async generateInternal(e){await this.ready;const t=e.seed||this.defaults.seed,n=+e.length||this.defaults.length,r=+e.temperature||this.defaults.temperature;e.stateful||this.defaults.stateful||(this.state=this.zeroState);const i=[],a=Array.from(t),o=[];a.forEach((e=>{o.push(this.vocab[e])}));let s=o[0],u=[];for(let e=0;e<a.length+n+-1;e+=1){const t=await m.buffer([1,this.vocabSize]);t.set(1,0,s);const n=t.toTensor();let c;if(this.model.embedding){const e=m.matMul(n,this.model.embedding);c=m.multiRNNCell(this.cells,e,this.state.c,this.state.h)}else c=m.multiRNNCell(this.cells,n,this.state.c,this.state.h);this.state.c=c[0],this.state.h=c[1];const l=this.state.h[1],f=m.matMul(l,this.model.fullyConnectedWeights),p=m.add(f,this.model.fullyConnectedBiases),h=m.div(p,m.tensor(r)),d=m.exp(h);u=await m.div(d,m.sum(d)).data(),e<a.length-1?s=o[e+1]:(s=E_(u),i.push(s))}let c="";return i.forEach((e=>{const t=Object.keys(this.vocab).find((t=>this.vocab[t]===e));t&&(c+=t)})),this.probabilities=u,{sample:c,state:this.state}}reset(){this.state=this.zeroState}async generate(e,t){return this.reset(),kA(this.generateInternal(e),t)}async predict(e,t){let n=[];const r=e>0?e:.1,i=this.state.h[1],a=m.matMul(i,this.model.fullyConnectedWeights),o=m.add(a,this.model.fullyConnectedBiases),s=m.div(o,m.tensor(r)),u=m.exp(s);n=await m.div(u,m.sum(u)).data();const c=E_(n),l=Object.keys(this.vocab).find((e=>this.vocab[e]===c));this.probabilities=n,t&&t(l);const f=Object.keys(this.vocab).map((e=>({char:e,probability:this.probabilities[this.vocab[e]]})));return{sample:l,probabilities:f}}async feed(e,t){await this.ready;const n=Array.from(e),r=[];n.forEach((e=>{r.push(this.vocab[e])}));let i=r[0];for(let e=0;e<n.length;e+=1){const t=await m.buffer([1,this.vocabSize]);t.set(1,0,i);const n=t.toTensor();let a;if(this.model.embedding){const e=m.matMul(n,this.model.embedding);a=m.multiRNNCell(this.cells,e,this.state.c,this.state.h)}else a=m.multiRNNCell(this.cells,n,this.state.c,this.state.h);this.state.c=a[0],this.state.h=a[1],i=r[e]}t&&t()}}class k_{constructor(e){this.urlPath=e}getAllVariables(){return new Promise(((e,t)=>{const n={};if(this.urlPath in n)return void e(n[this.urlPath]);const r=new XMLHttpRequest;r.open("GET",this.urlPath,!0),r.responseType="arraybuffer",r.onload=()=>{if(200!==r.status)return void t(new Error("missing model"));const i=r.response;if(!i)return void t(new Error("invalid arraybuffer"));const a=[];let o=0;for(;o<i.byteLength;){const e=new Uint8Array(i.slice(o,o+4));o+=4;const t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3];a.push(i.slice(o,o+t)),o+=t}const s=JSON.parse(new TextDecoder("utf8").decode(a[0])),u=new Float32Array(a[1]),c=new Uint8Array(a[2]),l=new Float32Array(c.length);for(let e=0;e<l.length;e+=1)l[e]=u[c[e]];const f={};o=0;for(let e=0;e<s.length;e+=1){const{shape:t}=s[e],n=t.reduce(((e,t)=>e*t)),r=l.slice(o,o+n),i=m.tensor1d(r,"float32");f[s[e].name]=i.reshape(t),o+=n}n[this.urlPath]=f,e(f)},r.send(null)}))}}class D_{constructor(e,t){this.ready=kA(this.loadCheckpoints(e),t)}async loadCheckpoints(e){const t=new k_(e);return this.variables=await t.getAllVariables(),this}async transfer(e,t){return kA(this.transferInternal(e),t)}async transferInternal(e){const t=QA(m.tidy((()=>{const t=m.browser.fromPixels(e),n=t.dataSync(),r=m.tensor3d(n,t.shape),i=m.div(r,m.scalar(255)),a=D_.preprocess(i),o=[];let s=this.variables["generator/encoder_1/conv2d/kernel"],u=this.variables["generator/encoder_1/conv2d/bias"],c=D_.conv2d(a,s,u);o.push(c);for(let e=2;e<=8;e+=1){const t=`generator/encoder_${e.toString()}`;s=this.variables[`${t}/conv2d/kernel`];const n=this.variables[`${t}/conv2d/bias`],r=o[o.length-1],i=m.leakyRelu(r,.2);c=D_.conv2d(i,s,n);const a=this.variables[`${t}/batch_normalization/gamma`],u=this.variables[`${t}/batch_normalization/beta`],l=D_.batchnorm(c,a,u);o.push(l)}for(let e=8;e>=2;e-=1){let t;if(8===e)t=o[o.length-1];else{const n=e-1;t=m.concat([o[o.length-1],o[n]],2)}const n=m.relu(t),r=`generator/decoder_${e.toString()}`;s=this.variables[`${r}/conv2d_transpose/kernel`],u=this.variables[`${r}/conv2d_transpose/bias`],c=D_.deconv2d(n,s,u);const i=this.variables[`${r}/batch_normalization/gamma`],a=this.variables[`${r}/batch_normalization/beta`],l=D_.batchnorm(c,i,a);o.push(l)}const l=m.concat([o[o.length-1],o[0]],2);let f=m.relu(l);s=this.variables["generator/decoder_1/conv2d_transpose/kernel"];const p=this.variables["generator/decoder_1/conv2d_transpose/bias"];c=D_.deconv2d(f,s,p),f=m.tanh(c),o.push(f);const h=o[o.length-1];return D_.deprocess(h)})));return await m.nextFrame(),t}static preprocess(e){const t=m.tidy((()=>m.sub(m.mul(e,m.scalar(2)),m.scalar(1))));return e.dispose(),t}static deprocess(e){const t=m.tidy((()=>m.div(m.add(e,m.scalar(1)),m.scalar(2))));return e.dispose(),t}static batchnorm(e,t,n){const r=m.tidy((()=>{const r=m.moments(e,[0,1]);return m.batchNorm(e,r.mean,r.variance,n,t,1e-5)}));return e.dispose(),r}static conv2d(e,t){const n=t.clone(),r=m.tidy((()=>m.conv2d(e,n,[2,2],"same")));return e.dispose(),n.dispose(),r}static deconv2d(e,t,n){const r=m.tidy((()=>{const r=m.conv2dTranspose(e,t,[2*e.shape[0],2*e.shape[1],t.shape[2]],[2,2],"same");return m.add(r,n)}));return e.dispose(),t.dispose(),n.dispose(),r}}var __=n(6240);const M_=new Set(["alarm_clock","ambulance","angel","ant","antyoga","backpack","barn","basket","bear","bee","beeflower","bicycle","bird","book","brain","bridge","bulldozer","bus","butterfly","cactus","calendar","castle","cat","catbus","catpig","chair","couch","crab","crabchair","crabrabbitfacepig","cruise_ship","diving_board","dog","dogbunny","dolphin","duck","elephant","elephantpig","eye","face","fan","fire_hydrant","firetruck","flamingo","flower","floweryoga","frog","frogsofa","garden","hand","hedgeberry","hedgehog","helicopter","kangaroo","key","lantern","lighthouse","lion","lionsheep","lobster","map","mermaid","monapassport","monkey","mosquito","octopus","owl","paintbrush","palm_tree","parrot","passport","peas","penguin","pig","pigsheep","pineapple","pool","postcard","power_outlet","rabbit","rabbitturtle","radio","radioface","rain","rhinoceros","rifle","roller_coaster","sandwich","scorpion","sea_turtle","sheep","skull","snail","snowflake","speedboat","spider","squirrel","steak","stove","strawberry","swan","swing_set","the_mona_lisa","tiger","toothbrush","toothpaste","tractor","trombone","truck","whale","windmill","yoga","yogabicycle","everything"]);class T_{constructor(e,t,n=!0){let r=e;if(this.config={temperature:.65,pixelFactor:3,modelPath:"https://storage.googleapis.com/quickdraw-models/sketchRNN/large_models/",modelPath_small:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",modelPath_large:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",PATH_END:".gen.json"},!0===aD.isAbsoluteURL(r)){const e=aD.getModelPath(r);this.config.modelPath=e}else{if(!M_.has(r))return console.log("no model found!"),this;r=(n?this.config.modelPath:this.config.modelPath_small)+r+this.config.PATH_END,this.config.modelPath=r}this.model=new __.SketchRNN(this.config.modelPath),this.penState=this.model.zeroInput(),this.ready=kA(this.model.initialize(),t)}async generateInternal(e,t){const n=+e.temperature||this.config.temperature,r=+e.pixelFactor||this.config.pixelFactor;await this.ready,this.rnnState||(this.rnnState=this.model.zeroState(),this.model.setPixelFactor(r)),Array.isArray(t)&&t.length&&(this.rnnState=this.model.updateStrokes(t,this.rnnState)),this.rnnState=this.model.update(this.penState,this.rnnState);const i=this.model.getPDF(this.rnnState,n);this.penState=this.model.sample(i);const a={dx:this.penState[0],dy:this.penState[1]};return 1===this.penState[2]?a.pen="down":1===this.penState[3]?a.pen="up":1===this.penState[4]&&(a.pen="end"),a}async generate(e,t,n){let r,i,a;"function"==typeof e?(i={},a=[],r=e):Array.isArray(e)?(i={},a=e,r=t):"function"==typeof t?(i=e||{},a=[],r=t):(i=e||{},a=t||[],r=n);const o=a.map((e=>{const t="up"===e.pen?1:0,n="down"===e.pen?1:0,r="end"===e.pen?1:0;return[e.dx,e.dy,n,t,r]}));return kA(this.generateInternal(i,o),r)}reset(){this.penState=this.model.zeroInput(),this.rnnState&&(this.rnnState=this.model.zeroState())}}class O_{constructor(e,t,n){this.modelReady=!1,this.isPredicting=!1,this.config={modelPath:void 0!==t.modelPath?t.modelPath:"https://raw.githubusercontent.com/zaidalyafeai/HostedModels/master/unet-128/model.json",imageSize:void 0!==t.imageSize?t.imageSize:128,returnTensors:void 0!==t.returnTensors&&t.returnTensors},this.ready=kA(this.loadModel(),n)}async loadModel(){return this.model=await m.loadLayersModel(this.config.modelPath),this.modelReady=!0,this}async segment(e,t){let n;await this.ready;let r=t;return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?n=e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData)?n=e.elt:"function"==typeof e&&(n=this.video,r=e),kA(this.segmentInternal(n),r)}static dataURLtoBlob(e){const t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]);let i=r.length;const a=new Uint8Array(i);for(;i;)a[i]=r.charCodeAt(i),i-=1;return new Blob([a],{type:n})}async convertToP5Image(e){const t=await JA.rawToBlob(e,this.config.imageSize,this.config.imageSize);return await JA.blobToP5Image(t)}async segmentInternal(e){await this.ready,e instanceof HTMLVideoElement&&await m.nextFrame(),this.isPredicting=!0;const{featureMask:t,backgroundMask:n,segmentation:r}=m.tidy((()=>{const t=m.browser.fromPixels(e).toFloat();let n=m.image.resizeBilinear(t,[this.config.imageSize,this.config.imageSize]).div(m.scalar(255));const r=n.expandDims(0),i=this.model.predict(r),a=m.ones([128,128,1]).tile([1,1,1]);n=n.concat(a,2);let o=i.squeeze([0]);o=o.tile([1,1,4]),o=o.sub(.3).sign().relu().neg().add(1);const s=o.mul(n);let u=i.squeeze([0]);u=u.tile([1,1,4]),u=u.sub(.3).sign().relu();const c=u.mul(n),l=m.ones([128,128,1]).tile([1,1,1]).mul(255);let f=i.squeeze([0]);return f=m.cast(f.tile([1,1,3]).sub(.3).sign().relu().mul(255),"int32"),f=f.concat(l,2),{featureMask:s,backgroundMask:c,segmentation:f}}));this.isPredicting=!1;const i=await m.browser.toPixels(t),a=await m.browser.toPixels(n),o=await m.browser.toPixels(r),s=QA(t),u=QA(n),c=O_.dataURLtoBlob(s.src),l=O_.dataURLtoBlob(u.src);let f,p,h;return JA.checkP5()&&(f=await this.convertToP5Image(i),p=await this.convertToP5Image(a),h=await this.convertToP5Image(o)),this.config.returnTensors||(t.dispose(),n.dispose(),r.dispose()),{segmentation:o,blob:{featureMask:c,backgroundMask:l},tensor:{featureMask:t,backgroundMask:n},raw:{featureMask:i,backgroundMask:a},featureMask:f,backgroundMask:p,mask:h}}}class I_{constructor(e,t){this.ready=!1,this.model={},this.latentDim=m.randomUniform([1,16]),this.modelPath=e,this.modelPathPrefix="",this.jsonLoader().then((e=>{this.modelPathPrefix=this.modelPath.split("manifest.json")[0],this.ready=kA(this.loadCVAEModel(this.modelPathPrefix+e.model),t),this.labels=e.labels,this.labelVector=Array(this.labels.length+1).fill(0)}))}async loadCVAEModel(e){return this.model=await m.loadLayersModel(e),this}async generate(e,t){return kA(this.generateInternal(e),t)}loadAsync(e){return new Promise(((t,n)=>{this.ready||n(),loadImage(e,(e=>{t(e)}))}))}getBlob(e){return new Promise(((t,n)=>{this.ready||n(),e.toBlob((e=>{t(e)}))}))}async generateInternal(e){const t=m.tidy((()=>{this.latentDim=m.randomUniform([1,16]);const t=this.labels.indexOf(e);if(t<0)return console.log("Wrong input of the label!"),[void 0,void 0];this.labelVector=this.labelVector.map((()=>0)),this.labelVector[t+1]=1;const n=m.tensor([this.labelVector]),r=this.model.predict([this.latentDim,n]);return r.reshape([r.shape[1],r.shape[2],r.shape[3]])})),n=await m.browser.toPixels(t);t.dispose();const r=document.createElement("canvas"),i=r.getContext("2d"),[a,o]=t.shape;r.width=a,r.height=o;const s=i.createImageData(a,o),u=s.data;for(let e=0;e<a*o*4;e+=1)u[e]=n[e];i.putImageData(s,0,0);const c=URL.createObjectURL(await this.getBlob(r));let l;return JA.checkP5()&&(l=await this.loadAsync(c)),{src:c,raws:n,image:l}}async jsonLoader(){return new Promise(((e,t)=>{const n=new XMLHttpRequest;n.open("GET",this.modelPath),n.onload=()=>{const t=JSON.parse(n.responseText);e(t)},n.onerror=e=>{t(e)},n.send()}))}}class F_{constructor(e,t,n){this.model={},this.modelPath=e,this.modelInfo={},this.modelPathPrefix="",this.modelReady=!1,this.config={returnTensors:t.returnTensors||!1},this.ready=kA(this.loadModel(),n)}async loadModel(){const e=(await MA().get(this.modelPath)).data;this.modelInfo=e;const[t]=this.modelPath.split("manifest.json"),n=this.isAbsoluteURL(t)?this.modelInfo.model:this.modelPathPrefix+this.modelInfo.model;return this.model=await m.loadLayersModel(n),this.modelReady=!0,this}async generate(e,t){return await this.ready,kA(this.generateInternal(t),e)}async compute(e,t){const n=m.tidy((()=>{let n;if(!1===Array.isArray(t))n=m.randomNormal([1,e]);else{const r=m.buffer([1,e]);for(let n=0;n<e;n+=1)r.set(t[n],0,n);n=r.toTensor()}return this.model.predict(n).squeeze().transpose([1,2,0]).div(m.scalar(2)).add(m.scalar(.5))}));return n}async generateInternal(e){const{modelLatentDim:t}=this.modelInfo,n=await this.compute(t,e),r=await m.browser.toPixels(n),[i,a]=n.shape,o=await JA.rawToBlob(r,a,i);let s;JA.checkP5()&&(s=await JA.blobToP5Image(o));const u={};return u.blob=o,u.raw=r,JA.checkP5()&&(u.image=s),this.config.returnTensors?u.tensor=n:(u.tensor=null,n.dispose()),u}isAbsoluteURL(e){return!!new RegExp("^(?:[a-z]+:)?//","i").test(e)}}const R_="0.8.0";class B_{constructor(e,t){this.ready=kA(this.loadModel(e),t)}async loadModel(e){const t={model:null,metadata:null};if("moviereviews"===e.toLowerCase())t.model="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json",t.metadata="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/metadata.json";else{if(!0!==aD.isAbsoluteURL(e))return console.error("problem loading model"),this;{const n=aD.getModelPath(e);t.model=`${n}/model.json`,t.metadata=`${n}/metadata.json`}}this.model=await m.loadLayersModel(t.model);const n=(await MA().get(t.metadata)).data;return this.indexFrom=n.index_from,this.maxLen=n.max_len,this.wordIndex=n.word_index,this.vocabularySize=n.vocabulary_size,this}predict(e){const t=function(e,t,n="pre",r="pre",i=0){return e.map((e=>{if(e.length>t&&("pre"===r?e.splice(0,e.length-t):e.splice(t,e.length-t)),e.length<t){const r=[];for(let n=0;n<t-e.length;n+=1)r.push(i);e="pre"===n?r.concat(e):e.concat(r)}return e}))}([e.trim().toLowerCase().replace(/[.,?!]/g,"").split(" ").map((e=>{let t=this.wordIndex[e]+this.indexFrom;return t>this.vocabularySize&&(t=2),t}))],this.maxLen),n=m.tensor2d(t,[1,this.maxLen]),r=this.model.predict(n),i=r.dataSync()[0];return r.dispose(),n.dispose(),{score:i}}}function z_(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function P_(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var L_=[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],j_=[8,16,32];function U_(e){OA.util.assert("number"==typeof e,(function(){return"outputStride is not a number"})),OA.util.assert(j_.indexOf(e)>=0,(function(){return"outputStride of "+e+" is invalid. It must be either 8, 16, or 32"}))}var q_={100:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",2],["separableConv",1]],75:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],50:L_,25:L_},W_=function(){function e(e,t){this.PREPROCESS_DIVISOR=(0,OA.scalar)(127.5),this.ONE=(0,OA.scalar)(1),this.modelWeights=e,this.convolutionDefinitions=t}return e.prototype.predict=function(e,t){var n=this,r=(0,OA.div)(e.toFloat(),this.PREPROCESS_DIVISOR),i=(0,OA.sub)(r,this.ONE);return function(e,t){var n=1,r=1;return e.map((function(e,i){var a,o,s=e[0],u=e[1];return n===t?(a=1,o=r,r*=u):(a=u,o=1,n*=u),{blockId:i,convType:s,stride:a,rate:o,outputStride:n}}))}(this.convolutionDefinitions,t).reduce((function(e,t){var r=t.blockId,i=t.stride,a=t.convType,o=t.rate;if("conv2d"===a)return n.conv(e,i,r);if("separableConv"===a)return n.separableConv(e,i,r,o);throw Error("Unknown conv type of "+a)}),i)},e.prototype.convToOutput=function(e,t){return e.conv2d(this.weights(t),1,"same").add(this.convBias(t,!1))},e.prototype.conv=function(e,t,n){var r=this.weights("Conv2d_"+String(n));return e.conv2d(r,t,"same").add(this.convBias("Conv2d_"+String(n))).clipByValue(0,6)},e.prototype.separableConv=function(e,t,n,r){void 0===r&&(r=1);var i="Conv2d_"+String(n)+"_depthwise",a="Conv2d_"+String(n)+"_pointwise";return e.depthwiseConv2D(this.depthwiseWeights(i),t,"same","NHWC",r).add(this.depthwiseBias(i)).clipByValue(0,6).conv2d(this.weights(a),[1,1],"same").add(this.convBias(a)).clipByValue(0,6)},e.prototype.weights=function(e){return this.modelWeights.weights(e)},e.prototype.convBias=function(e,t){return void 0===t&&(t=!0),this.modelWeights.convBias(e,t)},e.prototype.depthwiseBias=function(e){return this.modelWeights.depthwiseBias(e)},e.prototype.depthwiseWeights=function(e){return this.modelWeights.depthwiseWeights(e)},e.prototype.dispose=function(){this.modelWeights.dispose()},e}(),V_="https://storage.googleapis.com/tfjs-models/savedmodel/",$_={1:{url:V_+"posenet_mobilenet_100_partmap/",architecture:q_[100]},.75:{url:V_+"posenet_mobilenet_075_partmap/",architecture:q_[75]},.5:{url:V_+"posenet_mobilenet_050_partmap/",architecture:q_[50]},.25:{url:V_+"posenet_mobilenet_025_partmap/",architecture:q_[25]}};function H_(e,t){return(0,OA.tidy)((function(){return e.greater((0,OA.scalar)(t)).toInt()}))}var G_=function(){function e(e){this.graphModel=e}return e.prototype.weights=function(e){return this.getVariable("MobilenetV1/"+e+"/weights")},e.prototype.convBias=function(e,t){return void 0===t&&(t=!0),this.getVariable("MobilenetV1/"+e+"/Conv2D_bias")},e.prototype.depthwiseBias=function(e){return this.getVariable("MobilenetV1/"+e+"/depthwise_bias")},e.prototype.depthwiseWeights=function(e){return this.getVariable("MobilenetV1/"+e+"/depthwise_weights")},e.prototype.getVariable=function(e){return this.graphModel.weights[""+e][0]},e.prototype.dispose=function(){this.graphModel.dispose()},e}();function K_(e){return e instanceof OA.Tensor?e:OA.browser.fromPixels(e)}function X_(e,t,n){var r=t[0],i=t[1];void 0===n&&(n=!1);var a,o,s,u,c,l,f=e.shape,p=f[0],h=f[1]/p;if(h>i/r){a=i;var d=r-(o=Math.ceil(a/h));s=0,u=0,c=Math.floor(d/2),l=r-(o+c)}else{o=r;var m=i-(a=Math.ceil(r*h));s=Math.floor(m/2),u=i-(a+s),c=0,l=0}return{resizedAndPadded:(0,OA.tidy)((function(){var t;return t=n?e.reverse(1).resizeBilinear([o,a]):e.resizeBilinear([o,a]),(0,OA.pad3d)(t,[[c,l],[s,u],[0,0]])})),paddedBy:[[c,l],[s,u]]}}function Y_(e,t,n,r){var i=t[0],a=t[1],o=n[0],s=n[1],u=r[0],c=u[0],l=u[1],f=r[1],p=f[0],h=f[1];return(0,OA.tidy)((function(){return function(e,t,n){var r=t[0],i=t[1],a=n[0],o=a[0],s=a[1],u=n[1],c=u[0],l=u[1],f=e.shape,p=f[0],h=f[1],d=p-(o+s),m=h-(c+l);return(0,OA.tidy)((function(){return(0,OA.slice3d)(e,[o,c,0],[d,m,e.shape[2]]).resizeBilinear([r,i],!0)}))}(e.resizeBilinear([o,s],!0),[i,a],[[c,l],[p,h]])}))}var J_=[353,257],Z_=function(){function e(e){this.mobileNet=e}return e.prototype.predictForSegmentation=function(e,t){var n=this;return void 0===t&&(t=16),U_(t),(0,OA.tidy)((function(){var r=n.mobileNet.predict(e,t);return n.mobileNet.convToOutput(r,"segment_2").sigmoid()}))},e.prototype.predictForPartMap=function(e,t){var n=this;return void 0===t&&(t=16),U_(t),(0,OA.tidy)((function(){var r=n.mobileNet.predict(e,t),i=n.mobileNet.convToOutput(r,"segment_2"),a=n.mobileNet.convToOutput(r,"part_heatmap_2");return{segmentScores:i.sigmoid(),partHeatmapScores:a.sigmoid()}}))},e.prototype.estimatePersonSegmentationActivation=function(e,t,n){var r=this;return void 0===t&&(t=16),void 0===n&&(n=.5),U_(t),(0,OA.tidy)((function(){var i=K_(e),a=X_(i,J_),o=a.resizedAndPadded,s=a.paddedBy,u=r.predictForSegmentation(o,t),c=o.shape,l=c[0],f=c[1],p=i.shape;return H_(Y_(u,[p[0],p[1]],[l,f],s).squeeze(),n)}))},e.prototype.estimatePersonSegmentation=function(e,t,n){return void 0===t&&(t=16),void 0===n&&(n=.5),z_(this,void 0,void 0,(function(){var r,i,a,o,s;return P_(this,(function(u){switch(u.label){case 0:return r=this.estimatePersonSegmentationActivation(e,t,n),i=r.shape,a=i[0],o=i[1],[4,r.data()];case 1:return s=u.sent(),r.dispose(),[2,{height:a,width:o,data:s}]}}))}))},e.prototype.estimatePartSegmentationActivation=function(e,t,n){var r=this;return void 0===t&&(t=16),void 0===n&&(n=.5),U_(t),(0,OA.tidy)((function(){var i=K_(e),a=X_(i,J_),o=a.resizedAndPadded,s=a.paddedBy,u=r.predictForPartMap(o,t),c=u.segmentScores,l=u.partHeatmapScores,f=o.shape,p=f[0],h=f[1],d=i.shape,m=d[0],g=d[1],v=Y_(c,[m,g],[p,h],s),y=Y_(l,[m,g],[p,h],s);return function(e,t){var n=t.shape,r=n[0],i=n[1],a=n[2];return(0,OA.tidy)((function(){var n=function(e){var t=e.shape[2],n=e.argMax(2).reshape([-1]);return(0,OA.oneHot)(n,t)}(t),o=(0,OA.range)(0,a,1,"int32").expandDims(1);return function(e,t){return e.mul(t)}(n.matMul(o).toInt().reshape([r,i]).add((0,OA.scalar)(1,"int32")),e).sub((0,OA.scalar)(1,"int32"))}))}(H_(v.squeeze(),n),y)}))},e.prototype.estimatePartSegmentation=function(e,t,n){return void 0===t&&(t=16),void 0===n&&(n=.5),z_(this,void 0,void 0,(function(){var r,i,a,o,s;return P_(this,(function(u){switch(u.label){case 0:return r=this.estimatePartSegmentationActivation(e,t,n),i=r.shape,a=i[0],o=i[1],[4,r.data()];case 1:return s=u.sent(),r.dispose(),[2,{height:a,width:o,data:s}]}}))}))},e.prototype.dispose=function(){this.mobileNet.dispose()},e}(),Q_=function(e){return z_(void 0,void 0,void 0,(function(){var t,n,r,i;return P_(this,(function(a){switch(a.label){case 0:return n=(t=$_[e]).url,[4,(0,TA.loadGraphModel)(n+"model.json")];case 1:return r=a.sent(),i=new G_(r),[2,new W_(i,t.architecture)]}}))}))};function eM(e,t){void 0===t&&(t=!0);for(var n=e.width,r=e.height,i=e.data,a=new Uint8ClampedArray(n*r*4),o=0;o<r*n;++o){var s=255*(t?1-i[o]:i[o]),u=4*o;a[u+0]=0,a[u+1]=0,a[u+2]=0,a[u+3]=Math.round(s)}return new ImageData(a,n,r)}const tM={multiplier:.75,outputStride:16,segmentationThreshold:.5,palette:{leftFace:{id:0,color:[110,64,170]},rightFace:{id:1,color:[106,72,183]},rightUpperLegFront:{id:2,color:[100,81,196]},rightLowerLegBack:{id:3,color:[92,91,206]},rightUpperLegBack:{id:4,color:[84,101,214]},leftLowerLegFront:{id:5,color:[75,113,221]},leftUpperLegFront:{id:6,color:[66,125,224]},leftUpperLegBack:{id:7,color:[56,138,226]},leftLowerLegBack:{id:8,color:[48,150,224]},rightFeet:{id:9,color:[40,163,220]},rightLowerLegFront:{id:10,color:[33,176,214]},leftFeet:{id:11,color:[29,188,205]},torsoFront:{id:12,color:[26,199,194]},torsoBack:{id:13,color:[26,210,182]},rightUpperArmFront:{id:14,color:[28,219,169]},rightUpperArmBack:{id:15,color:[33,227,155]},rightLowerArmBack:{id:16,color:[41,234,141]},leftLowerArmFront:{id:17,color:[51,240,128]},leftUpperArmFront:{id:18,color:[64,243,116]},leftUpperArmBack:{id:19,color:[79,246,105]},leftLowerArmBack:{id:20,color:[96,247,97]},rightHand:{id:21,color:[115,246,91]},rightLowerArmFront:{id:22,color:[134,245,88]},leftHand:{id:23,color:[155,243,88]}},returnTensors:!1};class nM{constructor(e,t,n){this.video=e,this.model=null,this.modelReady=!1,this.modelPath="",this.config={multiplier:t.multiplier||tM.multiplier,outputStride:t.outputStride||tM.outputStride,segmentationThreshold:t.segmentationThreshold||tM.segmentationThreshold,palette:t.palette||tM.palette,returnTensors:t.returnTensors||tM.returnTensors},this.ready=kA(this.loadModel(),n)}async loadModel(){return this.model=await function(e){return void 0===e&&(e=.75),z_(this,void 0,void 0,(function(){var t,n;return P_(this,(function(r){switch(r.label){case 0:if(null==OA)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return t=Object.keys($_),OA.util.assert("number"==typeof e,(function(){return"got multiplier type of "+typeof e+" when it should be a number."})),OA.util.assert(t.indexOf(e.toString())>=0,(function(){return"invalid multiplier value of "+e+".  No checkpoint exists for that multiplier. Must be one of "+t.join(",")+"."})),[4,Q_(e)];case 1:return n=r.sent(),[2,new Z_(n)]}}))}))}(this.config.multiplier),this.modelReady=!0,this}p5Color2RGB(e){const t=/\(([^)]+)\)/.exec(e.toString("rgb")),[n,r,i]=t[1].split(",");return[n,r,i]}async convertToP5Image(e,t,n){const r=await JA.rawToBlob(e,t,n);return await JA.blobToP5Image(r)}bodyPartsSpec(e){const t=void 0!==e||Object.keys(e).length>=24?e:this.config.palette;return JA.checkP5()&&void 0!==t&&Object.keys(t).length>=24&&Object.keys(t).forEach((e=>{t[e].color instanceof window.p5.Color?t[e].color=this.p5Color2RGB(t[e].color):t[e].color=t[e].color})),t}async segmentWithPartsInternal(e,t){await this.ready,await m.nextFrame(),this.video&&0===this.video.readyState&&await new Promise((e=>{this.video.onloadeddata=()=>e()})),this.config.palette=t.palette||this.config.palette,this.config.outputStride=t.outputStride||this.config.outputStride,this.config.segmentationThreshold=t.segmentationThreshold||this.config.segmentationThreshold;const n=await this.model.estimatePartSegmentation(e,this.config.outputStride,this.config.segmentationThreshold),r=this.bodyPartsSpec(this.config.palette),i=Object.keys(r).map((e=>r[e].color)),a={segmentation:n,raw:{personMask:null,backgroundMask:null,partMask:null},tensor:{personMask:null,backgroundMask:null,partMask:null},personMask:null,backgroundMask:null,partMask:null,bodyParts:r};a.raw.backgroundMask=eM(n,!0),a.raw.personMask=eM(n,!1),a.raw.partMask=function(e,t){for(var n=e.width,r=e.height,i=e.data,a=new Uint8ClampedArray(n*r*4),o=0;o<r*n;++o){var s=Math.round(i[o]),u=4*o;if(-1===s)a[u+0]=255,a[u+1]=255,a[u+2]=255,a[u+3]=255;else{var c=t[s];if(!c)throw new Error("No color could be found for part id "+s);a[u+0]=c[0],a[u+1]=c[1],a[u+2]=c[2],a[u+3]=255}}return new ImageData(a,n,r)}(n,i);const{personMask:o,backgroundMask:s,partMask:u}=m.tidy((()=>{let t=m.browser.fromPixels(e);const r=m.ones([n.height,n.width,1]).tile([1,1,1]).mul(255);t=t.concat(r,2);let i=m.tensor(n.data,[n.height,n.width,1]),o=m.tensor(n.data,[n.height,n.width,1]),s=m.tensor([...a.raw.partMask.data],[n.height,n.width,4]);return i=m.cast(i.add(.2).sign().relu().mul(t),"int32"),o=m.cast(o.add(.2).sign().neg().relu().mul(t),"int32"),s=m.cast(s,"int32"),{personMask:i,backgroundMask:o,partMask:s}})),c=await m.browser.toPixels(o),l=await m.browser.toPixels(s),f=await m.browser.toPixels(u);return a.personMask=c,a.backgroundMask=l,a.partMask=f,JA.checkP5()&&(a.personMask=await this.convertToP5Image(c,n.width,n.height),a.backgroundMask=await this.convertToP5Image(l,n.width,n.height),a.partMask=await this.convertToP5Image(f,n.width,n.height)),this.config.returnTensors?(a.tensor.personMask=o,a.tensor.backgroundMask=s,a.tensor.partMask=u):(o.dispose(),s.dispose(),u.dispose()),a}async segmentWithParts(e,t,n){let r,i=this.video,a=this.config;if("function"==typeof e)i=this.video,r=e;else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData)i=e;else if("object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData))i=e.elt;else if("object"==typeof e&&e.canvas instanceof HTMLCanvasElement)i=e.canvas;else if("object"==typeof e&&e.elt instanceof HTMLVideoElement)i=e.elt;else if(!(this.video instanceof HTMLVideoElement))throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");return"object"==typeof t?a=t:"function"==typeof t&&(r=t),"function"==typeof n&&(r=n),kA(this.segmentWithPartsInternal(i,a),r)}async segmentInternal(e,t){await this.ready,await m.nextFrame(),this.video&&0===this.video.readyState&&await new Promise((e=>{this.video.onloadeddata=()=>e()})),this.config.outputStride=t.outputStride||this.config.outputStride,this.config.segmentationThreshold=t.segmentationThreshold||this.config.segmentationThreshold;const n=await this.model.estimatePersonSegmentation(e,this.config.outputStride,this.config.segmentationThreshold),r={segmentation:n,raw:{personMask:null,backgroundMask:null},tensor:{personMask:null,backgroundMask:null},personMask:null,backgroundMask:null};r.raw.backgroundMask=eM(n,!0),r.raw.personMask=eM(n,!1);const{personMask:i,backgroundMask:a}=m.tidy((()=>{let t=m.browser.fromPixels(e);const r=m.ones([n.height,n.width,1]).tile([1,1,1]).mul(255);t=t.concat(r,2);let i=m.tensor(n.data,[n.height,n.width,1]),a=m.tensor(n.data,[n.height,n.width,1]);return i=m.cast(i.neg().add(1).mul(t),"int32"),a=m.cast(a.mul(t),"int32"),{personMask:i,backgroundMask:a}})),o=await m.browser.toPixels(i),s=await m.browser.toPixels(a);return JA.checkP5()?(r.personMask=await this.convertToP5Image(o,n.width,n.height),r.backgroundMask=await this.convertToP5Image(s,n.width,n.height)):(r.personMask=o,r.backgroundMask=s),this.config.returnTensors?(r.tensor.personMask=i,r.tensor.backgroundMask=a):(i.dispose(),a.dispose()),r}async segment(e,t,n){let r,i=this.video,a=this.config;if("function"==typeof e)i=this.video,r=e;else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData)i=e;else if("object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData))i=e.elt;else if("object"==typeof e&&e.canvas instanceof HTMLCanvasElement)i=e.canvas;else if("object"==typeof e&&e.elt instanceof HTMLVideoElement)i=e.elt;else if(!(this.video instanceof HTMLVideoElement))throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");return"object"==typeof t?a=t:"function"==typeof t&&(r=t),"function"==typeof n&&(r=n),kA(this.segmentInternal(i,a),r)}}const rM=(e=0,t=1)=>Math.random()*(t-e)+e,iM=(e=0,t=1)=>{let n,r,i,a,o,s;if(s)n=r,s=!1;else{do{i=rM(0,2)-1,a=rM(0,2)-1,o=i*i+a*a}while(o>=1);o=Math.sqrt(-2*Math.log(o)/o),n=i*o,r=a*o,s=!0}return n*t+e};const aM=new class{constructor(e){this.options=e||{}}normalizeValue(e,t,n){return(e-t)/(n-t)}unnormalizeValue(e,t,n){return e*(n-t)+t}getMin(e){return e.reduce(((e,t)=>Math.min(e,t)))}getMax(e){return e.reduce(((e,t)=>Math.max(e,t)))}isJsonOrString(e){try{JSON.parse(e)}catch(e){return!1}return!0}zipArrays(e,t){return e.length!==t.length?(console.error("arrays do not have the same length"),[]):[...new Array(e.length).fill(null)].map(((n,r)=>({...e[r],...t[r]})))}createLabelsFromArrayValues(e,t){let n;return Array.isArray(e)&&(n=e.map(((e,n)=>`${t}_${n}`))),n}formatDataAsObject(e,t){let n={};if(Array.isArray(e))return e.forEach(((e,r)=>{const i=t[r];n[i]=e})),n;if("object"==typeof e)return n=e,n;throw new Error("input provided is not supported or does not match your output label specifications")}getDataType(e){let t=typeof e;return"object"===t&&Array.isArray(e)&&(t="array"),t}},oM={inputs:[],outputs:[],dataUrl:null,modelUrl:null,layers:[],task:null,debug:!1,learningRate:.2,hiddenUnits:16,noTraining:!1};class sM{constructor(e,t){this.callback=t,"imageClassification"===e.task&&(oM.learningRate=.02),this.options={...oM,...e}||oM,this.neuralNetwork=new class{constructor(){this.isTrained=!1,this.isCompiled=!1,this.isLayered=!1,this.model=null,this.init=this.init.bind(this),this.createModel=this.createModel.bind(this),this.addLayer=this.addLayer.bind(this),this.compile=this.compile.bind(this),this.setOptimizerFunction=this.setOptimizerFunction.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.predict=this.predict.bind(this),this.classify=this.classify.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.init()}init(){this.createModel()}createModel(e="sequential"){return e.toLowerCase(),this.model=m.sequential(),this.model}addLayer(e){const t=e||{};this.model.add(t),this.model.layers.length>=2&&(this.isLayered=!0)}compile(e){this.model.compile(e),this.isCompiled=!0}setOptimizerFunction(e,t){return t.call(this,e)}train(e,t){return kA(this.trainInternal(e),t)}async trainInternal(e){const t=e,n=t.inputs,r=t.outputs,{batchSize:i,epochs:a,shuffle:o,validationSplit:s,whileTraining:u}=t;await this.model.fit(n,r,{batchSize:i,epochs:a,shuffle:o,validationSplit:s,callbacks:u}),n.dispose(),r.dispose(),this.isTrained=!0}predictSync(e){const t=m.tidy((()=>this.model.predict(e))),n=t.arraySync();return t.dispose(),e.dispose(),n}async predict(e){const t=m.tidy((()=>this.model.predict(e))),n=await t.array();return t.dispose(),e.dispose(),n}async classify(e){return this.predict(e)}classifySync(e){return this.predictSync(e)}async save(e,t){let n,r;"function"==typeof e?(n="model",r=e):"string"==typeof e?(n=e,"function"==typeof t&&(r=t)):n="model",this.model.save(m.io.withSaveHandler((async e=>{this.weightsManifest={modelTopology:e.modelTopology,weightsManifest:[{paths:[`./${n}.weights.bin`],weights:e.weightSpecs}]},await Yk(e.weightData,`${n}.weights.bin`,"application/octet-stream"),await Yk(JSON.stringify(this.weightsManifest),`${n}.json`,"text/plain"),r&&r()})))}async load(e=null,t){if(e instanceof FileList){const t=await Promise.all(Array.from(e).map((async e=>e.name.includes(".json")&&!e.name.includes("_meta")?{name:"model",file:e}:e.name.includes(".json")&&e.name.includes("_meta.json")?{name:"metadata",file:await e.text()}:e.name.includes(".bin")?{name:"weights",file:e}:{name:null,file:null}))),n=t.find((e=>"model"===e.name)).file,r=t.find((e=>"weights"===e.name)).file;this.model=await m.loadLayersModel(m.io.browserFiles([n,r]))}else if(e instanceof Object){const t=await MA().get(e.model,{responseType:"text"}),n=JSON.stringify(t.data),r=new File([n],"model.json",{type:"application/json"}),i=(await MA().get(e.weights,{responseType:"blob"})).data,a=new File([i],"model.weights.bin",{type:"application/macbinary"});this.model=await m.loadLayersModel(m.io.browserFiles([r,a]))}else this.model=await m.loadLayersModel(e);return this.isCompiled=!0,this.isLayered=!0,this.isTrained=!0,t&&t(),this.model}dispose(){this.model.dispose()}mutate(e=.1,t){m.tidy((()=>{const n=this.model.getWeights(),r=[];for(let i=0;i<n.length;i+=1){const a=n[i],{shape:o}=n[i],s=a.dataSync().slice();for(let n=0;n<s.length;n+=1)Math.random()<e&&(s[n]=t?t(s[n]):Math.min(Math.max(s[n]+iM(),-1),1));const u=m.tensor(s,o);r[i]=u}this.model.setWeights(r)}))}crossover(e){return m.tidy((()=>{const t=this.model.getWeights(),n=e.model.getWeights(),r=[];for(let e=0;e<t.length;e+=1){const i=t[e],a=n[e],{shape:o}=t[e],s=i.dataSync().slice(),u=a.dataSync().slice();for(let e=0;e<s.length;e+=1)Math.random()<.5&&(s[e]=u[e]);const c=m.tensor(s,o);r[e]=c}this.model.setWeights(r)}))}},this.neuralNetworkData=new class{constructor(){this.meta={inputUnits:null,outputUnits:null,inputs:{},outputs:{},isNormalized:!1},this.isMetadataReady=!1,this.isWarmedUp=!1,this.data={raw:[]},this.createMetadata=this.createMetadata.bind(this),this.getDataStats=this.getDataStats.bind(this),this.getInputMetaStats=this.getInputMetaStats.bind(this),this.getDataUnits=this.getDataUnits.bind(this),this.getInputMetaUnits=this.getInputMetaUnits.bind(this),this.getDTypesFromData=this.getDTypesFromData.bind(this),this.addData=this.addData.bind(this),this.convertRawToTensors=this.convertRawToTensors.bind(this),this.normalizeDataRaw=this.normalizeDataRaw.bind(this),this.normalizeInputData=this.normalizeInputData.bind(this),this.normalizeArray=this.normalizeArray.bind(this),this.unnormalizeArray=this.unnormalizeArray.bind(this),this.applyOneHotEncodingsToDataRaw=this.applyOneHotEncodingsToDataRaw.bind(this),this.getDataOneHot=this.getDataOneHot.bind(this),this.getInputMetaOneHot=this.getInputMetaOneHot.bind(this),this.createOneHotEncodings=this.createOneHotEncodings.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadJSON=this.loadJSON.bind(this),this.loadCSV=this.loadCSV.bind(this),this.loadBlob=this.loadBlob.bind(this),this.loadData=this.loadData.bind(this),this.saveData=this.saveData.bind(this),this.saveMeta=this.saveMeta.bind(this),this.loadMeta=this.loadMeta.bind(this),this.findEntries=this.findEntries.bind(this),this.formatRawData=this.formatRawData.bind(this),this.csvToJSON=this.csvToJSON.bind(this)}createMetadata(e,t=null){return this.getDTypesFromData(e),this.getDataStats(e),this.getDataOneHot(e),this.getDataUnits(e,t),this.isMetadataReady=!0,{...this.meta}}getDataStats(e){const t=Object.assign({},this.meta),n=this.getInputMetaStats(e,t.inputs,"xs"),r=this.getInputMetaStats(e,t.outputs,"ys");return t.inputs=n,t.outputs=r,this.meta={...this.meta,...t},t}getInputMetaStats(e,t,n){const r=Object.assign({},t);return Object.keys(r).forEach((t=>{if("string"===r[t].dtype)r[t].min=0,r[t].max=1;else if("number"===r[t].dtype){const i=e.map((e=>e[n][t]));r[t].min=aM.getMin(i),r[t].max=aM.getMax(i)}else if("array"===r[t].dtype){const i=e.map((e=>e[n][t])).flat();r[t].min=aM.getMin(i),r[t].max=aM.getMax(i)}})),r}getDataUnits(e,t=null){const n=null!==t?t:void 0,r=Object.assign({},this.meta);let i;i=n||[this.getInputMetaUnits(e,r.inputs)].flat();const a=this.getInputMetaUnits(e,r.outputs);return r.inputUnits=i,r.outputUnits=a,this.meta={...this.meta,...r},r}getInputMetaUnits(e,t){let n=0;const r=Object.assign({},t);return Object.entries(r).forEach((e=>{const{dtype:t}=e[1];if("number"===t)n+=1;else if("string"===t){const{uniqueValues:t}=e[1],r=t.length;n+=r}else"array"===t&&(n=[])})),n}getDTypesFromData(e){const t={...this.meta,inputs:{},outputs:{}},n=e[0],r=Object.keys(n.xs),i=Object.keys(n.ys);return r.forEach((e=>{t.inputs[e]={dtype:aM.getDataType(n.xs[e])}})),i.forEach((e=>{t.outputs[e]={dtype:aM.getDataType(n.ys[e])}})),this.meta=t,t}addData(e,t){this.data.raw.push({xs:e,ys:t})}convertRawToTensors(e){const t=Object.assign({},this.meta),n=e.length;return m.tidy((()=>{const r=[],i=[];return e.forEach((e=>{const n=Object.keys(t.inputs).map((t=>e.xs[t])).flat();r.push(n);const a=Object.keys(t.outputs).map((t=>e.ys[t])).flat();i.push(a)})),{inputs:m.tensor(r.flat(),[n,...t.inputUnits]),outputs:m.tensor(i.flat(),[n,t.outputUnits])}}))}normalizeDataRaw(e){const t=Object.assign({},this.meta),n=this.normalizeInputData(e,t.inputs,"xs"),r=this.normalizeInputData(e,t.outputs,"ys");return aM.zipArrays(n,r)}normalizeInputData(e,t,n){const r=e.length,i=Object.assign({},t),a={};Object.keys(i).forEach((t=>{const r={min:i[t].min,max:i[t].max},o=e.map((e=>e[n][t]));"string"===i[t].dtype?(r.legend=i[t].legend,a[t]=this.normalizeArray(o,r)):"number"===i[t].dtype?a[t]=this.normalizeArray(o,r):"array"===i[t].dtype&&(a[t]=o.map((e=>this.normalizeArray(e,r))))}));const o=[...new Array(r).fill(null)].map(((e,t)=>{const r={[n]:{}};return Object.keys(i).forEach((e=>{r[n][e]=a[e][t]})),r}));return o}normalizeArray(e,t){const{min:n,max:r}=t;if(t.legend){const n=e.map((e=>t.legend[e]?t.legend[e]:e));return n}if(e.every((e=>"number"==typeof e))){const t=e.map((e=>aM.normalizeValue(e,n,r)));return t}throw new Error("error in inputArray of normalizeArray() function")}unnormalizeArray(e,t){const{min:n,max:r}=t;if(t.legend){const n=e.map((e=>{let n;return Object.entries(t.legend).forEach((t=>{const r=t[0],i=t[1],a=e.map(((e,t)=>e===i[t])).every((e=>!0===e));a&&(n=r)})),n}));return n}if(e.every((e=>"number"==typeof e))){const t=e.map((e=>aM.unnormalizeValue(e,n,r)));return t}throw new Error("error in inputArray of normalizeArray() function")}applyOneHotEncodingsToDataRaw(e){const t=Object.assign({},this.meta),n=e.map((e=>{const n={...e.xs},r={...e.ys};return Object.keys(t.inputs).forEach((r=>{t.inputs[r].legend&&(n[r]=t.inputs[r].legend[e.xs[r]])})),Object.keys(t.outputs).forEach((n=>{t.outputs[n].legend&&(r[n]=t.outputs[n].legend[e.ys[n]])})),{xs:n,ys:r}}));return n}getDataOneHot(e){const t=Object.assign({},this.meta),n=this.getInputMetaOneHot(e,t.inputs,"xs"),r=this.getInputMetaOneHot(e,t.outputs,"ys");return t.inputs=n,t.outputs=r,this.meta={...this.meta,...t},t}getInputMetaOneHot(e,t,n){const r=Object.assign({},t);return Object.entries(r).forEach((t=>{const i=t[0],{dtype:a}=t[1];if("string"===a){const t=[...new Set(e.map((e=>e[n][i])))],a=this.createOneHotEncodings(t);r[i]={...r[i],...a}}})),r}createOneHotEncodings(e){return m.tidy((()=>{const t={uniqueValues:e,legend:{}},n=e,r=n.map(((e,t)=>t)),i=m.oneHot(m.tensor1d(r,"int32"),n.length).arraySync();return n.forEach(((e,n)=>{t.legend[e]=i[n]})),t}))}async loadDataFromUrl(e,t,n){try{let r;if(e.endsWith(".csv"))r=await this.loadCSV(e,t,n);else if(e.endsWith(".json"))r=await this.loadJSON(e,t,n);else{if(!e.includes("blob"))throw new Error("Not a valid data format. Must be csv or json");r=await this.loadBlob(e,t,n)}return r}catch(e){throw console.error(e),new Error(e)}}async loadJSON(e,t,n){try{let r;if(e instanceof Object)r=Object.assign({},e);else{const{data:t}=await MA().get(e);r=t}return this.formatRawData(r,t,n)}catch(e){throw console.error("error loading json"),new Error(e)}}async loadCSV(e,t,n){try{const r=m.data.csv(e),i={entries:await r.toArray()};return this.formatRawData(i,t,n)}catch(e){throw console.error("error loading csv",e),new Error(e)}}async loadBlob(e,t,n){try{const{data:r}=await MA().get(e),i=r;let a;if(aM.isJsonOrString(i)){const e=JSON.parse(i);a=await this.loadJSON(e,t,n)}else{const e=this.csvToJSON(i);a=await this.loadJSON(e,t,n)}return a}catch(e){throw console.log("mmm might be passing in a string or something!",e),new Error(e)}}async loadData(e=null,t){try{let n;if("string"!=typeof e){const t=e[0];if((new FileReader).readAsText(t),t.name.includes(".json")){const e=await t.text();n=JSON.parse(e)}else console.log('data must be a json object containing an array called "data" or "entries')}else{n=await MA().get(e,{responseType:"text"});const t=JSON.stringify(n.data);aM.isJsonOrString(t)?n=JSON.parse(t):console.log("Whoops! something went wrong. Either this kind of data is not supported yet or there is an issue with .loadData")}this.data.raw=this.findEntries(n),!this.data.raw.length>0&&console.log('data must be a json object containing an array called "data" '),t&&t()}catch(e){throw new Error(e)}}async saveData(e){const t=new Date;let n=`${String(t.getFullYear())}-${String(t.getMonth()+1)}-${String(t.getDate())}_${String(t.getHours())}-${String(t.getMinutes())}-${String(t.getSeconds())}`;e&&(n=e);const r={data:this.data.raw};await Yk(JSON.stringify(r),`${n}.json`,"text/plain")}async saveMeta(e,t){let n,r;"function"==typeof e?(n="model",r=e):"string"==typeof e?(n=e,"function"==typeof t&&(r=t)):n="model",await Yk(JSON.stringify(this.meta),`${n}_meta.json`,"text/plain"),r&&r()}async loadMeta(e=null,t){if(e instanceof FileList){const t=await Promise.all(Array.from(e).map((async e=>e.name.includes(".json")&&!e.name.includes("_meta")?{name:"model",file:e}:e.name.includes(".json")&&e.name.includes("_meta.json")?{name:"metadata",file:await e.text()}:e.name.includes(".bin")?{name:"weights",file:e}:{name:null,file:null}))),n=JSON.parse(t.find((e=>"metadata"===e.name)).file);this.meta=n}else if(e instanceof Object){let t=await MA().get(e.metadata,{responseType:"text"});t=JSON.stringify(t.data),t=JSON.parse(t),this.meta=t}else{const t=`${e.substring(0,e.lastIndexOf("/"))}/model_meta.json`;let n=await MA().get(t);n=n.data,this.meta=n}return this.isMetadataReady=!0,this.isWarmedUp=!0,t&&t(),this.meta}formatRawData(e,t,n){const r=this.findEntries(e);!r.length>0&&console.log("your data must be contained in an array in \n\n        a property called 'entries' or 'data' of your json object");const i=r.map(((e,r)=>{const i={xs:{},ys:{}};return t.forEach((t=>{void 0!==e[t]?i.xs[t]=e[t]:console.error(`the input label ${t} does not exist at row ${r}`)})),n.forEach((t=>{void 0!==e[t]?i.ys[t]=e[t]:console.error(`the output label ${t} does not exist at row ${r}`)})),i}));return this.data.raw=i,i}csvToJSON(e){const t=e.split("\n"),n=[],r=t[0].split(",");for(let e=1;e<t.length;e+=1){const i={},a=t[e].split(",");r.forEach(((e,t)=>{i[e]=a[t]})),n.push(i)}return{entries:n}}findEntries(e){const t=Object.assign({},e);return t.entries&&t.entries instanceof Array?t.entries:t.data&&t.data instanceof Array?t.data:(Object.keys(t).forEach((e=>{if("object"==typeof t[e])return this.findEntries(t[e])})),t)}},this.neuralNetworkVis=new class{constructor(){this.config={height:300}}modelSummary(e,t){const n={...e};AA.show.modelSummary(n,t)}scatterplot(e,t,n){const r=n.map((n=>({x:n.xs[e],y:n.ys[t]}))),i={xLabel:"X",yLabel:"Y",height:this.config.height};AA.render.scatterplot({name:"debug mode"},r,i)}scatterplotAll(e,t,n){let r=[];e.forEach((e=>{t.forEach((t=>{const i=n.map((n=>({x:n.xs[e],y:n.ys[t]})));r=[...r,...i]}))}));const i={xLabel:"X",yLabel:"Y",height:this.config.height};AA.render.scatterplot({name:"debug mode"},r,i)}barchart(e,t,n){const r=n.map((n=>({value:n.xs[e],index:n.ys[t]}))),i={xLabel:"label",yLabel:"value",height:this.config.height};console.log(i),AA.render.barchart({name:"Bar chart"},r)}trainingVis(){return AA.show.fitCallbacks({name:"Training Performance"},["loss","accuracy"],{height:this.config.height,callbacks:["onEpochEnd"]})}},this.data={training:[]},this.ready=!1,this.init=this.init.bind(this),this.addData=this.addData.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadDataInternal=this.loadDataInternal.bind(this),this.createMetaData=this.createMetaData.bind(this),this.prepareForTraining=this.prepareForTraining.bind(this),this.normalizeData=this.normalizeData.bind(this),this.normalizeInput=this.normalizeInput.bind(this),this.searchAndFormat=this.searchAndFormat.bind(this),this.formatInputItem=this.formatInputItem.bind(this),this.convertTrainingDataToTensors=this.convertTrainingDataToTensors.bind(this),this.formatInputsForPrediction=this.formatInputsForPrediction.bind(this),this.formatInputsForPredictionAll=this.formatInputsForPredictionAll.bind(this),this.isOneHotEncodedOrNormalized=this.isOneHotEncodedOrNormalized.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.addLayer=this.addLayer.bind(this),this.createNetworkLayers=this.createNetworkLayers.bind(this),this.addDefaultLayers=this.addDefaultLayers.bind(this),this.compile=this.compile.bind(this),this.predict=this.predict.bind(this),this.predictMultiple=this.predictMultiple.bind(this),this.classify=this.classify.bind(this),this.classifyMultiple=this.classifyMultiple.bind(this),this.predictInternal=this.predictInternal.bind(this),this.classifyInternal=this.classifyInternal.bind(this),this.saveData=this.saveData.bind(this),this.loadData=this.loadData.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.dispose=this.dispose.bind(this),this.mutate=this.mutate.bind(this),this.crossover=this.crossover.bind(this),this.init(this.callback)}init(e){!0===this.options.noTraining&&this.createLayersNoTraining(),null!==this.options.dataUrl?this.ready=this.loadDataFromUrl(this.options,e):null!==this.options.modelUrl?this.ready=this.load(this.options.modelUrl,e):this.ready=!0}createLayersNoTraining(){const{inputs:e,outputs:t,task:n}=this.options;if("classification"===n)for(let n=0;n<t.length;n+=1){const r=new Array(e).fill(0);this.addData(r,[t[n]])}else{const n=new Array(e).fill(0),r=new Array(t).fill(0);this.addData(n,r)}this.neuralNetworkData.createMetadata(this.neuralNetworkData.data.raw),this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)}copy(){const e=new sM(this.options);return m.tidy((()=>{const t=this.neuralNetwork.model.getWeights(),n=[];for(let e=0;e<t.length;e+=1)n[e]=t[e].clone();return e.neuralNetwork.model.setWeights(n),e}))}addData(e,t,n=null){const{inputs:r,outputs:i}=this.options;let a,o;if(null!==n?(a=n.inputLabels,o=n.outputLabels):r.length>0&&i.length>0?(r.every((e=>"string"==typeof e))&&(a=r),i.every((e=>"string"==typeof e))&&(o=i)):"object"==typeof e&&"object"==typeof t?(a=Object.keys(e),o=Object.keys(t)):(a=aM.createLabelsFromArrayValues(e,"input"),o=aM.createLabelsFromArrayValues(t,"output")),!(a instanceof Array))throw new Error("inputLabels must be an array");if(!(o instanceof Array))throw new Error("outputLabels must be an array");const s=this.searchAndFormat(e),u=aM.formatDataAsObject(s,a),c=aM.formatDataAsObject(t,o);this.neuralNetworkData.addData(u,c)}loadDataFromUrl(e,t){return kA(this.loadDataInternal(e),t)}async loadDataInternal(e){const{dataUrl:t,inputs:n,outputs:r}=e,i=await this.neuralNetworkData.loadDataFromUrl(t,n,r);this.createMetadata(i),this.prepareForTraining(i)}createMetaData(e){const{inputs:t}=this.options;let n;Array.isArray(t)&&t.length>0&&(n=t.every((e=>"number"==typeof e))&&t.length>0?t:null),this.neuralNetworkData.createMetadata(e,n)}prepareForTraining(e=null){const t=null===e?this.neuralNetworkData.data.raw:e,n=this.neuralNetworkData.applyOneHotEncodingsToDataRaw(t);return this.data.training=n,this.neuralNetworkData.isWarmedUp=!0,n}normalizeData(e=null){const t=null===e?this.neuralNetworkData.data.raw:e;this.neuralNetworkData.isMetadataReady||this.createMetaData(t),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(t);const n=this.neuralNetworkData.normalizeDataRaw(t);return this.data.training=n,this.neuralNetworkData.meta.isNormalized=!0,n}normalizeInput(e,t,n){const r=t,{min:i,max:a}=n[r];return aM.normalizeValue(e,i,a)}searchAndFormat(e){let t;if(Array.isArray(e))t=e.map((e=>this.formatInputItem(e)));else if("object"==typeof e){const n=Object.assign({},e);Object.keys(e).forEach((t=>{const r=e[t];n[t]=this.formatInputItem(r)})),t=n}return t}formatInputItem(e){let t,n;return rk(e)?t=e:"object"==typeof e&&rk(e.elt)?t=e.elt:"object"==typeof e&&rk(e.canvas)&&(t=e.canvas),n=t?ik(t):e,n}convertTrainingDataToTensors(e=null,t=null){const n=null===e?this.data.training:e,r=null===t?this.neuralNetworkData.meta:t;return this.neuralNetworkData.convertRawToTensors(n,r)}formatInputsForPrediction(e,t,n){let r=[];return e instanceof Array?r=n.map(((n,r)=>this.isOneHotEncodedOrNormalized(e[r],n,t.inputs))):e instanceof Object&&(r=n.map((n=>this.isOneHotEncodedOrNormalized(e[n],n,t.inputs)))),r=r.flat(),r}formatInputsForPredictionAll(e,t,n){let r;return e instanceof Array&&e.every((e=>Array.isArray(e)))?(r=e.map((e=>this.formatInputsForPrediction(e,t,n))),m.tensor(r,[e.length,n.length])):(r=this.formatInputsForPrediction(e,t,n),m.tensor([r]))}isOneHotEncodedOrNormalized(e,t,n){const r=e,i=t;let a;return"number"!=typeof e?a=n[i].legend[r]:(a=e,this.neuralNetworkData.meta.isNormalized&&(a=this.normalizeInput(e,i,n))),a}train(e,t,n){let r,i,a;"object"==typeof e&&"function"==typeof t&&"function"==typeof n?(r=e,i=t,a=n):"object"==typeof e&&"function"==typeof t?(r=e,i=null,a=t):"function"==typeof e&&"function"==typeof t?(r={},i=e,a=t):(r={},i=null,a=e),this.trainInternal(r,i,a)}trainInternal(e,t,n){const r={epochs:10,batchSize:32,validationSplit:.1,whileTraining:null,...e};if(!0===this.options.debug||"true"===this.options.debug?r.whileTraining=[this.neuralNetworkVis.trainingVis(),{onEpochEnd:t}]:r.whileTraining=[{onEpochEnd:t}],this.neuralNetworkData.isMetadataReady||this.createMetaData(this.neuralNetworkData.data.raw),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(this.neuralNetworkData.data.raw),!r.inputs&&!r.outputs){const{inputs:e,outputs:t}=this.convertTrainingDataToTensors();r.inputs=e,r.outputs=t}this.neuralNetwork.isLayered||(this.options.layers=this.createNetworkLayers(this.options.layers,this.neuralNetworkData.meta)),this.neuralNetwork.isLayered||(this.options.layers=this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)),this.neuralNetwork.isCompiled||this.compile(),this.neuralNetwork.train(r,n)}addLayer(e){this.neuralNetwork.addLayer(e)}createNetworkLayers(e,t){const n=[...e],{inputUnits:r,outputUnits:i}=Object.assign({},t),a=n.length;if(!(n.length>=2))return!1;n[0].inputShape=n[0].inputShape?n[0].inputShape:r;const o=n[a-1];return o.units=o.units?o.units:i,n.forEach((e=>{this.addLayer(m.layers[e.type](e))})),n}addDefaultLayers(e,t){let n;switch(e.toLowerCase()){case"classification":return n=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"softmax"}],this.createNetworkLayers(n,t);case"regression":return n=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(n,t);case"imageclassification":return n=[{type:"conv2d",filters:8,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"conv2d",filters:16,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"flatten"},{type:"dense",kernelInitializer:"varianceScaling",activation:"softmax"}],this.createNetworkLayers(n,t);default:return console.log("no imputUnits or outputUnits defined"),n=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(n,t)}}compile(e=null,t=null){const n=null===t?this.options.learningRate:t;let r={};null!==e?r={...e}:"classification"===this.options.task||"imageClassification"===this.options.task?r={loss:"categoricalCrossentropy",optimizer:m.train.sgd,metrics:["accuracy"]}:"regression"===this.options.task&&(r={loss:"meanSquaredError",optimizer:m.train.adam,metrics:["accuracy"]}),r.optimizer=r.optimizer?this.neuralNetwork.setOptimizerFunction(n,r.optimizer):this.neuralNetwork.setOptimizerFunction(n,m.train.sgd),this.neuralNetwork.compile(r),this.options.debug&&this.neuralNetworkVis.modelSummary({name:"Model Summary"},this.neuralNetwork.model)}predictSync(e){return this.predictSyncInternal(e)}predict(e,t){return kA(this.predictInternal(e),t)}predictMultiple(e,t){return kA(this.predictInternal(e),t)}classifySync(e){return this.classifySyncInternal(e)}classify(e,t){return kA(this.classifyInternal(e),t)}classifyMultiple(e,t){return kA(this.classifyInternal(e),t)}predictSyncInternal(e){const{meta:t}=this.neuralNetworkData,n=Object.keys(t.inputs),r=this.formatInputsForPredictionAll(e,t,n),i=this.neuralNetwork.predictSync(r);if(r.dispose(),null!==t){const e=Object.keys(t.outputs),n=i.map((n=>e.map(((r,i)=>{let a,o;if(t.isNormalized){const{min:e,max:s}=t.outputs[r];a=aM.unnormalizeValue(n[i],e,s),o=n[i]}else a=n[i];const s={[e[i]]:a,label:r,value:a};return o&&(s.unNormalizedValue=o),s}))));return n.length<2?n[0]:n}return i}async predictInternal(e){const{meta:t}=this.neuralNetworkData,n=Object.keys(t.inputs),r=this.formatInputsForPredictionAll(e,t,n),i=await this.neuralNetwork.predict(r);if(r.dispose(),null!==t){const e=Object.keys(t.outputs),n=i.map((n=>e.map(((r,i)=>{let a,o;if(t.isNormalized){const{min:e,max:s}=t.outputs[r];a=aM.unnormalizeValue(n[i],e,s),o=n[i]}else a=n[i];const s={[e[i]]:a,label:r,value:a};return o&&(s.unNormalizedValue=o),s}))));return n.length<2?n[0]:n}return i}classifySyncInternal(e){const{meta:t}=this.neuralNetworkData,n=Object.keys(t.inputs);let r;if("imageClassification"===this.options.task){if(r=this.searchAndFormat(e),r=Array.isArray(r)?r.flat():r[n[0]],t.isNormalized){const{min:e,max:i}=t.inputs[n[0]];r=this.neuralNetworkData.normalizeArray(Array.from(r),{min:e,max:i})}else r=Array.from(r);r=m.tensor([r],[1,...t.inputUnits])}else r=this.formatInputsForPredictionAll(e,t,n);const i=this.neuralNetwork.classifySync(r);if(r.dispose(),null!==t){const e=Object.keys(t.outputs)[0],n=Object.entries(t.outputs[e].legend),r=i.map((e=>n.map(((t,n)=>({[t[0]]:e[n],label:t[0],confidence:e[n]}))).sort(((e,t)=>t.confidence-e.confidence))));return r.length<2?r[0]:r}return i}async classifyInternal(e){const{meta:t}=this.neuralNetworkData,n=Object.keys(t.inputs);let r;if("imageClassification"===this.options.task){if(r=this.searchAndFormat(e),r=Array.isArray(r)?r.flat():r[n[0]],t.isNormalized){const{min:e,max:i}=t.inputs[n[0]];r=this.neuralNetworkData.normalizeArray(Array.from(r),{min:e,max:i})}else r=Array.from(r);r=m.tensor([r],[1,...t.inputUnits])}else r=this.formatInputsForPredictionAll(e,t,n);const i=await this.neuralNetwork.classify(r);if(r.dispose(),null!==t){const e=Object.keys(t.outputs)[0],n=Object.entries(t.outputs[e].legend),r=i.map((e=>n.map(((t,n)=>({[t[0]]:e[n],label:t[0],confidence:e[n]}))).sort(((e,t)=>t.confidence-e.confidence))));return r.length<2?r[0]:r}return i}saveData(e){this.neuralNetworkData.saveData(e)}async loadData(e=null,t){this.neuralNetworkData.loadData(e,t)}save(e,t){let n,r;"function"==typeof e?(n="model",r=e):"string"==typeof e?(n=e,"function"==typeof t&&(r=t)):n="model",this.neuralNetwork.save(n,(()=>{this.neuralNetworkData.saveMeta(n,r)}))}async load(e=null,t){let n;t&&(n=t),this.neuralNetwork.load(e,(()=>(this.neuralNetworkData.loadMeta(e,n),this.neuralNetwork.model)))}dispose(){this.neuralNetwork.dispose()}mutate(e,t){this.neuralNetwork.mutate(e,t)}crossover(e){const t=this.copy();return t.neuralNetwork.crossover(e.neuralNetwork),t}}var uM=function(e,t){return(uM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function cM(e,t){function n(){this.constructor=e}uM(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function lM(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function fM(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var pM=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return hM(n,t[0],t[1]),t.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,i)}))}},e}();function hM(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function dM(){return mM}var mM=null,gM=new Map,vM=new Map;function yM(e,t){var n=NM(e,t);return gM.get(n)}function bM(e){return vM.get(e)}function xM(e){for(var t=gM.entries(),n=[];;){var r=t.next(),i=r.done,a=r.value;if(i)break;var o=a[0],s=a[1];o.split("_")[0]===e&&n.push(s)}return n}function wM(e){var t=e.kernelName,n=e.backendName,r=NM(t,n);if(gM.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");gM.set(r,e)}function EM(e){var t=e.kernelName;vM.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),vM.set(t,e)}function CM(e,t){var n=NM(e,t);if(!gM.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is not registered");gM.delete(n)}function SM(e){if(!vM.has(e))throw new Error("The gradient '"+e+"' for backend is not registered");vM.delete(e)}function NM(e,t){return t+"_"+e}function AM(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function kM(e,t,n){return Math.max(e,Math.min(t,n))}function DM(e){return e%2==0?e:e+1}function _M(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function MM(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function TM(e,t,n){void 0===n&&(n=""),MM(RM(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function OM(e){MM(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function IM(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||XM(e)&&!n)for(var r=0;r<e.length;++r)IM(e[r],t,n);else t.push(e);return t}function FM(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function RM(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function BM(e){return e%1==0}function zM(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function PM(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function LM(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function jM(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0,o=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?i():setTimeout(o,s)}};o()}))}function UM(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function qM(e,t){var n=t.length;return MM((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),MM(e.every((function(e){return BM(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function WM(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:qM(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function VM(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function $M(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function HM(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function GM(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function KM(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function XM(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function YM(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function JM(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function ZM(e){return"string"==typeof e||e instanceof String}function QM(e){return"boolean"==typeof e}function eT(e){return"number"==typeof e}function tT(e){return Array.isArray(e)?tT(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":eT(e)?"float32":ZM(e)?"string":QM(e)?"bool":"float32"}function nT(e){return!!(e&&e.constructor&&e.call&&e.apply)}function rT(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function iT(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function aT(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=IM(e)),n&&HM(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function oT(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var a=n[0],o=0;o<a;o++)i[o]=r[t+o];else{a=n[0];var s=n.slice(1),u=s.reduce((function(e,t){return e*t}));for(o=0;o<a;o++)i[o]=e(t+o*u,s,r)}return i}(0,e,t)}function sT(e,t){for(var n=uT(e,t),r=0;r<n.length;r++)n[r]=1;return n}function uT(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function cT(){return dM().platform.now()}function lT(e){e.forEach((function(t){MM(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function fT(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",dM().platform.encode(e,t)}function pT(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",dM().platform.decode(e,t)}function hT(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function dT(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}var mT=Object.freeze({shuffle:AM,clamp:kM,nearestLargerEven:DM,sum:_M,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},assert:MM,assertShapesMatch:TM,assertNonNull:OM,flatten:IM,sizeFromShape:FM,isScalarShape:function(e){return 0===e.length},arraysEqual:RM,isInt:BM,tanh:zM,sizeToSquarishShape:PM,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return AM(t),t},rightPad:LM,repeatedTry:jM,inferFromImplicitShape:UM,parseAxisParam:qM,squeezeShape:WM,getTypedArrayFromDType:VM,getArrayFromDType:$M,checkConversionForErrors:HM,isValidDtype:GM,hasEncodingLoss:KM,isTypedArray:XM,bytesPerElement:YM,bytesFromStringArray:JM,isString:ZM,isBoolean:QM,isNumber:eT,inferDtype:tT,isFunction:nT,nearestDivisor:rT,computeStrides:iT,toTypedArray:aT,toNestedArray:oT,makeOnesTypedArray:sT,makeZerosTypedArray:uT,now:cT,assertNonNegativeIntegerDimensions:lT,fetch:function(e,t){return dM().platform.fetch(e,t)},encodeString:fT,decodeString:pT,locToIndex:hT,indexToLoc:dT}),gT=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new vT)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then((function(a){var o="";null!=a.getExtraProfileInfo&&(o=a.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,a.kernelMs,t,o)}))}))})),r},e}(),vT=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,i,a){var o="number"==typeof r?LM(r+"ms",9):r.error,s=LM(e,25),u=t.rank,c=t.size,l=LM(t.shape.toString(),14),f="";for(var p in i){var h=i[p].shape||t.shape,d=h.length;f+=p+": "+d+"D "+(d>0?h:"")+" "}console.log("%c"+s+"\t%c"+o+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function yT(e,t,n){return LM(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":ZM(e)?"'"+e+"'":"bool"===n?bT(e):parseFloat(e.toFixed(7)).toString(),t)}function bT(e){return 0===e?"false":"true"}function xT(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var wT=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=FM(e),null!=n){var i=n.length;MM(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||$M(t,this.size),this.strides=iT(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),MM(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return ET().makeTensor(this.values,this.shape,this.dtype)},e}(),ET=null,CT=null,ST=null,NT=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=FM(e),this.strides=iT(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),MM(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),CT.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return lM(this,void 0,void 0,(function(){var e;return fM(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,CT.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return CT.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return lM(this,void 0,void 0,(function(){var e;return fM(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,oT(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return oT(this.shape,this.dataSync())},e.prototype.data=function(){return lM(this,void 0,void 0,(function(){var e,t;return fM(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=ET().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return pT(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=ET().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return pT(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return lM(this,void 0,void 0,(function(){var e;return fM(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ET().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(ET().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),CT.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),CT.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),CT.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),CT.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),CT.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),CT.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),CT.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var i=iT(t),a=function(e,t,n,r){var i=FM(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,u="complex64"===n?xT(e):e;if(s>1)for(var c=0;c<i/a;c++)for(var l=c*a,f=0;f<a;f++)o[f]=Math.max(o[f],yT(u[l+f],0,n).length);return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[yT(xT(t)[0],0,r)]:"bool"===r?[bT(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=3*s,f=Array.from(t.slice(0,l)),p=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(f=xT(f),p=xT(p)),["["+f.map((function(e,t){return yT(e,a[t],r)})).join(", ")+", ..., "+p.map((function(e,t){return yT(e,a[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?xT(t):Array.from(t)).map((function(e,t){return yT(e,a[t],r)})).join(", ")+"]"]}var h=n.slice(1),d=i.slice(1),m=i[0]*s,g=[];if(u>20){for(var v=0;v<3;v++){var y=(b=v*m)+m;g.push.apply(g,e(t.slice(b,y),h,r,d,a,!1))}for(g.push("..."),v=u-3;v<u;v++)y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),h,r,d,a,v===u-1))}else for(v=0;v<u;v++){var b;y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),h,r,d,a,v===u-1))}var x=2===c?",":"";for(g[0]="["+g[0]+x,v=1;v<g.length-1;v++)g[v]=" "+g[v]+x;var w=",\n";for(v=2;v<c;v++)w+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(o?"":w),g}(e,t,n,i,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),CT.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),CT.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),CT.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),CT.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),CT.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),CT.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),CT.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),CT.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),CT.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),CT.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),CT.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),CT.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),ST("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.batchNorm=function(e,t,n,r,i){return void 0===i&&(i=.001),this.throwIfDisposed(),CT.batchNorm(this,e,t,n,r,i)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),CT.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),CT.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),CT.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),CT.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),CT.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),CT.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),CT.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),CT.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),CT.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),CT.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),CT.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),CT.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),CT.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),CT.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),CT.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),CT.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),CT.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),CT.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),CT.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),CT.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),CT.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),CT.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),CT.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),CT.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),CT.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),CT.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),CT.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),CT.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),CT.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),CT.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),CT.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),CT.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),CT.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),CT.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),CT.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),CT.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),CT.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),CT.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),CT.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),CT.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),CT.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),CT.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),CT.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),CT.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),CT.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),CT.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),CT.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),CT.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),CT.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),CT.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),CT.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),CT.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),CT.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),CT.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),CT.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),CT.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),CT.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),CT.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),CT.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),CT.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),CT.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),CT.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),CT.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),CT.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),CT.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),CT.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),CT.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),CT.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),CT.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),CT.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),CT.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),CT.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),CT.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),CT.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),CT.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),CT.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),CT.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),CT.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),CT.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),CT.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),CT.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),CT.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),CT.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),CT.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),CT.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),CT.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),CT.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),CT.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),CT.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),CT.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),CT.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),CT.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),CT.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),CT.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),CT.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),CT.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),CT.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),CT.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),CT.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),CT.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),CT.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),CT.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),CT.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),CT.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),CT.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),ET().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),CT.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),CT.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),CT.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),CT.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),CT.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),CT.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),CT.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),CT.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),CT.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),CT.spectral.irfft(this)},e}();Object.defineProperty(NT,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var AT,kT,DT,_T,MT,TT=function(e){function t(t,n,r,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=r,a}return cM(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!RM(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");ET().disposeTensor(this),this.dataId=e.dataId,ET().incRef(this,null)},t.prototype.dispose=function(){ET().disposeVariable(this),this.isDisposedInternal=!0},t}(NT);Object.defineProperty(TT,Symbol.hasInstance,{value:function(e){return e instanceof NT&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(AT||(AT={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(kT||(kT={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(DT||(DT={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(_T||(_T={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(MT||(MT={}));var OT={float32:_T,int32:kT,bool:DT,complex64:MT};function IT(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return OT[e][t]}function FT(e){return IT(e,"int32")}function RT(e,t){if(e.dtype===t.dtype)return[e,t];var n=IT(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function BT(e,t){MM(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function zT(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof NT)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,a=t;for(var o in a){var s=a[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var PT,LT=Object.freeze({makeTypesMatch:RT,assertTypesMatch:BT,isTensorInList:function(e,t){return t.some((function(t){return t.id===e.id}))},getTensorsInContainer:zT}),jT=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),UT=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new jT}return e.prototype.ready=function(){return lM(this,void 0,void 0,(function(){var e,t,n;return fM(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return lM(this,void 0,void 0,(function(){var t,n,r;return fM(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new gT(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;xM(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;xM(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return!(i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[]),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,a,o){var s,u=this;void 0===a&&(a=[]),void 0===o&&(o=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,p=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))},h=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=yM(r,this.backendName);return f=null!=g?function(){var e=u.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:i,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)})),c=s.filter((function(e,t){return o[t]}));return p((a||[]).slice().concat(c)),s}:function(){var t=u.backend.numDataIds();m=u.tidy((function(){return e(u.backend,p)}));var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return f()})):f()})),l&&this.addTapeNode(r,t,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(m)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=e;"string"===n&&ZM(e[0])&&(i=e.map((function(e){return fT(e)})));var a=r.write(i,t,n),o=new NT(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(a),u=JM(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var i=new NT(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new TT(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*YM(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof TT||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return lM(this,void 0,void 0,(function(){var t,n;return fM(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i){var a=this,o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},s=bM(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=uT(r.size,r.dtype);return a.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i)}),this.state.activeTape.push(o)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=zT(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;if(void 0===r&&(r=!1),MM(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",e)}));MM(a instanceof NT,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(d=e[a]).inputs;for(var s in o){for(var u=o[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){d.outputs.forEach((function(e){return r[e.id]=!0})),c=!0,i[d.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var p={};for(a=e.length-1;a>=0;a--)for(o=(d=e[a]).inputs,l=0;l<d.outputs.length;l++)if(f[d.outputs[l].id]){for(var s in o)f[o[s].id]=!0,p[d.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var d;if(i[(d=e[a]).id]&&p[d.id]){var m={};for(var s in d.inputs){var g=d.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},d);v.inputs=m,v.outputs=d.outputs,h.push(v)}}return h}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[a.id]=null==n?(r=sT(FM(e=a.shape),"float32"),qT.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var i=t[r],a=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var o=i.gradient(a),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n((function(){return o[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=i.inputs[t];if(!RM(r.shape,a.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in i.inputs)s(u)},i=t.length-1;i>=0;i--)r(i)}(s,o,(function(e){return i.tidy(e)}));var u=t.map((function(e){return s[e.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),i.state.activeTape=null),{value:a,grads:u}}))},e.prototype.customGrad=function(e){var t=this;return MM(nT(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];MM(r.every((function(e){return e instanceof NT})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,i){return MM((n=e.apply(void 0,r.concat([i]))).value instanceof NT,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),MM(nT(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];MM(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),MM(a.every((function(e){return e instanceof NT})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return lM(this,void 0,void 0,(function(){var t,n;return fM(this,(function(r){switch(r.label){case 0:return t=cT(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=cT()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new jT,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),qT=function(){var e=function(){if(null==PT){var e=void 0;if("undefined"!=typeof window)e=window;else if(void 0!==n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}PT=e}return PT}();if(null==e._tfengine){var t=new pM(e);e._tfengine=new UT(t)}return function(e){mM=e}(e._tfengine.ENV),ET=function(){return e._tfengine},e._tfengine}();function WT(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var VT=dM();VT.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),VT.registerFlag("IS_BROWSER",(function(){return WT()})),VT.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),VT.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),VT.registerFlag("PROD",(function(){return!1})),VT.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return VT.getBool("DEBUG")})),VT.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),VT.registerFlag("IS_TEST",(function(){return!1}));var $T,HT,GT,KT={},XT={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function YT(e,t){KT[e]=t}function JT(e){e in KT||(KT[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete KT[e]}),!1),1===e?t.getContext("webgl",XT)||t.getContext("experimental-webgl",XT):t.getContext("webgl2",XT)}(e));var t=KT[e];return t.isContextLost()?(delete KT[e],JT(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),KT[e])}function ZT(e,t){return[t,e]}function QT(e){var t=FM(e);return PM(Math.ceil(t/4))}function eO(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function tO(e,t){var n,r,i,a,o,s,u,c,l,f=e;return 2===dM().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,i=f.RGBA16F,a=f.RGBA32F,o=f.RED,s=4,u=1,c=f.HALF_FLOAT,l=f.FLOAT):(n=e.RGBA,r=e.RGBA,i=e.RGBA,a=f.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function nO(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+iO(e,t))}(e),r}function rO(e){return!!(dM().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function iO(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function aO(e,t,n){return DO(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function oO(e,t,n){var r=DO(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(nO(e,t,(function(){return e.shaderSource(r,n)})),nO(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function sO(e,t,n){var r=DO(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(nO(e,t,(function(){return e.shaderSource(r,n)})),nO(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=lO.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,o=i.map((function(e,t){return LM((t+1).toString(),a)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),f=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+LM(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}($T||($T={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(HT||(HT={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(GT||(GT={}));var uO,cO,lO=/ERROR: [0-9]+:([0-9]+):/g;function fO(e,t){return DO(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function pO(e,t,n){if(nO(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function hO(e,t,n){if(nO(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function dO(e,t,n){var r=DO(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return nO(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),nO(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function mO(e,t,n){var r=DO(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return nO(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),nO(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function gO(e,t){return DO(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function vO(e,t){var n=dM().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function yO(e,t){return DO(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function bO(e,t,n,r,i,a,o,s){var u=e.getAttribLocation(n,r);return-1!==u&&(nO(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,i)})),nO(e,t,(function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,o,s)})),nO(e,t,(function(){return e.enableVertexAttribArray(u)})),!0)}function xO(e,t,n,r){_O(e,r),nO(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),nO(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function wO(e,t,n,r){return DO(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function EO(e,t,n){return e.getUniformLocation(t,n)}function CO(e,t,n,r,i,a){nO(e,t,(function(){return xO(e,t,r,a)})),nO(e,t,(function(){return e.uniform1i(i,a)}))}function SO(e,t,n,r){nO(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),nO(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function NO(e,t,n){nO(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),nO(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function AO(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+kO(e,t))}function kO(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function DO(e,t,n,r){var i=nO(e,t,(function(){return n()}));if(null==i)throw new Error(r);return i}function _O(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function MO(e,t){return void 0===t&&(t=2),FM(e.slice(0,e.length-t))}function TO(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function OO(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[MO(e)].concat(TO(e))),t}function IO(e,t){var n;void 0===t&&(t=!1);var r=dM().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?DM(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var i=WM(e);e=i.newShape}var a=FM(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=MO(e),s=2,u=2;return e.length&&(s=(n=TO(e))[0],u=n[1]),PM(a=o*(s/2)*(u/2)).map((function(e){return 2*e}))}return PM(a)}function FO(e){return e%2==0}function RO(e,t){if(RM(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(FO(n)&&FO(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&FO(e[0])&&FO(t[0])}function BO(e){if(null==uO){var t=JT(e);uO=t.getParameter(t.MAX_TEXTURE_SIZE)}return uO}function zO(e){if(null==cO){var t=JT(e);cO=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,cO)}function PO(e){if(0===e)return 0;var t=JT(e);return LO(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:LO(t,"EXT_disjoint_timer_query")?1:0}function LO(e,t){return null!=e.getExtension(t)}function jO(e){try{if(null!=JT(e))return!0}catch(e){return!1}return!1}function UO(e){if(0===e)return!1;var t=JT(e);if(1===e){if(!LO(t,"OES_texture_float"))return!1}else if(!LO(t,"EXT_color_buffer_float"))return!1;return WO(t)}function qO(e){if(0===e)return!1;var t=JT(e);if(1!==e){if(LO(t,"EXT_color_buffer_float"))return WO(t);if(LO(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=tO(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,n)}return!1}return!!LO(t,"OES_texture_float")&&!!LO(t,"WEBGL_color_buffer_float")&&WO(t)}function WO(e){var t=tO(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function VO(e){return 2===e&&null!=JT(e).fenceSync}var $O=Object.freeze({callAndCheck:nO,canBeRepresented:rO,getWebGLErrorMessage:iO,getExtensionOrThrow:aO,createVertexShader:oO,createFragmentShader:sO,createProgram:fO,linkProgram:pO,validateProgram:hO,createStaticVertexBuffer:dO,createStaticIndexBuffer:mO,getNumChannels:function(){return 2===dM().getNumber("WEBGL_VERSION")?1:4},createTexture:gO,validateTextureSize:vO,createFramebuffer:yO,bindVertexBufferToProgramAttribute:bO,bindTextureUnit:xO,unbindTextureUnit:function(e,t,n){_O(e,n),nO(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),nO(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:wO,getProgramUniformLocation:EO,bindTextureToProgramUniformSampler:CO,bindCanvasToFramebuffer:function(e,t){nO(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),nO(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),nO(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:SO,unbindColorTextureFromFramebuffer:NO,validateFramebuffer:AO,getFramebufferErrorMessage:kO,getBatchDim:MO,getRowsCols:TO,getShapeAs3D:OO,getTextureShapeFromLogicalShape:IO,isReshapeFree:RO,getWebGLMaxTextureSize:BO,resetMaxTextureSize:function(){uO=null},resetMaxTexturesInShader:function(){cO=null},getMaxTexturesInShader:zO,getWebGLDisjointQueryTimerVersion:PO,hasExtension:LO,isWebGLVersionEnabled:jO,isCapableOfRenderingToFloatTexture:UO,isDownloadFloatTextureEnabled:qO,isWebGLFenceEnabled:VO}),HO=dM();function GO(){dM().set("PROD",!0)}function KO(){dM().set("DEBUG",!0)}function XO(){dM().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function YO(e){dM().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function JO(){qT.disposeVariables()}function ZO(){return qT}function QO(){return qT.memory()}function eI(e){return qT.profile(e)}function tI(e,t){return qT.tidy(e,t)}function nI(e){zT(e).forEach((function(e){return e.dispose()}))}function rI(e){return qT.keep(e)}function iI(e){return qT.time(e)}function aI(e){return qT.setBackend(e)}function oI(){return qT.ready()}function sI(){return qT.backendName}function uI(e){qT.removeBackend(e)}function cI(e){return qT.findBackend(e)}function lI(e){return qT.findBackendFactory(e)}function fI(e,t,n){return void 0===n&&(n=1),qT.registerBackend(e,t,n)}function pI(){return qT.backend}function hI(e,t){dM().setPlatform(e,t)}function dI(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];dM().getBool("IS_TEST")||console.warn.apply(console,e)}function mI(e,t){var n=e;if(XM(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||XM(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&dM().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||XM(t)){MM(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),MM(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),a=0;a<t.length;++a)e(t[a],i,r.concat(a))}else MM(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function gI(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function vI(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof NT)return gI(r,e.dtype,t,n),e;var i=tT(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),gI(r,i,t,n),null==e||!XM(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=mI(e,i);XM(e)||Array.isArray(e)||(e=[e]);var s="string"!==i?aT(e,i,dM().getBool("DEBUG")):IM(e,[],!0);return qT.makeTensor(s,o,i)}function yI(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return vI(e,t+"["+r+"]",n)}),r)}function bI(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function xI(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function wI(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]}function EI(e,t){return xI(e,t.map((function(e){return 1})),t)}function CI(e,t,n){MM(bI(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function SI(e,t){if(bI(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function NI(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function AI(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function kI(e,t){var n=e[0].length;e.forEach((function(e,t){MM(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),MM(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,i){for(var a=0;a<n;a++)MM(a===t||e[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function DI(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function _I(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];qT.startScope(n);try{var i=r.apply(void 0,e);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),qT.endScope(i),i}catch(e){throw qT.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}HO.registerFlag("HAS_WEBGL",(function(){return HO.getNumber("WEBGL_VERSION")>0})),HO.registerFlag("WEBGL_VERSION",(function(){return jO(2)?2:jO(1)?1:0})),HO.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===HO.get("WEBGL_VERSION")})),HO.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),HO.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),HO.registerFlag("WEBGL_PACK",(function(){return HO.getBool("HAS_WEBGL")})),HO.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_PACK_CLIP",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),HO.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_PACK_REDUCE",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_CONV_IM2COL",(function(){return HO.getBool("WEBGL_PACK")})),HO.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return BO(HO.getNumber("WEBGL_VERSION"))})),HO.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return zO(HO.getNumber("WEBGL_VERSION"))})),HO.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=HO.getNumber("WEBGL_VERSION");return 0===e?0:PO(e)})),HO.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return HO.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),HO.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return UO(HO.getNumber("WEBGL_VERSION"))})),HO.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!HO.getBool("WEBGL_FORCE_F16_TEXTURES")&&HO.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),HO.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return qO(HO.getNumber("WEBGL_VERSION"))})),HO.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return VO(HO.getNumber("WEBGL_VERSION"))})),HO.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return HO.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),ST=YO;var MI=_I({complex_:function(e,t){var n=vI(e,"real","complex"),r=vI(t,"imag","complex");return TM(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),qT.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),TI=_I({real_:function(e){var t=vI(e,"input","real");return qT.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),OI=_I({imag_:function(e){var t=vI(e,"input","imag");return qT.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function II(e,t,n){return FI(e,t,mI(e,n),n)}function FI(e,t,n,r){if(null==r&&(r=tT(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!XM(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){lT(t);var i=FM(t),a=FM(n);MM(i===a,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==FM(t.slice(o));MM(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return XM(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?aT(e,r,dM().getBool("DEBUG")):IM(e,[],!0),qT.makeTensor(e,t,r)}function RI(e,t){if((XM(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&XM(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return FI(e,[],[],t)}function BI(e,t){OM(e);var n=mI(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return FI(e,null,n,t)}function zI(e,t,n){if(OM(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=mI(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return FI(e,t,r,n)}function PI(e,t,n){if(OM(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=mI(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return FI(e,t,r,n)}function LI(e,t,n){if(OM(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=mI(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return FI(e,t,r,n)}function jI(e,t,n){if(OM(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=mI(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return FI(e,t,r,n)}function UI(e,t,n){if(OM(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=mI(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return FI(e,t=t||r,r,n)}function qI(e,t,n,r){return void 0===t&&(t=!0),qT.makeVariable(e,t,n,r)}function WI(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=WI(e,"float32"),r=VI(e,"float32");return MI(n,r)}var i=sT(FM(e),t);return qT.makeTensor(i,e,t)}function VI(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=VI(e,"float32"),r=VI(e,"float32");return MI(n,r)}var i=uT(FM(e),t);return qT.makeTensor(i,e,t)}function $I(e,t,n){return qT.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function HI(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return qT.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})}function GI(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return VI([0],r);var i=uT(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return BI(i,r)}var KI=_I({onesLike_:function(e){var t=vI(e,"x","onesLike");if("complex64"===t.dtype){var n=KI(TI(t)),r=XI(OI(t));return MI(n,r)}return qT.runKernelFunc((function(e){return e.onesLike(t)}),{$x:t},(function(e,t){return{$x:function(){return XI(e)}}}))}}),XI=_I({zerosLike_:function(e){var t=vI(e,"x","zerosLike");return qT.runKernelFunc((function(e){return e.zerosLike(t)}),{$x:t},(function(e,t){return{$x:function(){return XI(e)}}}))}}),YI=_I({concat_:function(e,t){void 0===t&&(t=0),MM(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=yI(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=qM(t,n[0].shape)[0];var r=DI(n.map((function(e){return e.shape})),t);if(0===FM(r))return II([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var i=n.map((function(e){return e.shape}));kI(i,t);var a=n,o={axis:t};return qT.runKernelFunc((function(e){return e.concat(n,t)}),a,(function(e){var n=i.map((function(e){return e[t]}));return tF(e,n,t).map((function(e){return function(){return e}}))}),"Concat",o)}}),JI=_I({concat1d_:function(e){return YI(e,0)}}),ZI=_I({concat2d_:function(e,t){return YI(e,t)}}),QI=_I({concat3d_:function(e,t){return YI(e,t)}}),eF=_I({concat4d_:function(e,t){return YI(e,t)}}),tF=_I({split_:function(e,t,n){void 0===n&&(n=0);var r,i=vI(e,"x","split");return n=qM(n,i.shape)[0],"number"==typeof t?(MM(i.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(i.shape[n]/t)):(MM(i.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),qT.runKernelFunc((function(e){return e.split(i,r,n)}),{$x:i},(function(e){return{$x:function(){return YI(e,n)}}}))}});function nF(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self&&self;var rF=nF((function(e){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var n=new r(e),a=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.alea=a}(0,e)})),iF=nF((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xor128=a}(0,e)})),aF=nF((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xorwow=a}(0,e)})),oF=nF((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&(a.x&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xorshift7=a}(0,e)})),sF=nF((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&(a.X&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.xor4096=a}(0,e)})),uF=nF((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,a&&("object"==typeof a&&i(a,n),o.state=function(){return i(n,{})}),o}t&&t.exports?t.exports=a:this.tychei=a}(0,e)})),cF=nF((function(e){!function(t,r){var i,a=this,o=256,s="random",u=r.pow(o,6),c=r.pow(2,52),l=2*c,f=255;function p(e,n,f){var p=[],v=m(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,g(t)]}}():e,3),p),y=new h(p),b=function(){for(var e=y.g(6),t=u,n=0;e<c;)e=(e+n)*o,t*=o,n=y.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,m(g(y.S),t),(n.pass||f||function(e,t,n,i){return i&&(i.S&&d(i,y),e.state=function(){return d(y,{})}),n?(r[s]=e,t):e})(b,v,"global"in n?n.global:this==r,n.state)}function h(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=f&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=f&i+1],n=n*o+s[f&(s[i]=s[a=f&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",i=0;i<r.length;)t[f&i]=f&(n^=19*t[f&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=p,m(r.random(),t),e.exports){e.exports=p;try{i=n(8369)}catch(e){}}}([],Math)}));cF.alea=rF,cF.xor128=iF,cF.xorwow=aF,cF.xorshift7=oF,cF.xor4096=sF,cF.tychei=uF;var lF=cF.alea,fF=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=lF(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,a=void 0,o=void 0;do{o=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),pF=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var i=r||Math.random();this.randu=lF(i.toString()),this.randn=new fF(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,i,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(i=this.randu())<t||Math.log(i)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),hF=function(){function e(e,t,n,r){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=lF(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function dF(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",lT(e),new wT(e,t,n)}function mF(e,t){void 0===t&&(t=!1),console.log(e.toString(t))}var gF=_I({batchToSpaceND_:function(e,t,n){var r=vI(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return MM(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),MM(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),MM(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),qT.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),vF=_I({broadcastTo_:function(e,t){var n=vI(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var i=n.shape.slice();i.length<t.length;)i.unshift(1);n=n.reshape(i)}for(var a=Array.from(t),o=t.length-1;o>=0;o--)if(n.shape[o]===t[o])a[o]=1;else if(1!==n.shape[o])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=a.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));return 0===s.length?n.clone():qT.runKernelFunc((function(e){return e.tile(n,a)}),{input:n},(function(e){return{input:function(){return e.sum(s,!0)}}}))}}),yF=_I({cast_:function(e,t){var n=vI(e,"x","cast");if(!GM(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return qT.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),bF=_I({clone_:function(e){var t=vI(e,"x","clone",null);return qT.runKernelFunc((function(){return qT.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),xF=_I({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=vI(e,"x","cumsum"),a=SI([t|=0],i.rank),o=i;null!=a&&(o=i.transpose(a));var s=AI(1,i.rank)[0],u=qT.runKernelFunc((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(u=u.transpose(a)),u}}),wF=_I({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=vI(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return MM(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),MM(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),MM(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape})),qT.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),EF=_I({expandDims_:function(e,t){void 0===t&&(t=0);var n=vI(e,"x","expandDims",null);MM(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(MM(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),RF(n,r)}}),CF=_I({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=dF([e,t],r),a=e<=t?e:t,o=0;o<a;++o)i.set(1,o,o);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return LF(EF(s,0),[n[0],1,1]);if(2===n.length)return LF(EF(EF(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return LF(EF(EF(EF(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),SF=_I({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=vI(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?i.as2D(1,-1):i,u=qT.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?u.as1D():u}}),NF=_I({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=vI(e,"indices","oneHot","int32"),a=i.shape.concat([t]);return i=i.flatten(),qT.runKernelFunc((function(e){return e.oneHot(i,t,n,r)}),{$indices:i},(function(e){return{$indices:function(){return VI(i.shape,"float32")}}})).reshape(a)}}),AF=_I({pad_:function(e,t,n){void 0===n&&(n=0);var r=vI(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:t,constantValue:n};return qT.runKernelFunc((function(e){return e.pad(r,t,n)}),{x:r},(function(e){var n=t.map((function(e){return e[0]}));return{x:function(){return e.slice(n,r.shape)}}}),"PadV2",i)}}),kF=_I({pad1d_:function(e,t,n){return void 0===n&&(n=0),MM(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),AF(e,[t],n)}}),DF=_I({pad2d_:function(e,t,n){return void 0===n&&(n=0),MM(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),AF(e,t,n)}}),_F=_I({pad3d_:function(e,t,n){return void 0===n&&(n=0),MM(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),AF(e,t,n)}}),MF=_I({pad4d_:function(e,t,n){return void 0===n&&(n=0),MM(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),AF(e,t,n)}}),TF=_I({rand_:function(e,t,n){var r=FM(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=t();return qT.makeTensor(i,e,n)}}),OF=_I({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new fF(t,n,r,!1,i),o=dF(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),IF=_I({randomGamma_:function(e,t,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new pF(t,n,r,i),o=dF(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),FF=_I({randomUniform_:function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=dF(e,r),o=new hF(t,n,null,i),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),RF=_I({reshape_:function(e,t){var n=vI(e,"x","reshape",null);t=UM(t,n.size),MM(n.size===FM(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return qT.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),BF=_I({spaceToBatchND_:function(e,t,n){var r=vI(e,"x","spaceToBatchND");return MM(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),MM(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),MM(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),qT.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),zF=_I({squeeze_:function(e,t){var n=vI(e,"x","squeeze");return RF(n,WM(n.shape,t).newShape)}}),PF=_I({stack_:function(e,t){void 0===t&&(t=0);var n=yI(e,"tensors","stack");if(MM(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,a=n[0].dtype;MM(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){TM(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){MM(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return YI(o,t)}}),LF=_I({tile_:function(e,t){var n=vI(e,"x","tile",null);MM(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var r=[n],i={reps:t};return qT.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),{x:n},(function(e,n){var r=n[0];return{x:function(){var n=XI(r);if(1===r.rank)for(var i=0;i<t[0];++i)n=n.add(e.slice([i*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(i=0;i<t[0];++i)for(var a=0;a<t[1];++a)n=n.add(e.slice([i*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(i=0;i<t[0];++i)for(a=0;a<t[1];++a)for(var o=0;o<t[2];++o)n=n.add(e.slice([i*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(i=0;i<t[0];++i)for(a=0;a<t[1];++a)for(o=0;o<t[2];++o)for(var s=0;s<t[3];++s)n=n.add(e.slice([i*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",i,r)}}),jF=_I({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new fF(t,n,r,!0,i),o=dF(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),UF=_I({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=vI(e,"x","unstack");MM(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length);var r={axis:t};return qT.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return PF(e,t)}}}),"Unpack",r)}}),qF=function(e,t){return lM(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f;return fM(this,(function(p){switch(p.label){case 0:return n=vI(e,"x","setdiff1d"),r=vI(t,"y","setdiff1d"),MM(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),MM(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),MM(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=p.sent(),[4,r.data()];case 2:for(a=p.sent(),o=new Set(a),s=0,l=0;l<i.length;l++)o.has(i[l])||s++;for(u=new wT([s],n.dtype),c=new wT([s],"int32"),l=0,f=0;l<i.length;l++)o.has(i[l])||(u.values[f]=i[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}}))}))};function WF(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var a=t.length,o=0;o<a;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(a+1))}return i}function VF(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var a=[],o=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?o.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function $F(e,t,n,r){void 0===r&&(r=!0);var i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?i.push(t[a-1]*e[a]):i.push(e[a]/t[a-1]):i.push(e[a]);return i}function HF(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function GF(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}function KF(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],i=1,a=0;a<n.length-1;++a)i*=n[a];var o=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=o[a],s.push(o[a]);var c=iT(e.shape).map((function(e){return e/u})).concat([1]).slice(0,r);return[s,i,u,c]}var XF=Object.freeze({prepareAndValidate:KF});function YF(e){return e<=30?e:rT(e,Math.floor(Math.sqrt(e)))}function JF(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(a+" update.rank < "+i+". ");if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(var o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+n.shape[o+i]+") != shape["+(o+i)+"] ("+e[o+i]+")")}function ZF(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}JF(n,t,e)}function QF(e,t,n){for(var r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length,o=1,s=i;s<a;++s)o*=n[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:FM(t.shape)/u,sliceSize:o,strides:iT(n.slice(0,i)).concat([1]),outputSize:FM(n)}}var eR=Object.freeze({validateUpdateShape:JF,validateInput:ZF,calculateShapes:QF});function tR(e,t,n){MM(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),MM(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){MM(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},i=0;i<e.rank;++i)r(i)}function nR(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function rR(e,t,n){for(var r=[],i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function iR(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),kM(0,a,s-1)}function aR(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),o>0?kM(0,a,s):kM(-1,a,s-1)}function oR(e,t,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function sR(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}var uR=Object.freeze({assertParamsValid:tR,maskToAxes:nR,computeOutShape:rR,startForAxis:iR,stopForAxis:aR,isSliceContinous:oR,computeFlatOffset:sR});function cR(e){return MM(nT(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=vI(t,"x","tf.grad",null),i=null!=n?vI(n,"dy","tf.grad"):null;return qT.tidy((function(){var t=qT.gradients((function(){return e(r)}),[r],i),n=t.value,a=t.grads;return null!=i&&TM(n.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),mR(a),a[0]}))}}function lR(e){return MM(nT(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){MM(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=yI(t,"args","tf.grads",null),i=null!=n?vI(n,"dy","tf.grads"):null;return qT.tidy((function(){var t=qT.gradients((function(){return e.apply(void 0,r)}),r,i),n=t.value,a=t.grads;return null!=i&&TM(n.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),mR(a),a}))}}function fR(e){return MM(nT(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){MM(t instanceof NT,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),MM(null==n||n instanceof NT,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=qT.gradients((function(){return e(t)}),[t],n),i=r.grads,a=r.value;return mR(i),{grad:i[0],value:a}}}function pR(e){return MM(nT(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){MM(Array.isArray(t)&&t.every((function(e){return e instanceof NT})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),MM(null==n||n instanceof NT,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=qT.gradients((function(){return e.apply(void 0,t)}),t,n);return null!=n&&TM(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),mR(r.grads),r}}function hR(e,t){MM(nT(e),(function(){return"The f passed in variableGrads(f) must be a function"})),MM(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof TT})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],qT.registeredVariables)t.push(qT.registeredVariables[r]);var i=n?t.filter((function(e){return!e.trainable})):null,a=t.length;MM((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var o=qT.gradients(e,t,null,!0),s=o.value,u=o.grads;MM(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),MM(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=i&&i.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function dR(e){return qT.customGrad(e)}function mR(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var gR=_I({softmax_:function(e,t){void 0===t&&(t=-1);var n=vI(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return qT.runKernelFunc((function(e,r){var i=e.softmax(n,t);return r([i]),i}),{logits:n},(function(e,n){var r=n[0],i=e.mul(r);return{logits:function(){return i.sub(i.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),vR=_I({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=vI(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return dR((function(e,n){var r=e.max(t,!0),i=e.sub(r),a=i.toFloat().sub(i.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),yR=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),bR=function(){function e(){}return e.prototype.time=function(e){return xR("time")},e.prototype.read=function(e){return xR("read")},e.prototype.readSync=function(e){return xR("readSync")},e.prototype.numDataIds=function(){return xR("numDataIds")},e.prototype.disposeData=function(e){return xR("disposeData")},e.prototype.write=function(e,t,n){return xR("write")},e.prototype.move=function(e,t,n,r){return xR("move")},e.prototype.memory=function(){return xR("memory")},e.prototype.floatPrecision=function(){return xR("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return xR("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,xR("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return xR("slice")},e.prototype.stridedSlice=function(e,t,n,r){return xR("stridedSlice")},e.prototype.unstack=function(e,t){return xR("unstack")},e.prototype.reverse=function(e,t){return xR("reverse")},e.prototype.concat=function(e,t){return xR("concat")},e.prototype.neg=function(e){return xR("neg")},e.prototype.add=function(e,t){return xR("add")},e.prototype.addN=function(e){return xR("addN")},e.prototype.subtract=function(e,t){return xR("subtract")},e.prototype.multiply=function(e,t){return xR("multiply")},e.prototype.realDivide=function(e,t){return xR("realDivide")},e.prototype.floorDiv=function(e,t){return xR("floorDiv")},e.prototype.sum=function(e,t){return xR("sum")},e.prototype.prod=function(e,t){return xR("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return xR("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return xR("argMin")},e.prototype.argMax=function(e,t){return xR("argMax")},e.prototype.equal=function(e,t){return xR("equal")},e.prototype.notEqual=function(e,t){return xR("notEqual")},e.prototype.less=function(e,t){return xR("less")},e.prototype.lessEqual=function(e,t){return xR("lessEqual")},e.prototype.greater=function(e,t){return xR("greater")},e.prototype.greaterEqual=function(e,t){return xR("greaterEqual")},e.prototype.logicalNot=function(e){return xR("logicalNot")},e.prototype.logicalAnd=function(e,t){return xR("logicalAnd")},e.prototype.logicalOr=function(e,t){return xR("logicalOr")},e.prototype.where=function(e){return xR("where")},e.prototype.select=function(e,t,n){return xR("select")},e.prototype.topk=function(e,t,n){return xR("topk")},e.prototype.min=function(e,t){return xR("min")},e.prototype.minimum=function(e,t){return xR("minimum")},e.prototype.mod=function(e,t){return xR("mod")},e.prototype.max=function(e,t){return xR("max")},e.prototype.maximum=function(e,t){return xR("maximum")},e.prototype.all=function(e,t){return xR("all")},e.prototype.any=function(e,t){return xR("any")},e.prototype.squaredDifference=function(e,t){return xR("squaredDifference")},e.prototype.ceil=function(e){return xR("ceil")},e.prototype.floor=function(e){return xR("floor")},e.prototype.round=function(e){return xR("round")},e.prototype.sign=function(e){return xR("sign")},e.prototype.isNaN=function(e){return xR("isNaN")},e.prototype.isInf=function(e){return xR("isInf")},e.prototype.isFinite=function(e){return xR("isFinite")},e.prototype.pow=function(e,t){return xR("pow")},e.prototype.exp=function(e){return xR("exp")},e.prototype.expm1=function(e){return xR("expm1")},e.prototype.softmax=function(e,t){return xR("softmax")},e.prototype.log=function(e){return xR("log")},e.prototype.log1p=function(e){return xR("log1p")},e.prototype.sqrt=function(e){return xR("sqrt")},e.prototype.rsqrt=function(e){return xR("rsqrt")},e.prototype.square=function(e){return xR("square")},e.prototype.reciprocal=function(e){return xR("reciprocal")},e.prototype.relu=function(e){return xR("relu")},e.prototype.relu6=function(e){return xR("relu6")},e.prototype.prelu=function(e,t){return xR("prelu")},e.prototype.elu=function(e){return xR("elu")},e.prototype.eluDer=function(e,t){return xR("eluDer")},e.prototype.selu=function(e){return xR("selu")},e.prototype.int=function(e){return xR("int")},e.prototype.clip=function(e,t,n){return xR("clip")},e.prototype.abs=function(e){return xR("abs")},e.prototype.complexAbs=function(e){return xR("complexAbs")},e.prototype.sigmoid=function(e){return xR("sigmoid")},e.prototype.softplus=function(e){return xR("softplus")},e.prototype.sin=function(e){return xR("sin")},e.prototype.cos=function(e){return xR("cos")},e.prototype.tan=function(e){return xR("tan")},e.prototype.asin=function(e){return xR("asin")},e.prototype.acos=function(e){return xR("acos")},e.prototype.atan=function(e){return xR("atan")},e.prototype.atan2=function(e,t){return xR("atan2")},e.prototype.sinh=function(e){return xR("sinh")},e.prototype.cosh=function(e){return xR("cosh")},e.prototype.tanh=function(e){return xR("tanh")},e.prototype.asinh=function(e){return xR("asinh")},e.prototype.acosh=function(e){return xR("acosh")},e.prototype.atanh=function(e){return xR("atanh")},e.prototype.erf=function(e){return xR("erf")},e.prototype.step=function(e,t){return xR("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,xR("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return xR("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return xR("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return xR("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,xR("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return xR("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return xR("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return xR("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return xR("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return xR("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return xR("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return xR("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return xR("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return xR("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return xR("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return xR("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return xR("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return xR("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return xR("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return xR("reshape")},e.prototype.cast=function(e,t){return xR("cast")},e.prototype.tile=function(e,t){return xR("tile")},e.prototype.pad=function(e,t,n){return xR("pad")},e.prototype.transpose=function(e,t){return xR("transpose")},e.prototype.gather=function(e,t,n){return xR("gather")},e.prototype.gatherND=function(e,t){return xR("gatherND")},e.prototype.scatterND=function(e,t,n){return xR("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return xR("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return xR("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return xR("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return xR("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return xR("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return xR("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,i,a){return xR("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){return xR("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){return xR("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return xR("multinomial")},e.prototype.oneHot=function(e,t,n,r){return xR("oneHot")},e.prototype.cumsum=function(e,t,n,r){return xR("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return xR("nonMaxSuppression")},e.prototype.fft=function(e){return xR("fft")},e.prototype.ifft=function(e){return xR("ifft")},e.prototype.complex=function(e,t){return xR("complex")},e.prototype.real=function(e){return xR("real")},e.prototype.imag=function(e){return xR("imag")},e.prototype.cropAndResize=function(e,t,n,r,i,a){return xR("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return xR("depthToSpace")},e.prototype.split=function(e,t,n){return xR("split")},e.prototype.sparseToDense=function(e,t,n,r){return xR("sparseToDense")},e.prototype.diag=function(e){return xR("diag")},e.prototype.fill=function(e,t,n){return xR("fill")},e.prototype.onesLike=function(e){return xR("onesLike")},e.prototype.zerosLike=function(e){return xR("zerosLike")},e.prototype.linspace=function(e,t,n){return xR("linspace")},e.prototype.dispose=function(){return xR("dispose")},e}();function xR(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function wR(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r}function ER(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function CR(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function SR(e,t,n,r,i,a,o){void 0===o&&(o="channelsLast");var s,u=_R(t),c=u[0],l=u[1];if("channelsLast"===o)s=[c,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[c,l,e[1],e[1]]}return AR(e,s,n,r,i,a,!1,o)}function NR(e,t,n,r,i,a,o){void 0===o&&(o="NDHWC");var s,u,c=MR(t),l=c[0],f=c[1],p=c[2];if("NDHWC"===o)u="channelsLast",s=[l,f,p,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);u="channelsFirst",s=[l,f,p,e[1],e[1]]}return kR(e,s,n,r,i,!1,u,a)}function AR(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],p=u[3];if("channelsLast"===s)c=e[0],l=e[1],f=e[2],p=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],p=e[1],l=e[2],f=e[3]}var h,d=t[0],m=t[1],g=t[3],v=_R(n),y=v[0],b=v[1],x=_R(r),w=x[0],E=x[1],C=TR(d,w),S=TR(m,E),N=function(e,t,n,r,i,a,o,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,i){null==r&&(r=DR(e,t,n));var a=e[1],o=OR((e[0]-t+2*r)/n+1,i);MM(BM(o),(function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"}));var s=OR((a-t+2*r)/n+1,i);return MM(BM(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[o,s]}([t,n],a,r,e,s);c=f[0],l=f[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/i);var p=Math.max(0,(c-1)*r+a-t),h=Math.max(0,(l-1)*i+o-n),d=Math.floor(p/2),m=p-d,g=Math.floor(h/2);u={top:d,bottom:m,left:g,right:h-g,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-a+1)/r),l=Math.ceil((n-o+1)/i)}return{padInfo:u,outHeight:c,outWidth:l}}(i,l,f,y,b,C,S,a),A=N.padInfo,k=N.outHeight,D=N.outWidth,_=o?g*p:g;return"channelsFirst"===s?h=[c,_,k,D]:"channelsLast"===s&&(h=[c,k,D,_]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:p,outHeight:k,outWidth:D,outChannels:_,padInfo:A,strideHeight:y,strideWidth:b,filterHeight:d,filterWidth:m,effectiveFilterHeight:C,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:E,inShape:e,outShape:h,filterShape:t}}function kR(e,t,n,r,i,a,o,s){void 0===a&&(a=!1),void 0===o&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],p=u[3],h=u[4];if("channelsLast"===o)c=e[0],l=e[1],f=e[2],p=e[3],h=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);c=e[0],h=e[1],l=e[2],f=e[3],p=e[4]}var d,m=t[0],g=t[1],v=t[2],y=t[4],b=MR(n),x=b[0],w=b[1],E=b[2],C=MR(r),S=C[0],N=C[1],A=C[2],k=TR(m,S),D=TR(g,N),_=TR(v,A),M=function(e,t,n,r,i,a,o,s,u,c,l){var f,p,h,d;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,i,a){null==i&&(i=DR(e,t,r));var o=e[1],s=e[2],u=OR((e[0]-t+2*i)/r+1,a);MM(BM(u),(function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var c=OR((o-t+2*i)/r+1,a);MM(BM(c),(function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=OR((s-t+2*i)/r+1,a);return MM(BM(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[u,c,l,1]}([t,n,r,1],s,0,i,e,l);p=m[0],h=m[1],d=m[2]}else if("same"===e){var g=((p=Math.ceil(t/i))-1)*i+s-t,v=((h=Math.ceil(n/a))-1)*a+u-n,y=((d=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(g/2),x=g-b,w=Math.floor(v/2),E=v-w,C=Math.floor(y/2);f={top:w,bottom:E,left:C,right:y-C,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-s+1)/i),h=Math.ceil((n-u+1)/a),d=Math.ceil((r-c+1)/o)}return{padInfo:f,outDepth:p,outHeight:h,outWidth:d}}(i,l,f,p,x,w,E,k,D,_,s),T=M.padInfo,O=M.outDepth,I=M.outHeight,F=M.outWidth,R=a?y*h:y;return"channelsFirst"===o?d=[c,R,O,I,F]:"channelsLast"===o&&(d=[c,O,I,F,R]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:f,inWidth:p,inChannels:h,outDepth:O,outHeight:I,outWidth:F,outChannels:R,padInfo:T,strideDepth:x,strideHeight:w,strideWidth:E,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:k,effectiveFilterHeight:D,effectiveFilterWidth:_,dilationDepth:S,dilationHeight:N,dilationWidth:A,inShape:e,outShape:d,filterShape:t}}function DR(e,t,n,r){void 0===r&&(r=1);var i=TR(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function _R(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function MR(e){return"number"==typeof e?[e,e,e]:e}function TR(e,t){return t<=1?e:e+(e-1)*(t-1)}function OR(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function IR(e){var t=_R(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function FR(e,t){return IR(e)||IR(t)}function RR(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function BR(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=VI(e.shape),i=e.toFloat(),a=n.complex(i,r);return r.dispose(),i.dispose(),a}if(!KM(e.dtype,t))return qT.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return a=o.cast(t),o.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=RI(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function zR(e,t){return qT.makeTensorFromDataId(e.dataId,t,e.dtype)}function PR(e,t,n){var r=(t-e)/(n-1),i=uT(n,"float32");i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return BI(i,"float32")}var LR=Object.freeze({castTensor:BR,reshapeTensor:zR,linspaceImpl:PR,upcastType:IT,axesAreInnerMostDims:bI,combineLocations:xI,computeOutAndReduceShapes:wI,expandShapeToKeepDim:EI,assertAxesAreInnerMostDims:CI,getAxesPermutation:SI,getUndoAxesPermutation:NI,getInnerMostAxes:AI,getBroadcastDims:wR,getReductionAxes:ER,assertAndGetBroadcastShape:CR,assertParamsConsistent:kI,computeOutShape:DI,computePool2DInfo:SR,computePool3DInfo:NR,computeConv2DInfo:AR,computeConv3DInfo:kR,computeDefaultPad:DR,tupleValuesAreOne:IR,eitherStridesOrDilationsAreOne:FR,convertConv2DDataFormat:RR,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:YF});function jR(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function UR(e,t){return{real:e[2*t],imag:e[2*t+1]}}function qR(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function WR(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function VR(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,i=e.length,a=0,o=!1;r<i;){var s=n(t,e[a=r+(i-r>>>1)]);s>0?r=a+1:(i=a,o=!s)}return o?r:-r-1}(e,t,n||$R)}(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function $R(e,t){return e>t?1:e<t?-1:0}function HR(e,t,n,r,i){return KR(e,t,n,r,i,0).selectedIndices}function GR(e,t,n,r,i,a){var o=KR(e,t,n,r,i,a,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function KR(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>i})).sort(JR),c=a>0?-.5/a:0,l=[],f=[];l.length<n&&u.length>0;){var p=u.pop(),h=p.score,d=p.boxIndex,m=p.suppressBeginIndex;if(h<i)break;for(var g=!1,v=l.length-1;v>=m;--v){var y=XR(e,d,l[v]);if(y>=r){g=!0;break}if(p.score=p.score*YR(r,c,y),p.score<=i)break}p.suppressBeginIndex=l.length,g||(p.score===h?(l.push(d),f.push(p.score)):p.score>i&&VR(u,p,JR))}var b=l.length;return s&&(l.fill(0,b),f.fill(0,b)),{selectedIndices:BI(l,"int32"),selectedScores:BI(f,"float32"),numValidOutputs:RI(b,"int32")}}function XR(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),p=Math.max(i[1],i[3]),h=(s-a)*(u-o),d=(f-c)*(p-l);if(h<=0||d<=0)return 0;var m=Math.max(a,c),g=Math.max(o,l),v=Math.min(s,f),y=Math.min(u,p),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(h+d-b)}function YR(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function JR(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function ZR(e,t,n){var r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var a=e.slice(r,i);return r[n]+=t,a}))}function QR(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=dF(n,e.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=a[s]%e.shape[s];var u=e.locToIndex(o);i.values[r]=e.values[u]}return i.toTensor()}function eB(e,t,n,r,i){for(var a=t[t.length-1],o=[e.length/a,a],s=o[0],u=o[1],c=VM(n,s*r),l=VM("int32",s*r),f=0;f<s;f++){for(var p=f*u,h=e.subarray(p,p+u),d=[],m=0;m<h.length;m++)d.push({value:h[m],index:m});d.sort((function(e,t){return t.value-e.value}));var g=f*r,v=c.subarray(g,g+r),y=l.subarray(g,g+r);for(m=0;m<r;m++)v[m]=d[m].value,y[m]=d[m].index}var b=t.slice();return b[b.length-1]=r,[II(c,b,n),II(l,b,"int32")]}function tB(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=dF(e,"int32"),a=dF([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=i.indexToLoc(n[r]),s=r*e.length;a.values.set(o,s)}return a.toTensor()}var nB=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},rB=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},iB=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,a=e.inSize,o=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function aB(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function oB(e,t){return 1===t?[e]:aB(e,t)}function sB(){var e,t,n,r,i,a,o,s,u,c;return 2===dM().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function uB(e,t,n){void 0===n&&(n="index");var r=iT(t);return r.map((function(t,i){return"int "+e[i]+" = "+n+" / "+t+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+t:"index -= "+e[i]+" * "+t)+";"})).join("")}function cB(e){var t=iT(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var lB="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function fB(e,t,n,r){var i=[];e.forEach((function(e){var t=FM(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+e.name+";"),i.push("uniform int offset"+e.name+";"))}));var a,o,s=i.join("\n"),u=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?hB(e):pB(e);var i=e.shapeInfo.logicalShape,a=t.logicalShape;return i.length<=a.length&&(r+=n?function(e,t){var n,r,i=e.name,a=i.charAt(0).toUpperCase()+i.slice(1),o="get"+a+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=wR(e.shapeInfo.logicalShape,t.logicalShape),l=xB(u),f=u-s,p=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+p[e+f]+" = 0;"})).join("\n"),r=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+p[t+f]})).join(", ");var h="return outputValue;",d=1===FM(e.shapeInfo.logicalShape),m=1===FM(t.logicalShape);if(1!==s||d||m){if(d&&!m)h=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=s-2,v=s-1;c.indexOf(g)>-1&&c.indexOf(v)>-1?h="return vec4(outputValue.x);":c.indexOf(g)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(v)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+r+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&RM(o,a))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c,l,f=xB(u),p=wR(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,d=["x","y","z","w","u","v"];return c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords."+d[e+h]+" = 0;"})).join("\n"),l=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+h]})).join(", "),"\n    float "+i+"() {\n      "+f+" coords = getOutputCoords();\n      "+c+"\n      return get"+r+"("+l+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),c=t.texShape,l=sB(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),p=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+dB+"\n    "+mB+"\n    "+gB+"\n  "}(l);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(RM(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2),a=i,o="",s="b, r, c",u=2;u<e.length-1;u++)o="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+o,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,i,a,o}(t.logicalShape,c),o=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return RM(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=uB(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=uB(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=uB(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=uB(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,c),o=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(p+=vB),[p,f,o,s,a,u,n].join("\n")}function pB(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===i&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+yB(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+bB(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=yB(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+a+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape;if(null!=i&&RM(t,i)){var a=i[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var o=WM(t),s=o.newShape,u=o.keptDims,c=s;if(c.length<t.length)return"\n      "+pB(wB(e,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+EB(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+bB(e)+"\n      }\n    ";var l=i[0],f=i[1],p=yB(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+l+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],a=t[2],o=WM(t),s=o.newShape,u=o.keptDims,c=s;if(c.length<t.length)return"\n        "+pB(wB(e,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+EB(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1)));\n        "+bB(e)+"\n      }\n    ";var l=e.shapeInfo.texShape,f=l[0],p=l[1],h=e.shapeInfo.flatOffset;return p===i&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":p===a&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+a+" + depth + "+yB(n)+";\n        vec2 uv = uvFromFlat("+f+", "+p+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],a=t[2]*i,o=t[1]*a,s=WM(t),u=s.newShape,c=s.keptDims;if(u.length<t.length)return"\n      "+pB(wB(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+EB(["row","col","depth","depth2"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+o+", "+a+", "+i+", 1)));\n        "+bB(e)+"\n      }\n    ";var l=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,p=f[0],h=f[1];return h===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===i&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+o+" + col * "+a+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+h+", index + "+yB(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],a=t[3]*i,o=t[2]*a,s=t[1]*o,u=WM(t),c=u.newShape,l=u.keptDims;if(c.length<t.length)return"\n      "+pB(wB(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+EB(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+o+", "+a+", "+i+")) +\n          depth3;\n        "+bB(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,h=p[0],d=p[1];return d===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+o+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":d===i&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" + depth * "+a+" +\n          depth2 * "+i+" + depth3 + "+yB(n)+";\n      vec2 uv = uvFromFlat("+h+", "+d+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=WM(t),a=i.newShape,o=i.keptDims;if(a.length<t.length)return"\n      "+pB(wB(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+EB(["row","col","depth","depth2","depth3","depth4"],o)+");\n      }\n    ";var s=t[5],u=t[4]*s,c=t[3]*u,l=t[2]*c,f=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+l+", "+c+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+bB(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],m=h[1];return m===f&&null==p?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==p?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+l+" + depth * "+c+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+yB(n)+";\n      vec2 uv = uvFromFlat("+d+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function hB(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1)+"() {\n      return "+sB().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=sB();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=i[0],o=i[1],s=sB();if(null!=i&&RM(t,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===t[0])return"\n        "+hB(wB(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+EB(["b","row","col"],[1,2])+");\n        }\n      ";var o=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+o+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+sB().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),f="int b, int row, int col",p="b * "+l+" + (row / 2) * "+c+" + (col / 2)",h=2;h<n-1;h++)f="int b"+h+", "+f,p="b"+h+" * "+(l*=t[n-h-1])+" + "+p;return"\n    vec4 "+i+"("+f+") {\n      int index = "+p+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+sB().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var dB="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",mB="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",gB="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",vB="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function yB(e){return"offset"+e}function bB(e){var t=e.name,n=FM(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function xB(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function wB(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function EB(e,t){return t.map((function(t){return e[t]})).join(", ")}var CB=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,MM(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var o,s,u=this.outputShape,c=u.length,l=xB(c),f=oB("coords",c);if(1===a){var p=xB(s=c+1);o="\n        "+p+" sourceLocR = "+p+"("+f.join()+", 0);\n        ++"+f[c-1]+";\n        "+p+" sourceLocG = "+p+"("+f.join()+", 0);\n        ++"+f[c-2]+";\n        "+p+" sourceLocA = "+p+"("+f.join()+", 0);\n        --"+f[c-1]+";\n        "+p+" sourceLocB = "+p+"("+f.join()+", 0);\n        --"+f[c-2]+";"}else s=c,o="\n        "+l+" sourceLocR = coords;\n        ++"+f[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),d="."+h[s-1],m=h.map((function(e){return"int "+e})),g=oB("sourceLocR",s-1).concat("inIdx.r"),v=oB("sourceLocG",s-1).concat("inIdx.g"),y=oB("sourceLocB",s-1).concat("inIdx.b"),b=oB("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+f[c-2]+" < "+(u[c-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+d+", sourceLocG"+d+",\n          sourceLocB"+d+", sourceLocA"+d+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},SB=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},NB=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=f-1-e.padInfo.top,m=p-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+d+", "+m+");\n      const float avgMultiplier = float("+g+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+i+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+p+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},AB=function(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],CR(e,t),CR(e,n);var o="0.0";null!=r&&(CR(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=i&&(CR(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},kB=function(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],CR(e,t),CR(e,n);var o="vec4(0.0)";null!=r&&(CR(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(CR(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},DB=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=CR(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},_B="return a + b;",MB="return a - b;",TB="return a * b;",OB="return (a < 0.) ? b * a : a;",IB=function(e,t,n){this.variableNames=["A","B"],this.outputShape=CR(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},FB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",RB=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=CR(t,n);var i=this.outputShape.length,a="";if(r)if(0===i||1===FM(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+xB(i)+" coords = getOutputCoords();\n        ",1===i)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=oB("coords",i);a+="\n            bool nextRowOutOfBounds =\n              ("+o[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+o[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},BB=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),zB=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),PB=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},LB=function(e){this.outputShape=[],this.outputShape=DI(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var i=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var a=t.length,o=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},jB=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=DI(e,t);var n=this.outputShape,r=n.length,i=xB(r),a=oB("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var c=o[t],l=o.slice(-2),f=o.join(),p="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];p+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+UB(o,c,h)+"),\n            vec2("+UB(l,c,h)+"));\n        }"}var d=s.length,m=s[s.length-1];p+="\n        return getChannel(\n          getT"+d+"("+UB(o,c,m)+"),\n          vec2("+UB(l,c,m)+"));",this.userCode="\n      float getValue("+o.map((function(e){return"int "+e}))+") {\n        "+p+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function UB(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var qB=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},WB=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,c=a?2:3,l=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},VB=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+i+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},$B=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+i+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},HB=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},GB=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},KB=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,p=4*Math.floor(e.inChannels/4),h=e.inChannels%4,d="channelsLast"===e.dataFormat,m=d?1:2,g=d?2:3,v=d?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+d+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+d+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+p+") *\n                    getW(wR, wC, "+p+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+p+", xR, xC) *\n                    getW(wR, wC, "+p+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+p+", d2),\n                getW(wR, wC, "+p+" + 1, d2)\n              );\n\n              if ("+d+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+p+"),\n                  getX(batch, xR, xC, "+p+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+p+", xR, xC),\n                  getX(batch, "+p+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+p+", d2),\n                getW(wR, wC, "+p+" + 1, d2),\n                getW(wR, wC, "+p+" + 2, d2)\n              );\n\n              if ("+d+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+p+"),\n                  getX(batch, xR, xC, "+p+" + 1),\n                  getX(batch, xR, xC, "+p+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+p+", xR, xC),\n                  getX(batch, "+p+" + 1, xR, xC),\n                  getX(batch, "+p+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},XB=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,p=e.filterWidth,h=4*Math.floor(e.inChannels/4),d=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+p+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===d)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===d)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===d)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},YB=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,h=e.filterWidth,d=e.outChannels/e.inChannels,m="",g="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",g="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+d+";\n        int q = d2 - d1 * "+d+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+p+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+g+"\n        setOutput(result);\n      }\n    "},JB=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,h=e.filterWidth,d=h,m="int xR; int xC; int xCOffset;",g=0;g<p;g++)for(var v=0;v<h;v++)m+="\n          vec4 xTexelR"+g+"C"+2*v+" = vec4(0.);\n          vec4 wR"+g+"C"+v+" = vec4(0.);\n          vec4 xR"+g+"C"+v+" = vec4(0.);";for(g=0;g<p;g++)for(var y=0;y<d;y++){if(m+="\n          xR = xRCorner + "+g*l+";\n          xC = xCCorner + "+(v=2*y)*f+";\n        ",1===c){if(v<h&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+g+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+".xy);\n                } else {\n                  xR"+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = xTexelR"+g+"C"+v+";\n              ",v+1<h)){var b=s%2==0?DM(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+v+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+";\n                "}}else v<h&&(m+="\n              if(xR >= 0 && xR < "+i+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n              ",v+1<h&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+".xy);\n              ",v+1<h&&(m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n                ")),m+="}");v<h&&(m+="\n            vec4 wTexelR"+g+"C"+v+" = getW("+g+", "+v+", d1, q);\n            wR"+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+".xz);\n          ",v+1<h&&(m+="\n              vec4 wTexelR"+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+", d1, q);\n              wR"+g+"C"+(v+1)+" =\n                vec4(wTexelR"+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<p;g++)for(v=0;v<h;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+E+"\n        "+w+"\n        setOutput(result);\n      }\n    "},ZB=function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],o=e[1],s=e[2],u=e[3],c=t[0],l=n[0],f=n[1];this.outputShape=[c,l,f,u];var p="bilinear"===r?1:0,h=[o-1+".0",s-1+".0"],d=h[0],m=h[1],g=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+d+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+d],v=g[0],y=g[1],b=g[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=x[0],E=x[1],C=x[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+d+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+C+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+p+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},QB=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+xB(r)+" coords = getOutputCoords();\n        int end = "+ez(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+ez(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function ez(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var tz=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=$T.DENSE;var t=QT(e),n=sB();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+uB(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},nz=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=$T.DENSE;var t=QT(e),n=sB();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+uB(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},rz=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),iz=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},az=function(e){this.variableNames=["A"],this.outTexUsage=HT.DOWNLOAD;var t=sB();this.outputShape=e,this.userCode="\n      "+lB+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},oz=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=HT.DOWNLOAD;var t=sB();this.outputShape=e,this.userCode="\n      "+lB+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},sz=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=sB(),i=t[0],a=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+cB(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},uz=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=sB(),i=t[0],a=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+e[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+cB(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "},cz=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},lz=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),fz=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=xB(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=0;a<e.length;a++)a===t?i.push("int(getIndices("+r[a]+"))"):i.push(""+r[a]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},pz=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=xB(t.length),i=xB(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function hz(e,t){var n=sB();return oO(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function dz(e,t){return dO(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function mz(e,t){return mO(e,t,new Uint16Array([0,1,2,2,1,3]))}function gz(e,t,n,r,i,a,o){vO(n,r);var s=gO(e,t),u=e.TEXTURE_2D;return nO(e,t,(function(){return e.bindTexture(u,s)})),nO(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),nO(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),nO(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),nO(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),nO(e,t,(function(){return e.texImage2D(u,0,i,n,r,0,a,o,null)})),nO(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function vz(e,t,n,r,i){var a=ZT(n,r);return gz(e,t,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function yz(e,t,n,r,i){var a=ZT(n,r);return gz(e,t,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function bz(e,t,n,r,i){var a=ZT(n,r);return gz(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function xz(e,t,n,r,i){var a=eO(n,r);return gz(e,t,a[0],a[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function wz(e,t,n,r,i){var a=eO(n,r);return gz(e,t,a[0],a[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function Ez(e,t,n,r){return nO(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),bO(e,t,n,"clipSpacePos",r,3,20,0)&&bO(e,t,n,"uv",r,2,20,12)}function Cz(e,t,n,r,i,a,o){var s,u,c;nO(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*i*4),u=e.FLOAT,c=o.internalFormatPackedFloat),s.set(a),nO(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,i,0,e.RGBA,u,s)})),nO(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Sz(e,t,n,r){nO(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?nO(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):nO(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),nO(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Nz(e,t,n,r,i){var a=e.createBuffer();nO(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*n*r;return nO(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),nO(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),nO(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function Az(e,t,n){var r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function kz(e,t,n,r,i){var a=ZT(n,r),o=a[0],s=a[1],u=new Uint8Array(n*r*4);return nO(e,t,(function(){return e.readPixels(0,0,o,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function Dz(e,t,n,r,i,a,o,s){var u=e,c=new Float32Array(function(e,t){var n=eO(e,t);return n[0]*n[1]*4}(a,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function _z(e,t,n,r){var i=new Float32Array(n*r*4);return nO(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,i)})),i}var Mz=Object.freeze({createVertexShader:hz,createVertexBuffer:dz,createIndexBuffer:mz,createFloat32MatrixTexture:vz,createFloat16MatrixTexture:yz,createUnsignedBytesMatrixTexture:bz,createPackedMatrixTexture:xz,createFloat16PackedMatrixTexture:wz,bindVertexProgramAttributeStreams:Ez,uploadDenseMatrixToTexture:Cz,uploadPixelDataToTexture:Sz,createBufferFromOutputTexture:Nz,downloadFloat32MatrixFromBuffer:Az,downloadByteEncodedFloatMatrixFromOutputTexture:kz,downloadPackedMatrixFromBuffer:Dz,downloadMatrixFromPackedOutputTexture:_z}),Tz=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=dM().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,YT(t,e)):this.gl=JT(t);var n="WEBGL_color_buffer_float";if(1===dM().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=aO(this.gl,this.debug,"OES_texture_float"),LO(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=aO(this.gl,this.debug,"OES_texture_half_float");else if(dM().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),LO(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=aO(this.gl,this.debug,"EXT_color_buffer_half_float");else if(dM().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",LO(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!LO(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=dz(this.gl,this.debug),this.indexBuffer=mz(this.gl,this.debug),this.framebuffer=yO(this.gl,this.debug),this.textureConfig=tO(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return dM().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;nO(t,this.debug,(function(){return t.finish()})),nO(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),nO(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),nO(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),nO(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),nO(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),vz(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),yz(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),bz(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Sz(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),Cz(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),wz(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),xz(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(NO(this.gl,this.debug,this.framebuffer),this.outputTexture=null),nO(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return kz(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,i,a){return Dz(this.gl,e,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Az(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=Nz(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(dM().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(a,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=a}else dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return _z(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=sO(t,this.debug,e),r=hz(t,this.debug),i=fO(t,this.debug);return nO(t,this.debug,(function(){return t.attachShader(i,r)})),nO(t,this.debug,(function(){return t.attachShader(i,n)})),pO(t,this.debug,i),this.debug&&hO(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Ez(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&nO(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&hO(this.gl,this.debug,this.program),nO(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?wO(this.gl,this.debug,e,t):EO(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),nO(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),CO(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=eO(t,n),i=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,i,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&hO(this.gl,this.debug,this.program),AO(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),nO(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),nO(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=aO(this.gl,this.debug,2===dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return lM(this,void 0,void 0,(function(){var t=this;return fM(this,(function(n){switch(n.label){case 0:return[4,jM((function(){return t.disposed||t.isQueryAvailable(e,dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||jM((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),SO(this.gl,this.debug,e,this.framebuffer),this.debug&&AO(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(SO(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&AO(this.gl)):NO(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;SO(r,this.debug,e,this.framebuffer),this.debug&&AO(r),this.outputTexture=e,nO(r,this.debug,(function(){return r.viewport(0,0,t,n)})),nO(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),nO(this.gl,this.debug,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Oz(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,i=t[n],a=i.shape;if(!RM(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var o=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!RM(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}}))}var Iz=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,i=n.inChannels,a=n.strideWidth,o=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,f=n.dataFormat,p=s.left,h=s.top,d=i*r,m=sB(),g="channelsLast"===f,v=g?0:1,y=g?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+o+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+d+");\n\n            if(d0 < "+t[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+p+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+d+".) / "+i+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "},Fz=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var a,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Rz=function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Bz=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},zz=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,o=i-1-e.padInfo.top,s=a-1-e.padInfo.left,u=i*a-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Pz=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=u-1-e.padInfo.top,p=c-1-e.padInfo.left,h=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+f+", "+p+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+i+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Lz=function(e,t,n,r,i,a,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",d="";a&&(h=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",d="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+p[0]+");\n          result += ("+f[1]+" * "+p[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},jz=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),Uz=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},qz=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=oB("rc",t),r=xB(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",i=e-2;i<e;i++)r+=n[i]+" >= "+t[i],i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var a=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),o=2;o<e;o++)a=t[t.length-1-o]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}},Wz=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,i=xB(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+a+");\n      "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Vz=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,i=xB(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=oB("rc",r),u=oB("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],p=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",d=0,m=1===r?2:4;d<m;d++)h+="\n        "+f[d]+"\n        if ("+p+") {\n          result["+d+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+d+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+i+" start = "+i+"("+a+");\n      const "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},$z=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideHeight,a=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var p="avg"===t,h="0.0";if(p||(h="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+a+");\n        const ivec2 pads = ivec2("+l+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+o+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var d=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(d="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+l+", "+f+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+o+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}},Hz=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=e.padInfo.front,d=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var g="avg"===t,v="0.0";if(g||(v="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+a+", "+o+");\n        const ivec3 pads = ivec3("+h+", "+d+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+f+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+f+" * "+p+" +\n                      wR * "+p+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(r/4),x=r%4,w="\n      if ("+g+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+h+", "+d+", "+m+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},Gz=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=Math.ceil(i/n);this.outputShape=[r,a];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",p="vec4";"all"===t?(o="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===t&&(o="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},Kz=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+uB(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+cB(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Xz=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?i-1:i,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],p=c[1]/l[1],h=1/f,d=1/p,m=2*Math.ceil(h)+2,g=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Yz=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Jz=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Zz=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?i-1:i,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],p=c[1]/l[1],h=1/f,d=1/p,m=2*Math.ceil(h)+2,g=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Qz=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},eP=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),i=xB(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},tP=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=oB("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],o=xB(n);function s(n){var r=e.map((function(r,i){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+i+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},nP=function(e,t,n,r,i,a,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=xB(i.length),u=xB(a.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var p="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+p+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},rP=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},iP=function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&o.push(""+a[u]);r=o.join(),i=s.join()}var c=xB(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},aP=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=xB(this.rank),r="uniform int start["+this.rank+"];",i=function(e){if(1===e)return"sourceLoc";if(e<=6)return oP.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+oP[t]+" = start["+t+"] + coords."+oP[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),oP=["x","y","z","w","u","v"],sP=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=xB(this.rank),n=oB("coords",this.rank),r=oB("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+i+")",o="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),uP=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=xB(n.length),a=xB(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "},cP=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,i=lP(t,n),a=fP(e,i,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[a].shift();return this.usedTextures[a].push(o),o}return this.numUsedTextures++,this.log(),i===GT.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===GT.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===GT.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===GT.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===GT.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var i=fP(t,lP(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],o=a.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(o,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function lP(e,t){if(e===HT.UPLOAD)return GT.PACKED_2X2_FLOAT32;if(e===HT.RENDER||null==e)return function(e){return dM().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?GT.PACKED_2X2_FLOAT32:GT.UNPACKED_FLOAT32:e?GT.PACKED_2X2_FLOAT16:GT.UNPACKED_FLOAT16}(t);if(e===HT.DOWNLOAD||e===HT.PIXELS)return GT.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function fP(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var pP=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=xB(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},hP=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=xB(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},dP=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=xB(this.rank),a=aB("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=a[r];var s="vec2("+o.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},mP=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},gP="if (isnan(x)) return x;",vP="return abs(x);",yP=gP+"\n  return (x < 0.0) ? 0.0 : x;\n",bP=gP+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",xP="return (x >= 0.0) ? x : (exp(x) - 1.0);",wP="return -x;",EP="return ceil(x);",CP="return floor(x);",SP="return exp(x);",NP="return exp(x) - 1.0;",AP="return x;",kP="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",DP="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",_P="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",MP=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},TP=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=oB("rc",t),r=xB(t),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},OP={};function IP(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?kP:yP;if("elu"===e)return t?_P:xP;if("relu6"===e)return t?DP:bP;if("prelu"===e)return t?FB:OB;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var FP=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!dM().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=JT(dM().getNumber("WEBGL_VERSION"));r.binaryCache=((n=dM().getNumber("WEBGL_VERSION"))in OP||(OP[n]={}),OP[n]),r.gpgpu=new Tz(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new cP(r.gpgpu),r.numMBBeforeWarning=null==dM().global.screen?1024:dM().global.screen.height*dM().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new yR(r,qT),r}return cM(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(dM().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:HT.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(dM().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:HT.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensors,a=t.slice,o=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new MP(o,AP):new mP(o,AP);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,p,h=null!=this.activeTimers;return h&&(f=cT()),p="complex64"===r?jR(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=cT()-f),this.convertAndCacheOnCPU(e,p)},t.prototype.read=function(e){return lM(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c,l,f,p,h,d,m,g,v,y,b,x,w,E;return fM(this,(function(C){switch(C.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,i=n.shape,a=n.slice,o=n.dtype,s=n.complexTensors,u=n.isPacked,null!=a)return c=u?new MP(i,AP):new mP(i,AP),l=this.runWebGLProgram(c,[{dataId:e,shape:i,dtype:o}],o),f=this.read(l.dataId),this.disposeData(l.dataId),[2,f];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!dM().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===dM().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==o&&dM().get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(e),d=this.texData.get(h.dataId),p=(E=this.gpgpu).createBufferFromTexture.apply(E,[d.texture].concat(QT(i)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return g=C.sent(),v=g[0],y=g[1],m=jR(v,y),[3,5];case 4:null==p?m=this.getValuesFromTexture(e):(b=FM(i),m=this.gpgpu.downloadFloat32MatrixFromBuffer(p,b)),C.label=5;case 5:return null!=h&&this.disposeData(h.dataId),x=this.convertAndCacheOnCPU(e,m),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach((function(e){return e(x)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,x]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!rO(n)){if(dM().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.isPacked,o=FM(r);if(dM().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(QT(r))).subarray(0,o);return this.disposeData(s.dataId),c}var l=dM().getBool("WEBGL_PACK")&&!0===a,f=l?OO(r):r,p=l?new oz(f):new az(f),h=this.runWebGLProgram(p,[{shape:f,dtype:i,dataId:e}],"float32"),d=this.texData.get(h.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeData(h.dataId),m},t.prototype.time=function(e){return lM(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return fM(this,(function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),i=IM(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),a=IM(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return s=u.sent(),o.kernelMs=_M(s),o.getExtraProfileInfo=function(){return s.map((function(e,t){return{name:a[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:o.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,o]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:cT(),endMs:null}},t.prototype.endTimer=function(e){return dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=cT(),e)},t.prototype.getQueryTime=function(e){return lM(this,void 0,void 0,(function(){var t;return fM(this,(function(n){return dM().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,i=t.texShape,a=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,a,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return dM().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=qT.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&e.size<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:qT.keep(e.clone()),imag:qT.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===FM(n))return II([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,i=oR(e.shape,t,n);if(r||!i){var a=dM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sP(n):new aP(n),o=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),i=this.makeOutput(n,e.dtype),a=this.texData.get(i.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var o=sR(t,e.strides);r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),i},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var i=rR(t,n,r);if(i.some((function(e){return 0===e})))return II([],i);var a=new uP(t,r,i);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=dM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tP(e.shape,t):new eP(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return TI(e)})),r=e.map((function(e){return OI(e)}));return MI(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>dM().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),a=this.concat(e.slice(0,i),t),o=this.concat(e.slice(i),t);return this.concat([a,o],t)}if(dM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new jB(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var u=DI(e.map((function(e){return e.shape})),t),c=e.map((function(e){return e.as2D(-1,FM(e.shape.slice(t)))})),l=new LB(c.map((function(e){return e.shape})));return this.compileAndRun(l,c).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(dM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wP,e.dtype);var t=new mP(e.shape,wP);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===i||1===a)&&o>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===a?e:e.as3D(s,o,1),c=1===a?2:1,l=1===a?t.as3D(s,1,o):t;return this.multiply(u,l).sum(c,!0)}var f=IT(e.dtype,t.dtype),p=new Lz(e.shape,[s,i,a],n,r);return this.compileAndRun(p,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=i?n.shape[1]:n.shape[2],l=t.shape[0],f=IT(t.dtype,n.dtype),p=null!=a,h=null!=s,d=o?IP(o,!0):null,m=new Lz(t.shape,[l,u,c],r,i,p,d,h),g=[t,n];return a&&g.push(a),s&&g.push(s),this.compileAndRun(m,g,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new DB("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new DB("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(i,o),u=this.compileAndRun(a,o),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,TB,e.dtype);var l=new IB(TB,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){var o=[e,t,n],s=null;null!=a&&(s=a.shape,o.push(a));var u=null;if(null!=i&&(u=i.shape,o.push(i)),dM().getBool("WEBGL_PACK_NORMALIZATION")){var c=new kB(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,o)}var l=new AB(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){var a=dM().getBool("WEBGL_PACK_NORMALIZATION")?new Bz(e.shape,t,n,r,i):new Fz(e.shape,t,n,r,i);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){var s=new Rz(t.shape,r,i,a,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return pT(e)}));return QR(dF(e.shape,e.dtype,n),t)}var r=new pP(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=dM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Vz(e.shape,t,n):new Wz(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=dM().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dP(e.shape,t):new hP(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new fz(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){MM(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=WF(e.shape,t,r),a=VF(i.length,t.length),o=$F(e.shape,t,r),s=HF(n,t.length),u=GF(o,n,t.length);return e.reshape(i).transpose(a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){MM(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=WF(o.shape,t,r,!1),u=VF(s.length,t.length,!1),c=$F(o.shape,t,r,!1);return o.reshape(s).transpose(u).reshape(c)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],a=YF(i),o=new Gz({windowSize:a,inSize:i,batchSize:r},t),s=this.compileAndRun(o,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var a=YF(i),o=new iB({windowSize:a,inSize:i,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(o,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,i=YF(r[r.length-1]),a=new CB(r,i,t,null==n),o=null==n?[e]:[e,n],s=this.compileAndRun(a,o,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){CI("sum",t,e.rank);var n=wI(e.shape,t),r=n[0],i=FM(n[1]),a=e.as2D(-1,i),o=FT(e.dtype);return this.reduce(a,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=wI(e.shape,t),r=n[0],i=FM(n[1]),a=e.as2D(-1,i),o=FT(e.dtype);return this.reduce(a,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=SI([r],e.rank),a=e;null!=i&&(a=e.transpose(i),r=AI(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],i=e.length,a=0;a<i;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=FM([a.shape[r]]),u=a.as2D(-1,s),c=FT(e.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(o);return null!=i&&(l=l.transpose(NI(i))),l},t.prototype.segOpCompute=function(e,t,n,r,i){var a=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=rT(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=rT(e,n+1);return n}(o,i),u=new rP({windowSize:s,inSize:o,batchSize:a,numSegments:i},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===i?c:(n=GI(0,i).tile([o/s]),this.segOpCompute(c,t,n,r,i))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(CI("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!dM().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=wI(e.shape,r),a=i[0],o=FM(i[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new QB(e.shape,n,r);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,t){if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new IB("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new IB("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new IB("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new IB("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new IB("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new IB("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new mP(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new IB("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new IB("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new iP(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],IT(t.dtype,n.dtype))},t.prototype.where=function(e){dI("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return tB(e.shape,t)},t.prototype.topk=function(e,t,n){return eB(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){CI("min",t,e.rank);var n=wI(e.shape,t),r=n[0],i=FM(n[1]),a=e.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new IB("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new IB("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);CI("max",t,e.rank);var n=wI(e.shape,t),r=n[0],i=FM(n[1]),a=e.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new IB("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){CI("all",t,e.rank);var n=wI(e.shape,t),r=n[0],i=FM(n[1]),a=e.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){CI("any",t,e.rank);var n=wI(e.shape,t),r=n[0],i=FM(n[1]),a=e.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new IB("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new IB("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,_B);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=IT(e.dtype,t.dtype);if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,_B,n);var r=new IB(_B,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new MP(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,i){void 0===i&&(i=!1);var a=new RB(n,e.shape,t.shape,i);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),a=this.texData.get(t.dataId),o=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(i){var a=i[0],o=i[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,o),c=new IB(n,e.shape,t.shape);return r.compileAndRun(c,[s,u],IT(a.dtype,o.dtype))})),s=o[0],u=o[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>dM().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var i=e.map((function(e){return e.dtype})).reduce((function(e,t){return IT(e,t)})),a=e.map((function(e){return e.shape})),o=dM().getBool("WEBGL_PACK")?new rB(e[0].shape,a):new nB(e[0].shape,a);return this.compileAndRun(o,e,i)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,MB);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=IT(e.dtype,t.dtype);if(dM().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,MB,e.dtype);var r=new IB(MB,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new IB("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=IT(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(dM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,EP,e.dtype);var t=new mP(e.shape,EP);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(dM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,CP,e.dtype);var t=new mP(e.shape,CP);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new mP(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new mP(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new mP(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new mP(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new mP(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(dM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,SP,e.dtype);var t=new mP(e.shape,SP);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(dM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,NP,e.dtype);var t=new mP(e.shape,NP);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=qM([t],e.shape),r=this.max(e,n),i=EI(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return this.realDivide(o,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(dM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new mP(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new mP(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new mP(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new mP(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new mP(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=dM().getBool("WEBGL_PACK")?new MP(e.shape,kP):new mP(e.shape,yP),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=dM().getBool("WEBGL_PACK")?new MP(e.shape,DP):new mP(e.shape,bP),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB(FB,e.shape,t.shape):new IB(OB,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(dM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,_P,e.dtype);var t=new mP(e.shape,xP);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new IB("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new mP(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new mP(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,i=(r=dM().getBool("WEBGL_PACK_CLIP")?new zB(e.shape):new BB(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(dM().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,vP,e.dtype);var t=new mP(e.shape,vP);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new PB(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new mP(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new mP(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new mP(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new mP(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new mP(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new mP(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new mP(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new mP(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new IB("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new mP(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new mP(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new mP(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new mP(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new mP(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new mP(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new mP(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new mP(e.shape,function(e){return void 0===e&&(e=0),gP+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,i,a){var o=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,c=o[0]*o[1]*o[2],l=n.outChannels,f="channelsLast"===n.dataFormat,p=(1===c||1===l)&&u>1e3,h=o[2]%2!=0&&!!s.isPacked;if(p||!dM().getBool("WEBGL_LAZILY_UNPACK")||!dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!h){var d=f?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],m=this.reshape(e,[1,d,n.inChannels]),g=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),n.outShape)}var v=f?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),y={dataId:e.dataId,shape:[1,v,n.inChannels],dtype:e.dtype},b=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,MM(RO(s.shape,y.shape),(function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"}));var x=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),E=this.texData.get(w.dataId);return MM(E.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=b,E.shape=n.outShape,qT.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,i,a){var o=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,f="channelsLast"===n.dataFormat,p=o*s*u,h=l*c,d=[p,h],m=e.squeeze([0]),g=t.reshape([1,p,-1]),v=new Iz(d,m.shape,n),y=this.compileAndRun(v,[m]).reshape([1,d[0],d[1]]),b=null!=r,x=null!=a,w=i?IP(i,!0):null,E=new Lz(y.shape,[1,h,n.outChannels],!0,!1,b,w,x),C=[y,g];r&&C.push(r),x&&C.push(a);var S=this.compileAndRun(E,C);return f?S.reshape([1,l,c,n.outChannels]):S.reshape([1,n.outChannels,l,c])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,i,a,o);if(dM().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,i,a,o);var s=null!=i,u=null!=o,c=a?IP(a,!1):null,l=new KB(r,s,c,u),f=[t,n];return i&&f.push(i),o&&f.push(o),this.compileAndRun(l,f)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(dM().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new KB(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new WB(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new qB(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,i=e.convInfo,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=dM().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,c=o?IP(o,u):null,l=[n,r],f=null!=a,p=null!=s;return f&&l.push(a),p&&l.push(s),u?(t=new JB(i,f,c,p),this.compileAndRun(t,l)):(t=new YB(i,f,c,p),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return dM().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new JB(n),this.compileAndRun(r,[e,t])):(r=new YB(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new GB(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new HB(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new XB(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new $B(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new VB(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new $z(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new $z(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var i=new $z(r,"max",!0),a=this.compileAndRun(i,[t]),o=new zz(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new SB(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return BR(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new Hz(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new NB(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new Hz(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var i=new Hz(r,"max",!0),a=this.compileAndRun(i,[t]),o=new Pz(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!RO(e.shape,t)&&(null===n.texture||!RO(n.shape,t))){var r=this.packedReshape(e,t);return qT.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return zR(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var i=dM().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Jz(e.shape,t,n,r):new Yz(e.shape,t,n,r);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new Xz(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new Qz(e.shape,t,n,r);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new Zz(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var i=t?e:gR(e),a=i.shape[0],o=i.shape[1],s=new jz(a,o,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var i=new Uz(e.size,t,n,r);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var t=new iz(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return dI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),HR(e.dataSync(),t.dataSync(),n,r,i)},t.prototype.cropAndResize=function(e,t,n,r,i,a){var o=new ZB(e.shape,t.shape,r,i,a);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){MM(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],i="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=i*t,u=a*t,c=o/(t*t),l=new rz("NHWC"===n?[r,s,u,c]:[r,c,s,u],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return ZR(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=QF(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/o,o],l=e.reshape([a,i]),f=t.reshape([a,o]);if(0===u)return zR(II([]),n);var p=RI(0),h=new nP(a,i,l.rank,f.rank,s,c);return this.compileAndRun(h,[f,l,p]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var i=QF(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.strides,u=i.outputSize,c=new nP(o,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(c,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new cz("return real * expR - imag * expI;",e.shape,t),i=new cz("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,a),s=this.compileAndRun(i,a),u=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=KF(e,t),a=i[0],o=i[1],s=i[2],u=i[3],c=t.reshape([o,r]),l=e.reshape([e.size/s,s]),f=new pz(r,u,[o,s]);return this.compileAndRun(f,[l,c]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||tT(t))){var r=$M(n,FM(e));return r.fill(t),qT.makeTensor(r,e,n,this)}var i=new lz(e,t),a=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return PR(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return qT.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new TP(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new qz(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[MO(e.shape)].concat(TO(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[MO(t)].concat(TO(t)),a=new Kz(i,n),o=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,i=n.shape,a=n.dtype,o=OO(i);return t=r?new nz(o):new tz(o),{dtype:a,shape:i,dataId:this.runWebGLProgram(t,[{shape:o,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,i){var a=this;void 0===i&&(i=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===$T.DENSE){var u=QT(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===FM(o.shape))return s.values=VM(o.dtype,0),o;var c=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&FM(t.shape)<=dM().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),c.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!RO(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),c.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var f,p={shape:o.shape,texData:s,isUniform:!1},h=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var i=e.userCode;return e.constructor.name+"_"+r+"_"+i}(e,l,p),d=this.getAndSaveBinary(h,(function(){return function(e,t,n,r){var i=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=fB(a,s,i,t.packedInputs),c=e.createProgram(u),l=null,f=e.getUniformLocation(c,"NAN",!1);1===dM().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var p={},h=0;h<t.variableNames.length;h++){var d=t.variableNames[h];p[d]=e.getUniformLocation(c,d,!1),p["offset"+d]=e.getUniformLocation(c,"offset"+d,!1)}return{program:t,source:u,webGLProgram:c,uniformLocations:p,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:f}}(a.gpgpu,e,l,p)})),m=null!=this.activeTimers;if(m&&(f=this.startTimer()),function(e,t,n,r,i){Oz(t.inShapeInfos,n),Oz([t.outShapeInfo],[r]);var a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===dM().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],a=t.uniformLocations[i],o=t.uniformLocations["offset"+i];if(null!=a)if(n.isUniform)if(FM(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,d,l,p,r),c.forEach((function(e){return a.disposeData(e.dataId)})),m&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!dM().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var g=this.unpackTensor(o);return this.disposeData(o.dataId),g}return o},t.prototype.compileAndRun=function(e,t,n,r,i){void 0===i&&(i=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,i);return qT.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(dM().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=tI((function(){if(!dM().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=dM().getBool("DEBUG");dM().set("DEBUG",!1);var n=e.abs(RI(1e-8)).dataSync()[0];if(dM().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.values,o=n.texture,s=n.usage,u=n.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=cT());var f=n.texShape;if(null==f&&(f=IO(r,u),n.texShape=f),null!=a){var p=OO(r),h=void 0,d=f[1],m=f[0],g=a instanceof Uint8Array;u?(d=(t=eO(f[0],f[1]))[0],m=t[1],h=new uz(p,[m,d],g)):h=new sz(p,[m,d],g);var v=this.makeTensorInfo([m,d],i);this.texData.get(v.dataId).usage=g?HT.PIXELS:HT.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),d,m,a);var y=this.runWebGLProgram(h,[v],i,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(v.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=cT()-c)}else{var x=this.acquireTexture(f,s,i,u);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*YM(t)},t}(bR);WT()&&qT.registerBackend("webgl",(function(){return new FP}),2);var RP=_I({square_:function(e){var t=vI(e,"x","square"),n=[t];return qT.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},n,[])}}),BP="SquaredDifference",zP=_I({squaredDifference_:function(e,t){var n,r=vI(e,"a","squaredDifference"),i=vI(t,"b","squaredDifference");n=RT(r,i),r=n[0],i=n[1],CR(r.shape,i.shape);var a={a:r,b:i},o=[r,i];return qT.runKernelFunc((function(e,t){var n=e.squaredDifference(r,i);return t([r,i]),n}),a,(function(e,t){var n=t[0],r=t[1],i=RI(2);return{a:function(){return e.mul(n.sub(r).mul(i))},b:function(){return e.mul(r.sub(n).mul(i))}}}),BP,{},o,[])}}),PP=_I({abs_:function(e){var t=vI(e,"x","abs");return"complex64"===t.dtype?qT.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):qT.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),LP=_I({acos_:function(e){var t=vI(e,"x","acos");return qT.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(RI(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),jP=_I({acosh_:function(e){var t=vI(e,"x","acosh");return qT.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),UP=_I({asin_:function(e){var t=vI(e,"x","asin");return qT.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(RI(1).sub(n.toFloat().square()).sqrt())}}}))}}),qP=_I({asinh_:function(e){var t=vI(e,"x","asinh");return qT.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(RI(1).add(n.toFloat().square()).sqrt())}}}))}}),WP=_I({atan_:function(e){var t=vI(e,"x","atan");return qT.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),VP=_I({atanh_:function(e){var t=vI(e,"x","atanh");return qT.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(RI(1).sub(n.toFloat().square()))}}}))}}),$P=_I({ceil_:function(e){var t=vI(e,"x","ceil");return qT.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return XI(e)}}}))}}),HP=_I({clipByValue_:function(e,t,n){var r=vI(e,"x","clipByValue");MM(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var i=[r],a={min:t,max:n};return qT.runKernelFunc((function(e,i){var a=e.clip(r,t,n);return i([r]),a}),{x:r},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),XI(e))}}}),"ClipByValue",a,i)}}),GP=_I({cos_:function(e){var t=vI(e,"x","cos"),n=[t];return qT.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),KP=_I({cosh_:function(e){var t=vI(e,"x","cosh");return qT.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),XP=_I({erf_:function(e){var t=vI(e,"x","erf");return MM("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),qT.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),YP=_I({exp_:function(e){var t=vI(e,"x","exp");return qT.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),JP=_I({expm1_:function(e){var t=vI(e,"x","expm1");return qT.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),ZP=_I({floor_:function(e){var t=vI(e,"x","floor");return qT.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return XI(e)}}}))}}),QP=_I({log_:function(e){var t=vI(e,"x","log"),n=[t];return qT.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),eL=_I({log1p_:function(e){var t=vI(e,"x","log1p");return qT.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),tL=_I({logSigmoid_:function(e){var t=vI(e,"x","logSigmoid");return qT.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),nL=_I({neg_:function(e){var t=vI(e,"x","neg"),n=[t];return qT.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),rL=_I({reciprocal_:function(e){var t=vI(e,"x","reciprocal");return qT.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),iL=_I({round_:function(e){var t=vI(e,"x","round");return qT.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return XI(e)}}}))}}),aL=_I({rsqrt_:function(e){var t=vI(e,"x","rsqrt"),n=[t];return qT.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),oL=_I({sigmoid_:function(e){var t=vI(e,"x","sigmoid");return qT.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(RI(1).sub(n)))}}}),"Sigmoid")}}),sL=_I({sign_:function(e){var t=vI(e,"x","sign");return qT.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return XI(e)}}}))}}),uL=_I({isNaN_:function(e){var t=vI(e,"x","isNaN");return qT.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return XI(e)}}}))}}),cL=_I({isInf_:function(e){var t=vI(e,"x","isInf");return qT.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return XI(e)}}}))}}),lL=_I({isFinite_:function(e){var t=vI(e,"x","isFinite");return qT.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return XI(e)}}}))}}),fL=_I({sin_:function(e){var t=vI(e,"x","sin"),n=[t];return qT.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),pL=_I({sinh_:function(e){var t=vI(e,"x","sinh");return qT.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),hL=_I({softplus_:function(e){var t=vI(e,"x","softplus");return qT.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),dL=_I({sqrt_:function(e){var t=vI(e,"x","sqrt");return qT.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),mL=_I({step_:function(e,t){void 0===t&&(t=0);var n=vI(e,"x","step");return qT.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return XI(e)}}}))}}),gL=_I({tan_:function(e){var t=vI(e,"x","tan");return qT.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),vL=_I({tanh_:function(e){var t=vI(e,"x","tanh");return qT.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return RI(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}});function yL(e,t,n,r,i,a){var o,s,u=vI(e,"x","batchNorm"),c=vI(t,"mean","batchNorm"),l=vI(n,"variance","batchNorm");return null!=i&&(o=vI(i,"scale","batchNorm")),null!=r&&(s=vI(r,"offset","batchNorm")),MM(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),MM(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),MM(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=o&&MM(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),null!=s&&MM(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),wL(u,c,l,s,o,a)}function bL(e,t,n,r,i,a){var o,s,u=vI(e,"x","batchNorm"),c=vI(t,"mean","batchNorm"),l=vI(n,"variance","batchNorm");return null!=i&&(o=vI(i,"scale","batchNorm")),null!=r&&(s=vI(r,"offset","batchNorm")),MM(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),MM(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),MM(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=o&&MM(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),null!=s&&MM(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),wL(u,c,l,s,o,a)}function xL(e,t,n,r,i,a){var o,s,u=vI(e,"x","batchNorm"),c=vI(t,"mean","batchNorm"),l=vI(n,"variance","batchNorm");return null!=i&&(o=vI(i,"scale","batchNorm")),null!=r&&(s=vI(r,"offset","batchNorm")),MM(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),MM(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),MM(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=o&&MM(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),null!=s&&MM(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),wL(u,c,l,s,o,a)}function wL(e,t,n,r,i,a){null==a&&(a=.001);var o,s,u,c=vI(e,"x","batchNorm"),l=vI(t,"mean","batchNorm"),f=vI(n,"variance","batchNorm");null!=i&&(o=vI(i,"scale","batchNorm")),null!=r&&(s=vI(r,"offset","batchNorm")),MM(l.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),MM(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),MM(null==o||l.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var p=[c,l,f,o];return qT.runKernelFunc((function(e,t){var n=e.batchNormalization(u,EL(l),EL(f),a,EL(o),EL(s));return t([c,l,f,o]),n}),{x:c,mean:l,variance:f,scale:o,offset:s},(function(e,t){var n=t,r=n[0],i=n[1],o=n[2],s=n[3],c=null==s?RI(1):s,l=ER(i.shape,u.shape),f=[];if(1===i.rank){for(var p=0;p<u.shape.length-1;++p)f.push(u.shape[p]);f.push(1)}var h=r.sub(i),d=e.mul(c),m=aL(o.add(RI(a))),g=m.mul(m).mul(m).mul(RI(-.5));return{x:function(){return 1===i.rank?e.mul(LF(m.as4D(1,1,1,i.shape[0]),f)).mul(c).reshape(r.shape):e.mul(m).mul(c).reshape(r.shape)},mean:function(){var e=m.mul(RI(-1)).mul(d);return 1===i.rank&&(e=e.sum(l)),e.reshape(i.shape)},variance:function(){var e=g.mul(h).mul(d);return 1===i.rank&&(e=e.sum(l)),e.reshape(i.shape)},scale:function(){var t=h.mul(m),n=e.mul(t);return 1===i.rank&&(n=n.sum(l)),n.reshape(i.shape)},offset:function(){var t=e;return 1===i.rank&&(t=t.sum(l)),t.reshape(i.shape)}}}),"BatchNormalization",{varianceEpsilon:a},p).reshape(c.shape)}function EL(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function CL(){YO("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var SL=_I({batchNormalization2d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),CL(),yL(e,t,n,a,i,r)}}),NL=_I({batchNormalization3d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),CL(),bL(e,t,n,a,i,r)}}),AL=_I({batchNormalization4d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),CL(),xL(e,t,n,a,i,r)}}),kL=_I({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),CL(),wL(e,t,n,a,i,r)}}),DL=_I({batchNorm_:wL}),_L=_I({batchNorm2d_:yL}),ML=_I({batchNorm3d_:bL}),TL=_I({batchNorm4d_:xL}),OL=_I({logicalAnd_:function(e,t){var n=vI(e,"a","logicalAnd","bool"),r=vI(t,"b","logicalAnd","bool");return CR(n.shape,r.shape),qT.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),IL=_I({logicalNot_:function(e){var t=vI(e,"x","logicalNot","bool");return qT.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),FL=_I({logicalOr_:function(e,t){var n=vI(e,"a","logicalOr","bool"),r=vI(t,"b","logicalOr","bool");return CR(n.shape,r.shape),qT.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),RL=_I({logicalXor_:function(e,t){var n=vI(e,"a","logicalXor","bool"),r=vI(t,"b","logicalXor","bool");return CR(n.shape,r.shape),FL(e,t).logicalAnd(OL(e,t).logicalNot())}}),BL=_I({where_:function(e,t,n){var r=vI(t,"a","where"),i=vI(n,"b","where"),a=vI(e,"condition","where","bool");return TM(r.shape,i.shape,"Error in where: "),1===a.rank?MM(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):TM(a.shape,i.shape,"Error in where: "),qT.runKernelFunc((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return XI(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),zL=function(e){return lM(this,void 0,void 0,(function(){var t,n,r;return fM(this,(function(i){switch(i.label){case 0:return[4,(t=vI(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=tB(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},PL=_I({add_:function(e,t){var n,r=vI(e,"a","add"),i=vI(t,"b","add");n=RT(r,i),r=n[0],i=n[1];var a=CR(r.shape,i.shape);return qT.runKernelFunc((function(e){return e.add(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=ER(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=ER(i.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(i.shape)}}}),"Add")}}),LL=_I({addN_:function(e){MM(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),MM(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return vI(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!RM(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return qT.runKernelFunc((function(e){return e.addN(t)}),r,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}),"AddN")}}),jL=_I({addStrict_:function(e,t){var n=vI(e,"a","addStrict"),r=vI(t,"b","addStrict");return TM(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),UL=_I({atan2_:function(e,t){var n,r=vI(e,"a","atan2"),i=vI(t,"b","atan2");n=RT(r,i),r=n[0],i=n[1];var a=CR(r.shape,i.shape);return qT.runKernelFunc((function(e,t){var n=e.atan2(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=PL(n.square(),r.square()),i=e.mul(r.div(t)),o=ER(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},$b:function(){var t=PL(n.square(),r.square()),i=nL(e.mul(n.div(t))),o=ER(r.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(r.shape)}}}))}}),qL=_I({div_:function(e,t){var n,r=vI(e,"a","div"),i=vI(t,"b","div");if(n=RT(r,i),r=n[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return $L(r,i);var a=CR(r.shape,i.shape);return qT.runKernelFunc((function(e,t){var n=e.realDivide(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=ER(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=ER(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"Div")}}),WL=_I({divNoNan_:function(e,t){var n,r=vI(e,"a","div"),i=vI(t,"b","div");r=(n=RT(r,i))[0],i=n[1];var a=qL(r,i),o=XI(a),s=i.equal(o);return BL(s,o,a)}}),VL=_I({divStrict_:function(e,t){var n=vI(e,"a","div"),r=vI(t,"b","div");return TM(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),$L=_I({floorDiv_:function(e,t){var n,r=vI(e,"a","floorDiv"),i=vI(t,"b","floorDiv");n=RT(r,i),r=n[0],i=n[1];var a=CR(r.shape,i.shape);return qT.runKernelFunc((function(e,t){var n=e.floorDiv(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=ER(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=ER(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"FloorDiv")}}),HL=_I({maximum_:function(e,t){var n,r=vI(e,"a","maximum"),i=vI(t,"b","maximum");return n=RT(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),CR(r.shape,i.shape),qT.runKernelFunc((function(e,t){var n=e.maximum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),GL=_I({maximumStrict_:function(e,t){var n=vI(e,"a","maximumStrict"),r=vI(t,"b","maximumStrict");return TM(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),KL=_I({minimum_:function(e,t){var n,r=vI(e,"a","minimum"),i=vI(t,"b","minimum");return n=RT(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),CR(r.shape,i.shape),qT.runKernelFunc((function(e,t){var n=e.minimum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),XL=_I({minimumStrict_:function(e,t){var n=vI(e,"a","minimumStrict"),r=vI(t,"b","minimumStrict");return TM(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),YL=_I({mod_:function(e,t){var n,r=vI(e,"a","mod"),i=vI(t,"b","mod");n=RT(r,i),r=n[0],i=n[1];var a=CR(r.shape,i.shape);return qT.runKernelFunc((function(e,t){var n=e.mod(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=ER(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=ER(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),JL=_I({modStrict_:function(e,t){var n=vI(e,"a","modStrict"),r=vI(t,"b","modStrict");return TM(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),ZL=_I({mul_:function(e,t){var n,r=vI(e,"a","mul"),i=vI(t,"b","mul");n=RT(r,i),r=n[0],i=n[1];var a=CR(r.shape,i.shape);return qT.runKernelFunc((function(e,t){var n=e.multiply(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=ER(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=ER(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),QL=_I({mulStrict_:function(e,t){var n=vI(e,"a","mul"),r=vI(t,"b","mul");return TM(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),ej=_I({pow_:function(e,t){var n,r=vI(e,"base","pow"),i=vI(t,"exp","pow");n=RT(r,i),r=n[0],i=n[1];var a=CR(r.shape,i.shape),o=[r,i];return qT.runKernelFunc((function(e,t){var n=e.pow(r,i);return t([r,i,n]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1],i=t[2];return{a:function(){var t=r.toFloat(),i=e.mul(t.mul(n.pow(t.sub(RI(1))))),o=ER(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},b:function(){var t=n.greater(0),o=n.log().where(t,XI(n)),s=e.mul(i.mul(o)),u=ER(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}),"Pow",{},o,[!0])}}),tj=_I({powStrict_:function(e,t){return TM(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),nj=_I({squaredDifferenceStrict_:function(e,t){var n=vI(e,"a","squaredDifferenceStrict"),r=vI(t,"b","squaredDifferenceStrict");return TM(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),rj=_I({sub_:function(e,t){var n,r=vI(e,"a","sub"),i=vI(t,"b","sub");n=RT(r,i),r=n[0],i=n[1];var a=CR(r.shape,i.shape);return qT.runKernelFunc((function(e){return e.subtract(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=ER(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=ER(i.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(i.shape)}}}),"Sub")}}),ij=_I({subStrict_:function(e,t){var n=vI(e,"a","subStrict"),r=vI(t,"b","subStrict");return TM(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),aj=_I({equal_:function(e,t){var n,r=vI(e,"a","equal"),i=vI(t,"b","equal");return n=RT(r,i),r=n[0],i=n[1],CR(r.shape,i.shape),qT.runKernelFunc((function(e){return e.equal(r,i)}),{$a:r,$b:i})}}),oj=_I({equalStrict_:function(e,t){var n=vI(e,"a","equalStrict"),r=vI(t,"b","equalStrict");return TM(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),sj=_I({greater_:function(e,t){var n,r=vI(e,"a","greater"),i=vI(t,"b","greater");return n=RT(r,i),r=n[0],i=n[1],CR(r.shape,i.shape),qT.runKernelFunc((function(e){return e.greater(r,i)}),{a:r,b:i},null,"Greater")}}),uj=_I({greaterEqual_:function(e,t){var n,r=vI(e,"a","greaterEqual"),i=vI(t,"b","greaterEqual");return n=RT(r,i),r=n[0],i=n[1],CR(r.shape,i.shape),qT.runKernelFunc((function(e,t){var n=e.greaterEqual(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return XI(n)},b:function(){return XI(r)}}}),"GreaterEqual")}}),cj=_I({greaterEqualStrict_:function(e,t){var n=vI(e,"a","greaterEqualStrict"),r=vI(t,"b","greaterEqualStrict");return TM(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),lj=_I({greaterStrict_:function(e,t){var n=vI(e,"a","greaterStrict"),r=vI(t,"b","greaterStrict");return TM(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),fj=_I({less_:function(e,t){var n,r=vI(e,"a","less"),i=vI(t,"b","less");return n=RT(r,i),r=n[0],i=n[1],CR(r.shape,i.shape),qT.runKernelFunc((function(e){return e.less(r,i)}),{a:r,b:i},null,"Less")}}),pj=_I({lessEqual_:function(e,t){var n,r=vI(e,"a","lessEqual"),i=vI(t,"b","lessEqual");return n=RT(r,i),r=n[0],i=n[1],CR(r.shape,i.shape),qT.runKernelFunc((function(e,t){var n=e.lessEqual(r,i);return t([r,i]),n}),{a:r,b:i},null,"LessEqual")}}),hj=_I({lessEqualStrict_:function(e,t){var n=vI(e,"a","lessEqualStrict"),r=vI(t,"b","lessEqualStrict");return TM(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),dj=_I({lessStrict_:function(e,t){var n=vI(e,"a","lessStrict"),r=vI(t,"b","lessStrict");return TM(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),mj=_I({notEqual_:function(e,t){var n,r=vI(e,"a","notEqual"),i=vI(t,"b","notEqual");return n=RT(r,i),r=n[0],i=n[1],CR(r.shape,i.shape),qT.runKernelFunc((function(e){return e.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),gj=_I({notEqualStrict_:function(e,t){var n=vI(e,"a","notEqualStrict"),r=vI(t,"b","notEqualStrict");return TM(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function vj(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function yj(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var bj=_I({gather_:function(e,t,n){void 0===n&&(n=0);var r=vI(e,"x","gather"),i=vI(t,"indices","gather","int32");n=qM(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],i=[],a=1,o=1,s=0;s<n;s++)i.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)i.push(t.shape[s]);for(s=n+1;s<e.rank;s++)i.push(e.shape[s]),o*=e.shape[s];return{batchSize:a,sliceSize:o,dimSize:r,outputShape:i}}(r,i,n);return qT.runKernelFunc((function(e,t){var a=e.gather(r,i.flatten(),n);return t([i]),a}),{x:r,indices:i},(function(e,t){var i=t[0];return{x:function(){var t=r.shape,a=i.size,o=t.slice(0,n),s=o.length,u=t.slice(n,t.length).slice(1),c=u.length,l=vj(0,s),f=vj(s+1,s+1+c),p=yj([o,[a],u]),h=e.reshape(p),d=i.reshape([a]),m=yj([[s],l,f]),g=h.transpose(m),v=xj(g,d,r.shape[n]),y=NI(m);return v.transpose(y)},indices:function(){return i}}}),"Gather",{axis:n}).reshape(a.outputShape)}}),xj=_I({unsortedSegmentSum_:function(e,t,n){var r=vI(e,"x","unsortedSegmentSum"),i=vI(t,"segmentIds","unsortedSegmentSum","int32");return MM(BM(n),(function(){return"numSegments must be of dtype int"})),qT.runKernelFunc((function(e,t){var a=e.unsortedSegmentSum(r,i,n);return t([i]),a}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=HL(t,XI(t)),r=bj(e,n),i=uj(t,RI(0,"int32")),a=r.rank-i.rank,o=0;o<a;++o)i=EF(i,o+1);i=OL(i,WI(r.shape,"bool"));var s=XI(r);return BL(i,r,s)}(e,n)}}}))}}),wj=function(e,t,n){return lM(this,void 0,void 0,(function(){var r,i,a,o,s,u,c,l,f,p,h,d,m;return fM(this,(function(g){switch(g.label){case 0:for(r=vI(e,"tensor","boolMask"),i=vI(t,"mask","boolMask","bool"),a=null==n?0:n,o=i.rank,s=r.shape,MM(o>0,(function(){return"mask cannot be scalar"})),TM(s.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=a;c<a+o;c++)u*=s[c];return l=s.slice(0,a).concat([u],s.slice(a+o)),f=r.reshape(l),p=i.reshape([-1]),[4,zL(p)];case 1:return h=g.sent(),d=h.squeeze([1]),m=bj(f,d,a),e!==r&&r.dispose(),t!==i&&i.dispose(),d.dispose(),f.dispose(),p.dispose(),h.dispose(),[2,m]}}))}))};function Ej(e,t,n,r,i,a,o){void 0===a&&(a="NHWC"),MM(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),MM(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),MM(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),MM(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===a?s[3]:s[1],f="NHWC"===a?u.shape[3]:u.shape[1];MM(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),MM(f===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."})),null!=o&&MM(BM(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var p=RR(a),h=AR(s,n.shape,r,1,i,o,!1,p),d=qT.runKernelFunc((function(e,t){var r=e.conv2dDerInput(u,n,h);return t([n,u]),r}),{dy4D:u,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return Aj(e,n,r,i,a,1,o)},filter:function(){return Dj(e,s,n.shape,r,i,a,o)}}}));return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Cj(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function Sj(e,t,n,r,i){MM(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var a=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],c=o.shape[4];MM(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),MM(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),MM(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),MM(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),MM(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=kR(a,n.shape,r,1,i),f=qT.runKernelFunc((function(e){return e.conv3dDerInput(o,n,l)}),{dy5D:o});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var Nj=_I({conv1d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NWC"),void 0===a&&(a=1);var s=vI(e,"x","conv1d"),u=vI(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),MM(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),MM(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=o&&MM(BM(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),MM(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),MM(FR(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),MM("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),p=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Aj(p,f,[1,n],r,"NHWC",[1,a],o);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Aj=_I({conv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=vI(e,"x","conv2d"),u=vI(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),MM(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),MM(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=o&&MM(BM(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f="NHWC"===i?c.shape[3]:c.shape[1];MM(f===u.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."})),MM(FR(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var p=RR(i),h=AR(c.shape,u.shape,n,a,r,o,!1,p),d=[u,c],m=qT.runKernelFunc((function(e,t){var n=e.conv2d(c,u,h);return t([u,c]),n}),{x:c,filter:u},(function(e,t){var o=t,s=o[0],u=o[1];return MM(IR(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return _j(u.shape,e,s,n,r,i)},filter:function(){return Dj(u,e,s.shape,n,r,i)}}}),"Conv2D",h,d);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),kj=_I({conv3d_:function(e,t,n,r,i,a){void 0===i&&(i="NDHWC"),void 0===a&&(a=[1,1,1]);var o=vI(e,"x","conv3d"),s=vI(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),MM(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),MM(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),MM(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),MM(function(e,t){return Cj(e)||Cj(t)}(n,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),MM("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var l=kR(u.shape,s.shape,n,a,r),f=qT.runKernelFunc((function(e,t){var n=e.conv3d(u,s,l);return t([u,s]),n}),{x:u,$filter:s},(function(e,t){MM(Cj(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var i=t[0],o=t[1];return{x:function(){return Sj(i.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,i){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),MM(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),MM(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),MM(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),MM(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),MM(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=kR(a.shape,n,r,1,i);return qT.runKernelFunc((function(e){return e.conv3dDerFilter(a,o,s)}),{x5D:a,dy5D:o})}(i,e,o.shape,n,r)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Dj=_I({conv2dDerFilter_:function(e,t,n,r,i,a,o){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),MM(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),MM(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),MM(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===a?s.shape[3]:s.shape[1],l="NHWC"===a?u.shape[3]:u.shape[1];MM(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),MM(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=o&&MM(BM(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var f=RR(a),p=AR(s.shape,n,r,1,i,o,!1,f);return qT.runKernelFunc((function(e){return e.conv2dDerFilter(s,u,p)}),{x4D:s,dy4D:u})}}),_j=_I({conv2dDerInput_:Ej}),Mj=_I({depthwiseConv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=vI(e,"x","depthwiseConv2d"),u=vI(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),MM(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),MM(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),MM(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==a&&(a=[1,1]),MM(FR(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&MM(BM(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f=AR(c.shape,u.shape,n,a,r,o,!0),p=[c,u],h=qT.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(c,u,f);return t([c,u]),n}),{x:c,filter:u},(function(e,t){MM(IR(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=t[0],r=t[1];return{x:function(){return Tj(n.shape,e,r,f)},filter:function(){return Oj(n,e,r.shape,f)}}}),"DepthwiseConv2dNative",f,p);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Tj=_I({depthwiseConv2dDerInput_:function(e,t,n,r){var i=t,a=!1;3===t.rank&&(a=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=qT.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(i,n,r)}),{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),Oj=_I({depthwiseConv2dDerFilter_:function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),qT.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}}),Ij=_I({separableConv2d_:function(e,t,n,r,i,a,o){void 0===a&&(a=[1,1]),void 0===o&&(o="NHWC");var s=vI(e,"x","separableConv2d"),u=vI(t,"depthwiseFilter","separableConv2d"),c=vI(n,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");MM(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),MM(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),MM(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),MM(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),MM(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var p=u.shape[2],h=u.shape[3];MM(c.shape[2]===p*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*h+", but got "+c.shape[2]+"."}));var d=Mj(l,u,r,i,o,a),m=Aj(d,c,1,"valid",o);return f?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Fj=_I({conv2dTranspose_:function(e,t,n,r,i,a){return Ej(n,vI(e,"x","conv2dTranspose"),vI(t,"filter","conv2dTranspose"),r,i,"NHWC",a)}}),Rj=_I({conv3dTranspose_:function(e,t,n,r,i){return Sj(n,vI(e,"x","conv3dTranspose"),vI(t,"filter","conv3dTranspose"),r,i)}}),Bj=_I({matMul_:function(e,t,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=vI(e,"a","matMul"),o=vI(t,"b","matMul");i=RT(a,o),a=i[0],o=i[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?o.shape[o.rank-1]:o.shape[o.rank-2],c=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?o.shape[o.rank-2]:o.shape[o.rank-1],f=a.shape.slice(0,-2),p=o.shape.slice(0,-2),h=FM(f),d=FM(p);MM(a.rank>=2&&o.rank>=2&&a.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."})),MM(RM(f,p),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+p+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."})),MM(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=a.shape.slice(0,-2).concat([c,l]),g=n?a.as3D(h,s,c):a.as3D(h,c,s),v=r?o.as3D(d,l,u):o.as3D(d,u,l),y={transposeA:n,transposeB:r};return qT.runKernelFunc((function(e,t){var i=e.batchMatMul(g,v,n,r);return t([g,v]),i}),{a:g,b:v},(function(e,t){var i=t,a=i[0],o=i[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}}),"BatchMatMul",y).reshape(m)}}),zj=_I({dot_:function(e,t){var n=vI(e,"t1","dot"),r=vI(t,"t2","dot");MM(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return MM(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Pj=_I({outerProduct_:function(e,t){var n=vI(e,"v1","outerProduct"),r=vI(t,"v2","outerProduct");return MM(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Lj=_I({reverse_:function(e,t){var n=vI(e,"x","reverse");if(0===n.rank)return n.clone();var r=qM(t,n.shape);return qT.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),jj=_I({reverse1d_:function(e){var t=vI(e,"x","reverse");return MM(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),Lj(t,0)}}),Uj=_I({reverse2d_:function(e,t){var n=vI(e,"x","reverse");return MM(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),Lj(n,t)}}),qj=_I({reverse3d_:function(e,t){var n=vI(e,"x","reverse");return MM(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),Lj(n,t)}}),Wj=_I({reverse4d_:function(e,t){var n=vI(e,"x","reverse");return MM(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),Lj(n,t)}});function Vj(e,t,n,r,i,a){var o=vI(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),MM(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),MM(FR(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&MM(BM(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=SR(s.shape,t,n,r,i,a);if(1===c.filterWidth&&1===c.filterHeight&&RM(c.inShape,c.outShape))return o.clone();var l=[s],f=qT.runKernelFunc((function(e,t){var n=e.maxPool(s,c);return t([s,n]),n}),{x:s},(function(e,a){var o=a[0],s=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=vI(e,"dy","maxPoolBackprop"),c=vI(t,"input","maxPoolBackprop"),l=vI(n,"output","maxPoolBackprop");MM(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==a&&(a=[1,1]),MM(FR(i,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),MM(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),MM(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var f=SR(c.shape,r,i,a,o,void 0);return qT.runKernelFunc((function(e){return e.maxPoolBackprop(u,c,l,f)}),{$dy:u,$input:c})}(e,o,s,t,n,r,i)}}}),"MaxPool",c,l);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function $j(e,t,n,r,i,a){var o=vI(e,"x","avgPool","float32");null==r&&(r=[1,1]),MM(FR(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),MM(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&MM(BM(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=SR(s.shape,t,n,r,i,a);if(1===c.filterWidth&&1===c.filterHeight&&RM(c.inShape,c.outShape))return o.clone();var l=qT.runKernelFunc((function(e){return e.avgPool(s,c)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,i,a){var o=vI(e,"dy","avgPoolBackprop"),s=vI(t,"input","avgPoolBackprop");MM(s.rank===o.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"})),null==i&&(i=[1,1]),MM(FR(r,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}));var u=s,c=o,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),MM(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),MM(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var f=SR(u.shape,n,r,i,a),p=qT.runKernelFunc((function(e){return e.avgPoolBackprop(c,u,f)}),{dy4D:c,input4D:u});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}(e,s,t,n,r,i)}}}),"AvgPool",c);return l=l.cast(o.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Hj=_I({maxPool_:function(e,t,n,r,i){return Vj(e,t,n,1,r,i)}}),Gj=_I({avgPool_:function(e,t,n,r,i){return $j(e,t,n,1,r,i)}}),Kj=_I({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");var o=vI(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),MM(FR(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var c,l=SR(s.shape,t,a,i,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),i=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],i[t]]}))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var p=1===f[0]&&1===f[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),i=n.map((function(e){return e[1]})),a=e.concat(r,i),o=t.map((function(e,t){return(e-a[t]%e)%e})),s=i.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],f,c),d=h[0],m=h[1],g=p?r:"valid",v=p?s:BF(s,f,d),y=("avg"===n?function(){return $j(v,t,a,1,g)}:function(){return Vj(v,t,a,1,g)})(),b=p?y:gF(y,f,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),Xj=_I({maxPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=vI(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),MM(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),MM("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),MM(FR(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&MM(BM(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=NR(u.shape,t,n,o,r,i,a),f=qT.runKernelFunc((function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n}),{x:u},(function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var u=vI(e,"dy","maxPool3dBackprop"),c=vI(t,"input","maxPool3dBackprop"),l=vI(n,"output","maxPool3dBackprop"),f=u,p=c,h=l,d=!1;4===c.rank&&(d=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),p=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),MM(5===f.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."})),MM(5===p.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+p.rank+"."})),MM(5===h.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."})),null==a&&(a=[1,1,1]),MM(FR(i,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),null!=s&&MM(BM(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var m=NR(p.shape,r,i,a,o,s),g=qT.runKernelFunc((function(e){return e.maxPool3dBackprop(f,p,h,m)}),{dy5D:f,input5D:p});return d?g.as4D(g.shape[1],g.shape[2],g.shape[3],g.shape[4]):g}(e,s,u,t,n,o,r,i)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Yj=_I({avgPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=vI(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),MM(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),MM("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),MM(FR(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&MM(BM(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=NR(u.shape,t,n,o,r,i,a),f=qT.runKernelFunc((function(e){return e.avgPool3d(u,l)}),{x:u},(function(e){return{x:function(){return function(e,t,n,r,i,a,o){var s=vI(e,"dy","avgPool3dBackprop"),u=vI(t,"input","avgPool3dBackprop"),c=s,l=u,f=!1;4===u.rank&&(f=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),MM(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),MM(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==i&&(i=[1,1,1]),MM(FR(r,i),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"})),null!=o&&MM(BM(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var p=NR(l.shape,n,r,i,a,o),h=qT.runKernelFunc((function(e){return e.avgPool3dBackprop(c,l,p)}),{dy5D:c,input5D:l});return f?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(e,u,t,n,o,r,i)}}}));return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Jj=_I({slice_:function(e,t,n){var r,i,a=vI(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach((function(e){MM(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(MM(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),a.shape[t]-r[t])})),tR(a,r,i);var o=a.shape,s={begin:r,size:i};return qT.runKernelFunc((function(e){return e.slice(a,r,i)}),{x:a},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-i[n]]);return{x:function(){return e.pad(t)}}}),"Slice",s)}}),Zj=_I({slice1d_:function(e,t,n){var r=vI(e,"x","slice1d");return MM(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Jj(r,[t],[n])}}),Qj=_I({slice2d_:function(e,t,n){var r=vI(e,"x","slice2d");return MM(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Jj(r,t,n)}}),eU=_I({slice3d_:function(e,t,n){var r=vI(e,"x","slice3d");return MM(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Jj(r,t,n)}}),tU=_I({slice4d_:function(e,t,n){var r=vI(e,"x","slice4d");return MM(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Jj(r,t,n)}});function nU(e,t,n,r,i){return t.rank<n.rank&&(t=t.reshape(EI(t.shape,r))),e.rank<n.rank&&(e=e.reshape(EI(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==i?r:r.transpose(i)}}}var rU=_I({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=vI(e,"x","all","bool"),i=qM(t,r.shape),a=i,o=SI(a,r.rank);null!=o&&(r=r.transpose(o),a=AI(a.length,r.rank));var s=qT.runKernelFunc((function(e){return e.all(r,a)}),{$x:r});if(n){var u=EI(s.shape,i);return s.reshape(u)}return s}}),iU=_I({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=vI(e,"x","any","bool"),i=qM(t,r.shape),a=i,o=SI(a,r.rank);null!=o&&(r=r.transpose(o),a=AI(a.length,r.rank));var s=qT.runKernelFunc((function(e){return e.any(r,a)}),{$x:r});if(n){var u=EI(s.shape,i);return s.reshape(u)}return s}}),aU=_I({argMax_:function(e,t){void 0===t&&(t=0);var n=vI(e,"x","argMax");null==t&&(t=0);var r=qM(t,n.shape),i=SI(r,n.rank);null!=i&&(n=n.transpose(i),r=AI(r.length,n.rank));var a={axis:r[0]},o=[n];return qT.runKernelFunc((function(e,t){var i=e.argMax(n,r[0]);return t([n]),i}),{x:n},(function(e,t){var n=t[0];return{x:function(){return XI(n)}}}),"ArgMax",a,o)}}),oU=_I({argMin_:function(e,t){void 0===t&&(t=0);var n=vI(e,"x","argMin");null==t&&(t=0);var r=qM(t,n.shape),i=SI(r,n.rank);return null!=i&&(n=n.transpose(i),r=AI(r.length,n.rank)),qT.runKernelFunc((function(e,t){var i=e.argMin(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return XI(n)}}}))}}),sU=_I({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=vI(e,"x","logSumExp"),i=qM(t,r.shape),a=r.max(i,!0),o=r.sub(a).exp().sum(i).log(),s=a.reshape(o.shape).add(o);if(n){var u=EI(s.shape,i);return s.reshape(u)}return s}}),uU=_I({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=vI(e,"x","max"),i=r,a=qM(t,r.shape),o=a,s=SI(o,r.rank);null!=s&&(r=r.transpose(s),o=AI(o.length,r.rank));var u=[r],c=qT.runKernelFunc((function(e,t){var n=e.max(r,o);return t([i,n]),n}),{x:r},(function(e,t){return nU(e,t[1],t[0],a,s)}),"Max",{axes:o},u,[!0]);if(n){var l=EI(c.shape,a);c=c.reshape(l)}return c}}),cU=_I({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=vI(e,"x","mean"),i=qM(t,r.shape),a=FM(wI(r.shape,i)[1]);return dR((function(e){var r=RI(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(WI(e.shape,"float32")).div(a)}}}))(r)}}),lU=_I({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=vI(e,"x","min"),i=r,a=qM(t,r.shape),o=a,s=SI(o,r.rank);null!=s&&(r=r.transpose(s),o=AI(o.length,r.rank));var u=[r],c=qT.runKernelFunc((function(e,t){var n=e.min(r,o);return t([i,n]),n}),{x:r},(function(e,t){return nU(e,t[1],t[0],a,s)}),"Min",{axes:o},u,[!0]);if(n){var l=EI(c.shape,a);c=c.reshape(l)}return c}}),fU=_I({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=qM(t,(e=vI(e,"x","moments")).shape),i=e.mean(r,n),a=i.shape;n||(a=EI(i.shape,r));var o=e.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:o.mean(r,n)}}}),pU=_I({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=vI(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=qM(t,r.shape);return dR((function(e){var t=SI(i,e.rank),r=i,a=e;null!=t&&(a=e.transpose(t),r=AI(r.length,e.rank));var o=function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(WI(e.shape,"float32"))},s={axes:r},u=qT.runKernelFunc((function(e){return e.sum(a,r)}),{x:a},(function(e){return{x:function(){return o(e)}}}),"Sum",s);if(n){var c=EI(u.shape,i);u=u.reshape(c)}return{value:u,gradFunc:o}}))(r)}}),hU=_I({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=vI(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=qM(t,r.shape),a=SI(i,r.rank),o=i,s=r;null!=a&&(s=r.transpose(a),o=AI(o.length,r.rank));var u=qT.runKernelFunc((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var c=EI(u.shape,i);u=u.reshape(c)}return u}}),dU=_I({elu_:function(e){var t=vI(e,"x","elu");return qT.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return qT.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),mU=_I({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=vI(e,"x","leakyRelu");return HL(RI(t).mul(n),n)}}),gU=_I({prelu_:function(e,t){var n=vI(e,"x","prelu"),r=vI(t,"alpha","prelu");return qT.runKernelFunc((function(e,t){var i=e.prelu(n,r);return t([n,r]),i}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],i=n.greater(0);return{x:function(){return BL(i,e,e.mul(r))},alpha:function(){var t=BL(i,XI(e),e.mul(n)),a=ER(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}}),"Prelu")}}),vU=_I({relu_:function(e){var t=vI(e,"x","relu");return"bool"===t.dtype?t.toInt():qT.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),yU=_I({relu6_:function(e){var t=vI(e,"x","relu6");return"bool"===t.dtype?t.toInt():qT.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),bU=_I({selu_:function(e){var t=vI(e,"x","selu");return qT.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(RI(0)),r=RI(1.7580993408473768),i=RI(1.0507009873554805),a=e.mul(i),o=e.mul(r).mul(n.toFloat().exp());return BL(t,a,o)}}}))}}),xU=_I({transpose_:function(e,t){var n=vI(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),MM(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){MM(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var r={perm:t};return qT.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},(function(e){var n=NI(t);return{x:function(){return e.transpose(n)}}}),"Transpose",r)}}),wU=_I({localResponseNormalization_:function(e,t,n,r,i){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var a=vI(e,"x","localResponseNormalization");MM(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),MM(BM(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=a,s=!1;3===a.rank&&(s=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=qT.runKernelFunc((function(e,a){var s=e.localResponseNormalization4D(o,t,n,r,i);return a([o,s]),s}),{x4D:o},(function(e,a){var o=a[0],s=a[1];return{x4D:function(){return qT.runKernelFunc((function(a){return a.LRNGrad(e,o,s,t,n,r,i)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),EU=_I({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(RI(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=vI(e,"x","norm"),t,n),a=i.shape;if(r){var o=qM(n,e.shape);a=EI(i.shape,o)}return i.reshape(a)}}),CU=_I({basicLSTMCell_:function(e,t,n,r,i,a){var o=vI(e,"forgetBias","basicLSTMCell"),s=vI(t,"lstmKernel","basicLSTMCell"),u=vI(n,"lstmBias","basicLSTMCell"),c=vI(r,"data","basicLSTMCell"),l=vI(i,"c","basicLSTMCell"),f=vI(a,"h","basicLSTMCell"),p=c.concat(f,1).matMul(s).add(u),h=p.shape[0],d=p.shape[1]/4,m=[h,d],g=p.slice([0,0],m),v=p.slice([0,d],m),y=p.slice([0,2*d],m),b=p.slice([0,3*d],m),x=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(o.add(y).sigmoid())),w=x.tanh().mulStrict(b.sigmoid());return[x,w]}}),SU=_I({multiRNNCell_:function(e,t,n,r){for(var i=vI(t,"data","multiRNNCell"),a=yI(n,"c","multiRNNCell"),o=yI(r,"h","multiRNNCell"),s=i,u=[],c=0;c<e.length;c++){var l=e[c](s,a[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],p=[];for(c=0;c<u.length;c+=2)f.push(u[c]),p.push(u[c+1]);return[f,p]}}),NU=_I({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var a=vI(e,"v","movingAverage"),o=vI(t,"x","movingAverage"),s=vI(n,"decay","movingAverage");BT(a,o),MM(RM(a.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=RI(1),c=u.sub(s),l=o.sub(a).mul(c);if(i){MM(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var f=vI(r,"step","movingAverage");l=l.div(u.sub(ej(s,f)))}return a.add(l)}}),AU=_I({stridedSlice_:function(e,t,n,r,i,a,o,s,u){if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var c=vI(e,"x","stridedSlice"),l=nR(s),f=c.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,f.splice(e,0,1)})),c=c.reshape(f);for(var p=0;p<c.rank;p++)t[p]=iR(i,t,r,c.shape,p),n[p]=aR(a,n,r,c.shape,p),r[p]=r[p]||1;var h=nR(u);h.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var d=rR(t,n,r),m=d.filter((function(e,t){return-1===h.indexOf(t)}));return r.every((function(e){return 1===e}))?Jj(c,t,d).reshape(m):qT.runKernelFunc((function(e){return e.stridedSlice(c,t,n,r)}),{$x:c}).reshape(m)}}),kU=_I({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=vI(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var a=qT.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),DU=_I({scatterND_:function(e,t,n){var r=vI(e,"indices","scatterND","int32"),i=vI(t,"updates","scatterND");return ZF(i,r,n),qT.runKernelFunc((function(e){return e.scatterND(r,i,n)}),{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),_U=_I({fft_:function(e){MM("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return qT.runKernelFunc((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),MU=_I({ifft_:function(e){MM("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return qT.runKernelFunc((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),TU=_I({rfft_:function(e,t){MM("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){var a=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(a,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(VI(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=MI(n,u).as2D(i,r),l=_U(c),f=Math.floor(r/2)+1,p=TI(l),h=OI(l),d=p.split([f,r-f],p.shape.length-1),m=h.split([f,r-f],h.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=f,MI(d[0],m[0]).reshape(g)}}),OU=_I({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),i=MU(r);return TI(i)}var a=[n,2*(t-1)],o=TI(e).as2D(n,t),s=OI(e).as2D(n,t),u=o.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(RI(-1)),l=o.concat(u,1),f=s.concat(c,1);return r=MI(l,f).as2D(a[0],a[1]),i=MU(r),TI(i)}}),IU=Object.freeze({fft:_U,ifft:MU,rfft:TU,irfft:OU}),FU=_I({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var i=vI(e,"sparseIndices","sparseToDense","int32"),a=vI(t,"sparseValues","sparseToDense"),o=vI(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),qT.runKernelFunc((function(e){return e.sparseToDense(i,a,n,o)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),RU=_I({gatherND_:function(e,t){var n=vI(t,"indices","gatherND","int32"),r=vI(e,"x","gatherND");return qT.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),BU=_I({diag_:function(e){var t=vI(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return qT.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),zU=_I({dropout_:function(e,t,n,r){var i=vI(e,"x","dropout");if(MM("float32"===i.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),MM(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof NT?i.clone():i;var a=function(e,t){if(null==t)return e.shape.slice();if(RM(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(i,n),o=1-t,s=FF(a,0,1,"float32",r).add(o).floor().div(o);return i.mul(s)}});function PU(e,t,n){for(var r=1-e%2,i=new Float32Array(e),a=0;a<e;++a){var o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return BI(i,"float32")}var LU,jU=_I({hannWindow_:function(e){return PU(e,.5,.5)}}),UU=_I({hammingWindow_:function(e){return PU(e,.54,.46)}}),qU=_I({frame_:function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var a=0,o=[];a+t<=e.size;)o.push(Jj(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=YI([Jj(e,a,t-s),$I([s],i)]);o.push(u),a+=n}return 0===o.length?zI([],[0,t]):YI(o).as2D(o.length,t)}}),WU=_I({stft_:function(e,t,n,r,i){var a;void 0===i&&(i=jU),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=qU(e,t,n),s=ZL(o,i(t)),u=[],c=0;c<o.shape[0];c++)u.push(TU(s.slice([c,0],[1,t]),r));return YI(u)}}),VU=Object.freeze({hannWindow:jU,hammingWindow:UU,frame:qU,stft:WU}),$U=function(e,t,n){return void 0===n&&(n=1),lM(this,void 0,void 0,(function(){var r,i,a,o,s,u,c,l,f,p,h,d,m,g;return fM(this,(function(v){switch(v.label){case 0:return r=vI(e,"predictions","inTopK"),i=vI(t,"targets","inTopK"),MM(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),MM(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),TM(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],MM(n>0&&n<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n})),[4,r.data()];case 1:return o=v.sent(),[4,i.data()];case 2:for(s=v.sent(),u=[o.length/a,a],l=u[1],f=VM("bool",c=u[0]),p=0;p<c;p++){for(h=p*l,d=o.subarray(h,h+l),m=[],g=0;g<d.length;g++)m.push({value:d[g],index:g});for(m.sort((function(e,t){return t.value-e.value})),f[p]=0,g=0;g<n;g++)if(m[g].index===s[p]){f[p]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),[2,II(f,i.shape,"bool")]}}))}))};!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(LU||(LU={}));var HU=_I({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=LU.SUM_BY_NONZERO_WEIGHTS);var i=vI(e,"labels","absoluteDifference"),a=vI(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=vI(n,"weights","absoluteDifference")),TM(i.shape,a.shape,"Error in absoluteDifference: ");var s=i.sub(a).abs();return GU(s,o,r)}}),GU=_I({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=LU.SUM_BY_NONZERO_WEIGHTS);var r=vI(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=vI(t,"weights","computeWeightedLoss"));var a=null==i?r:r.mul(i);if(n===LU.NONE)return a;if(n===LU.SUM)return a.sum();if(n===LU.MEAN){if(null==i)return a.mean();var o=r.size/i.size,s=a.sum().div(i.sum());return o>1?s.div(RI(o)):s}if(n===LU.SUM_BY_NONZERO_WEIGHTS){if(null==i)return a.sum().div(RI(r.size));var u=i.mul(WI(r.shape)).notEqual(RI(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),KU=_I({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=LU.SUM_BY_NONZERO_WEIGHTS);var a=vI(e,"labels","cosineDistance"),o=vI(t,"predictions","cosineDistance"),s=null;null!=r&&(s=vI(r,"weights","cosineDistance")),TM(a.shape,o.shape,"Error in cosineDistance: ");var u=RI(1).sub(a.mul(o).sum(n,!0));return GU(u,s,i)}}),XU=_I({hingeLoss_:function(e,t,n,r){void 0===r&&(r=LU.SUM_BY_NONZERO_WEIGHTS);var i=vI(e,"labels","hingeLoss"),a=vI(t,"predictions","hingeLoss"),o=null;null!=n&&(o=vI(n,"weights","hingeLoss")),TM(i.shape,a.shape,"Error in hingeLoss: ");var s=RI(1);i=RI(2).mul(i).sub(s);var u=s.sub(i.mul(a)).relu();return GU(u,o,r)}}),YU=_I({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=LU.SUM_BY_NONZERO_WEIGHTS);var a=vI(e,"labels","huberLoss"),o=vI(t,"predictions","huberLoss"),s=null;null!=n&&(s=vI(n,"weights","huberLoss")),TM(a.shape,o.shape,"Error in huberLoss: ");var u=RI(r),c=o.sub(a).abs(),l=KL(c,u),f=c.sub(l),p=RI(.5).mul(l.square()).add(u.mul(f));return GU(p,s,i)}}),JU=_I({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=LU.SUM_BY_NONZERO_WEIGHTS);var a=vI(e,"labels","logLoss"),o=vI(t,"predictions","logLoss"),s=null;null!=n&&(s=vI(n,"weights","logLoss")),TM(a.shape,o.shape,"Error in logLoss: ");var u=RI(1),c=RI(r),l=a.mul(o.add(c).log()).neg().sub(u.sub(a).mul(u.sub(o).add(c).log()));return GU(l,s,i)}}),ZU=_I({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=LU.SUM_BY_NONZERO_WEIGHTS);var i=vI(e,"labels","meanSquaredError"),a=vI(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=vI(n,"weights","meanSquaredError")),TM(i.shape,a.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(a);return GU(s,o,r)}}),QU=_I({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=LU.SUM_BY_NONZERO_WEIGHTS);var a=vI(e,"multiClassLabels","sigmoidCrossEntropy"),o=vI(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=vI(n,"weights","sigmoidCrossEntropy")),TM(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=RI(r),c=RI(1),l=RI(.5);a=a.mul(c.sub(u)).add(l.mul(u))}var f=function(e,t){var n=vI(e,"labels","sigmoidCrossEntropyWithLogits"),r=vI(t,"logits","sigmoidCrossEntropyWithLogits");TM(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),a=r.mul(n),o=r.abs().neg().exp().log1p();return i.sub(a).add(o)}(a,o);return GU(f,s,i)}}),eq=_I({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=LU.SUM_BY_NONZERO_WEIGHTS);var a=vI(e,"onehotLabels","softmaxCrossEntropy"),o=vI(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=vI(n,"weights","softmaxCrossEntropy")),TM(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=RI(r),c=RI(1),l=RI(a.shape[1]);a=a.mul(c.sub(u)).add(u.div(l))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return dR((function(e,t,r){var i=t.logSumExp([n],!0),a=t.toFloat().sub(i);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],i=t[1],a=EI(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(i.exp())),e.reshape(a).mul(i.exp().sub(r.toFloat()))]}}}))(e,t)}(a,o);return GU(f,s,i)}}),tq=Object.freeze({get Reduction(){return LU},absoluteDifference:HU,computeWeightedLoss:GU,cosineDistance:KU,hingeLoss:XU,huberLoss:YU,logLoss:JU,meanSquaredError:ZU,sigmoidCrossEntropy:QU,softmaxCrossEntropy:eq});function nq(e,t){return void 0===t&&(t=!1),qT.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],i=CF(n),a=e.clone(),o=zI([[1]],[1,1]),s=o.clone(),u=n>=r?r:n,c=function(e){var t,u=a,c=s,l=i;t=qT.tidy((function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),c=a.slice([e,e],[1,1]),l=zI([[-1]]).where(c.greater(0),zI([[1]])),f=c.sub(l.mul(u)),p=t.div(f);s=1===p.shape[0]?o.clone():o.concat(p.slice([1,0],[p.shape[0]-1,p.shape[1]]),0);var h=l.matMul(f).div(u).neg(),d=a.slice([e,0],[n-e,r]),m=h.mul(s);if(0===e)a=d.sub(m.matMul(s.transpose().matMul(d)));else{var g=d.sub(m.matMul(s.transpose().matMul(d)));a=a.slice([0,0],[e,r]).concat(g,0)}var v=i.slice([0,e],[n,i.shape[1]-e]);if(0===e)i=v.sub(v.matMul(s).matMul(m.transpose()));else{var y=v.sub(v.matMul(s).matMul(m.transpose()));i=i.slice([0,0],[n,e]).concat(y,1)}return[s,a,i]})),s=t[0],a=t[1],i=t[2],nI([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(i=i.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var rq=_I({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=vI(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,a=r.shape.slice(-2),o=a[0],s=a[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var u=GI(0,o,1,"int32").reshape([-1,1]),c=GI(0,s,1,"int32"),l=rj(u,c),f=OL(l.lessEqual(RI(+t,"int32")),l.greaterEqual(RI(-n,"int32"))),p=VI([o,s],r.dtype);return PF(UF(r.reshape([-1,o,s])).map((function(e){return BL(f,e,p)}))).reshape(i)}}),iq=_I({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,MM(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){MM(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},i=1;i<e.length;++i)r(i)}else t=!0,e=tF(e,e.shape[0],0).map((function(e){return zF(e,[0])}));MM(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var a=[],o=e,s=function(e){a.push(qT.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=pU(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(EU(t,"euclidean"))})))};for(i=0;i<e.length;++i)s(i);return t?PF(a,0):a}}),aq=_I({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return nq(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=UF(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];return r.forEach((function(e){var n=nq(e,t),r=n[0],o=n[1];i.push(r),a.push(o)})),[PF(i,0).reshape(e.shape),PF(a,0).reshape(e.shape)]}}),oq=Object.freeze({bandPart:rq,gramSchmidt:iq,qr:aq});function sq(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);var o=e.shape[0];return n=Math.min(n,o),MM(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),MM(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),MM(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),MM(1===t.rank,(function(){return"scores must be a 1D tensor"})),MM(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]})),MM(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}var uq=_I({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=vI(e,"images","resizeBilinear");MM(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),MM(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=qT.runKernelFunc((function(e,t){return t([i]),e.resizeBilinear(i,o,s,n)}),{x:i},(function(e,t){return{x:function(){return qT.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),cq=_I({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=vI(e,"images","resizeNearestNeighbor");MM(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),MM(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),MM("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=qT.runKernelFunc((function(e,t){return t([i]),e.resizeNearestNeighbor(i,o,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return qT.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),lq=_I({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var a=vI(e,"boxes","nonMaxSuppression"),o=vI(t,"scores","nonMaxSuppression"),s=sq(a,o,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return qT.runKernelFunc((function(e){return e.nonMaxSuppression(a,o,n,r,i)}),{boxes:a,scores:o},null,"NonMaxSuppressionV3",u)}}),fq=_I({nonMaxSuppressionWithScore_:function(e,t,n,r,i,a){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var o=vI(e,"boxes","nonMaxSuppression"),s=vI(t,"scores","nonMaxSuppression"),u=sq(o,s,n,r,i,a),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},l=qT.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),pq=_I({cropAndResize_:function(e,t,n,r,i,a){var o=vI(e,"image","cropAndResize"),s=vI(t,"boxes","cropAndResize","float32"),u=vI(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var c=s.shape[0];return MM(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),MM(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),MM(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),MM(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),MM(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),MM("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),qT.runKernelFunc((function(e,t){return e.cropAndResize(o,s,u,r,i,a)}),{images:o,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:r})}}),hq=Object.freeze({resizeBilinear:uq,resizeNearestNeighbor:cq,nonMaxSuppression:lq,nonMaxSuppressionAsync:function(e,t,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),lM(this,void 0,void 0,(function(){var a,o,s,u,c,l,f;return fM(this,(function(p){switch(p.label){case 0:return a=vI(e,"boxes","nonMaxSuppressionAsync"),o=vI(t,"scores","nonMaxSuppressionAsync"),s=sq(a,o,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return u=p.sent(),c=u[0],l=u[1],f=HR(c,l,n,r,i),a!==e&&a.dispose(),o!==t&&o.dispose(),[2,f]}}))}))},nonMaxSuppressionWithScore:fq,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,i,a){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),lM(this,void 0,void 0,(function(){var o,s,u,c,l,f,p;return fM(this,(function(h){switch(h.label){case 0:return o=vI(e,"boxes","nonMaxSuppressionAsync"),s=vI(t,"scores","nonMaxSuppressionAsync"),u=sq(o,s,n,r,i,a),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=h.sent(),l=c[0],f=c[1],p=GR(l,f,n,r,i,a),o!==e&&o.dispose(),s!==t&&s.dispose(),[2,p]}}))}))},cropAndResize:pq}),dq=function(e,t){return!(e>0)||"linear"===t},mq=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},gq=function(e,t){var n=t,r=ER(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},vq=function(e,t,n){if("linear"===t)return e;if("relu"===t)return vU(e);if("elu"===t)return dU(e);if("relu6"===t)return yU(e);if("prelu"===t)return gU(e,n);throw new Error("Unknown fused activation "+t+".")},yq=_I({fusedMatMul_:function(e){var t,n=e.a,r=e.b,i=e.transposeA,a=void 0!==i&&i,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,f=e.preluActivationWeights;if(!1===dq(qT.state.gradientDepth,l)){var p=Bj(n,r,a,s);return null!=u&&(p=PL(p,u)),vq(p,l,f)}var h=vI(n,"a","fused matMul"),d=vI(r,"b","fused matMul");t=RT(h,d),h=t[0],d=t[1];var m=a?h.shape[h.rank-2]:h.shape[h.rank-1],g=s?d.shape[d.rank-1]:d.shape[d.rank-2],v=a?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?d.shape[d.rank-2]:d.shape[d.rank-1],b=h.shape.slice(0,-2),x=d.shape.slice(0,-2),w=FM(b),E=FM(x);MM(h.rank>=2&&d.rank>=2&&h.rank===d.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+d.rank+"."})),MM(RM(b,x),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+h.shape+" and "+d.shape+" must match."})),MM(m===g,(function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+h.shape+" and "+d.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var C,S,N=h.shape.slice(0,-2).concat([v,y]),A=a?h.as3D(w,m,v):h.as3D(w,v,m),k=s?d.as3D(E,y,g):d.as3D(E,g,y);null!=u&&CR(N,(C=RT(C=vI(u,"bias","fused matMul"),h)[0]).shape),null!=f&&(S=vI(f,"prelu weights","fused matMul"));var D={a:A,b:k};null!=u&&(D.bias=C),null!=f&&(D.preluActivationWeights=S);var _=[A,k];return qT.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:A,b:k,transposeA:a,transposeB:s,bias:C,activation:l,preluActivationWeights:S});return t([A,k,n]),n}),D,(function(e,t){var n=t[0],r=t[1],i=t[2],o=mq(e,i,l),c={};return null!=u&&(c={bias:function(){return gq(C,o)}}),a||s?!a&&s?Object.assign({a:function(){return o.matMul(r,!1,!1)},b:function(){return o.matMul(n,!0,!1)}},c):a&&!s?Object.assign({a:function(){return r.matMul(o,!1,!0)},b:function(){return n.matMul(o,!1,!1)}},c):Object.assign({a:function(){return r.matMul(o,!0,!0)},b:function(){return o.matMul(n,!0,!0)}},c):Object.assign({a:function(){return o.matMul(r,!1,!0)},b:function(){return n.matMul(o,!0,!1)}},c)}),"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},_,[!0]).reshape(N)}}),bq=_I({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,p=void 0===f?"linear":f,h=e.preluActivationWeights;if(p=p||"linear",!1===dq(qT.state.gradientDepth,p)){var d=Aj(t,n,r,i,o,u,c);return null!=l&&(d=PL(d,l)),vq(d,p,h)}var m=vI(t,"x","conv2d"),g=vI(n,"filter","conv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),MM(4===v.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."})),MM(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."})),null!=c&&MM(BM(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."})),MM(v.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."})),MM(FR(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),MM("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var b,x,w=AR(v.shape,g.shape,r,u,i,c);null!=l&&(b=RT(b=vI(l,"bias","fused conv2d"),m)[0],CR(w.outShape,b.shape)),null!=h&&(x=vI(h,"prelu weights","fused conv2d"));var E={x:v,filter:g};null!=l&&(E.bias=b),null!=h&&(E.preluActivationWeights=x);var C=[g,v],S=qT.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:v,filter:g,convInfo:w,bias:b,activation:p,preluActivationWeights:x});return t([g,v,n]),n}),E,(function(e,t){var n=t,a=n[0],o=n[1],s=n[2],c=mq(e,s,p);MM(IR(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var f={};return null!=l&&(f={bias:function(){return gq(b,c)}}),Object.assign({x:function(){return _j(o.shape,c,a,r,i)},filter:function(){return Dj(o,c,a.shape,r,i)}},f)}),"FusedConv2D",{convInfo:w,activation:p},C,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),xq=_I({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,p=void 0===f?"linear":f,h=e.preluActivationWeights;if(!1===dq(qT.state.gradientDepth,p)){var d=Mj(t,n,r,i,o,u,c);return null!=l&&(d=PL(d,l)),vq(d,p,h)}var m=vI(t,"x","depthwiseConv2d"),g=vI(n,"filter","depthwiseConv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),MM(4===v.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."})),MM(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."})),MM(v.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."})),null==u&&(u=[1,1]),MM(FR(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&MM(BM(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."}));var b,x,w=AR(v.shape,g.shape,r,u,i,c,!0);null!=l&&(b=RT(b=vI(l,"bias","fused conv2d"),m)[0],CR(w.outShape,b.shape)),null!=h&&(x=vI(h,"prelu weights","fused depthwiseConv2d"));var E={x:v,filter:g};null!=l&&(E.bias=b),null!=h&&(E.preluActivationWeights=x);var C=[g,v],S=qT.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:v,filter:g,convInfo:w,bias:b,activation:p,preluActivationWeights:x});return t([g,v,n]),n}),E,(function(e,t){MM(IR(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=t[0],r=t[1],i=t[2],a=mq(e,i,p),o={};return null!=l&&(o={bias:function(){return gq(b,a)}}),Object.assign({x:function(){return Tj(r.shape,a,n,w)},filter:function(){return Oj(r,a,n.shape,w)}},o)}),"FusedDepthwiseConv2D",{convInfo:w,activation:p},C,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),wq=Object.freeze({matMul:yq,conv2d:bq,depthwiseConv2d:xq}),Eq=Object.freeze({image:hq,linalg:oq,losses:tq,spectral:IU,fused:wq,signal:VU,square:RP,squaredDifference:zP,conv1d:Nj,conv2d:Aj,conv3d:kj,depthwiseConv2d:Mj,separableConv2d:Ij,conv2dTranspose:Fj,conv3dTranspose:Rj,op:_I,batchNormalization2d:SL,batchNormalization3d:NL,batchNormalization4d:AL,batchNormalization:kL,batchNorm:DL,batchNorm2d:_L,batchNorm3d:ML,batchNorm4d:TL,booleanMaskAsync:wj,complex:MI,real:TI,imag:OI,concat:YI,concat1d:JI,concat2d:ZI,concat3d:QI,concat4d:eF,split:tF,matMul:Bj,dot:zj,outerProduct:Pj,reverse:Lj,reverse1d:jj,reverse2d:Uj,reverse3d:qj,reverse4d:Wj,maxPool:Hj,avgPool:Gj,pool:Kj,maxPool3d:Xj,avgPool3d:Yj,slice:Jj,slice1d:Zj,slice2d:Qj,slice3d:eU,slice4d:tU,abs:PP,acos:LP,acosh:jP,asin:UP,asinh:qP,atan:WP,atanh:VP,ceil:$P,clipByValue:HP,cos:GP,cosh:KP,erf:XP,exp:YP,expm1:JP,floor:ZP,log:QP,log1p:eL,logSigmoid:tL,neg:nL,reciprocal:rL,round:iL,rsqrt:aL,sigmoid:oL,sign:sL,isNaN:uL,isInf:cL,isFinite:lL,sin:fL,sinh:pL,softplus:hL,sqrt:dL,step:mL,tan:gL,tanh:vL,all:rU,any:iU,argMax:aU,argMin:oU,logSumExp:sU,max:uU,mean:cU,min:lU,moments:fU,sum:pU,prod:hU,equal:aj,equalStrict:oj,greater:sj,greaterEqual:uj,greaterEqualStrict:cj,greaterStrict:lj,less:fj,lessEqual:pj,lessEqualStrict:hj,lessStrict:dj,notEqual:mj,notEqualStrict:gj,add:PL,addN:LL,addStrict:jL,atan2:UL,div:qL,divNoNan:WL,divStrict:VL,floorDiv:$L,maximum:HL,maximumStrict:GL,minimum:KL,minimumStrict:XL,mod:YL,modStrict:JL,mul:ZL,mulStrict:QL,pow:ej,powStrict:tj,squaredDifferenceStrict:nj,sub:rj,subStrict:ij,elu:dU,leakyRelu:mU,prelu:gU,relu:vU,relu6:yU,selu:bU,logicalAnd:OL,logicalNot:IL,logicalOr:FL,logicalXor:RL,where:BL,whereAsync:zL,buffer:dF,print:mF,batchToSpaceND:gF,broadcastTo:vF,cast:yF,clone:bF,cumsum:xF,depthToSpace:wF,expandDims:EF,eye:CF,multinomial:SF,oneHot:NF,pad:AF,pad1d:kF,pad2d:DF,pad3d:_F,pad4d:MF,rand:TF,randomNormal:OF,randomGamma:IF,randomUniform:FF,reshape:RF,spaceToBatchND:BF,squeeze:zF,stack:PF,tile:LF,truncatedNormal:jF,unstack:UF,setdiff1dAsync:qF,fill:$I,linspace:HI,ones:WI,range:GI,scalar:RI,tensor:II,tensor1d:BI,tensor2d:zI,tensor3d:PI,tensor4d:LI,tensor5d:jI,tensor6d:UI,variable:qI,zeros:VI,onesLike:KI,zerosLike:XI,transpose:xU,softmax:gR,logSoftmax:vR,localResponseNormalization:wU,norm:EU,gather:bj,unsortedSegmentSum:xj,basicLSTMCell:CU,multiRNNCell:SU,movingAverage:NU,stridedSlice:AU,topk:kU,scatterND:DU,fft:_U,ifft:MU,rfft:TU,irfft:OU,sparseToDense:FU,gatherND:RU,diag:BU,dropout:zU,hannWindow:jU,hammingWindow:UU,frame:qU,stft:WU,inTopKAsync:$U});function Cq(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&MM("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function Sq(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Nq=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new yR(t,qT),t}return cM(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,dM().get("IS_NODE")&&dI("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return lM(this,void 0,void 0,(function(){return fM(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?jR(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return pT(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return dF(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return qT.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return lM(this,void 0,void 0,(function(){var t;return fM(this,(function(n){return t=cT(),e(),[2,{kernelMs:cT()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:qT.keep(e.clone()),imag:qT.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(Cq(e,"slice"),oR(e.shape,t,n)){var r=sR(t,e.strides),i=FM(n);return II(this.readSync(e.dataId).subarray(r,r+i),n,e.dtype)}for(var a=dF(n,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map((function(e,n){return e+t[n]}));a.values[s]=o.get.apply(o,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){Cq(e,"stridedSlice");var i=rR(t,n,r);if(i.some((function(e){return 0===e})))return II([],i);for(var a=dF(i,e.dtype),o=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];a.set.apply(a,[o.get.apply(o,c)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=dF([e.size,e.size],e.dtype),r=n.values,i=0;i<t.length;i++)r[i*e.size+i]=t[i];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)o[t]=a,u[a]=this.slice(e,o,s).reshape(r);return u},t.prototype.reverse=function(e,t){Cq(e,"reverse");for(var n=dF(e.shape,e.dtype),r=this.bufferSync(e),i=function(i){var a=n.indexToLoc(i),o=a.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,o)].concat(a))},a=0;a<n.size;a++)i(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return TI(e)})),i=e.map((function(e){return OI(e)}));return MI(this.concat(r,t),this.concat(i,t))}var a=e.map((function(e){var n=FM(e.shape.slice(t));return e.as2D(-1,n)})),o=DI(a.map((function(e){return e.shape})),1),s=dF(o,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach((function(e){s.set(n.readSync(e.dataId),u),u+=e.size}))}else{var c=0;a.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,i=0;i<e.shape[0];++i)for(var a=i*o[1]+c,u=0;u<e.shape[1];++u)s[a+u]=t[r++];c+=e.shape[1]}))}var l=DI(e.map((function(e){return e.shape})),t);return II(s,l,e[0].dtype)},t.prototype.neg=function(e){return Cq(e,"neg"),this.multiply(RI(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,IT(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;Cq(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=dF(e[0].shape,e[0].dtype),i=r.values,a=0;a<e.length;a++)for(var o=n[a],s=0;s<i.length;s++)i[s]+=o[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=qM([t],e.shape),r=this.max(e,n),i=EI(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return this.realDivide(o,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,IT(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return Cq([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){Cq([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=l[0],p=l[1],h=l[2],d=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=d[0],g=d[1],v=d[2],y=a*o,b=dF([s,a,o],e.dtype),x=b.values,w=this.blockSize,E=0;E<s;E++)for(var C=0;C<a;C+=w)for(var S=0;S<o;S+=w)for(var N=0;N<i;N+=w)for(var A=Math.min(C+w,a),k=Math.min(S+w,o),D=Math.min(N+w,i),_=C;_<A;_++)for(var M=S;M<k;M++){for(var T=0,O=N;O<D;O++)T+=u[E*f+_*p+O*h]*c[O*m+M*g+E*v];x[E*y+(_*o+M)]+=T}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,i);return a&&(u=this.add(u,a)),o&&(u=Sq(this,u,o,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,IT(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.realDivide=function(e,t){return Cq([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},t.prototype.floorDiv=function(e,t){return Cq([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){Cq(e,"sum"),CI("sum",t,e.rank);for(var n=wI(e.shape,t),r=n[0],i=n[1],a=VI(r,IT(e.dtype,"int32")),o=FM(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=0,p=0;p<o;++p)f+=u[l+p];s[c]=f}return a},t.prototype.prod=function(e,t){Cq(e,"sum");for(var n=wI(e.shape,t),r=n[0],i=n[1],a=VI(r,IT(e.dtype,"int32")),o=FM(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=1,p=0;p<o;++p)f*=u[l+p];s[c]=f}return a},t.prototype.unsortedSegmentSum=function(e,t,n){Cq(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,a=0;a<i;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var o=RI(a,"int32"),s=aj(o,t).asType("float32").mul(e).sum(0);r.push(s)}return PF(r)},t.prototype.argMin=function(e,t){Cq(e,"argMin");var n=[t];CI("argMin",n,e.rank);for(var r=wI(e.shape,n),i=r[0],a=r[1],o=VI(i,"int32"),s=FM(a),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,p=c[f],h=0,d=0;d<s;++d){var m=c[f+d];m<p&&(p=m,h=d)}u[l]=h}return o},t.prototype.argMax=function(e,t){Cq(e,"argMax");var n=[t];CI("argMax",n,e.rank);for(var r=wI(e.shape,n),i=r[0],a=r[1],o=VI(i,"int32"),s=FM(a),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var f=l*s,p=c[f],h=0,d=0;d<s;++d){var m=c[f+d];m>p&&(p=m,h=d)}u[l]=h}return o},t.prototype.cumsum=function(e,t,n,r){if(Cq(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=IT(e.dtype,"int32"),a=VI(e.shape,i),o=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var f=0;f<u;f++){var p=c(l,f);if(0===f)o[p]=n?0:s[p];else{var h=c(l,f-1);o[p]=n?s[h]+o[h]:s[p]+o[h]}}return a},t.prototype.equal=function(e,t){return Cq([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return Cq([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return Cq([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return Cq([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return Cq([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return Cq([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){Cq(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return Cq([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return Cq([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){Cq([e,t,n],"select");for(var r=this.readSync(e.dataId),i=this.readSync(t.dataId),a=this.readSync(n.dataId),o=VI(t.shape,IT(t.dtype,n.dtype)),s=this.readSync(o.dataId),u=0,c=0===e.rank||e.rank>1||1===t.rank?1:FM(t.shape.slice(1)),l=0;l<r.length;l++)for(var f=0;f<c;f++)1===r[l]?s[u++]=i[l]:s[u++]=a[l];return o},t.prototype.where=function(e){Cq([e],"where");var t=this.readSync(e.dataId);return tB(e.shape,t)},t.prototype.topk=function(e,t,n){return Cq(e,"topk"),eB(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Cq(e,"min"),CI("min",t,e.rank);for(var n=wI(e.shape,t),r=n[0],i=n[1],a=VI(r,e.dtype),o=FM(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],p=0;p<o;++p){var h=u[l+p];h<f&&(f=h)}s[c]=f}return a},t.prototype.minimum=function(e,t){return Cq([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return Cq([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){Cq(e,"max"),CI("max",t,e.rank);for(var n=wI(e.shape,t),r=n[0],i=n[1],a=VI(r,e.dtype),o=FM(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],p=0;p<o;++p){var h=u[l+p];h>f&&(f=h)}s[c]=f}return a},t.prototype.maximum=function(e,t){return Cq([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){Cq(e,"all"),CI("all",t,e.rank);for(var n=wI(e.shape,t),r=n[0],i=n[1],a=VI(r,e.dtype),o=FM(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],p=0;p<o;++p){var h=u[l+p];f=f&&h}s[c]=f}return a},t.prototype.any=function(e,t){Cq(e,"any"),CI("any",t,e.rank);for(var n=wI(e.shape,t),r=n[0],i=n[1],a=VI(r,e.dtype),o=FM(i),s=this.readSync(a.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,f=u[l],p=0;p<o;++p){var h=u[l+p];f=f||h}s[c]=f}return a},t.prototype.squaredDifference=function(e,t){return Cq([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){Cq(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){Cq(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){Cq(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){Cq(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){Cq(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){Cq(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){Cq(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);t[r]-i<.5?n[r]=Math.floor(t[r]):t[r]-i>.5?n[r]=Math.ceil(t[r]):n[r]=i%2==0?i:i+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){Cq(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){Cq(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){Cq(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){Cq(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log1p(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){Cq(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){Cq(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=1/Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){Cq(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Cq(e,"relu");for(var t=VI(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},t.prototype.relu6=function(e){Cq(e,"relu");for(var t=VI(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return t},t.prototype.prelu=function(e,t){return Cq([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){Cq(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){Cq([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId),a=0;a<r.length;++a){var o=r[a];n[a]=o>=1?i[a]:i[a]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){Cq(e,"selu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(t,e.shape,"float32")},t.prototype.clip=function(e,t,n){Cq(e,"clip");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var i=n[2*r],a=n[2*r+1];t[r]=Math.hypot(i,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){Cq(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){Cq(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){Cq(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a,o=r[i]>-t,s=r[i]<t,u=Math.exp(r[i]);a=s?u:o?r[i]:Math.log(1+u),n[i]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){Cq(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){Cq(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){Cq(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){Cq(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){Cq(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){Cq(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return Cq([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){Cq(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){Cq(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){Cq(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=zM(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){Cq(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){Cq(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){Cq(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){Cq(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),a=Math.abs(n[r]),o=1/(1+.3275911*a);t[r]=i*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),Cq(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a=r[i];isNaN(a)?n[i]=NaN:n[i]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return i&&(s=this.add(s,i)),a&&(s=Sq(this,s,a,o)),s},t.prototype.conv2d=function(e,t,n){Cq([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=dF(n.outShape,e.dtype),f=e.strides[0],p=c?e.strides[1]:e.strides[2],h=c?e.strides[2]:1,d=c?1:e.strides[1],m=l.strides[0],g=c?l.strides[1]:l.strides[2],v=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),w=l.values,E=0;E<n.batchSize;++E)for(var C=E*f,S=E*m,N=0;N<n.outHeight;++N)for(var A=S+N*g,k=N*n.strideHeight-u,D=0;D<r;D++){var _=k+D*a;if(!(_<0||_>=n.inHeight))for(var M=D*t.strides[0],T=C+_*p,O=0;O<n.outWidth;++O)for(var I=A+O*v,F=O*n.strideWidth-s,R=0;R<i;R++){var B=F+R*o;if(!(B<0||B>=n.inWidth))for(var z=T+B*h,P=M+R*t.strides[1],L=0;L<n.inChannels;++L){for(var j=b[z+L*d],U=0;U<n.outChannels;++U)w[I+U*y]+=j*x[P+U];P+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,i=n.filterHeight,a=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,f=n.padInfo.top,p=dF(n.outShape,e.dtype),h=this.readSync(e.dataId),d=this.readSync(t.dataId),m=p.values,g=0;g<n.batchSize;++g)for(var v=g*e.strides[0],y=g*p.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*p.strides[1],w=b*n.strideDepth-c,E=0;E<r;E++){var C=w+E*o;if(!(C<0||C>=n.inDepth))for(var S=E*t.strides[0],N=v+C*e.strides[1],A=0;A<n.outHeight;++A)for(var k=x+A*p.strides[2],D=A*n.strideHeight-f,_=0;_<i;_++){var M=D+_*s;if(!(M<0||M>=n.inHeight))for(var T=S+_*t.strides[1],O=N+M*e.strides[2],I=0;I<n.outWidth;++I)for(var F=k+I*n.outChannels,R=I*n.strideWidth-l,B=0;B<a;B++){var z=R+B*u;if(!(z<0||z>=n.inWidth))for(var P=T+B*t.strides[2],L=O+z*n.inChannels,j=P,U=0;U<n.inChannels;++U){for(var q=h[L+U],W=0;W<n.outChannels;++W)m[F+W]+=q*d[j+W];j+=n.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){Cq([e,t],"conv2dDerInput");for(var r=dF(n.inShape,"float32"),i=r.values,a=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,u=s[0],c=s[1],l=s[2],f=n.batchSize,p=n.filterHeight,h=n.filterWidth,d=n.inChannels,m=n.inHeight,g=n.inWidth,v=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,E=n.dataFormat,C=p-1-n.padInfo.top,S=h-1-n.padInfo.left,N="channelsLast"===E,A=r.strides[0],k=N?r.strides[1]:r.strides[2],D=N?r.strides[2]:1,_=N?1:r.strides[1],M=e.strides[0],T=N?e.strides[1]:e.strides[2],O=N?e.strides[2]:1,I=N?1:e.strides[1],F=0;F<f;++F)for(var R=0;R<d;++R)for(var B=0;B<m;++B)for(var z=B-C,P=Math.max(0,Math.ceil(z/x)),L=Math.min(y,(p+z)/x),j=0;j<g;++j){for(var U=j-S,q=Math.max(0,Math.ceil(U/w)),W=Math.min(b,(h+U)/w),V=0,$=P;$<L;++$)for(var H=$*x-z,G=q;G<W;++G)for(var K=M*F+T*$+O*G,X=u*(p-1-H)+c*(h-1-(G*w-U))+l*R,Y=0;Y<v;++Y)V+=a[K+I*Y]*o[X+Y];i[A*F+k*B+D*j+_*R]=V}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=dF(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],c=a[3],l=this.readSync(e.dataId),f=e.strides,p=f[0],h=f[1],d=f[2],m=f[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],x=v[2],w=v[3],E=n.batchSize,C=n.filterDepth,S=n.filterHeight,N=n.filterWidth,A=n.inChannels,k=n.inDepth,D=n.inHeight,_=n.inWidth,M=n.outChannels,T=n.outDepth,O=n.outHeight,I=n.outWidth,F=n.strideDepth,R=n.strideHeight,B=n.strideWidth,z=C-1-n.padInfo.front,P=S-1-n.padInfo.top,L=N-1-n.padInfo.left,j=0;j<E;++j)for(var U=0;U<A;++U)for(var q=0;q<k;++q)for(var W=q-z,V=Math.max(0,Math.ceil(W/F)),$=Math.min(T,(C+W)/F),H=0;H<D;++H)for(var G=H-P,K=Math.max(0,Math.ceil(G/R)),X=Math.min(O,(S+G)/R),Y=0;Y<_;++Y){for(var J=Y-L,Z=Math.max(0,Math.ceil(J/B)),Q=Math.min(I,(N+J)/B),ee=0,te=V;te<$;++te)for(var ne=te*F-W,re=K;re<X;++re)for(var ie=re*R-G,ae=Z;ae<Q;++ae)for(var oe=p*j+h*te+d*re+m*ae,se=y*(C-1-ne)+b*(S-1-ie)+x*(N-1-(ae*B-J))+w*U,ue=0;ue<M;++ue)ee+=l[oe+ue]*g[se+ue];i[o*j+s*q+u*H+c*Y+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){Cq([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,u=dF(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,f=this.bufferSync(e),p=this.bufferSync(t),h=0;h<a;++h)for(var d=Math.max(0,Math.ceil((l-h)/r)),m=Math.min(n.outHeight,(n.inHeight+l-h)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((c-g)/i)),y=Math.min(n.outWidth,(n.inWidth+c-g)/i),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,E=0;E<n.batchSize;++E)for(var C=d;C<m;++C)for(var S=h+C*r-l,N=v;N<y;++N){var A=g+N*i-c;w+=s?f.get(E,S,A,b)*p.get(E,C,N,x):f.get(E,b,S,A)*p.get(E,x,C,N)}u.set(w,h,g,b,x)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=dF(n.filterShape,"float32"),l=c.values,f=c.strides,p=f[0],h=f[1],d=f[2],m=f[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],x=v[2],w=v[3],E=this.readSync(e.dataId),C=e.strides,S=C[0],N=C[1],A=C[2],k=C[3],D=n.padInfo.front,_=n.padInfo.left,M=n.padInfo.top,T=0;T<o;++T)for(var O=Math.max(0,Math.ceil((D-T)/r)),I=Math.min(n.outDepth,(n.inDepth+D-T)/r),F=T*p,R=0;R<s;++R)for(var B=Math.max(0,Math.ceil((M-R)/i)),z=Math.min(n.outHeight,(n.inHeight+M-R)/i),P=R*h+F,L=0;L<u;++L)for(var j=Math.max(0,Math.ceil((_-L)/a)),U=Math.min(n.outWidth,(n.inWidth+_-L)/a),q=L*d+P,W=0;W<n.inChannels;++W)for(var V=W*m+q,$=0;$<n.outChannels;++$){for(var H=0,G=0;G<n.batchSize;++G)for(var K=G*S,X=G*y,Y=O;Y<I;++Y)for(var J=(T+Y*r-D)*N+K,Z=Y*b+X,Q=B;Q<z;++Q)for(var ee=(R+Q*i-M)*A+J,te=Q*x+Z,ne=j;ne<U;++ne){var re=ne*w+te;H+=E[(L+ne*a-_)*k+ee+W]*g[re+$]}l[V+$]=H}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return i&&(s=this.add(s,i)),a&&(s=Sq(this,s,a,o)),s},t.prototype.depthwiseConv2D=function(e,t,n){Cq([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=dF(n.outShape,e.dtype),f=this.readSync(e.dataId),p=this.readSync(t.dataId),h=l.values,d=0;d<n.batchSize;++d)for(var m=d*e.strides[0],g=d*l.strides[0],v=0;v<n.outHeight;++v)for(var y=g+v*l.strides[1],b=v*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var E=x*t.strides[0],C=m+w*e.strides[1],S=0;S<n.outWidth;++S)for(var N=y+S*l.strides[2],A=S*n.strideWidth-u,k=0;k<i;++k){var D=A+k*o;if(!(D<0||D>=n.inWidth))for(var _=E+k*t.strides[1],M=C+D*n.inChannels,T=N,O=_,I=0;I<n.inChannels;++I){for(var F=f[M+I],R=0;R<c;++R)h[T+R]+=F*p[O+R];T+=c,O+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){Cq([e,t],"depthwiseConv2DDerInput");for(var r=dF(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],u=a[2],c=this.readSync(e.dataId),l=e.strides,f=l[0],p=l[1],h=l[2],d=this.readSync(t.dataId),m=t.strides,g=m[0],v=m[1],y=m[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,E=n.inChannels,C=n.inHeight,S=n.inWidth,N=n.outChannels,A=n.outHeight,k=n.outWidth,D=n.strideHeight,_=n.strideWidth,M=x-1-n.padInfo.top,T=w-1-n.padInfo.left,O=N/E,I=0;I<b;++I)for(var F=0;F<E;++F)for(var R=0;R<C;++R)for(var B=R-M,z=Math.max(0,Math.ceil(B/D)),P=Math.min(A,(x+B)/D),L=0;L<S;++L){for(var j=L-T,U=Math.max(0,Math.ceil(j/_)),q=Math.min(k,(w+j)/_),W=0,V=z;V<P;++V)for(var $=V*D-B,H=U;H<q;++H)for(var G=f*I+p*V+h*H,K=g*(x-1-$)+v*(w-1-(H*_-j))+y*F,X=0;X<O;++X)W+=c[G+(F*O+X)]*d[K+X];i[o*I+s*R+u*L+F]=W}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){Cq([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=dF(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,f=this.bufferSync(e),p=this.bufferSync(t),h=0;h<a;++h)for(var d=Math.max(0,Math.ceil((c-h)/r)),m=Math.min(n.outHeight,(n.inHeight+c-h)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((u-g)/i)),y=Math.min(n.outWidth,(n.inWidth+u-g)/i),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/l),w=b%l,E=0,C=0;C<n.batchSize;++C)for(var S=d;S<m;++S)for(var N=h+S*r-c,A=v;A<y;++A){var k=g+A*i-u;E+=f.get(C,N,k,x)*p.get(C,S,A,b)}s.set(E,h,g,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return Cq(e,"tile"),QR(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){Cq(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),a=this.bufferSync(e),o=dF(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),c=u.map((function(e,t){return e+i[t]}));o.set.apply(o,[a.get.apply(a,u)].concat(c))}return o.toTensor()},t.prototype.transpose=function(e,t){Cq(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var i=this.readSync(e.dataId),a=dF(n,e.dtype),o=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=o.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[t[c]];var l=a.locToIndex(u);a.values[l]=i[r]}return a.toTensor()},t.prototype.gather=function(e,t,n){Cq([e,t],"gather");var r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;for(var a=dF(r,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),c=u.slice();c[n]=i[u[n]];var l=o.locToIndex(c);a.values[s]=o.values[l]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){Cq([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=WF(e.shape,t,r),a=VF(i.length,t.length),o=$F(e.shape,t,r),s=HF(n,t.length),u=GF(o,n,t.length);return e.reshape(i).transpose(a).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Cq([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=WF(o.shape,t,r,!1),u=VF(s.length,t.length,!1),c=$F(o.shape,t,r,!1);return o.reshape(s).transpose(u).reshape(c)},t.prototype.pool=function(e,t,n){Cq(e,"pool");for(var r=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),h=dF(t.outShape,e.dtype),d=h.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],g=t.outShape[2]*t.outShape[3],v=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*m,x=y*e.strides[0],w=0;w<t.inChannels;++w)for(var E=0;E<t.outHeight;++E)for(var C=E*r-c,S=Math.max(0,C),N=Math.min(t.inHeight,s+C),A=b+E*g,k=0;k<t.outWidth;++k){for(var D=k*i-l,_=Math.max(0,D),M=Math.min(t.inWidth,u+D),T=f,O=0,I=0,F=S;F<N;F+=a){for(var R=x+F*e.strides[1],B=_;B<M;B+=o){var z=p[R+B*e.strides[2]+w];"max"===n&&z>T?T=z:"avg"===n&&(O+=z,I++)}if(isNaN(T))break}d[A+k*v+w]="avg"===n?O/I:T}return h.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=dF(t.outShape,"int32"),r=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,f=this.bufferSync(e),p=0;p<t.batchSize;++p)for(var h=0;h<t.inChannels;++h)for(var d=0;d<t.outHeight;++d){for(var m=d*r-c,g=m;g<0;)g+=a;for(var v=Math.min(t.inHeight,s+m),y=0;y<t.outWidth;++y){for(var b=y*i-l,x=b;x<0;)x+=o;for(var w=Math.min(t.inWidth,u+b),E=Number.NEGATIVE_INFINITY,C=-1,S=g;S<v;S+=a)for(var N=S-m,A=x;A<w;A+=o){var k=A-b,D=f.get(p,S,A,h);D>E&&(E=D,C=N*u+k)}n.set(C,p,d,y,h)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){Cq([t,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(t,r),a=r.strideHeight,o=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=l-1-r.padInfo.left,p=c-1-r.padInfo.top,h=dF(t.shape,"float32"),d=this.bufferSync(i),m=this.bufferSync(e),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-p,w=b-f,E=0,C=0;C<c;C+=s){var S=(x+C)/a;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var N=0;N<l;N+=u){var A=(w+N)/o;if(!(A<0||A>=r.outWidth||Math.floor(A)!==A)){var k=c*l-1-d.get(g,S,A,v)===C*l+N?1:0;0!==k&&(E+=m.get(g,S,A,v)*k)}}}h.set(E,g,y,b,v)}return h.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){Cq([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,f=l-1-n.padInfo.left,p=c-1-n.padInfo.top,h=dF(t.shape,"float32"),d=1/(a*o),m=this.bufferSync(e),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-p,w=b-f,E=0,C=0;C<c;C+=s){var S=(x+C)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var N=0;N<l;N+=u){var A=(w+N)/i;A<0||A>=n.outWidth||Math.floor(A)!==A||(E+=m.get(g,S,A,v))}}h.set(E*d,g,y,b,v)}return h.toTensor()},t.prototype.pool3d=function(e,t,n){Cq(e,"pool3d");for(var r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=t.padInfo.front,h=t.padInfo.top,d=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(e.dataId),v=dF(t.outShape,e.dtype),y=v.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],E=t.outShape[4],C=0;C<t.batchSize;++C)for(var S=C*b,N=C*e.strides[0],A=0;A<t.inChannels;++A)for(var k=0;k<t.outDepth;++k){for(var D=k*r-p,_=D;_<0;)_+=o;for(var M=Math.min(t.inDepth,c+D),T=S+k*x,O=0;O<t.outHeight;++O){for(var I=O*i-h,F=I;F<0;)F+=s;for(var R=Math.min(t.inHeight,l+I),B=T+O*w,z=0;z<t.outWidth;++z){for(var P=z*a-d,L=P;L<0;)L+=u;for(var j=Math.min(t.inWidth,f+P),U=B+z*E,q=m,W=0,V=0,$=_;$<M;$+=o){for(var H=N+$*e.strides[1],G=F;G<R;G+=s){for(var K=H+G*e.strides[2],X=L;X<j;X+=u){var Y=g[K+X*e.strides[3]+A];if("max"===n&&Y>q?q=Y:"avg"===n&&(W+=Y,V++),isNaN(q))break}if(isNaN(q))break}if(isNaN(q))break}y[U+A]="avg"===n?W/V:q}}}return v.toTensor()},t.prototype.avgPool3d=function(e,t){return Cq(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){Cq([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterDepth,h=n.effectiveFilterHeight,d=n.effectiveFilterWidth,m=p-1-n.padInfo.front,g=d-1-n.padInfo.left,v=h-1-n.padInfo.top,y=dF(t.shape,"float32"),b=1/(o*s*u),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var E=0;E<n.inChannels;++E)for(var C=0;C<n.inDepth;++C)for(var S=0;S<n.inHeight;++S)for(var N=0;N<n.inWidth;++N){for(var A=C-m,k=S-v,D=N-g,_=0,M=0;M<p;M+=c){var T=(A+M)/r;if(!(T<0||T>=n.outDepth||Math.floor(T)!==T))for(var O=0;O<h;O+=l){var I=(k+O)/i;if(!(I<0||I>=n.outHeight||Math.floor(I)!==I))for(var F=0;F<d;F+=f){var R=(D+F)/a;R<0||R>=n.outWidth||Math.floor(R)!==R||(_+=x.get(w,T,I,R,E))}}}y.set(_*b,w,C,S,N,E)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return Cq(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=dF(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=t.padInfo.front,h=t.padInfo.top,d=t.padInfo.left,m=this.bufferSync(e),g=0;g<t.batchSize;++g)for(var v=0;v<t.inChannels;++v)for(var y=0;y<t.outDepth;++y){for(var b=y*r-p,x=b;x<0;)x+=o;for(var w=Math.min(t.inDepth,c+b),E=0;E<t.outHeight;++E){for(var C=E*i-h,S=C;S<0;)S+=s;for(var N=Math.min(t.inHeight,l+C),A=0;A<t.outWidth;++A){for(var k=A*a-d,D=k;D<0;)D+=u;for(var _=Math.min(t.inWidth,f+k),M=Number.NEGATIVE_INFINITY,T=-1,O=x;O<w;O+=o)for(var I=O-b,F=S;F<N;F+=s)for(var R=F-C,B=D;B<_;B+=u){var z=B-k,P=m.get(g,O,F,B,v);P>=M&&(M=P,T=I*l*f+R*l+z)}n.set(T,g,y,E,A,v)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){Cq([t,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,r),a=r.strideDepth,o=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,p=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=f-1-r.padInfo.front,m=h-1-r.padInfo.left,g=p-1-r.padInfo.top,v=dF(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var E=0;E<r.inDepth;++E)for(var C=0;C<r.inHeight;++C)for(var S=0;S<r.inWidth;++S){for(var N=E-d,A=C-g,k=S-m,D=0,_=0;_<f;_+=u){var M=(N+_)/a;if(!(M<0||M>=r.outDepth||Math.floor(M)!==M))for(var T=0;T<p;T+=c){var O=(A+T)/o;if(!(O<0||O>=r.outHeight||Math.floor(O)!==O))for(var I=0;I<h;I+=l){var F=(k+I)/s;if(!(F<0||F>=r.outWidth||Math.floor(F)!==F)){var R=f*p*h-1-y.get(x,M,O,F,w)===_*p*h+T*h+I?1:0;0!==R&&(D+=b.get(x,M,O,F,w)*R)}}}}v.set(D,x,E,C,S,w)}return v.toTensor()},t.prototype.cast=function(e,t){return BR(e,t,this)},t.prototype.reshape=function(e,t){return zR(e,t)},t.prototype.avgPool=function(e,t){return Cq(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){Cq(e,"resizeBilinear");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(FM([a,t,n,u])),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,d=f[0]/p[0],m=f[1]/p[1],g=0;g<a;g++)for(var v=0;v<t;v++)for(var y=d*v,b=Math.floor(y),x=y-b,w=Math.min(o-1,Math.ceil(y)),E=g*e.strides[0]+b*e.strides[1],C=g*e.strides[0]+w*e.strides[1],S=0;S<n;S++)for(var N=m*S,A=Math.floor(N),k=N-A,D=Math.min(s-1,Math.ceil(N)),_=E+A*e.strides[2],M=C+A*e.strides[2],T=E+D*e.strides[2],O=C+D*e.strides[2],I=0;I<u;I++){var F=c[_+I],R=c[M+I],B=F+(c[T+I]-F)*k,z=B+(R+(c[O+I]-R)*k-B)*x;l[h++]=z}return II(l,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){Cq([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(i*a*o*s),p=[n&&c>1?a-1:a,n&&l>1?o-1:o],h=[n&&c>1?c-1:c,n&&l>1?l-1:l],d=p[0]/h[0],m=p[1]/h[1],g=this.readSync(e.dataId),v=0,y=0;y<i;y++)for(var b=y*t.strides[0],x=0;x<c;x++)for(var w=x*d,E=Math.floor(w),C=Math.min(Math.ceil(w),a-1),S=b+E*t.strides[1],N=b+C*t.strides[1],A=w-E,k=1-A,D=0;D<l;D++)for(var _=D*m,M=Math.floor(_),T=Math.min(Math.ceil(_),o-1),O=_-M,I=1-O,F=S+M*t.strides[2],R=S+T*t.strides[2],B=N+M*t.strides[2],z=N+T*t.strides[2],P=k*I,L=k*O,j=A*I,U=A*O,q=0;q<s;q++){var W=g[v++];f[F+q]+=W*P,f[R+q]+=W*L,f[B+q]+=W*j,f[z+q]+=W*U}return LI(f,[i,o,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){Cq(e,"resizeNearestNeighbor");for(var i=e.shape,a=i[0],o=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(a*t*n*u),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],p=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=f[0]/p[0],d=f[1]/p[1],m=0,g=0;g<a;g++)for(var v=g*e.strides[0],y=0;y<t;y++)for(var b=h*y,x=v+Math.min(o-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var E=d*w,C=x+Math.min(s-1,r?Math.round(E):Math.floor(E))*e.strides[2],S=0;S<u;S++){var N=c[C+S];l[m++]=N}return II(l,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){Cq([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],f=new Float32Array(i*a*o*s),p=this.readSync(e.dataId),h=[n&&c>1?a-1:a,n&&l>1?o-1:o],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=h[0]/d[0],g=h[1]/d[1],v=1/m,y=1/g,b=2*Math.ceil(v)+2,x=2*Math.ceil(y)+2,w=0;w<i;w++)for(var E=w*t.strides[0],C=0;C<a;C++)for(var S=E+C*t.strides[1],N=Math.floor(C*v),A=Math.floor(N-b/2),k=0;k<o;k++)for(var D=S+k*t.strides[2],_=Math.floor(k*y),M=Math.floor(_-x/2),T=0;T<s;T++){for(var O=0,I=0;I<b;I++){var F=I+A;if(!(F<0||F>=c)){var R=E+F*e.strides[1],B=F*m;if(C===Math.min(a-1,n?Math.round(B):Math.floor(B)))for(var z=0;z<x;z++){var P=z+M;if(!(P<0||P>=l)){var L=R+P*e.strides[2],j=P*g;k===Math.min(o-1,n?Math.round(j):Math.floor(j))&&(O+=p[L+T])}}}}f[D+T]=O}return LI(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){Cq([e,t,n,i,a],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=i?this.readSync(i.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(o.length),p=l.length,h=c.length,d=u.length,m=s.length,g=0,v=0,y=0,b=0,x=0;x<o.length;++x)f[x]=l[g++]+(o[x]-s[v++])*c[y++]/Math.sqrt(u[b++]+r),g>=p&&(g=0),v>=m&&(v=0),y>=h&&(y=0),b>=d&&(b=0);return LI(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){Cq(e,"localResponseNormalization4D");var a=e.shape[3],o=a-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%a,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,o),u=0;r<=i;r++){var c=s[r];u+=c*c}return u}for(var f=0;f<u;f++){var p=l(f),h=s[f]*Math.pow(n+r*p,-i);c[f]=h}return LI(c,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){Cq(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),f=new Float32Array(e.size),p=e.size,h=0;h<p;h++){for(var d=h%s,m=h-d+Math.max(0,d-r),g=h-d+Math.min(s,d+r+1),v=0,y=m;y<g;y++)v+=Math.pow(c[y],2);for(v=a*v+i,y=m;y<g;y++){var b=-2*a*o*c[y]*l[h]/v;h===y&&(b+=Math.pow(v,-o)),b*=u[h],f[y]+=b}}return LI(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){Cq(e,"multinomial");for(var i=t?e:gR(e),a=i.shape[0],o=i.shape[1],s=VI([a,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(i.dataId),l=0;l<a;++l){var f=l*o,p=new Float32Array(o-1);p[0]=c[f];for(var h=1;h<p.length;++h)p[h]=p[h-1]+c[f+h];for(var d=lF(r.toString()),m=l*n,g=0;g<n;++g){var v=d();u[m+g]=p.length;for(var y=0;y<p.length;y++)if(v<p[y]){u[m+g]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){Cq(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var a=this.readSync(e.dataId),o=0;o<e.size;++o)a[o]>=0&&a[o]<t&&(i[o*t+a[o]]=n);return zI(i,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return Cq(e,"nonMaxSuppression"),HR(this.readSync(e.dataId),this.readSync(t.dataId),n,r,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=dF(e.shape,"float32"),a=dF(e.shape,"float32"),o=TI(e).as2D(n,r),s=OI(e).as2D(n,r),u=0;u<n;u++)for(var c=o.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),f=MI(c,l),p=this.readSync(this.fftImpl(f,t).dataId),h=0;h<r;h++){var d=UR(p,h);i.values[u*r+h]=d.real,a.values[u*r+h]=d.imag}return MI(i.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(i=MI(TI(i).div(RI(r)),OI(i).div(RI(r)))),i}var a=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return MI(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),i=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),o=MI(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),u=MI(s.real,s.imag).as1D();o=this.fftRadix2(o,i,n),u=this.fftRadix2(u,i,n);var c=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),i=0;i<Math.ceil(e/2);i++){var a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}(t,n),l=MI(c.real,c.imag).mul(u),f=o.add(l),p=o.sub(l),h=TI(f).concat(TI(p)),d=OI(f).concat(OI(p));return MI(h,d).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var a=0,o=0,s=0;s<t;s++){var u=WR(i*s,t,n),c=UR(e,s);a+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(a/=t,o/=t),qR(r,a,o,i)}return r},t.prototype.depthToSpace=function(e,t,n){MM("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),MM(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],i=e.shape[1],a=e.shape[2],o=e.shape[3],s=i*t,u=a*t,c=o/(t*t),l=this.readSync(e.dataId),f=new Float32Array(r*s*u*c),p=0,h=0;h<r;++h)for(var d=0;d<s;++d)for(var m=Math.floor(d/t),g=d%t,v=0;v<u;++v)for(var y=Math.floor(v/t),b=(g*t+v%t)*c,x=0;x<c;++x){var w=x+b+o*(y+a*(m+i*h));f[p++]=l[w]}return LI(f,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=CR(e.shape,t.shape),a=dF(i,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=wR(e.shape,i),c=wR(t.shape,i),l=a.values;if(u.length+c.length===0)for(var f=0;f<l.length;++f)l[f]=r(o[f%o.length],s[f%s.length]);else{var p=this.bufferSync(e),h=this.bufferSync(t),d=function(n){var i=a.indexToLoc(n),f=i.slice(-e.rank);u.forEach((function(e){return f[e]=0}));var d=p.locToIndex(f),m=i.slice(-t.rank);c.forEach((function(e){return m[e]=0}));var g=h.locToIndex(m);l[n]=r(o[d],s[g])};for(f=0;f<l.length;++f)d(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=CR(e.shape,t.shape),i=dF(r,"float32"),a=dF(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=wR(e.shape,r),c=wR(t.shape,r),l=i.values,f=a.values;if(u.length+c.length===0)for(var p=0;p<l.length;p++){var h=p%o.length,d=p%s.length,m=n(o[2*h],o[2*h+1],s[2*d],s[2*d+1]);l[p]=m.real,f[p]=m.imag}else{var g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=i.indexToLoc(r),p=a.slice(-e.rank);u.forEach((function(e){return p[e]=0}));var h=g.locToIndex(p),d=a.slice(-t.rank);c.forEach((function(e){return d[e]=0}));var m=v.locToIndex(d),y=n(o[2*h],o[2*h+1],s[2*m],s[2*m+1]);l[r]=y.real,f[r]=y.imag};for(p=0;p<l.length;p++)y(p)}return this.complex(i.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return ZR(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,i,a){for(var o=e.shape,s=o[0],u=o[1],c=o[2],l=o[3],f=t.shape[0],p=r[0],h=r[1],d=dF([f,p,h,l],"float32"),m=this.readSync(t.dataId),g=this.readSync(n.dataId),v=this.readSync(e.dataId),y=e.strides,b=d.strides,x=0;x<f;x++){var w=4*x,E=m[w],C=m[w+1],S=m[w+2],N=m[w+3],A=g[x];if(!(A>=s))for(var k=p>1?(S-E)*(u-1)/(p-1):0,D=h>1?(N-C)*(c-1)/(h-1):0,_=0;_<p;_++){var M=p>1?E*(u-1)+_*k:.5*(E+S)*(u-1);if(M<0||M>u-1)for(var T=0;T<h;T++)for(var O=0;O<l;O++){var I=O+T*b[2]+_*b[1]+x*b[0];d.values[I]=a}else if("bilinear"===i){var F=Math.floor(M),R=Math.ceil(M),B=M-F;for(T=0;T<h;T++)if(($=h>1?C*(c-1)+T*D:.5*(C+N)*(c-1))<0||$>c-1)for(O=0;O<l;O++)I=O+T*b[2]+_*b[1]+x*b[0],d.values[I]=a;else{var z=Math.floor($),P=Math.ceil($),L=$-z;for(O=0;O<l;O++){var j=v[I=O+z*y[2]+F*y[1]+A*y[0]],U=v[I=O+P*y[2]+F*y[1]+A*y[0]],q=v[I=O+z*y[2]+R*y[1]+A*y[0]],W=j+(U-j)*L,V=q+(v[I=O+P*y[2]+R*y[1]+A*y[0]]-q)*L;I=O+T*b[2]+_*b[1]+x*b[0],d.values[I]=W+(V-W)*B}}}else for(T=0;T<h;++T){var $;if(($=h>1?C*(c-1)+T*D:.5*(C+N)*(c-1))<0||$>c-1)for(O=0;O<l;O++)I=O+T*b[2]+_*b[1]+x*b[0],d.values[I]=a;else{var H=Math.round($),G=Math.round(M);for(O=0;O<l;O++){var K=O+H*y[2]+G*y[1]+A*y[0],X=O+T*b[2]+_*b[1]+x*b[0];d.values[X]=v[K]}}}}}return d.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var i=QF(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.sliceSize,u=i.strides,c=i.outputSize;return this.scatter(e,t,n,c,s,o,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=KF(e,t),a=i[0],o=i[1],s=i[2],u=i[3];if(0===o)return II([],a,e.dtype);for(var c=new wT([o,s],e.dtype),l=this.readSync(t.dataId),f=this.readSync(e.dataId),p=0;p<o;p++){for(var h=[],d=0,m=0;m<r;m++){var g=l[p*r+m];d+=g*u[m],h.push(g)}if(d<0||d>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var v=0;v<s;v++)c.values[p*s+v]=f[d*s+v]}return c.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=QF(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=RI(0);return this.scatter(e,t,n,u,o,a,i,s,c,!0)},t.prototype.fill=function(e,t,n){var r=$M(n=n||tT(t),FM(e));return r.fill(t),qT.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=$M(e.dtype,FM(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return PR(e,t,n)},t.prototype.scatter=function(e,t,n,r,i,a,o,s,u,c){var l=[r/i,i],f=this.readSync(e.dataId),p=this.readSync(t.dataId);if(0===r)return II([],n,t.dtype);var h=new wT(l,t.dtype);h.values.fill(this.readSync(u.dataId)[0]);for(var d=0;d<a;d++){for(var m=[],g=0,v=0;v<o;v++){var y=f[d*o+v];m.push(y),g+=y*s[v]}if(g<0||g>=r/i)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<i;b++)c?h.values[g*i+b]+=p[d*i+b]:h.values[g*i+b]=0===t.rank?p[0]:p[d*i+b]}return h.toTensor().reshape(n)},t}(bR);qT.registerBackend("cpu",(function(){return new Nq}),1);for(var Aq=0,kq=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t,a=i.boxes,o=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,p=n;Cq(a,"NonMaxSuppressionWithScore");var h=GR(p.data.get(a.dataId).values,p.data.get(o.dataId).values,u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n;Cq(r,"square");for(var a=i.data.get(r.dataId).values,o=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];o[s]=u*u}return{dataId:i.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:BP,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,i=r.a,a=r.b,o=n;Cq([i,a],BP);var s=o.data.get(i.dataId).values,u=o.data.get(a.dataId).values,c=function(e,t,n,r,i,a){var o=CR(e,t),s=o.length,u=iT(o),c=VM(i,FM(o)),l=e.length,f=t.length,p=iT(e),h=iT(t),d=wR(e,o),m=wR(t,o);if(d.length+m.length===0)for(var g=0;g<c.length;++g)c[g]=a(n[g%n.length],r[g%r.length]);else{var v=function(e){var t=dT(e,s,u),i=t.slice(-l);d.forEach((function(e){return i[e]=0}));var o=hT(i,l,p),g=t.slice(-f);m.forEach((function(e){return g[e]=0}));var v=hT(g,f,h);c[e]=a(n[o],r[v])};for(g=0;g<c.length;++g)v(g)}return[c,o]}(i.shape,a.shape,s,u,i.dtype,(function(e,t){var n=e-t;return n*n})),l=c[0],f=c[1];return{dataId:o.write(l,f,i.dtype),shape:f,dtype:i.dtype}}}];Aq<kq.length;Aq++)wM(kq[Aq]);for(var Dq,_q=function(e){this.variableNames=["A"];var t=sB(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Mq=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=sB(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},Tq=0,Oq=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.pixels,a=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,u=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=u[0],l=u[1],f=[l,c],p=[l,c,a];(s||o)&&(null==Dq&&(Dq=document.createElement("canvas").getContext("2d")),Dq.canvas.width=c,Dq.canvas.height=l,Dq.drawImage(i,0,0,c,l),i=Dq.canvas);var h=n.makeTensorInfo(f,"int32");n.texData.get(h.dataId).usage=HT.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);var d=dM().getBool("WEBGL_PACK")?new Mq(p):new _q(p),m=n.runWebGLProgram(d,[h],"int32");return n.disposeData(h.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;dI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=t,a=i.boxes,o=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,p=n,h=GR(p.readSync(a.dataId),p.readSync(o.dataId),u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n,a=new mP(r.shape,"return x * x;");return i.runWebGLProgram(a,[r],r.dtype)}},{kernelName:BP,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,i=r.a,a=r.b,o=n,s=dM().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB("return (a - b) * (a - b);",i.shape,a.shape):new IB("return (a - b) * (a - b);",i.shape,a.shape);return o.compileAndRun(s,[i,a])}}];Tq<Oq.length;Tq++)wM(Oq[Tq]);for(var Iq=0,Fq=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:BP,gradFunc:function(e,t){var n=t[0],r=t[1],i=RI(2);return{a:function(){return ZL(e,ZL(i,rj(n,r)))},b:function(){return ZL(e,ZL(i,rj(r,n)))}}}}];Iq<Fq.length;Iq++)EM(Fq[Iq]);var Rq=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();dM().get("IS_BROWSER")&&dM().setPlatform("browser",new Rq);var Bq,zq=function(){function e(){this.util=n(5118),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=dM().global.fetch?dM().global.fetch(e,t):(null==Bq&&(Bq=n(3655)),Bq(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();dM().get("IS_NODE")&&dM().setPlatform("node",new zq);var Pq={float32:4,int32:4,uint16:2,uint8:1,bool:1};function Lq(e,t){for(var n={},r=0,i=function(t){var i=t.name,a=t.dtype,o=t.shape,s=FM(o),u=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=Pq[c.dtype],f=e.slice(r,r+s*l),p="uint8"===c.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(p,(function(e){return e*c.scale+c.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=Int32Array.from(p,(function(e){return Math.round(e*c.scale+c.min)}))}r+=s*l}else if("string"===a){var h=FM(t.shape);u=[];for(var d=0;d<h;d++){var m=new Uint32Array(e.slice(r,r+4))[0];r+=4;var g=new Uint8Array(e.slice(r,r+m));u.push(g),r+=m}}else{var v=Pq[a];if(f=e.slice(r,r+s*v),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);u=new Uint8Array(f)}r+=s*v}n[i]=II(u,o,a)},a=0,o=t;a<o.length;a++)i(o[a]);return n}function jq(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}var Uq="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function qq(e){return Uq?Buffer.byteLength(e):new Blob([e]).size}function Wq(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Vq(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function $q(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:qq(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:qq(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var Hq=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var i=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&i.push(n)})),i},e}(),Gq="://",Kq=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){MM(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Gq)&&(t=t.slice(0,t.indexOf(Gq))),MM(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();MM(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function Xq(e){if(-1===e.indexOf(Gq))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Kq.getSchemes().join(","));return{scheme:e.split(Gq)[0],path:e.split(Gq)[1]}}function Yq(e,t,n){return void 0===n&&(n=!1),lM(this,void 0,void 0,(function(){var r,i,a,o,s,u,c,l,f;return fM(this,(function(p){switch(p.label){case 0:return MM(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),MM((r=Hq.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),MM(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),i=r[0],MM((a=Hq.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),MM(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),o=a[0],s=Xq(e).scheme,u=Xq(e).path,c=s===Xq(e).scheme,[4,i.load()];case 1:return l=p.sent(),n&&c?[4,Kq.getManager(s).removeModel(u)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[4,o.save(l)];case 4:return f=p.sent(),!n||c?[3,6]:[4,Kq.getManager(s).removeModel(u)];case 5:p.sent(),p.label=6;case 6:return[2,f.modelArtifactsInfo]}}))}))}var Jq="models_store",Zq="model_info_store";function Qq(){if(!dM().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function eW(e){var t=e.result;t.createObjectStore(Jq,{keyPath:"modelPath"}),t.createObjectStore(Zq,{keyPath:"modelPath"})}var tW=function(){function e(e){if(this.indexedDB=Qq(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return lM(this,void 0,void 0,(function(){return fM(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return eW(i)},i.onsuccess=function(){var a=i.result;if(null==t){var o=a.transaction(Jq,"readonly"),s=o.objectStore(Jq).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},o.oncomplete=function(){return a.close()}}else{var u,c=$q(t),l=a.transaction(Zq,"readwrite"),f=l.objectStore(Zq),p=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});p.onsuccess=function(){var i=(u=a.transaction(Jq,"readwrite")).objectStore(Jq).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});i.onsuccess=function(){return e({modelArtifactsInfo:c})},i.onerror=function(e){var t=(f=l.objectStore(Zq)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(i.error)},t.onerror=function(e){return a.close(),r(i.error)}}},p.onerror=function(e){return a.close(),r(p.error)},l.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}(),nW=function(e){return dM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(tW.URL_SCHEME)?(t=e.slice(tW.URL_SCHEME.length),new tW(t)):null;var t};Hq.registerSaveRouter(nW),Hq.registerLoadRouter(nW);var rW=function(){function e(){this.indexedDB=Qq()}return e.prototype.listModels=function(){return lM(this,void 0,void 0,(function(){var e=this;return fM(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return eW(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(Zq,"readonly"),a=i.objectStore(Zq).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return lM(this,void 0,void 0,(function(){var t=this;return fM(this,(function(n){var r;return e=(r=e).startsWith(tW.URL_SCHEME)?r.slice(tW.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return eW(i)},i.onsuccess=function(){var t,a=i.result,o=a.transaction(Zq,"readwrite"),s=o.objectStore(Zq),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),o=function(){var i=(t=a.transaction(Jq,"readwrite")).objectStore(Jq).delete(e);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(e){return r(u.error)}};i.onsuccess=o,i.onerror=function(e){return o(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},o.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(dM().getBool("IS_BROWSER"))try{Kq.registerManager(tW.URL_SCHEME,new rW)}catch(uM){}var iW="/",aW="tensorflowjs_models",oW="info",sW="model_topology",uW="weight_specs",cW="weight_data",lW="model_metadata";function fW(e){return{info:[aW,e,oW].join(iW),topology:[aW,e,sW].join(iW),weightSpecs:[aW,e,uW].join(iW),weightData:[aW,e,cW].join(iW),modelMetadata:[aW,e,lW].join(iW)}}function pW(e){var t=e.split(iW);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(iW)}var hW=function(){function e(e){if(!dM().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=fW(this.modelPath)}return e.prototype.save=function(e){return lM(this,void 0,void 0,(function(){var t,n,r;return fM(this,(function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=$q(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(Uq)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return lM(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return fM(this,(function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(Uq){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer}(o),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),dW=function(e){return dM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(hW.URL_SCHEME)?(t=e.slice(hW.URL_SCHEME.length),new hW(t)):null;var t};Hq.registerSaveRouter(dW),Hq.registerLoadRouter(dW);var mW=function(){function e(){MM(dM().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),MM("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return lM(this,void 0,void 0,(function(){var e,t,n,r,i,a;return fM(this,(function(o){for(e={},t=aW+iW,n=iW+oW,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(t)&&i.endsWith(n)&&(a=pW(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return lM(this,void 0,void 0,(function(){var t,n;return fM(this,(function(r){var i;if(e=(i=e).startsWith(hW.URL_SCHEME)?i.slice(hW.URL_SCHEME.length):i,t=fW(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(dM().getBool("IS_BROWSER"))try{Kq.registerManager(hW.URL_SCHEME,new mW)}catch(uM){}function gW(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var vW=function(){function e(t){if(!dM().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return lM(this,void 0,void 0,(function(){var t,n,r,i,a,o;return fM(this,(function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,gW((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return s.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,gW((function(){return o.dispatchEvent(new MouseEvent("click"))}))]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:$q(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),yW=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return lM(this,void 0,void 0,(function(){var e,t,n=this;return fM(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var a=new FileReader;a.onload=function(a){var o=JSON.parse(a.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,t)}catch(e){return void i(e)}var l=[],f=[],p=[];u.forEach((function(e){e.paths.forEach((function(e){f.push(e),p.push(null)})),l.push.apply(l,e.weights)})),u.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=f.indexOf(e);p[i]=n,-1===p.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:Wq(p),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return Vq(e.name)})),i={},a=0,o=e;a<o.length;a++)o[a].paths.forEach((function(e){var a=Vq(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");i[e]=t[r.indexOf(a)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function bW(e,t,n,r){!function(e){MM(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){MM(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),MM(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),MM(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function xW(e,t){return lM(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l;return fM(this,(function(f){switch(f.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?dM().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),i=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=f.sent(),[3,4];case 2:return[4,bW(r,t.onProgress,i,a)];case 3:o=f.sent(),f.label=4;case 4:return s=o.map((function(e){return e.arrayBuffer()})),u=.5,c=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=f.sent(),[3,8];case 6:return[4,bW(s,t.onProgress,u,c)];case 7:l=f.sent(),f.label=8;case 8:return[2,l]}}))}))}function wW(e){var t=this;return function(n,r,i){return void 0===r&&(r=""),lM(t,void 0,void 0,(function(){var t,a,o,s,u,c,l,f,p,h;return fM(this,(function(d){switch(d.label){case 0:if(t=n.map((function(){return!1})),a={},o=null!=i?i.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,c=Pq[u]*FM(e.shape),l=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:c})};null!=i?i.forEach((function(t,n){t===e.name&&(l(),o[n]=!0)})):l(),s.push(e.name),r+=c}))})),!o.every((function(e){return e})))throw u=i.filter((function(e,t){return!o[t]})),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return c=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),l=[],c.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;l.push(t)}))})),[4,e(l)];case 1:return f=d.sent(),p={},h=0,c.forEach((function(e){for(var t=n[e].paths.length,r=0,i=0;i<t;i++)r+=f[h+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,c=0;c<t;c++){var l=new Uint8Array(f[h+c]);s.set(l,u),u+=l.byteLength}a[e].forEach((function(e){var t=Lq(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)p[n]=t[n]})),h+=t})),[2,p]}}))}))}}Hq.registerSaveRouter((function(e){return dM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(vW.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new vW(e)}(e.slice(vW.URL_SCHEME.length)):null}));var EW=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(MM("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=dM().platform.fetch,MM(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&MM(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return lM(this,void 0,void 0,(function(){var t,n,r,i;return fM(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:$q(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return lM(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s,u,c,l,f;return fM(this,(function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,e.json()];case 3:return t=p.sent(),[3,5];case 4:throw p.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,i=t.weightsManifest,a=t.generatedBy,o=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:f=p.sent(),c=f[0],l=f[1],p.label=7;case 7:return[2,{modelTopology:r,weightSpecs:c,weightData:l,userDefinedMetadata:u,generatedBy:a,convertedBy:o,format:s}]}}))}))},e.prototype.loadWeights=function(e){return lM(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c,l,f;return fM(this,(function(p){switch(p.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],i=n[1],a=this.weightPathPrefix||r,o=[],s=0,u=e;s<u.length;s++)c=u[s],o.push.apply(o,c.weights);return l=[],e.forEach((function(e){e.paths.forEach((function(e){l.push(a+e+i)}))})),[4,xW(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=p.sent(),[2,[o,Wq(f)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function CW(e){return null!=e.match(EW.URL_SCHEME_REGEX)}var SW=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return CW(e)})):CW(e))?NW(e,{onProgress:t}):null};function NW(e,t){return new EW(e,t)}Hq.registerSaveRouter(SW),Hq.registerLoadRouter(SW);var AW,kW=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),DW=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return lM(this,void 0,void 0,(function(){return fM(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),_W=Object.freeze({browserFiles:function(e){return new yW(e)},browserHTTPRequest:function(e,t){return NW(e,t)},concatenateArrayBuffers:Wq,decodeWeights:Lq,encodeWeights:function(e,t){return lM(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return fM(this,(function(u){switch(u.label){case 0:for(n=[],r=[],i=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),a=function(a){var o=i[a],u=Array.isArray(e)?e[a].tensor:e[o];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+u.dtype);var c={name:o,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var l=new Promise((function(e){return lM(s,void 0,void 0,(function(){var t,n,r,i,a,o,s;return fM(this,(function(c){switch(c.label){case 0:return[4,u.bytes()];case 1:for(t=c.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+4*t.length,r=new Uint8Array(n),i=0,a=0;a<t.length;a++)o=t[a],s=new Uint8Array(new Uint32Array([o.length]).buffer),r.set(s,i),i+=4,r.set(o,i),i+=o.length;return e(r),[2]}}))}))}));r.push(l)}else r.push(u.data());null!=t&&(c.group=t),n.push(c)},o=0;o<i.length;++o)a(o);return[4,Promise.all(r)];case 1:return[2,{data:jq(u.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new kW(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new kW({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new kW({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return Hq.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:$q,getSaveHandlers:function(e){return Hq.getSaveHandlers(e)},http:NW,isHTTPScheme:CW,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),lM(this,void 0,void 0,(function(){return fM(this,(function(i){return[2,wW((function(e){return xW(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return Hq.registerLoadRouter(e)},registerSaveRouter:function(e){return Hq.registerSaveRouter(e)},weightsLoaderFactory:wW,withSaveHandler:function(e){return new DW(e)},copyModel:function(e,t){return lM(this,void 0,void 0,(function(){return fM(this,(function(n){return[2,Yq(e,t,!1)]}))}))},listModels:function(){return lM(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return fM(this,(function(s){switch(s.label){case 0:e=Kq.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(i=r[n],[4,Kq.getManager(i).listModels()]):[3,4];case 2:for(o in a=s.sent())t[i+Gq+o]=a[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return lM(this,void 0,void 0,(function(){return fM(this,(function(n){return[2,Yq(e,t,!0)]}))}))},removeModel:function(e){return lM(this,void 0,void 0,(function(){var t;return fM(this,(function(n){return t=Xq(e),[2,Kq.getManager(t.scheme).removeModel(t.path)]}))}))}}),MW=_I({confusionMatrix_:function(e,t,n){var r=vI(e,"labels","confusionMatrix"),i=vI(t,"predictions","confusionMatrix");MM(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),MM(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),MM(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),MM(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),MM(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=NF(r.asType("int32"),n),o=NF(i.asType("int32"),n);return a.transpose().matMul(o).asType("int32")}}),TW=Object.freeze({confusionMatrix:MW}),OW=_I({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,a=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=yM("FromPixels",qT.backendName))return qT.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,c=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],f=c[1];if(o?s=e.getContext("2d").getImageData(0,0,l,f).data:r||n?s=e.data:(a||i)&&(null==AW&&(AW=document.createElement("canvas").getContext("2d")),AW.canvas.width=l,AW.canvas.height=f,AW.drawImage(e,0,0,l,f),s=AW.getImageData(0,0,l,f).data),4===t)u=new Int32Array(s);else{var p=l*f;u=new Int32Array(p*t);for(var h=0;h<p;h++)for(var d=0;d<t;++d)u[h*t+d]=s[4*h+d]}return PI(u,[f,l,t],"int32")}}),IW=Object.freeze({toPixels:function(e,t){return lM(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,p,h,d,m,g,v,y,b,x,w,E,C,S;return fM(this,(function(N){switch(N.label){case 0:if(n=vI(e,"img","toPixels"),e instanceof NT||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=N.sent(),u=n.min(),c=n.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=N.sent(),f=l[0],p=l[1],h=f[0],d=p[0],u.dispose(),c.dispose(),"float32"===n.dtype){if(h<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+d+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||d>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+d+"].")}for(m="float32"===n.dtype?255:1,g=new Uint8ClampedArray(a*i*4),v=0;v<i*a;++v)y=void 0,b=void 0,x=void 0,w=void 0,1===o?(y=s[v]*m,b=s[v]*m,x=s[v]*m,w=255):3===o?(y=s[3*v]*m,b=s[3*v+1]*m,x=s[3*v+2]*m,w=255):4===o&&(y=s[4*v]*m,b=s[4*v+1]*m,x=s[4*v+2]*m,w=s[4*v+3]*m),g[0+(E=4*v)]=Math.round(y),g[E+1]=Math.round(b),g[E+2]=Math.round(x),g[E+3]=Math.round(w);return null!=t&&(t.width=a,t.height=i,C=t.getContext("2d"),S=new ImageData(g,a,i),C.putImageData(S,0,0)),n!==e&&n.dispose(),[2,g]}}))}))},fromPixels:OW}),FW=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),RW=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function BW(e){MM(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),MM("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),MM(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),RW.register(e)}var zW=Object.freeze({Serializable:FW,SerializationMap:RW,registerClass:BW});function PW(){return 32===qT.backend.floatPrecision()?.001:.1}function LW(e,t,n){var r=!0;if((XM(e)||XM(t))&&(r=!1),XM(e)&&XM(t)&&(r=!0),r){var i=e.constructor.name,a=t.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var o=mI(e),s=mI(t);if(!RM(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var u=XM(e)?e:IM(e),c=XM(t)?t:IM(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var f=u[l],p=c[l];if(!n(f,p))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+p+".\nActual:   "+u+".\nExpected: "+c+".")}}function jW(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}var UW=Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=PW()),LW(e,t,(function(e,t){return jW(e,t,n)}))},testEpsilon:PW,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return ZM(e)||ZM(e[0])||ZM(t)||ZM(t[0])?LW(e,n,(function(e,t){return e==t})):LW(e,t,(function(e,t){return jW(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=PW()),!jW(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),qW="1.7.0",WW=Object.freeze({gpgpu_util:Mz,webgl_util:$O,forceHalfFloat:function(){dM().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:FP,setWebGLContext:YT,GPGPUContext:Tz}),VW=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return cM(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,a=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:a[e.name]}}));this.applyGradients(o)}else this.applyGradients(a);return nI(a),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return hR(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&nI(this.iterations_)},t.prototype.saveIterations=function(){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:RI(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return lM(this,void 0,void 0,(function(){var t;return fM(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(FW);Object.defineProperty(VW,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var $W=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=qT.backend.epsilon()),i}return cM(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=qT.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:tI((function(){return XI(i).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:tI((function(){return XI(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;tI((function(){var e=o.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(i);i.assign(u)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(nI(this.accumulatedGrads.map((function(e){return e.variable}))),nI(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return lM(this,void 0,void 0,(function(){var e;return fM(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return lM(this,void 0,void 0,(function(){var t;return fM(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(VW);BW($W);var HW=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return cM(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=qT.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:tI((function(){return $I(i.shape,t.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable;tI((function(){var e=o.add(a.square());o.assign(e);var n=a.div(e.add(qT.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&nI(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return lM(this,void 0,void 0,(function(){return fM(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(VW);BW(HW);var GW=function(e){function t(t,n,r,i){void 0===i&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],tI((function(){a.accBeta1=RI(n).variable(),a.accBeta2=RI(r).variable()})),null==i&&(a.epsilon=qT.backend.epsilon()),a}return cM(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);tI((function(){var r=rj(1,t.accBeta1),i=rj(1,t.accBeta2);n.forEach((function(n,a){var o=qT.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:tI((function(){return XI(o).variable(!1)}))}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:tI((function(){return XI(o).variable(!1)}))});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedSecondMoment[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),p=l.div(r),h=f.div(i);u.assign(l),c.assign(f);var d=p.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(d)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&nI(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&nI(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return lM(this,void 0,void 0,(function(){var e;return fM(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return lM(this,void 0,void 0,(function(){var t,n=this;return fM(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),tI((function(){n.accBeta1.assign(ej(n.beta1,n.iterations_+1)),n.accBeta2.assign(ej(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(VW);BW(GW);var KW=function(e){function t(t,n,r,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=i,o.decay=a,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],tI((function(){o.iteration=RI(0).variable(),o.accBeta1=RI(n).variable()})),null==i&&(o.epsilon=qT.backend.epsilon()),o}return cM(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);tI((function(){var r=rj(1,t.accBeta1),i=qL(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,a){var o=qT.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:XI(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:XI(o).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedWeightedInfNorm[a].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=c.mul(t.beta2),p=s.abs(),h=f.maximum(p);u.assign(l),c.assign(h);var d=i.div(r).mul(l.div(h.add(t.epsilon))).add(o);o.assign(d)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&nI(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&nI(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(VW);BW(KW);var XW=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return cM(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=qT.registeredVariables[n];tI((function(){var e=t.c.mul(i).add(a);a.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=rI(RI(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return lM(this,void 0,void 0,(function(){return fM(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(VW);BW(XW);var YW=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=RI(i.momentum),i}return cM(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=qT.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:tI((function(){return XI(i).variable(!1)}))});var a=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&tI((function(){var e,n=t.m.mul(a).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(i):t.c.mul(n).add(i),a.assign(n),i.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&nI(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return lM(this,void 0,void 0,(function(){return fM(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return lM(this,void 0,void 0,(function(){return fM(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(XW);BW(YW);var JW=function(e){function t(t,n,r,i,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===a&&(a=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=i,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=a,null==i&&(o.epsilon=qT.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return cM(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=qT.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:tI((function(){return XI(i).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:tI((function(){return XI(i).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:tI((function(){return XI(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;tI((function(){var e=o.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),c=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(u),s.assign(c);var l=i.sub(c);i.assign(l)}else{var f=o.mul(t.decay).add(a.square().mul(1-t.decay));c=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),o.assign(f),s.assign(c),l=i.sub(c),i.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&nI(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&nI(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&nI(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return lM(this,void 0,void 0,(function(){var e;return fM(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return lM(this,void 0,void 0,(function(){var t;return fM(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(VW);BW(JW);var ZW=function(){function e(){}return e.sgd=function(e){return new XW(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new YW(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new JW(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new GW(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new $W(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new KW(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new HW(e,t)},e}(),QW={sgd:ZW.sgd,momentum:ZW.momentum,adadelta:ZW.adadelta,adagrad:ZW.adagrad,rmsprop:ZW.rmsprop,adamax:ZW.adamax,adam:ZW.adam},eV="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function tV(){return new Promise((function(e){return eV((function(){return e()}))}))}function nV(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach((function(n,r){var i=n.x,a=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(i,a)})),n){var r=t[t.length-1],i=t[0];if(!r||!i)return;e.moveTo(r.x,r.y),e.lineTo(i.x,i.y)}e.stroke()}NT.prototype.squaredDifference=function(e){return zP(this,e)},CT=Eq;var rV=function(e,t){return rV=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},rV(e,t)};function iV(e,t){function n(){this.constructor=e}rV(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var aV=function(){return aV=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},aV.apply(this,arguments)};function oV(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function sV(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function uV(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var cV=function(){function e(e,t){if(!EV(e)||!EV(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function lV(e,t){return e instanceof NT&&e.shape.length===t}function fV(e){return lV(e,1)}function pV(e){return lV(e,2)}function hV(e){return lV(e,3)}function dV(e){return lV(e,4)}function mV(e){return e%1!=0}function gV(e){return e%2==0}function vV(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function yV(e){return e&&e.width&&e.height}function bV(e,t){var n=e.width,r=e.height,i=t/Math.max(r,n);return new cV(Math.round(n*i),Math.round(r*i))}function xV(e){return e.reduce((function(e,t){return e.add(t)}),new SV(0,0)).div(new SV(e.length,e.length))}function wV(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function EV(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function CV(e){return EV(e)&&0<=e&&e<=1}var SV=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),NV=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},i=[r.left,r.top,r.right,r.bottom].every(EV),a=[r.x,r.y,r.width,r.height].every(EV);if(!a&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=o[0],u=o[1],c=o[2],l=o[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(EV)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new SV(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new SV(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new SV(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new SV(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,i=t.width,a=t.height,o=Math.abs(i-a);return i<a&&(n-=o/2,i+=o),a<i&&(r-=o/2,a+=o),new e({x:n,y:r,width:i,height:a})},e.prototype.rescale=function(t){var n=yV(t)?t.width:t,r=yV(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,i=r.x,a=r.y,o=r.right,s=r.bottom,u=Math.max(i,0),c=Math.max(a,0),l=o-u,f=s-c;return new e({x:u,y:c,width:Math.min(l,t-u),height:Math.min(f,n-c)}).floor()},e.prototype.shift=function(t,n){var r=this.width,i=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:i})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,i=n,a=r,o=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(i=-u+t+n,u=t),c>e&&(a=-c+e+r,c=e),o<1&&(a=2-o,o=1),s<1&&(a=2-s,s=1),{dy:1,edy:a,dx:1,edx:i,y:s,ey:c,x:o,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),AV=function(e){function t(t,n,r,i,a){return void 0===a&&(a=!1),e.call(this,{left:t,top:n,right:r,bottom:i},a)||this}return iV(t,e),t}(NV),kV=function(){function e(e,t,n,r,i){this._imageDims=new cV(i.width,i.height),this._score=e,this._classScore=t,this._className=n,this._box=new NV(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new NV(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),DV=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return iV(t,e),t.prototype.forSize=function(n,r){var i=e.prototype.forSize.call(this,n,r);return new t(i.score,i.relativeBox,i.imageDims)},t}(kV);function _V(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function MV(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),i=n.reduce((function(e,t){return t<e?t:e}),1/0),a=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new AV(r,i,a,o)}function TV(e,t,n,r){void 0===r&&(r=!0);for(var i=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),a=[],o=function(){var t=i.pop();a.push(t);for(var o=i,s=[],u=0;u<o.length;u++){var c=o[u],l=e[t],f=e[c];s.push(_V(l,f,r))}i=i.filter((function(e,t){return s[t]<=n}))};i.length>0;)o();return a}function OV(e,t){return tI((function(){var n=t[0],r=t[1],i=t[2],a=$I(uV(e.shape.slice(0,3),[1]),n),o=$I(uV(e.shape.slice(0,3),[1]),r),s=$I(uV(e.shape.slice(0,3),[1]),i),u=YI([a,o,s],3);return rj(e,u)}))}function IV(e,t){return void 0===t&&(t=!1),tI((function(){var n=e.shape.slice(1),r=n[0],i=n[1];if(r===i)return e;var a=Math.abs(r-i),o=Math.round(a*(t?.5:1)),s=r>i?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,$I(n,0)},c=u(o),l=a-c.shape[s],f=[t&&l?u(l):null,e,c].filter((function(e){return!!e})).map((function(e){return e.toFloat()}));return YI(f,s)}))}function FV(e){for(var t=e.slice(),n=t.length-1;n>0;n--){var r=Math.floor(Math.random()*(n+1)),i=t[n];t[n]=t[r],t[r]=i}return t}function RV(e){return 1/(1+Math.exp(-e))}function BV(e){return Math.log(e/(1-e))}var zV,PV=function(e){function t(t,n,r,i,a){return void 0===a&&(a=!1),e.call(this,{x:t,y:n,width:r,height:i},a)||this}return iV(t,e),t}(NV),LV=function(){function e(e,t,n){void 0===n&&(n=new SV(0,0));var r=t.width,i=t.height;this._imgDims=new cV(r,i),this._shift=n,this._positions=e.map((function(e){return e.mul(new SV(r,i)).add(n)}))}return Object.defineProperty(e.prototype,"shift",{get:function(){return new SV(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new SV(e.imageWidth,e.imageHeight))}))},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new SV(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof DV?e.box.floor():new NV(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),i=r.useDlibAlignment,a=r.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],i=function(e){return r.sub(e).magnitude()},a=(i(t)+i(n))/2,o=Math.floor(a/.45),s=xV(e),u=Math.floor(Math.max(0,s.x-.5*o)),c=Math.floor(Math.max(0,s.y-.43*o));return new PV(u,c,Math.min(o,this.imageWidth+u),Math.min(o,this.imageHeight+c))},e.prototype.alignMinBbox=function(e){var t=MV(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),jV=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],xV([e[3],e[4]])]},t}(LV),UV=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(xV)},t}(LV),qV=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+vV(this.distance)+")":"")},e}(),WV=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return iV(t,e),t.assertIsValidLabeledBox=function(e,t){if(NV.assertIsValidBox(e,t),!EV(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(NV),VV=function(){function e(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some((function(e){return!(e instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(e){return Array.from(e)}))}},e.fromJSON=function(t){var n=t.descriptors.map((function(e){return new Float32Array(e)}));return new e(t.label,n)},e}(),$V=function(e){function t(t,n,r,i){var a=e.call(this,t,n)||this;return a._score=r,a._classScore=i,a}return iV(t,e),t.assertIsValidPredictedBox=function(e,t){if(WV.assertIsValidLabeledBox(e,t),!CV(e.score)||!CV(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t}(WV);function HV(e){return e.detection instanceof DV}function GV(e,t){var n={detection:t};return Object.assign({},e,n)}function KV(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function XV(e){var t="";if(!e)try{e=n(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(e){t=e.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function YV(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=XV();return aV({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},i)}function JV(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function ZV(){return"object"==typeof n.g&&"undefined"!=typeof process&&!!process.version}function QV(e){zV=e}function e$(){JV()&&QV(KV()),ZV()&&QV(YV())}var t$,n$={getEnv:function(){if(!zV)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return zV},setEnv:QV,initialize:e$,createBrowserEnv:KV,createFileSystem:XV,createNodejsEnv:YV,monkeyPatch:function(e){if(zV||e$(),!zV)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?zV.Canvas:t,r=e.Image,i=void 0===r?zV.Image:r;zV.Canvas=n,zV.Image=i,zV.createCanvasElement=e.createCanvasElement||function(){return new n},zV.createImageElement=e.createImageElement||function(){return new i},zV.ImageData=e.ImageData||zV.ImageData,zV.Video=e.Video||zV.Video,zV.fetch=e.fetch||zV.fetch,zV.readFile=e.readFile||zV.readFile},isBrowser:JV,isNodejs:ZV};function r$(e){return n$.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function i$(e){var t=n$.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=r$(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=r.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}e$(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(t$||(t$={}));var a$=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,i=e.fontSize,a=e.fontStyle,o=e.padding;this.anchorPosition=t||t$.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=o||4},o$=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new a$(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===t$.BOTTOM_RIGHT||n===t$.TOP_RIGHT,i=n===t$.BOTTOM_LEFT||n===t$.BOTTOM_RIGHT,a=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-a:this.anchor.x,u=i?this.anchor.y-o:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-a),0),y:Math.max(Math.min(u,l-o),0)}}return{x:s,y:u}},e.prototype.draw=function(e){var t=r$(e),n=i$(t),r=this.options,i=r.backgroundColor,a=r.fontColor,o=r.fontSize,s=r.fontStyle,u=r.padding;n.font=o+"px "+s;var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=i;var f=this.getUpperLeft(n,t);n.fillRect(f.x,f.y,c,l),n.fillStyle=a,this.text.forEach((function(e,t){var r=u+f.x,i=u+f.y+(t+1)*o;n.fillText(e,r,i)}))},e}(),s$=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,i=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var a={anchorPosition:t$.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new a$(Object.assign({},a,i))},u$=function(){function e(e,t){void 0===t&&(t={}),this.box=new NV(e),this.options=new s$(t)}return e.prototype.draw=function(e){var t=i$(e),n=this.options,r=n.boxColor,i=n.lineWidth,a=this.box,o=a.x,s=a.y,u=a.width,c=a.height;t.strokeStyle=r,t.lineWidth=i,t.strokeRect(o,s,u,c);var l=this.options.label;l&&new o$([l],{x:o-i/2,y:s},this.options.drawLabelOptions).draw(e)},e}();function c$(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof DV?t.score:HV(t)?t.detection.score:void 0,r=t instanceof DV?t.box:HV(t)?t.detection.box:new NV(t),i=n?""+vV(n):void 0;new u$(r,{label:i}).draw(e)}))}function l$(e){var t=n$.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function f$(e){return new Promise((function(t,n){if(e instanceof n$.getEnv().Canvas||l$(e))return t();function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",i),t(e))}function i(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",i),n(e))}e.addEventListener("load",r),e.addEventListener("error",i)}))}function p$(e){return new Promise((function(t,n){if(!(e instanceof Blob))return n("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if("string"!=typeof r.result)return n("bufferToImage - expected reader.result to be a string, in onload");var e=n$.getEnv().createImageElement();e.onload=function(){return t(e)},e.onerror=n,e.src=r.result},r.onerror=n,r.readAsDataURL(e)}))}function h$(e){var t=n$.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new cV(e.naturalWidth,e.naturalHeight):e instanceof r?new cV(e.videoWidth,e.videoHeight):new cV(e.width,e.height)}function d$(e){var t=e.width,n=e.height,r=(0,n$.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function m$(e,t){var n=n$.getEnv().ImageData;if(!(e instanceof n||l$(e)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||h$(e),i=r.width,a=r.height,o=d$({width:i,height:a});return e instanceof n?i$(o).putImageData(e,0,0):i$(o).drawImage(e,0,0,i,a),o}function g$(e,t){return oV(this,void 0,void 0,(function(){var n,r,i,a,o,s;return sV(this,(function(u){switch(u.label){case 0:return n=t||n$.getEnv().createCanvasElement(),r=e.shape.slice(dV(e)?1:0),i=r[0],a=r[1],o=r[2],s=tI((function(){return e.as3D(i,a,o).toInt()})),[4,IW.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}}))}))}function v$(e){var t=n$.getEnv(),n=t.Image,r=t.Canvas,i=t.Video;return e instanceof n||e instanceof r||e instanceof i}function y$(e,t,n){void 0===n&&(n=!1);var r=n$.getEnv(),i=r.Image,a=r.Canvas;if(!(e instanceof i||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=h$(e),s=t/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=d$({width:t,height:t}),f=e instanceof a?e:m$(e),p=Math.abs(u-c)/2,h=n&&u<c?p:0,d=n&&c<u?p:0;return i$(l).drawImage(f,h,d,u,c),l}var b$=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((function(e,t){if(hV(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(dV(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var i=e instanceof n$.getEnv().Canvas?e:m$(e);n._canvases[t]=i,n._inputDimensions[t]=[i.height,i.width,3]}))}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return wV(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return bV({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,tI((function(){var r=wV(n.batchSize,0,1).map((function(r){var i=n.getInput(r);if(i instanceof NT){var a=dV(i)?i:i.expandDims();return(a=IV(a,t)).shape[1]===e&&a.shape[2]===e||(a=hq.resizeBilinear(a,[e,e])),a.as3D(e,e,3)}if(i instanceof n$.getEnv().Canvas)return IW.fromPixels(y$(i,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+i)})),i=PF(r.map((function(e){return e.toFloat()}))).as4D(n.batchSize,e,e,3);return i}))},e}();function x$(e){return oV(this,void 0,void 0,(function(){var t,n,r;return sV(this,(function(i){switch(i.label){case 0:if(e instanceof b$)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(r$)).forEach((function(e,r){if(!v$(e)&&!hV(e)&&!dV(e)){if("string"==typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(dV(e)){var i=e.shape[0];if(1!==i)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+i+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(e){return v$(e)&&f$(e)})))];case 1:return i.sent(),[2,new b$(r,Array.isArray(e))]}}))}))}function w$(e,t){return oV(this,void 0,void 0,(function(){var n,r,i,a,o,s,u;return sV(this,(function(c){switch(c.label){case 0:return n=n$.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,x$(e)];case 1:if((i=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=i.getInput(0))instanceof n?(o=a,[3,4]):[3,2];case 2:return[4,g$(a)];case 3:o=c.sent(),c.label=4;case 4:r=o,c.label=5;case 5:return s=i$(r),u=t.map((function(e){return e instanceof DV?e.forSize(r.width,r.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(r.width,r.height)})),[2,u.map((function(e){var t=e.x,n=e.y,r=e.width,i=e.height,a=d$({width:r,height:i});return i$(a).putImageData(s.getImageData(t,n,r,i),0,0),a}))]}}))}))}function E$(e,t){return oV(this,void 0,void 0,(function(){return sV(this,(function(n){if(!hV(e)&&!dV(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(dV(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,tI((function(){var n=e.shape.slice(dV(e)?1:0),r=n[0],i=n[1],a=n[2],o=t.map((function(e){return e instanceof DV?e.forSize(i,r).box:e})).map((function(e){return e.clipAtImageBorders(i,r)})),s=o.map((function(t){var n=t.x,o=t.y,s=t.width,u=t.height;return eU(e.as3D(r,i,a),[o,n,0],[u,s,a])}));return s}))]}))}))}function C$(e,t){return oV(this,void 0,void 0,(function(){var n;return sV(this,(function(r){switch(r.label){case 0:return[4,(0,n$.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function S$(e){return oV(this,void 0,void 0,(function(){var t,n;return sV(this,(function(r){switch(r.label){case 0:return[4,C$(e)];case 1:return[4,(t=r.sent()).blob()];case 2:if(!(n=r.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+n.type+", for url: "+t.url);return[2,p$(n)]}}))}))}function N$(e){return oV(this,void 0,void 0,(function(){return sV(this,(function(t){switch(t.label){case 0:return[4,C$(e)];case 1:return[2,t.sent().json()]}}))}))}function A$(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=Float32Array.bind,[4,C$(e)];case 1:return[4,n.sent().arrayBuffer()];case 2:return[2,new(t.apply(Float32Array,[void 0,n.sent()]))]}}))}))}function k$(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",i=(e=e.replace(r,"")).split("/").filter((function(e){return e})),a=e.endsWith(".json")?i[i.length-1]:n,o=r+(e.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:o=e.startsWith("/")?"/"+o:o,manifestUri:"/"===o?"/"+a:o+"/"+a}}function D$(e,t){return oV(this,void 0,void 0,(function(){var n,r,i,a;return sV(this,(function(o){switch(o.label){case 0:return n=k$(e,t),r=n.manifestUri,i=n.modelBaseUri,[4,N$(r)];case 1:return a=o.sent(),[2,_W.loadWeights(a,i)]}}))}))}function _$(e,t,n){void 0===n&&(n=!1);var r=n?h$(t):t,i=r.width,a=r.height;return e.width=i,e.height=a,{width:i,height:a}}var M$=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,i=n.objProp;r[i].dispose(),r[i]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))},e.prototype.getTrainableParams=function(){return this.getParamList().filter((function(e){return e.tensor instanceof TT}))},e.prototype.getFrozenParams=function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof TT)}))},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,i=II(r.dataSync());r.dispose(),e.reassignParamFromPath(n,i)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()})),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))},e.prototype.load=function(e){return oV(this,void 0,void 0,(function(){return sV(this,(function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loadFromUri=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,D$(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}}))}))},e.prototype.loadFromDisk=function(e){return oV(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c,l;return sV(this,(function(f){switch(f.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=n$.getEnv().readFile,n=k$(e,this.getDefaultModelName()),r=n.manifestUri,i=n.modelBaseUri,a=function(e){return Promise.all(e.map((function(e){return t(e).then((function(e){return e.buffer}))})))},o=_W.weightsLoaderFactory(a),c=(u=JSON).parse,[4,t(r)];case 1:return s=c.apply(u,[f.sent().toString()]),[4,o(s,i)];case 2:return l=f.sent(),this.loadFromWeightMap(l),[2]}}))}))},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!(n&&r&&n[r]instanceof NT))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function T$(e,t,n){return tI((function(){var r=Ij(e,t.depthwise_filter,t.pointwise_filter,n,"same");return PL(r,t.bias)}))}function O$(e,t,n){return void 0===n&&(n=!1),tI((function(){var r=vU(n?PL(Aj(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):T$(e,t.conv0,[2,2])),i=T$(r,t.conv1,[1,1]),a=T$(vU(PL(r,i)),t.conv2,[1,1]);return vU(PL(r,PL(i,a)))}))}function I$(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),tI((function(){var i=vU(n?PL(Aj(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):T$(e,t.conv0,r?[2,2]:[1,1])),a=T$(i,t.conv1,[1,1]),o=T$(vU(PL(i,a)),t.conv2,[1,1]),s=T$(vU(PL(i,PL(a,o))),t.conv3,[1,1]);return vU(PL(i,PL(a,PL(o,s))))}))}function F$(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),tI((function(){var i=PL(Aj(e,t.filters,[1,1],n),t.bias);return r?vU(i):i}))}function R$(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function B$(e,t){return function(n,r,i,a){var o=LI(e(n*r*i*i),[i,i,n,r]),s=BI(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:s}}}function z$(e,t){return function(n,r,i){var a=zI(e(n*r),[n,r]),o=BI(e(r));return t.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:a,bias:o}}}var P$=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function L$(e,t){return function(n,r,i){var a=LI(e(9*n),[3,3,n,1]),o=LI(e(n*r),[1,1,n,r]),s=BI(e(r));return t.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new P$(a,o,s)}}function j$(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),i=e(t+"/bias",1);return new P$(n,r,i)}}function U$(e,t){return function(n,r,i){var a=e[n];if(!lV(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:i||n}),a}}function q$(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function W$(e,t){var n=B$(e,t),r=L$(e,t);function i(e,t,i,a){return void 0===a&&(a=!1),{conv0:a?n(e,t,3,i+"/conv0"):r(e,t,i+"/conv0"),conv1:r(t,t,i+"/conv1"),conv2:r(t,t,i+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(e,t,n,a){void 0===a&&(a=!1);var o=i(e,t,n,a);return{conv0:o.conv0,conv1:o.conv1,conv2:o.conv2,conv3:r(t,t,n+"/conv3")}}}}function V$(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function $$(e,t){var n=U$(e,t),r=V$(n),i=j$(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):i(e+"/conv0"),conv1:i(e+"/conv1"),conv2:i(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):i(e+"/conv0"),conv1:i(e+"/conv1"),conv2:i(e+"/conv2"),conv3:i(e+"/conv3")}}}}var H$=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return iV(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return tI((function(){var n=I$(OV(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(RI(255)),t.dense0,!0);return n=I$(n,t.dense1),n=I$(n,t.dense2),n=I$(n,t.dense3),Gj(n,[7,7],[2,2],"valid")}))},t.prototype.forward=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,x$(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=$$(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return R$(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=q$(e),r=n.extractWeights,i=n.getRemainingWeights,a=W$(r,t).extractDenseBlock4Params,o=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),c=a(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}(e)},t}(M$);function G$(e,t){return tI((function(){return PL(Bj(e,t.weights),t.bias)}))}function K$(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var X$=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return iV(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return tI((function(){var r=e instanceof b$?t.faceFeatureExtractor.forwardInput(e):e;return G$(r.as2D(r.shape[0],-1),n.fc)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],i=q$(e),a=i.extractWeights,o=i.getRemainingWeights,s=z$(a,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=K$(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=U$(e,t),r={fc:("fc",{weights:n("fc/weights",2),bias:n("fc/bias",1)})};return R$(e,t),{params:r,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,i=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},t}(M$),Y$=["neutral","happy","sad","angry","fearful","disgusted","surprised"],J$=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);Y$.forEach((function(n,r){t[n]=e[r]}))}return e.prototype.asSortedArray=function(){var e=this;return Y$.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))},e}(),Z$=function(e){function t(t){return void 0===t&&(t=new H$),e.call(this,"FaceExpressionNet",t)||this}return iV(t,e),t.prototype.forwardInput=function(e){var t=this;return tI((function(){return gR(t.runNet(e))}))},t.prototype.forward=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,x$(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictExpressions=function(e){return oV(this,void 0,void 0,(function(){var t,n,r,i,a=this;return sV(this,(function(o){switch(o.label){case 0:return[4,x$(e)];case 1:return t=o.sent(),[4,this.forwardInput(t)];case 2:return n=o.sent(),[4,Promise.all(UF(n).map((function(e){return oV(a,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}}))}))})))];case 3:return r=o.sent(),n.dispose(),i=r.map((function(e){return new J$(e)})),[2,t.isBatchInput?i:i[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(X$);function Q$(e){return e.expressions instanceof J$}function eH(e,t){var n={expressions:t};return Object.assign({},e,n)}function tH(e,t,n,r){void 0===n&&(n=.1),(Array.isArray(t)?t:[t]).forEach((function(t){var i=t instanceof J$?t:Q$(t)?t.expressions:void 0;if(!i)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var a=i.asSortedArray().filter((function(e){return e.probability>n})),o=HV(t)?t.detection.box.bottomLeft:r||new SV(0,0),s=new o$(a.map((function(e){return e.expression+" ("+vV(e.probability)+")"})),o);s.draw(e)}))}function nH(e){return HV(e)&&e.landmarks instanceof LV&&e.unshiftedLandmarks instanceof LV&&e.alignedRect instanceof DV}function rH(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),i=r.align(),a=e.detection.imageDims,o={landmarks:r,unshiftedLandmarks:t,alignedRect:new DV(e.detection.score,i.rescale(a.reverse()),a)};return Object.assign({},e,o)}var iH=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,i=void 0===r||r,a=e.lineWidth,o=e.lineColor,s=e.pointSize,u=e.pointColor;this.drawLines=n,this.drawPoints=i,this.lineWidth=a||1,this.pointSize=s||2,this.lineColor=o||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"},aH=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new iH(t)}return e.prototype.draw=function(e){var t=i$(e),n=this.options,r=n.drawLines,i=n.drawPoints,a=n.lineWidth,o=n.lineColor,s=n.pointSize,u=n.pointColor;r&&this.faceLandmarks instanceof UV&&(t.strokeStyle=o,t.lineWidth=a,nV(t,this.faceLandmarks.getJawOutline()),nV(t,this.faceLandmarks.getLeftEyeBrow()),nV(t,this.faceLandmarks.getRightEyeBrow()),nV(t,this.faceLandmarks.getNose()),nV(t,this.faceLandmarks.getLeftEye(),!0),nV(t,this.faceLandmarks.getRightEye(),!0),nV(t,this.faceLandmarks.getMouth(),!0)),i&&(t.strokeStyle=u,t.fillStyle=u,this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()})))},e}();function oH(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof LV?t:nH(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new aH(n).draw(e)}))}function sH(e,t,n){return PL(Aj(e,t.filters,n,"same"),t.bias)}function uH(e,t,n){void 0===n&&(n=!0);var r=n?vU(e):e;return r=T$(r,t.separable_conv0,[1,1]),r=T$(vU(r),t.separable_conv1,[1,1]),r=Hj(r,[3,3],[2,2],"same"),PL(r,sH(e,t.expansion_conv,[2,2]))}var cH,lH=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return iV(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return tI((function(){var r=OV(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(RI(256)),i=vU(sH(r,n.entry_flow.conv_in,[2,2]));return i=uH(i,n.entry_flow.reduction_block_0,!1),i=uH(i,n.entry_flow.reduction_block_1),wV(t._numMainBlocks,0,1).forEach((function(e){i=function(e,t){var n=T$(vU(e),t.separable_conv0,[1,1]);return n=T$(vU(n),t.separable_conv1,[1,1]),n=T$(vU(n),t.separable_conv2,[1,1]),PL(n,e)}(i,n.middle_flow["main_block_"+e])})),i=uH(i,n.exit_flow.reduction_block),i=vU(T$(i,n.exit_flow.separable_conv,[1,1]))}))},t.prototype.forward=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,x$(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n=[],r=function(e,t){var n=U$(e,t),r=V$(n),i=j$(n);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(e){return{separable_conv0:i(e+"/separable_conv0"),separable_conv1:i(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:i(e+"/separable_conv0"),separable_conv1:i(e+"/separable_conv1"),separable_conv2:i(e+"/separable_conv2")}}}}(e,n),i=r.extractConvParams,a=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:i("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},c={};wV(t,0,1).forEach((function(e){c["main_block_"+e]=s("middle_flow/main_block_"+e)}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return R$(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return function(e,t){var n=[],r=q$(e),i=r.extractWeights,a=r.getRemainingWeights,o=function(e,t){var n=B$(e,t),r=L$(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,i){return{separable_conv0:r(e,t,i+"/separable_conv0"),separable_conv1:r(t,t,i+"/separable_conv1"),expansion_conv:n(e,t,1,i+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(i,n),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,f={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},p={};wV(t,0,1).forEach((function(e){p["main_block_"+e]=l(128,"middle_flow/main_block_"+e)}));var h={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:p,exit_flow:h}}}(e,this._numMainBlocks)},t}(M$);!function(e){e.FEMALE="female",e.MALE="male"}(cH||(cH={}));var fH=function(e){function t(t){void 0===t&&(t=new lH(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return iV(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return tI((function(){var r=e instanceof b$?t.faceFeatureExtractor.forwardInput(e):e,i=Gj(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:G$(i,n.fc.age).as1D(),gender:G$(i,n.fc.gender)}}))},t.prototype.forwardInput=function(e){var t=this;return tI((function(){var n=t.runNet(e),r=n.age,i=n.gender;return{age:r,gender:gR(i)}}))},t.prototype.forward=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,x$(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictAgeAndGender=function(e){return oV(this,void 0,void 0,(function(){var t,n,r,i,a,o,s=this;return sV(this,(function(u){switch(u.label){case 0:return[4,x$(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=UF(n.age),i=UF(n.gender),a=r.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),[4,Promise.all(a.map((function(e){var t=e.ageTensor,n=e.genderTensor;return oV(s,void 0,void 0,(function(){var e,r,i,a,o;return sV(this,(function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],a=(i=r>.5)?cH.MALE:cH.FEMALE,o=i?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:a,genderProbability:o}]}}))}))})))];case 3:return o=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?o:o[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=q$(e),r=n.extractWeights,i=n.getRemainingWeights,a=z$(r,t),o=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=K$(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=U$(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return R$(e,t),{params:i,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(M$),pH=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,i=t/Math.max(r,n);return{width:n*i,height:r*i}})),i=r.length;return tI((function(){var n=function(e,t){return PF([$I([68],e),$I([68],t)],1).as2D(1,136).as1D()},a=function(e,t){var n=r[e],i=n.width,a=n.height;return t(i,a)?Math.abs(i-a)/2:0},o=e.mul($I([i,136],t)).sub(PF(Array.from(Array(i),(function(e,t){return n(function(e){return a(e,(function(e,t){return e<t}))}(t),function(e){return a(e,(function(e,t){return t<e}))}(t))})))).div(PF(Array.from(Array(i),(function(e,t){return n(r[t].width,r[t].height)}))));return o}))},t.prototype.forwardInput=function(e){var t=this;return tI((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){return{height:e[0],width:e[1]}})))}))},t.prototype.forward=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,x$(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.detectLandmarks=function(e){return oV(this,void 0,void 0,(function(){var t,n,r,i=this;return sV(this,(function(a){switch(a.label){case 0:return[4,x$(e)];case 1:return t=a.sent(),n=tI((function(){return UF(i.forwardInput(t))})),[4,Promise.all(n.map((function(e,n){return oV(i,void 0,void 0,(function(){var r,i,a,o,s;return sV(this,(function(u){switch(u.label){case 0:return a=(i=Array).from,[4,e.data()];case 1:return r=a.apply(i,[u.sent()]),o=r.filter((function(e,t){return gV(t)})),s=r.filter((function(e,t){return!gV(t)})),[2,new UV(Array(68).fill(0).map((function(e,t){return new SV(o[t],s[t])})),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}}))}))})))];case 2:return r=a.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getClassifierChannelsOut=function(){return 136},t}(X$),hH=function(e){function t(t){return void 0===t&&(t=new H$),e.call(this,"FaceLandmark68Net",t)||this}return iV(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(pH),dH=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return iV(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return tI((function(){var n=O$(OV(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(RI(255)),t.dense0,!0);return n=O$(n,t.dense1),n=O$(n,t.dense2),Gj(n,[14,14],[2,2],"valid")}))},t.prototype.forward=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,x$(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=$$(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return R$(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=q$(e),r=n.extractWeights,i=n.getRemainingWeights,a=W$(r,t).extractDenseBlock3Params,o=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u}}}(e)},t}(M$),mH=function(e){function t(t){return void 0===t&&(t=new dH),e.call(this,"FaceLandmark68TinyNet",t)||this}return iV(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(pH),gH=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t}(hH);function vH(e,t,n,r,i){void 0===i&&(i="same");var a=t.conv,o=a.filters,s=a.bias,u=Aj(e,o,n,i);return u=function(e,t){return PL(ZL(e,t.weights),t.biases)}(u=PL(u,s),t.scale),r?vU(u):u}function yH(e,t){return vH(e,t,[1,1],!1)}function bH(e,t){return vH(e,t,[2,2],!0,"valid")}function xH(e,t){function n(n,r,i,a){var o=function(n,r,i,a){var o=function(t,n,r){var i=e(t),a=i.length/(n*r*r);if(mV(a))throw new Error("depth has to be an integer: "+a+", weights.length: "+i.length+", numFilters: "+n+", filterSize: "+r);return tI((function(){return xU(LI(i,[n,a,r,r]),[2,3,1,0])}))}(n,r,i),s=BI(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:s}}(n,r,i,a+"/conv"),s=function(n,r){var i=BI(e(n)),a=BI(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:i,biases:a}}(r,a+"/scale");return{conv:o,scale:s}}return{extractConvLayerParams:n,extractResidualLayerParams:function(e,t,r,i,a){return void 0===a&&(a=!1),{conv1:n((a?.5:1)*e,t,r,i+"/conv1"),conv2:n(e,t,r,i+"/conv2")}}}}function wH(e,t){var n=function(e,t){return vH(e,t,[1,1],!0)}(e,t.conv1);return n=yH(n,t.conv2),n=PL(n,e),vU(n)}function EH(e,t){var n=bH(e,t.conv1);n=yH(n,t.conv2);var r=Gj(e,2,2,"valid"),i=VI(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=uV(n.shape);o[1]=1;var s=VI(o),u=uV((n=YI([n,s],1)).shape);u[2]=1;var c=VI(u);n=YI([n,c],2)}return r=a?YI([r,i],3):r,n=PL(r,n),vU(n)}var CH=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return iV(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return tI((function(){var n=bH(OV(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(RI(256)),t.conv32_down);n=wH(n=Hj(n,3,2,"valid"),t.conv32_1),n=wH(n,t.conv32_2),n=wH(n,t.conv32_3),n=wH(n=EH(n,t.conv64_down),t.conv64_1),n=wH(n,t.conv64_2),n=wH(n,t.conv64_3),n=wH(n=EH(n,t.conv128_down),t.conv128_1),n=wH(n,t.conv128_2),n=wH(n=EH(n,t.conv256_down),t.conv256_1);var r=(n=EH(n=wH(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Bj(r,t.fc)}))},t.prototype.forward=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,x$(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.computeFaceDescriptor=function(e){return oV(this,void 0,void 0,(function(){var t,n,r,i=this;return sV(this,(function(a){switch(a.label){case 0:return[4,x$(e)];case 1:return t=a.sent(),n=tI((function(){return UF(i.forwardInput(t))})),[4,Promise.all(n.map((function(e){return e.data()})))];case 2:return r=a.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=function(e,t){var n=U$(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),i=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:i}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}(e,t),r=n.extractConvLayerParams,i=n.extractResidualLayerParams,a=r("conv32_down"),o=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),c=i("conv64_down"),l=i("conv64_1"),f=i("conv64_2"),p=i("conv64_3"),h=i("conv128_down"),d=i("conv128_1"),m=i("conv128_2"),g=i("conv256_down"),v=i("conv256_1"),y=i("conv256_2"),b=i("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!pV(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:a,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:f,conv64_3:p,conv128_down:h,conv128_1:d,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:y,conv256_down_out:b,fc:x};return R$(e,t),{params:w,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=q$(e),n=t.extractWeights,r=t.getRemainingWeights,i=[],a=xH(n,i),o=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),p=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),d=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),C=tI((function(){return xU(zI(n(32768),[128,256]),[1,0])}));if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:f,conv64_down:p,conv64_1:h,conv64_2:d,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:w,conv256_down_out:E,fc:C},paramMappings:i}}(e)},t}(M$);function SH(e){var t=new CH;return t.extractWeights(e),t}function NH(e,t){var n={descriptor:t};return Object.assign({},e,n)}function AH(e){return"number"==typeof e.age}function kH(e,t){var n={age:t};return Object.assign({},e,n)}function DH(e){return(e.gender===cH.MALE||e.gender===cH.FEMALE)&&CV(e.genderProbability)}function _H(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var MH=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,i=t.maxNumScales,a=t.scoreThresholds,o=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=o,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(e){return"number"!=typeof e})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(e){return"number"!=typeof e}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function TH(e,t,n){return tI((function(){var r=Aj(e,t.filters,n,"same");return r=PL(r,t.batch_norm_offset),HP(r,0,6)}))}function OH(e,t,n){var r=e.arraySync(),i=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),p=(o-i)*(s-a),h=(l-u)*(f-c);if(p<=0||h<=0)return 0;var d=Math.max(i,u),m=Math.max(a,c),g=Math.min(o,l),v=Math.min(s,f),y=Math.max(g-d,0)*Math.max(v-m,0);return y/(p+h-y)}function IH(e,t){return tI((function(){var n=e.shape[0];return{boxPredictionEncoding:RF(F$(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:RF(F$(e,t.class_predictor),[n,-1,3])}}))}var FH=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),RH=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return iV(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return tI((function(){var n=e.toBatchTensor(512,!1).toFloat(),r=function(e,t){return tI((function(){var n=null,r=TH(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var i=t+1,a=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(i);r=function(e,t,n){return tI((function(){var r=Mj(e,t.filters,n,"same");return r=DL(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),HP(r,0,6)}))}(r,e.depthwise_conv,a),r=TH(r,e.pointwise_conv,[1,1]),11===i&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}(rj(ZL(n,RI(.007843137718737125)),RI(1)),t.mobilenetv1),i=function(e,t,n){return tI((function(){var r=TH(e,n.conv_0,[1,1]),i=TH(r,n.conv_1,[2,2]),a=TH(i,n.conv_2,[1,1]),o=TH(a,n.conv_3,[2,2]),s=TH(o,n.conv_4,[1,1]),u=TH(s,n.conv_5,[2,2]),c=TH(u,n.conv_6,[1,1]),l=TH(c,n.conv_7,[2,2]),f=IH(t,n.box_predictor_0),p=IH(e,n.box_predictor_1),h=IH(i,n.box_predictor_2),d=IH(o,n.box_predictor_3),m=IH(u,n.box_predictor_4),g=IH(l,n.box_predictor_5);return{boxPredictions:YI([f.boxPredictionEncoding,p.boxPredictionEncoding,h.boxPredictionEncoding,d.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:YI([f.classPrediction,p.classPrediction,h.classPrediction,d.classPrediction,m.classPrediction,g.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return tI((function(){var r=e.shape[0],i=function(e,t){var n=function(e){var t=UF(xU(e,[1,0])),n=[rj(t[2],t[0]),rj(t[3],t[1])];return{sizes:n,centers:[PL(t[0],qL(n[0],RI(2))),PL(t[1],qL(n[1],RI(2)))]}}(e),r=n.sizes,i=n.centers,a=UF(xU(t,[1,0])),o=qL(ZL(YP(qL(a[2],RI(5))),r[0]),RI(2)),s=PL(ZL(qL(a[0],RI(10)),r[0]),i[0]),u=qL(ZL(YP(qL(a[3],RI(5))),r[1]),RI(2)),c=PL(ZL(qL(a[1],RI(10)),r[1]),i[1]);return xU(PF([rj(s,o),rj(c,u),PL(s,o),PL(c,u)]),[1,0])}(RF(LF(n.extra_dim,[r,1,1]),[-1,4]),RF(e,[-1,4]));i=RF(i,[r,i.shape[0]/r,4]);var a=oL(Jj(t,[0,0,1],[-1,-1,-1])),o=Jj(a,[0,0,0],[-1,-1,1]);return o=RF(o,[r,o.shape[1]]),{boxes:UF(i),scores:UF(o)}}))}(i.boxPredictions,i.classPredictions,t.output_layer)}))},t.prototype.forward=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,x$(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),oV(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,p,h,d,m,g,v,y,b,x,w;return sV(this,(function(E){switch(E.label){case 0:return n=new FH(t),r=n.maxResults,i=n.minConfidence,[4,x$(e)];case 1:for(a=E.sent(),o=this.forwardInput(a),s=o.boxes,u=o.scores,c=s[0],l=u[0],f=1;f<s.length;f++)s[f].dispose(),u[f].dispose();return d=(h=Array).from,[4,l.data()];case 2:return p=d.apply(h,[E.sent()]),m=function(e,t,n,r,i){var a=e.shape[0],o=Math.min(n,a),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>i})).sort((function(e,t){return t.score-e.score})),u=function(e){return e<=.5?1:0},c=[];return s.forEach((function(t){if(!(c.length>=o)){for(var n=t.score,r=c.length-1;r>=0;--r){var a=OH(e,t.boxIndex,c[r]);if(0!==a&&(t.score*=u(a),t.score<=i))break}n===t.score&&c.push(t.boxIndex)}})),c}(c,p,r,0,i),g=a.getReshapedInputDimensions(0),v=a.inputSize,y=v/g.width,b=v/g.height,x=c.arraySync(),w=m.map((function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map((function(e){return e*b})),n=t[0],r=t[1],i=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map((function(e){return e*y})),o=i[0],s=i[1];return new DV(p[e],new PV(o,n,s-o,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})})),c.dispose(),l.dispose(),[2,w]}}))}))},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=function(e,t){var n=U$(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function i(e){var t="mobilenetv1/conv_"+e,i="MobilenetV1/Conv2d_"+e+"_depthwise",a=t+"/depthwise_conv",o=t+"/pointwise_conv";return{depthwise_conv:{filters:n(i+"/depthwise_weights",4,a+"/filters"),batch_norm_scale:n(i+"/BatchNorm/gamma",1,a+"/batch_norm_scale"),batch_norm_offset:n(i+"/BatchNorm/beta",1,a+"/batch_norm_offset"),batch_norm_mean:n(i+"/BatchNorm/moving_mean",1,a+"/batch_norm_mean"),batch_norm_variance:n(i+"/BatchNorm/moving_variance",1,a+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,o)}}function a(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function o(e){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!hV(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var o={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:a}};return R$(e,t),{params:o,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=q$(e),r=n.extractWeights,i=n.getRemainingWeights,a=function(e,t){function n(n,r,i,a,o){var s=LI(e(n*r*i*i),[i,i,n,r]),u=BI(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/"+(o?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,i){var a=n(e,t,r,i,!0);return{filters:a.filters,batch_norm_offset:a.bias}}function i(n,i,a){var o=function(n,r){var i=LI(e(9*n),[3,3,n,1]),a=BI(e(n)),o=BI(e(n)),s=BI(e(n)),u=BI(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:i,batch_norm_scale:a,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:u}}(n,a+"/depthwise_conv");return{depthwise_conv:o,pointwise_conv:r(n,i,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,t),o=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=o(),c=s(),l={extra_dim:PI(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)},t}(M$);function BH(e){var t=new RH;return t.extractWeights(e),t}function zH(e){return BH(e)}var PH,LH=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t}(RH),jH=[new SV(.738768,.874946),new SV(2.42204,2.65704),new SV(4.30971,7.04493),new SV(10.246,4.59428),new SV(12.6868,11.8741)],UH=[new SV(1.603231,2.094468),new SV(6.041143,7.080126),new SV(2.882459,3.518061),new SV(4.266906,5.178857),new SV(9.041765,10.66308)],qH=[117.001,114.697,97.404],WH=function(e){return"number"==typeof e};function VH(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!WH(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return WH(e.x)&&WH(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(WH)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function $H(e){return tI((function(){var t=ZL(e,RI(.10000000149011612));return PL(vU(rj(e,t)),t)}))}function HH(e,t){return tI((function(){var n=AF(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Aj(n,t.conv.filters,[1,1],"valid"),n=rj(n,t.bn.sub),n=ZL(n,t.bn.truediv),$H(n=PL(n,t.conv.bias))}))}function GH(e,t){return tI((function(){var n=AF(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Ij(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),$H(n=PL(n,t.bias))}))}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(PH||(PH={}));var KH=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),XH=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return VH(t),n._config=t,n}return iV(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=HH(e,t.conv0);return n=HH(n=Hj(n,[2,2],[2,2],"same"),t.conv1),n=HH(n=Hj(n,[2,2],[2,2],"same"),t.conv2),n=HH(n=Hj(n,[2,2],[2,2],"same"),t.conv3),n=HH(n=Hj(n,[2,2],[2,2],"same"),t.conv4),n=HH(n=Hj(n,[2,2],[2,2],"same"),t.conv5),n=HH(n=Hj(n,[2,2],[1,1],"same"),t.conv6),F$(n=HH(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?$H(F$(e,t.conv0,"valid",!1)):GH(e,t.conv0);return n=GH(n=Hj(n,[2,2],[2,2],"same"),t.conv1),n=GH(n=Hj(n,[2,2],[2,2],"same"),t.conv2),n=GH(n=Hj(n,[2,2],[2,2],"same"),t.conv3),n=GH(n=Hj(n,[2,2],[2,2],"same"),t.conv4),n=GH(n=Hj(n,[2,2],[2,2],"same"),t.conv5),n=Hj(n,[2,2],[1,1],"same"),n=t.conv6?GH(n,t.conv6):n,F$(n=t.conv7?GH(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return tI((function(){var i=e.toBatchTensor(t,!1).toFloat();return i=(i=n.config.meanRgb?OV(i,n.config.meanRgb):i).div(RI(256)),n.config.withSeparableConvs?n.runMobilenet(i,r):n.runTinyYolov2(i,r)}))},t.prototype.forward=function(e,t){return oV(this,void 0,void 0,(function(){var n;return sV(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,x$(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}}))}))},t.prototype.detect=function(e,t){return void 0===t&&(t={}),oV(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,p,h,d=this;return sV(this,(function(m){switch(m.label){case 0:return n=new KH(t),r=n.inputSize,i=n.scoreThreshold,[4,x$(e)];case 1:return a=m.sent(),[4,this.forwardInput(a,r)];case 2:return o=m.sent(),s=tI((function(){return UF(o)[0].expandDims()})),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),i)];case 3:return c=m.sent(),o.dispose(),s.dispose(),l=c.map((function(e){return e.box})),f=c.map((function(e){return e.score})),p=c.map((function(e){return e.classScore})),h=c.map((function(e){return d.config.classes[e.label]})),[2,TV(l.map((function(e){return e.rescale(r)})),f,this.config.iouThreshold,!0).map((function(e){return new kV(f[e],p[e],h[e],l[e],u)}))]}}))}))},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],i=function(e,t){var n=U$(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),i=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:i}},extractSeparableConvParams:j$(n)}}(e,r),a=i.extractConvParams,o=i.extractConvWithBatchNormParams,s=i.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:a("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:a("conv8")};return R$(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var i,a=q$(e),o=a.extractWeights,s=a.getRemainingWeights,u=[],c=function(e,t){var n=B$(e,t),r=L$(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,i,a){var o=n(r,i,3,a+"/conv"),s=function(n,r){var i=BI(e(n)),a=BI(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:i,truediv:a}}(i,a+"/bn");return{conv:o,bn:s}},extractSeparableConvParams:r}}(o,u),l=c.extractConvParams,f=c.extractConvWithBatchNormParams,p=c.extractSeparableConvParams;if(t.withSeparableConvs){var h=r[0],d=r[1],m=r[2],g=r[3],v=r[4],y=r[5],b=r[6],x=r[7],w=r[8];i={conv0:t.isFirstLayerConv2d?l(h,d,3,"conv0"):p(h,d,"conv0"),conv1:p(d,m,"conv1"),conv2:p(m,g,"conv2"),conv3:p(g,v,"conv3"),conv4:p(v,y,"conv4"),conv5:p(y,b,"conv5"),conv6:x?p(b,x,"conv6"):void 0,conv7:w?p(x,w,"conv7"):void 0,conv8:l(w||x||b,5*n,1,"conv8")}}else h=r[0],d=r[1],m=r[2],g=r[3],v=r[4],y=r[5],b=r[6],x=r[7],w=r[8],i={conv0:f(h,d,"conv0"),conv1:f(d,m,"conv1"),conv2:f(m,g,"conv2"),conv3:f(g,v,"conv3"),conv4:f(v,y,"conv4"),conv5:f(y,b,"conv5"),conv6:f(b,x,"conv6"),conv7:f(x,w,"conv7"),conv8:l(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:i,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return oV(this,void 0,void 0,(function(){var r,i,a,o,s,u,c,l,f,p,h,d,m,g,v,y,b,x,w,E,C,S,N,A,k,D,_,M,T,O=this;return sV(this,(function(I){switch(I.label){case 0:return r=t.width,i=t.height,a=Math.max(r,i),o=a/r,s=a/i,u=e.shape[1],c=this.config.anchors.length,l=tI((function(){var t=e.reshape([u,u,c,O.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,c,4]),t.slice([0,0,0,4],[u,u,c,1]),O.withClassScores?gR(t.slice([0,0,0,5],[u,u,c,O.config.classes.length]),3):RI(0)]})),f=l[0],p=l[1],h=l[2],d=[],[4,p.array()];case 1:return m=I.sent(),[4,f.array()];case 2:g=I.sent(),v=0,I.label=3;case 3:if(!(v<u))return[3,12];y=0,I.label=4;case 4:if(!(y<u))return[3,11];b=0,I.label=5;case 5:return b<c?(x=RV(m[v][y][b][0]),!n||x>n?(w=(y+RV(g[v][y][b][0]))/u*o,E=(v+RV(g[v][y][b][1]))/u*s,C=Math.exp(g[v][y][b][2])*this.config.anchors[b].x/u*o,S=Math.exp(g[v][y][b][3])*this.config.anchors[b].y/u*s,N=w-C/2,A=E-S/2,k={row:v,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(h,k)]:[3,7]):[3,9]):[3,10];case 6:return T=I.sent(),[3,8];case 7:T={classScore:1,label:0},I.label=8;case 8:_=(D=T).classScore,M=D.label,d.push(aV({box:new AV(N,A,N+C,A+S),score:x,classScore:x*_,label:M},k)),I.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return v++,[3,3];case 12:return f.dispose(),p.dispose(),h.dispose(),[2,d]}}))}))},t.prototype.extractPredictedClass=function(e,t){return oV(this,void 0,void 0,(function(){var n,r,i,a;return sV(this,(function(o){switch(o.label){case 0:return n=t.row,r=t.col,i=t.anchor,[4,e.array()];case 1:return a=o.sent(),[2,Array(this.config.classes.length).fill(0).map((function(e,t){return a[n][r][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t}))]}}))}))},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(M$),YH=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:UH,meanRgb:qH}:{anchors:jH,withClassScores:!0});return e.call(this,n)||this}return iV(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return oV(this,void 0,void 0,(function(){return sV(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new DV(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(XH);function JH(e,t){void 0===t&&(t=!0);var n=new YH(t);return n.extractWeights(e),n}var ZH=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return iV(t,e),t}(KH),QH=function(){function e(){}return e.prototype.then=function(e){return oV(this,void 0,void 0,(function(){var t;return sV(this,(function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}}))}))},e.prototype.run=function(){return oV(this,void 0,void 0,(function(){return sV(this,(function(e){throw new Error("ComposableTask - run is not implemented")}))}))},e}();function eG(e,t,n,r,i){return void 0===i&&(i=function(e){return e.alignedRect}),oV(this,void 0,void 0,(function(){var a,o,s,u,c;return sV(this,(function(l){switch(l.label){case 0:return a=e.map((function(e){return nH(e)?i(e):e.detection})),(s=r)?[3,5]:t instanceof NT?[4,E$(t,a)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,w$(t,a)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(o=s)];case 6:return c=l.sent(),o.forEach((function(e){return e instanceof NT&&e.dispose()})),[2,c]}}))}))}function tG(e,t,n,r,i){return oV(this,void 0,void 0,(function(){var a=this;return sV(this,(function(o){return[2,eG([e],t,(function(e){return oV(a,void 0,void 0,(function(){return sV(this,(function(t){return[2,n(e[0])]}))}))}),r,i)]}))}))}function nG(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var rG=function(e){function t(t,n,r,i){return e.call(this,{left:t,top:n,right:r,bottom:i},!0)||this}return iV(t,e),t}(NV);function iG(e){return tI((function(){return ZL(rj(e,RI(127.5)),RI(.0078125))}))}function aG(e,t){return tI((function(){return PL(vU(e),ZL(t,nL(vU(nL(e)))))}))}function oG(e,t,n){return void 0===n&&(n=!1),tI((function(){var r=F$(e,t.conv1,"valid");return r=aG(r,t.prelu1_alpha),r=aG(r=F$(r=Hj(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),aG(r=F$(r=n?r:Hj(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)}))}function sG(e,t,n,r,i){i.stage1=[];var a=t.map((function(t){return tI((function(){var n={scale:t},i=function(e,t){return tI((function(){var n=nG(t,e.shape.slice(1)),r=n.height,i=n.width,a=iG(hq.resizeBilinear(e,[r,i]));return xU(a,[0,2,1,3])}))}(e,t),a=Date.now(),o=function(e,t){return tI((function(){var n=oG(e,t,!0),r=F$(n,t.conv4_1,"valid"),i=EF(uU(r,3),3);return{prob:gR(rj(r,i),3),regions:F$(n,t.conv4_2,"valid")}}))}(i,r),s=o.prob,u=o.regions;return n.pnet=Date.now()-a,{scoresTensor:UF(UF(s,3)[1])[0],regionsTensor:UF(u)[0],scale:t,statsForScale:n}}))})),o=a.map((function(e){var t=e.scoresTensor,r=e.regionsTensor,a=e.scale,o=e.statsForScale,s=function(e,t,n,r){for(var i=[],a=e.arraySync(),o=0;o<e.shape[0];o++)for(var s=0;s<e.shape[1];s++)a[o][s]>=r&&i.push(new SV(s,o));return i.map((function(e){var r=new AV(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),i=a[e.y][e.x],o=t.arraySync();return{cell:r,score:i,region:new rG(o[e.y][e.x][0],o[e.y][e.x][1],o[e.y][e.x][2],o[e.y][e.x][3])}}))}(t,r,a,n);if(t.dispose(),r.dispose(),!s.length)return i.stage1.push(o),[];var u=Date.now(),c=TV(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.5);return o.nms=Date.now()-u,o.numBoxes=c.length,i.stage1.push(o),c.map((function(e){return s[e]}))})),s=o.reduce((function(e,t){return e.concat(t)}),[]),u=[],c=[];if(s.length>0){var l=Date.now(),f=TV(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.7);i.stage1_nms=Date.now()-l,c=f.map((function(e){return s[e].score})),u=f.map((function(e){return s[e]})).map((function(e){var t=e.cell,n=e.region;return new AV(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()}))}return{boxes:u,scores:c}}function uG(e,t,n){var r=n.width,i=n.height;return oV(this,void 0,void 0,(function(){var n,a,o,s=this;return sV(this,(function(u){switch(u.label){case 0:return n=i$(e),[4,Promise.all(t.map((function(t){return oV(s,void 0,void 0,(function(){var r,i,a,o,s,u,c,l;return sV(this,(function(f){return r=t.padAtBorders(e.height,e.width),i=r.y,a=r.ey,o=r.x,s=r.ex,u=o-1,c=i-1,l=n.getImageData(u,c,s-u,a-c),[2,n$.isNodejs()?m$(l):createImageBitmap(l)]}))}))})))];case 1:return a=u.sent(),o=[],a.forEach((function(e){var t=i$(d$({width:r,height:i}));t.drawImage(e,0,0,r,i);for(var n=t.getImageData(0,0,r,i).data,a=[],s=0;s<n.length;s+=4)a.push(n[s+2]),a.push(n[s+1]),a.push(n[s]);o.push(a)})),[2,o.map((function(e){return tI((function(){return iG(xU(LI(e,[1,r,i,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function cG(e,t,n,r,i){return oV(this,void 0,void 0,(function(){var a,o,s,u,c,l,f,p,h,d,m,g,v,y;return sV(this,(function(b){switch(b.label){case 0:return a=Date.now(),[4,uG(e,t,{width:24,height:24})];case 1:return o=b.sent(),i.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=o.map((function(e){var t=function(e,t){return tI((function(){var n=oG(e,t),r=aG(G$(RF(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),i=G$(r,t.fc2_1),a=EF(uU(i,1),1),o=gR(rj(i,a),1),s=G$(r,t.fc2_2);return{scores:UF(o,1)[1],regions:s}}))}(e,r);return e.dispose(),t})),i.stage2_rnet=Date.now()-a,u=s.length>1?YI(s.map((function(e){return e.scores}))):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[b.sent()]),u.dispose(),p=c.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=p.map((function(e){return t[e]})),d=p.map((function(e){return c[e]})),m=[],g=[],h.length>0&&(a=Date.now(),v=TV(h,d,.7),i.stage2_nms=Date.now()-a,y=v.map((function(e){var t=s[p[e]].regions.arraySync();return new rG(t[0][0],t[0][1],t[0][2],t[0][3])})),g=v.map((function(e){return d[e]})),m=v.map((function(e,t){return h[e].calibrate(y[t])}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose()})),[2,{boxes:m,scores:g}]}}))}))}function lG(e,t,n,r,i){return oV(this,void 0,void 0,(function(){var a,o,s,u,c,l,f,p,h,d,m,g,v,y,b;return sV(this,(function(x){switch(x.label){case 0:return a=Date.now(),[4,uG(e,t,{width:48,height:48})];case 1:return o=x.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=o.map((function(e){var t=function(e,t){return tI((function(){var n=oG(e,t);n=aG(n=F$(n=Hj(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=aG(G$(RF(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),i=G$(r,t.fc2_1),a=EF(uU(i,1),1),o=gR(rj(i,a),1),s=G$(r,t.fc2_2),u=G$(r,t.fc2_3);return{scores:UF(o,1)[1],regions:s,points:u}}))}(e,r);return e.dispose(),t})),i.stage3_onet=Date.now()-a,u=s.length>1?YI(s.map((function(e){return e.scores}))):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[x.sent()]),u.dispose(),p=c.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=p.map((function(e){var t=s[e].regions.arraySync();return new rG(t[0][0],t[0][1],t[0][2],t[0][3])})),d=p.map((function(e,n){return t[e].calibrate(h[n])})),m=p.map((function(e){return c[e]})),g=[],v=[],y=[],d.length>0&&(a=Date.now(),b=TV(d,m,.7,!1),i.stage3_nms=Date.now()-a,g=b.map((function(e){return d[e]})),v=b.map((function(e){return m[e]})),y=b.map((function(e,t){return Array(5).fill(0).map((function(n,r){var i=s[e].points.arraySync();return new SV(i[0][r]*(g[t].width+1)+g[t].left,i[0][r+5]*(g[t].height+1)+g[t].top)}))}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()})),[2,{boxes:g,scores:v,points:y}]}}))}))}var fG=function(e){function t(){return e.call(this,"Mtcnn")||this}return iV(t,e),t.prototype.load=function(t){return oV(this,void 0,void 0,(function(){return sV(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]}))}))},t.prototype.loadFromDisk=function(t){return oV(this,void 0,void 0,(function(){return sV(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]}))}))},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),oV(this,void 0,void 0,(function(){var n,r,i,a,o,s,u,c,l,f,p,h,d,m,g,v,y,b,x,w,E;return sV(this,(function(C){switch(C.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},a=Date.now(),o=tI((function(){return e=EF(IW.fromPixels(r)).toFloat(),tI((function(){return PF(UF(e,3).reverse(),3)}));var e})),s=function(e){return o.dispose(),i.total=Date.now()-a,e},u=o.shape.slice(1),c=u[0],l=u[1],f=new MH(t),p=f.minFaceSize,h=f.scaleFactor,d=f.maxNumScales,m=f.scoreThresholds,g=f.scaleSteps,v=(g||function(e,t,n){for(var r=n[0],i=n[1],a=12/e,o=[],s=Math.min(r,i)*a,u=0;s>=12;)o.push(a*Math.pow(t,u)),s*=t,u+=1;return o}(p,h,[c,l])).filter((function(e){var t=nG(e,[c,l]);return Math.min(t.width,t.height)>12})).slice(0,d),i.scales=v,i.pyramid=v.map((function(e){return nG(e,[c,l])})),y=Date.now(),[4,sG(o,v,m[0],n.pnet,i)];case 1:return b=C.sent(),i.total_stage1=Date.now()-y,b.boxes.length?(i.stage2_numInputBoxes=b.boxes.length,y=Date.now(),[4,cG(r,b.boxes,m[1],n.rnet,i)]):[2,s({results:[],stats:i})];case 2:return x=C.sent(),i.total_stage2=Date.now()-y,x.boxes.length?(i.stage3_numInputBoxes=x.boxes.length,y=Date.now(),[4,lG(r,x.boxes,m[2],n.onet,i)]):[2,s({results:[],stats:i})];case 3:return w=C.sent(),i.total_stage3=Date.now()-y,E=w.boxes.map((function(e,t){return rH(GV({},new DV(w.scores[t],new PV(e.left/l,e.top/c,e.width/l,e.height/c),{height:c,width:l})),new jV(w.points[t].map((function(t){return t.sub(new SV(e.left,e.top)).div(new SV(e.width,e.height))})),{width:e.width,height:e.height}))})),[2,s({results:E,stats:i})]}}))}))},t.prototype.forward=function(e,t){return void 0===t&&(t={}),oV(this,void 0,void 0,(function(){var n;return sV(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,x$(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}}))}))},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),oV(this,void 0,void 0,(function(){var n;return sV(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,x$(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}}))}))},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=function(e,t){var n=U$(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function i(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function a(e){return n(e,1)}function o(e){return{conv1:r(e+"/conv1"),prelu1_alpha:a(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:a(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:a(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=o("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return aV(aV({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=o("rnet"),t=i("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=i("rnet/fc2_1"),s=i("rnet/fc2_2");return aV(aV({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=o("onet"),t=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=i("onet/fc1"),u=a("onet/prelu5_alpha"),c=i("onet/fc2_1"),l=i("onet/fc2_2"),f=i("onet/fc2_3");return aV(aV({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:f})}}}(e,t),r=n.extractPNetParams,i=n.extractRNetParams,a=n.extractONetParams,o=r(),s=i(),u=a();return R$(e,t),{params:{pnet:o,rnet:s,onet:u},paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=q$(e),n=t.extractWeights,r=t.getRemainingWeights,i=[],a=function(e,t){var n=B$(e,t),r=z$(e,t);function i(n,r){var i=BI(e(n));return t.push({paramPath:r}),i}function a(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:i(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:i(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:i(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return aV(aV({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=a([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=i(128,"rnet/prelu4_alpha"),o=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return aV(aV({},e),{fc1:t,prelu4_alpha:n,fc2_1:o,fc2_2:s})},extractONetParams:function(){var e=a([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),o=i(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=i(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),f=r(256,10,"onet/fc2_3");return aV(aV({},e),{conv4:t,prelu4_alpha:o,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:f})}}}(n,i),o=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,c=o(),l=s(),f=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:f},paramMappings:i}}(e)},t}(M$),pG=[new SV(1.603231,2.094468),new SV(6.041143,7.080126),new SV(2.882459,3.518061),new SV(4.266906,5.178857),new SV(9.041765,10.66308)],hG=[117.001,114.697,97.404],dG=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:pG,meanRgb:hG,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return iV(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return oV(this,void 0,void 0,(function(){return sV(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new DV(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(XH),mG={ssdMobilenetv1:new RH,tinyFaceDetector:new dG,tinyYolov2:new YH,mtcnn:new fG,faceLandmark68Net:new hH,faceLandmark68TinyNet:new mH,faceRecognitionNet:new CH,faceExpressionNet:new Z$,ageGenderNet:new fH},gG=function(e,t){return mG.ssdMobilenetv1.locateFaces(e,t)},vG=function(e,t){return mG.tinyFaceDetector.locateFaces(e,t)},yG=function(e,t){return mG.tinyYolov2.locateFaces(e,t)},bG=function(e,t){return mG.mtcnn.forward(e,t)},xG=function(e){return mG.faceLandmark68Net.detectLandmarks(e)},wG=function(e){return mG.faceLandmark68TinyNet.detectLandmarks(e)},EG=function(e){return mG.faceRecognitionNet.computeFaceDescriptor(e)},CG=function(e){return mG.faceExpressionNet.predictExpressions(e)},SG=function(e){return mG.ageGenderNet.predictAgeAndGender(e)},NG=function(e){return mG.ssdMobilenetv1.load(e)},AG=function(e){return mG.tinyFaceDetector.load(e)},kG=function(e){return mG.mtcnn.load(e)},DG=function(e){return mG.tinyYolov2.load(e)},_G=function(e){return mG.faceLandmark68Net.load(e)},MG=function(e){return mG.faceLandmark68TinyNet.load(e)},TG=function(e){return mG.faceRecognitionNet.load(e)},OG=function(e){return mG.faceExpressionNet.load(e)},IG=function(e){return mG.ageGenderNet.load(e)},FG=NG,RG=gG,BG=xG,zG=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=r,i}return iV(t,e),t}(QH),PG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t,n=this;return sV(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,eG(e=r.sent(),this.input,(function(e){return oV(n,void 0,void 0,(function(){return sV(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return mG.faceExpressionNet.predictExpressions(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){return eH(e,t[n])}))]}}))}))},t.prototype.withAgeAndGender=function(){return new WG(this,this.input)},t}(zG),LG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t;return sV(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,tG(e,this.input,(function(e){return mG.faceExpressionNet.predictExpressions(e)}),this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,eH(e,t)]}}))}))},t.prototype.withAgeAndGender=function(){return new VG(this,this.input)},t}(zG),jG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.withAgeAndGender=function(){return new $G(this,this.input)},t.prototype.withFaceDescriptors=function(){return new KG(this,this.input)},t}(PG),UG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.withAgeAndGender=function(){return new HG(this,this.input)},t.prototype.withFaceDescriptor=function(){return new XG(this,this.input)},t}(LG),qG=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=r,i}return iV(t,e),t}(QH),WG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t,n=this;return sV(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,eG(e=r.sent(),this.input,(function(e){return oV(n,void 0,void 0,(function(){return sV(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return mG.ageGenderNet.predictAgeAndGender(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){var r=t[n],i=r.age;return kH(_H(e,r.gender,r.genderProbability),i)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new PG(this,this.input)},t}(qG),VG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t,n,r,i;return sV(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,tG(e,this.input,(function(e){return mG.ageGenderNet.predictAgeAndGender(e)}),this.extractedFaces)]:[2];case 2:return t=a.sent(),n=t.age,r=t.gender,i=t.genderProbability,[2,kH(_H(e,r,i),n)]}}))}))},t.prototype.withFaceExpressions=function(){return new LG(this,this.input)},t}(qG),$G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.withFaceExpressions=function(){return new jG(this,this.input)},t.prototype.withFaceDescriptors=function(){return new KG(this,this.input)},t}(WG),HG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.withFaceExpressions=function(){return new UG(this,this.input)},t.prototype.withFaceDescriptor=function(){return new XG(this,this.input)},t}(VG),GG=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return iV(t,e),t}(QH),KG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e;return sV(this,(function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,eG(e=t.sent(),this.input,(function(e){return Promise.all(e.map((function(e){return mG.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,t.sent().map((function(t,n){return NH(e[n],t)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new jG(this,this.input)},t.prototype.withAgeAndGender=function(){return new $G(this,this.input)},t}(GG),XG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t;return sV(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,tG(e,this.input,(function(e){return mG.faceRecognitionNet.computeFaceDescriptor(e)}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return t=n.sent(),[2,NH(e,t)]}}))}))},t.prototype.withFaceExpressions=function(){return new UG(this,this.input)},t.prototype.withAgeAndGender=function(){return new HG(this,this.input)},t}(GG),YG=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.useTinyLandmarkNet=r,i}return iV(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?mG.faceLandmark68TinyNet:mG.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(QH),JG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t,n,r,i,a=this;return sV(this,(function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),t=e.map((function(e){return e.detection})),this.input instanceof NT?[4,E$(this.input,t)]:[3,3];case 2:return r=o.sent(),[3,5];case 3:return[4,w$(this.input,t)];case 4:r=o.sent(),o.label=5;case 5:return n=r,[4,Promise.all(n.map((function(e){return a.landmarkNet.detectLandmarks(e)})))];case 6:return i=o.sent(),n.forEach((function(e){return e instanceof NT&&e.dispose()})),[2,e.map((function(e,t){return rH(e,i[t])}))]}}))}))},t.prototype.withFaceExpressions=function(){return new jG(this,this.input)},t.prototype.withAgeAndGender=function(){return new $G(this,this.input)},t.prototype.withFaceDescriptors=function(){return new KG(this,this.input)},t}(YG),ZG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t,n,r,i;return sV(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(t=e.detection,this.input instanceof NT?[4,E$(this.input,[t])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,w$(this.input,[t])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return i=a.sent(),n.forEach((function(e){return e instanceof NT&&e.dispose()})),[2,rH(e,i)]}}))}))},t.prototype.withFaceExpressions=function(){return new UG(this,this.input)},t.prototype.withAgeAndGender=function(){return new HG(this,this.input)},t.prototype.withFaceDescriptor=function(){return new XG(this,this.input)},t}(YG),QG=function(e){function t(t,n){void 0===n&&(n=new FH);var r=e.call(this)||this;return r.input=t,r.options=n,r}return iV(t,e),t}(QH),eK=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t,n,r;return sV(this,(function(i){switch(i.label){case 0:return t=(e=this).input,(n=e.options)instanceof MH?[4,mG.mtcnn.forward(t,n)]:[3,2];case 1:return[2,i.sent().map((function(e){return e.detection}))];case 2:if(r=n instanceof ZH?function(e){return mG.tinyFaceDetector.locateFaces(e,n)}:n instanceof FH?function(e){return mG.ssdMobilenetv1.locateFaces(e,n)}:n instanceof KH?function(e){return mG.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}}))}))},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise((function(t){return oV(e,void 0,void 0,(function(){var e;return sV(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map((function(e){return GV({},e)})))]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new JG(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new PG(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new WG(this.runAndExtendWithFaceDetections(),this.input)},t}(QG),tK=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iV(t,e),t.prototype.run=function(){return oV(this,void 0,void 0,(function(){var e,t;return sV(this,(function(n){switch(n.label){case 0:return[4,new eK(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach((function(e){e.score>t.score&&(t=e)})),[2,t]}}))}))},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise((function(t){return oV(e,void 0,void 0,(function(){var e;return sV(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?GV({},e):void 0)]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new ZG(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new LG(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new VG(this.runAndExtendWithFaceDetection(),this.input)},t}(QG);function nK(e,t){return void 0===t&&(t=new FH),new tK(e,t)}function rK(e,t){return void 0===t&&(t=new FH),new eK(e,t)}function iK(e,t){return oV(this,void 0,void 0,(function(){return sV(this,(function(n){switch(n.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,rK(e,new FH(t?{minConfidence:t}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))}function aK(e,t){return void 0===t&&(t={}),oV(this,void 0,void 0,(function(){return sV(this,(function(n){switch(n.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,rK(e,new KH(t)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))}function oK(e,t){return void 0===t&&(t={}),oV(this,void 0,void 0,(function(){return sV(this,(function(n){switch(n.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,rK(e,new MH(t)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))}var sK=iK;function uK(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map((function(e,t){return e-r[t]})).reduce((function(e,t){return e+Math.pow(t,2)}),0))}var cK=function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,i=function(){return"person "+r++};this._labeledDescriptors=n.map((function(e){if(e instanceof VV)return e;if(e instanceof Float32Array)return new VV(i(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new VV(i(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map((function(t){return uK(t,e)})).reduce((function(e,t){return e+t}),0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,i=n.label;return new qV(i,t.computeMeanDistance(e,r))})).reduce((function(e,t){return e.distance<t.distance?e:t}))},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new qV("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(e){return e.toJSON()}))}},e.fromJSON=function(t){var n=t.labeledDescriptors.map((function(e){return VV.fromJSON(e)}));return new e(n,t.distanceThreshold)},e}();function lK(e){var t=new fG;return t.extractWeights(e),t}function fK(e){var t=new dG;return t.extractWeights(e),t}function pK(e,t){var n=new cV(t.width,t.height),r=n.width,i=n.height;if(r<=0||i<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:i}));if(Array.isArray(e))return e.map((function(e){return pK(e,{width:r,height:i})}));if(nH(e)){var a=e.detection.forSize(r,i),o=e.unshiftedLandmarks.forSize(a.box.width,a.box.height);return rH(GV(e,a),o)}return HV(e)?GV(e,e.detection.forSize(r,i)):e instanceof LV||e instanceof DV?e.forSize(r,i):e}const hK="https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/ssd_mobilenetv1_model-weights_manifest.json",dK="https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/tiny_face_detector_model-weights_manifest.json",mK="https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_model-weights_manifest.json",gK="https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_tiny_model-weights_manifest.json",vK="https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_recognition_model-weights_manifest.json";class yK{constructor(e,t,n){this.video=e,this.model=null,this.modelReady=!1,this.detectorOptions=null,this.config={minConfidence:this.checkUndefined(t.minConfidence,.5),withLandmarks:this.checkUndefined(t.withLandmarks,true),withDescriptors:this.checkUndefined(t.withDescriptors,true),withTinyNet:this.checkUndefined(t.withTinyNet,true),MODEL_URLS:{Mobilenetv1Model:this.checkUndefined(t.Mobilenetv1Model,hK),TinyFaceDetectorModel:this.checkUndefined(t.TinyFaceDetectorModel,dK),FaceLandmarkModel:this.checkUndefined(t.FaceLandmarkModel,mK),FaceLandmark68TinyNet:this.checkUndefined(t.FaceLandmark68TinyNet,gK),FaceRecognitionModel:this.checkUndefined(t.FaceRecognitionModel,vK)}},this.ready=kA(this.loadModel(),n)}async loadModel(){const e=["Mobilenetv1Model","TinyFaceDetectorModel","FaceLandmarkModel","FaceLandmark68TinyNet","FaceRecognitionModel"];Object.keys(this.config.MODEL_URLS).forEach((t=>{e.includes(t)&&(this.config.MODEL_URLS[t]=this.getModelPath(this.config.MODEL_URLS[t]))}));const{Mobilenetv1Model:t,TinyFaceDetectorModel:n,FaceLandmarkModel:r,FaceRecognitionModel:i,FaceLandmark68TinyNet:a}=this.config.MODEL_URLS;return this.model=h,!0===this.config.withTinyNet?this.detectorOptions=new ZH({minConfidence:this.minConfidence,inputSize:512}):this.detectorOptions=new FH({minConfidence:this.minConfidence}),!0===this.config.withTinyNet?(await this.model.loadFaceLandmarkTinyModel(a),await this.model.loadTinyFaceDetectorModel(n)):(await this.model.loadFaceLandmarkModel(r),await this.model.loadSsdMobilenetv1Model(t)),await this.model.loadFaceRecognitionModel(i),this.modelReady=!0,this}async detect(e,t,n){let r,i=this.video,a=this.config;if("function"==typeof e)i=this.video,r=e;else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData)i=e;else if("object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData))i=e.elt;else if("object"==typeof e&&e.canvas instanceof HTMLCanvasElement)i=e.canvas;else if(!(this.video instanceof HTMLVideoElement))throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");return"object"==typeof t?a=t:"function"==typeof t&&(r=t),"function"==typeof n&&(r=n),kA(this.detectInternal(i,a),r)}async detectInternal(e,t){await this.ready,await m.nextFrame(),this.video&&0===this.video.readyState&&await new Promise((e=>{this.video.onloadeddata=()=>e()})),this.config=this.setReturnOptions(t);const{withLandmarks:n,withDescriptors:r}=this.config;let i;return i=n?r?await this.model.detectAllFaces(e,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors():await this.model.detectAllFaces(e,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet):n?await this.model.detectAllFaces(e,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors():await this.model.detectAllFaces(e),i=this.resizeResults(i,e.width,e.height),i=this.landmarkParts(i),i}async detectSingle(e,t,n){let r,i=this.video,a=this.config;if("function"==typeof e)i=this.video,r=e;else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData)i=e;else if("object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData))i=e.elt;else if("object"==typeof e&&e.canvas instanceof HTMLCanvasElement)i=e.canvas;else if(!(this.video instanceof HTMLVideoElement))throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");return"object"==typeof t?a=t:"function"==typeof t&&(r=t),"function"==typeof n&&(r=n),kA(this.detectSingleInternal(i,a),r)}async detectSingleInternal(e,t){await this.ready,await m.nextFrame(),this.video&&0===this.video.readyState&&await new Promise((e=>{this.video.onloadeddata=()=>e()})),this.config=this.setReturnOptions(t);const{withLandmarks:n,withDescriptors:r}=this.config;let i;return i=n?r?await this.model.detectSingleFace(e,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor():await this.model.detectSingleFace(e,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet):n?await this.model.detectSingleFace(e,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor():await this.model.detectSingleFace(e),i=this.resizeResults(i,e.width,e.height),i=this.landmarkParts(i),i}checkUndefined(e,t){return void 0!==e?e:t}getModelPath(e){return this.isAbsoluteURL(e)?e:window.location.pathname+e}setReturnOptions(e){const t=Object.assign({},this.config);return["withLandmarks","withDescriptors"].forEach((n=>{void 0!==e[n]?this.config[n]=e[n]:t[n]=this.config[n]})),t}resizeResults(e,t,n){if(void 0===t||void 0===n)throw new Error("width and height must be defined");return this.model.resizeResults(e,{width:t,height:n})}isAbsoluteURL(e){return!!new RegExp("^(?:[a-z]+:)?//","i").test(e)}landmarkParts(e){let t;if(!0===Array.isArray(e))t=e.map((e=>{const t=Object.assign({},e);if(t.landmarks){const{landmarks:e}=t;t.parts={mouth:e.getMouth(),nose:e.getNose(),leftEye:e.getLeftEye(),leftEyeBrow:e.getLeftEyeBrow(),rightEye:e.getRightEye(),rightEyeBrow:e.getRightEyeBrow(),jawOutline:e.getJawOutline()}}else t.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[],jawOutline:[]};return t}));else if(t=Object.assign({},e),t.landmarks){const{landmarks:n}=e;t.parts={mouth:n.getMouth(),nose:n.getNose(),leftEye:n.getLeftEye(),leftEyeBrow:n.getLeftEyeBrow(),rightEye:n.getRightEye(),rightEyeBrow:n.getRightEyeBrow()}}else t.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[]};return t}}class bK{constructor(e,t,n){this.config={k:t.k||3,maxIter:t.maxIter||5,threshold:t.threshold||.5},this.ready=kA(this.load(e),n)}async load(e){return this.dataset=await async function(e){let t;t="string"==typeof e?await async function(e){const t=m.data.csv(e);return await t.toArray()}(e):e;const n=t.map((e=>Object.values(e)));return n}(e),m.tidy((()=>{this.dataTensor=m.tensor2d(this.dataset),this.dataset.forEach((e=>{const t=m.tensor1d(Object.values(e));e.tensor=t})),this.centroids=m.tensor2d(((e,t,n=!1)=>{let r;if(!0===n)r=Array.from({length:t},(()=>e[Math.floor(Math.random()*e.length)]));else{if(t>e.length)throw new RangeError("Sample size must be less than or equal to array length when sampling without replacement.");r=e.map((e=>[e,Math.random()])).sort(((e,t)=>e[1]<t[1]?-1:1)).slice(0,t).map((e=>e[0]))}return r})(this.dataset,this.config.k,!1)),this.fit()})),this}fit(){this.getClosestCentroids(),this.recenterCentroids();let e=bK.getEuclidianDistance(this.centroids,this.centroidsOld),t=0;for(;e>this.config.threshold&&t<this.config.maxIter;)this.getClosestCentroids(),this.recenterCentroids(),e=bK.getEuclidianDistance(this.centroids,this.centroidsOld),t+=1}getClosestCentroids(){this.dataset.forEach((e=>{const t=this.closestCentroid(e.tensor);e.centroid=t}))}closestCentroid(e){return m.tidy((()=>this.centroids.squaredDifference(e).sum(1).sqrt().argMin().arraySync()))}classify(e){return m.tidy((()=>{const t=m.tensor1d(Object.values(e));return this.closestCentroid(t)}))}recenterCentroids(){const e=m.tidy((()=>(this.centroidsOld=this.centroids,m.stack(this.centroids.unstack().map(((e,t)=>{const n=this.dataset.filter((e=>e.centroid===t)),r=n.map((e=>e.tensor));return 0===r.length?e:1===r.length?r[0]:m.tidy((()=>m.stack(r).mean(0)))}))))));this.centroids=e}static getEuclidianDistance(e,t){return m.tidy((()=>m.squaredDifference(e,t).sum().sqrt().dataSync()))[0]}}const xK=256;class wK{constructor(e,t){this.config={modelUrl:e.modelUrl?e.modelUrl:"https://raw.githubusercontent.com/Derek-Wds/training_CartoonGAN/master/tfModels/Miyazaki/model.json",returnTensors:!!e.returnTensors&&e.returnTensors},this.model={},this.ready=!1,this.ready=kA(this.loadModel(this.config.modelUrl),t)}async loadModel(e){return this.model=await m.loadGraphModel(e),this}async generate(e,t){let n,r=t;if(rk(e))n=e;else if("object"==typeof e&&rk(e.elt))n=e.elt;else if("object"==typeof e&&rk(e.canvas))n=e.canvas;else{if("function"!=typeof e)throw new Error("Detection subject not supported");n=this.video,r=e}return kA(this.generateInternal(n),r)}async generateInternal(e){await this.ready,await m.nextFrame();let t=m.browser.fromPixels(e).resizeBilinear([xK,xK]);if(t.shape[0]!==xK||t.shape[1]!==xK)throw new Error(`Input size should be 256*256 but ${t.shape} is found`);if(3!==t.shape[2])throw new Error(`Input color channel number should be 3 but ${t.shape[2]} is found`);t=t.sub(127.5).div(127.5).reshape([1,xK,xK,3]);const n=m.ones([xK,xK,1]).tile([1,1,1]).mul(255);let r=this.model.predict(t);r=r.add(1).mul(127.5).reshape([xK,xK,3]).floor(),r=r.concat(n,2);const i=this.resultFinalize(r);return this.config.returnTensors||(t.dispose(),r.dispose()),i}async resultFinalize(e){const t=e,n=await e.data(),r=await JA.rawToBlob(n,e.shape[0],e.shape[1]),i=await JA.blobToP5Image(r);return this.config.returnTensors?{tensor:t,raw:n,blob:r,image:i}:{raw:n,blob:r,image:i}}}function EK(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function CK(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var SK=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];t.push(i)}return t},NK=function(){this.parent=null,this.children={},this.end=!1,this.word=[[],0,0]},AK=function(){function e(){this.root=new NK}return e.prototype.insert=function(e,t,n){for(var r=this.root,i=SK(e),a=0;a<i.length;a++)r.children[i[a]]||(r.children[i[a]]=new NK,r.children[i[a]].parent=r,r.children[i[a]].word[0]=r.word[0].concat(i[a])),r=r.children[i[a]],a===i.length-1&&(r.end=!0,r.word[1]=t,r.word[2]=n)},e.prototype.commonPrefixSearch=function(e){for(var t=[],n=this.root.children[e[0]],r=0;r<e.length&&n;r++)n.end&&t.push(n.word),n=n.children[e[r+1]];return t.length||t.push([[e[0]],0,0]),t},e}(),kK=function(){function e(e,t){void 0===t&&(t=6),this.vocabulary=e,this.reservedSymbolsCount=t,this.trie=new AK;for(var n=this.reservedSymbolsCount;n<this.vocabulary.length;n++)this.trie.insert(this.vocabulary[n][0],this.vocabulary[n][1],n)}return e.prototype.encode=function(e){var t=[],n=[],r=[];e=function(e){var t=e.normalize("NFKC");return t.length>0?""+t.replace(/ /g,""):t}(e);for(var i=SK(e),a=0;a<=i.length;a++)t.push({}),n.push(0),r.push(0);for(a=0;a<i.length;a++)for(var o=this.trie.commonPrefixSearch(i.slice(a)),s=0;s<o.length;s++){var u=o[s],c={key:u[0],score:u[1],index:u[2]};null==t[a+(l=u[0].length)][a]&&(t[a+l][a]=[]),t[a+l][a].push(c)}for(var l=0;l<=i.length;l++)for(var f in t[l]){var p=t[l][f];for(s=0;s<p.length;s++){var h=p[s],d=h.score+r[l-h.key.length];(0===r[l]||d>=r[l])&&(r[l]=d,n[l]=p[s].index)}}for(var m=[],g=n.length-1;g>0;)m.push(n[g]),g-=this.vocabulary[n[g]][0].length;var v=[],y=!1;for(a=0;a<m.length;a++){var b=m[a];y&&0===b||v.push(b),y=0===b}return v.reverse()},e}();function DK(e){return EK(this,void 0,void 0,(function(){return CK(this,(function(t){switch(t.label){case 0:return[4,OA.util.fetch(e)];case 1:return[2,t.sent().json()]}}))}))}var _K="https://tfhub.dev/google/tfjs-model/universal-sentence-encoder-qa-ondevice/1",MK=[0,1,2],TK=192;!function(){function e(){}e.prototype.loadModel=function(){return EK(this,void 0,void 0,(function(){return CK(this,(function(e){return[2,(0,TA.loadGraphModel)(_K,{fromTFHub:!0})]}))}))},e.prototype.load=function(){return EK(this,void 0,void 0,(function(){var e,t,n;return CK(this,(function(r){switch(r.label){case 0:return[4,Promise.all([this.loadModel(),DK(_K+"/vocab.json?tfjs-format=file")])];case 1:return e=r.sent(),t=e[0],n=e[1],this.model=t,this.tokenizer=new kK(n,3),[2]}}))}))},e.prototype.embed=function(e){var t=this,n=(0,OA.tidy)((function(){var n=t.tokenizeStrings(e.queries,TK),r=t.tokenizeStrings(e.responses,TK);if(null!=e.contexts&&e.contexts.length!==e.responses.length)throw new Error("The length of response strings and context strings need to match.");var i=e.contexts||[];null==e.contexts&&(i.length=e.responses.length,i.fill(""));var a=t.tokenizeStrings(i,TK),o={};return o.input_inp_text=n,o.input_res_text=r,o.input_res_context=a,t.model.execute(o,["Final/EncodeQuery/mul","Final/EncodeResult/mul"])}));return{queryEmbedding:n[0],responseEmbedding:n[1]}},e.prototype.tokenizeStrings=function(e,t){var n=this,r=e.map((function(e){return n.shiftTokens(n.tokenizer.encode(e),TK)}));return(0,OA.tensor2d)(r,[e.length,TK],"int32")},e.prototype.shiftTokens=function(e,t){e.unshift(1);for(var n=0;n<t;n++)n>=e.length?e[n]=2:MK.includes(e[n])||(e[n]+=3);return e.slice(0,t)}}();var OK=function(){function e(){}return e.prototype.loadModel=function(e){return EK(this,void 0,void 0,(function(){return CK(this,(function(t){return[2,e?(0,TA.loadGraphModel)(e):(0,TA.loadGraphModel)("https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",{fromTFHub:!0})]}))}))},e.prototype.load=function(e){return void 0===e&&(e={}),EK(this,void 0,void 0,(function(){var t,n,r;return CK(this,(function(i){switch(i.label){case 0:return[4,Promise.all([this.loadModel(e.modelUrl),DK(e.vocabUrl||"https://storage.googleapis.com/tfjs-models/savedmodel/universal_sentence_encoder/vocab.json")])];case 1:return t=i.sent(),n=t[0],r=t[1],this.model=n,this.tokenizer=new kK(r),[2]}}))}))},e.prototype.embed=function(e){return EK(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,u,c=this;return CK(this,(function(l){switch(l.label){case 0:for("string"==typeof e&&(e=[e]),t=e.map((function(e){return c.tokenizer.encode(e)})),n=t.map((function(e,t){return e.map((function(e,n){return[t,n]}))})),r=[],i=0;i<n.length;i++)r=r.concat(n[i]);return a=(0,OA.tensor2d)(r,[r.length,2],"int32"),o=(0,OA.tensor1d)(OA.util.flatten(t),"int32"),s={indices:a,values:o},[4,this.model.executeAsync(s)];case 1:return u=l.sent(),a.dispose(),o.dispose(),[2,u]}}))}))},e}();class IK{constructor(e,t){this.model=null,this.tokenizer=null,this.config={withTokenizer:e.withTokenizer||false},kA(this.loadModel(),t)}async loadModel(){return!0===this.config.withTokenizer&&(this.tokenizer=await function(e){return EK(this,void 0,void 0,(function(){var e;return CK(this,(function(t){switch(t.label){case 0:return[4,DK(undefined)];case 1:return e=t.sent(),[2,new kK(e)]}}))}))}()),this.model=await function(e){return EK(this,void 0,void 0,(function(){var e;return CK(this,(function(t){switch(t.label){case 0:return[4,(e=new OK).load(undefined)];case 1:return t.sent(),[2,e]}}))}))}(),this}predict(e,t){return kA(this.predictInternal(e),t)}async predictInternal(e){try{const t=await this.model.embed(e),n=await t.array();return t.dispose(),n}catch(e){return console.error(e),e}}encode(e,t){return kA(this.encodeInternal(e),t)}async encodeInternal(e){return!0===this.config.withTokenizer?this.tokenizer.encode(e):(console.error('withTokenizer must be set to true - please pass "withTokenizer:true" as an option in the constructor'),!1)}}const FK=e=>({startEndTensor:e,startPoint:(0,OA.slice)(e,[0,0],[-1,2]),endPoint:(0,OA.slice)(e,[0,2],[-1,2])}),RK={strides:[8,16],anchors:[2,6]};function BK(e,t){let n,r,i;if(e.topLeft instanceof OA.Tensor&&e.bottomRight instanceof OA.Tensor){const[a,o]=(0,OA.tidy)((()=>[(0,OA.concat)([(0,OA.sub)(t-1,e.topLeft.slice(0,1)),e.topLeft.slice(1,1)]),(0,OA.concat)([(0,OA.sub)(t-1,e.bottomRight.slice(0,1)),e.bottomRight.slice(1,1)])]));n=a,r=o,null!=e.landmarks&&(i=(0,OA.tidy)((()=>{const n=(0,OA.sub)((0,OA.tensor1d)([t-1,0]),e.landmarks),r=(0,OA.tensor1d)([1,-1]);return(0,OA.mul)(n,r)})))}else{const[a,o]=e.topLeft,[s,u]=e.bottomRight;n=[t-1-a,o],r=[t-1-s,u],null!=e.landmarks&&(i=e.landmarks.map((e=>[t-1-e[0],e[1]])))}const a={topLeft:n,bottomRight:r};return null!=i&&(a.landmarks=i),null!=e.probability&&(a.probability=e.probability instanceof OA.Tensor?e.probability.clone():e.probability),a}function zK(e,t){return(0,OA.tidy)((()=>{let n;return n=e.hasOwnProperty("box")?e.box:e,((e,t)=>{const n=(0,OA.mul)(e.startPoint,t),r=(0,OA.mul)(e.endPoint,t),i=(0,OA.concat2d)([n,r],1);return FK(i)})(n,t).startEndTensor.squeeze()}))}class PK{constructor(e,t,n,r,i,a){this.blazeFaceModel=e,this.width=t,this.height=n,this.maxFaces=r,this.anchorsData=function(e,t,n){const r=[];for(let i=0;i<n.strides.length;i++){const a=n.strides[i],o=Math.floor((t+a-1)/a),s=Math.floor((e+a-1)/a),u=n.anchors[i];for(let e=0;e<o;e++){const t=a*(e+.5);for(let e=0;e<s;e++){const n=a*(e+.5);for(let e=0;e<u;e++)r.push([n,t])}}}return r}(t,n,RK),this.anchors=(0,OA.tensor2d)(this.anchorsData),this.inputSizeData=[t,n],this.inputSize=(0,OA.tensor1d)([t,n]),this.iouThreshold=i,this.scoreThreshold=a}async getBoundingBoxes(e,t,n=!0){const[r,i,a]=(0,OA.tidy)((()=>{const t=e.resizeBilinear([this.width,this.height]),n=(0,OA.mul)((0,OA.sub)(t.div(255),.5),2),r=this.blazeFaceModel.predict(n).squeeze(),i=function(e,t,n){const r=(0,OA.slice)(e,[0,1],[-1,2]),i=(0,OA.add)(r,t),a=(0,OA.slice)(e,[0,3],[-1,2]),o=(0,OA.div)(a,n),s=(0,OA.div)(i,n),u=(0,OA.div)(o,2),c=(0,OA.sub)(s,u),l=(0,OA.add)(s,u),f=(0,OA.mul)(c,n),p=(0,OA.mul)(l,n);return(0,OA.concat2d)([f,p],1)}(r,this.anchors,this.inputSize),a=(0,OA.slice)(r,[0,0],[-1,1]);return[r,i,(0,OA.sigmoid)(a).squeeze()]})),o=console.warn;console.warn=()=>{};const s=OA.image.nonMaxSuppression(i,a,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=o;const u=await s.array();s.dispose();let c=u.map((e=>(0,OA.slice)(i,[e,0],[1,-1])));t||(c=await Promise.all(c.map((async e=>{const t=await e.array();return e.dispose(),t}))));const l=e.shape[1],f=e.shape[2];let p;p=t?(0,OA.div)([f,l],this.inputSize):[f/this.inputSizeData[0],l/this.inputSizeData[1]];const h=[];for(let e=0;e<c.length;e++){const i=c[e],o=(0,OA.tidy)((()=>{const o=FK(i instanceof OA.Tensor?i:(0,OA.tensor2d)(i));if(!n)return o;const s=u[e];let c;return c=t?this.anchors.slice([s,0],[1,2]):this.anchorsData[s],{box:o,landmarks:(0,OA.slice)(r,[s,5],[1,-1]).squeeze().reshape([6,-1]),probability:(0,OA.slice)(a,[s],[1]),anchor:c}}));h.push(o)}return i.dispose(),a.dispose(),r.dispose(),{boxes:h,scaleFactor:p}}async estimateFaces(e,t=!1,n=!1,r=!0){const[,i]=function(e){return e instanceof OA.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}(e),a=(0,OA.tidy)((()=>(e instanceof OA.Tensor||(e=OA.browser.fromPixels(e)),e.toFloat().expandDims(0)))),{boxes:o,scaleFactor:s}=await this.getBoundingBoxes(a,t,r);return a.dispose(),t?o.map((e=>{const t=zK(e,s);let a={topLeft:t.slice([0],[2]),bottomRight:t.slice([2],[2])};if(r){const{landmarks:t,probability:n,anchor:r}=e,i=t.add(r).mul(s);a.landmarks=i,a.probability=n}return n&&(a=BK(a,i)),a})):Promise.all(o.map((async e=>{const t=zK(e,s);let a;if(r){const[n,r,i]=await Promise.all([e.landmarks,t,e.probability].map((async e=>e.array()))),o=e.anchor,[u,c]=s,l=n.map((e=>[(e[0]+o[0])*u,(e[1]+o[1])*c]));a={topLeft:r.slice(0,2),bottomRight:r.slice(2),landmarks:l,probability:i},(e=>{e.startEndTensor.dispose(),e.startPoint.dispose(),e.endPoint.dispose()})(e.box),e.landmarks.dispose(),e.probability.dispose()}else{const e=await t.array();a={topLeft:e.slice(0,2),bottomRight:e.slice(2)}}return t.dispose(),n&&(a=BK(a,i)),a})))}}const LK={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function jK(e){null!=e&&null!=e.startPoint&&(e.startEndTensor.dispose(),e.startPoint.dispose(),e.endPoint.dispose())}function UK(e,t,n){return{startEndTensor:e,startPoint:null!=t?t:(0,OA.slice)(e,[0,0],[-1,2]),endPoint:null!=n?n:(0,OA.slice)(e,[0,2],[-1,2])}}function qK(e){return(0,OA.tidy)((()=>{const t=(0,OA.sub)(e.endPoint,e.startPoint);return(0,OA.abs)(t)}))}function WK(e,t=1.5){return(0,OA.tidy)((()=>{const n=function(e){return(0,OA.tidy)((()=>{const t=(0,OA.div)((0,OA.sub)(e.endPoint,e.startPoint),2);return(0,OA.add)(e.startPoint,t)}))}(e),r=qK(e),i=(0,OA.mul)((0,OA.div)(r,2),t),a=(0,OA.sub)(n,i),o=(0,OA.add)(n,i);return UK((0,OA.concat2d)([a,o],1),a,o)}))}class VK{constructor(e,t,n,r,i,a){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=e,this.meshDetector=t,this.meshWidth=n,this.meshHeight=r,this.maxContinuousChecks=i,this.maxFaces=a}async predict(e){if(this.shouldUpdateRegionsOfInterest()){const t=!0,n=!1,{boxes:r,scaleFactor:i}=await this.boundingBoxDetector.getBoundingBoxes(e,t,n);if(0===r.length)return i.dispose(),this.clearAllRegionsOfInterest(),null;const a=r.map((e=>WK(function(e,t){const n=(0,OA.mul)(e.startPoint,t),r=(0,OA.mul)(e.endPoint,t);return UK((0,OA.concat2d)([n,r],1))}(e,i))));r.forEach(jK),this.updateRegionsOfInterest(a),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;return(0,OA.tidy)((()=>this.regionsOfInterest.map(((t,n)=>{const r=function(e,t,n){const r=t.shape[1],i=t.shape[2],a=e.startEndTensor;return(0,OA.tidy)((()=>{const e=(0,OA.concat2d)([a.slice([0,1],[-1,1]),a.slice([0,0],[-1,1]),a.slice([0,3],[-1,1]),a.slice([0,2],[-1,1])],0),o=(0,OA.div)(e.transpose(),[r,i,r,i]);return OA.image.cropAndResize(t,o,[0],n)}))}(t,e,[this.meshHeight,this.meshWidth]).div(255),[,i,a]=this.meshDetector.predict(r),o=(0,OA.reshape)(a,[-1,3]),s=(0,OA.div)(qK(t),[this.meshWidth,this.meshHeight]),u=(0,OA.mul)(o,s.concat((0,OA.tensor2d)([1],[1,1]),1)).add(t.startPoint.concat((0,OA.tensor2d)([0],[1,1]),1)),c=this.calculateLandmarksBoundingBox(u);return jK(this.regionsOfInterest[n]),this.regionsOfInterest[n]=c,{coords:o,scaledCoords:u,box:c,flag:i.squeeze()}}))))}updateRegionsOfInterest(e){for(let t=0;t<e.length;t++){const n=e[t],r=this.regionsOfInterest[t];let i=0;if(r&&r.startPoint){const[e,t,a,o]=n.startEndTensor.arraySync()[0],[s,u,c,l]=r.startEndTensor.arraySync()[0],f=Math.max(e,s),p=Math.max(t,u),h=(Math.min(a,c)-f)*(Math.min(o,l)-p);i=h/((a-e)*(o-t)+(c-s)*(l-t)-h)}i>.25?jK(n):(this.regionsOfInterest[t]=n,jK(r))}for(let t=e.length;t<this.regionsOfInterest.length;t++)jK(this.regionsOfInterest[t]);this.regionsOfInterest=this.regionsOfInterest.slice(0,e.length)}clearRegionOfInterest(e){null!=this.regionsOfInterest[e]&&(jK(this.regionsOfInterest[e]),this.regionsOfInterest=[...this.regionsOfInterest.slice(0,e),...this.regionsOfInterest.slice(e+1)])}clearAllRegionsOfInterest(){for(let e=0;e<this.regionsOfInterest.length;e++)jK(this.regionsOfInterest[e]);this.regionsOfInterest=[]}shouldUpdateRegionsOfInterest(){const e=this.regionsOfInterest.length,t=0===e;return 1===this.maxFaces||t?t:e!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}calculateLandmarksBoundingBox(e){const t=e.slice([0,0],[468,1]),n=e.slice([0,1],[468,1]);return WK(UK((0,OA.stack)([t.min(),n.min(),t.max(),n.max()]).expandDims(0)))}}const $K=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]];async function HK(e,t,n){return async function({maxFaces:e=10,inputWidth:t=128,inputHeight:n=128,iouThreshold:r=.3,scoreThreshold:i=.75}={}){const a=await(0,TA.loadGraphModel)("https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",{fromTFHub:!0});return new PK(a,t,n,e,r,i)}({maxFaces:e,iouThreshold:t,scoreThreshold:n})}async function GK(){return(0,TA.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",{fromTFHub:!0})}function KK(e,t){if(e.mesh instanceof OA.Tensor){const[n,r,i,a]=(0,OA.tidy)((()=>{const n=(0,OA.tensor1d)([t-1,0,0]),r=(0,OA.tensor1d)([1,-1,1]);return(0,OA.tidy)((()=>[(0,OA.concat)([(0,OA.sub)(t-1,e.boundingBox.topLeft.slice(0,1)),e.boundingBox.topLeft.slice(1,1)]),(0,OA.concat)([(0,OA.sub)(t-1,e.boundingBox.bottomRight.slice(0,1)),e.boundingBox.bottomRight.slice(1,1)]),(0,OA.sub)(n,e.mesh).mul(r),(0,OA.sub)(n,e.scaledMesh).mul(r)]))}));return Object.assign({},e,{boundingBox:{topLeft:n,bottomRight:r},mesh:i,scaledMesh:a})}return Object.assign({},e,{boundingBox:{topLeft:[t-1-e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]],bottomRight:[t-1-e.boundingBox.bottomRight[0],e.boundingBox.bottomRight[1]]},mesh:e.mesh.map((e=>{const n=e.slice(0);return n[0]=t-1-e[0],n})),scaledMesh:e.scaledMesh.map((e=>{const n=e.slice(0);return n[0]=t-1-e[0],n}))})}class XK{constructor(e,t,n,r,i){this.pipeline=new VK(e,t,192,192,n,i),this.detectionConfidence=r}static getAnnotations(){return LK}static getUVCoords(){return $K}async estimateFaces(e,t=!1,n=!1){const[,r]=function(e){return e instanceof OA.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}(e),i=(0,OA.tidy)((()=>(e instanceof OA.Tensor||(e=OA.browser.fromPixels(e)),e.toFloat().expandDims(0)))),a=(0,OA.env)().get("WEBGL_PACK_DEPTHWISECONV");(0,OA.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const o=await this.pipeline.predict(i);return(0,OA.env)().set("WEBGL_PACK_DEPTHWISECONV",a),i.dispose(),null!=o&&o.length>0?Promise.all(o.map((async(e,i)=>{const{coords:a,scaledCoords:o,box:s,flag:u}=e;let c=[u];t||(c=c.concat([a,o,s.startPoint,s.endPoint]));const l=await Promise.all(c.map((async e=>e.array()))),f=l[0];if(u.dispose(),f<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(i),t){const e={faceInViewConfidence:f,mesh:a,scaledMesh:o,boundingBox:{topLeft:s.startPoint.squeeze(),bottomRight:s.endPoint.squeeze()}};return n?KK(e,r):e}const[p,h,d,m]=l.slice(1);o.dispose(),a.dispose();let g={faceInViewConfidence:f,boundingBox:{topLeft:d,bottomRight:m},mesh:p,scaledMesh:h};n&&(g=KK(g,r));const v={};for(const e in LK)v[e]=LK[e].map((e=>g.scaledMesh[e]));return g.annotations=v,g}))):[]}}class YK extends vD.EventEmitter{constructor(e,t,n){super(),this.video=e,this.model=null,this.modelReady=!1,this.config=t,this.ready=kA(this.loadModel(),n)}async loadModel(){return this.model=await async function({maxContinuousChecks:e=5,detectionConfidence:t=.9,maxFaces:n=10,iouThreshold:r=.3,scoreThreshold:i=.75}={}){const[a,o]=await Promise.all([HK(n,r,i),GK()]);return new XK(a,o,e,t,n)}(this.config),this.modelReady=!0,this.video&&0===this.video.readyState&&await new Promise((e=>{this.video.onloadeddata=()=>{e()}})),this.predict(),this}async predict(e,t){const n=this.getInput(e),{flipHorizontal:r}=this.config,i=await this.model.estimateFaces(n,r);return this.emit("predict",i),this.video?m.nextFrame().then((()=>this.predict())):("function"==typeof t&&t(i),i)}getInput(e){let t;return t=e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"==typeof e&&e.canvas instanceof HTMLCanvasElement?e.canvas:this.video,t}}function JK(e){return[Math.abs(e.endPoint[0]-e.startPoint[0]),Math.abs(e.endPoint[1]-e.startPoint[1])]}function ZK(e){return[e.startPoint[0]+(e.endPoint[0]-e.startPoint[0])/2,e.startPoint[1]+(e.endPoint[1]-e.startPoint[1])/2]}function QK(e,t=1.5){const n=ZK(e),r=JK(e),i=[t*r[0]/2,t*r[1]/2];return{startPoint:[n[0]-i[0],n[1]-i[1]],endPoint:[n[0]+i[0],n[1]+i[1]],palmLandmarks:e.palmLandmarks}}function eX(e){const t=ZK(e),n=JK(e),r=Math.max(...n)/2;return{startPoint:[t[0]-r,t[1]-r],endPoint:[t[0]+r,t[1]+r],palmLandmarks:e.palmLandmarks}}function tX(e,t){const n=[e.endPoint[0]-e.startPoint[0],e.endPoint[1]-e.startPoint[1]],r=[n[0]*t[0],n[1]*t[1]];return{startPoint:[e.startPoint[0]+r[0],e.startPoint[1]+r[1]],endPoint:[e.endPoint[0]+r[0],e.endPoint[1]+r[1]],palmLandmarks:e.palmLandmarks}}class nX{constructor(e,t,n,r,i,a){this.model=e,this.width=t,this.height=n,this.iouThreshold=i,this.scoreThreshold=a,this.anchors=r.map((e=>[e.x_center,e.y_center])),this.anchorsTensor=(0,OA.tensor2d)(this.anchors),this.inputSizeTensor=(0,OA.tensor1d)([t,n]),this.doubleInputSizeTensor=(0,OA.tensor1d)([2*t,2*n])}normalizeBoxes(e){return(0,OA.tidy)((()=>{const t=(0,OA.slice)(e,[0,0],[-1,2]),n=(0,OA.slice)(e,[0,2],[-1,2]),r=(0,OA.add)((0,OA.div)(t,this.inputSizeTensor),this.anchorsTensor),i=(0,OA.div)(n,this.doubleInputSizeTensor),a=(0,OA.mul)((0,OA.sub)(r,i),this.inputSizeTensor),o=(0,OA.mul)((0,OA.add)(r,i),this.inputSizeTensor);return(0,OA.concat2d)([a,o],1)}))}normalizeLandmarks(e,t){return(0,OA.tidy)((()=>{const n=(0,OA.add)((0,OA.div)(e.reshape([-1,7,2]),this.inputSizeTensor),this.anchors[t]);return(0,OA.mul)(n,this.inputSizeTensor)}))}getBoundingBoxes(e){return(0,OA.tidy)((()=>{const t=(0,OA.mul)((0,OA.sub)(e,.5),2),n=(0,OA.env)().get("WEBGL_PACK_DEPTHWISECONV");(0,OA.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const r=this.model.predict(t).squeeze();(0,OA.env)().set("WEBGL_PACK_DEPTHWISECONV",n);const i=(0,OA.sigmoid)((0,OA.slice)(r,[0,0],[-1,1])).squeeze(),a=(0,OA.slice)(r,[0,1],[-1,4]),o=this.normalizeBoxes(a),s=console.warn;console.warn=()=>{};const u=OA.image.nonMaxSuppression(o,i,1,this.iouThreshold,this.scoreThreshold).arraySync();if(console.warn=s,0===u.length)return null;const c=u[0],l=(0,OA.slice)(o,[c,0],[1,-1]),f=(0,OA.slice)(r,[c,5],[1,14]);return{boxes:l,palmLandmarks:this.normalizeLandmarks(f,c).reshape([-1,2])}}))}estimateHandBounds(e){const t=e.shape[1],n=e.shape[2],r=(0,OA.tidy)((()=>e.resizeBilinear([this.width,this.height]).div(255))),i=this.getBoundingBoxes(r);if(null===i)return r.dispose(),null;const a=i.boxes.arraySync(),o=a[0].slice(0,2),s=a[0].slice(2,4),u=i.palmLandmarks.arraySync();return r.dispose(),i.boxes.dispose(),i.palmLandmarks.dispose(),function(e,t){return{startPoint:[e.startPoint[0]*t[0],e.startPoint[1]*t[1]],endPoint:[e.endPoint[0]*t[0],e.endPoint[1]*t[1]],palmLandmarks:e.palmLandmarks.map((e=>[e[0]*t[0],e[1]*t[1]]))}}({startPoint:o,endPoint:s,palmLandmarks:u},[n/this.width,t/this.height])}}const rX={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};const iX=(e,t)=>[[1,0,e],[0,1,t],[0,0,1]];function aX(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n}function oX(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e[r][t]);return n}function sX(e,t){const n=[],r=e.length;for(let i=0;i<r;i++){n.push([]);for(let a=0;a<r;a++)n[i].push(aX(e[i],oX(t,a)))}return n}function uX(e,t){const n=Math.cos(e),r=Math.sin(e),i=[[n,-r,0],[r,n,0],[0,0,1]];return sX(sX(iX(t[0],t[1]),i),iX(-t[0],-t[1]))}function cX(e,t){return[aX(e,t[0]),aX(e,t[1])]}const lX=[0,-.4],fX=[0,-.1],pX=[0,5,9,13,17,1,2];class hX{constructor(e,t,n,r,i,a){this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.boundingBoxDetector=e,this.meshDetector=t,this.maxContinuousChecks=i,this.detectionConfidence=a,this.meshWidth=n,this.meshHeight=r,this.maxHandsNumber=1}getBoxForPalmLandmarks(e,t){const n=e.map((e=>cX([...e,1],t)));return QK(eX(tX(this.calculateLandmarksBoundingBox(n),lX)),3)}getBoxForHandLandmarks(e){const t=QK(eX(tX(this.calculateLandmarksBoundingBox(e),fX)),1.65),n=[];for(let t=0;t<pX.length;t++)n.push(e[pX[t]].slice(0,2));return t.palmLandmarks=n,t}transformRawCoords(e,t,n,r){const i=JK(t),a=[i[0]/this.meshWidth,i[1]/this.meshHeight],o=e.map((e=>[a[0]*(e[0]-this.meshWidth/2),a[1]*(e[1]-this.meshHeight/2),e[2]])),s=uX(n,[0,0]),u=o.map((e=>[...cX(e,s),e[2]])),c=function(e){const t=[[e[0][0],e[1][0]],[e[0][1],e[1][1]]],n=[e[0][2],e[1][2]],r=[-aX(t[0],n),-aX(t[1],n)];return[t[0].concat(r[0]),t[1].concat(r[1]),[0,0,1]]}(r),l=[...ZK(t),1],f=[aX(l,c[0]),aX(l,c[1])];return u.map((e=>[e[0]+f[0],e[1]+f[1],e[2]]))}async estimateHand(e){const t=this.shouldUpdateRegionsOfInterest();if(!0===t){const t=this.boundingBoxDetector.estimateHandBounds(e);if(null===t)return e.dispose(),this.regionsOfInterest=[],null;this.updateRegionsOfInterest(t,!0),this.runsWithoutHandDetector=0}else this.runsWithoutHandDetector++;const n=this.regionsOfInterest[0],r=function(e,t){return function(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}(Math.PI/2-Math.atan2(-(t[1]-e[1]),t[0]-e[0]))}(n.palmLandmarks[0],n.palmLandmarks[2]),i=ZK(n),a=[i[0]/e.shape[2],i[1]/e.shape[1]];let o;const s=(0,OA.getBackend)();if("webgl"===s)o=function(e,t,n,r){const i=e.shape,a=i[1],o=i[2],s=Math.sin(t),u=Math.cos(t),c=Math.floor(o*("number"==typeof r?r:r[0])),l=Math.floor(a*("number"==typeof r?r:r[1]));let f="";const p={variableNames:["Image"],outputShape:i,userCode:`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int x = coords[2];\n        int y = coords[1];\n        int coordX = int(float(x - ${c}) * ${u} -\n          float(y - ${l}) * ${s});\n        int coordY = int(float(x - ${c}) * ${s} +\n          float(y - ${l}) * ${u});\n        coordX = int(coordX + ${c});\n        coordY = int(coordY + ${l});\n\n        ${f=`float outputValue = ${(0).toFixed(2)};`}\n\n        if(coordX > 0 && coordX < ${o} && coordY > 0 && coordY < ${a}) {\n          outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n        }\n\n      setOutput(outputValue);\n    }`};return(0,OA.backend)().compileAndRun(p,[e])}(e,r,0,a);else{if("cpu"!==s)throw new Error(`Handpose is not yet supported by the ${s} backend - rotation kernel is not defined.`);o=function(e,t,n,r){const i=(0,OA.backend)(),a=(0,OA.buffer)(e.shape,e.dtype),[o,s,u,c]=e.shape,l=u*("number"==typeof r?r:r[0]),f=s*("number"==typeof r?r:r[1]),p=Math.sin(-t),h=Math.cos(-t),d=i.readSync(e.dataId);for(let e=0;e<o;e++)for(let t=0;t<s;t++)for(let n=0;n<u;n++)for(let r=0;r<c;r++){const i=[o,t,n,r],m=i[2],g=i[1];let v=(m-l)*h-(g-f)*p,y=(m-l)*p+(g-f)*h;v=Math.round(v+l),y=Math.round(y+f);let b=0;v>=0&&v<u&&y>=0&&y<s&&(b=d[e*u*s*c+y*(u*c)+v*c+r]);const x=e*u*s*c+t*(u*c)+n*c+r;a.values[x]=b}return a.toTensor()}(e,r,0,a)}const u=uX(-r,i);let c;const l=function(e,t,n){const r=t.shape[1],i=t.shape[2],a=[[e.startPoint[1]/r,e.startPoint[0]/i,e.endPoint[1]/r,e.endPoint[0]/i]];return OA.image.cropAndResize(t,a,[0],n)}(c=!0===t?this.getBoxForPalmLandmarks(n.palmLandmarks,u):n,o,[this.meshWidth,this.meshHeight]),f=l.div(255);l.dispose(),o.dispose();const p=(0,OA.env)().get("WEBGL_PACK_DEPTHWISECONV");(0,OA.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const[h,d]=this.meshDetector.predict(f);(0,OA.env)().set("WEBGL_PACK_DEPTHWISECONV",p),f.dispose();const m=h.dataSync()[0];if(h.dispose(),m<this.detectionConfidence)return d.dispose(),this.regionsOfInterest=[],null;const g=(0,OA.reshape)(d,[-1,3]),v=g.arraySync();d.dispose(),g.dispose();const y=this.transformRawCoords(v,c,r,u),b=this.getBoxForHandLandmarks(y);return this.updateRegionsOfInterest(b,!1),{landmarks:y,handInViewConfidence:m,boundingBox:{topLeft:b.startPoint,bottomRight:b.endPoint}}}calculateLandmarksBoundingBox(e){const t=e.map((e=>e[0])),n=e.map((e=>e[1]));return{startPoint:[Math.min(...t),Math.min(...n)],endPoint:[Math.max(...t),Math.max(...n)]}}updateRegionsOfInterest(e,t){if(t)this.regionsOfInterest=[e];else{const t=this.regionsOfInterest[0];let n=0;if(null!=t&&null!=t.startPoint){const[r,i]=e.startPoint,[a,o]=e.endPoint,[s,u]=t.startPoint,[c,l]=t.endPoint,f=Math.max(r,s),p=Math.max(i,u),h=(Math.min(a,c)-f)*(Math.min(o,l)-p);n=h/((a-r)*(o-i)+(c-s)*(l-i)-h)}this.regionsOfInterest[0]=n>.8?t:e}}shouldUpdateRegionsOfInterest(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks}}async function dX(){return(0,TA.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})}async function mX(){return(0,TA.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})}async function gX(){return OA.util.fetch("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then((e=>e.json()))}class vX{constructor(e){this.pipeline=e}static getAnnotations(){return rX}async estimateHands(e,t=!1){const[,n]=function(e){return e instanceof OA.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}(e),r=(0,OA.tidy)((()=>(e instanceof OA.Tensor||(e=OA.browser.fromPixels(e)),e.toFloat().expandDims(0)))),i=await this.pipeline.estimateHand(r);if(r.dispose(),null===i)return[];let a=i;!0===t&&(a=function(e,t){const{handInViewConfidence:n,landmarks:r,boundingBox:i}=e;return{handInViewConfidence:n,landmarks:r.map((e=>[t-1-e[0],e[1],e[2]])),boundingBox:{topLeft:[t-1-i.topLeft[0],i.topLeft[1]],bottomRight:[t-1-i.bottomRight[0],i.bottomRight[1]]}}}(i,n));const o={};for(const e of Object.keys(rX))o[e]=rX[e].map((e=>a.landmarks[e]));return[{handInViewConfidence:a.handInViewConfidence,boundingBox:a.boundingBox,landmarks:a.landmarks,annotations:o}]}}class yX extends vD.EventEmitter{constructor(e,t,n){super(),this.video=e,this.model=null,this.modelReady=!1,this.config=t,this.ready=kA(this.loadModel(),n)}async loadModel(){return this.model=await async function({maxContinuousChecks:e=1/0,detectionConfidence:t=.8,iouThreshold:n=.3,scoreThreshold:r=.5}={}){const[i,a,o]=await Promise.all([gX(),dX(),mX()]),s=new nX(a,256,256,i,n,r),u=new hX(s,o,256,256,e,t);return new vX(u)}(this.config),this.modelReady=!0,this.video&&0===this.video.readyState&&await new Promise((e=>{this.video.onloadeddata=()=>{e()}})),this.predict(),this}async predict(e,t){const n=this.getInput(e);if(!n)return[];const{flipHorizontal:r}=this.config,i=await this.model.estimateHands(n,r);return this.emit("predict",i),this.video?m.nextFrame().then((()=>this.predict())):("function"==typeof t&&t(i),i)}getInput(e){let t;return t=e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof ImageData)?e.elt:"object"==typeof e&&e.canvas instanceof HTMLCanvasElement?e.canvas:this.video,t}}const bX=()=>{console.log("\n\n Thank you for using ml5.js v0.8.0 \n\nPlease read our community statement to ensure \nthat the use of this software reflects the values \nof the ml5.js community:\n https://ml5js.org/about\n\nReporting: \n https://github.com/ml5js/ml5-library/issues\n Email: info@ml5js.org \n")},xX=async()=>{const e=new Image;return e.crossOrigin="",e.src="https://cdn.jsdelivr.net/gh/ml5js/ml5-library@main/assets/bird.jpg",await new Promise((t=>{e.onload=t})),e},wX=async()=>{const e=new Uint8ClampedArray(2e4);for(let t=0;t<e.length;t+=4)e[t+0]=0,e[t+1]=190,e[t+2]=0,e[t+3]=255;return new ImageData(e,200)},EX={charRNN:(e="./",t)=>new A_(e,t),CVAE:(e,t)=>new I_(e,t),cartoon:(e,t)=>{const n="object"==typeof e?e:{},r="function"==typeof e?e:t;return"string"==typeof e&&(n.modelUrl=e),new wK(n,r)},DCGAN:(e,t,n)=>{let r,i={};if("string"!=typeof e)throw new Error('Please specify a path to a "manifest.json" file: \n\n         "models/face/manifest.json" \n\n\n         This "manifest.json" file should include:\n\n         {\n            "description": "DCGAN, human faces, 64x64",\n            "model": "https://raw.githubusercontent.com/viztopia/ml5dcgan/master/model/model.json", // "https://github.com/viztopia/ml5dcgan/blob/master/model/model.json",\n            "modelSize": 64,\n            "modelLatentDim": 128 \n         }\n         ');"function"==typeof t?r=t:"object"==typeof t&&(i=t,r=n);const a=new F_(e,i,r);return r?a:a.ready},featureExtractor:(e,t,n)=>{let r;if("string"!=typeof e)throw new Error('Please specify a model to use. E.g: "MobileNet"');r=e.toLowerCase();let i={},a=n;if("object"==typeof t?i=t:"function"==typeof t&&(a=t),"mobilenet"===r)return new class{constructor(e,t){this.mobilenet=null,this.topKPredictions=10,this.hasAnyTrainedClass=!1,this.customModel=null,this.jointModel=null,this.config={epochs:e.epochs||20,version:e.version||1,hiddenUnits:e.hiddenUnits||100,numLabels:e.numLabels||2,learningRate:e.learningRate||1e-4,batchSize:e.batchSize||.4,layer:e.layer||"conv_pw_13_relu",alpha:e.alpha||.25},this.model=null,this.url=tD[this.config.version][this.config.alpha],this.normalizationOffset=m.scalar(127.5),this.mobilenetURL=e.mobilenetURL||`https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v${this.config.version}_${this.config.alpha}_224/model.json`,this.graphModelURL=e.graphModelURL||this.url,this.isPredicting=!1,this.mapStringToIndex=[],this.usageType=null,this.ready=kA(this.loadModel(),t)}async loadModel(){this.mobilenet=await m.loadLayersModel(this.mobilenetURL),this.graphModelURL.includes("https://tfhub.dev/")?this.model=await m.loadGraphModel(this.graphModelURL,{fromTFHub:!0}):this.model=await m.loadGraphModel(this.graphModelURL,{fromTFHub:!1});const e=this.mobilenet.getLayer(this.config.layer);return this.mobilenetFeatures=await m.model({inputs:this.mobilenet.inputs,outputs:e.output}),this.video&&await this.mobilenetFeatures.predict(nk(this.video,eD)),this}classification(e,t=null,n){let r;return this.usageType="classifier","object"==typeof t?Object.assign(this.config,t):"function"==typeof t&&(r=t),"function"==typeof n&&(r=n),e&&kA(this.loadVideo(e),r),this}regression(e,t){return this.usageType="regressor",e&&kA(this.loadVideo(e),t),this}async loadVideo(e){let t=null;if(e instanceof HTMLVideoElement?t=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement&&(t=e.elt),t){const e=new Zk(t,Qk);this.video=await e.loadVideo()}return this}async addImage(e,t,n){let r,i,a=n;return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e.elt instanceof ImageData?r=e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData)?r=e.elt:"string"!=typeof e&&"number"!=typeof e||(r=this.video,i=e),"string"==typeof t||"number"==typeof t?i=t:"function"==typeof t&&(a=t),"string"==typeof i&&(i=this.mapStringToIndex.includes(i)?this.mapStringToIndex.indexOf(i):this.mapStringToIndex.push(i)-1),kA(this.addImageInternal(r,i),a)}async addImageInternal(e,t){return await this.ready,m.tidy((()=>{const n=nk(e,eD),r=this.mobilenetFeatures.predict(n);let i;if("classifier"===this.usageType?i=m.tidy((()=>m.oneHot(m.tensor1d([t],"int32"),this.config.numLabels))):"regressor"===this.usageType&&(i=m.tensor2d([[t]])),null==this.xs)this.xs=m.keep(r),this.ys=m.keep(i),this.hasAnyTrainedClass=!0;else{const e=this.xs;this.xs=m.keep(e.concat(r,0));const t=this.ys;this.ys=m.keep(t.concat(i,0)),e.dispose(),t.dispose(),i.dispose()}})),this}async train(e){if(!this.hasAnyTrainedClass)throw new Error("Add some examples before training!");this.isPredicting=!1,"classifier"===this.usageType?(this.loss="categoricalCrossentropy",this.customModel=m.sequential({layers:[m.layers.flatten({inputShape:[7,7,256]}),m.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),m.layers.dense({units:this.config.numLabels,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]})):"regressor"===this.usageType&&(this.loss="meanSquaredError",this.customModel=m.sequential({layers:[m.layers.flatten({inputShape:[7,7,256]}),m.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),m.layers.dense({units:1,useBias:!1,kernelInitializer:"Zeros",activation:"linear"})]})),this.jointModel=m.sequential(),this.jointModel.add(this.mobilenetFeatures),this.jointModel.add(this.customModel);const t=m.train.adam(this.config.learningRate);this.customModel.compile({optimizer:t,loss:this.loss});const n=Math.floor(this.xs.shape[0]*this.config.batchSize);if(!(n>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");return this.customModel.fit(this.xs,this.ys,{batchSize:n,epochs:this.config.epochs,callbacks:{onBatchEnd:async(t,n)=>{e(n.loss.toFixed(5)),await m.nextFrame()},onTrainEnd:()=>e(null)}})}async classify(e,t){let n,r;return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?n=e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData)?n=e.elt:"function"==typeof e&&(n=this.video,r=e),"function"==typeof t&&(r=t),kA(this.classifyInternal(n),r)}async classifyInternal(e){if("classifier"!==this.usageType)throw new Error("Mobilenet Feature Extraction has not been set to be a classifier.");await m.nextFrame(),this.isPredicting=!0;const t=m.tidy((()=>{const t=nk(e,eD),n=this.jointModel.predict(t);return Array.from(n.as1D().dataSync())})),n=await t.map(((e,t)=>({label:this.mapStringToIndex.length>0&&this.mapStringToIndex[t]?this.mapStringToIndex[t]:t,confidence:e}))).sort(((e,t)=>t.confidence-e.confidence));return n}async predict(e,t){let n,r;return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData?n=e:"object"==typeof e&&(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData)?n=e.elt:"function"==typeof e&&(n=this.video,r=e),"function"==typeof t&&(r=t),kA(this.predictInternal(n),r)}async predictInternal(e){if("regressor"!==this.usageType)throw new Error("Mobilenet Feature Extraction has not been set to be a regressor.");await m.nextFrame(),this.isPredicting=!0;const t=m.tidy((()=>{const t=nk(e,eD);return this.jointModel.predict(t).as1D()})),n=await t.data();return t.dispose(),{value:n[0]}}async load(e=null,t){if("string"!=typeof e){let t=null,n=null;Array.from(e).forEach((e=>{if(e.name.includes(".json")){t=e;const n=new FileReader;n.onload=e=>{JSON.parse(e.target.result).ml5Specs&&(this.mapStringToIndex=JSON.parse(e.target.result).ml5Specs.mapStringToIndex)},n.readAsText(e)}else e.name.includes(".bin")&&(n=e)})),this.jointModel=await m.loadLayersModel(m.io.browserFiles([t,n]))}else{const n=(await MA().get(e)).data;n.ml5Specs&&(this.mapStringToIndex=n.ml5Specs.mapStringToIndex),this.jointModel=await m.loadLayersModel(e),t&&t()}return this.jointModel}async save(e,t){if(!this.jointModel)throw new Error("No model found.");this.jointModel.save(m.io.withSaveHandler((async n=>{let r="model";t&&(r=t),this.weightsManifest={modelTopology:n.modelTopology,weightsManifest:[{paths:[`./${r}.weights.bin`],weights:n.weightSpecs}],ml5Specs:{mapStringToIndex:this.mapStringToIndex}},await Yk(n.weightData,`${r}.weights.bin`,"application/octet-stream"),await Yk(JSON.stringify(this.weightsManifest),`${r}.json`,"text/plain"),e&&e()})))}mobilenetInfer(e,t=!1){let n=e;return n instanceof m.Tensor||n instanceof ImageData||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement?m.tidy((()=>{n instanceof m.Tensor||(n=m.browser.fromPixels(n));const e=n.toFloat().sub(this.normalizationOffset).div(this.normalizationOffset);let r=e;if(n.shape[0]!==Qk||n.shape[1]!==Qk){const t=!0;r=m.image.resizeBilinear(e,eD,t)}const i=r.reshape([-1,Qk,Qk,3]);let a;if(t){const e=nD[this.config.version];a=this.model.execute(i,e).squeeze([1,2])}else a=this.model.predict(i).slice([0,1],[-1,1e3]);return a})):null}infer(e,t){let n,r;if(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof ImageData)n=e;else{if("object"!=typeof e||!(e.elt instanceof HTMLImageElement||e.elt instanceof HTMLVideoElement||e.elt instanceof HTMLCanvasElement||e.elt instanceof ImageData))throw new Error("No input image found.");n=e.elt}return r=t&&"string"==typeof t?t:"conv_preds",this.mobilenetInfer(n,r)}}(i,a);throw new Error(`${r} is not a valid model.`)},imageClassifier:(e,t,n,r)=>{let i,a={},o=r,s=e;if("string"!=typeof s)throw new Error('Please specify a model to use. E.g: "MobileNet"');-1===s.indexOf("http")&&(s=e.toLowerCase()),t instanceof HTMLVideoElement?i=t:"object"==typeof t&&t.elt instanceof HTMLVideoElement?i=t.elt:"object"==typeof t?a=t:"function"==typeof t&&(o=t),"object"==typeof n?a=n:"function"==typeof n&&(o=n);const u=new ck(s,i,a,o);return o?u:u.ready},kmeans:(e,t,n)=>new bK(e,t,n),soundClassifier:(e,t,n)=>{let r={},i=n,a=e;if("string"!=typeof a)throw new Error('Please specify a model to use. E.g: "SpeechCommands18w"');-1===a.indexOf("http")&&(a=e.toLowerCase()),"object"==typeof t?r=t:"function"==typeof t&&(i=t);const o=new Hk(a,r,i);return i?o:o.ready},pitchDetection:(e="./",t,n,r)=>new DA(e,t,n,r),pix2pix:(e,t)=>{const n=new D_(e,t);return t?n:n.ready},poseNet:(e,t,n)=>{let r,i={},a=n,o=null;return e instanceof HTMLVideoElement?r=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"==typeof e?i=e:"function"==typeof e&&(a=e),"object"==typeof t?i=t:"string"==typeof t&&(o=t),"function"==typeof t&&(a=t),new y_(r,i,o,a)},sketchRNN:(e,t,n=!0)=>new T_(e,t,n),styleTransfer:(e,t,n)=>{let r=n;"function"==typeof t&&(r=t);const i=new w_(e,t,r);return r?i:i.ready},word2vec:()=>{console.log("%cword2vec has been disabled","color: #A155FF; font-size: 16px"),console.log("We've intentionally disabled the word2vec function after recognizing it has the potential to produce harmful outputs while using the model files included in our examples. We'll consider reenabling the word2vec function along with changes to address these issues in a future release of ml5.js. You can find further updates about this topic on our Twitter account (https://twitter.com/ml5js/status/1445762321444315147) and GitHub (https://github.com/ml5js/ml5-library/issues/1238).")},YOLO:lD,CocoSsd:mD,objectDetector:(e,t,n,r)=>{let i,a={},o=r,s=e;if("string"!=typeof s)throw new Error('Please specify a model to use. E.g: "YOLO"');-1===s.indexOf("http")&&(s=e.toLowerCase()),t instanceof HTMLVideoElement?i=t:"object"==typeof t&&t.elt instanceof HTMLVideoElement?i=t.elt:"object"==typeof t?a=t:"function"==typeof t&&(o=t),"object"==typeof n?a=n:"function"==typeof n&&(o=n);const u=new gD(s,i,a,o);return u.model.callback?u.model:u.model.ready},uNet:(e,t,n)=>{let r=null,i={},a=n;return e instanceof HTMLVideoElement?r=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement?r=e.elt:"function"==typeof e?a=e:"object"==typeof e&&(i=e),"object"==typeof t?i=t:"function"==typeof t&&(a=t),new O_(r,i,a)},sentiment:(e,t)=>new B_(e,t),bodyPix:(e,t,n)=>{let r,i={},a=n;e instanceof HTMLVideoElement?r=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"==typeof e?i=e:"function"==typeof e&&(a=e),"object"==typeof t?i=t:"function"==typeof t&&(a=t);const o=new nM(r,i,a);return a?o:o.ready},faceApi:(e,t,n)=>{let r,i={},a=n;e instanceof HTMLVideoElement?r=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"==typeof e?i=e:"function"==typeof e&&(a=e),"object"==typeof t?(i=t,console.log(i)):"function"==typeof t&&(a=t);const o=new yK(r,i,a);return a?o:o.ready},universalSentenceEncoder:(e,t)=>new IK("object"==typeof e?e:{},"function"==typeof e?e:t),facemesh:(e,t,n)=>{let r,i={},a=n;e instanceof HTMLVideoElement?r=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"==typeof e?i=e:"function"==typeof e&&(a=e),"object"==typeof t?i=t:"function"==typeof t&&(a=t);const o=new YK(r,i,a);return a?o:o.ready},handpose:(e,t,n)=>{let r,i={},a=n;e instanceof HTMLVideoElement?r=e:"object"==typeof e&&e.elt instanceof HTMLVideoElement?r=e.elt:"object"==typeof e?i=e:"function"==typeof e&&(a=e),"object"==typeof t?i=t:"function"==typeof t&&(a=t);const o=new yX(r,i,a);return a?o:o.ready}};bX();const CX=Object.assign({p5Utils:JA},function(e){if("undefined"==typeof window)return e;if(void 0===window.p5)return e;if(void 0===window.p5.prototype)return e;if(void 0===window.p5.prototype.registerPreloadMethod)return e;const t=e;return Object.keys(e).forEach((n=>{const r=e[n];t[n]=function(...t){let n=null,i=t.length;return"function"==typeof t[i-1]&&(n=t[i-1],i-=1),r.apply(e,[...t.slice(0,i),function(){const e="_decrementPreload";try{n&&n()}catch(e){console.error(e)}return window[e]?window[e]():null}])},window.p5.prototype.registerPreloadMethod(`${n}`,e)})),e}(EX),{KNNClassifier:()=>new Jk,communityStatement:bX,...u,tf:m,tfvis:AA,version:R_,neuralNetwork:(e,t,n)=>{let r,i;return e instanceof Object?(r=e,i=t):(r={inputs:e,outputs:t},i=n),new sM(r,i)},testingUtils:d});class SX{constructor(e){this.buff=e,this.turtle={},this.home()}home(){this.turtle.x=this.buff.width/2,this.turtle.y=this.buff.height/2,this.turtle.angle=0,this.turtle.pen=!0,this.turtle.pencolor="Black",this.turtle.penwidth=1}pencolor(e){this.turtle.pencolor=e}pensize(e){this.turtle.penwidth=e}pendown(){this.turtle.pen=!0}penup(){this.turtle.pen=!1}setposition(e,t){this.turtle.x=e,this.turtle.y=t}position(){return[this.turtle.x,this.turtle.y]}left(e){this.turtle.angle-=e}right(e){this.turtle.angle+=e}setheading(e){this.turtle.angle=e}heading(){return this.turtle.angle}forward(e){var t=this._angleMode;this.buff.angleMode(this.buff.DEGREES);var n=this.turtle.x+e*this.buff.cos(this.turtle.angle-90),r=this.turtle.y+e*this.buff.sin(this.turtle.angle-90);this.buff.angleMode(t),this.turtle.pen&&(this.buff.push(),this.buff.strokeWeight(this.turtle.penwidth),this.buff.stroke(this.turtle.pencolor),this.buff.line(this.turtle.x,this.turtle.y,n,r),this.buff.pop()),this.turtle.x=n,this.turtle.y=r}back(e){this.forward(-e)}circle(e){this.turtle.pen&&(this.buff.push(),this.buff.strokeWeight(this.turtle.penwidth),this.buff.stroke(this.turtle.pencolor),this.buff.circle(this.turtle.x,this.turtle.y,e),this.buff.pop())}}var NX=p5.prototype.circle;p5.prototype.circle=function(){NX&&(1!==arguments.length?NX.call(this,...arguments):this.getDefaultTurtle().circle(arguments[0]))},p5.prototype.createTurtle=function(){return new SX(this)},p5.prototype.getDefaultTurtle=function(){return this.defaultTurtle||(this.defaultTurtle=this.createTurtle()),this.defaultTurtle},p5.prototype.home=function(){this.getDefaultTurtle().home()},p5.prototype.pencolor=function(e){this.getDefaultTurtle().pencolor(e)},p5.prototype.pensize=function(e){this.getDefaultTurtle().pensize(e)},p5.prototype.pendown=function(){this.getDefaultTurtle().pendown()},p5.prototype.penup=function(){this.getDefaultTurtle().penup()},p5.prototype.setposition=function(e,t){this.getDefaultTurtle().setposition(e,t)},p5.prototype.position=function(){return this.getDefaultTurtle().position()},p5.prototype.left=function(e){this.getDefaultTurtle().left(e)},p5.prototype.right=function(e){this.getDefaultTurtle().right(e)},p5.prototype.setheading=function(e){this.getDefaultTurtle().setheading(e)},p5.prototype.heading=function(){return this.getDefaultTurtle().heading()},p5.prototype.forward=function(e){this.getDefaultTurtle().forward(e)},p5.prototype.back=function(e){this.getDefaultTurtle().back(e)};var AX=ix,kX=lx,DX=ax,_X=rx,MX=cx;const TX=p5;var OX=function(){function e(t){if(this.isComplex=!1,"number"==typeof t)this.tensor=m.scalar(t);else if(t instanceof Array)this.tensor=m.tensor(t);else if(t instanceof TX.Vector){var n=t.array();this.tensor=m.tensor(n)}else if(t instanceof e)this.tensor=t.tensor;else{if(!(t instanceof m.Tensor))throw new Error("Tensors must be created from Numbers, Arrays, or p5.Vectors.");this.tensor=t}this.shape=this.tensor.shape}return e.prototype.toString=function(){return this.tensor.toString()},e.prototype.print=function(){this.tensor.print()},e.prototype.array=function(){return function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){return function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(e){switch(e.label){case 0:return[4,this.tensor.array()];case 1:return[2,e.sent()]}}))}))},e.prototype.arraySync=function(){return this.tensor.arraySync()},e.prototype.toVector=function(){var e=JSON.stringify(this.shape);if("[2]"===e||"[3]"===e){var t=this.arraySync();return TX.prototype.createVector().set(t)}throw new Error("Tensor cannot be represented as a 3D vector.")},e.prototype.toScalar=function(){switch(JSON.stringify(this.shape)){case"[]":return this.arraySync();case"[1]":return this.arraySync()[0];default:throw new Error("Tensor cannot be represented as a scalar.")}},e.prototype.dispose=function(){this.tensor.dispose()},e.prototype.equals=function(t){var n=this;if(t instanceof e){if(t.isComplex&&this.isComplex)return this.complexEquals(t);if(t.isComplex||this.isComplex)throw new Error("Both tensors must be either real or complex.")}var r=!1;return m.tidy((function(){var i=new e(t);if(n.tensor.rank!==i.tensor.rank)throw new Error("Both tensors must have the same rank.");1===m.all(n.tensor.equal(i.tensor)).arraySync()&&(r=!0)})),r},e.prototype.real=function(){var t=this;if(!this.isComplex)throw new Error("Tensor must be complex to use this method.");return new e(m.tidy((function(){return m.real(t.tensor)})))},e.prototype.imag=function(){var t=this;if(!this.isComplex)throw new Error("Tensor must be complex to use this method.");return new e(m.tidy((function(){return m.imag(t.tensor)})))},e.prototype.complexEquals=function(e){var t=this,n=!1;return m.tidy((function(){var r=t.real().equals(e.real()),i=t.imag().equals(e.imag());r&&i&&(n=!0)})),n},e.prototype.add=function(t){var n=this,r=m.tidy((function(){var r=new e(t);return n.tensor.add(r.tensor)})),i=new e(r);return t instanceof e&&this.isComplex&&t.isComplex&&(i.isComplex=!0),i},e.prototype.sub=function(t){var n=this,r=m.tidy((function(){var r=new e(t);return n.tensor.sub(r.tensor)})),i=new e(r);return t instanceof e&&this.isComplex&&t.isComplex&&(i.isComplex=!0),i},e.prototype.mult=function(t){var n=this,r=m.tidy((function(){var r=new e(t);return n.tensor.mul(r.tensor)})),i=new e(r);return t instanceof e&&this.isComplex&&t.isComplex&&(i.isComplex=!0),i},e.prototype.div=function(t){var n=this,r=m.tidy((function(){var r=new e(t);return n.tensor.div(r.tensor)})),i=new e(r);return t instanceof e&&this.isComplex&&t.isComplex&&(i.isComplex=!0),i},e.prototype.dot=function(t){var n=this,r=m.tidy((function(){var r=new e(t);return n.tensor.dot(r.tensor)}));return new e(r)},e.prototype.abs=function(){var t=this;return new e(m.tidy((function(){return t.tensor.abs()})))},e.prototype.ceil=function(){var t=this;return new e(m.tidy((function(){return t.tensor.ceil()})))},e.prototype.constrain=function(t,n){var r=this;return new e(m.tidy((function(){return r.tensor.clipByValue(t,n)})))},e.prototype.exp=function(){var t=this;return new e(m.tidy((function(){return t.tensor.exp()})))},e.prototype.floor=function(){var t=this;return new e(m.tidy((function(){return t.tensor.floor()})))},e.prototype.log=function(){var t=this;return new e(m.tidy((function(){return t.tensor.log()})))},e.prototype.max=function(){var e,t=this;return m.tidy((function(){var n=m.max(t.tensor);e=n.arraySync()})),e},e.prototype.min=function(){var e,t=this;return m.tidy((function(){var n=m.min(t.tensor);e=n.arraySync()})),e},e.prototype.mod=function(t){var n=this,r=m.tidy((function(){var r=new e(t);return n.tensor.mod(r.tensor)}));return new e(r)},e.prototype.pow=function(t){var n=this,r=m.tidy((function(){var r=new e(t);return n.tensor.pow(r.tensor)}));return new e(r)},e.prototype.round=function(){var t=this;return new e(m.tidy((function(){return t.tensor.round()})))},e.prototype.sq=function(){var t=this;return new e(m.tidy((function(){return t.tensor.square()})))},e.prototype.sqrt=function(){var t=this;return new e(m.tidy((function(){return t.tensor.sqrt()})))},e.prototype.sum=function(t){var n=this;return new e(m.tidy((function(){return n.tensor.sum(t)})))},e.prototype.acos=function(){var t=this;return new e(m.tidy((function(){return t.tensor.acos()})))},e.prototype.asin=function(){var t=this;return new e(m.tidy((function(){return t.tensor.asin()})))},e.prototype.atan=function(){var t=this;return new e(m.tidy((function(){return t.tensor.atan()})))},e.prototype.atan2=function(t){var n=this,r=m.tidy((function(){var r=new e(t);return n.tensor.atan2(r.tensor)}));return new e(r)},e.prototype.cos=function(){var t=this;return new e(m.tidy((function(){return t.tensor.cos()})))},e.prototype.sin=function(){var t=this;return new e(m.tidy((function(){return t.tensor.sin()})))},e.prototype.tan=function(){var t=this;return new e(m.tidy((function(){return t.tensor.tan()})))},e.complex=function(t,n){var r=m.tidy((function(){var r,i;if("number"==typeof t&&"number"==typeof n)r=m.tensor(t),i=m.tensor(n);else{if(!(t instanceof e&&n instanceof e))throw new Error("Components must be either Numbers or Tensors");r=m.clone(t.tensor),i=m.clone(n.tensor)}return m.complex(r,i)})),i=new e(r);return i.isComplex=!0,i},e.prototype.copy=function(){var t=this;return new e(m.tidy((function(){return t.tensor.clone()})))},e.eye=function(t,n){return new e(m.tidy((function(){return m.eye(t,n)})))},e.fill=function(t,n){return new e(m.tidy((function(){return m.fill(t,n)})))},e.linspace=function(t,n,r){return new e(m.tidy((function(){return m.linspace(t,n,r)})))},e.ones=function(t){return new e(m.tidy((function(){return m.ones(t)})))},e.random=function(t){return new e(m.tidy((function(){return m.randomUniform(t)})))},e.randomGaussian=function(t,n,r){return new e(m.tidy((function(){return m.randomNormal(t,n,r)})))},e.range=function(t,n,r){return new e(m.tidy((function(){return m.range(t,n,r)})))},e.zeros=function(t){return new e(m.tidy((function(){return m.zeros(t)})))},e.prototype.flatten=function(){var t=this;return new e(m.tidy((function(){return t.tensor.flatten()})))},e.prototype.pad=function(t,n){var r=this;return new e(m.tidy((function(){return r.tensor.pad(t,n)})))},e.prototype.reshape=function(t){var n=this;return new e(m.tidy((function(){return n.tensor.reshape(t)})))},e.prototype.concat=function(t,n){var r=this,i=m.tidy((function(){var i=[r.tensor];if(t instanceof e)i.push(t.tensor);else if(Array.isArray(t)){var a=t.map((function(e){return e.tensor}));Array.prototype.push.apply(i,a)}return m.concat(i,n)}));return new e(i)},e.prototype.reverse=function(t){var n=this;return new e(m.tidy((function(){return n.tensor.reverse(t)})))},e.prototype.slice=function(t,n){var r=this;return new e(m.tidy((function(){return r.tensor.slice(t,n)})))},e.prototype.split=function(t,n){var r=this;return m.tidy((function(){return r.tensor.split(t,n)})).map((function(t){return new e(t)}))},e.stack=function(t,n){var r=m.tidy((function(){for(var e=new Array(t.length),r=0;r<t.length;r+=1)e[r]=t[r].tensor;return m.stack(e,n)}));return new e(r)},e.prototype.unstack=function(t){var n=this;return m.tidy((function(){return n.tensor.unstack(t)})).map((function(t){return new e(t)}))},e.prototype.addRows=function(t,n,r){var i=this;return void 0===r&&(r=1),new e(m.tidy((function(){if(2!==i.shape.length)throw new Error("Elementary row operations are only defined on matrices.");var e=i.tensor.slice(0,t),a=i.tensor.slice(t,1),o=i.tensor.slice(n,1),s=i.tensor.slice(t+1,i.shape[0]-t-1);return a=a.add(o.mul(r)),e.concat([a,s])})))},e.prototype.subRows=function(t,n,r){var i=this;return void 0===r&&(r=1),new e(m.tidy((function(){if(2!==i.shape.length)throw new Error("Elementary row operations are only defined on matrices.");var e=i.tensor.slice(0,t),a=i.tensor.slice(t,1),o=i.tensor.slice(n,1),s=i.tensor.slice(t+1,i.shape[0]-t-1);return a=a.sub(o.mul(r)),e.concat([a,s])})))},e.prototype.swapRows=function(t,n){var r=this,i=Math.min(t,n),a=Math.max(t,n);return new e(m.tidy((function(){if(2!==r.shape.length)throw new Error("Elementary row operations are only defined on matrices.");var e=r.tensor.slice(0,i),t=r.tensor.slice(i,1),n=r.tensor.slice(i+1,a-i-1),o=r.tensor.slice(a,1),s=r.tensor.slice(a+1,r.shape[0]-a-1);return e.concat([o,n,t,s])})))},e.prototype.mulRow=function(t,n){var r=this;return new e(m.tidy((function(){if(2!==r.shape.length)throw new Error("Elementary row operations are only defined on matrices.");var e=r.tensor.slice(0,t),i=r.tensor.slice(t,1),a=r.tensor.slice(t+1,r.shape[0]-t-1);return i=i.mul(n),e.concat([i,a])})))},e}(),IX=function(e){return new OX(e)},FX=function(e,t){return e.add(t)},RX=function(e,t){return e.sub(t)},BX=function(e,t){return e.mult(t)},zX=function(e,t){return e.div(t)},PX=function(e,t){return e.dot(t)},LX=function(e){return e.abs()},jX=function(e){return e.ceil()},UX=function(e,t,n){return e.constrain(t,n)},qX=function(e){return e.exp()},WX=function(e){return e.floor()},VX=function(e){return e.log()},$X=function(e){return e.max()},HX=function(e){return e.min()},GX=function(e,t){return e.mod(t)},KX=function(e,t){return e.pow(t)},XX=function(e){return e.round()},YX=function(e){return e.sq()},JX=function(e){return e.sqrt()},ZX=function(e,t){return e.sum(t)},QX=function(e){return e.acos()},eY=function(e){return e.asin()},tY=function(e){return e.atan()},nY=function(e,t){return e.atan2(t)},rY=function(e){return e.cos()},iY=function(e){return e.sin()},aY=function(e){return e.tan()},oY=function(e,t){return OX.complex(e,t)},sY=function(e){return e.copy()},uY=function(e,t){return OX.eye(e,t)},cY=function(e,t){return OX.fill(e,t)},lY=function(e,t,n){return OX.linspace(e,t,n)},fY=function(e){return OX.ones(e)},pY=function(e){return OX.random(e)},hY=function(e,t,n){return OX.randomGaussian(e,t,n)},dY=function(e,t,n){return OX.range(e,t,n)},mY=function(e){return OX.zeros(e)},gY=function(e){return e.flatten()},vY=function(e,t,n){return e.pad(t,n)},yY=function(e,t){return e.reshape(t)},bY=function(e,t){if(e.length<2)throw new Error("Two or more tensors must be provided.");var n=e[0],r=e.slice(1);return n.concat(r,t)},xY=function(e,t){return e.reverse(t)},wY=function(e,t,n){return e.slice(t,n)},EY=function(e,t,n){return e.split(t,n)},CY=function(e,t){return OX.stack(e,t)},SY=function(e,t){return e.unstack(t)},NY=function(e){var t=e.shape[e.shape.length-1],n=e.tensor.topk(t,!0),r=n.values;return n.indices.dispose(),new OX(r)},AY=m.memory,kY=m.tidy,DY=function(){return m.engine().startScope()},_Y=function(){return m.engine().endScope()},MY=function(e){e instanceof OX?m.keep(e.tensor):e instanceof Array&&e.forEach((function(e){return m.keep(e.tensor)}))},TY=function(e){e instanceof OX?e.dispose():e instanceof Array&&e.forEach((function(e){return e.dispose()}))},OY=function(e,t){return IX(m.browser.fromPixels(e.canvas,t))},IY=function(e){var t=e.tensor.shape,n=t[0],r=t[1],i=t[2],a=TX.prototype.createImage(r,n),o=e.tensor.toInt(),s=o.as3D(n,r,i);return m.browser.toPixels(s,a.canvas).then((function(){return o.dispose(),s.dispose(),a}))},FY=function(e){return e.max()-e.min()},RY=function(e,t){var n=FY(e);if(t instanceof Array){var r=[];return t.forEach((function(e){if(e<0||e>100)throw new Error("Percentile must be in the range [0, 100].");r.push(n*(e/100))})),r}if(t<0||t>100)throw new Error("Percentile must be in the range [0, 100].");return n*(t/100)},BY=function(e,t){var n=FY(e);if(t instanceof Array){var r=[];return t.forEach((function(e){if(e<0||e>1)throw new Error("Quantile must be in the range [0, 1].");r.push(n*e)})),r}if(t<0||t>1)throw new Error("Quantile must be in the range [0, 1].");return n*t},zY=function(e,t,n){var r=e.tensor.mean(t,n);return new OX(r)},PY=function(e,t){if(t instanceof OX){var n=e.mult(t),r=n.sum(),i=t.sum(),a=r.div(i);return n.dispose(),r.dispose(),i.dispose(),a}return zY(e)},LY=function(e){var t=m.tidy((function(){var t=zY(e),n=e.sub(t).sq().sum(),r=e.shape.reduce((function(e,t){return e*t}));return n.div(r).sqrt().tensor}));return new OX(t)},jY=function(e){var t=LY(e),n=t.sq();return t.dispose(),n};p5.prototype.createTensor=IX,p5.prototype.registerMethod("init",DY),p5.prototype.registerMethod("pre",DY),p5.prototype.registerMethod("post",_Y),p5.prototype.registerMethod("remove",_Y),window.ml5=CX;var UY=m.setBackend,qY=m.getBackend},2287:function(e,t){"use strict";var n,r;n=function(){function e(){return!0}function t(){return!1}function n(){}return function r(){var i=[{name:"number",test:function(e){return"number"==typeof e}},{name:"string",test:function(e){return"string"==typeof e}},{name:"boolean",test:function(e){return"boolean"==typeof e}},{name:"Function",test:function(e){return"function"==typeof e}},{name:"Array",test:Array.isArray},{name:"Date",test:function(e){return e instanceof Date}},{name:"RegExp",test:function(e){return e instanceof RegExp}},{name:"Object",test:function(e){return"object"==typeof e&&null!==e&&e.constructor===Object}},{name:"null",test:function(e){return null===e}},{name:"undefined",test:function(e){return void 0===e}}],a={name:"any",test:e},o=[],s=[],u={types:i,conversions:s,ignore:o};function c(e){var t=L(u.types,(function(t){return t.name===e}));if(t)return t;if("any"===e)return a;var n=L(u.types,(function(t){return t.name.toLowerCase()===e.toLowerCase()}));throw new TypeError('Unknown type "'+e+'"'+(n?'. Did you mean "'+n.name+'"?':""))}function l(e){return e===a?999:u.types.indexOf(e)}function f(e){var t=L(u.types,(function(t){return t.test(e)}));if(t)return t.name;throw new TypeError("Value has unknown type. Value: "+e)}function p(e){return e.map((function(e){var t=e.types.map(x);return(e.restParam?"...":"")+t.join("|")})).join(",")}function h(e,t){var n=0===e.indexOf("..."),r=(n?e.length>3?e.slice(3):"any":e).split("|").map(O).filter(I).filter(T),i=function(e,t){var n={};return e.forEach((function(e){-1!==t.indexOf(e.from)||-1===t.indexOf(e.to)||n[e.from]||(n[e.from]=e)})),Object.keys(n).map((function(e){return n[e]}))}(t,r),a=r.map((function(e){var t=c(e);return{name:e,typeIndex:l(t),test:t.test,conversion:null,conversionIndex:-1}})),o=i.map((function(e){var n=c(e.from);return{name:e.from,typeIndex:l(n),test:n.test,conversion:e,conversionIndex:t.indexOf(e)}}));return{types:a.concat(o),restParam:n}}function d(e){var t=B(e);return!!t&&t.restParam}function m(e){return e.types.some((function(e){return null!=e.conversion}))}function g(t){if(t&&0!==t.types.length){if(1===t.types.length)return c(t.types[0].name).test;if(2===t.types.length){var n=c(t.types[0].name).test,r=c(t.types[1].name).test;return function(e){return n(e)||r(e)}}var i=t.types.map((function(e){return c(e.name).test}));return function(e){for(var t=0;t<i.length;t++)if(i[t](e))return!0;return!1}}return e}function v(e){var t,n,r,i;if(d(e)){var a=(t=(i=e,i.slice(0,i.length-1)).map(g)).length,o=g(B(e));return function(e){for(var n=0;n<t.length;n++)if(!t[n](e[n]))return!1;return function(e){for(var t=a;t<e.length;t++)if(!o(e[t]))return!1;return!0}(e)&&e.length>=a+1}}return 0===e.length?function(e){return 0===e.length}:1===e.length?(n=g(e[0]),function(e){return n(e[0])&&1===e.length}):2===e.length?(n=g(e[0]),r=g(e[1]),function(e){return n(e[0])&&r(e[1])&&2===e.length}):(t=e.map(g),function(e){for(var n=0;n<t.length;n++)if(!t[n](e[n]))return!1;return e.length===t.length})}function y(e,t){return t<e.params.length?e.params[t]:d(e.params)?B(e.params):null}function b(e,t,n){var r=y(e,t);return(r?n?r.types.filter(w):r.types:[]).map(x)}function x(e){return e.name}function w(e){return null===e.conversion||void 0===e.conversion}function E(e,t){var n=function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=!0;return Object.keys(t)}(j(e,(function(e){return b(e,t,!1)})));return-1!==n.indexOf("any")?["any"]:n}function C(e,t,n){var r,i,a,o=e||"unnamed",s=n;for(a=0;a<t.length;a++){var u=s.filter((function(e){var n=g(y(e,a));return(a<e.params.length||d(e.params))&&n(t[a])}));if(0===u.length){if((i=E(s,a)).length>0){var c=f(t[a]);return(r=new TypeError("Unexpected type of argument in function "+o+" (expected: "+i.join(" or ")+", actual: "+c+", index: "+a+")")).data={category:"wrongType",fn:o,index:a,actual:c,expected:i},r}}else s=u}var l=s.map((function(e){return d(e.params)?1/0:e.params.length}));if(t.length<Math.min.apply(null,l))return i=E(s,a),(r=new TypeError("Too few arguments in function "+o+" (expected: "+i.join(" or ")+", index: "+t.length+")")).data={category:"tooFewArgs",fn:o,index:t.length,expected:i},r;var p=Math.max.apply(null,l);return t.length>p?((r=new TypeError("Too many arguments in function "+o+" (expected: "+p+", actual: "+t.length+")")).data={category:"tooManyArgs",fn:o,index:t.length,expectedLength:p},r):((r=new TypeError('Arguments of type "'+t.join(", ")+'" do not match any of the defined signatures of function '+o+".")).data={category:"mismatch",actual:t.map(f)},r)}function S(e){for(var t=999,n=0;n<e.types.length;n++)w(e.types[n])&&(t=Math.min(t,e.types[n].typeIndex));return t}function N(e){for(var t=999,n=0;n<e.types.length;n++)w(e.types[n])||(t=Math.min(t,e.types[n].conversionIndex));return t}function A(e,t){var n;return 0!=(n=e.restParam-t.restParam)||0!=(n=m(e)-m(t))||0!=(n=S(e)-S(t))?n:N(e)-N(t)}function k(e,t){var n,r,i=Math.min(e.params.length,t.params.length);if(0!=(r=e.params.some(m)-t.params.some(m)))return r;for(n=0;n<i;n++)if(0!=(r=m(e.params[n])-m(t.params[n])))return r;for(n=0;n<i;n++)if(0!==(r=A(e.params[n],t.params[n])))return r;return e.params.length-t.params.length}function D(e){var t,n,r,i,a=[],o=[];switch(e.types.forEach((function(e){e.conversion&&(a.push(c(e.conversion.from).test),o.push(e.conversion.convert))})),o.length){case 0:return function(e){return e};case 1:return t=a[0],r=o[0],function(e){return t(e)?r(e):e};case 2:return t=a[0],n=a[1],r=o[0],i=o[1],function(e){return t(e)?r(e):n(e)?i(e):e};default:return function(e){for(var t=0;t<o.length;t++)if(a[t](e))return o[t](e);return e}}}function _(e,t){return function e(n,r,i){if(r<n.length){var a,o=n[r],s=t?o.types.filter(w):o.types;if(o.restParam){var u=s.filter(w);a=u.length<s.length?[u,s]:[s]}else a=s.map((function(e){return[e]}));return j(a,(function(t){return e(n,r+1,i.concat([t]))}))}return[i.map((function(e,t){return{types:e,restParam:t===n.length-1&&d(n)}}))]}(e,0,[])}function M(e,r){if(0===Object.keys(r).length)throw new SyntaxError("No signatures provided");var i=[];Object.keys(r).map((function(e){return function(e,t,n){var r=[];return""!==e.trim()&&(r=e.split(",").map(O).map((function(e,t,r){var i=h(e,n);if(i.restParam&&t!==r.length-1)throw new SyntaxError('Unexpected rest parameter "'+e+'": only allowed for the last parameter');return i}))),r.some(R)?null:{params:r,fn:t}}(e,r[e],u.conversions)})).filter(F).forEach((function(e){var t=L(i,(function(t){return function(e,t){for(var n=Math.max(e.params.length,t.params.length),r=0;r<n;r++)if(!P(b(e,r,!0),b(t,r,!0)))return!1;var i=e.params.length,a=t.params.length,o=d(e.params),s=d(t.params);return o?s?i===a:a>=i:s?i>=a:i===a}(t,e)}));if(t)throw new TypeError('Conflicting signatures "'+p(t.params)+'" and "'+p(e.params)+'".');i.push(e)}));var a=j(i,(function(e){return(e?_(e.params,!1):[]).map((function(t){return{params:t,fn:e.fn}}))})).filter(F);a.sort(k);var o=a[0]&&a[0].params.length<=2&&!d(a[0].params),s=a[1]&&a[1].params.length<=2&&!d(a[1].params),c=a[2]&&a[2].params.length<=2&&!d(a[2].params),l=a[3]&&a[3].params.length<=2&&!d(a[3].params),f=a[4]&&a[4].params.length<=2&&!d(a[4].params),y=a[5]&&a[5].params.length<=2&&!d(a[5].params),x=o&&s&&c&&l&&f&&y,w=a.map((function(e){return v(e.params)})),E=o?g(a[0].params[0]):t,S=s?g(a[1].params[0]):t,N=c?g(a[2].params[0]):t,A=l?g(a[3].params[0]):t,M=f?g(a[4].params[0]):t,T=y?g(a[5].params[0]):t,I=o?g(a[0].params[1]):t,B=s?g(a[1].params[1]):t,U=c?g(a[2].params[1]):t,q=l?g(a[3].params[1]):t,W=f?g(a[4].params[1]):t,V=y?g(a[5].params[1]):t,$=a.map((function(e){return function(e,t){var n=t;if(e.some(m)){var r=d(e),i=e.map(D);n=function(){for(var e=[],n=r?arguments.length-1:arguments.length,a=0;a<n;a++)e[a]=i[a](arguments[a]);return r&&(e[n]=arguments[n].map(i[n])),t.apply(this,e)}}var a=n;if(d(e)){var o=e.length-1;a=function(){return n.apply(this,z(arguments,0,o).concat([z(arguments,o)]))}}return a}(e.params,e.fn)})),H=o?$[0]:n,G=s?$[1]:n,K=c?$[2]:n,X=l?$[3]:n,Y=f?$[4]:n,J=y?$[5]:n,Z=o?a[0].params.length:-1,Q=s?a[1].params.length:-1,ee=c?a[2].params.length:-1,te=l?a[3].params.length:-1,ne=f?a[4].params.length:-1,re=y?a[5].params.length:-1,ie=x?6:0,ae=a.length,oe=function(){for(var t=ie;t<ae;t++)if(w[t](arguments))return $[t].apply(this,arguments);throw C(e,arguments,a)},se=function e(t,n){return arguments.length===Z&&E(t)&&I(n)?H.apply(e,arguments):arguments.length===Q&&S(t)&&B(n)?G.apply(e,arguments):arguments.length===ee&&N(t)&&U(n)?K.apply(e,arguments):arguments.length===te&&A(t)&&q(n)?X.apply(e,arguments):arguments.length===ne&&M(t)&&W(n)?Y.apply(e,arguments):arguments.length===re&&T(t)&&V(n)?J.apply(e,arguments):oe.apply(e,arguments)};try{Object.defineProperty(se,"name",{value:e})}catch(e){}return se.signatures=function(e){var t={};return e.forEach((function(e){e.params.some(m)||_(e.params,!0).forEach((function(n){t[p(n)]=e.fn}))})),t}(a),se}function T(e){return-1===u.ignore.indexOf(e)}function O(e){return e.trim()}function I(e){return!!e}function F(e){return null!==e}function R(e){return 0===e.types.length}function B(e){return e[e.length-1]}function z(e,t,n){return Array.prototype.slice.call(e,t,n)}function P(e,t){for(var n=0;n<e.length;n++)if(r=t,i=e[n],-1!==r.indexOf(i))return!0;var r,i;return!1}function L(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]}function j(e,t){return Array.prototype.concat.apply([],e.map(t))}function U(e){for(var t="",n=0;n<e.length;n++){var r=e[n];if(("object"==typeof r.signatures||"string"==typeof r.signature)&&""!==r.name)if(""===t)t=r.name;else if(t!==r.name){var i=new Error("Function names do not match (expected: "+t+", actual: "+r.name+")");throw i.data={actual:r.name,expected:t},i}}return t}function q(e){var t,n={};function r(e,r){if(n.hasOwnProperty(e)&&r!==n[e])throw(t=new Error('Signature "'+e+'" is defined twice')).data={signature:e},t}for(var i=0;i<e.length;i++){var a=e[i];if("object"==typeof a.signatures)for(var o in a.signatures)a.signatures.hasOwnProperty(o)&&(r(o,a.signatures[o]),n[o]=a.signatures[o]);else{if("string"!=typeof a.signature)throw(t=new TypeError("Function is no typed-function (index: "+i+")")).data={index:i},t;r(a.signature,a),n[a.signature]=a}}return n}return(u=M("typed",{"string, Object":M,Object:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return M(U(t),e)},"...Function":function(e){return M(U(e),q(e))},"string, ...Function":function(e,t){return M(e,q(t))}})).create=r,u.types=i,u.conversions=s,u.ignore=o,u.convert=function(e,t){var n=f(e);if(t===n)return e;for(var r=0;r<u.conversions.length;r++){var i=u.conversions[r];if(i.from===n&&i.to===t)return i.convert(e)}throw new Error("Cannot convert from "+n+" to "+t)},u.find=function(e,t){if(!e.signatures)throw new TypeError("Function is no typed-function");var n;if("string"==typeof t){n=t.split(",");for(var r=0;r<n.length;r++)n[r]=n[r].trim()}else{if(!Array.isArray(t))throw new TypeError("String array or a comma separated string expected");n=t}var i=n.join(","),a=e.signatures[i];if(a)return a;throw new TypeError("Signature not found (signature: "+(e.name||"unnamed")+"("+n.join(", ")+"))")},u.addType=function(e,t){if(!e||"string"!=typeof e.name||"function"!=typeof e.test)throw new TypeError("Object with properties {name: string, test: function} expected");if(!1!==t)for(var n=0;n<u.types.length;n++)if("Object"===u.types[n].name)return void u.types.splice(n,0,e);u.types.push(e)},u.addConversion=function(e){if(!e||"string"!=typeof e.from||"string"!=typeof e.to||"function"!=typeof e.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");u.conversions.push(e)},u}()},void 0===(r=n.apply(t,[]))||(e.exports=r)},9966:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DEFAULT_ACTIONS:()=>o0,default:()=>g0,guessMode:()=>p0,vega:()=>r0,vegaLite:()=>i0});var r={};n.r(r),n.d(r,{JsonPatchError:()=>O,_areEquals:()=>q,applyOperation:()=>z,applyPatch:()=>P,applyReducer:()=>L,deepClone:()=>I,getValueByPointer:()=>B,validate:()=>U,validator:()=>j});var i={};n.r(i),n.d(i,{compare:()=>Y,generate:()=>K,observe:()=>G,unobserve:()=>H});var a={};n.r(a),n.d(a,{aggregate:()=>zu,bin:()=>Pu,collect:()=>ju,compare:()=>Uu,countpattern:()=>Wu,cross:()=>Vu,density:()=>Gu,dotbin:()=>Zu,expression:()=>Qu,extent:()=>tc,facet:()=>rc,field:()=>ic,filter:()=>oc,flatten:()=>sc,fold:()=>uc,formula:()=>cc,generate:()=>lc,impute:()=>hc,joinaggregate:()=>dc,kde:()=>mc,key:()=>gc,load:()=>yc,lookup:()=>xc,multiextent:()=>wc,multivalues:()=>Cc,params:()=>Nc,pivot:()=>Ac,prefacet:()=>kc,project:()=>Dc,proxy:()=>_c,quantile:()=>Mc,relay:()=>Tc,sample:()=>Oc,sequence:()=>Ic,sieve:()=>Fc,subflow:()=>nc,timeunit:()=>Rc,tupleindex:()=>zc,values:()=>Pc,window:()=>Wc});var o={};n.r(o),n.d(o,{interpolate:()=>bp,interpolateArray:()=>fp,interpolateBasis:()=>Qf,interpolateBasisClosed:()=>ep,interpolateCubehelix:()=>nd,interpolateCubehelixLong:()=>rd,interpolateDate:()=>hp,interpolateDiscrete:()=>uh,interpolateHcl:()=>qh,interpolateHclLong:()=>Wh,interpolateHsl:()=>xh,interpolateHslLong:()=>wh,interpolateHue:()=>ch,interpolateLab:()=>jh,interpolateNumber:()=>dp,interpolateNumberArray:()=>cp,interpolateObject:()=>mp,interpolateRgb:()=>ap,interpolateRgbBasis:()=>sp,interpolateRgbBasisClosed:()=>up,interpolateRound:()=>xp,interpolateString:()=>yp,interpolateTransformCss:()=>mh,interpolateTransformSvg:()=>gh,interpolateZoom:()=>yh,piecewise:()=>ah,quantize:()=>id});var s={};n.r(s),n.d(s,{bound:()=>xx,identifier:()=>Cx,mark:()=>Sx,overlap:()=>Nx,render:()=>Ox,viewlayout:()=>Qx});var u={};n.r(u),n.d(u,{axisticks:()=>tw,datajoin:()=>nw,encode:()=>iw,legendentries:()=>aw,linkpath:()=>lw,pie:()=>mw,scale:()=>yw,sortitems:()=>Ew,stack:()=>kw});var c={};n.r(c),n.d(c,{contour:()=>aN,geojson:()=>uN,geopath:()=>cN,geopoint:()=>lN,geoshape:()=>fN,graticule:()=>pN,heatmap:()=>hN,isocontour:()=>XS,kde2d:()=>nN,projection:()=>mN});var l={};n.r(l),n.d(l,{force:()=>lA});var f={};n.r(f),n.d(f,{nest:()=>lk,pack:()=>gk,partition:()=>yk,stratify:()=>bk,tree:()=>Ek,treelinks:()=>Ck,treemap:()=>Ak});var p={};n.r(p),n.d(p,{label:()=>$k});var h={};n.r(h),n.d(h,{loess:()=>Gk,regression:()=>Xk});var d={};n.r(d),n.d(d,{voronoi:()=>yD});var m={};n.r(m),n.d(m,{wordcloud:()=>OD});var g={};n.r(g),n.d(g,{crossfilter:()=>LD,resolvefilter:()=>jD});var v={};n.r(v),n.d(v,{Bounds:()=>gg,CanvasHandler:()=>Gy,CanvasRenderer:()=>Zy,DATE:()=>vr,DAY:()=>yr,DAYOFYEAR:()=>br,Dataflow:()=>hs,Debug:()=>xe,Error:()=>ve,EventStream:()=>Qo,Gradient:()=>Cm,GroupItem:()=>yg,HOURS:()=>xr,Handler:()=>_y,Info:()=>be,Item:()=>vg,MILLISECONDS:()=>Cr,MINUTES:()=>wr,MONTH:()=>mr,Marks:()=>hy,MultiPulse:()=>cs,None:()=>ge,Operator:()=>Yo,Parameters:()=>Go,Pulse:()=>as,QUARTER:()=>dr,RenderType:()=>Lb,Renderer:()=>Ty,ResourceLoader:()=>bg,SECONDS:()=>Er,SVGHandler:()=>eb,SVGRenderer:()=>Sb,SVGStringRenderer:()=>Pb,Scenegraph:()=>wy,TIME_UNITS:()=>Sr,Transform:()=>ms,View:()=>WO,WEEK:()=>gr,Warn:()=>ye,YEAR:()=>hr,accessor:()=>ee,accessorFields:()=>ne,accessorName:()=>te,array:()=>Ge,ascending:()=>Je,bandwidthNRD:()=>Ms,bin:()=>Ts,bootstrapCI:()=>Fs,boundClip:()=>Gb,boundContext:()=>jg,boundItem:()=>dy,boundMark:()=>gy,boundStroke:()=>Eg,changeset:()=>$o,clampRange:()=>Ke,codegenExpression:()=>Fz,compare:()=>Ye,constant:()=>tt,cumulativeLogNormal:()=>Xs,cumulativeNormal:()=>Ws,cumulativeUniform:()=>tu,dayofyear:()=>Tr,debounce:()=>nt,defaultLocale:()=>ro,definition:()=>vs,densityLogNormal:()=>Ks,densityNormal:()=>qs,densityUniform:()=>eu,domChild:()=>Ny,domClear:()=>Ay,domCreate:()=>Cy,domFind:()=>Sy,dotbin:()=>Rs,error:()=>oe,expressionFunction:()=>$T,extend:()=>rt,extent:()=>it,extentIndex:()=>at,falsy:()=>de,fastmap:()=>ct,field:()=>ue,flush:()=>lt,font:()=>ay,fontFamily:()=>iy,fontSize:()=>Qv,format:()=>ko,formatLocale:()=>Xa,formats:()=>Do,hasOwnProperty:()=>st,id:()=>ce,identity:()=>le,inferType:()=>xo,inferTypes:()=>wo,ingest:()=>Lo,inherits:()=>ft,inrange:()=>pt,interpolate:()=>Kd,interpolateColors:()=>$d,interpolateRange:()=>Vd,intersect:()=>qb,intersectBoxLine:()=>Jg,intersectPath:()=>Gg,intersectPoint:()=>Kg,intersectRule:()=>Yg,isArray:()=>Ee,isBoolean:()=>ht,isDate:()=>dt,isFunction:()=>Xe,isIterable:()=>mt,isNumber:()=>gt,isObject:()=>Ce,isRegExp:()=>vt,isString:()=>yt,isTuple:()=>Bo,key:()=>bt,lerp:()=>xt,lineHeight:()=>ey,loader:()=>To,locale:()=>no,logger:()=>we,lruCache:()=>wt,markup:()=>vb,merge:()=>Et,mergeConfig:()=>Ne,multiLineOffset:()=>ny,one:()=>pe,pad:()=>St,panLinear:()=>Be,panLog:()=>ze,panPow:()=>Pe,panSymlog:()=>Le,parse:()=>_B,parseExpression:()=>Tz,parseSelector:()=>Lz,pathCurves:()=>Nm,pathEqual:()=>Xb,pathParse:()=>Dm,pathRectangle:()=>Zm,pathRender:()=>Lm,pathSymbols:()=>Wm,pathTrail:()=>Qm,peek:()=>De,point:()=>Dy,projection:()=>zS,quantileLogNormal:()=>Ys,quantileNormal:()=>Vs,quantileUniform:()=>nu,quantiles:()=>Ds,quantizeInterpolator:()=>Hd,quarter:()=>$e,quartiles:()=>_s,random:()=>Os,randomInteger:()=>zs,randomKDE:()=>Hs,randomLCG:()=>Bs,randomLogNormal:()=>Js,randomMixture:()=>Zs,randomNormal:()=>$s,randomUniform:()=>ru,read:()=>Mo,regressionExp:()=>lu,regressionLinear:()=>uu,regressionLoess:()=>mu,regressionLog:()=>cu,regressionPoly:()=>hu,regressionPow:()=>fu,regressionQuad:()=>pu,renderModule:()=>Ub,repeat:()=>Ct,resetDefaultLocale:()=>io,resetSVGClipId:()=>dg,resetSVGDefIds:()=>Yb,responseType:()=>_o,runtimeContext:()=>tO,sampleCurve:()=>bu,sampleLogNormal:()=>Gs,sampleNormal:()=>Us,sampleUniform:()=>Qs,scale:()=>Fd,sceneEqual:()=>Kb,sceneFromJSON:()=>by,scenePickVisit:()=>uv,sceneToJSON:()=>yy,sceneVisit:()=>sv,sceneZOrder:()=>ov,scheme:()=>Zd,serializeXML:()=>yb,setRandom:()=>Is,span:()=>Nt,splitAccessPath:()=>se,stringValue:()=>At,textMetrics:()=>Gv,timeBin:()=>gi,timeFloor:()=>Gr,timeFormatLocale:()=>eo,timeInterval:()=>Qr,timeOffset:()=>ni,timeSequence:()=>ai,timeUnitSpecifier:()=>Dr,timeUnits:()=>Ar,toBoolean:()=>kt,toDate:()=>_t,toNumber:()=>_e,toSet:()=>Tt,toString:()=>Mt,transform:()=>ys,transforms:()=>gs,truncate:()=>Ot,truthy:()=>he,tupleid:()=>zo,typeParsers:()=>vo,utcFloor:()=>Yr,utcInterval:()=>ei,utcOffset:()=>ri,utcSequence:()=>oi,utcdayofyear:()=>zr,utcquarter:()=>He,utcweek:()=>Pr,version:()=>Wz,visitArray:()=>It,week:()=>Or,writeConfig:()=>Ae,zero:()=>fe,zoomLinear:()=>Ue,zoomLog:()=>qe,zoomPow:()=>We,zoomSymlog:()=>Ve});var y={};n.r(y),n.d(y,{compile:()=>fQ,extractTransforms:()=>hQ,normalize:()=>OH,version:()=>dQ});var b={};n.r(b),n.d(b,{dark:()=>vQ,excel:()=>bQ,fivethirtyeight:()=>SQ,ggplot2:()=>AQ,googlecharts:()=>GQ,latimes:()=>OQ,quartz:()=>RQ,urbaninstitute:()=>WQ,version:()=>KQ,vox:()=>zQ});var x,w=(x=function(e,t){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},x(e,t)},function(e,t){function n(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),E=Object.prototype.hasOwnProperty;function C(e,t){return E.call(e,t)}function S(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);for(var r in t=[],e)C(e,r)&&t.push(r);return t}function N(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function A(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function k(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function D(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function _(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(_(e[t]))return!0}else if("object"==typeof e){var r=S(e),i=r.length;for(t=0;t<i;t++)if(_(e[r[t]]))return!0}return!1}function M(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var T=function(e){function t(t,n,r,i,a){var o=this.constructor,s=e.call(this,M(t,{name:n,index:r,operation:i,tree:a}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=M(t,{name:n,index:r,operation:i,tree:a}),s}return w(t,e),t}(Error),O=T,I=N,F={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=B(n,this.path);r&&(r=N(r));var i=z(n,{op:"remove",path:this.from}).removed;return z(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=B(n,this.from);return z(n,{op:"add",path:this.path,value:N(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:q(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},R={add:function(e,t,n){return A(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:F.move,copy:F.copy,test:F.test,_get:F._get};function B(e,t){if(""==t)return e;var n={op:"_get",path:t};return z(e,n),n.value}function z(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):j(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=B(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=q(e,t.value),!1===o.test)throw new O("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new O("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}r||(e=N(e));var s=(t.path||"").split("/"),u=e,c=1,l=s.length,f=void 0,p=void 0,h=void 0;for(h="function"==typeof n?n:j;;){if((p=s[c])&&-1!=p.indexOf("~")&&(p=D(p)),i&&"__proto__"==p)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===f&&(void 0===u[p]?f=s.slice(0,c).join("/"):c==l-1&&(f=t.path),void 0!==f&&h(t,0,e,f)),c++,Array.isArray(u)){if("-"===p)p=u.length;else{if(n&&!A(p))throw new O("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);A(p)&&(p=~~p)}if(c>=l){if(n&&"add"===t.op&&p>u.length)throw new O("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(o=R[t.op].call(t,u,p,e)).test)throw new O("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(c>=l){if(!1===(o=F[t.op].call(t,u,p,e)).test)throw new O("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}if(u=u[p],n&&c<l&&(!u||"object"!=typeof u))throw new O("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}function P(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new O("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=N(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=z(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function L(e,t,n){var r=z(e,t);if(!1===r.test)throw new O("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function j(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new O("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!F[e.op])throw new O("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new O("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new O('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new O("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new O("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&_(e.value))throw new O("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new O("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new O("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o=U([{op:"_get",path:e.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new O("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function U(e,t,n){try{if(!Array.isArray(e))throw new O("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)P(N(t),N(e),n||!0);else{n=n||j;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof O)return e;throw e}}function q(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!q(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!q(e[i=s[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var W=new WeakMap,V=function(e){this.observers=new Map,this.obj=e},$=function(e,t){this.callback=e,this.observer=t};function H(e,t){t.unobserve()}function G(e,t){var n,r=function(e){return W.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new V(e),W.set(e,r);if(n)return n;if(n={},r.value=N(e),t){n.callback=t,n.next=null;var a=function(){K(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=e,n.unobserve=function(){K(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new $(t,n)),n}function K(e,t){void 0===t&&(t=!1);var n=W.get(e.object);X(n.value,e.object,e.patches,"",t),e.patches.length&&P(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function X(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=S(t),o=S(e),s=!1,u=o.length-1;u>=0;u--){var c=e[f=o[u]];if(!C(t,f)||void 0===t[f]&&void 0!==c&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+k(f),value:N(c)}),n.push({op:"remove",path:r+"/"+k(f)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var l=t[f];"object"==typeof c&&null!=c&&"object"==typeof l&&null!=l&&Array.isArray(c)===Array.isArray(l)?X(c,l,n,r+"/"+k(f),i):c!==l&&(i&&n.push({op:"test",path:r+"/"+k(f),value:N(c)}),n.push({op:"replace",path:r+"/"+k(f),value:N(l)}))}}if(s||a.length!=o.length)for(u=0;u<a.length;u++){var f;C(e,f=a[u])||void 0===t[f]||n.push({op:"add",path:r+"/"+k(f),value:N(t[f])})}}}function Y(e,t,n){void 0===n&&(n=!1);var r=[];return X(e,t,r,"",n),r}Object.assign({},r,i,{JsonPatchError:T,deepClone:N,escapePathComponent:k,unescapePathComponent:D});var J=n(1801),Z=n.n(J),Q=n(1249);function ee(e,t,n){return e.fields=t||[],e.fname=n,e}function te(e){return null==e?null:e.fname}function ne(e){return null==e?null:e.fields}function re(e){return 1===e.length?ie(e[0]):ae(e)}const ie=e=>function(t){return t[e]},ae=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function oe(e){throw Error(e)}function se(e){const t=[],n=e.length;let r,i,a,o=null,s=0,u="";function c(){t.push(u+e.substring(r,i)),u="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)u+=e.substring(r,i),u+=e.substring(++i,++i),r=i;else if(a===o)c(),o=null,s=-1;else{if(o)continue;r===s&&'"'===a||r===s&&"'"===a?(r=i+1,o=a):"."!==a||s?"["===a?(i>r&&c(),s=r=i+1):"]"===a&&(s||oe("Access path missing open bracket: "+e),s>0&&c(),s=0,r=i+1):i>r?c():r=i+1}return s&&oe("Access path missing closing bracket: "+e),o&&oe("Access path missing closing quote: "+e),i>r&&(i++,c()),t}function ue(e,t,n){const r=se(e);return e=1===r.length?r[0]:e,ee((n&&n.get||re)(r),[e],t||e)}const ce=ue("id"),le=ee((e=>e),[],"identity"),fe=ee((()=>0),[],"zero"),pe=ee((()=>1),[],"one"),he=ee((()=>!0),[],"true"),de=ee((()=>!1),[],"false");function me(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const ge=0,ve=1,ye=2,be=3,xe=4;function we(e,t){let n=e||ge;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=ve&&me(t||"error","ERROR",arguments),this},warn(){return n>=ye&&me(t||"warn","WARN",arguments),this},info(){return n>=be&&me(t||"log","INFO",arguments),this},debug(){return n>=xe&&me(t||"log","DEBUG",arguments),this}}}var Ee=Array.isArray;function Ce(e){return e===Object(e)}const Se=e=>"__proto__"!==e;function Ne(...e){return e.reduce(((e,t)=>{for(const n in t)if("signals"===n)e.signals=ke(e.signals,t.signals);else{const r="legend"===n?{layout:1}:"style"===n||null;Ae(e,n,t[n],r)}return e}),{})}function Ae(e,t,n,r){if(!Se(t))return;let i,a;if(Ce(n)&&!Ee(n))for(i in a=Ce(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?Ae(a,i,n[i]):Se(i)&&(a[i]=n[i]);else e[t]=n}function ke(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function De(e){return e[e.length-1]}function _e(e){return null==e||""===e?null:+e}const Me=e=>t=>e*Math.exp(t),Te=e=>t=>Math.log(e*t),Oe=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Ie=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Fe=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Re(e,t,n,r){const i=n(e[0]),a=n(De(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function Be(e,t){return Re(e,t,_e,le)}function ze(e,t){var n=Math.sign(e[0]);return Re(e,t,Te(n),Me(n))}function Pe(e,t,n){return Re(e,t,Fe(n),Fe(1/n))}function Le(e,t,n){return Re(e,t,Oe(n),Ie(n))}function je(e,t,n,r,i){const a=r(e[0]),o=r(De(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function Ue(e,t,n){return je(e,t,n,_e,le)}function qe(e,t,n){const r=Math.sign(e[0]);return je(e,t,n,Te(r),Me(r))}function We(e,t,n,r){return je(e,t,n,Fe(r),Fe(1/r))}function Ve(e,t,n,r){return je(e,t,n,Oe(r),Ie(r))}function $e(e){return 1+~~(new Date(e).getMonth()/3)}function He(e){return 1+~~(new Date(e).getUTCMonth()/3)}function Ge(e){return null!=e?Ee(e)?e:[e]:[]}function Ke(e,t,n){let r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),r=a-i,r>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function Xe(e){return"function"==typeof e}function Ye(e,t,n){n=n||{},t=Ge(t)||[];const r=[],i=[],a={},o=n.comparator||Ze;return Ge(e).forEach(((e,o)=>{null!=e&&(r.push("descending"===t[o]?-1:1),i.push(e=Xe(e)?e:ue(e,null,n)),(ne(e)||[]).forEach((e=>a[e]=1)))})),0===i.length?null:ee(o(i,r),Object.keys(a))}const Je=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),Ze=(e,t)=>1===e.length?Qe(e[0],t[0]):et(e,t,e.length),Qe=(e,t)=>function(n,r){return Je(e(n),e(r))*t},et=(e,t,n)=>(t.push(0),function(r,i){let a,o=0,s=-1;for(;0===o&&++s<n;)a=e[s],o=Je(a(r),a(i));return o*t[s]});function tt(e){return Xe(e)?e:()=>e}function nt(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout((()=>(t(r),n=null)),e)}}function rt(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}function it(e,t){let n,r,i,a,o=0;if(e&&(n=e.length))if(null==t){for(r=e[o];o<n&&(null==r||r!=r);r=e[++o]);for(i=a=r;o<n;++o)r=e[o],null!=r&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[o]);o<n&&(null==r||r!=r);r=t(e[++o]));for(i=a=r;o<n;++o)r=t(e[o]),null!=r&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function at(e,t){const n=e.length;let r,i,a,o,s,u=-1;if(null==t){for(;++u<n;)if(i=e[u],null!=i&&i>=i){r=a=i;break}if(u===n)return[-1,-1];for(o=s=u;++u<n;)i=e[u],null!=i&&(r>i&&(r=i,o=u),a<i&&(a=i,s=u))}else{for(;++u<n;)if(i=t(e[u],u,e),null!=i&&i>=i){r=a=i;break}if(u===n)return[-1,-1];for(o=s=u;++u<n;)i=t(e[u],u,e),null!=i&&(r>i&&(r=i,o=u),a<i&&(a=i,s=u))}return[o,s]}const ot=Object.prototype.hasOwnProperty;function st(e,t){return ot.call(e,t)}const ut={};function ct(e){let t,n={};function r(e){return st(n,e)&&n[e]!==ut}const i={size:0,empty:0,object:n,has:r,get:e=>r(e)?n[e]:void 0,set(e,t){return r(e)||(++i.size,n[e]===ut&&--i.empty),n[e]=t,this},delete(e){return r(e)&&(--i.size,++i.empty,n[e]=ut),this},clear(){i.size=i.empty=0,i.object=n={}},test(e){return arguments.length?(t=e,i):t},clean(){const e={};let r=0;for(const i in n){const a=n[i];a===ut||t&&t(a)||(e[i]=a,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach((t=>{i.set(t,e[t])})),i}function lt(e,t,n,r,i,a){if(!n&&0!==n)return a;const o=+n;let s,u=e[0],c=De(e);c<u&&(s=u,u=c,c=s),s=Math.abs(t-u);const l=Math.abs(c-t);return s<l&&s<=o?r:l<=o?i:a}function ft(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),rt(r,n)}function pt(e,t,n,r){let i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function ht(e){return"boolean"==typeof e}function dt(e){return"[object Date]"===Object.prototype.toString.call(e)}function mt(e){return e&&Xe(e[Symbol.iterator])}function gt(e){return"number"==typeof e}function vt(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function yt(e){return"string"==typeof e}function bt(e,t,n){e&&(e=t?Ge(e).map((e=>e.replace(/\\(.)/g,"$1"))):Ge(e));const r=e&&e.length,i=n&&n.get||re,a=e=>i(t?[e]:se(e));let o;if(r)if(1===r){const t=a(e[0]);o=function(e){return""+t(e)}}else{const t=e.map(a);o=function(e){let n=""+t[0](e),i=0;for(;++i<r;)n+="|"+t[i](e);return n}}else o=function(){return""};return ee(o,e,"key")}function xt(e,t){const n=e[0],r=De(e),i=+t;return i?1===i?r:n+i*(r-n):n}function wt(e){let t,n,r;e=+e||1e4;const i=()=>{t={},n={},r=0},a=(i,a)=>(++r>e&&(n=t,t={},r=1),t[i]=a);return i(),{clear:i,has:e=>st(t,e)||st(n,e),get:e=>st(t,e)?t[e]:st(n,e)?a(e,n[e]):void 0,set:(e,n)=>st(t,e)?t[e]=n:a(e,n)}}function Et(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const o=r||new t.constructor(i+a);let s=0,u=0,c=0;for(;s<i&&u<a;++c)o[c]=e(t[s],n[u])>0?n[u++]:t[s++];for(;s<i;++s,++c)o[c]=t[s];for(;u<a;++u,++c)o[c]=n[u];return o}function Ct(e,t){let n="";for(;--t>=0;)n+=e;return n}function St(e,t,n,r){const i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?Ct(i,o)+a:"center"===r?Ct(i,~~(o/2))+a+Ct(i,Math.ceil(o/2)):a+Ct(i,o)}function Nt(e){return e&&De(e)-e[0]||0}function At(e){return Ee(e)?"["+e.map(At)+"]":Ce(e)||yt(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function kt(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)}const Dt=e=>gt(e)||dt(e)?e:Date.parse(e);function _t(e,t){return t=t||Dt,null==e||""===e?null:t(e)}function Mt(e){return null==e||""===e?null:e+""}function Tt(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Ot(e,t,n,r){const i=null!=r?r:"",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function It(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const r=t(e[i]);r&&n(r,i,e)}}else e.forEach(n)}var Ft={},Rt={};function Bt(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function zt(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function Pt(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Lt(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,s=0,u=a<=0,c=!1;function l(){if(u)return Rt;if(c)return c=!1,Ft;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?u=!0:10===(r=e.charCodeAt(o++))?c=!0:13===r&&(c=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))c=!0;else if(13===r)c=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return u=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=l())!==Rt;){for(var f=[];r!==Ft&&r!==Rt;)f.push(r),r=l();t&&null==(f=t(f,s++))||i.push(f)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?function(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+Pt(-e,6):e>9999?"+"+Pt(e,6):Pt(e,4)}(e.getUTCFullYear())+"-"+Pt(e.getUTCMonth()+1,2)+"-"+Pt(e.getUTCDate(),2)+(i?"T"+Pt(t,2)+":"+Pt(n,2)+":"+Pt(r,2)+"."+Pt(i,3)+"Z":r?"T"+Pt(t,2)+":"+Pt(n,2)+":"+Pt(r,2)+"Z":n||t?"T"+Pt(t,2)+":"+Pt(n,2)+"Z":"")}(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=Bt(e);return function(r,i){return t(n(r),i,e)}}(e,t):Bt(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=zt(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=zt(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}}function jt(e){return e}function Ut(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return qt(e,t)}))}:qt(e,t)}function qt(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=Wt(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function Wt(e,t){var n=function(e){if(null==e)return jt;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){s||(t=n=0);var u=2,c=e.length,l=new Array(c);for(l[0]=(t+=e[0])*r+a,l[1]=(n+=e[1])*i+o;u<c;)l[u]=e[u],++u;return l}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a)t.push(n(i[a],a));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,o)}function a(e){return n(e)}function o(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function u(e){return e.map(s)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=a(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(a);break;case"LineString":n=o(t.arcs);break;case"MultiLineString":n=t.arcs.map(o);break;case"Polygon":n=u(t.arcs);break;case"MultiPolygon":n=t.arcs.map(u);break;default:return null}return{type:r,coordinates:n}}(t)}function Vt(e,t){var n={},r={},i={},a=[],o=-1;function s(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++o],t[o]=n,t[r]=i)})),t.forEach((function(t){var n,a,o=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];return e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1],t<0?[n,i]:[i,n]}(t),s=o[0],u=o[1];if(n=i[s])if(delete i[n.end],n.push(t),n.end=u,a=r[u]){delete r[a.start];var c=a===n?n:n.concat(a);r[c.start=n.start]=i[c.end=a.end]=c}else r[n.start]=i[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(t),n.start=s,a=i[s]){delete i[a.end];var l=a===n?n:a.concat(n);r[l.start=a.start]=i[l.end=n.end]=l}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=s]=i[n.end=u]=n})),s(i,r),s(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a}function $t(e){return Wt(e,Ht.apply(this,arguments))}function Ht(e,t,n){var r,i,a;if(arguments.length>1)r=Gt(0,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:Vt(e,r)}}function Gt(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function s(e){e.forEach(o)}function u(e){e.forEach(s)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":u(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(u)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}var Kt=Math.sqrt(50),Xt=Math.sqrt(10),Yt=Math.sqrt(2);function Jt(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=Zt(e,t,n))||!isFinite(o))return[];if(o>0){let n=Math.round(e/o),r=Math.round(t/o);for(n*o<e&&++n,r*o>t&&--r,a=new Array(i=r-n+1);++s<i;)a[s]=(n+s)*o}else{o=-o;let n=Math.round(e*o),r=Math.round(t*o);for(n/o<e&&++n,r/o>t&&--r,a=new Array(i=r-n+1);++s<i;)a[s]=(n+s)/o}return r&&a.reverse(),a}function Zt(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=Kt?10:a>=Xt?5:a>=Yt?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Kt?10:a>=Xt?5:a>=Yt?2:1)}function Qt(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=Kt?i*=10:a>=Xt?i*=5:a>=Yt&&(i*=2),t<e?-i:i}var en,tn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nn(e){if(!(t=tn.exec(e)))throw new Error("invalid format: "+e);var t;return new rn({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function rn(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function an(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function on(e){return(e=an(Math.abs(e)))?e[1]:NaN}function sn(e,t){var n=an(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}nn.prototype=rn.prototype,rn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const un={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>sn(100*e,t),r:sn,s:function(e,t){var n=an(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(en=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+an(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function cn(e){return e}var ln,fn,pn,hn=Array.prototype.map,dn=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function mn(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?cn:(t=hn.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?cn:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(hn.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=nn(e)).fill,n=e.align,f=e.sign,p=e.symbol,h=e.zero,d=e.width,m=e.comma,g=e.precision,v=e.trim,y=e.type;"n"===y?(m=!0,y="g"):un[y]||(void 0===g&&(g=12),v=!0,y="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var b="$"===p?i:"#"===p&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===p?a:/[%p]/.test(y)?u:"",w=un[y],E=/[defgprs%]/.test(y);function C(e){var i,a,u,p=b,C=x;if("c"===y)C=w(e)+C,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?l:w(Math.abs(e),g),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==f&&(S=!1),p=(S?"("===f?f:c:"-"===f||"("===f?"":f)+p,C=("s"===y?dn[8+en/3]:"")+C+(S&&"("===f?")":""),E)for(i=-1,a=e.length;++i<a;)if(48>(u=e.charCodeAt(i))||u>57){C=(46===u?o+e.slice(i+1):e.slice(i))+C,e=e.slice(0,i);break}}m&&!h&&(e=r(e,1/0));var N=p.length+e.length+C.length,A=N<d?new Array(d-N+1).join(t):"";switch(m&&h&&(e=r(A+e,A.length?d-C.length:1/0),A=""),n){case"<":e=p+e+C+A;break;case"=":e=p+A+e+C;break;case"^":e=A.slice(0,N=A.length>>1)+p+e+C+A.slice(N);break;default:e=A+p+e+C}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),C.toString=function(){return e+""},C}return{format:f,formatPrefix:function(e,t){var n=f(((e=nn(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(on(t)/3))),i=Math.pow(10,-r),a=dn[8+r/3];return function(e){return n(i*e)+a}}}}ln=mn({thousands:",",grouping:[3],currency:["$",""]}),fn=ln.format,pn=ln.formatPrefix;var gn=new Date,vn=new Date;function yn(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return yn((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return gn.setTime(+t),vn.setTime(+r),e(gn),e(vn),Math.floor(n(gn,vn))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}const bn=1e3,xn=6e4,wn=36e5,En=864e5,Cn=6048e5,Sn=31536e6;var Nn=yn((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*xn)/En),(e=>e.getDate()-1));const An=Nn;function kn(e){return yn((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*xn)/Cn}))}Nn.range;var Dn=kn(0),_n=kn(1),Mn=kn(2),Tn=kn(3),On=kn(4),In=kn(5),Fn=kn(6),Rn=(Dn.range,_n.range,Mn.range,Tn.range,On.range,In.range,Fn.range,yn((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/En}),(function(e){return e.getUTCDate()-1})));const Bn=Rn;function zn(e){return yn((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Cn}))}Rn.range;var Pn=zn(0),Ln=zn(1),jn=zn(2),Un=zn(3),qn=zn(4),Wn=zn(5),Vn=zn(6),$n=(Pn.range,Ln.range,jn.range,Un.range,qn.range,Wn.range,Vn.range,yn((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()})));$n.every=function(e){return isFinite(e=Math.floor(e))&&e>0?yn((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};const Hn=$n;$n.range;var Gn=yn((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}));const Kn=Gn;Gn.range;var Xn=yn((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*bn-e.getMinutes()*xn)}),(function(e,t){e.setTime(+e+t*wn)}),(function(e,t){return(t-e)/wn}),(function(e){return e.getHours()}));const Yn=Xn;Xn.range;var Jn=yn((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*bn)}),(function(e,t){e.setTime(+e+t*xn)}),(function(e,t){return(t-e)/xn}),(function(e){return e.getMinutes()}));const Zn=Jn;Jn.range;var Qn=yn((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*bn)}),(function(e,t){return(t-e)/bn}),(function(e){return e.getUTCSeconds()}));const er=Qn;Qn.range;var tr=yn((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));tr.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?yn((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):tr:null};const nr=tr;tr.range;var rr=yn((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));rr.every=function(e){return isFinite(e=Math.floor(e))&&e>0?yn((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};const ir=rr;rr.range;var ar=yn((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}));const or=ar;ar.range;var sr=yn((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*wn)}),(function(e,t){return(t-e)/wn}),(function(e){return e.getUTCHours()}));const ur=sr;sr.range;var cr=yn((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*xn)}),(function(e,t){return(t-e)/xn}),(function(e){return e.getUTCMinutes()}));const lr=cr;function fr(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function pr(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>fr(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}cr.range;const hr="year",dr="quarter",mr="month",gr="week",vr="date",yr="day",br="dayofyear",xr="hours",wr="minutes",Er="seconds",Cr="milliseconds",Sr=[hr,dr,mr,gr,vr,yr,br,xr,wr,Er,Cr],Nr=Sr.reduce(((e,t,n)=>(e[t]=1+n,e)),{});function Ar(e){const t=Ge(e).slice(),n={};return t.length||oe("Missing time unit."),t.forEach((e=>{st(Nr,e)?n[e]=1:oe("Invalid time unit: ".concat(e,"."))})),(n[gr]||n[yr]?1:0)+(n[dr]||n[mr]||n[vr]?1:0)+(n[br]?1:0)>1&&oe("Incompatible time units: ".concat(e)),t.sort(((e,t)=>Nr[e]-Nr[t])),t}const kr={[hr]:"%Y ",[dr]:"Q%q ",[mr]:"%b ",[vr]:"%d ",[gr]:"W%U ",[yr]:"%a ",[br]:"%j ",[xr]:"%H:00",[wr]:"00:%M",[Er]:":%S",[Cr]:".%L",["".concat(hr,"-").concat(mr)]:"%Y-%m ",["".concat(hr,"-").concat(mr,"-").concat(vr)]:"%Y-%m-%d ",["".concat(xr,"-").concat(wr)]:"%H:%M"};function Dr(e,t){const n=rt({},kr,t),r=Ar(e),i=r.length;let a,o,s="",u=0;for(u=0;u<i;)for(a=r.length;a>u;--a)if(o=r.slice(u,a).join("-"),null!=n[o]){s+=n[o],u=a;break}return s.trim()}const _r=new Date;function Mr(e){return _r.setFullYear(e),_r.setMonth(0),_r.setDate(1),_r.setHours(0,0,0,0),_r}function Tr(e){return Ir(new Date(e))}function Or(e){return Fr(new Date(e))}function Ir(e){return An.count(Mr(e.getFullYear())-1,e)}function Fr(e){return Dn.count(Mr(e.getFullYear())-1,e)}function Rr(e){return Mr(e).getDay()}function Br(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function zr(e){return Lr(new Date(e))}function Pr(e){return jr(new Date(e))}function Lr(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Bn.count(t-1,e)}function jr(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Pn.count(t-1,e)}function Ur(e){return _r.setTime(Date.UTC(e,0,1)),_r.getUTCDay()}function qr(e,t,n,r,i,a,o){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,a,o));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,a,o))}function Wr(e,t,n,r,i){const a=t||1,o=De(e),s=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===o&&a,t),u=new Date,c=Tt(e),l=c[hr]?s(hr):tt(2012),f=c[mr]?s(mr):c[dr]?s(dr):fe,p=c[gr]&&c[yr]?s(yr,1,gr+yr):c[gr]?s(gr,1):c[yr]?s(yr,1):c[vr]?s(vr,1):c[br]?s(br,1):pe,h=c[xr]?s(xr):fe,d=c[wr]?s(wr):fe,m=c[Er]?s(Er):fe,g=c[Cr]?s(Cr):fe;return function(e){u.setTime(+e);const t=l(u);return i(t,f(u),p(u,t),h(u),d(u),m(u),g(u))}}function Vr(e,t,n){return t+7*e-(n+6)%7}const $r={[hr]:e=>e.getFullYear(),[dr]:e=>Math.floor(e.getMonth()/3),[mr]:e=>e.getMonth(),[vr]:e=>e.getDate(),[xr]:e=>e.getHours(),[wr]:e=>e.getMinutes(),[Er]:e=>e.getSeconds(),[Cr]:e=>e.getMilliseconds(),[br]:e=>Ir(e),[gr]:e=>Fr(e),[gr+yr]:(e,t)=>Vr(Fr(e),e.getDay(),Rr(t)),[yr]:(e,t)=>Vr(1,e.getDay(),Rr(t))},Hr={[dr]:e=>3*e,[gr]:(e,t)=>Vr(e,0,Rr(t))};function Gr(e,t){return Wr(e,t||1,$r,Hr,Br)}const Kr={[hr]:e=>e.getUTCFullYear(),[dr]:e=>Math.floor(e.getUTCMonth()/3),[mr]:e=>e.getUTCMonth(),[vr]:e=>e.getUTCDate(),[xr]:e=>e.getUTCHours(),[wr]:e=>e.getUTCMinutes(),[Er]:e=>e.getUTCSeconds(),[Cr]:e=>e.getUTCMilliseconds(),[br]:e=>Lr(e),[gr]:e=>jr(e),[yr]:(e,t)=>Vr(1,e.getUTCDay(),Ur(t)),[gr+yr]:(e,t)=>Vr(jr(e),e.getUTCDay(),Ur(t))},Xr={[dr]:e=>3*e,[gr]:(e,t)=>Vr(e,0,Ur(t))};function Yr(e,t){return Wr(e,t||1,Kr,Xr,qr)}const Jr={[hr]:Hn,[dr]:Kn.every(3),[mr]:Kn,[gr]:Dn,[vr]:An,[yr]:An,[br]:An,[xr]:Yn,[wr]:Zn,[Er]:er,[Cr]:nr},Zr={[hr]:ir,[dr]:or.every(3),[mr]:or,[gr]:Pn,[vr]:Bn,[yr]:Bn,[br]:Bn,[xr]:ur,[wr]:lr,[Er]:er,[Cr]:nr};function Qr(e){return Jr[e]}function ei(e){return Zr[e]}function ti(e,t,n){return e?e.offset(t,n):void 0}function ni(e,t,n){return ti(Qr(e),t,n)}function ri(e,t,n){return ti(ei(e),t,n)}function ii(e,t,n,r){return e?e.range(t,n,r):void 0}function ai(e,t,n,r){return ii(Qr(e),t,n,r)}function oi(e,t,n,r){return ii(ei(e),t,n,r)}const si=31536e6,ui=[hr,mr,vr,xr,wr,Er,Cr],ci=ui.slice(0,-1),li=ci.slice(0,-1),fi=li.slice(0,-1),pi=fi.slice(0,-1),hi=[hr,mr],di=[hr],mi=[[ci,1,1e3],[ci,5,5e3],[ci,15,15e3],[ci,30,3e4],[li,1,6e4],[li,5,3e5],[li,15,9e5],[li,30,18e5],[fi,1,36e5],[fi,3,108e5],[fi,6,216e5],[fi,12,432e5],[pi,1,864e5],[[hr,gr],1,6048e5],[hi,1,2592e6],[hi,3,7776e6],[di,1,si]];function gi(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(Nt(t))/n;let i,a,o=pr((e=>e[2])).right(mi,r);return o===mi.length?(i=di,a=Qt(t[0]/si,t[1]/si,n)):o?(o=mi[r/mi[o-1][2]<mi[o][2]/r?o-1:o],i=o[0],a=o[1]):(i=ui,a=Math.max(Qt(t[0],t[1],n),1)),{units:i,step:a}}function vi(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function yi(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function bi(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function xi(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,u=e.shortMonths,c=Oi(i),l=Ii(i),f=Oi(a),p=Ii(a),h=Oi(o),d=Ii(o),m=Oi(s),g=Ii(s),v=Oi(u),y=Ii(u),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:ea,e:ea,f:aa,g:ga,G:ya,H:ta,I:na,j:ra,L:ia,m:oa,M:sa,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Ua,s:qa,S:ua,u:ca,U:la,V:pa,w:ha,W:da,x:null,X:null,y:ma,Y:va,Z:ba,"%":ja},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:xa,e:xa,f:Na,g:Ba,G:Pa,H:wa,I:Ea,j:Ca,L:Sa,m:Aa,M:ka,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Ua,s:qa,S:Da,u:_a,U:Ma,V:Oa,w:Ia,W:Fa,x:null,X:null,y:Ra,Y:za,Z:La,"%":ja},w={a:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return S(e,t,n,r)},d:Vi,e:Vi,f:Yi,g:ji,G:Li,H:Hi,I:Hi,j:$i,L:Xi,m:Wi,M:Gi,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=l.get(r[0].toLowerCase()),n+r[0].length):-1},q:qi,Q:Zi,s:Qi,S:Ki,u:Ri,U:Bi,V:zi,w:Fi,W:Pi,x:function(e,t,r){return S(e,n,t,r)},X:function(e,t,n){return S(e,r,t,n)},y:ji,Y:Li,Z:Ui,"%":Ji};function E(e,t){return function(n){var r,i,a,o=[],s=-1,u=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===e.charCodeAt(s)&&(o.push(e.slice(u,s)),null!=(i=Ai[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),u=s+1);return o.push(e.slice(u,s)),o.join("")}}function C(e,t){return function(n){var r,i,a=bi(1900,void 0,1);if(S(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=yi(bi(a.y,0,1))).getUTCDay(),r=i>4||0===i?Ln.ceil(r):Ln(r),r=Bn.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=vi(bi(a.y,0,1))).getDay(),r=i>4||0===i?_n.ceil(r):_n(r),r=An.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?yi(bi(a.y,0,1)).getUTCDay():vi(bi(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,yi(a)):vi(a)}}function S(e,t,n,r){for(var i,a,o=0,s=t.length,u=n.length;o<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in Ai?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=E(n,b),b.X=E(r,b),b.c=E(t,b),x.x=E(n,x),x.X=E(r,x),x.c=E(t,x),{format:function(e){var t=E(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=C(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=E(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=C(e+="",!0);return t.toString=function(){return e},t}}}var wi,Ei,Ci,Si,Ni,Ai={"-":"",_:" ",0:"0"},ki=/^\s*\d+/,Di=/^%/,_i=/[\\^$*+?|[\]().{}]/g;function Mi(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function Ti(e){return e.replace(_i,"\\$&")}function Oi(e){return new RegExp("^(?:"+e.map(Ti).join("|")+")","i")}function Ii(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}function Fi(e,t,n){var r=ki.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Ri(e,t,n){var r=ki.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Bi(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function zi(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Pi(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Li(e,t,n){var r=ki.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function ji(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Ui(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function qi(e,t,n){var r=ki.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function Wi(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Vi(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function $i(e,t,n){var r=ki.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Hi(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Gi(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Ki(e,t,n){var r=ki.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Xi(e,t,n){var r=ki.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Yi(e,t,n){var r=ki.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Ji(e,t,n){var r=Di.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Zi(e,t,n){var r=ki.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Qi(e,t,n){var r=ki.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function ea(e,t){return Mi(e.getDate(),t,2)}function ta(e,t){return Mi(e.getHours(),t,2)}function na(e,t){return Mi(e.getHours()%12||12,t,2)}function ra(e,t){return Mi(1+An.count(Hn(e),e),t,3)}function ia(e,t){return Mi(e.getMilliseconds(),t,3)}function aa(e,t){return ia(e,t)+"000"}function oa(e,t){return Mi(e.getMonth()+1,t,2)}function sa(e,t){return Mi(e.getMinutes(),t,2)}function ua(e,t){return Mi(e.getSeconds(),t,2)}function ca(e){var t=e.getDay();return 0===t?7:t}function la(e,t){return Mi(Dn.count(Hn(e)-1,e),t,2)}function fa(e){var t=e.getDay();return t>=4||0===t?On(e):On.ceil(e)}function pa(e,t){return e=fa(e),Mi(On.count(Hn(e),e)+(4===Hn(e).getDay()),t,2)}function ha(e){return e.getDay()}function da(e,t){return Mi(_n.count(Hn(e)-1,e),t,2)}function ma(e,t){return Mi(e.getFullYear()%100,t,2)}function ga(e,t){return Mi((e=fa(e)).getFullYear()%100,t,2)}function va(e,t){return Mi(e.getFullYear()%1e4,t,4)}function ya(e,t){var n=e.getDay();return Mi((e=n>=4||0===n?On(e):On.ceil(e)).getFullYear()%1e4,t,4)}function ba(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Mi(t/60|0,"0",2)+Mi(t%60,"0",2)}function xa(e,t){return Mi(e.getUTCDate(),t,2)}function wa(e,t){return Mi(e.getUTCHours(),t,2)}function Ea(e,t){return Mi(e.getUTCHours()%12||12,t,2)}function Ca(e,t){return Mi(1+Bn.count(ir(e),e),t,3)}function Sa(e,t){return Mi(e.getUTCMilliseconds(),t,3)}function Na(e,t){return Sa(e,t)+"000"}function Aa(e,t){return Mi(e.getUTCMonth()+1,t,2)}function ka(e,t){return Mi(e.getUTCMinutes(),t,2)}function Da(e,t){return Mi(e.getUTCSeconds(),t,2)}function _a(e){var t=e.getUTCDay();return 0===t?7:t}function Ma(e,t){return Mi(Pn.count(ir(e)-1,e),t,2)}function Ta(e){var t=e.getUTCDay();return t>=4||0===t?qn(e):qn.ceil(e)}function Oa(e,t){return e=Ta(e),Mi(qn.count(ir(e),e)+(4===ir(e).getUTCDay()),t,2)}function Ia(e){return e.getUTCDay()}function Fa(e,t){return Mi(Ln.count(ir(e)-1,e),t,2)}function Ra(e,t){return Mi(e.getUTCFullYear()%100,t,2)}function Ba(e,t){return Mi((e=Ta(e)).getUTCFullYear()%100,t,2)}function za(e,t){return Mi(e.getUTCFullYear()%1e4,t,4)}function Pa(e,t){var n=e.getUTCDay();return Mi((e=n>=4||0===n?qn(e):qn.ceil(e)).getUTCFullYear()%1e4,t,4)}function La(){return"+0000"}function ja(){return"%"}function Ua(e){return+e}function qa(e){return Math.floor(+e/1e3)}function Wa(e){const t={};return n=>t[n]||(t[n]=e(n))}function Va(e){const t=Wa(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=nn(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=function(e,t){let n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if(n=e.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const o=a<r.length?r.slice(a):"";for(;--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,r,i,a){a=nn(null==a?",f":a);const o=Qt(e,r,i),s=Math.max(Math.abs(e),Math.abs(r));let u;if(null==a.precision)switch(a.type){case"s":return isNaN(u=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(on(t)/3)))-on(Math.abs(e)))}(o,s))||(a.precision=u),n(a,s);case"":case"e":case"g":case"p":case"r":isNaN(u=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,on(t)-on(e))+1}(o,s))||(a.precision=u-("e"===a.type));break;case"f":case"%":isNaN(u=function(e){return Math.max(0,-on(Math.abs(e)))}(o))||(a.precision=u-2*("%"===a.type))}return t(a)}}}let $a,Ha;function Ga(){return $a=Va({format:fn,formatPrefix:pn})}function Ka(e){return Va(mn(e))}function Xa(e){return arguments.length?$a=Ka(e):$a}function Ya(e,t,n){Ce(n=n||{})||oe("Invalid time multi-format specifier: ".concat(n));const r=t(Er),i=t(wr),a=t(xr),o=t(vr),s=t(gr),u=t(mr),c=t(dr),l=t(hr),f=e(n[Cr]||".%L"),p=e(n[Er]||":%S"),h=e(n[wr]||"%I:%M"),d=e(n[xr]||"%I %p"),m=e(n[vr]||n[yr]||"%a %d"),g=e(n[gr]||"%b %d"),v=e(n[mr]||"%B"),y=e(n[dr]||"%B"),b=e(n[hr]||"%Y");return e=>(r(e)<e?f:i(e)<e?p:a(e)<e?h:o(e)<e?d:u(e)<e?s(e)<e?m:g:l(e)<e?c(e)<e?v:y:b)(e)}function Ja(e){const t=Wa(e.format),n=Wa(e.utcFormat);return{timeFormat:e=>yt(e)?t(e):Ya(t,Qr,e),utcFormat:e=>yt(e)?n(e):Ya(n,ei,e),timeParse:Wa(e.parse),utcParse:Wa(e.utcParse)}}function Za(){return Ha=Ja({format:Ei,parse:Ci,utcFormat:Si,utcParse:Ni})}function Qa(e){return Ja(xi(e))}function eo(e){return arguments.length?Ha=Qa(e):Ha}wi=xi({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Ei=wi.format,Ci=wi.parse,Si=wi.utcFormat,Ni=wi.utcParse,Ga(),Za();const to=(e,t)=>rt({},e,t);function no(e,t){const n=e?Ka(e):Xa(),r=t?Qa(t):eo();return to(n,r)}function ro(e,t){const n=arguments.length;return n&&2!==n&&oe("defaultLocale expects either zero or two arguments."),n?to(Xa(e),eo(t)):to(Xa(),eo())}function io(){return Ga(),Za(),ro()}const ao=/^(data:|([A-Za-z]+:)?\/\/)/,oo=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,so=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,uo="file://";async function co(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function lo(e,t){t=rt({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,o;const s=oo.test(e.replace(so,""));null!=e&&"string"==typeof e&&s||oe("Sanitize failure, invalid URI: "+At(e));const u=ao.test(e);return(o=t.baseURL)&&!u&&(e.startsWith("/")||o.endsWith("/")||(e="/"+e),e=o+e),a=(i=e.startsWith(uo))||"file"===t.mode||"http"!==t.mode&&!u&&n,i?e=e.slice(uo.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function fo(e){return e?t=>new Promise(((n,r)=>{e.readFile(t,((e,t)=>{e?r(e):n(t)}))})):po}async function po(){oe("No file system access.")}function ho(e){return e?async function(t,n){const r=rt({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?Xe(a[i])?a[i]():a.text():oe(a.status+""+a.statusText)}:mo}async function mo(){oe("No HTTP fetch method available.")}const go=e=>!(Number.isNaN(+e)||e instanceof Date),vo={boolean:kt,integer:_e,number:_e,date:_t,string:Mt,unknown:le},yo=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>go(e)&&Number.isInteger(+e),go,e=>!Number.isNaN(Date.parse(e))],bo=["boolean","integer","number","date"];function xo(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=yo.length,i=yo.map(((e,t)=>t+1));for(let o,s,u=0,c=0;u<n;++u)for(s=t?e[u][t]:e[u],o=0;o<r;++o)if(i[o]&&null!=(a=s)&&a==a&&!yo[o](s)&&(i[o]=0,++c,c===yo.length))return"string";var a;return bo[i.reduce(((e,t)=>0===e?t:e),0)-1]}function wo(e,t){return t.reduce(((t,n)=>(t[n]=xo(e,n),t)),{})}function Eo(e){const t=function(t,n){const r={delimiter:e};return Co(t,n?rt(n,r):r)};return t.responseType="text",t}function Co(e,t){return t.header&&(e=t.header.map(At).join(t.delimiter)+"\n"+e),Lt(t.delimiter).parse(e+"")}function So(e,t){const n=t&&t.property?ue(t.property):le;return!Ce(e)||(r=e,"function"==typeof Buffer&&Xe(Buffer.isBuffer)&&Buffer.isBuffer(r))?n(JSON.parse(e)):function(e,t){return!Ee(e)&&mt(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t);var r}Co.responseType="text",So.responseType="json";const No={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Ao(e,t){let n,r,i,a;return e=So(e,t),t&&t.feature?(n=Ut,i=t.feature):t&&t.mesh?(n=$t,i=t.mesh,a=No[t.filter]):oe("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):oe("Invalid TopoJSON object: "+i),r&&r.features||[r]}Ao.responseType="json";const ko={dsv:Co,csv:Eo(","),tsv:Eo("\t"),json:So,topojson:Ao};function Do(e,t){return arguments.length>1?(ko[e]=t,this):st(ko,e)?ko[e]:null}function _o(e){const t=Do(e);return t&&t.responseType||"text"}function Mo(e,t,n,r){const i=Do((t=t||{}).type||"json");return i||oe("Unknown data format type: "+t.type),e=i(e,t),t.parse&&function(e,t,n,r){if(!e.length)return;const i=eo();n=n||i.timeParse,r=r||i.utcParse;let a,o,s,u,c,l,f=e.columns||Object.keys(e[0]);"auto"===t&&(t=wo(e,f)),f=Object.keys(t);const p=f.map((e=>{const i=t[e];let a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:")))return a=i.split(/:(.+)?/,2),o=a[1],("'"===o[0]&&"'"===o[o.length-1]||'"'===o[0]&&'"'===o[o.length-1])&&(o=o.slice(1,-1)),("utc"===a[0]?r:n)(o);if(!vo[i])throw Error("Illegal format pattern: "+e+":"+i);return vo[i]}));for(s=0,c=e.length,l=f.length;s<c;++s)for(a=e[s],u=0;u<l;++u)o=f[u],a[o]=p[u](a[o])}(e,t.parse,n,r),st(e,"columns")&&delete e.columns,e}const To=function(e,t){return t=>({options:t||{},sanitize:lo,load:co,fileAccess:!1,file:fo(null),http:ho(e)})}("undefined"!=typeof fetch&&fetch);function Oo(e){const t=e||le,n=[],r={};return n.add=e=>{const i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=e=>{const i=t(e);if(r[i]){r[i]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function Io(e,t){try{await t(e)}catch(t){e.error(t)}}const Fo=Symbol("vega_id");let Ro=1;function Bo(e){return!(!e||!zo(e))}function zo(e){return e[Fo]}function Po(e,t){return e[Fo]=t,e}function Lo(e){const t=e===Object(e)?e:{data:e};return zo(t)?t:Po(t,Ro++)}function jo(e){return Uo(e,Lo({}))}function Uo(e,t){for(const n in e)t[n]=e[n];return t}function qo(e,t){return Po(t,zo(e))}function Wo(e,t){return e?t?(n,r)=>e(n,r)||zo(t(n))-zo(t(r)):(t,n)=>e(t,n)||zo(t)-zo(n):null}function Vo(e){return e&&e.constructor===$o}function $o(){const e=[],t=[],n=[],r=[],i=[];let a=null,o=!1;return{constructor:$o,insert(t){const n=Ge(t),r=n.length;for(let t=0;t<r;++t)e.push(n[t]);return this},remove(e){const n=Xe(e)?r:t,i=Ge(e),a=i.length;for(let e=0;e<a;++e)n.push(i[e]);return this},modify(e,t,r){const a={field:t,value:tt(r)};return Xe(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode(e,t){return Xe(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return a=e,this},reflow(){return o=!0,this},pulse(s,u){const c={},l={};let f,p,h,d,m,g;for(f=0,p=u.length;f<p;++f)c[zo(u[f])]=1;for(f=0,p=t.length;f<p;++f)m=t[f],c[zo(m)]=-1;for(f=0,p=r.length;f<p;++f)d=r[f],u.forEach((e=>{d(e)&&(c[zo(e)]=-1)}));for(f=0,p=e.length;f<p;++f)m=e[f],g=zo(m),c[g]?c[g]=1:s.add.push(Lo(e[f]));for(f=0,p=u.length;f<p;++f)m=u[f],c[zo(m)]<0&&s.rem.push(m);function v(e,t,n){n?e[t]=n(e):s.encode=t,o||(l[zo(e)]=e)}for(f=0,p=n.length;f<p;++f)h=n[f],m=h.tuple,d=h.field,g=c[zo(m)],g>0&&(v(m,d,h.value),s.modifies(d));for(f=0,p=i.length;f<p;++f)h=i[f],d=h.filter,u.forEach((e=>{d(e)&&c[zo(e)]>0&&v(e,h.field,h.value)})),s.modifies(h.field);if(o)s.mod=t.length||r.length?u.filter((e=>c[zo(e)]>0)):u.slice();else for(g in l)s.mod.push(l[g]);return(a||null==a&&(t.length||r.length))&&s.clean(!0),s}}}const Ho="_:mod:_";function Go(){Object.defineProperty(this,Ho,{writable:!0,value:{}})}Go.prototype={set(e,t,n,r){const i=this,a=i[e],o=i[Ho];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=Ee(n)?1+n.length:-1),i},modified(e,t){const n=this[Ho];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(Ee(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[Ho]={},this}};let Ko=0;const Xo=new Go;function Yo(e,t,n,r){this.id=++Ko,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function Jo(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Yo.prototype={targets(){return this._targets||(this._targets=Oo(ce))},set(e){return this.value!==e?(this.value=e,1):0},skip:Jo(1),modified:Jo(2),parameters(e,t,n){t=!1!==t;const r=this._argval=this._argval||new Go,i=this._argops=this._argops||[],a=[];let o,s,u,c;const l=(e,n,o)=>{o instanceof Yo?(o!==this&&(t&&o.targets().add(this),a.push(o)),i.push({op:o,name:e,index:n})):r.set(e,n,o)};for(o in e)if(s=e[o],"pulse"===o)Ge(s).forEach((e=>{e instanceof Yo?e!==this&&(e.targets().add(this),a.push(e)):oe("Pulse parameters must be operator instances.")})),this.source=s;else if(Ee(s))for(r.set(o,-1,Array(u=s.length)),c=0;c<u;++c)l(o,c,s[c]);else l(o,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||Xo,n=this._argops;let r,i,a,o;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],a=r.op,o=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,o);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let Zo=0;function Qo(e,t,n){this.id=++Zo,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function es(e,t,n){return new Qo(e,t,n)}Qo.prototype={_filter:he,_apply:le,targets(){return this._targets||(this._targets=Oo(ce))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let e=0;e<r;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=es(e);return this.targets().add(t),t},apply(e){const t=es(null,e);return this.targets().add(t),t},merge(){const e=es();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter((()=>{const n=Date.now();return n-t>e?(t=n,1):0}))},debounce(e){const t=es();return this.targets().add(es(null,null,nt(e,(e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},between(e,t){let n=!1;return e.targets().add(es(null,null,(()=>n=!0))),t.targets().add(es(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){this._filter=he,this._targets=null}};const ts={skip:!0};function ns(e,t,n,r,i,a){const o=rt({},a,ts);let s,u;Xe(n)||(n=tt(n)),void 0===r?s=t=>e.touch(n(t)):Xe(r)?(u=new Yo(null,r,i,!1),s=t=>{u.evaluate(t);const r=n(t),i=u.value;Vo(i)?e.pulse(r,i,a):e.update(r,i,o)}):s=t=>e.update(n(t),r,o),t.apply(s)}function rs(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{const o=a||{},s=new Yo(null,function(e,t){return t=Xe(t)?t:tt(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}const is={};function as(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function os(e,t){const n=[];return It(e,t,(e=>n.push(e))),n}function ss(e,t){const n={};return e.visit(t,(e=>{n[zo(e)]=1})),e=>n[zo(e)]?null:e}function us(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function cs(e,t,n,r){const i=this,a=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let e=0;e<a;++e){const r=n[e];if(r.stamp===t){if(r.fields){const e=i.fields||(i.fields={});for(const t in r.fields)e[t]=1}r.changed(i.ADD)&&(o|=i.ADD),r.changed(i.REM)&&(o|=i.REM),r.changed(i.MOD)&&(o|=i.MOD)}}this.changes=o}function ls(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}as.prototype={StopPropagation:is,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new as(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new as(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,ss(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Ee(e)?e.forEach((e=>t[e]=!0)):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Ee(e)?e.some((e=>n[e])):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=us(n.addF,t)),2&e&&(n.remF=us(n.remF,t)),4&e&&(n.modF=us(n.modF,t)),16&e&&(n.srcF=us(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=os(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=os(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=os(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return It(n.source,n.srcF,r),n;1&e&&It(n.add,n.addF,r),2&e&&It(n.rem,n.remF,r),4&e&&It(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const e=n.add.length+n.mod.length;e===i.length||It(i,e?ss(n,5):n.srcF,r)}return n}},ft(cs,as,{fork(e){const t=new as(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(e=>t.add.push(e))),e&t.REM&&this.visit(t.REM,(e=>t.rem.push(e))),e&t.MOD&&this.visit(t.MOD,(e=>t.mod.push(e)))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Ee(e)?e.some((e=>n[e])):n[e]:0},filter(){oe("MultiPulse does not support filtering.")},materialize(){oe("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});const fs={skip:!1,force:!1};function ps(e,t,n,r){let i,a;const o=e[n];for(;n>t&&(a=n-1>>1,i=e[a],r(o,i)<0);)e[n]=i,n=a;return e[n]=o}function hs(){this.logger(we()),this.logLevel(ve),this._clock=0,this._rank=0,this._locale=ro();try{this._loader=To()}catch(e){}this._touched=Oo(ce),this._input={},this._pulse=null,this._heap=function(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),ps(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(e,t,n){const r=t,i=e.length,a=e[t];let o,s=1+(t<<1);for(;s<i;)o=s+1,o<i&&n(e[s],e[o])>=0&&(s=o),e[t]=e[s],s=1+((t=s)<<1);e[t]=a,ps(e,r,t,n)}(t,0,e)):r=n,r}}}(((e,t)=>e.qrank-t.qrank)),this._postrun=[]}function ds(e){return function(){return this._log[e].apply(this,arguments)}}function ms(e,t){Yo.call(this,e,null,t)}hs.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:ds("error"),warn:ds("warn"),info:ds("info"),debug:ds("debug"),logLevel:ds("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,a=1;return e instanceof Yo?i=e:e&&e.prototype instanceof Yo?i=new e:Xe(e)?i=new Yo(null,e):(a=0,i=new Yo(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&oe("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||fs);const r=new as(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||fs;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||fs;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:$o,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Mo(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(e){let t;const n=new Promise((e=>t=e));return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(he).insert(a.data||[])),i.done(),a},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:_o(t&&t.type)});try{r=n.parse(r,t)}catch(t){i=-2,n.warn("Data ingestion failed",e,t)}}catch(t){i=-1,n.warn("Loading failed",e,t)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,a=es(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(e){i.error(e)}finally{i.run()}};let s;s="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):Ge(e);const u=s.length;for(let e=0;e<u;++e)s[e].addEventListener(t,o);return a},on:function(e,t,n,r,i){return(e instanceof Yo?rs:ns)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return ls(r);if(r._pending&&await r._pending,t&&await Io(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new as(r,a,e),r._touched.forEach((e=>r._enqueue(e,!0))),r._touched=Oo(ce);let o,s,u,c=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(s=o.run(r._getPulse(o,e)),s.then?s=await s:s.async&&(i.push(s.async),s=is),s!==is&&o._targets&&o._targets.forEach((e=>r._enqueue(e))),++c):r._enqueue(o,!0)}catch(e){r._heap.clear(),u=e}if(r._input={},r._pulse=null,r.debug(`Pulse ${a}: ${c} operators`),u&&(r._postrun=[],r.error(u)),r._postrun.length){const e=r._postrun.sort(((e,t)=>t.priority-e.priority));r._postrun=[];for(let t=0;t<e.length;++t)await Io(r,e[t].callback)}return n&&await Io(r,n),i.length&&Promise.all(i).then((e=>r.runAsync(null,(()=>{e.forEach((e=>{try{e(r)}catch(e){r.error(e)}}))})))),r},run:function(e,t,n){return this._pulse?ls(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(e){this.error(e)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&Ee(n)?new cs(this,r,n.map((e=>e.pulse)),t):this._input[e.id]||function(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==is&&(e.source=t.source),e)}(this._pulse,n&&n.pulse)}},ft(ms,Yo,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then((e=>this.pulse=e)):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const gs={};function vs(e){const t=ys(e);return t&&t.Definition||null}function ys(e){return e=e&&e.toLowerCase(),st(gs,e)?gs[e]:null}function bs(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function xs(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function ws(e,t,n=0,r=e.length-1,i=fr){for(;r>n;){if(r-n>600){const a=r-n+1,o=t-n+1,s=Math.log(a),u=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*u*(a-u)/a)*(o-a/2<0?-1:1);ws(e,t,Math.max(n,Math.floor(t-o*u/a+c)),Math.min(r,Math.floor(t+(a-o)*u/a+c)),i)}const a=e[t];let o=n,s=r;for(Es(e,n,t),i(e[r],a)>0&&Es(e,n,r);o<s;){for(Es(e,o,s),++o,--s;i(e[o],a)<0;)++o;for(;i(e[s],a)>0;)--s}0===i(e[n],a)?Es(e,n,s):(++s,Es(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function Es(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Cs(e){return null===e?NaN:+e}function Ss(e,t,n){if(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n)),r=e.length){if((t=+t)<=0||r<2)return xs(e);if(t>=1)return bs(e);var r,i=(r-1)*t,a=Math.floor(i),o=bs(ws(e,a).subarray(0,a+1));return o+(xs(e.subarray(a+1))-o)*(i-a)}}function Ns(e,t,n=Cs){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}function As(e,t){return Ss(e,.5,t)}function*ks(e,t){if(null==t)for(let t of e)null!=t&&""!==t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)r=t(r,++n,e),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function Ds(e,t,n){const r=Float64Array.from(ks(e,n));return r.sort(fr),t.map((e=>Ns(r,e)))}function _s(e,t){return Ds(e,[.25,.5,.75],t)}function Ms(e,t){const n=e.length,r=function(e,t){const n=function(e,t){let n,r=0,i=0,a=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-i,i+=n/++r,a+=n*(t-i));else{let o=-1;for(let s of e)null!=(s=t(s,++o,e))&&(s=+s)>=s&&(n=s-i,i+=n/++r,a+=n*(s-i))}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=_s(e,t),a=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function Ts(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a,o,s,u,c,l,f=e.extent[0],p=e.extent[1];const h=e.span||p-f||Math.abs(f)||1;if(e.step)a=e.step;else if(e.steps){for(u=h/t,c=0,l=e.steps.length;c<l&&e.steps[c]<u;++c);a=e.steps[Math.max(0,c-1)]}else{for(o=Math.ceil(Math.log(t)/r),s=e.minstep||0,a=Math.max(s,Math.pow(n,Math.round(Math.log(h)/r)-o));Math.ceil(h/a)>t;)a*=n;for(c=0,l=i.length;c<l;++c)u=a/i[c],u>=s&&h/u<=t&&(a=u)}u=Math.log(a);const d=u>=0?0:1+~~(-u/r),m=Math.pow(n,-d-1);return(e.nice||void 0===e.nice)&&(u=Math.floor(f/a+m)*a,f=f<u?u-a:u,p=Math.ceil(p/a)*a),{start:f,stop:p===f?f+a:p,step:a}}var Os=Math.random;function Is(e){Os=e}function Fs(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(ks(e,r)),a=i.length,o=t;let s,u,c,l;for(c=0,l=Array(o);c<o;++c){for(s=0,u=0;u<a;++u)s+=i[~~(Os()*a)];l[c]=s/a}return l.sort(fr),[Ss(l,n/2),Ss(l,1-n/2)]}function Rs(e,t,n,r){r=r||(e=>e);const i=e.length,a=new Float64Array(i);let o,s=0,u=1,c=r(e[0]),l=c,f=c+t;for(;u<i;++u){if(o=r(e[u]),o>=f){for(l=(c+l)/2;s<u;++s)a[s]=l;f=o+t,c=o}l=o}for(l=(c+l)/2;s<u;++s)a[s]=l;return n?function(e,t){const n=e.length;let r,i,a=0,o=1;for(;e[a]===e[o];)++o;for(;o<n;){for(r=o+1;e[o]===e[r];)++r;if(e[o]-e[o-1]<t){for(i=o+(a+r-o-o>>1);i<o;)e[i++]=e[o];for(;i>o;)e[i--]=e[a]}a=o,o=r}return e}(a,t+t/4):a}function Bs(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function zs(e,t){let n,r,i;null==t&&(t=e,e=0);const a={min(e){return arguments.length?(n=e||0,i=r-n,a):n},max(e){return arguments.length?(r=e||0,i=r-n,a):r},sample:()=>n+Math.floor(i*Os()),pdf:e=>e===Math.floor(e)&&e>=n&&e<r?1/i:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*i):NaN};return a.min(e).max(t)}const Ps=Math.sqrt(2*Math.PI),Ls=Math.SQRT2;let js=NaN;function Us(e,t){e=e||0,t=null==t?1:t;let n,r,i=0,a=0;if(js==js)i=js,js=NaN;else{do{i=2*Os()-1,a=2*Os()-1,n=i*i+a*a}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,js=a*r}return e+i*t}function qs(e,t,n){const r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*Ps)}function Ws(e,t,n){const r=(e-(t=t||0))/(n=null==n?1:n),i=Math.abs(r);let a;if(i>37)a=0;else{const e=Math.exp(-i*i/2);let t;i<7.07106781186547?(t=.0352624965998911*i+.700383064443688,t=t*i+6.37396220353165,t=t*i+33.912866078383,t=t*i+112.079291497871,t=t*i+221.213596169931,t=t*i+220.206867912376,a=e*t,t=.0883883476483184*i+1.75566716318264,t=t*i+16.064177579207,t=t*i+86.7807322029461,t=t*i+296.564248779674,t=t*i+637.333633378831,t=t*i+793.826512519948,t=t*i+440.413735824752,a/=t):(t=i+.65,t=i+4/t,t=i+3/t,t=i+2/t,t=i+1/t,a=e/t/2.506628274631)}return r>0?1-a:a}function Vs(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*Ls*function(e){let t,n=-Math.log((1-e)*(1+e));return n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0,t*e}(2*e-1)}function $s(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Us(n,r),pdf:e=>qs(e,n,r),cdf:e=>Ws(e,n,r),icdf:e=>Vs(e,n,r)};return i.mean(e).stdev(t)}function Hs(e,t){const n=$s();let r=0;const i={data(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=Ms(e)),i):t},sample:()=>e[~~(Os()*r)]+t*n.sample(),pdf(i){let a=0,o=0;for(;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},cdf(i){let a=0,o=0;for(;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Gs(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+Us()*t)}function Ks(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*Ps*e)}function Xs(e,t,n){return Ws(Math.log(e),t,n)}function Ys(e,t,n){return Math.exp(Vs(e,t,n))}function Js(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Gs(n,r),pdf:e=>Ks(e,n,r),cdf:e=>Xs(e,n,r),icdf:e=>Ys(e,n,r)};return i.mean(e).stdev(t)}function Zs(e,t){let n,r=0;const i={weights(e){return arguments.length?(n=function(e){const t=[];let n,i=0;for(n=0;n<r;++n)i+=t[n]=null==e[n]?1:+e[n];for(n=0;n<r;++n)t[n]/=i;return t}(t=e||[]),i):t},distributions(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample(){const t=Os();let i=e[r-1],a=n[0],o=0;for(;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},pdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function Qs(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*Os()}function eu(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function tu(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function nu(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function ru(e,t){let n,r;const i={min(e){return arguments.length?(n=e||0,i):n},max(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Qs(n,r),pdf:e=>eu(e,n,r),cdf:e=>tu(e,n,r),icdf:e=>nu(e,n,r)};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function iu(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function au(e,t,n,r){e=e.filter((e=>{let r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&e.sort(((e,n)=>t(e)-t(n)));const i=e.length,a=new Float64Array(i),o=new Float64Array(i);let s,u,c,l=0,f=0,p=0;for(c of e)a[l]=s=+t(c),o[l]=u=+n(c),++l,f+=(s-f)/l,p+=(u-p)/l;for(l=0;l<i;++l)a[l]-=f,o[l]-=p;return[a,o,f,p]}function ou(e,t,n,r){let i,a,o=-1;for(const s of e)i=t(s),a=n(s),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++o)}function su(e,t,n,r,i){let a=0,o=0;return ou(e,t,n,((e,t)=>{const n=t-i(e),s=t-r;a+=n*n,o+=s*s})),1-a/o}function uu(e,t,n){let r=0,i=0,a=0,o=0,s=0;ou(e,t,n,((e,t)=>{++s,r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const u=iu(r,i,a,o),c=e=>u[0]+u[1]*e;return{coef:u,predict:c,rSquared:su(e,t,n,i,c)}}function cu(e,t,n){let r=0,i=0,a=0,o=0,s=0;ou(e,t,n,((e,t)=>{++s,e=Math.log(e),r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const u=iu(r,i,a,o),c=e=>u[0]+u[1]*Math.log(e);return{coef:u,predict:c,rSquared:su(e,t,n,i,c)}}function lu(e,t,n){const[r,i,a,o]=au(e,t,n);let s,u,c,l=0,f=0,p=0,h=0,d=0;ou(e,t,n,((e,t)=>{s=r[d++],u=Math.log(t),c=s*t,l+=(t*u-l)/d,f+=(c-f)/d,p+=(c*u-p)/d,h+=(s*c-h)/d}));const[m,g]=iu(f/o,l/o,p/o,h/o),v=e=>Math.exp(m+g*(e-a));return{coef:[Math.exp(m-g*a),g],predict:v,rSquared:su(e,t,n,o,v)}}function fu(e,t,n){let r=0,i=0,a=0,o=0,s=0,u=0;ou(e,t,n,((e,t)=>{const n=Math.log(e),c=Math.log(t);++u,r+=(n-r)/u,i+=(c-i)/u,a+=(n*c-a)/u,o+=(n*n-o)/u,s+=(t-s)/u}));const c=iu(r,i,a,o),l=e=>c[0]*Math.pow(e,c[1]);return c[0]=Math.exp(c[0]),{coef:c,predict:l,rSquared:su(e,t,n,s,l)}}function pu(e,t,n){const[r,i,a,o]=au(e,t,n),s=r.length;let u,c,l,f,p=0,h=0,d=0,m=0,g=0;for(u=0;u<s;)c=r[u],l=i[u++],f=c*c,p+=(f-p)/u,h+=(f*c-h)/u,d+=(f*f-d)/u,m+=(c*l-m)/u,g+=(f*l-g)/u;const v=d-p*p,y=p*v-h*h,b=(g*p-m*h)/y,x=(m*v-g*h)/y,w=-b*p,E=e=>b*(e-=a)*e+x*e+w+o;return{coef:[w-x*a+b*a*a+o,x-2*b*a,b],predict:E,rSquared:su(e,t,n,o,E)}}function hu(e,t,n,r){if(1===r)return uu(e,t,n);if(2===r)return pu(e,t,n);const[i,a,o,s]=au(e,t,n),u=i.length,c=[],l=[],f=r+1;let p,h,d,m,g;for(p=0;p<f;++p){for(d=0,m=0;d<u;++d)m+=Math.pow(i[d],p)*a[d];for(c.push(m),g=new Float64Array(f),h=0;h<f;++h){for(d=0,m=0;d<u;++d)m+=Math.pow(i[d],p+h);g[h]=m}l.push(g)}l.push(c);const v=function(e){const t=e.length-1,n=[];let r,i,a,o,s;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(a=r;a<t+1;++a)s=e[a][r],e[a][r]=e[a][o],e[a][o]=s;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*n[a];n[i]=(e[t][i]-s)/e[i][i]}return n}(l),y=e=>{e-=o;let t=s+v[0]+v[1]*e+v[2]*e*e;for(p=3;p<f;++p)t+=v[p]*Math.pow(e,p);return t};return{coef:du(f,v,-o,s),predict:y,rSquared:su(e,t,n,s,y)}}function du(e,t,n,r){const i=Array(e);let a,o,s,u;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],u=1,i[a]+=s,o=1;o<=a;++o)u*=(a+1-o)/o,i[a-o]+=s*Math.pow(n,o)*u;return i[0]+=r,i}function mu(e,t,n,r){const[i,a,o,s]=au(e,t,n,!0),u=i.length,c=Math.max(2,~~(r*u)),l=new Float64Array(u),f=new Float64Array(u),p=new Float64Array(u).fill(1);for(let e=-1;++e<=2;){const t=[0,c-1];for(let e=0;e<u;++e){const n=i[e],r=t[0],o=t[1],s=n-i[r]>i[o]-n?r:o;let u=0,c=0,h=0,d=0,m=0;const g=1/Math.abs(i[s]-n||1);for(let e=r;e<=o;++e){const t=i[e],r=a[e],o=gu(Math.abs(n-t)*g)*p[e],s=t*o;u+=o,c+=s,h+=r*o,d+=r*s,m+=t*s}const[v,y]=iu(c/u,h/u,d/u,m/u);l[e]=v+y*n,f[e]=Math.abs(a[e]-l[e]),vu(i,e+1,t)}if(2===e)break;const n=As(f);if(Math.abs(n)<1e-12)break;for(let e,t,r=0;r<u;++r)e=f[r]/(6*n),p[r]=e>=1?1e-12:(t=1-e*e)*t}return function(e,t,n,r){const i=e.length,a=[];let o,s=0,u=0,c=[];for(;s<i;++s)o=e[s]+n,c[0]===o?c[1]+=(t[s]-c[1])/++u:(u=0,c[1]+=r,c=[o,t[s]],a.push(c));return c[1]+=r,a}(i,l,o,s)}function gu(e){return(e=1-e*e*e)*e*e}function vu(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}const yu=.5*Math.PI/180;function bu(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=t=>[t,e(t)],a=t[0],o=t[1],s=o-a,u=s/r,c=[i(a)],l=[];if(n===r){for(let e=1;e<r;++e)c.push(i(a+e/n*s));return c.push(i(o)),c}l.push(i(o));for(let e=n;--e>0;)l.push(i(a+e/n*s));let f=c[0],p=l[l.length-1];const h=1/s,d=function(e,t){let n=e,r=e;const i=t.length;for(let e=0;e<i;++e){const i=t[e][1];i<n&&(n=i),i>r&&(r=i)}return 1/(r-n)}(f[1],l);for(;p;){const e=i((f[0]+p[0])/2);e[0]-f[0]>=u&&xu(f,e,p,h,d)>yu?l.push(e):(f=p,c.push(p),l.pop()),p=l[l.length-1]}return c}function xu(e,t,n,r,i){const a=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),o=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(a-o)}function wu(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function Eu(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}):function(){return""};var t}function Cu(e,t,n){return n||e+(t?"_"+t:"")}const Su=()=>{},Nu={init:Su,add:Su,rem:Su,idx:0},Au={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},ku=Object.keys(Au);function Du(e,t){return Au[e](t)}function _u(e,t){return e.idx-t.idx}function Mu(){this.valid=0,this.missing=0,this._ops.forEach((e=>e.init(this)))}function Tu(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach((n=>n.add(this,e,t)))):++this.missing}function Ou(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach((n=>n.rem(this,e,t)))):--this.missing}function Iu(e){return this._out.forEach((t=>e[t.out]=t.value(this))),e}function Fu(e,t){const n=t||le,r=function(e){const t={};e.forEach((e=>t[e.name]=e));const n=e=>{e.req&&e.req.forEach((e=>{t[e]||n(t[e]=Au[e]())}))};return e.forEach(n),Object.values(t).sort(_u)}(e),i=e.slice().sort(_u);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=Mu,a.prototype.add=Tu,a.prototype.rem=Ou,a.prototype.set=Iu,a.prototype.get=n,a.fields=e.map((e=>e.out)),a}function Ru(e){this._key=e?ue(e):zo,this.reset()}ku.forEach((e=>{Au[e]=function(e,t){return n=>rt({name:e,out:n||e},Nu,t)}(e,Au[e])}));const Bu=Ru.prototype;function zu(e){ms.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function Pu(e){ms.call(this,null,e)}function Lu(e,t,n){const r=e;let i=t||[],a=n||[],o={},s=0;return{add:e=>a.push(e),remove:e=>o[r(e)]=++s,size:()=>i.length,data:(e,t)=>(s&&(i=i.filter((e=>!o[r(e)])),o={},s=0),t&&e&&i.sort(e),a.length&&(i=e?Et(e,i,a.sort(e)):i.concat(a),a=[]),i)}}function ju(e){ms.call(this,[],e)}function Uu(e){Yo.call(this,null,qu,e)}function qu(e){return this.value&&!e.modified()?this.value:Ye(e.fields,e.orders)}function Wu(e){ms.call(this,null,e)}function Vu(e){ms.call(this,null,e)}Bu.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Bu.add=function(e){this._add.push(e)},Bu.rem=function(e){this._rem.push(e)},Bu.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};let s,u,c;for(s=0;s<i;++s)o[n(t[s])]=1;for(s=0,u=0;s<r;++s)o[n(c=e[s])]?o[n(c)]=0:a[u++]=c;return this._rem=[],this._add=a},Bu.distinct=function(e){const t=this.values(),n={};let r,i=t.length,a=0;for(;--i>=0;)r=e(t[i])+"",st(n,r)||(n[r]=1,++a);return a},Bu.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=at(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Bu.argmin=function(e){return this.extent(e)[0]||{}},Bu.argmax=function(e){return this.extent(e)[1]||{}},Bu.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},Bu.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},Bu.quartile=function(e){return this._get===e&&this._q||(this._q=_s(this.values(),e),this._get=e),this._q},Bu.q1=function(e){return this.quartile(e)[0]},Bu.q2=function(e){return this.quartile(e)[1]},Bu.q3=function(e){return this.quartile(e)[2]},Bu.ci=function(e){return this._get===e&&this._ci||(this._ci=Fs(this.values(),1e3,.05,e),this._get=e),this._ci},Bu.ci0=function(e){return this.ci(e)[0]},Bu.ci1=function(e){return this.ci(e)[1]},zu.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:ku},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},ft(zu,ms,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(n.value=n.value||n.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),r.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter((()=>this.clean())),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map((()=>({}))),i=n.length;function a(e){let t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<i;++a)r[a][s=o[n[a]]]=s}a(e._prev),a(t),function a(o,s,u){const c=n[u],l=r[u++];for(const n in l){const r=o?o+"|"+n:n;s[c]=l[n],u<i?a(r,s,u):t[r]||e.cell(r,s)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(e){const n=Ge(ne(e)),i=n.length;let a,o=0;for(;o<i;++o)r[a=n[o]]||(r[a]=1,t.push(a))}this._dims=Ge(e.groupby),this._dnames=this._dims.map((e=>{const t=te(e);return i(e),n.push(t),t})),this.cellkey=e.key?e.key:Eu(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],o=e.ops||["count"],s=e.as||[],u=a.length,c={};let l,f,p,h,d,m;for(u!==o.length&&oe("Unmatched number of fields and aggregate ops."),m=0;m<u;++m)l=a[m],f=o[m],null==l&&"count"!==f&&oe("Null aggregate field specified."),h=te(l),d=Cu(f,h,s[m]),n.push(d),"count"!==f?(p=c[h],p||(i(l),p=c[h]=[],p.field=l,this._measures.push(p)),"count"!==f&&(this._countOnly=!1),p.push(Du(f,d))):this._counts.push(d);return this._measures=this._measures.map((e=>Fu(e,e.field))),{}},cellkey:Eu(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let r=0;r<t;++r)n.agg[r]=new e[r](n)}return n.store&&(n.data=new Ru),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let t=0;t<i;++t)a[n[t]]=r[t](e);return t?qo(t.tuple,a):Lo(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].add(r[t].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].rem(r[t].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,r=n.length;e<r;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;let u,c,l,f;if(r)for(c in r)u=r[c],i&&!u.num||o.push(u.tuple);for(l=0,f=this._alen;l<f;++l)a.push(this.celltuple(t[l])),t[l]=null;for(l=0,f=this._mlen;l<f;++l)u=n[l],(0===u.num&&i?o:s).push(this.celltuple(u)),n[l]=null;return this._alen=this._mlen=0,this._prev=null,e}}),Pu.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},ft(Pu,ms,{transform(e,t){const n=!1!==e.interval,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],u=o[1];let c;return c=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(ne(e.field))?t.ADD_MOD:t.ADD,t.visit(c,n?e=>{const t=r(e);e[s]=t,e[u]=null==t?null:i+a*(1+(t-i)/a)}:e=>e[s]=r(e)),t.modifies(n?o:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Ts(e),r=n.step;let i,a,o=n.start,s=o+Math.ceil((n.stop-o)/r)*r;null!=(i=e.anchor)&&(a=i-(o+r*Math.floor((i-o)/r)),o+=a,s+=a);const u=function(e){let n=_e(t(e));return null==n?null:n<o?-1/0:n>s?1/0:(n=Math.max(o,Math.min(n,s-r)),o+r*Math.floor(1e-14+(n-o)/r))};return u.start=o,u.stop=n.stop,u.step=r,this.value=ee(u,ne(t),e.name||"bin_"+te(t))}}),ju.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},ft(ju,ms,{transform(e,t){const n=t.fork(t.ALL),r=Lu(zo,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(Wo(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),ft(Uu,Yo),Wu.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},ft(Wu,ms,{transform(e,t){const n=t=>n=>{for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(s(n),e.case,a)||[],u=0,c=i.length;u<c;++u)o.test(r=i[u])||t(r)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,u=e.as||["text","count"],c=n((e=>i[e]=1+(i[e]||0))),l=n((e=>i[e]-=1));return r?t.visit(t.SOURCE,c):(t.visit(t.ADD,c),t.visit(t.REM,l)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,u,c;for(s in n)u=r[s],c=n[s]||0,!u&&c?(r[s]=u=Lo({}),u[i]=s,u[a]=c,o.add.push(u)):0===c?(u&&o.rem.push(u),n[s]=null,r[s]=null):u[a]!==c&&(u[a]=c,o.mod.push(u));return o.modifies(t)}}),Vu.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},ft(Vu,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],s={},u=e.length,c=0;c<u;++c)for(s[t]=a=e[c],i=0;i<u;++i)s[n]=e[i],r(s)&&(o.push(Lo(s)),(s={})[t]=a);return o}(s,i,a,e.filter||he)):n.mod=s,n.source=this.value,n.modifies(r)}});const $u={kde:Hs,mixture:Zs,normal:$s,lognormal:Js,uniform:ru};function Hu(e,t){const n=e.function;st($u,n)||oe("Unknown distribution function: "+n);const r=$u[n]();for(const n in e)"field"===n?r.data((e.from||t()).map(e[n])):"distributions"===n?r[n](e[n].map((e=>Hu(e,t)))):"function"==typeof r[n]&&r[n](e[n]);return r}function Gu(e){ms.call(this,null,e)}const Ku=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Xu={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Ku},{name:"weights",type:"number",array:!0}]};function Yu(e,t){return e?e.map(((e,n)=>t[n]||te(e))):null}function Ju(e,t,n){const r=[],i=e=>e(u);let a,o,s,u,c,l;if(null==t)r.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)u=e[o],c=t.map(i),l=a[c],l||(a[c]=l=[],l.dims=c,r.push(l)),l.push(n(u));return r}function Zu(e){ms.call(this,null,e)}function Qu(e){Yo.call(this,null,ec,e),this.modified(!0)}function ec(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:ee((n=>t(n,e)),ne(t),te(t))}function tc(e){ms.call(this,[void 0,void 0],e)}function nc(e,t){Yo.call(this,e),this.parent=t,this.count=0}function rc(e){ms.call(this,{},e),this._keys=ct();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function ic(e){Yo.call(this,null,ac,e)}function ac(e){return this.value&&!e.modified()?this.value:Ee(e.name)?Ge(e.name).map((e=>ue(e))):ue(e.name,e.as)}function oc(e){ms.call(this,ct(),e)}function sc(e){ms.call(this,[],e)}function uc(e){ms.call(this,[],e)}function cc(e){ms.call(this,null,e)}function lc(e){ms.call(this,[],e)}Gu.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Ku.concat(Xu)},{name:"as",type:"string",array:!0,default:["value","density"]}]},ft(Gu,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Hu(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&oe("Invalid density method: "+o),e.extent||r.data||oe("Missing density extent parameter."),o=r[o];const s=e.as||["value","density"],u=bu(o,e.extent||it(r.data()),i,a).map((e=>{const t={};return t[s[0]]=e[0],t[s[1]]=e[1],Lo(t)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),Zu.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},ft(Zu,ms,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=Ju(t.source,e.groupby,le),i=e.smooth||!1,a=e.field,o=e.step||((e,t)=>Nt(it(e,t))/30)(n,a),s=Wo(((e,t)=>a(e)-a(t))),u=e.as||"bin",c=r.length;let l,f=1/0,p=-1/0,h=0;for(;h<c;++h){const e=r[h].sort(s);l=-1;for(const t of Rs(e,o,i,a))t<f&&(f=t),t>p&&(p=t),e[++l][u]=t}return this.value={start:f,stop:p,step:o},t.reflow(!0).modifies(u)}}),ft(Qu,Yo),tc.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},ft(tc,ms,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],o=n[1];if((i||null==a)&&(a=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,(e=>{const t=_e(r(e));null!=t&&(t<a&&(a=t),t>o&&(o=t))})),!Number.isFinite(a)||!Number.isFinite(o)){let e=te(r);e&&(e=` for field "${e}"`),t.dataflow.warn(`Infinite extent${e}: [${a}, ${o}]`),a=o=void 0}this.value=[a,o]}}),ft(nc,Yo,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),ft(rc,ms,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a,o,s=st(i,e)&&i[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(o=r||(o=this._group[e])&&o.tuple,a=n.dataflow,s=new nc(n.fork(n.NO_SOURCE),this),a.add(s).connect(t(a,e,o)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;let t=0;for(const n in e)if(0===e[n].count){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const e=this._targets.filter((e=>e&&e.count>0));this.initTargets(e)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&null!=t[i];++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,o=e.modified("key"),s=e=>this.subflow(e,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,(e=>{const t=zo(e),n=a.get(t);void 0!==n&&(a.delete(t),s(n).rem(e))})),t.visit(t.ADD,(e=>{const t=r(e);a.set(zo(e),t),s(t).add(e)})),o||t.modified(r.fields)?t.visit(t.MOD,(e=>{const t=zo(e),n=a.get(t),i=r(e);n===i?s(i).mod(e):(a.set(t,i),s(n).rem(e),s(i).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(e=>{s(a.get(zo(e))).mod(e)})),o&&t.visit(t.REFLOW,(e=>{const t=zo(e),n=a.get(t),i=r(e);n!==i&&(a.set(t,i),s(n).rem(e),s(i).add(e))})),t.clean()?n.runAfter((()=>{this.clean(),a.clean()})):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),ft(ic,Yo),oc.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},ft(oc,ms,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,u=e.expr;let c=!0;function l(t){const n=zo(t),i=u(t,e),l=r.get(n);i&&l?(r.delete(n),a.push(t)):i||l?c&&i&&!l&&s.push(t):(r.set(n,1),o.push(t))}return t.visit(t.REM,(e=>{const t=zo(e);r.has(t)?r.delete(t):o.push(e)})),t.visit(t.ADD,(t=>{u(t,e)?a.push(t):r.set(zo(t),1)})),t.visit(t.MOD,l),e.modified()&&(c=!1,t.visit(t.REFLOW,l)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),sc.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},ft(sc,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Yu(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{const t=r.map((t=>t(e))),s=t.reduce(((e,t)=>Math.max(e,t.length)),0);let u,c,l,f=0;for(;f<s;++f){for(c=jo(e),u=0;u<o;++u)c[i[u]]=null==(l=t[u][f])?null:l;a&&(c[a]=f),n.add.push(c)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),uc.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},ft(uc,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(te),a=e.as||["key","value"],o=a[0],s=a[1],u=r.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{for(let t,a=0;a<u;++a)t=jo(e),t[o]=i[a],t[s]=r[a](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(a)}}),cc.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},ft(cc,ms,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,(t=>t[r]=n(t,e)))}}),ft(lc,ms,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,a,o,s=this.value,u=e.size-s.length;if(u>0){for(i=[];--u>=0;)i.push(o=Lo(r(e))),s.push(o);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else a=s.slice(0,-u),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,s=s.slice(-u);return n.source=this.value=s,n}});const fc={value:"value",median:As,mean:function(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:xs,max:bs},pc=[];function hc(e){ms.call(this,[],e)}function dc(e){zu.call(this,e)}function mc(e){ms.call(this,null,e)}function gc(e){Yo.call(this,null,vc,e)}function vc(e){return this.value&&!e.modified()?this.value:bt(e.fields,e.flat)}function yc(e){ms.call(this,[],e),this._pending=null}function bc(e,t,n){n.forEach(Lo);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function xc(e){ms.call(this,{},e)}function wc(e){Yo.call(this,null,Ec,e)}function Ec(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,a=1/0,o=-1/0;for(r=0;r<n;++r)i=t[r],i[0]<a&&(a=i[0]),i[1]>o&&(o=i[1]);return[a,o]}function Cc(e){Yo.call(this,null,Sc,e)}function Sc(e){return this.value&&!e.modified()?this.value:e.values.reduce(((e,t)=>e.concat(t)),[])}function Nc(e){ms.call(this,null,e)}function Ac(e){zu.call(this,e)}function kc(e){rc.call(this,e)}function Dc(e){ms.call(this,null,e)}function _c(e){ms.call(this,null,e)}function Mc(e){ms.call(this,null,e)}function Tc(e){ms.call(this,null,e)}function Oc(e){ms.call(this,[],e),this.count=0}function Ic(e){ms.call(this,null,e)}function Fc(e){ms.call(this,null,e),this.modified(!0)}function Rc(e){ms.call(this,null,e)}hc.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},ft(hc,ms,{transform(e,t){var n,r,i,a,o,s,u,c,l,f,p=t.fork(t.ALL),h=function(e){var t,n=e.method||fc.value;if(null!=fc[n])return n===fc.value?(t=void 0!==e.value?e.value:0,()=>t):fc[n];oe("Unrecognized imputation method: "+n)}(e),d=function(e){const t=e.field;return e=>e?t(e):NaN}(e),m=te(e.field),g=te(e.key),v=(e.groupby||[]).map(te),y=function(e,t,n,r){var i,a,o,s,u,c,l,f,p=e=>e(f),h=[],d=r?r.slice():[],m={},g={};for(d.forEach(((e,t)=>m[e]=t+1)),s=0,l=e.length;s<l;++s)c=n(f=e[s]),u=m[c]||(m[c]=d.push(c)),(o=g[a=(i=t?t.map(p):pc)+""])||(o=g[a]=[],h.push(o),o.values=i),o[u-1]=f;return h.domain=d,h}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=y.domain.length;for(o=0,c=y.length;o<c;++o)for(i=(n=y[o]).values,r=NaN,u=0;u<w;++u)if(null==n[u]){for(a=y.domain[u],f={_impute:!0},s=0,l=i.length;s<l;++s)f[v[s]]=i[s];f[g]=a,f[m]=Number.isNaN(r)?r=h(n,d):r,b.push(Lo(f))}return b.length&&(p.add=p.materialize(p.ADD).add.concat(b)),x.length&&(p.rem=p.materialize(p.REM).rem.concat(x)),this.value=b,p}}),dc.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:ku},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},ft(dc,zu,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(i=n.value=n.value||this.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),n.changes(),t.visit(t.SOURCE,(e=>{rt(e,i[n.cellkey(e)].tuple)})),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),mc.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},ft(mc,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Ju(r,e.groupby,e.field),a=(e.groupby||[]).map(te),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],c=[];let l=e.extent,f=e.steps||e.minsteps||25,p=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&oe("Invalid density method: "+s),"shared"===e.resolve&&(l||(l=it(r,e.field)),f=p=e.steps||p),i.forEach((t=>{const n=Hs(t,o)[s],r=e.counts?t.length:1;bu(n,l||it(t),f,p).forEach((e=>{const n={};for(let e=0;e<a.length;++e)n[a[e]]=t.dims[e];n[u[0]]=e[0],n[u[1]]=e[1]*r,c.push(Lo(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}}),ft(gc,Yo),ft(yc,ms,{transform(e,t){const n=t.dataflow;if(this._pending)return bc(this,t,this._pending);if(function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e))return t.StopPropagation;if(e.values)return bc(this,t,n.parse(e.values,e.format));if(e.async){const t=n.request(e.url,e.format).then((e=>(this._pending=Ge(e.data),e=>e.touch(this))));return{async:t}}return n.request(e.url,e.format).then((e=>bc(this,t,Ge(e.data))))}}),xc.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},ft(xc,ms,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=null==e.default?null:e.default,o=e.modified(),s=n.length;let u,c,l,f=o?t.SOURCE:t.ADD,p=t,h=e.as;return i?(c=i.length,s>1&&!h&&oe('Multi-field lookup requires explicit "as" parameter.'),h&&h.length!==s*c&&oe('The "as" parameter has too few output field names.'),h=h||i.map(te),u=function(e){for(var t,o,u=0,l=0;u<s;++u)if(null==(o=r.get(n[u](e))))for(t=0;t<c;++t,++l)e[h[l]]=a;else for(t=0;t<c;++t,++l)e[h[l]]=i[t](o)}):(h||oe("Missing output field names."),u=function(e){for(var t,i=0;i<s;++i)t=r.get(n[i](e)),e[h[i]]=null==t?a:t}),o?p=t.reflow(!0):(l=n.some((e=>t.modified(e.fields))),f|=l?t.MOD:0),t.visit(f,u),p.modifies(h)}}),ft(wc,Yo),ft(Cc,Yo),ft(Nc,ms,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Ac.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:ku,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},ft(Ac,zu,{_transform:zu.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=ne(n).concat(ne(r)),o=function(e,t,n){const r={},i=[];return n.visit(n.SOURCE,(t=>{const n=e(t);r[n]||(r[n]=1,i.push(n))})),i.sort(Je),t?i.slice(0,t):i}(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map((()=>i)),fields:o.map((e=>function(e,t,n,r){return ee((r=>t(r)===e?n(r):NaN),r,e+"")}(e,n,r,a))),as:o.map((e=>e+"")),modified:e.modified.bind(e)}}(e,t),t)}}),ft(kc,rc,{transform(e,t){const n=e.subflow,r=e.field,i=e=>this.subflow(zo(e),n,t,e);return(e.modified("field")||r&&t.modified(ne(r)))&&oe("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,(e=>{const t=i(e);r(e).forEach((e=>t.mod(e)))})),t.visit(t.ADD,(e=>{const t=i(e);r(e).forEach((e=>t.add(Lo(e))))})),t.visit(t.REM,(e=>{const t=i(e);r(e).forEach((e=>t.rem(e)))}))):(t.visit(t.MOD,(e=>i(e).mod(e))),t.visit(t.ADD,(e=>i(e).add(e))),t.visit(t.REM,(e=>i(e).rem(e)))),t.clean()&&t.runAfter((()=>this.clean())),t}}),Dc.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},ft(Dc,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Yu(e.fields,e.as||[]),a=r?(e,t)=>function(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,r,i):Uo;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,(e=>{const t=zo(e);n.rem.push(o[t]),o[t]=null})),t.visit(t.ADD,(e=>{const t=a(e,Lo({}));o[zo(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{n.mod.push(a(e,o[zo(e)]))})),n}}),ft(_c,ms,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),Mc.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},ft(Mc,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=Ju(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map(te),o=[],s=e.step||.01,u=e.probs||wu(s/2,1-1e-14,s),c=u.length;return i.forEach((e=>{const t=Ds(e,u);for(let n=0;n<c;++n){const i={};for(let t=0;t<a.length;++t)i[a[t]]=e.dims[t];i[r[0]]=u[n],i[r[1]]=t[n],o.push(Lo(i))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),ft(Tc,ms,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,(e=>{const t=zo(e);n.rem.push(r[t]),r[t]=null})),t.visit(t.ADD,(e=>{const t=jo(e);r[zo(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{const t=r[zo(e)];for(const r in e)t[r]=e[r],n.modifies(r);n.mod.push(t)}))),n}}),Oc.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},ft(Oc,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce(((e,t)=>(e[zo(t)]=1,e)),{});let o=this.value,s=this.count,u=0;function c(e){let t,r;o.length<i?o.push(e):(r=~~((s+1)*Os()),r<o.length&&r>=u&&(t=o[r],a[zo(t)]&&n.rem.push(t),o[r]=e)),++s}if(t.rem.length&&(t.visit(t.REM,(e=>{const t=zo(e);a[t]&&(a[t]=-1,n.rem.push(e)),--s})),o=o.filter((e=>-1!==a[zo(e)]))),(t.rem.length||r)&&o.length<i&&t.source&&(u=s=o.length,t.visit(t.SOURCE,(e=>{a[zo(e)]||c(e)})),u=-1),r&&o.length>i){const e=o.length-i;for(let t=0;t<e;++t)a[zo(o[t])]=-1,n.rem.push(o[t]);o=o.slice(e)}return t.mod.length&&t.visit(t.MOD,(e=>{a[zo(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,c),(t.add.length||u<0)&&(n.add=o.filter((e=>!a[zo(e)]))),this.count=s,this.value=n.source=o,n}}),Ic.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},ft(Ic,ms,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=wu(e.start,e.stop,e.step||1).map((e=>{const t={};return t[r]=e,Lo(t)})),n.add=t.add.concat(this.value),n}}),ft(Fc,ms,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Bc=["unit0","unit1"];function zc(e){ms.call(this,ct(),e)}function Pc(e){ms.call(this,null,e)}Rc.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:Sr,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Bc}]},ft(Rc,ms,{transform(e,t){const n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),o=(i?ei:Qr)(a.unit).offset,s=e.as||Bc,u=s[0],c=s[1],l=a.step;let f=a.start||1/0,p=a.stop||-1/0,h=t.ADD;return(e.modified()||t.modified(ne(n)))&&(h=(t=t.reflow(!0)).SOURCE,f=1/0,p=-1/0),t.visit(h,(e=>{const t=n(e);let i,s;null==t?(e[u]=null,r&&(e[c]=null)):(e[u]=i=s=a(t),r&&(e[c]=s=o(i,l)),i<f&&(f=i),s>p&&(p=s))})),a.start=f,a.stop=p,t.modifies(r?s:u)},_floor(e,t){const n="utc"===e.timezone,{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:gi({extent:e.extent||it(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=Ar(r),o=this.value||{},s=(n?Yr:Gr)(a,i);return s.unit=De(a),s.units=a,s.step=i,s.start=o.start,s.stop=o.stop,this.value=s}}),ft(zc,ms,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=e=>i.set(r(e),e);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,(e=>i.delete(r(e)))),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),ft(Pc,ms,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Wo(e.sort)):t.source).map(e.field))}});const Lc={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=Lc.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||oe("ntile num must be greater than zero.");const n=Lc.cume_dist(),r=n.next;return{init:n.init,next:e=>Math.ceil(t*r(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||oe("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(e,t,n){for(let r=t.length;n<r;++n)if(null!=e(t[n]))return n;return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}},jc=Object.keys(Lc);function Uc(e){const t=Ge(e.ops),n=Ge(e.fields),r=Ge(e.params),i=Ge(e.as),a=this.outputs=[],o=this.windows=[],s={},u={},c=[],l=[];let f=!0;function p(e){Ge(ne(e)).forEach((e=>s[e]=1))}p(e.sort),t.forEach(((e,t)=>{const s=n[t],h=te(s),d=Cu(e,h,i[t]);if(p(s),a.push(d),st(Lc,e))o.push(function(e,t,n,r){const i=Lc[e](t,n);return{init:i.init||fe,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],d));else{if(null==s&&"count"!==e&&oe("Null aggregate field specified."),"count"===e)return void c.push(d);f=!1;let t=u[h];t||(t=u[h]=[],t.field=s,l.push(t)),t.push(Du(e,d))}})),(c.length||l.length)&&(this.cell=function(e,t,n){e=e.map((e=>Fu(e,e.field)));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new Ru;return r.add=function(e){if(r.num+=1,!n){s&&s.add(e);for(let t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){s&&s.rem(e);for(let t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){let i,o;for(s&&s.values(),i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)},r.init=function(){r.num=0,s&&s.reset();for(let e=0;e<i;++e)a[e].init()},r}(l,c,f)),this.inputs=Object.keys(s)}const qc=Uc.prototype;function Wc(e){ms.call(this,{},e),this._mlen=0,this._mods=[]}function Vc(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),u=s.length,c=a?pr(i):null,l={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||tt(-1)};t.init();for(let e=0;e<u;++e)$c(l,o,e,u),a&&Hc(l,c),t.update(l,s[e])}function $c(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Hc(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}function Gc(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Kc(e){this._context=e}function Xc(){}function Yc(e){this._context=e}function Jc(e){this._context=e}function Zc(e,t){this._basis=new Kc(e),this._beta=t}qc.init=function(){this.windows.forEach((e=>e.init())),this.cell&&this.cell.init()},qc.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)},Wc.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:jc.concat(ku)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},ft(Wc,ms,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=Wo(e.sort),i=Eu(e.groupby),a=e=>this.group(i(e));let o=this.state;o&&!n||(o=this.state=new Uc(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,(e=>a(e).add(e)))):(t.visit(t.REM,(e=>a(e).remove(e))),t.visit(t.ADD,(e=>a(e).add(e))));for(let t=0,n=this._mlen;t<n;++t)Vc(this._mods[t],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Lu(zo),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),Kc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Gc(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Gc(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Yc.prototype={areaStart:Xc,areaEnd:Xc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Gc(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Jc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Gc(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Zc.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],o=e[n]-i,s=t[n]-a,u=-1;++u<=n;)r=u/n,this._basis.point(this._beta*e[u]+(1-this._beta)*(i+r*o),this._beta*t[u]+(1-this._beta)*(a+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const Qc=function e(t){function n(e){return 1===t?new Kc(e):new Zc(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function el(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function tl(e,t){this._context=e,this._k=(1-t)/6}tl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:el(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:el(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const nl=function e(t){function n(e){return new tl(e,t)}return n.tension=function(t){return e(+t)},n}(0);function rl(e,t){this._context=e,this._k=(1-t)/6}rl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:el(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const il=function e(t){function n(e){return new rl(e,t)}return n.tension=function(t){return e(+t)},n}(0);function al(e,t){this._context=e,this._k=(1-t)/6}al.prototype={areaStart:Xc,areaEnd:Xc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:el(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const ol=function e(t){function n(e){return new al(e,t)}return n.tension=function(t){return e(+t)},n}(0);var sl=Math.abs,ul=Math.atan2,cl=Math.cos,ll=Math.max,fl=Math.min,pl=Math.sin,hl=Math.sqrt,dl=1e-12,ml=Math.PI,gl=ml/2,vl=2*ml;function yl(e){return e>1?0:e<-1?ml:Math.acos(e)}function bl(e){return e>=1?gl:e<=-1?-gl:Math.asin(e)}function xl(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>dl){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>dl){var c=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,l=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*c+e._x1*e._l23_2a-t*e._l12_2a)/l,o=(o*c+e._y1*e._l23_2a-n*e._l12_2a)/l}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function wl(e,t){this._context=e,this._alpha=t}wl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:xl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const El=function e(t){function n(e){return t?new wl(e,t):new tl(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Cl(e,t){this._context=e,this._alpha=t}Cl.prototype={areaStart:Xc,areaEnd:Xc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:xl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Sl=function e(t){function n(e){return t?new Cl(e,t):new al(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Nl(e,t){this._context=e,this._alpha=t}Nl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:xl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Al=function e(t){function n(e){return t?new Nl(e,t):new rl(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function kl(e){this._context=e}function Dl(e){return new kl(e)}function _l(e){this._context=e}function Ml(e){return e<0?-1:1}function Tl(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(Ml(a)+Ml(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function Ol(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Il(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function Fl(e){this._context=e}function Rl(e){this._context=new Bl(e)}function Bl(e){this._context=e}function zl(e){this._context=e}function Pl(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/a[t-1],a[t]-=n,o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function Ll(e,t){this._context=e,this._t=t}kl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}},_l.prototype={areaStart:Xc,areaEnd:Xc,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},Fl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Il(this,this._t0,Ol(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Il(this,Ol(this,n=Tl(this,e,t)),n);break;default:Il(this,this._t0,n=Tl(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(Rl.prototype=Object.create(Fl.prototype)).point=function(e,t){Fl.prototype.point.call(this,t,e)},Bl.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},zl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=Pl(e),i=Pl(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},Ll.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const jl=Math.PI,Ul=2*jl,ql=1e-6,Wl=Ul-ql;function Vl(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function $l(){return new Vl}Vl.prototype=$l.prototype={constructor:Vl,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,s=n-e,u=r-t,c=a-e,l=o-t,f=c*c+l*l;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>ql)if(Math.abs(l*s-u*c)>ql&&i){var p=n-a,h=r-o,d=s*s+u*u,m=p*p+h*h,g=Math.sqrt(d),v=Math.sqrt(f),y=i*Math.tan((jl-Math.acos((d+f-m)/(2*g*v)))/2),b=y/v,x=y/g;Math.abs(b-1)>ql&&(this._+="L"+(e+b*c)+","+(t+b*l)),this._+="A"+i+","+i+",0,0,"+ +(l*p>c*h)+","+(this._x1=e+x*s)+","+(this._y1=t+x*u)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var o=(n=+n)*Math.cos(r),s=n*Math.sin(r),u=e+o,c=t+s,l=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+u+","+c:(Math.abs(this._x1-u)>ql||Math.abs(this._y1-c)>ql)&&(this._+="L"+u+","+c),n&&(f<0&&(f=f%Ul+Ul),f>Wl?this._+="A"+n+","+n+",0,1,"+l+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+l+","+(this._x1=u)+","+(this._y1=c):f>ql&&(this._+="A"+n+","+n+",0,"+ +(f>=jl)+","+l+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};const Hl=$l;function Gl(e){return function(){return e}}function Kl(e){return e.innerRadius}function Xl(e){return e.outerRadius}function Yl(e){return e.startAngle}function Jl(e){return e.endAngle}function Zl(e){return e&&e.padAngle}function Ql(e,t,n,r,i,a,o,s){var u=n-e,c=r-t,l=o-i,f=s-a,p=f*u-l*c;if(!(p*p<dl))return[e+(p=(l*(t-a)-f*(e-i))/p)*u,t+p*c]}function ef(e,t,n,r,i,a,o){var s=e-n,u=t-r,c=(o?a:-a)/hl(s*s+u*u),l=c*u,f=-c*s,p=e+l,h=t+f,d=n+l,m=r+f,g=(p+d)/2,v=(h+m)/2,y=d-p,b=m-h,x=y*y+b*b,w=i-a,E=p*m-d*h,C=(b<0?-1:1)*hl(ll(0,w*w*x-E*E)),S=(E*b-y*C)/x,N=(-E*y-b*C)/x,A=(E*b+y*C)/x,k=(-E*y+b*C)/x,D=S-g,_=N-v,M=A-g,T=k-v;return D*D+_*_>M*M+T*T&&(S=A,N=k),{cx:S,cy:N,x01:-l,y01:-f,x11:S*(i/w-1),y11:N*(i/w-1)}}function tf(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function nf(e){return e[0]}function rf(e){return e[1]}function af(e,t){var n=Gl(!0),r=null,i=Dl,a=null;function o(o){var s,u,c,l=(o=tf(o)).length,f=!1;for(null==r&&(a=i(c=Hl())),s=0;s<=l;++s)!(s<l&&n(u=o[s],s,o))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(u,s,o),+t(u,s,o));if(c)return a=null,c+""||null}return e="function"==typeof e?e:void 0===e?nf:Gl(e),t="function"==typeof t?t:void 0===t?rf:Gl(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:Gl(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:Gl(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:Gl(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),o):r},o}function of(e,t,n){var r=null,i=Gl(!0),a=null,o=Dl,s=null;function u(u){var c,l,f,p,h,d=(u=tf(u)).length,m=!1,g=new Array(d),v=new Array(d);for(null==a&&(s=o(h=Hl())),c=0;c<=d;++c){if(!(c<d&&i(p=u[c],c,u))===m)if(m=!m)l=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=c-1;f>=l;--f)s.point(g[f],v[f]);s.lineEnd(),s.areaEnd()}m&&(g[c]=+e(p,c,u),v[c]=+t(p,c,u),s.point(r?+r(p,c,u):g[c],n?+n(p,c,u):v[c]))}if(h)return s=null,h+""||null}function c(){return af().defined(i).curve(o).context(a)}return e="function"==typeof e?e:void 0===e?nf:Gl(+e),t="function"==typeof t?t:Gl(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?rf:Gl(+n),u.x=function(t){return arguments.length?(e="function"==typeof t?t:Gl(+t),r=null,u):e},u.x0=function(t){return arguments.length?(e="function"==typeof t?t:Gl(+t),u):e},u.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Gl(+e),u):r},u.y=function(e){return arguments.length?(t="function"==typeof e?e:Gl(+e),n=null,u):t},u.y0=function(e){return arguments.length?(t="function"==typeof e?e:Gl(+e),u):t},u.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:Gl(+e),u):n},u.lineX0=u.lineY0=function(){return c().x(e).y(t)},u.lineY1=function(){return c().x(e).y(n)},u.lineX1=function(){return c().x(r).y(t)},u.defined=function(e){return arguments.length?(i="function"==typeof e?e:Gl(!!e),u):i},u.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),u):o},u.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),u):a},u}Array.prototype.slice;const sf={draw:function(e,t){var n=Math.sqrt(t/ml);e.moveTo(n,0),e.arc(0,0,n,0,vl)}};Math.sqrt(1/3);Math.sin(ml/10),Math.sin(7*ml/10);function uf(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}Math.sin(vl/10),Math.cos(vl/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const cf=()=>"undefined"!=typeof Image?Image:null,lf=pr(fr),ff=lf.right,pf=lf.left,hf=(pr(Cs).center,ff);function df(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function mf(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const gf=Symbol("implicit");function vf(){var e=new Map,t=[],n=[],r=gf;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==gf)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const r of n){const n=r+"";e.has(n)||e.set(n,t.push(r))}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return vf(t,n).unknown(r)},df.apply(i,arguments),i}var yf=n(6722);function bf(e,t,n,r){var i,a=Qt(e,t,n);switch((r=(0,yf.formatSpecifier)(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=(0,yf.precisionPrefix)(a,o))||(r.precision=i),(0,yf.formatPrefix)(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=(0,yf.precisionRound)(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=(0,yf.precisionFixed)(a))||(r.precision=i-2*("%"===r.type))}return(0,yf.format)(r)}function xf(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function wf(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ef(){}var Cf=.7,Sf=1/Cf,Nf="\\s*([+-]?\\d+)\\s*",Af="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",kf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Df=/^#([0-9a-f]{3,8})$/,_f=new RegExp("^rgb\\("+[Nf,Nf,Nf]+"\\)$"),Mf=new RegExp("^rgb\\("+[kf,kf,kf]+"\\)$"),Tf=new RegExp("^rgba\\("+[Nf,Nf,Nf,Af]+"\\)$"),Of=new RegExp("^rgba\\("+[kf,kf,kf,Af]+"\\)$"),If=new RegExp("^hsl\\("+[Af,kf,kf]+"\\)$"),Ff=new RegExp("^hsla\\("+[Af,kf,kf,Af]+"\\)$"),Rf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Bf(){return this.rgb().formatHex()}function zf(){return this.rgb().formatRgb()}function Pf(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Df.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Lf(t):3===n?new Wf(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?jf(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?jf(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=_f.exec(e))?new Wf(t[1],t[2],t[3],1):(t=Mf.exec(e))?new Wf(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Tf.exec(e))?jf(t[1],t[2],t[3],t[4]):(t=Of.exec(e))?jf(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=If.exec(e))?Gf(t[1],t[2]/100,t[3]/100,1):(t=Ff.exec(e))?Gf(t[1],t[2]/100,t[3]/100,t[4]):Rf.hasOwnProperty(e)?Lf(Rf[e]):"transparent"===e?new Wf(NaN,NaN,NaN,0):null}function Lf(e){return new Wf(e>>16&255,e>>8&255,255&e,1)}function jf(e,t,n,r){return r<=0&&(e=t=n=NaN),new Wf(e,t,n,r)}function Uf(e){return e instanceof Ef||(e=Pf(e)),e?new Wf((e=e.rgb()).r,e.g,e.b,e.opacity):new Wf}function qf(e,t,n,r){return 1===arguments.length?Uf(e):new Wf(e,t,n,null==r?1:r)}function Wf(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Vf(){return"#"+Hf(this.r)+Hf(this.g)+Hf(this.b)}function $f(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Hf(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Gf(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Yf(e,t,n,r)}function Kf(e){if(e instanceof Yf)return new Yf(e.h,e.s,e.l,e.opacity);if(e instanceof Ef||(e=Pf(e)),!e)return new Yf;if(e instanceof Yf)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new Yf(o,s,u,e.opacity)}function Xf(e,t,n,r){return 1===arguments.length?Kf(e):new Yf(e,t,n,null==r?1:r)}function Yf(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Jf(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Zf(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function Qf(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return Zf((n-r/t)*t,o,i,a,s)}}function ep(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return Zf((n-r/t)*t,i,a,o,s)}}xf(Ef,Pf,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Bf,formatHex:Bf,formatHsl:function(){return Kf(this).formatHsl()},formatRgb:zf,toString:zf}),xf(Wf,qf,wf(Ef,{brighter:function(e){return e=null==e?Sf:Math.pow(Sf,e),new Wf(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Cf:Math.pow(Cf,e),new Wf(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Vf,formatHex:Vf,formatRgb:$f,toString:$f})),xf(Yf,Xf,wf(Ef,{brighter:function(e){return e=null==e?Sf:Math.pow(Sf,e),new Yf(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Cf:Math.pow(Cf,e),new Yf(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Wf(Jf(e>=240?e-240:e+120,i,r),Jf(e,i,r),Jf(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const tp=e=>()=>e;function np(e,t){return function(n){return e+n*t}}function rp(e,t){var n=t-e;return n?np(e,n>180||n<-180?n-360*Math.round(n/360):n):tp(isNaN(e)?t:e)}function ip(e,t){var n=t-e;return n?np(e,n):tp(isNaN(e)?t:e)}const ap=function e(t){var n=function(e){return 1==(e=+e)?ip:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):tp(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=qf(e)).r,(t=qf(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=ip(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function op(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=qf(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var sp=op(Qf),up=op(ep);function cp(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function lp(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function fp(e,t){return(lp(t)?cp:pp)(e,t)}function pp(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=bp(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function hp(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function dp(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function mp(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=bp(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var gp=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,vp=new RegExp(gp.source,"g");function yp(e,t){var n,r,i,a=gp.lastIndex=vp.lastIndex=0,o=-1,s=[],u=[];for(e+="",t+="";(n=gp.exec(e))&&(r=vp.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,u.push({i:o,x:dp(n,r)})),a=vp.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function bp(e,t){var n,r=typeof t;return null==t||"boolean"===r?tp(t):("number"===r?dp:"string"===r?(n=Pf(t))?(t=n,ap):yp:t instanceof Pf?ap:t instanceof Date?hp:lp(t)?cp:Array.isArray(t)?pp:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?mp:dp)(e,t)}function xp(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function wp(e){return+e}var Ep=[0,1];function Cp(e){return e}function Sp(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Np(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=Sp(i,r),a=n(o,a)):(r=Sp(r,i),a=n(a,o)),function(e){return a(r(e))}}function Ap(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=Sp(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=hf(e,t,1,r)-1;return a[n](i[n](t))}}function kp(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Dp(){var e,t,n,r,i,a,o=Ep,s=Ep,u=bp,c=Cp;function l(){var e=Math.min(o.length,s.length);return c!==Cp&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),r=e>2?Ap:Np,i=a=null,f}function f(t){return null==t||isNaN(t=+t)?n:(i||(i=r(o.map(e),s,u)))(e(c(t)))}return f.invert=function(n){return c(t((a||(a=r(s,o.map(e),dp)))(n)))},f.domain=function(e){return arguments.length?(o=Array.from(e,wp),l()):o.slice()},f.range=function(e){return arguments.length?(s=Array.from(e),l()):s.slice()},f.rangeRound=function(e){return s=Array.from(e),u=xp,l()},f.clamp=function(e){return arguments.length?(c=!!e||Cp,l()):c!==Cp},f.interpolate=function(e){return arguments.length?(u=e,l()):u},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,l()}}function _p(){return Dp()(Cp,Cp)}function Mp(e){var t=e.domain;return e.ticks=function(e){var n=t();return Jt(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return bf(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,u=a[o],c=a[s],l=10;for(c<u&&(i=u,u=c,c=i,i=o,o=s,s=i);l-- >0;){if((i=Zt(u,c,n))===r)return a[o]=u,a[s]=c,t(a);if(i>0)u=Math.floor(u/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,c=Math.floor(c*i)/i}r=i}return e},e}function Tp(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function Op(e){return Math.log(e)}function Ip(e){return Math.exp(e)}function Fp(e){return-Math.log(-e)}function Rp(e){return-Math.exp(-e)}function Bp(e){return isFinite(e)?+("1e"+e):e<0?0:e}function zp(e){return function(t){return-e(-t)}}function Pp(e){var t,n,r=e(Op,Ip),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?Bp:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=zp(t),n=zp(n),e(Fp,Rp)):e(Op,Ip),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],u=o[o.length-1];(r=u<s)&&(p=s,s=u,u=p);var c,l,f,p=t(s),h=t(u),d=null==e?10:+e,m=[];if(!(a%1)&&h-p<d){if(p=Math.floor(p),h=Math.ceil(h),s>0){for(;p<=h;++p)for(l=1,c=n(p);l<a;++l)if(!((f=c*l)<s)){if(f>u)break;m.push(f)}}else for(;p<=h;++p)for(l=a-1,c=n(p);l>=1;--l)if(!((f=c*l)<s)){if(f>u)break;m.push(f)}2*m.length<d&&(m=Jt(s,u,d))}else m=Jt(p,h,Math.min(h-p,d)).map(n);return r?m.reverse():m},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=(0,yf.format)(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(Tp(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function Lp(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function jp(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Up(e){return e<0?-e*e:e*e}function qp(e){var t=e(Cp,Cp),n=1;function r(){return 1===n?e(Cp,Cp):.5===n?e(jp,Up):e(Lp(n),Lp(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},Mp(t)}function Wp(){var e=qp(Dp());return e.copy=function(){return kp(e,Wp()).exponent(e.exponent())},df.apply(e,arguments),e}function Vp(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function $p(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Hp(e){var t=1,n=e(Vp(t),$p(t));return n.constant=function(n){return arguments.length?e(Vp(t=+n),$p(t)):t},Mp(n)}function Gp(e,t,n,r,i,a){const o=[[er,1,bn],[er,5,5e3],[er,15,15e3],[er,30,3e4],[a,1,xn],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,wn],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,En],[r,2,1728e5],[n,1,Cn],[t,1,2592e6],[t,3,7776e6],[e,1,Sn]];function s(t,n,r){const i=Math.abs(n-t)/r,a=pr((([,,e])=>e)).right(o,i);if(a===o.length)return e.every(Qt(t/Sn,n/Sn,r));if(0===a)return nr.every(Math.max(Qt(t,n,r),1));const[s,u]=o[i/o[a-1][2]<o[a][2]/i?a-1:a];return s.every(u)}return[function(e,t,n){const r=t<e;r&&([e,t]=[t,e]);const i=n&&"function"==typeof n.range?n:s(e,t,n),a=i?i.range(e,+t+1):[];return r?a.reverse():a},s]}const[Kp,Xp]=Gp(ir,or,Pn,Bn,ur,lr),[Yp,Jp]=Gp(Hn,Kn,Dn,An,Yn,Zn);function Zp(e){return new Date(e)}function Qp(e){return e instanceof Date?+e:+new Date(+e)}function eh(e,t,n,r,i,a,o,s,u,c){var l=_p(),f=l.invert,p=l.domain,h=c(".%L"),d=c(":%S"),m=c("%I:%M"),g=c("%I %p"),v=c("%a %d"),y=c("%b %d"),b=c("%B"),x=c("%Y");function w(e){return(u(e)<e?h:s(e)<e?d:o(e)<e?m:a(e)<e?g:r(e)<e?i(e)<e?v:y:n(e)<e?b:x)(e)}return l.invert=function(e){return new Date(f(e))},l.domain=function(e){return arguments.length?p(Array.from(e,Qp)):p().map(Zp)},l.ticks=function(t){var n=p();return e(n[0],n[n.length-1],null==t?10:t)},l.tickFormat=function(e,t){return null==t?w:c(t)},l.nice=function(e){var n=p();return e&&"function"==typeof e.range||(e=t(n[0],n[n.length-1],null==e?10:e)),e?p(Tp(n,e)):l},l.copy=function(){return kp(l,eh(e,t,n,r,i,a,o,s,u,c))},l}function th(){var e,t,n,r,i,a=0,o=1,s=Cp,u=!1;function c(t){return null==t||isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}function l(e){return function(t){var n,r;return arguments.length?([n,r]=t,s=e(n,r),c):[s(0),s(1)]}}return c.domain=function(i){return arguments.length?([a,o]=i,e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),c):[a,o]},c.clamp=function(e){return arguments.length?(u=!!e,c):u},c.interpolator=function(e){return arguments.length?(s=e,c):s},c.range=l(bp),c.rangeRound=l(xp),c.unknown=function(e){return arguments.length?(i=e,c):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),c}}function nh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function rh(){var e=Mp(th()(Cp));return e.copy=function(){return nh(e,rh())},mf.apply(e,arguments)}function ih(){var e=qp(th());return e.copy=function(){return nh(e,ih()).exponent(e.exponent())},mf.apply(e,arguments)}function ah(e,t){void 0===t&&(t=e,e=bp);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}function oh(){var e,t,n,r,i,a,o,s=0,u=.5,c=1,l=1,f=Cp,p=!1;function h(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(l*e<l*t?r:i),f(p?Math.max(0,Math.min(1,e)):e))}function d(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,f=ah(e,[n,r,i]),h):[f(0),f(.5),f(1)]}}return h.domain=function(o){return arguments.length?([s,u,c]=o,e=a(s=+s),t=a(u=+u),n=a(c=+c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),l=t<e?-1:1,h):[s,u,c]},h.clamp=function(e){return arguments.length?(p=!!e,h):p},h.interpolator=function(e){return arguments.length?(f=e,h):f},h.range=d(bp),h.rangeRound=d(xp),h.unknown=function(e){return arguments.length?(o=e,h):o},function(o){return a=o,e=o(s),t=o(u),n=o(c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),l=t<e?-1:1,h}}function sh(){var e=qp(oh());return e.copy=function(){return nh(e,sh()).exponent(e.exponent())},mf.apply(e,arguments)}function uh(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function ch(e,t){var n=rp(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}}var lh,fh=180/Math.PI,ph={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hh(e,t,n,r,i,a){var o,s,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*fh,skewX:Math.atan(u)*fh,scaleX:o,scaleY:s}}function dh(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],u=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var u=o.push("translate(",null,t,null,n);s.push({i:u-4,x:dp(e,i)},{i:u-2,x:dp(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,u),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:dp(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,u),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:dp(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,u),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:dp(e,n)},{i:s-2,x:dp(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,u),a=o=null,function(e){for(var t,n=-1,r=u.length;++n<r;)s[(t=u[n]).i]=t.x(e);return s.join("")}}}var mh=dh((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ph:hh(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),gh=dh((function(e){return null==e?ph:(lh||(lh=document.createElementNS("http://www.w3.org/2000/svg","g")),lh.setAttribute("transform",e),(e=lh.transform.baseVal.consolidate())?hh((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):ph)}),", ",")",")");function vh(e){return((e=Math.exp(e))+1/e)/2}const yh=function e(t,n,r){function i(e,i){var a,o,s=e[0],u=e[1],c=e[2],l=i[0],f=i[1],p=i[2],h=l-s,d=f-u,m=h*h+d*d;if(m<1e-12)o=Math.log(p/c)/t,a=function(e){return[s+e*h,u+e*d,c*Math.exp(t*e*o)]};else{var g=Math.sqrt(m),v=(p*p-c*c+r*m)/(2*c*n*g),y=(p*p-c*c-r*m)/(2*p*n*g),b=Math.log(Math.sqrt(v*v+1)-v),x=Math.log(Math.sqrt(y*y+1)-y);o=(x-b)/t,a=function(e){var r=e*o,i=vh(b),a=c/(n*g)*(i*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+a*h,u+a*d,c*i/vh(t*r+b)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function bh(e){return function(t,n){var r=e((t=Xf(t)).h,(n=Xf(n)).h),i=ip(t.s,n.s),a=ip(t.l,n.l),o=ip(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=o(e),t+""}}}const xh=bh(rp);var wh=bh(ip);const Eh=Math.PI/180,Ch=180/Math.PI,Sh=.96422,Nh=.82521,Ah=4/29,kh=6/29,Dh=3*kh*kh;function _h(e){if(e instanceof Th)return new Th(e.l,e.a,e.b,e.opacity);if(e instanceof Ph)return Lh(e);e instanceof Wf||(e=Uf(e));var t,n,r=Rh(e.r),i=Rh(e.g),a=Rh(e.b),o=Oh((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=Oh((.4360747*r+.3850649*i+.1430804*a)/Sh),n=Oh((.0139322*r+.0971045*i+.7141733*a)/Nh)),new Th(116*o-16,500*(t-o),200*(o-n),e.opacity)}function Mh(e,t,n,r){return 1===arguments.length?_h(e):new Th(e,t,n,null==r?1:r)}function Th(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function Oh(e){return e>.008856451679035631?Math.pow(e,1/3):e/Dh+Ah}function Ih(e){return e>kh?e*e*e:Dh*(e-Ah)}function Fh(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Rh(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Bh(e){if(e instanceof Ph)return new Ph(e.h,e.c,e.l,e.opacity);if(e instanceof Th||(e=_h(e)),0===e.a&&0===e.b)return new Ph(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Ch;return new Ph(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function zh(e,t,n,r){return 1===arguments.length?Bh(e):new Ph(e,t,n,null==r?1:r)}function Ph(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Lh(e){if(isNaN(e.h))return new Th(e.l,0,0,e.opacity);var t=e.h*Eh;return new Th(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function jh(e,t){var n=ip((e=Mh(e)).l,(t=Mh(t)).l),r=ip(e.a,t.a),i=ip(e.b,t.b),a=ip(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}}function Uh(e){return function(t,n){var r=e((t=zh(t)).h,(n=zh(n)).h),i=ip(t.c,n.c),a=ip(t.l,n.l),o=ip(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=o(e),t+""}}}xf(Th,Mh,wf(Ef,{brighter:function(e){return new Th(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Th(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Wf(Fh(3.1338561*(t=Sh*Ih(t))-1.6168667*(e=1*Ih(e))-.4906146*(n=Nh*Ih(n))),Fh(-.9787684*t+1.9161415*e+.033454*n),Fh(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),xf(Ph,zh,wf(Ef,{brighter:function(e){return new Ph(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new Ph(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return Lh(this).rgb()}}));const qh=Uh(rp);var Wh=Uh(ip),Vh=-.14861,$h=1.78277,Hh=-.29227,Gh=-.90649,Kh=1.97294,Xh=Kh*Gh,Yh=Kh*$h,Jh=$h*Hh-Gh*Vh;function Zh(e){if(e instanceof ed)return new ed(e.h,e.s,e.l,e.opacity);e instanceof Wf||(e=Uf(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(Jh*r+Xh*t-Yh*n)/(Jh+Xh-Yh),a=r-i,o=(Kh*(n-i)-Hh*a)/Gh,s=Math.sqrt(o*o+a*a)/(Kh*i*(1-i)),u=s?Math.atan2(o,a)*Ch-120:NaN;return new ed(u<0?u+360:u,s,i,e.opacity)}function Qh(e,t,n,r){return 1===arguments.length?Zh(e):new ed(e,t,n,null==r?1:r)}function ed(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function td(e){return function t(n){function r(t,r){var i=e((t=Qh(t)).h,(r=Qh(r)).h),a=ip(t.s,r.s),o=ip(t.l,r.l),s=ip(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}xf(ed,Qh,wf(Ef,{brighter:function(e){return e=null==e?Sf:Math.pow(Sf,e),new ed(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Cf:Math.pow(Cf,e),new ed(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Eh,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Wf(255*(t+n*(Vh*r+$h*i)),255*(t+n*(Hh*r+Gh*i)),255*(t+n*(Kh*r)),this.opacity)}}));const nd=td(rp);var rd=td(ip);function id(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}function ad(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const od="linear",sd="log",ud="pow",cd="sqrt",ld="symlog",fd="time",pd="utc",hd="sequential",dd="diverging",md="quantile",gd="quantize",vd="threshold",yd="ordinal",bd="point",xd="band",wd="bin-ordinal",Ed="continuous",Cd="discrete",Sd="discretizing",Nd="interpolating",Ad="temporal";function kd(){const e=vf().unknown(void 0),t=e.domain,n=e.range;let r,i,a=[0,1],o=!1,s=0,u=0,c=.5;function l(){const e=t().length,l=a[1]<a[0],f=a[1-l],p=ad(e,s,u);let h=a[l-0];r=(f-h)/(p||1),o&&(r=Math.floor(r)),h+=(f-h-r*(e-s))*c,i=r*(1-s),o&&(h=Math.round(h),i=Math.round(i));const d=wu(e).map((e=>h+r*e));return n(l?d.reverse():d)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),l()):t()},e.range=function(e){return arguments.length?(a=[+e[0],+e[1]],l()):a.slice()},e.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,l()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(e){return arguments.length?(o=!!e,l()):o},e.padding=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),s=u,l()):s},e.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),l()):s},e.paddingOuter=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),l()):u},e.align=function(e){return arguments.length?(c=Math.max(0,Math.min(1,e)),l()):c},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const r=a[1]<a[0],o=r?n().reverse():n(),s=o.length-1;let u,c,l,f=+e[0],p=+e[1];return f!=f||p!=p||(p<f&&(l=f,f=p,p=l),p<o[0]||f>a[1-r])?void 0:(u=Math.max(0,ff(o,f)-1),c=f===p?u:ff(o,p)-1,f-o[u]>i+1e-10&&++u,r&&(l=u,u=s-c,c=s-l),u>c?void 0:t().slice(u,c+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return kd().domain(t()).range(a).round(o).paddingInner(s).paddingOuter(u).align(c)},l()}function Dd(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Dd(t())},e}var _d=Array.prototype.map;function Md(e){return _d.call(e,_e)}const Td=Array.prototype.slice,Od={};function Id(e,t,n){const r=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?(r=n,function(e){let t,n=e[0],i=e[1];return i<n&&(t=n,n=i,i=t),[r.invert(n),r.invert(i)]}):n.invertExtent?function(e){return function(t){const n=e.range();let r,i,a,o,s=t[0],u=t[1],c=-1;for(u<s&&(i=s,s=u,u=i),a=0,o=n.length;a<o;++a)n[a]>=s&&n[a]<=u&&(c<0&&(c=a),r=a);if(!(c<0))return s=e.invertExtent(n[c]),u=e.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===u[1]?u[0]:u[1]]}}(n):void 0),n.type=e,n;var r};return r.metadata=Tt(Ge(n)),r}function Fd(e,t,n){return arguments.length>1?(Od[e]=Id(e,t,n),this):Rd(e)?Od[e]:void 0}function Rd(e){return st(Od,e)}function Bd(e,t){const n=Od[e];return n&&n.metadata[t]}function zd(e){return Bd(e,Ed)}function Pd(e){return Bd(e,Cd)}function Ld(e){return Bd(e,Sd)}function jd(e){return Bd(e,sd)}function Ud(e){return Bd(e,Nd)}function qd(e){return Bd(e,md)}Fd("identity",(function e(t){var n;function r(e){return null==e||isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,wp),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,wp):[0,1],Mp(r)})),Fd(od,(function e(){var t=_p();return t.copy=function(){return kp(t,e())},df.apply(t,arguments),Mp(t)}),Ed),Fd(sd,(function e(){var t=Pp(Dp()).domain([1,10]);return t.copy=function(){return kp(t,e()).base(t.base())},df.apply(t,arguments),t}),[Ed,sd]),Fd(ud,Wp,Ed),Fd(cd,(function(){return Wp.apply(null,arguments).exponent(.5)}),Ed),Fd(ld,(function e(){var t=Hp(Dp());return t.copy=function(){return kp(t,e()).constant(t.constant())},df.apply(t,arguments)}),Ed),Fd(fd,(function(){return df.apply(eh(Yp,Jp,Hn,Kn,Dn,An,Yn,Zn,er,Ei).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[Ed,Ad]),Fd(pd,(function(){return df.apply(eh(Kp,Xp,ir,or,Pn,Bn,ur,lr,er,Si).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[Ed,Ad]),Fd(hd,rh,[Ed,Nd]),Fd("".concat(hd,"-").concat(od),rh,[Ed,Nd]),Fd("".concat(hd,"-").concat(sd),(function e(){var t=Pp(th()).domain([1,10]);return t.copy=function(){return nh(t,e()).base(t.base())},mf.apply(t,arguments)}),[Ed,Nd,sd]),Fd("".concat(hd,"-").concat(ud),ih,[Ed,Nd]),Fd("".concat(hd,"-").concat(cd),(function(){return ih.apply(null,arguments).exponent(.5)}),[Ed,Nd]),Fd("".concat(hd,"-").concat(ld),(function e(){var t=Hp(th());return t.copy=function(){return nh(t,e()).constant(t.constant())},mf.apply(t,arguments)}),[Ed,Nd]),Fd("".concat(dd,"-").concat(od),(function e(){var t=Mp(oh()(Cp));return t.copy=function(){return nh(t,e())},mf.apply(t,arguments)}),[Ed,Nd]),Fd("".concat(dd,"-").concat(sd),(function e(){var t=Pp(oh()).domain([.1,1,10]);return t.copy=function(){return nh(t,e()).base(t.base())},mf.apply(t,arguments)}),[Ed,Nd,sd]),Fd("".concat(dd,"-").concat(ud),sh,[Ed,Nd]),Fd("".concat(dd,"-").concat(cd),(function(){return sh.apply(null,arguments).exponent(.5)}),[Ed,Nd]),Fd("".concat(dd,"-").concat(ld),(function e(){var t=Hp(oh());return t.copy=function(){return nh(t,e()).constant(t.constant())},mf.apply(t,arguments)}),[Ed,Nd]),Fd(md,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=Ns(n,e/t);return o}function o(e){return null==e||isNaN(e=+e)?t:r[hf(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(fr),a()},o.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},df.apply(o,arguments)}),[Sd,md]),Fd(gd,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return null!=e&&e<=e?o[hf(a,e,0,i)]:t}function u(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?([n,r]=e,n=+n,r=+r,u()):[n,r]},s.range=function(e){return arguments.length?(i=(o=Array.from(e)).length-1,u()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},df.apply(Mp(s),arguments)}),Sd),Fd(vd,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return null!=e&&e<=e?r[hf(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},df.apply(a,arguments)}),Sd),Fd(wd,(function e(){let t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(hf(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=Md(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Td.call(e),r):n.slice()},r.tickFormat=function(e,n){return bf(t[0],De(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[Cd,Sd]),Fd(yd,vf,Cd),Fd(xd,kd,Cd),Fd(bd,(function(){return Dd(kd().paddingInner(1))}),Cd);const Wd=["clamp","base","constant","exponent"];function Vd(e,t){const n=t[0],r=De(t)-n;return function(t){return e(n+t*r)}}function $d(e,t,n){return ah(Kd(t||"rgb",n),e)}function Hd(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Gd(e,t,n){const r=n-t;let i,a,o;return r&&Number.isFinite(r)?(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),o=Fd(a)().domain([t,n]).range([0,1]),Wd.forEach((t=>e[t]?o[t](e[t]()):0)),o):tt(.5)}function Kd(e,t){const n=o[function(e){return"interpolate"+e.toLowerCase().split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function Xd(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function Yd(e,t){for(const n in e)Zd(n,t(e[n]))}const Jd={};function Zd(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(Jd[e]=t,this):Jd[e]}Yd({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},Xd),Yd({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(e=>$d(Xd(e))));const Qd="symbol",em=e=>Ee(e)?e.map((e=>String(e))):String(e),tm=(e,t)=>e[1]-t[1],nm=(e,t)=>t[1]-e[1];function rm(e,t,n){let r;return gt(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(Nt(e.domain())/n||1)))),Ce(t)&&(r=t.step,t=t.interval),yt(t)&&(t=e.type===fd?Qr(t):e.type==pd?ei(t):oe("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function im(e,t,n){let r=e.range(),i=r[0],a=De(r),o=tm;if(i>a&&(r=a,a=i,i=r,o=nm),i=Math.floor(i),a=Math.ceil(a),t=t.map((t=>[t,e(t)])).filter((e=>i<=e[1]&&e[1]<=a)).sort(o).map((e=>e[0])),n>0&&t.length>1){const e=[t[0],De(t)];for(;t.length>n&&t.length>=3;)t=t.filter(((e,t)=>!(t%2)));t.length<3&&(t=e)}return t}function am(e,t){return e.bins?im(e,e.bins):e.ticks?e.ticks(t):e.domain()}function om(e,t,n,r,i,a){const o=t.type;let s=em;if(o===fd||i===fd)s=e.timeFormat(r);else if(o===pd||i===pd)s=e.utcFormat(r);else if(jd(o)){const i=e.formatFloat(r);if(a||t.bins)s=i;else{const e=sm(t,n,!1);s=t=>e(t)?i(t):""}}else if(t.tickFormat){const i=t.domain();s=e.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=e.format(r));return s}function sm(e,t,n){const r=am(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=e=>{let t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=o};return n?r.filter(s):s}const um={[md]:"quantiles",[gd]:"thresholds",[vd]:"domain"},cm={[md]:"quantiles",[gd]:"domain"};function lm(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=De(e),t}(e.bins):e.type===sd?sm(e,t,!0):um[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[um[e.type]]()):am(e,t)}function fm(e,t,n,r,i,a,o){const s=cm[t.type]&&a!==fd&&a!==pd?function(e,t,n){const r=t[cm[t.type]](),i=r.length;let a,o=i>1?r[1]-r[0]:r[0];for(a=1;a<i;++a)o=Math.min(o,r[a]-r[a-1]);return e.formatSpan(0,o,30,n)}(e,t,i):om(e,t,n,i,a,o);return r===Qd&&(e=>um[e.type]||e.bins)(t)?pm(s):"discrete"===r?dm(s):mm(s)}const pm=e=>(t,n,r)=>{const i=hm(r[n+1],hm(r.max,1/0)),a=gm(t,e),o=gm(i,e);return a&&o?a+"  "+o:o?"< "+o:" "+a},hm=(e,t)=>null!=e?e:t,dm=e=>(t,n)=>n?e(t):null,mm=e=>t=>e(t),gm=(e,t)=>Number.isFinite(e)?t(e):null;function vm(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=function(e,t,n,r){const i=r||t.type;return yt(n)&&function(e){return Bd(e,Ad)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==fd?n||i!==pd?fm(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}(e,t,n.format,n.formatType);if(Ld(t.type)){const e=lm(t).slice(1).map(i),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(Pd(t.type)){const e=t.domain(),n=e.length,a=n>r?e.slice(0,r-2).map(i).join(", ")+", ending with "+e.slice(-1).map(i):e.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{const e=t.domain();return"values from ".concat(i(e[0])," to ").concat(i(De(e)))}}let ym=0;const bm="p_";function xm(e){return e&&e.gradient}function wm(e,t,n){const r=e.gradient;let i=e.id,a="radial"===r?bm:"";return i||(i=e.id="gradient_"+ym++,"radial"===r?(e.x1=Em(e.x1,.5),e.y1=Em(e.y1,.5),e.r1=Em(e.r1,0),e.x2=Em(e.x2,.5),e.y2=Em(e.y2,.5),e.r2=Em(e.r2,.5),a=bm):(e.x1=Em(e.x1,0),e.y1=Em(e.y1,0),e.x2=Em(e.x2,1),e.y2=Em(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function Em(e,t){return null!=e?e:t}function Cm(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}const Sm={basis:{curve:function(e){return new Kc(e)}},"basis-closed":{curve:function(e){return new Yc(e)}},"basis-open":{curve:function(e){return new Jc(e)}},bundle:{curve:Qc,tension:"beta",value:.85},cardinal:{curve:nl,tension:"tension",value:0},"cardinal-open":{curve:il,tension:"tension",value:0},"cardinal-closed":{curve:ol,tension:"tension",value:0},"catmull-rom":{curve:El,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Sl,tension:"alpha",value:.5},"catmull-rom-open":{curve:Al,tension:"alpha",value:.5},linear:{curve:Dl},"linear-closed":{curve:function(e){return new _l(e)}},monotone:{horizontal:function(e){return new Rl(e)},vertical:function(e){return new Fl(e)}},natural:{curve:function(e){return new zl(e)}},step:{curve:function(e){return new Ll(e,.5)}},"step-after":{curve:function(e){return new Ll(e,1)}},"step-before":{curve:function(e){return new Ll(e,0)}}};function Nm(e,t,n){var r=st(Sm,e)&&Sm[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const Am={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},km=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Dm(e){const t=[];let n,r,i,a,o,s,u,c,l,f;const p=e.slice().replace(km[0],"###$1").split(km[1]).slice(1);for(u=0,l=p.length;u<l;++u){for(n=p[u],r=n.slice(1).trim().replace(km[2],"$1###$2").replace(km[3],"$1###$2").split(km[4]),o=n.charAt(0),i=[o],c=0,f=r.length;c<f;++c)(a=+r[c])===a&&i.push(a);if(s=Am[o.toLowerCase()],i.length-1>s){const e=i.length;for(c=1,t.push([o].concat(i.slice(c,c+=s))),o="M"===o?"L":"m"===o?"l":o;c<e;c+=s)t.push([o].concat(i.slice(c,c+s)))}else t.push(i)}return t}const _m=Math.PI/180,Mm=Math.PI/2,Tm=2*Math.PI,Om=Math.sqrt(3)/2;var Im={},Fm={},Rm=[].join;function Bm(e){const t=Rm.call(e);if(Fm[t])return Fm[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7];const l=c*o,f=-u*s,p=u*o,h=c*s,d=Math.cos(i),m=Math.sin(i),g=Math.cos(a),v=Math.sin(a),y=.5*(a-i),b=Math.sin(.5*y),x=8/3*b*b/Math.sin(y),w=n+d-x*m,E=r+m+x*d,C=n+g,S=r+v,N=C+x*v,A=S-x*g;return Fm[t]=[l*w+f*E,p*w+h*E,l*N+f*A,p*N+h*A,l*C+f*S,p*C+h*S]}const zm=["l",0,0,0,0,0,0,0];function Pm(e,t,n){const r=zm[0]=e[0];if("a"===r||"A"===r)zm[1]=t*e[1],zm[2]=n*e[2],zm[3]=e[3],zm[4]=e[4],zm[5]=e[5],zm[6]=t*e[6],zm[7]=n*e[7];else if("h"===r||"H"===r)zm[1]=t*e[1];else if("v"===r||"V"===r)zm[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)zm[i]=(i%2==1?t:n)*e[i];return zm}function Lm(e,t,n,r,i,a){var o,s,u,c,l,f=null,p=0,h=0,d=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var g=0,v=t.length;g<v;++g){switch(o=t[g],1===i&&1===a||(o=Pm(o,i,a)),o[0]){case"l":p+=o[1],h+=o[2],e.lineTo(p+n,h+r);break;case"L":p=o[1],h=o[2],e.lineTo(p+n,h+r);break;case"h":p+=o[1],e.lineTo(p+n,h+r);break;case"H":p=o[1],e.lineTo(p+n,h+r);break;case"v":h+=o[1],e.lineTo(p+n,h+r);break;case"V":h=o[1],e.lineTo(p+n,h+r);break;case"m":p+=o[1],h+=o[2],e.moveTo(p+n,h+r);break;case"M":p=o[1],h=o[2],e.moveTo(p+n,h+r);break;case"c":s=p+o[5],u=h+o[6],d=p+o[3],m=h+o[4],e.bezierCurveTo(p+o[1]+n,h+o[2]+r,d+n,m+r,s+n,u+r),p=s,h=u;break;case"C":p=o[5],h=o[6],d=o[3],m=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,d+n,m+r,p+n,h+r);break;case"s":s=p+o[3],u=h+o[4],d=2*p-d,m=2*h-m,e.bezierCurveTo(d+n,m+r,p+o[1]+n,h+o[2]+r,s+n,u+r),d=p+o[1],m=h+o[2],p=s,h=u;break;case"S":s=o[3],u=o[4],d=2*p-d,m=2*h-m,e.bezierCurveTo(d+n,m+r,o[1]+n,o[2]+r,s+n,u+r),p=s,h=u,d=o[1],m=o[2];break;case"q":s=p+o[3],u=h+o[4],d=p+o[1],m=h+o[2],e.quadraticCurveTo(d+n,m+r,s+n,u+r),p=s,h=u;break;case"Q":s=o[3],u=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,s+n,u+r),p=s,h=u,d=o[1],m=o[2];break;case"t":s=p+o[1],u=h+o[2],null===f[0].match(/[QqTt]/)?(d=p,m=h):"t"===f[0]?(d=2*p-c,m=2*h-l):"q"===f[0]&&(d=2*p-d,m=2*h-m),c=d,l=m,e.quadraticCurveTo(d+n,m+r,s+n,u+r),h=u,d=(p=s)+o[1],m=h+o[2];break;case"T":s=o[1],u=o[2],d=2*p-d,m=2*h-m,e.quadraticCurveTo(d+n,m+r,s+n,u+r),p=s,h=u;break;case"a":jm(e,p+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+p+n,o[7]+h+r]),p+=o[6],h+=o[7];break;case"A":jm(e,p+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),p=o[6],h=o[7];break;case"z":case"Z":e.closePath()}f=o}}function jm(e,t,n,r){const i=function(e,t,n,r,i,a,o,s,u){const c=Rm.call(arguments);if(Im[c])return Im[c];const l=o*_m,f=Math.sin(l),p=Math.cos(l),h=p*(s-e)*.5+f*(u-t)*.5,d=p*(u-t)*.5-f*(s-e)*.5;let m=h*h/((n=Math.abs(n))*n)+d*d/((r=Math.abs(r))*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=p/n,v=f/n,y=-f/r,b=p/r,x=g*s+v*u,w=y*s+b*u,E=g*e+v*t,C=y*e+b*t;let S=1/((E-x)*(E-x)+(C-w)*(C-w))-.25;S<0&&(S=0);let N=Math.sqrt(S);a==i&&(N=-N);const A=.5*(x+E)-N*(C-w),k=.5*(w+C)+N*(E-x),D=Math.atan2(w-k,x-A);let _=Math.atan2(C-k,E-A)-D;_<0&&1===a?_+=Tm:_>0&&0===a&&(_-=Tm);const M=Math.ceil(Math.abs(_/(Mm+.001))),T=[];for(let e=0;e<M;++e){const t=D+e*_/M,i=D+(e+1)*_/M;T[e]=[A,k,t,i,n,r,f,p]}return Im[c]=T}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let t=0;t<i.length;++t){const n=Bm(i[t]);e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const Um=.5773502691896257,qm={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Tm)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Om*n,i=r-n*Um,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Om*n,i=r-n*Um;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Om*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Om*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Om*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Om*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Wm(e){return st(qm,e)?qm[e]:function(e){if(!st(Vm,e)){const t=Dm(e);Vm[e]={draw:function(e,n){Lm(e,t,0,0,Math.sqrt(n)/2)}}}return Vm[e]}(e)}var Vm={};const $m=.448084975506;function Hm(e){return e.x}function Gm(e){return e.y}function Km(e){return e.width}function Xm(e){return e.height}function Ym(e){return"function"==typeof e?e:()=>+e}function Jm(e,t,n){return Math.max(t,Math.min(e,n))}function Zm(){var e=Hm,t=Gm,n=Km,r=Xm,i=Ym(0),a=i,o=i,s=i,u=null;function c(c,l,f){var p,h=null!=l?l:+e.call(this,c),d=null!=f?f:+t.call(this,c),m=+n.call(this,c),g=+r.call(this,c),v=Math.min(m,g)/2,y=Jm(+i.call(this,c),0,v),b=Jm(+a.call(this,c),0,v),x=Jm(+o.call(this,c),0,v),w=Jm(+s.call(this,c),0,v);if(u||(u=p=Hl()),y<=0&&b<=0&&x<=0&&w<=0)u.rect(h,d,m,g);else{var E=h+m,C=d+g;u.moveTo(h+y,d),u.lineTo(E-b,d),u.bezierCurveTo(E-$m*b,d,E,d+$m*b,E,d+b),u.lineTo(E,C-w),u.bezierCurveTo(E,C-$m*w,E-$m*w,C,E-w,C),u.lineTo(h+x,C),u.bezierCurveTo(h+$m*x,C,h,C-$m*x,h,C-x),u.lineTo(h,d+y),u.bezierCurveTo(h,d+$m*y,h+$m*y,d,h+y,d),u.closePath()}if(p)return u=null,p+""||null}return c.x=function(t){return arguments.length?(e=Ym(t),c):e},c.y=function(e){return arguments.length?(t=Ym(e),c):t},c.width=function(e){return arguments.length?(n=Ym(e),c):n},c.height=function(e){return arguments.length?(r=Ym(e),c):r},c.cornerRadius=function(e,t,n,r){return arguments.length?(i=Ym(e),a=null!=t?Ym(t):i,s=null!=n?Ym(n):i,o=null!=r?Ym(r):a,c):i},c.context=function(e){return arguments.length?(u=null==e?null:e,c):u},c}function Qm(){var e,t,n,r,i,a,o,s,u=null;function c(e,t,n){const r=n/2;if(i){var c=o-t,l=e-a;if(c||l){var f=Math.sqrt(c*c+l*l),p=(c/=f)*s,h=(l/=f)*s,d=Math.atan2(l,c);u.moveTo(a-p,o-h),u.lineTo(e-c*r,t-l*r),u.arc(e,t,r,d-Math.PI,d),u.lineTo(a+p,o+h),u.arc(a,o,s,d,d+Math.PI)}else u.arc(e,t,r,0,Tm);u.closePath()}else i=1;a=e,o=t,s=r}function l(a){var o,s,l,f=a.length,p=!1;for(null==u&&(u=l=Hl()),o=0;o<=f;++o)!(o<f&&r(s=a[o],o,a))===p&&(p=!p)&&(i=0),p&&c(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(l)return u=null,l+""||null}return l.x=function(t){return arguments.length?(e=t,l):e},l.y=function(e){return arguments.length?(t=e,l):t},l.size=function(e){return arguments.length?(n=e,l):n},l.defined=function(e){return arguments.length?(r=e,l):r},l.context=function(e){return arguments.length?(u=null==e?null:e,l):u},l}function eg(e,t){return null!=e?e:t}const tg=e=>e.x||0,ng=e=>e.y||0,rg=e=>!(!1===e.defined),ig=function(){var e=Kl,t=Xl,n=Gl(0),r=null,i=Yl,a=Jl,o=Zl,s=null;function u(){var u,c,l=+e.apply(this,arguments),f=+t.apply(this,arguments),p=i.apply(this,arguments)-gl,h=a.apply(this,arguments)-gl,d=sl(h-p),m=h>p;if(s||(s=u=Hl()),f<l&&(c=f,f=l,l=c),f>dl)if(d>vl-dl)s.moveTo(f*cl(p),f*pl(p)),s.arc(0,0,f,p,h,!m),l>dl&&(s.moveTo(l*cl(h),l*pl(h)),s.arc(0,0,l,h,p,m));else{var g,v,y=p,b=h,x=p,w=h,E=d,C=d,S=o.apply(this,arguments)/2,N=S>dl&&(r?+r.apply(this,arguments):hl(l*l+f*f)),A=fl(sl(f-l)/2,+n.apply(this,arguments)),k=A,D=A;if(N>dl){var _=bl(N/l*pl(S)),M=bl(N/f*pl(S));(E-=2*_)>dl?(x+=_*=m?1:-1,w-=_):(E=0,x=w=(p+h)/2),(C-=2*M)>dl?(y+=M*=m?1:-1,b-=M):(C=0,y=b=(p+h)/2)}var T=f*cl(y),O=f*pl(y),I=l*cl(w),F=l*pl(w);if(A>dl){var R,B=f*cl(b),z=f*pl(b),P=l*cl(x),L=l*pl(x);if(d<ml&&(R=Ql(T,O,P,L,B,z,I,F))){var j=T-R[0],U=O-R[1],q=B-R[0],W=z-R[1],V=1/pl(yl((j*q+U*W)/(hl(j*j+U*U)*hl(q*q+W*W)))/2),$=hl(R[0]*R[0]+R[1]*R[1]);k=fl(A,(l-$)/(V-1)),D=fl(A,(f-$)/(V+1))}}C>dl?D>dl?(g=ef(P,L,T,O,f,D,m),v=ef(B,z,I,F,f,D,m),s.moveTo(g.cx+g.x01,g.cy+g.y01),D<A?s.arc(g.cx,g.cy,D,ul(g.y01,g.x01),ul(v.y01,v.x01),!m):(s.arc(g.cx,g.cy,D,ul(g.y01,g.x01),ul(g.y11,g.x11),!m),s.arc(0,0,f,ul(g.cy+g.y11,g.cx+g.x11),ul(v.cy+v.y11,v.cx+v.x11),!m),s.arc(v.cx,v.cy,D,ul(v.y11,v.x11),ul(v.y01,v.x01),!m))):(s.moveTo(T,O),s.arc(0,0,f,y,b,!m)):s.moveTo(T,O),l>dl&&E>dl?k>dl?(g=ef(I,F,B,z,l,-k,m),v=ef(T,O,P,L,l,-k,m),s.lineTo(g.cx+g.x01,g.cy+g.y01),k<A?s.arc(g.cx,g.cy,k,ul(g.y01,g.x01),ul(v.y01,v.x01),!m):(s.arc(g.cx,g.cy,k,ul(g.y01,g.x01),ul(g.y11,g.x11),!m),s.arc(0,0,l,ul(g.cy+g.y11,g.cx+g.x11),ul(v.cy+v.y11,v.cx+v.x11),m),s.arc(v.cx,v.cy,k,ul(v.y11,v.x11),ul(v.y01,v.x01),!m))):s.arc(0,0,l,w,x,m):s.lineTo(I,F)}else s.moveTo(0,0);if(s.closePath(),u)return s=null,u+""||null}return u.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-ml/2;return[cl(r)*n,pl(r)*n]},u.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:Gl(+t),u):e},u.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:Gl(+e),u):t},u.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:Gl(+e),u):n},u.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Gl(+e),u):r},u.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:Gl(+e),u):i},u.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:Gl(+e),u):a},u.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:Gl(+e),u):o},u.context=function(e){return arguments.length?(s=null==e?null:e,u):s},u}().startAngle((e=>e.startAngle||0)).endAngle((e=>e.endAngle||0)).padAngle((e=>e.padAngle||0)).innerRadius((e=>e.innerRadius||0)).outerRadius((e=>e.outerRadius||0)).cornerRadius((e=>e.cornerRadius||0)),ag=of().x(tg).y1(ng).y0((e=>(e.y||0)+(e.height||0))).defined(rg),og=of().y(ng).x1(tg).x0((e=>(e.x||0)+(e.width||0))).defined(rg),sg=af().x(tg).y(ng).defined(rg),ug=Zm().x(tg).y(ng).width((e=>e.width||0)).height((e=>e.height||0)).cornerRadius((e=>eg(e.cornerRadiusTopLeft,e.cornerRadius)||0),(e=>eg(e.cornerRadiusTopRight,e.cornerRadius)||0),(e=>eg(e.cornerRadiusBottomRight,e.cornerRadius)||0),(e=>eg(e.cornerRadiusBottomLeft,e.cornerRadius)||0)),cg=function(e,t){var n=null;function r(){var r;if(n||(n=r=Hl()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:Gl(e||sf),t="function"==typeof t?t:Gl(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:Gl(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:Gl(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type((e=>Wm(e.shape||"circle"))).size((e=>eg(e.size,64))),lg=Qm().x(tg).y(ng).defined(rg).size((e=>e.size||1));function fg(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function pg(e,t,n,r){return ug.context(e)(t,n,r)}var hg=1;function dg(){hg=1}function mg(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+hg++),o=i.clipping[a]||(i.clipping[a]={id:a});return Xe(r)?o.path=r(null):fg(n)?o.path=pg(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function gg(e){this.clear(),e&&this.union(e)}function vg(e){this.mark=e,this.bounds=this.bounds||new gg}function yg(e){vg.call(this,e),this.items=this.items||[]}function bg(e){this._pending=0,this._loader=e||To()}function xg(e){e._pending+=1}function wg(e){e._pending-=1}function Eg(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}gg.prototype={clone(){return new gg(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),u=Math.sin(e),c=t-t*s+n*u,l=n-t*u-n*s;return[s*r-u*i+c,u*r+s*i+l,s*r-u*o+c,u*r+s*o+l,s*a-u*i+c,u*a+s*i+l,s*a-u*o+c,u*a+s*o+l]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},ft(yg,vg),bg.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return xg(t),t._loader.sanitize(e,{context:"href"}).then((e=>(wg(t),e))).catch((()=>(wg(t),null)))},loadImage(e){const t=this,n=cf();return xg(t),t._loader.sanitize(e,{context:"image"}).then((e=>{const r=e.href;if(!r||!n)throw{url:r};const i=new n,a=st(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>wg(t),i.onerror=()=>wg(t),i.src=r,i})).catch((e=>(wg(t),{complete:!1,width:0,height:0,src:e&&e.url||""})))},ready(){const e=this;return new Promise((t=>{!function n(r){e.pending()?setTimeout((()=>{n(!0)}),10):t(r)}(!1)}))}};const Cg=Tm-1e-8;let Sg,Ng,Ag,kg,Dg,_g,Mg,Tg;const Og=(e,t)=>Sg.add(e,t),Ig=(e,t)=>Og(Ng=e,Ag=t),Fg=e=>Og(e,Sg.y1),Rg=e=>Og(Sg.x1,e),Bg=(e,t)=>Dg*e+Mg*t,zg=(e,t)=>_g*e+Tg*t,Pg=(e,t)=>Og(Bg(e,t),zg(e,t)),Lg=(e,t)=>Ig(Bg(e,t),zg(e,t));function jg(e,t){return Sg=e,t?(kg=t*_m,Dg=Tg=Math.cos(kg),_g=Math.sin(kg),Mg=-_g):(Dg=Tg=1,kg=_g=Mg=0),Ug}const Ug={beginPath(){},closePath(){},moveTo:Lg,lineTo:Lg,rect(e,t,n,r){kg?(Pg(e+n,t),Pg(e+n,t+r),Pg(e,t+r),Lg(e,t)):(Og(e+n,t+r),Ig(e,t))},quadraticCurveTo(e,t,n,r){const i=Bg(e,t),a=zg(e,t),o=Bg(n,r),s=zg(n,r);qg(Ng,i,o,Fg),qg(Ag,a,s,Rg),Ig(o,s)},bezierCurveTo(e,t,n,r,i,a){const o=Bg(e,t),s=zg(e,t),u=Bg(n,r),c=zg(n,r),l=Bg(i,a),f=zg(i,a);Wg(Ng,o,u,l,Fg),Wg(Ag,s,c,f,Rg),Ig(l,f)},arc(e,t,n,r,i,a){if(r+=kg,i+=kg,Ng=n*Math.cos(i)+e,Ag=n*Math.sin(i)+t,Math.abs(i-r)>Cg)Og(e-n,t-n),Og(e+n,t+n);else{const o=r=>Og(n*Math.cos(r)+e,n*Math.sin(r)+t);let s,u;if(o(r),o(i),i!==r)if((r%=Tm)<0&&(r+=Tm),(i%=Tm)<0&&(i+=Tm),i<r&&(a=!a,s=r,r=i,i=s),a)for(i-=Tm,s=r-r%Mm,u=0;u<4&&s>i;++u,s-=Mm)o(s);else for(s=r-r%Mm+Mm,u=0;u<4&&s<i;++u,s+=Mm)o(s)}}};function qg(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function Wg(e,t,n,r,i){const a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;let u,c=0,l=0;Math.abs(a)>1e-14?(u=o*o+s*a,u>=0&&(u=Math.sqrt(u),c=(-o+u)/a,l=(-o-u)/a)):c=.5*s/o,0<c&&c<1&&i(Vg(c,e,t,n,r)),0<l&&l<1&&i(Vg(l,e,t,n,r))}function Vg(e,t,n,r,i){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var $g=($g=uf(1,1))?$g.getContext("2d"):null;const Hg=new gg;function Gg(e){return function(t,n){if(!$g)return!0;e($g,t),Hg.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=Hg;for(let e=i;e<=o;++e)for(let t=r;t<=a;++t)if($g.isPointInPath(t,e))return!0;return!1}}function Kg(e,t){return t.contains(e.x||0,e.y||0)}function Xg(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(Hg.set(n,r,n+i,r+a))}function Yg(e,t){const n=e.x||0,r=e.y||0;return Jg(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function Jg(e,t,n,r,i){const{x1:a,y1:o,x2:s,y2:u}=e,c=r-t,l=i-n;let f,p,h,d,m=0,g=1;for(d=0;d<4;++d){if(0===d&&(f=-c,p=-(a-t)),1===d&&(f=c,p=s-t),2===d&&(f=-l,p=-(o-n)),3===d&&(f=l,p=u-n),Math.abs(f)<1e-10&&p<0)return!1;if(h=p/f,f<0){if(h>g)return!1;h>m&&(m=h)}else if(f>0){if(h<m)return!1;h<g&&(g=h)}}return!0}function Zg(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Qg(e,t){return null==e?t:e}function ev(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function tv(e,t,n){return xm(n)?function(e,t,n){const r=n.width(),i=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+Qg(t.x1,.5)*r,n.y1+Qg(t.y1,.5)*i,Math.max(r,i)*Qg(t.r1,0),n.x1+Qg(t.x2,.5)*r,n.y1+Qg(t.y2,.5)*i,Math.max(r,i)*Qg(t.r2,.5));else{const o=Qg(t.x1,0),s=Qg(t.y1,0),u=Qg(t.x2,1),c=Qg(t.y2,0);if(o!==u&&s!==c&&r!==i){const n=uf(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=ev(a.createLinearGradient(o,s,u,c),t.stops),a.fillRect(0,0,r,i),e.createPattern(n,"no-repeat")}a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+u*r,n.y1+c*i)}return ev(a,t.stops)}(e,n,t.bounds):n}function nv(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=tv(e,t,t.fill),!0)}var rv=[];function iv(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&(n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=tv(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||rv),e.lineDashOffset=t.strokeDashOffset||0),!0)}function av(e,t){return e.zindex-t.zindex||e.index-t.index}function ov(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(av)}function sv(e,t){var n,r,i=e.items;if(!i||!i.length)return;const a=ov(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}function uv(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const a=ov(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function cv(e){return function(t,n,r){sv(n,(n=>{r&&!r.intersects(n.bounds)||fv(e,t,n,n)}))}}function lv(e){return function(t,n,r){!n.items.length||r&&!r.intersects(n.bounds)||fv(e,t,n.items[0],n.items)}}function fv(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(Zg(t,n),n.fill&&nv(t,n,i)&&t.fill(),n.stroke&&iv(t,n,i)&&t.stroke()))}function pv(e){return e=e||he,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,uv(n,(n=>{const s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,r,i,a,o)?n:void 0}))}}function hv(e,t){return function(n,r,i,a){var o,s,u=Array.isArray(r)?r[0]:r,c=null==t?u.fill:t,l=u.stroke&&n.isPointInStroke;return l&&(o=u.strokeWidth,s=u.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=s?s:"butt"),!e(n,r)&&(c&&n.isPointInPath(i,a)||l&&n.isPointInStroke(i,a))}}function dv(e){return pv(hv(e))}function mv(e,t){return"translate("+e+","+t+")"}function gv(e){return"rotate("+e+")"}function vv(e){return mv(e.x||0,e.y||0)}function yv(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=_m),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return mv(e.x||0,e.y||0)+(e.angle?" "+gv(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(jg(e,n.angle),n),Eg(e,n).translate(n.x||0,n.y||0)},draw:cv(r),pick:dv(r),isect:n||Gg(r)}}var bv=yv("arc",(function(e,t){return ig.context(e)(t)}));function xv(e,t,n){function r(e,n){e.beginPath(),t(e,n)}const i=hv(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(jg(e),r),Eg(e,r[0]))},draw:lv(r),pick:function(e,t,n,r,a,o){var s=t.items,u=t.bounds;return!s||!s.length||u&&!u.contains(a,o)?null:(n*=e.pixelRatio,r*=e.pixelRatio,i(e,s,n,r)?s[0]:null)},isect:Kg,tip:n}}var wv=xv("area",(function(e,t){const n=t[0],r=n.interpolate||"linear";return("horizontal"===n.orient?og:ag).curve(Nm(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;--o>=0;)!1!==e[o].defined&&(r=Math.abs(e[o][a]-i))<s&&(s=r,n=e[o]);return n}));function Ev(e,t){e.beginPath(),fg(t)?pg(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Cv(e){const t=Qg(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Sv(e,t){const n=Cv(t);e("d",pg(null,t,n,n))}function Nv(e,t,n,r){const i=Cv(t);e.beginPath(),pg(e,t,(n||0)+i,(r||0)+i)}const Av=hv(Nv),kv=hv(Nv,!1),Dv=hv(Nv,!0);var _v={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",vv(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let t=0;t<r;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Eg(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){sv(t,(t=>{const r=t.x||0,i=t.y||0,a=t.strokeForeground,o=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&o&&(Nv(e,t,r,i),Zg(e,t),t.fill&&nv(e,t,o)&&e.fill(),t.stroke&&!a&&iv(e,t,o)&&e.stroke()),e.save(),e.translate(r,i),t.clip&&Ev(e,t),n&&n.translate(-r,-i),sv(t,(t=>{this.draw(e,t,n)})),n&&n.translate(r,i),e.restore(),a&&t.stroke&&o&&(Nv(e,t,r,i),Zg(e,t),iv(e,t,o)&&e.stroke())}))},pick:function(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const o=n*e.pixelRatio,s=r*e.pixelRatio;return uv(t,(u=>{let c,l,f;const p=u.bounds;if(p&&!p.contains(i,a))return;l=u.x||0,f=u.y||0;const h=l+(u.width||0),d=f+(u.height||0),m=u.clip;if(m&&(i<l||i>h||a<f||a>d))return;if(e.save(),e.translate(l,f),l=i-l,f=a-f,m&&fg(u)&&!Dv(e,u,o,s))return e.restore(),null;const g=u.strokeForeground,v=!1!==t.interactive;return v&&g&&u.stroke&&kv(e,u,o,s)?(e.restore(),u):(c=uv(u,(e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,l,f)?this.pick(e,n,r,l,f):null)),!c&&v&&(u.fill||!g&&u.stroke)&&Av(e,u,o,s)&&(c=u),e.restore(),c||null)}))},isect:Xg,content:function(e,t,n){e("clip-path",t.clip?mg(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),Sv(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Sv(e,t):e("d","")}},Mv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Tv(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then((t=>{e.image=t,e.image.url=e.url}))),n}function Ov(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function Iv(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function Fv(e,t){return"center"===e?t/2:"right"===e?t:0}function Rv(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var Bv={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=Tv(t,n),i=Ov(t,r),a=Iv(t,r),o=(t.x||0)-Fv(t.align,i),s=(t.y||0)-Rv(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",Mv["xmlns:xlink"],"xlink:href"),e("transform",mv(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=Ov(t,n),i=Iv(t,n),a=(t.x||0)-Fv(t.align,r),o=(t.y||0)-Rv(t.baseline,i);return e.set(a,o,a+r,o+i)},draw:function(e,t,n){sv(t,(t=>{if(n&&!n.intersects(t.bounds))return;const r=Tv(t,this);let i=Ov(t,r),a=Iv(t,r);if(0===i||0===a)return;let o,s,u,c,l=(t.x||0)-Fv(t.align,i),f=(t.y||0)-Rv(t.baseline,a);!1!==t.aspect&&(s=r.width/r.height,u=t.width/t.height,s==s&&u==u&&s!==u&&(u<s?(c=i/s,f+=(a-c)/2,a=c):(c=a*s,l+=(i-c)/2,i=c))),(r.complete||r.toDataURL)&&(Zg(e,t),e.globalAlpha=null!=(o=t.opacity)?o:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(r,l,f,i,a))}))},pick:pv(),isect:he,get:Tv,xOffset:Fv,yOffset:Rv},zv=xv("line",(function(e,t){const n=t[0],r=n.interpolate||"linear";return sg.curve(Nm(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function Pv(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*_m,u=t.pathCache;u&&u.path===n||((t.pathCache=u=Dm(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),Lm(e,u,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):Lm(e,u,r,i,a,o)}var Lv={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;1===n&&1===r||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return mv(e.x||0,e.y||0)+(e.angle?" "+gv(e.angle):"")+(e.scaleX||e.scaleY?" "+(t=e.scaleX||1,n=e.scaleY||1,"scale("+t+","+n+")"):"");var t,n}(t)),e("d",t.path)},bound:function(e,t){return Pv(jg(e,t.angle),t)?e.set(0,0,0,0):Eg(e,t,!0)},draw:cv(Pv),pick:dv(Pv),isect:Gg(Pv)};function jv(e,t){e.beginPath(),pg(e,t)}var Uv={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",pg(null,t))},bound:function(e,t){var n,r;return Eg(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:cv(jv),pick:dv(jv),isect:Xg};function qv(e,t,n){var r,i,a,o;return!(!t.stroke||!iv(e,t,n)||(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),0))}var Wv={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",vv(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return Eg(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){sv(t,(t=>{if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&qv(e,t,r)&&(Zg(e,t),e.stroke())}}))},pick:pv((function(e,t,n,r){return!!e.isPointInStroke&&qv(e,t,1)&&e.isPointInStroke(n,r)})),isect:Yg},Vv=yv("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),$v=yv("symbol",(function(e,t){return cg.context(e)(t)}),Kg);const Hv=wt();var Gv={height:Qv,measureWidth:Jv,estimateWidth:Xv,width:Xv,canvas:Kv};function Kv(e){Gv.width=e&&$g?Jv:Xv}function Xv(e,t){return Yv(ry(e,t),Qv(e))}function Yv(e,t){return~~(.8*e.length*t)}function Jv(e,t){return Qv(e)<=0||!(t=ry(e,t))?0:Zv(t,ay(e))}function Zv(e,t){const n=`(${t}) ${e}`;let r=Hv.get(n);return void 0===r&&($g.font=t,r=$g.measureText(e).width,Hv.set(n,r)),r}function Qv(e){return null!=e.fontSize?+e.fontSize||0:11}function ey(e){return null!=e.lineHeight?e.lineHeight:Qv(e)+2}function ty(e){return t=e.lineBreak&&e.text&&!Ee(e.text)?e.text.split(e.lineBreak):e.text,Ee(t)?t.length>1?t:t[0]:t;var t}function ny(e){const t=ty(e);return(Ee(t)?t.length-1:0)*ey(e)}function ry(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if(Gv.width===Jv){const t=ay(e);return e=>Zv(e,t)}{const t=Qv(e);return e=>Yv(e,t)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"",o="rtl"===e.dir,s=0,u=t.length;if(n-=r(a),o){for(;s<u;)i=s+u>>>1,r(t.slice(i))>n?s=i+1:u=i;return a+t.slice(s)}for(;s<u;)i=1+(s+u>>>1),r(t.slice(0,i))<n?s=i:u=i-1;return t.slice(0,s)+a}(e,n):n}function iy(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function ay(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Qv(e)+"px "+iy(e,t)}function oy(e){var t=e.baseline,n=Qv(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*ey(e):"line-bottom"===t?.29*n-.5*ey(e):0)}Kv(!0);const sy={left:"start",center:"middle",right:"end"},uy=new gg;function cy(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-Mm,n+=i*Math.cos(t),r+=i*Math.sin(t)),uy.x1=n,uy.y1=r,uy}function ly(e,t,n){var r,i=Gv.height(t),a=t.align,o=cy(t),s=o.x1,u=o.y1,c=t.dx||0,l=(t.dy||0)+oy(t)-Math.round(.8*i),f=ty(t);if(Ee(f)?(i+=ey(t)*(f.length-1),r=f.reduce(((e,n)=>Math.max(e,Gv.width(t,n))),0)):r=Gv.width(t,f),"center"===a?c-=r/2:"right"===a&&(c-=r),e.set(c+=s,l+=u,c+r,l+i),t.angle&&!n)e.rotate(t.angle*_m,s,u);else if(2===n)return e.rotatedPoints(t.angle*_m,s,u);return e}var fy={type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+oy(t),a=cy(t),o=a.x1,s=a.y1,u=t.angle||0;e("text-anchor",sy[t.align]||"start"),u?(n=mv(o,s)+" "+gv(u),(r||i)&&(n+=" "+mv(r,i))):n=mv(o+r,s+i),e("transform",n)},bound:ly,draw:function(e,t,n){sv(t,(t=>{var r,i,a,o,s,u,c,l=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===l||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=ay(t),e.textAlign=t.align||"left",i=(r=cy(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*_m),i=a=0),i+=t.dx||0,a+=(t.dy||0)+oy(t),u=ty(t),Zg(e,t),Ee(u))for(s=ey(t),o=0;o<u.length;++o)c=ry(t,u[o]),t.fill&&nv(e,t,l)&&e.fillText(c,i,a),t.stroke&&iv(e,t,l)&&e.strokeText(c,i,a),a+=s;else c=ry(t,u),t.fill&&nv(e,t,l)&&e.fillText(c,i,a),t.stroke&&iv(e,t,l)&&e.strokeText(c,i,a);t.angle&&e.restore()}}))},pick:pv((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=cy(t),s=o.x1,u=o.y1,c=ly(uy,t,1),l=-t.angle*_m,f=Math.cos(l),p=Math.sin(l),h=f*i-p*a+(s-f*s+p*u),d=p*i+f*a+(u-p*s-f*u);return c.contains(h,d)})),isect:function(e,t){const n=ly(uy,e,2);return Jg(t,n[0],n[1],n[2],n[3])||Jg(t,n[0],n[1],n[4],n[5])||Jg(t,n[4],n[5],n[6],n[7])||Jg(t,n[2],n[3],n[6],n[7])}},py=xv("trail",(function(e,t){return lg.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null})),hy={arc:bv,area:wv,group:_v,image:Bv,line:zv,path:Lv,rect:Uv,rule:Wv,shape:Vv,symbol:$v,text:fy,trail:py};function dy(e,t,n){var r=hy[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new gg),e,n)}var my={mark:null};function gy(e,t,n){var r,i,a,o,s=hy[e.marktype],u=s.bound,c=e.items,l=c&&c.length;if(s.nested)return l?a=c[0]:(my.mark=e,a=my),o=dy(a,u,n),t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new gg,l)for(r=0,i=c.length;r<i;++r)t.union(dy(c[r],u,n));return e.bounds=t}const vy=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function yy(e,t){return JSON.stringify(e,vy,t)}function by(e){return xy("string"==typeof e?JSON.parse(e):e)}function xy(e){var t,n,r,i=e.marktype,a=e.items;if(a)for(n=0,r=a.length;n<r;++n)t=i?"mark":"group",a[n][t]=e,a[n].zindex&&(a[n][t].zdirty=!0),"group"===(i||t)&&xy(a[n]);return i&&gy(e),e}function wy(e){arguments.length?this.root=by(e):(this.root=Ey({marktype:"group",name:"root",role:"frame"}),this.root.items=[new yg(this.root)])}function Ey(e,t){const n={bounds:new gg,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Cy(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Sy(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function Ny(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=Cy(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function Ay(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function ky(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function Dy(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function _y(e,t){this._active=null,this._handlers={},this._loader=e||To(),this._tooltip=t||My}function My(e,t,n,r){e.element().setAttribute("title",r||"")}function Ty(e){this._el=null,this._bgcolor=null,this._loader=new bg(e)}wy.prototype={toJSON(e){return yy(this.root,e||0)},mark(e,t,n){const r=Ey(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},_y.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const e in t)n.push(...t[e]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then((t=>{const n=new MouseEvent(e.type,e),r=Cy(null,"a");for(const e in t)r.setAttribute(e,t[e]);r.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=hy[o.marktype]).tip){for((a=Dy(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();let s=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,u+=e.y||0;return{x:s,y:u,width:a,height:o,left:s,top:u,right:s+a,bottom:u+o}}},Ty.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then((()=>t)):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then((t=>{t&&e(),n._ready=null}))}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const Oy="dragenter",Iy="dragleave",Fy="dragover",Ry="mousedown",By="mousemove",zy="mouseout",Py="mouseover",Ly="click",jy="mousewheel",Uy="touchstart",qy="touchmove",Wy="touchend",Vy=By,$y=zy,Hy=Ly;function Gy(e,t){_y.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function Ky(e,t){(e=>e===Uy||e===qy||e===Wy?[Uy,qy,Wy]:[e])(t).forEach((t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t)))}function Xy(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function Yy(e){return function(t){this.fire(e,t),this._active=null}}ft(Gy,_y,{initialize(e,t,n){return this._canvas=e&&Sy(e,"canvas"),[Ly,Ry,By,zy,Iy].forEach((e=>Ky(this,e))),_y.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",Oy,Iy,Fy,Ry,"mouseup",By,zy,Py,Ly,"dblclick","wheel",jy,Uy,qy,Wy],DOMMouseScroll(e){this.fire(jy,e)},mousemove:Xy(By,Py,zy),dragover:Xy(Fy,Oy,Iy),mouseout:Yy(zy),dragleave:Yy(Iy),mousedown(e){this._down=this._active,this.fire(Ry,e)},click(e){this._down===this._active&&(this.fire(Ly,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Uy,e,!0)},touchmove(e){this.fire(qy,e,!0)},touchend(e){this.fire(Wy,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===Hy&&r&&r.href?this.handleHref(t,r,r.href):e!==Vy&&e!==$y||this.handleTooltip(t,r,e!==$y),i)for(let e=0,n=i.length;e<n;++e)i[e].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(Ky(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=Dy(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context();return hy[e.marktype].pick.call(this,a,e,t,n,r,i)}});var Jy="undefined"!=typeof window&&window.devicePixelRatio||1;function Zy(e){Ty.call(this,e),this._options={},this._redraw=!1,this._dirty=new gg,this._tempb=new gg}const Qy=Ty.prototype;function eb(e,t){_y.call(this,e,t);const n=this;n._hrefHandler=tb(n,((e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=tb(n,((e,t)=>{n.handleTooltip(e,t,e.type!==$y)}))}ft(Zy,Ty,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:uf(1,1,this._options.type),e&&this._canvas&&(Ay(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),Qy.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(Qy.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){const o="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,s=e.getContext("2d"),u=o?Jy:i;e.width=t*u,e.height=n*u;for(const e in a)s[e]=a[e];o&&1!==u&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=u,s.setTransform(u,0,0,u,u*r[0],u*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||oe("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=((e,t,n)=>(new gg).set(0,0,t,n).translate(-e[0],-e[1]))(n,r,i);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,s),t.restore(),a.clear(),this},draw(e,t,n){const r=hy[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),Xe(n)?(e.beginPath(),n(e),e.clip()):Ev(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});const tb=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};ft(eb,_y,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(Hy,this._hrefHandler),r.removeEventListener(Vy,this._tooltipHandler),r.removeEventListener($y,this._tooltipHandler)),this._svg=r=e&&Sy(e,"svg"),r&&(r.addEventListener(Hy,this._hrefHandler),r.addEventListener(Vy,this._tooltipHandler),r.addEventListener($y,this._tooltipHandler)),_y.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:tb(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const nb="aria-hidden",rb="aria-label",ib="role",ab="aria-roledescription",ob="graphics-object",sb="graphics-symbol",ub=(e,t,n)=>({[ib]:e,[ab]:t,[rb]:n||void 0}),cb=Tt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),lb={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?mb(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(r?` titled '${r}'`:"")+` for a ${Pd(s)?"discrete":s} scale`+` with ${vm(o,a,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?mb(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,u=o.dataflow.locale();return((c=r).length?c[0].toUpperCase()+c.slice(1):c)+(n?` titled '${n}'`:"")+` for ${function(e){return(e=e.map((e=>e+("fill"===e||"stroke"===e?" color":"")))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+De(e)}(a)}`+` with ${vm(u,s,e)}`;var c}},"title-text":{desc:"title",caption:e=>`Title text '${db(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${db(e)}'`}},fb={ariaRole:ib,ariaRoleDescription:ab,description:rb};function pb(e,t){const n=!1===t.aria;if(e(nb,n||void 0),n||null==t.description)for(const t in fb)e(fb[t],void 0);else{const n=t.mark.marktype;e(rb,t.description),e(ib,t.ariaRole||("group"===n?ob:sb)),e(ab,t.ariaRoleDescription||`${n} mark`)}}function hb(e){return!1===e.aria?{[nb]:!0}:cb[e.role]?null:lb[e.role]?function(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return ub(t.role||sb,t.desc,n.description||r(n))}catch(e){return null}}(e,lb[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some((e=>null!=e.description&&!1!==e.aria));return ub(n?ob:sb,`${t} mark container`,e.description)}(e)}function db(e){return Ge(e.text).join(" ")}function mb(e){try{return Ge(De(e.items).items[0].text).join(" ")}catch(e){return null}}const gb=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function vb(){let e="",t="",n="";const r=[],i=()=>t=n="",a=(e,n)=>{var r;return null!=n&&(t+=` ${e}="${r=n,gb(r).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),o},o={open(s,...u){(a=>{t&&(e+=`${t}>${n}`,i()),r.push(a)})(s),t="<"+s;for(const e of u)for(const t in e)a(t,e[t]);return o},close(){const a=r.pop();return e+=t?t+(n?`>${n}</${a}>`:"/>"):`</${a}>`,i(),o},attr:a,text:e=>(n+=gb(e),o),toString:()=>e};return o}const yb=e=>bb(vb(),e)+"";function bb(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let t=0;t<r;++t)e.attr(n[t].name,n[t].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let t=0;t<r;t++){const r=n[t];3===r.nodeType?e.text(r.nodeValue):bb(e,r)}}return e.close()}const xb={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},wb={fill:"none","stroke-miterlimit":10},Eb="http://www.w3.org/2000/xmlns/",Cb=Mv.xmlns;function Sb(e){Ty.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Nb=Ty.prototype;function Ab(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function kb(e,t,n){let r,i,a;if("radial"===t.gradient){let r=Ny(e,n++,"pattern",Cb);Rb(r,{id:bm+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=Ny(r,0,"rect",Cb),Rb(r,{width:1,height:1,fill:`url(${zb()}#${t.id})`}),Rb(e=Ny(e,n++,"radialGradient",Cb),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else Rb(e=Ny(e,n++,"linearGradient",Cb),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=Ny(e,r,"stop",Cb),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return Ay(e,r),n}function Db(e,t,n){let r;return(e=Ny(e,n,"clipPath",Cb)).setAttribute("id",t.id),t.path?(r=Ny(e,0,"path",Cb),r.setAttribute("d",t.path)):(r=Ny(e,0,"rect",Cb),Rb(r,{x:0,y:0,width:t.width,height:t.height})),Ay(e,1),n+1}function _b(e,t,n,r,i){let a,o=e._svg;if(!o&&(a=t.ownerDocument,o=Cy(a,r,Cb),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===r))){const t=Cy(a,"path",Cb);o.appendChild(t),t.__data__=e;const n=Cy(a,"g",Cb);o.appendChild(n),n.__data__=e;const r=Cy(a,"path",Cb);o.appendChild(r),r.__data__=e,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}ft(Sb,Ty,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=Ny(e,0,"svg",Cb),this._svg.setAttributeNS(Eb,"xmlns",Cb),this._svg.setAttributeNS(Eb,"xmlns:xlink",Mv["xmlns:xlink"]),this._svg.setAttribute("version",Mv.version),this._svg.setAttribute("class","marks"),Ay(e,1),this._root=Ny(this._svg,0,"g",Cb),Rb(this._root,wb),Ay(this._svg,1)),this.background(this._bgcolor),Nb.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Nb.background.apply(this,arguments)},resize(e,t,n,r){return Nb.resize.call(this,e,t,n,r),this._svg&&(Rb(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=Ny(e,0,"rect",Cb),Rb(n,{width:this._width,height:this._height,fill:t}));const r=yb(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),Ay(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,o,s,u;for(o=0,s=e.length;o<s;++o)n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,a=hy[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,Ab(n,t),r.items.forEach((e=>{e.dirty=t}))),r.zdirty||(n.exit?(a.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(a,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null):(n=a.nested?r.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,Ab(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=hy[t.marktype],a=!1===t.interactive?"none":null,o="g"===i.tag;let s=null,u=0;const c=_b(t,e,n,"g",r);c.setAttribute("class",ky(t));const l=hb(t);for(const e in l)Bb(c,e,l[e]);o||Bb(c,"pointer-events",a),Bb(c,"clip-path",t.clip?mg(this,t,t.group):null);const f=e=>{const t=this.isDirty(e),n=_b(e,c,s,i.tag,r);t&&(this._update(i,n,e),o&&function(e,t,n){t=t.lastChild.previousSibling;let r,i=0;sv(n,(n=>{r=e.mark(t,n,r),++i})),Ay(t,1+i)}(this,n,e)),s=n,++u};return i.nested?t.items.length&&f(t.items[0]):sv(t,f),Ay(c,u),c},_update(e,t,n){Mb=t,Tb=t.__values__,pb(Ib,n),e.attr(Ib,n,this);const r=Ob[e.type];r&&r.call(this,e,t,n),Mb&&this.style(Mb,n)},style(e,t){if(null!=t)for(const n in xb){let r="font"===n?iy(t):t[n];if(r===Tb[n])continue;const i=xb[n];null==r?e.removeAttribute(i):(xm(r)&&(r=wm(r,this._defs.gradient,zb())),e.setAttribute(i,r+"")),Tb[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=Ny(e,1,"defs",Cb)),r=kb(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=Ny(e,1,"defs",Cb)),r=Db(n,t.clipping[i],r);n&&(0===r?(e.removeChild(n),t.el=null):Ay(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let Mb=null,Tb=null;const Ob={group(e,t,n){const r=Mb=t.childNodes[2];Tb=r.__values__,e.foreground(Ib,n,this),Tb=t.__values__,Mb=t.childNodes[1],e.content(Ib,n,this);const i=Mb=t.childNodes[0];e.background(Ib,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==Tb.events&&(Bb(r,"pointer-events",a),Bb(i,"pointer-events",a),Tb.events=a),n.strokeForeground&&n.stroke){const e=n.fill;Bb(r,"display",null),this.style(i,n),Bb(i,"stroke",null),e&&(n.fill=null),Tb=r.__values__,this.style(r,n),e&&(n.fill=e),Mb=null}else Bb(r,"display","none")},image(e,t,n){!1===n.smooth?(Fb(t,"image-rendering","optimizeSpeed"),Fb(t,"image-rendering","pixelated")):Fb(t,"image-rendering",null)},text(e,t,n){const r=ty(n);let i,a,o,s;Ee(r)?(a=r.map((e=>ry(n,e))),i=a.join("\n"),i!==Tb.text&&(Ay(t,0),o=t.ownerDocument,s=ey(n),a.forEach(((e,r)=>{const i=Cy(o,"tspan",Cb);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),t.appendChild(i)})),Tb.text=i)):(a=ry(n,r),a!==Tb.text&&(t.textContent=a,Tb.text=a)),Bb(t,"font-family",iy(n)),Bb(t,"font-size",Qv(n)+"px"),Bb(t,"font-style",n.fontStyle),Bb(t,"font-variant",n.fontVariant),Bb(t,"font-weight",n.fontWeight)}};function Ib(e,t,n){t!==Tb[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}(Mb,e,t,n):Bb(Mb,e,t),Tb[e]=t)}function Fb(e,t,n){n!==Tb[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),Tb[t]=n)}function Rb(e,t){for(const n in t)Bb(e,n,t[n])}function Bb(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function zb(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Pb(e){Ty.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}ft(Pb,Ty,{svg(){return this._text},_render(e){const t=vb();t.open("svg",rt({},Mv,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",wb,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=hy[t.marktype],r=n.tag,i=[pb,n.attr];e.open("g",{class:ky(t),"clip-path":t.clip?mg(this,t,t.group):null},hb(t),{"pointer-events":"g"!==r&&!1===t.interactive?"none":null});const a=a=>{const o=this.href(a);if(o&&e.open("a",o),e.open(r,this.attr(t,a,i,"g"!==r?r:null)),"text"===r){const t=ty(a);if(Ee(t)){const n={x:0,dy:ey(a)};for(let r=0;r<t.length;++r)e.open("tspan",r?n:null).text(ry(a,t[r])).close()}else e.text(ry(a,t))}else if("g"===r){const r=a.strokeForeground,i=a.fill,o=a.stroke;r&&o&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),sv(a,(t=>this.mark(e,t))),e.close(),r&&o?(i&&(a.fill=null),a.stroke=o,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),i&&(a.fill=i)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),o&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):sv(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then((e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e}))}return null},attr(e,t,n,r){const i={},a=(e,t,n,r)=>{i[r||e]=t};return Array.isArray(n)?n.forEach((e=>e(a,t,this))):n(a,t,this),r&&function(e,t,n,r,i){if(null==t)return e;if("bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none"),"bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===r&&(e["font-family"]=iy(t),e["font-size"]=Qv(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const n in xb){let r=t[n];const a=xb[n];("transparent"!==r||"fill"!==a&&"stroke"!==a)&&null!=r&&(xm(r)&&(r=wm(r,i.gradient,"")),e[a]=r)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const r=t[n],i=r.stops;"radial"===r.gradient?(e.open("pattern",{id:bm+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e.open("stop",{offset:i[t].offset,"stop-color":i[t].color}).close();e.close()}for(const t in n){const r=n[t];e.open("clipPath",{id:t}),r.path?e.open("path",{d:r.path}).close():e.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),e.close()}e.close()}}});const Lb={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},jb={};function Ub(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(jb[e]=t,this):jb[e]}function qb(e,t,n){const r=[],i=(new gg).union(t),a=e.marktype;return a?Wb(e,i,n,r):"group"===a?Vb(e,i,n,r):oe("Intersect scene must be mark node or group item.")}function Wb(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const i=e.items,a=e.marktype,o=i.length;let s=0;if("group"===a)for(;s<o;++s)Vb(i[s],t,n,r);else for(const e=hy[a].isect;s<o;++s){const n=i[s];$b(n,t,e)&&r.push(n)}}return r}function Vb(e,t,n,r){n&&n(e.mark)&&$b(e,t,hy.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let e=0;e<a;++e)Wb(i[e],t,n,r);t.translate(o,s)}return r}function $b(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}jb.canvas=jb.png={renderer:Zy,headless:Zy,handler:Gy},jb.svg={renderer:Sb,headless:Pb,handler:eb},jb.none={};const Hb=new gg;function Gb(e){const t=e.clip;if(Xe(t))t(jg(Hb.clear()));else{if(!t)return;Hb.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(Hb)}function Kb(e,t,n){return e===t||("path"===n?Xb(e,t):e instanceof Date&&t instanceof Date?+e==+t:gt(e)&&gt(t)?Math.abs(e-t)<=1e-9:e&&t&&(Ce(e)||Ce(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!Kb(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function Xb(e,t){return Kb(Dm(e),Dm(t))}function Yb(){dg(),ym=0}const Jb="top",Zb="left",Qb="right",ex="bottom",tx="start",nx="middle",rx="end",ix="group",ax="axis",ox="title",sx="legend",ux="row-header",cx="row-footer",lx="row-title",fx="column-header",px="column-footer",hx="column-title",dx="none",mx="all",gx="each",vx="flush",yx="column",bx="row";function xx(e){ms.call(this,null,e)}function wx(e,t,n){return t(e.bounds.clear(),e,n)}ft(xx,ms,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=hy[i],o=a.bound;let s,u=r.bounds;if(a.nested)r.items.length&&n.dirty(r.items[0]),u=wx(r,o),r.items.forEach((e=>{e.bounds.clear().union(u)}));else if(i===ix||e.modified())switch(t.visit(t.MOD,(e=>n.dirty(e))),u.clear(),r.items.forEach((e=>u.union(wx(e,o)))),r.role){case ax:case sx:case ox:t.reflow()}else s=t.changed(t.REM),t.visit(t.ADD,(e=>{u.union(wx(e,o))})),t.visit(t.MOD,(e=>{s=s||u.alignsWith(e.bounds),n.dirty(e),u.union(wx(e,o))})),s&&(u.clear(),r.items.forEach((e=>u.union(e.bounds))));return Gb(r),t.modifies("bounds")}});const Ex=":vega_identifier:";function Cx(e){ms.call(this,0,e)}function Sx(e){ms.call(this,null,e)}function Nx(e){ms.call(this,null,e)}Cx.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},ft(Cx,ms,{transform(e,t){const n=(i=t.dataflow)._signals[Ex]||(i._signals[Ex]=i.add(0)),r=e.as;var i;let a=n.value;return t.visit(t.ADD,(e=>e[r]=e[r]||++a)),n.set(this.value=a),t}}),ft(Sx,ms,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===ix?yg:vg;return t.visit(t.ADD,(e=>r.call(e,n))),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const Ax={parity:e=>e.filter(((e,t)=>t%2?e.opacity=0:1)),greedy:(e,t)=>{let n;return e.filter(((e,r)=>r&&kx(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1)))}},kx=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),Dx=(e,t)=>{for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(kx(a,n=e[r].bounds,t))return!0},_x=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},Mx=e=>(e.forEach((e=>e.opacity=1)),e),Tx=(e,t)=>e.reflow(t.modified()).modifies("opacity");function Ox(e){ms.call(this,null,e)}ft(Nx,ms,{transform(e,t){const n=Ax[e.method]||Ax.parity,r=e.separation||0;let i,a,o=t.materialize(t.SOURCE).source;if(!o||!o.length)return;if(!e.method)return e.modified("method")&&(Mx(o),t=Tx(t,e)),t;if(o=o.filter(_x),!o.length)return;if(e.sort&&(o=o.slice().sort(e.sort)),i=Mx(o),t=Tx(t,e),i.length>=3&&Dx(i,r)){do{i=n(i,r)}while(i.length>=3&&Dx(i,r));i.length<3&&!De(o).opacity&&(i.length>1&&(De(i).opacity=0),De(o).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(a=((e,t,n)=>{var r=e.range(),i=new gg;return t===Jb||t===ex?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),e=>i.encloses(e.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),o.forEach((e=>{a(e)||(e.opacity=0)})));const s=i[0].mark.bounds.clear();return o.forEach((e=>{e.opacity&&s.union(e.bounds)})),t}}),ft(Ox,ms,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,(e=>n.dirty(e))),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const Ix=new gg;function Fx(e,t,n){return e[t]===n?0:(e[t]=n,1)}function Rx(e){var t=e.items[0].orient;return t===Zb||t===Qb}function Bx(e,t,n,r){var i,a,o=t.items[0],s=o.datum,u=null!=o.translate?o.translate:.5,c=o.orient,l=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(s),f=o.range,p=o.offset,h=o.position,d=o.minExtent,m=o.maxExtent,g=s.title&&o.items[l[2]].items[0],v=o.titlePadding,y=o.bounds,b=g&&ny(g),x=0,w=0;switch(Ix.clear().union(y),y.clear(),(i=l[0])>-1&&y.union(o.items[i].bounds),(i=l[1])>-1&&y.union(o.items[i].bounds),c){case Jb:x=h||0,w=-p,a=Math.max(d,Math.min(m,-y.y1)),y.add(0,-a).add(f,0),g&&zx(e,g,a,v,b,0,-1,y);break;case Zb:x=-p,w=h||0,a=Math.max(d,Math.min(m,-y.x1)),y.add(-a,0).add(0,f),g&&zx(e,g,a,v,b,1,-1,y);break;case Qb:x=n+p,w=h||0,a=Math.max(d,Math.min(m,y.x2)),y.add(0,0).add(a,f),g&&zx(e,g,a,v,b,1,1,y);break;case ex:x=h||0,w=r+p,a=Math.max(d,Math.min(m,y.y2)),y.add(0,0).add(f,a),g&&zx(e,g,a,v,0,0,1,y);break;default:x=o.x,w=o.y}return Eg(y.translate(x,w),o),Fx(o,"x",x+u)|Fx(o,"y",w+u)&&(o.bounds=Ix,e.dirty(o),o.bounds=y,e.dirty(o)),o.mark.bounds.clear().union(y)}function zx(e,t,n,r,i,a,o,s){const u=t.bounds;if(t.auto){const s=o*(n+i+r);let c=0,l=0;e.dirty(t),a?c=(t.x||0)-(t.x=s):l=(t.y||0)-(t.y=s),t.mark.bounds.clear().union(u.translate(-c,-l)),e.dirty(t)}s.union(u)}const Px=(e,t)=>Math.floor(Math.min(e,t)),Lx=(e,t)=>Math.ceil(Math.max(e,t));function jx(e){return(new gg).set(0,0,e.width||0,e.height||0)}function Ux(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function qx(e,t,n){const r=Ce(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function Wx(e){return e<0?Math.ceil(-e):0}function Vx(e,t,n){var r,i,a,o,s,u,c,l,f,p,h,d=!n.nodirty,m=n.bounds===vx?jx:Ux,g=Ix.set(0,0,0,0),v=qx(n.align,yx),y=qx(n.align,bx),b=qx(n.padding,yx),x=qx(n.padding,bx),w=n.columns||t.length,E=w<=0?1:Math.ceil(t.length/w),C=t.length,S=Array(C),N=Array(w),A=0,k=Array(C),D=Array(E),_=0,M=Array(C),T=Array(C),O=Array(C);for(i=0;i<w;++i)N[i]=0;for(i=0;i<E;++i)D[i]=0;for(i=0;i<C;++i)u=t[i],s=O[i]=m(u),u.x=u.x||0,M[i]=0,u.y=u.y||0,T[i]=0,a=i%w,o=~~(i/w),A=Math.max(A,c=Math.ceil(s.x2)),_=Math.max(_,l=Math.ceil(s.y2)),N[a]=Math.max(N[a],c),D[o]=Math.max(D[o],l),S[i]=b+Wx(s.x1),k[i]=x+Wx(s.y1),d&&e.dirty(t[i]);for(i=0;i<C;++i)i%w==0&&(S[i]=0),i<w&&(k[i]=0);if(v===gx)for(a=1;a<w;++a){for(h=0,i=a;i<C;i+=w)h<S[i]&&(h=S[i]);for(i=a;i<C;i+=w)S[i]=h+N[a-1]}else if(v===mx){for(h=0,i=0;i<C;++i)i%w&&h<S[i]&&(h=S[i]);for(i=0;i<C;++i)i%w&&(S[i]=h+A)}else for(v=!1,a=1;a<w;++a)for(i=a;i<C;i+=w)S[i]+=N[a-1];if(y===gx)for(o=1;o<E;++o){for(h=0,r=(i=o*w)+w;i<r;++i)h<k[i]&&(h=k[i]);for(i=o*w;i<r;++i)k[i]=h+D[o-1]}else if(y===mx){for(h=0,i=w;i<C;++i)h<k[i]&&(h=k[i]);for(i=w;i<C;++i)k[i]=h+_}else for(y=!1,o=1;o<E;++o)for(r=(i=o*w)+w;i<r;++i)k[i]+=D[o-1];for(f=0,i=0;i<C;++i)f=S[i]+(i%w?f:0),M[i]+=f-t[i].x;for(a=0;a<w;++a)for(p=0,i=a;i<C;i+=w)p+=k[i],T[i]+=p-t[i].y;if(v&&qx(n.center,yx)&&E>1)for(i=0;i<C;++i)(f=(s=v===mx?A:N[i%w])-O[i].x2-t[i].x-M[i])>0&&(M[i]+=f/2);if(y&&qx(n.center,bx)&&1!==w)for(i=0;i<C;++i)(p=(s=y===mx?_:D[~~(i/w)])-O[i].y2-t[i].y-T[i])>0&&(T[i]+=p/2);for(i=0;i<C;++i)g.union(O[i].translate(M[i],T[i]));switch(f=qx(n.anchor,"x"),p=qx(n.anchor,"y"),qx(n.anchor,yx)){case rx:f-=g.width();break;case nx:f-=g.width()/2}switch(qx(n.anchor,bx)){case rx:p-=g.height();break;case nx:p-=g.height()/2}for(f=Math.round(f),p=Math.round(p),g.clear(),i=0;i<C;++i)t[i].mark.bounds.clear();for(i=0;i<C;++i)(u=t[i]).x+=M[i]+=f,u.y+=T[i]+=p,g.union(u.mark.bounds.union(u.bounds.translate(M[i],T[i]))),d&&e.dirty(u);return g}function $x(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function Hx(e,t){return e.bounds[t]}function Gx(e,t,n,r,i,a,o,s,u,c,l,f,p,h){var d,m,g,v,y,b,x,w,E,C=n.length,S=0,N=0;if(!C)return S;for(d=l;d<C;d+=f)n[d]&&(S=o(S,u(n[d],c)));if(!t.length)return S;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),S+=a,m=0,v=t.length;m<v;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(d=l,m=0,v=t.length;m<v;++m,d+=f){for(y=(b=t[m]).mark.bounds,g=d;g>=0&&null==(x=n[g]);g-=p);s?(w=null==h?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),E=S):(w=S,E=null==h?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),y.union(b.bounds.translate(w-(b.x||0),E-(b.y||0))),b.x=w,b.y=E,e.dirty(b),N=o(N,y[c])}return N}function Kx(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function Xx(e,t,n,r,i,a,o){const s=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),u=function(e,t){let n=-1/0;return e.forEach((e=>{null!=e.offset&&(n=Math.max(n,e.offset))})),n>-1/0?n:t}(e,s("offset",0)),c=s("anchor",tx),l=c===rx?1:c===nx?.5:0,f={align:gx,bounds:s("bounds",vx),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case Zb:f.anchor={x:Math.floor(r.x1)-u,column:rx,y:l*(o||r.height()+2*r.y1),row:c};break;case Qb:f.anchor={x:Math.ceil(r.x2)+u,y:l*(o||r.height()+2*r.y1),row:c};break;case Jb:f.anchor={y:Math.floor(i.y1)-u,row:rx,x:l*(a||i.width()+2*i.x1),column:c};break;case ex:f.anchor={y:Math.ceil(i.y2)+u,x:l*(a||i.width()+2*i.x1),column:c};break;case"top-left":f.anchor={x:u,y:u};break;case"top-right":f.anchor={x:a-u,y:u,column:rx};break;case"bottom-left":f.anchor={x:u,y:o-u,row:rx};break;case"bottom-right":f.anchor={x:a-u,y:o-u,column:rx,row:rx}}return f}function Yx(e,t){var n,r,i=t.items[0],a=i.datum,o=i.orient,s=i.bounds,u=i.x,c=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,u=t.titlePadding||0,c=r-o.x,l=r-o.y;switch(o.orient){case Zb:i+=Math.ceil(o.bounds.width())+u;break;case Qb:case ex:break;default:a+=o.bounds.height()+u}switch((i||a)&&Zx(e,n,i,a),o.orient){case Zb:l+=Jx(t,n,o,s,1,1);break;case Qb:c+=Jx(t,n,o,rx,0,0)+u,l+=Jx(t,n,o,s,1,1);break;case ex:c+=Jx(t,n,o,s,0,0),l+=Jx(t,n,o,rx,-1,0,1)+u;break;default:c+=Jx(t,n,o,s,0,0)}(c||l)&&Zx(e,o,c,l),(c=Math.round(o.bounds.x1-r))<0&&(Zx(e,n,-c,0),Zx(e,o,-c,0))}else(i||a)&&Zx(e,n,i,a)}(e,i,i.items[0].items[0]),s=function(e,t){return e.items.forEach((e=>t.union(e.bounds))),t.x1=e.padding,t.y1=e.padding,t}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),"symbol"===a.type&&function(e){const t=e.reduce(((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e)),{});e.forEach((e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y}))}(i.items[0].items[0].items[0].items),o!==dx&&(i.x=u=0,i.y=c=0),i.width=n,i.height=r,Eg(s.set(u,c,u+n,c+r),i),i.mark.bounds.clear().union(s),i}function Jx(e,t,n,r,i,a,o){const s="symbol"!==e.datum.type,u=n.datum.vgrad,c=(!s||!a&&u||o?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,l=u&&a?c:0,f=u&&a?0:c,p=i<=0?0:ny(n);return Math.round(r===tx?l:r===rx?f-p:.5*(c-p))}function Zx(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function Qx(e){ms.call(this,null,e)}function ew(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function tw(e){ms.call(this,null,e)}function nw(e){ms.call(this,null,e)}function rw(){return Lo({})}function iw(e){ms.call(this,null,e)}function aw(e){ms.call(this,[],e)}ft(Qx,ms,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach((t=>{e.layout&&function(e,t,n){var r,i,a,o,s,u,c,l=function(e){var t,n,r=e.items,i=r.length,a=0;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<i;++a)if(n=(t=r[a]).items,t.marktype===ix)switch(t.role){case ax:case sx:case ox:break;case ux:o.rowheaders.push(...n);break;case cx:o.rowfooters.push(...n);break;case fx:o.colheaders.push(...n);break;case px:o.colfooters.push(...n);break;case lx:o.rowtitle=n[0];break;case hx:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(t),f=l.marks,p=n.bounds===vx?$x:Hx,h=n.offset,d=n.columns||f.length,m=d<=0?1:Math.ceil(f.length/d),g=m*d;const v=Vx(e,f,n);v.empty()&&v.set(0,0,0,0),l.rowheaders&&(u=qx(n.headerBand,bx,null),r=Gx(e,l.rowheaders,f,0,m,-qx(h,"rowHeader"),Px,0,p,"x1",0,d,1,u)),l.colheaders&&(u=qx(n.headerBand,yx,null),i=Gx(e,l.colheaders,f,0,d,-qx(h,"columnHeader"),Px,1,p,"y1",0,1,d,u)),l.rowfooters&&(u=qx(n.footerBand,bx,null),a=Gx(e,l.rowfooters,f,0,m,qx(h,"rowFooter"),Lx,0,p,"x2",d-1,d,1,u)),l.colfooters&&(u=qx(n.footerBand,yx,null),o=Gx(e,l.colfooters,f,0,d,qx(h,"columnFooter"),Lx,1,p,"y2",g-d,1,d,u)),l.rowtitle&&(s=qx(n.titleAnchor,bx),c=qx(h,"rowTitle"),c=s===rx?a+c:r-c,u=qx(n.titleBand,bx,.5),Kx(e,l.rowtitle,c,0,v,u)),l.coltitle&&(s=qx(n.titleAnchor,yx),c=qx(h,"columnTitle"),c=s===rx?o+c:i-c,u=qx(n.titleBand,yx,.5),Kx(e,l.coltitle,c,1,v,u))}(n,t,e.layout),function(e,t,n){var r,i,a,o,s,u=t.items,c=Math.max(0,t.width||0),l=Math.max(0,t.height||0),f=(new gg).set(0,0,c,l),p=f.clone(),h=f.clone(),d=[];for(o=0,s=u.length;o<s;++o)switch((i=u[o]).role){case ax:(Rx(i)?p:h).union(Bx(e,i,c,l));break;case ox:r=i;break;case sx:d.push(Yx(e,i));break;case"frame":case"scope":case ux:case cx:case lx:case fx:case px:case hx:p.union(i.bounds),h.union(i.bounds);break;default:f.union(i.bounds)}if(d.length){const t={};d.forEach((e=>{(a=e.orient||Qb)!==dx&&(t[a]||(t[a]=[])).push(e)}));for(const r in t){const i=t[r];Vx(e,i,Xx(i,r,n.legends,p,h,c,l))}d.forEach((t=>{const r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&"fit"===n.autosize.type)switch(t.orient){case Zb:case Qb:f.add(r.x1,0).add(r.x2,0);break;case Jb:case ex:f.add(0,r.y1).add(0,r.y2)}else f.union(r)}))}f.union(p).union(h),r&&f.union(function(e,t,n,r,i){var a,o=t.items[0],s=o.frame,u=o.orient,c=o.anchor,l=o.offset,f=o.padding,p=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],d=u===Zb||u===Qb?r:n,m=0,g=0,v=0,y=0,b=0;if(s!==ix?u===Zb?(m=i.y2,d=i.y1):u===Qb?(m=i.y1,d=i.y2):(m=i.x1,d=i.x2):u===Zb&&(m=r,d=0),a=c===tx?m:c===rx?d:(m+d)/2,h&&h.text){switch(u){case Jb:case ex:b=p.bounds.height()+f;break;case Zb:y=p.bounds.width()+f;break;case Qb:y=-p.bounds.width()-f}Ix.clear().union(h.bounds),Ix.translate(y-(h.x||0),b-(h.y||0)),Fx(h,"x",y)|Fx(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(Ix),h.mark.bounds.clear().union(Ix),e.dirty(h)),Ix.clear().union(h.bounds)}else Ix.clear();switch(Ix.union(p.bounds),u){case Jb:g=a,v=i.y1-Ix.height()-l;break;case Zb:g=i.x1-Ix.width()-l,v=a;break;case Qb:g=i.x2+Ix.width()+l,v=a;break;case ex:g=a,v=i.y2+l;break;default:g=o.x,v=o.y}return Fx(o,"x",g)|Fx(o,"y",v)&&(Ix.translate(g,v),e.dirty(o),o.bounds.clear().union(Ix),t.bounds.clear().union(Ix),e.dirty(o)),o.bounds}(e,r,c,l,f)),t.clip&&f.set(0,0,t.width||0,t.height||0),function(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,u=Math.max(0,t.width||0),c=Math.max(0,Math.ceil(-n.x1)),l=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const p=Math.max(0,Math.ceil(n.x2-u)),h=Math.max(0,Math.ceil(n.y2-l));if("padding"===i.contains){const t=e.padding();o-=t.left+t.right,s-=t.top+t.bottom}a===dx?(c=0,f=0,u=o,l=s):"fit"===a?(u=Math.max(0,o-c-p),l=Math.max(0,s-f-h)):"fit-x"===a?(u=Math.max(0,o-c-p),s=l+f+h):"fit-y"===a?(o=u+c+p,l=Math.max(0,s-f-h)):"pad"===a&&(o=u+c+p,s=l+f+h),e._resizeView(o,s,u,l,[c,f],i.resize)}(e,t,f,n)}(n,t,e)})),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}}),ft(tw,ms,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=rm(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),s=e.format||om(n,a,o,e.formatSpecifier,e.formatType,!!e.values),u=e.values?im(a,e.values,o):am(a,o);return i&&(r.rem=i),i=u.map(((e,t)=>Lo({index:t/(u.length-1||1),value:e,label:s(e)}))),e.extra&&i.length&&i.push(Lo({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),ft(nw,ms,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||rw,a=e.key||zo,o=this.value;return Ee(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&oe("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=function(e){const t=ct().test((e=>e.exit));return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,(e=>{const t=a(e);let n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),o.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(e=>{const t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))})),t.visit(t.REM,(e=>{const t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)})),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}}),ft(iw,ms,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(Ee(a)){if(!n.changed()&&!a.every((e=>i[e])))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||de,u=i.enter||de,c=i.exit||de,l=(a&&!o?i[a]:s)||de;if(t.changed(t.ADD)&&(t.visit(t.ADD,(t=>{u(t,e),s(t,e)})),n.modifies(u.output),n.modifies(s.output),l!==de&&l!==s&&(t.visit(t.ADD,(t=>{l(t,e)})),n.modifies(l.output))),t.changed(t.REM)&&c!==de&&(t.visit(t.REM,(t=>{c(t,e)})),n.modifies(c.output)),o||l!==de){const i=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(i,(t=>{const i=u(t,e)||r;(l(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(u.output)):t.visit(i,(t=>{(l(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(l.output)}return n.changed()?n:t.StopPropagation}}),ft(aw,ms,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,o,s=t.dataflow.locale(),u=t.fork(t.NO_SOURCE|t.NO_FIELDS),c=this.value,l=e.type||Qd,f=e.scale,p=+e.limit,h=rm(f,null==e.count?5:e.count,e.minstep),d=!!e.values||l===Qd,m=e.format||fm(s,f,h,l,e.formatSpecifier,e.formatType,d),g=e.values||lm(f,h);return c&&(u.rem=c),l===Qd?(p&&g.length>p?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),c=g.slice(0,p-1),o=!0):c=g,Xe(i=e.size)?(e.values||0!==f(c[0])||(c=c.slice(1)),a=c.reduce(((t,n)=>Math.max(t,i(n,e))),0)):i=tt(a=i||8),c=c.map(((t,n)=>Lo({index:n,label:m(t,n,c),value:t,offset:a,size:i(t,e)}))),o&&(o=g[c.length],c.push(Lo({index:c.length,label:"".concat(g.length-c.length," entries"),value:o,offset:a,size:i(o,e)})))):"gradient"===l?(n=f.domain(),r=Gd(f,n[0],De(n)),g.length<3&&!e.values&&n[0]!==De(n)&&(g=[n[0],De(n)]),c=g.map(((e,t)=>Lo({index:t,label:m(e,t,g),value:e,perc:r(e)})))):(i=g.length-1,r=function(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+De(t),a=i-r;if(e.type===vd){const e=n?a/n:.1;r-=e,i+=e,a=i-r}return e=>(e-r)/a}(f),c=g.map(((e,t)=>Lo({index:t,label:m(e,t,g),value:e,perc:t?r(e):0,perc2:t===i?1:r(g[t+1])})))),u.source=c,u.add=c,this.value=c,u}});const ow=e=>e.source.x,sw=e=>e.source.y,uw=e=>e.target.x,cw=e=>e.target.y;function lw(e){ms.call(this,{},e)}lw.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},ft(lw,ms,{transform(e,t){var n=e.sourceX||ow,r=e.sourceY||sw,i=e.targetX||uw,a=e.targetY||cw,o=e.as||"path",s=e.orient||"vertical",u=e.shape||"line",c=dw.get(u+"-"+s)||dw.get(u);return c||oe("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(e=>{e[o]=c(n(e),r(e),i(e),a(e))})),t.reflow(e.modified()).modifies(o)}});const fw=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,pw=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},hw=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},dw=ct({line:fw,"line-radial":(e,t,n,r)=>fw(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:pw,"arc-radial":(e,t,n,r)=>pw(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:hw,"curve-radial":(e,t,n,r)=>hw(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),u=(t+r)/2;return"M"+t*i+","+t*a+"C"+u*i+","+u*a+" "+u*o+","+u*s+" "+r*o+","+r*s}});function mw(e){ms.call(this,null,e)}function gw(e){return zd(e)&&e!==hd}mw.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},ft(mw,ms,{transform(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],u=e.field||pe,c=e.startAngle||0,l=null!=e.endAngle?e.endAngle:2*Math.PI,f=t.source,p=f.map(u),h=p.length,d=c,m=(l-c)/ew(p),g=wu(h);for(e.sort&&g.sort(((e,t)=>p[e]-p[t])),n=0;n<h;++n)i=p[g[n]],(r=f[g[n]])[o]=d,r[s]=d+=i*m;return this.value=p,t.reflow(e.modified()).modifies(a)}});const vw=Tt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function yw(e){ms.call(this,null,e),this.modified(!0)}function bw(e,t,n){return jd(e)&&Math.abs(t.reduce(((e,t)=>e+(t<0?-1:t>0?1:0)),0))!==t.length&&n.warn("Log scale domain includes zero: "+At(t)),t}function xw(e,t,n){return Xe(e)&&(t||n)?Vd(e,ww(t||[0,1],n)):e}function ww(e,t){return t?e.slice().reverse():e}function Ew(e){ms.call(this,null,e)}ft(yw,ms,{transform(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";return n===hd?"sequential-linear":(function(e){const t=e.type;return zd(t)&&t!==fd&&t!==pd&&(e.scheme||e.range&&e.range.length&&e.range.every(yt))}(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":""),(r+n||od).toLowerCase())}(e);for(i in r&&i===r.type||(this.value=r=Fd(i)()),e)if(!vw[i]){if("padding"===i&&gw(r.type))continue;Xe(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){e!==xd&&e!==bd&&oe("Only band and point scales support rangeStep.");var r=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,i=e===bd?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*ad(n,i,r)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;return Ee(t.scheme)?r=$d(t.scheme,t.interpolate,t.interpolateGamma):(r=Zd(t.scheme.toLowerCase()))||oe("Unrecognized scheme name: ".concat(t.scheme)),n=e===vd?n+1:e===wd?n-1:e===md||e===gd?+t.schemeCount||5:n,Ud(e)?xw(r,i,t.reverse):Xe(r)?Hd(xw(r,i),n):e===yd?r:r.slice(0,n)}(r,t,n),Xe(a))){if(e.interpolator)return e.interpolator(a);oe("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&Ud(r))return e.interpolator($d(ww(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(Kd(t.interpolate,t.interpolateGamma)):Xe(e.round)?e.round(i):Xe(e.rangeRound)&&e.interpolate(i?xp:bp),a&&e.range(ww(a,t.reverse))}(r,e,function(e,t,n){let r=t.bins;if(r&&!Ee(r)){const t=e.domain(),n=t[0],i=De(t),a=r.step;let o=null==r.start?n:r.start,s=null==r.stop?i:r.stop;a||oe("Scale bins parameter missing step property."),o<n&&(o=a*Math.ceil(n/a)),s>i&&(s=a*Math.floor(i/a)),r=wu(o,s+a/2,a)}return r?e.bins=r:e.bins&&delete e.bins,e.type===wd&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain()),n}(r,e,function(e,t,n){const r=function(e,t,n){return t?(e.domain(bw(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,o=t.domain,s=e.type,u=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===od||t===ud||t===cd)}(e);if(!o)return 0;if(gw(s)&&t.padding&&o[0]!==De(o)&&(o=function(e,t,n,r,i,a){var o=Math.abs(De(n)-n[0]),s=o/(o-2*r),u=e===sd?qe(t,null,s):e===cd?We(t,null,s,.5):e===ud?We(t,null,s,i||1):e===ld?Ve(t,null,s,a||1):Ue(t,null,s);return(t=t.slice())[0]=u[0],t[t.length-1]=u[1],t}(s,o,t.range,t.padding,t.exponent,t.constant)),(u||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(o=o.slice()).length-1||1,u&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[i]=t.domainMax),null!=t.domainMid)){const e=(a=t.domainMid)>o[i]?i+1:a<o[0]?0:i;e!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(e,0,a)}return e.domain(bw(s,o,n)),s===yd&&e.unknown(t.domainImplicit?gf:void 0),t.nice&&e.nice&&e.nice(!0!==t.nice&&rm(e,t.nice)||null),o.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),ft(Ew,ms,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Wo(e.sort)),this.modified(n),t}});const Cw="zero",Sw="center",Nw="normalize",Aw=["y0","y1"];function kw(e){ms.call(this,null,e)}function Dw(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,u=0;u<s;++u)(a=e[u])[r]=o,a[i]=o+=Math.abs(n(a))}function _w(e,t,n,r,i){for(var a,o=1/e.sum,s=0,u=e.length,c=0,l=0;c<u;++c)(a=e[c])[r]=s,a[i]=s=o*(l+=Math.abs(n(a)))}function Mw(e,t,n,r,i){for(var a,o,s=0,u=0,c=e.length,l=0;l<c;++l)(a=+n(o=e[l]))<0?(o[r]=u,o[i]=u+=a):(o[r]=s,o[i]=s+=a)}kw.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:Cw,values:[Cw,Sw,Nw]},{name:"as",type:"string",array:!0,length:2,default:Aw}]},ft(kw,ms,{transform(e,t){var n,r,i,a,o=e.as||Aw,s=o[0],u=o[1],c=Wo(e.sort),l=e.field||pe,f=e.offset===Sw?Dw:e.offset===Nw?_w:Mw;for(n=function(e,t,n,r){var i,a,o,s,u,c,l,f,p,h=[],d=e=>e(u);if(null==t)h.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)u=e[a],(l=i[c=t.map(d)])||(i[c]=l=[],h.push(l)),l.push(u);for(c=0,p=0,s=h.length;c<s;++c){for(a=0,f=0,o=(l=h[c]).length;a<o;++a)f+=Math.abs(r(l[a]));l.sum=f,f>p&&(p=f),n&&l.sort(n)}return h.max=p,h}(t.source,e.groupby,c,l),r=0,i=n.length,a=n.max;r<i;++r)f(n[r],a,l,s,u);return t.reflow(e.modified()).modifies(o)}});const Tw=e=>e;function Ow(e,t){e&&Fw.hasOwnProperty(e.type)&&Fw[e.type](e,t)}var Iw={Feature:function(e,t){Ow(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Ow(n[r].geometry,t)}},Fw={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Rw(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Rw(n[r],t,0)},Polygon:function(e,t){Bw(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Bw(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Ow(n[r],t)}};function Rw(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function Bw(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Rw(e[n],t,1);t.polygonEnd()}function zw(e,t){e&&Iw.hasOwnProperty(e.type)?Iw[e.type](e,t):Ow(e,t)}class Pw{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}var Lw=1e-6,jw=1e-12,Uw=Math.PI,qw=Uw/2,Ww=Uw/4,Vw=2*Uw,$w=180/Uw,Hw=Uw/180,Gw=Math.abs,Kw=Math.atan,Xw=Math.atan2,Yw=Math.cos,Jw=Math.ceil,Zw=Math.exp,Qw=(Math.floor,Math.hypot),eE=Math.log,tE=Math.pow,nE=Math.sin,rE=Math.sign||function(e){return e>0?1:e<0?-1:0},iE=Math.sqrt,aE=Math.tan;function oE(e){return e>1?0:e<-1?Uw:Math.acos(e)}function sE(e){return e>1?qw:e<-1?-qw:Math.asin(e)}function uE(){}var cE,lE,fE,pE,hE=new Pw,dE=new Pw,mE={point:uE,lineStart:uE,lineEnd:uE,polygonStart:function(){mE.lineStart=gE,mE.lineEnd=bE},polygonEnd:function(){mE.lineStart=mE.lineEnd=mE.point=uE,hE.add(Gw(dE)),dE=new Pw},result:function(){var e=hE/2;return hE=new Pw,e}};function gE(){mE.point=vE}function vE(e,t){mE.point=yE,cE=fE=e,lE=pE=t}function yE(e,t){dE.add(pE*e-fE*t),fE=e,pE=t}function bE(){yE(cE,lE)}const xE=mE;var wE=1/0,EE=wE,CE=-wE,SE=CE,NE={point:function(e,t){e<wE&&(wE=e),e>CE&&(CE=e),t<EE&&(EE=t),t>SE&&(SE=t)},lineStart:uE,lineEnd:uE,polygonStart:uE,polygonEnd:uE,result:function(){var e=[[wE,EE],[CE,SE]];return CE=SE=-(EE=wE=1/0),e}};const AE=NE;var kE,DE,_E,ME,TE=0,OE=0,IE=0,FE=0,RE=0,BE=0,zE=0,PE=0,LE=0,jE={point:UE,lineStart:qE,lineEnd:$E,polygonStart:function(){jE.lineStart=HE,jE.lineEnd=GE},polygonEnd:function(){jE.point=UE,jE.lineStart=qE,jE.lineEnd=$E},result:function(){var e=LE?[zE/LE,PE/LE]:BE?[FE/BE,RE/BE]:IE?[TE/IE,OE/IE]:[NaN,NaN];return TE=OE=IE=FE=RE=BE=zE=PE=LE=0,e}};function UE(e,t){TE+=e,OE+=t,++IE}function qE(){jE.point=WE}function WE(e,t){jE.point=VE,UE(_E=e,ME=t)}function VE(e,t){var n=e-_E,r=t-ME,i=iE(n*n+r*r);FE+=i*(_E+e)/2,RE+=i*(ME+t)/2,BE+=i,UE(_E=e,ME=t)}function $E(){jE.point=UE}function HE(){jE.point=KE}function GE(){XE(kE,DE)}function KE(e,t){jE.point=XE,UE(kE=_E=e,DE=ME=t)}function XE(e,t){var n=e-_E,r=t-ME,i=iE(n*n+r*r);FE+=i*(_E+e)/2,RE+=i*(ME+t)/2,BE+=i,zE+=(i=ME*e-_E*t)*(_E+e),PE+=i*(ME+t),LE+=3*i,UE(_E=e,ME=t)}const YE=jE;function JE(e){this._context=e}JE.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Vw)}},result:uE};var ZE,QE,eC,tC,nC,rC=new Pw,iC={point:uE,lineStart:function(){iC.point=aC},lineEnd:function(){ZE&&oC(QE,eC),iC.point=uE},polygonStart:function(){ZE=!0},polygonEnd:function(){ZE=null},result:function(){var e=+rC;return rC=new Pw,e}};function aC(e,t){iC.point=oC,QE=tC=e,eC=nC=t}function oC(e,t){tC-=e,nC-=t,rC.add(iE(tC*tC+nC*nC)),tC=e,nC=t}const sC=iC;function uC(){this._string=[]}function cC(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function lC(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),zw(e,n(r))),r.result()}return a.area=function(e){return zw(e,n(xE)),xE.result()},a.measure=function(e){return zw(e,n(sC)),sC.result()},a.bounds=function(e){return zw(e,n(AE)),AE.result()},a.centroid=function(e){return zw(e,n(YE)),YE.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,Tw):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new uC):new JE(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)}function fC(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:uE,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function pC(e,t){return Gw(e[0]-t[0])<Lw&&Gw(e[1]-t[1])<Lw}function hC(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function dC(e,t,n,r,i){var a,o,s=[],u=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(pC(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new hC(r,e,null,!0)),u.push(n.o=new hC(r,null,n,!1)),s.push(n=new hC(o,e,null,!1)),u.push(n.o=new hC(o,null,n,!0))}})),s.length){for(u.sort(t),mC(s),mC(u),a=0,o=u.length;a<o;++a)u[a].e=n=!n;for(var c,l,f=s[0];;){for(var p=f,h=!0;p.v;)if((p=p.n)===f)return;c=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(a=0,o=c.length;a<o;++a)i.point((l=c[a])[0],l[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(h)for(c=p.p.z,a=c.length-1;a>=0;--a)i.point((l=c[a])[0],l[1]);else r(p.x,p.p.x,-1,i);p=p.p}c=(p=p.o).z,h=!h}while(!p.v);i.lineEnd()}}}function mC(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function gC(e){return[Xw(e[1],e[0]),sE(e[2])]}function vC(e){var t=e[0],n=e[1],r=Yw(n);return[r*Yw(t),r*nE(t),nE(n)]}function yC(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function bC(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function xC(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function wC(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function EC(e){var t=iE(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function CC(e){return Gw(e[0])<=Uw?e[0]:rE(e[0])*((Gw(e[0])+Uw)%Vw-Uw)}function SC(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function NC(e,t,n,r){return function(i){var a,o,s,u=t(i),c=fC(),l=t(c),f=!1,p={point:h,lineStart:m,lineEnd:g,polygonStart:function(){p.point=v,p.lineStart=y,p.lineEnd=b,o=[],a=[]},polygonEnd:function(){p.point=h,p.lineStart=m,p.lineEnd=g,o=SC(o);var e=function(e,t){var n=CC(t),r=t[1],i=nE(r),a=[nE(n),-Yw(n),0],o=0,s=0,u=new Pw;1===i?r=qw+Lw:-1===i&&(r=-qw-Lw);for(var c=0,l=e.length;c<l;++c)if(p=(f=e[c]).length)for(var f,p,h=f[p-1],d=CC(h),m=h[1]/2+Ww,g=nE(m),v=Yw(m),y=0;y<p;++y,d=x,g=E,v=C,h=b){var b=f[y],x=CC(b),w=b[1]/2+Ww,E=nE(w),C=Yw(w),S=x-d,N=S>=0?1:-1,A=N*S,k=A>Uw,D=g*E;if(u.add(Xw(D*N*nE(A),v*C+D*Yw(A))),o+=k?S+N*Vw:S,k^d>=n^x>=n){var _=bC(vC(h),vC(b));EC(_);var M=bC(a,_);EC(M);var T=(k^S>=0?-1:1)*sE(M[2]);(r>T||r===T&&(_[0]||_[1]))&&(s+=k^S>=0?1:-1)}}return(o<-1e-6||o<Lw&&u<-1e-12)^1&s}(a,r);o.length?(f||(i.polygonStart(),f=!0),dC(o,kC,e,n,i)):e&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(t,n){e(t,n)&&i.point(t,n)}function d(e,t){u.point(e,t)}function m(){p.point=d,u.lineStart()}function g(){p.point=h,u.lineEnd()}function v(e,t){s.push([e,t]),l.point(e,t)}function y(){l.lineStart(),s=[]}function b(){v(s[0][0],s[0][1]),l.lineEnd();var e,t,n,r,u=l.clean(),p=c.result(),h=p.length;if(s.pop(),a.push(s),s=null,h)if(1&u){if((t=(n=p[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else h>1&&2&u&&p.push(p.pop().concat(p.shift())),o.push(p.filter(AC))}return p}}function AC(e){return e.length>1}function kC(e,t){return((e=e.x)[0]<0?e[1]-qw-Lw:qw-e[1])-((t=t.x)[0]<0?t[1]-qw-Lw:qw-t[1])}uC.prototype={_radius:4.5,_circle:cC(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=cC(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};const DC=NC((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?Uw:-Uw,u=Gw(a-n);Gw(u-Uw)<Lw?(e.point(n,r=(r+o)/2>0?qw:-qw),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&u>=Uw&&(Gw(n-i)<Lw&&(n-=i*Lw),Gw(a-s)<Lw&&(a-=s*Lw),r=function(e,t,n,r){var i,a,o=nE(e-n);return Gw(o)>Lw?Kw((nE(t)*(a=Yw(r))*nE(n)-nE(r)*(i=Yw(t))*nE(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*qw,r.point(-Uw,i),r.point(0,i),r.point(Uw,i),r.point(Uw,0),r.point(Uw,-i),r.point(0,-i),r.point(-Uw,-i),r.point(-Uw,0),r.point(-Uw,i);else if(Gw(e[0]-t[0])>Lw){var a=e[0]<t[0]?Uw:-Uw;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-Uw,-qw]);function _C(e,t){(t=vC(t))[0]-=e,EC(t);var n=oE(-t[1]);return((-t[2]<0?-n:n)+Vw-Lw)%Vw}function MC(e){var t=Yw(e),n=6*Hw,r=t>0,i=Gw(t)>Lw;function a(e,n){return Yw(e)*Yw(n)>t}function o(e,n,r){var i=[1,0,0],a=bC(vC(e),vC(n)),o=yC(a,a),s=a[0],u=o-s*s;if(!u)return!r&&e;var c=t*o/u,l=-t*s/u,f=bC(i,a),p=wC(i,c);xC(p,wC(a,l));var h=f,d=yC(p,h),m=yC(h,h),g=d*d-m*(yC(p,p)-1);if(!(g<0)){var v=iE(g),y=wC(h,(-d-v)/m);if(xC(y,p),y=gC(y),!r)return y;var b,x=e[0],w=n[0],E=e[1],C=n[1];w<x&&(b=x,x=w,w=b);var S=w-x,N=Gw(S-Uw)<Lw;if(!N&&C<E&&(b=E,E=C,C=b),N||S<Lw?N?E+C>0^y[1]<(Gw(y[0]-x)<Lw?E:C):E<=y[1]&&y[1]<=C:S>Uw^(x<=y[0]&&y[0]<=w)){var A=wC(h,(-d+v)/m);return xC(A,p),[y,gC(A)]}}}function s(t,n){var i=r?e:Uw-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return NC(a,(function(e){var t,n,u,c,l;return{lineStart:function(){c=u=!1,l=1},point:function(f,p){var h,d=[f,p],m=a(f,p),g=r?m?0:s(f,p):m?s(f+(f<0?Uw:-Uw),p):0;if(!t&&(c=u=m)&&e.lineStart(),m!==u&&(!(h=o(t,d))||pC(t,h)||pC(d,h))&&(d[2]=1),m!==u)l=0,m?(e.lineStart(),h=o(d,t),e.point(h[0],h[1])):(h=o(t,d),e.point(h[0],h[1],2),e.lineEnd()),t=h;else if(i&&t&&r^m){var v;g&n||!(v=o(d,t,!0))||(l=0,r?(e.lineStart(),e.point(v[0][0],v[0][1]),e.point(v[1][0],v[1][1]),e.lineEnd()):(e.point(v[1][0],v[1][1]),e.lineEnd(),e.lineStart(),e.point(v[0][0],v[0][1],3)))}!m||t&&pC(t,d)||e.point(d[0],d[1]),t=d,u=m,n=g},lineEnd:function(){u&&e.lineEnd(),t=null},clean:function(){return l|(c&&u)<<1}}}),(function(t,r,i,a){!function(e,t,n,r,i,a){if(n){var o=Yw(t),s=nE(t),u=r*n;null==i?(i=t+r*Vw,a=t-u/2):(i=_C(o,i),a=_C(o,a),(r>0?i<a:i>a)&&(i+=r*Vw));for(var c,l=i;r>0?l>a:l<a;l-=u)c=gC([o,-s*Yw(l),-s*nE(l)]),e.point(c[0],c[1])}}(a,e,n,i,t,r)}),r?[0,-e]:[-Uw,e-Uw])}var TC=1e9,OC=-TC;function IC(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,c){var l=0,f=0;if(null==i||(l=o(i,s))!==(f=o(a,s))||u(i,a)<0^s>0)do{c.point(0===l||3===l?e:n,l>1?r:t)}while((l=(l+s+4)%4)!==f);else c.point(a[0],a[1])}function o(r,i){return Gw(r[0]-e)<Lw?i>0?0:3:Gw(r[0]-n)<Lw?i>0?2:1:Gw(r[1]-t)<Lw?i>0?1:0:i>0?3:2}function s(e,t){return u(e.x,t.x)}function u(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var u,c,l,f,p,h,d,m,g,v,y,b=o,x=fC(),w={point:E,lineStart:function(){w.point=C,c&&c.push(l=[]),v=!0,g=!1,d=m=NaN},lineEnd:function(){u&&(C(f,p),h&&g&&x.rejoin(),u.push(x.result())),w.point=E,g&&b.lineEnd()},polygonStart:function(){b=x,u=[],c=[],y=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=c.length;n<i;++n)for(var a,o,s=c[n],u=1,l=s.length,f=s[0],p=f[0],h=f[1];u<l;++u)a=p,o=h,p=(f=s[u])[0],h=f[1],o<=r?h>r&&(p-a)*(r-o)>(h-o)*(e-a)&&++t:h<=r&&(p-a)*(r-o)<(h-o)*(e-a)&&--t;return t}(),n=y&&t,i=(u=SC(u)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&dC(u,s,t,a,o),o.polygonEnd()),b=o,u=c=l=null}};function E(e,t){i(e,t)&&b.point(e,t)}function C(a,o){var s=i(a,o);if(c&&l.push([a,o]),v)f=a,p=o,h=s,v=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&g)b.point(a,o);else{var u=[d=Math.max(OC,Math.min(TC,d)),m=Math.max(OC,Math.min(TC,m))],x=[a=Math.max(OC,Math.min(TC,a)),o=Math.max(OC,Math.min(TC,o))];!function(e,t,n,r,i,a){var o,s=e[0],u=e[1],c=0,l=1,f=t[0]-s,p=t[1]-u;if(o=n-s,f||!(o>0)){if(o/=f,f<0){if(o<c)return;o<l&&(l=o)}else if(f>0){if(o>l)return;o>c&&(c=o)}if(o=i-s,f||!(o<0)){if(o/=f,f<0){if(o>l)return;o>c&&(c=o)}else if(f>0){if(o<c)return;o<l&&(l=o)}if(o=r-u,p||!(o>0)){if(o/=p,p<0){if(o<c)return;o<l&&(l=o)}else if(p>0){if(o>l)return;o>c&&(c=o)}if(o=a-u,p||!(o<0)){if(o/=p,p<0){if(o>l)return;o>c&&(c=o)}else if(p>0){if(o<c)return;o<l&&(l=o)}return c>0&&(e[0]=s+c*f,e[1]=u+c*p),l<1&&(t[0]=s+l*f,t[1]=u+l*p),!0}}}}}(u,x,e,t,n,r)?s&&(b.lineStart(),b.point(a,o),y=!1):(g||(b.lineStart(),b.point(u[0],u[1])),b.point(x[0],x[1]),s||b.lineEnd(),y=!1)}d=a,m=o,g=s}return w}}function FC(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function RC(e,t){return[Gw(e)>Uw?e+Math.round(-e/Vw)*Vw:e,t]}function BC(e,t,n){return(e%=Vw)?t||n?FC(PC(e),LC(t,n)):PC(e):t||n?LC(t,n):RC}function zC(e){return function(t,n){return[(t+=e)>Uw?t-Vw:t<-Uw?t+Vw:t,n]}}function PC(e){var t=zC(e);return t.invert=zC(-e),t}function LC(e,t){var n=Yw(e),r=nE(e),i=Yw(t),a=nE(t);function o(e,t){var o=Yw(t),s=Yw(e)*o,u=nE(e)*o,c=nE(t),l=c*n+s*r;return[Xw(u*i-l*a,s*n-c*r),sE(l*i+u*a)]}return o.invert=function(e,t){var o=Yw(t),s=Yw(e)*o,u=nE(e)*o,c=nE(t),l=c*i-u*a;return[Xw(u*i+c*a,s*n+l*r),sE(l*n-s*r)]},o}function jC(e){return function(t){var n=new UC;for(var r in e)n[r]=e[r];return n.stream=t,n}}function UC(){}function qC(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),zw(n,e.stream(AE)),t(AE.result()),null!=r&&e.clipExtent(r),e}function WC(e,t,n){return qC(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function VC(e,t,n){return WC(e,[[0,0],t],n)}function $C(e,t,n){return qC(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function HC(e,t,n){return qC(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}RC.invert=RC,UC.prototype={constructor:UC,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var GC=Yw(30*Hw);function KC(e,t){return+t?function(e,t){function n(r,i,a,o,s,u,c,l,f,p,h,d,m,g){var v=c-r,y=l-i,b=v*v+y*y;if(b>4*t&&m--){var x=o+p,w=s+h,E=u+d,C=iE(x*x+w*w+E*E),S=sE(E/=C),N=Gw(Gw(E)-1)<Lw||Gw(a-f)<Lw?(a+f)/2:Xw(w,x),A=e(N,S),k=A[0],D=A[1],_=k-r,M=D-i,T=y*_-v*M;(T*T/b>t||Gw((v*_+y*M)/b-.5)>.3||o*p+s*h+u*d<GC)&&(n(r,i,a,o,s,u,k,D,N,x/=C,w/=C,E,m,g),g.point(k,D),n(k,D,N,x,w,E,c,l,f,p,h,d,m,g))}}return function(t){var r,i,a,o,s,u,c,l,f,p,h,d,m={point:g,lineStart:v,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=v}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function v(){l=NaN,m.point=y,t.lineStart()}function y(r,i){var a=vC([r,i]),o=e(r,i);n(l,f,c,p,h,d,l=o[0],f=o[1],c=r,p=a[0],h=a[1],d=a[2],16,t),t.point(l,f)}function b(){m.point=g,t.lineEnd()}function x(){v(),m.point=w,m.lineEnd=E}function w(e,t){y(r=e,t),i=l,a=f,o=p,s=h,u=d,m.point=y}function E(){n(l,f,c,p,h,d,i,a,r,o,s,u,16,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return jC({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var XC=jC({point:function(e,t){this.stream.point(e*Hw,t*Hw)}});function YC(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=Yw(a),s=nE(a),u=o*e,c=s*e,l=o/e,f=s/e,p=(s*n-o*t)/e,h=(s*t+o*n)/e;function d(e,a){return[u*(e*=r)-c*(a*=i)+t,n-c*e-u*a]}return d.invert=function(e,t){return[r*(l*e-f*t+p),i*(h-f*e-l*t)]},d}function JC(e){return ZC((function(){return e}))()}function ZC(e){var t,n,r,i,a,o,s,u,c,l,f=150,p=480,h=250,d=0,m=0,g=0,v=0,y=0,b=0,x=1,w=1,E=null,C=DC,S=null,N=Tw,A=.5;function k(e){return u(e[0]*Hw,e[1]*Hw)}function D(e){return(e=u.invert(e[0],e[1]))&&[e[0]*$w,e[1]*$w]}function _(){var e=YC(f,0,0,x,w,b).apply(null,t(d,m)),r=YC(f,p-e[0],h-e[1],x,w,b);return n=BC(g,v,y),s=FC(t,r),u=FC(n,s),o=KC(s,A),M()}function M(){return c=l=null,k}return k.stream=function(e){return c&&l===e?c:c=XC(function(e){return jC({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(C(o(N(l=e)))))},k.preclip=function(e){return arguments.length?(C=e,E=void 0,M()):C},k.postclip=function(e){return arguments.length?(N=e,S=r=i=a=null,M()):N},k.clipAngle=function(e){return arguments.length?(C=+e?MC(E=e*Hw):(E=null,DC),M()):E*$w},k.clipExtent=function(e){return arguments.length?(N=null==e?(S=r=i=a=null,Tw):IC(S=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),M()):null==S?null:[[S,r],[i,a]]},k.scale=function(e){return arguments.length?(f=+e,_()):f},k.translate=function(e){return arguments.length?(p=+e[0],h=+e[1],_()):[p,h]},k.center=function(e){return arguments.length?(d=e[0]%360*Hw,m=e[1]%360*Hw,_()):[d*$w,m*$w]},k.rotate=function(e){return arguments.length?(g=e[0]%360*Hw,v=e[1]%360*Hw,y=e.length>2?e[2]%360*Hw:0,_()):[g*$w,v*$w,y*$w]},k.angle=function(e){return arguments.length?(b=e%360*Hw,_()):b*$w},k.reflectX=function(e){return arguments.length?(x=e?-1:1,_()):x<0},k.reflectY=function(e){return arguments.length?(w=e?-1:1,_()):w<0},k.precision=function(e){return arguments.length?(o=KC(s,A=e*e),M()):iE(A)},k.fitExtent=function(e,t){return WC(k,e,t)},k.fitSize=function(e,t){return VC(k,e,t)},k.fitWidth=function(e,t){return $C(k,e,t)},k.fitHeight=function(e,t){return HC(k,e,t)},function(){return t=e.apply(this,arguments),k.invert=t.invert&&D,_()}}function QC(e){var t=0,n=Uw/3,r=ZC(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*Hw,n=e[1]*Hw):[t*$w,n*$w]},i}function eS(e,t){var n=nE(e),r=(n+nE(t))/2;if(Gw(r)<Lw)return function(e){var t=Yw(e);function n(e,n){return[e*t,nE(n)/t]}return n.invert=function(e,n){return[e/t,sE(n*t)]},n}(e);var i=1+n*(2*r-n),a=iE(i)/r;function o(e,t){var n=iE(i-2*r*nE(t))/r;return[n*nE(e*=r),a-n*Yw(e)]}return o.invert=function(e,t){var n=a-t,o=Xw(e,Gw(n))*rE(n);return n*r<0&&(o-=Uw*rE(e)*rE(n)),[o/r,sE((i-(e*e+n*n)*r*r)/(2*r))]},o}function tS(){return QC(eS).scale(155.424).center([0,33.6442])}function nS(){return tS().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function rS(e){return function(t,n){var r=Yw(t),i=Yw(n),a=e(r*i);return a===1/0?[2,0]:[a*i*nE(t),a*nE(n)]}}function iS(e){return function(t,n){var r=iE(t*t+n*n),i=e(r),a=nE(i),o=Yw(i);return[Xw(t*a,r*o),sE(r&&n*a/r)]}}var aS=rS((function(e){return iE(2/(1+e))}));aS.invert=iS((function(e){return 2*sE(e/2)}));var oS=rS((function(e){return(e=oE(e))&&e/nE(e)}));function sS(e,t){return[e,eE(aE((qw+t)/2))]}function uS(e){var t,n,r,i=JC(e),a=i.center,o=i.scale,s=i.translate,u=i.clipExtent,c=null;function l(){var a=Uw*o(),s=i(function(e){function t(t){return(t=e(t[0]*Hw,t[1]*Hw))[0]*=$w,t[1]*=$w,t}return e=BC(e[0]*Hw,e[1]*Hw,e.length>2?e[2]*Hw:0),t.invert=function(t){return(t=e.invert(t[0]*Hw,t[1]*Hw))[0]*=$w,t[1]*=$w,t},t}(i.rotate()).invert([0,0]));return u(null==c?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:e===sS?[[Math.max(s[0]-a,c),t],[Math.min(s[0]+a,n),r]]:[[c,Math.max(s[1]-a,t)],[n,Math.min(s[1]+a,r)]])}return i.scale=function(e){return arguments.length?(o(e),l()):o()},i.translate=function(e){return arguments.length?(s(e),l()):s()},i.center=function(e){return arguments.length?(a(e),l()):a()},i.clipExtent=function(e){return arguments.length?(null==e?c=t=n=r=null:(c=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),l()):null==c?null:[[c,t],[n,r]]},l()}function cS(e){return aE((qw+e)/2)}function lS(e,t){var n=Yw(e),r=e===t?nE(e):eE(n/Yw(t))/eE(cS(t)/cS(e)),i=n*tE(cS(e),r)/r;if(!r)return sS;function a(e,t){i>0?t<-qw+Lw&&(t=-qw+Lw):t>qw-Lw&&(t=qw-Lw);var n=i/tE(cS(t),r);return[n*nE(r*e),i-n*Yw(r*e)]}return a.invert=function(e,t){var n=i-t,a=rE(r)*iE(e*e+n*n),o=Xw(e,Gw(n))*rE(n);return n*r<0&&(o-=Uw*rE(e)*rE(n)),[o/r,2*Kw(tE(i/a,1/r))-qw]},a}function fS(e,t){return[e,t]}function pS(e,t){var n=Yw(e),r=e===t?nE(e):(n-Yw(t))/(t-e),i=n/r+e;if(Gw(r)<Lw)return fS;function a(e,t){var n=i-t,a=r*e;return[n*nE(a),i-n*Yw(a)]}return a.invert=function(e,t){var n=i-t,a=Xw(e,Gw(n))*rE(n);return n*r<0&&(a-=Uw*rE(e)*rE(n)),[a/r,i-rE(r)*iE(e*e+n*n)]},a}oS.invert=iS((function(e){return e})),sS.invert=function(e,t){return[e,2*Kw(Zw(t))-qw]},fS.invert=fS;var hS=1.340264,dS=-.081106,mS=893e-6,gS=.003796,vS=iE(3)/2;function yS(e,t){var n=sE(vS*nE(t)),r=n*n,i=r*r*r;return[e*Yw(n)/(vS*(hS+3*dS*r+i*(7*mS+9*gS*r))),n*(hS+dS*r+i*(mS+gS*r))]}function bS(e,t){var n=Yw(t),r=Yw(e)*n;return[n*nE(e)/r,nE(t)/r]}function xS(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function wS(e,t){return[Yw(t)*nE(e),nE(t)]}function ES(e,t){var n=Yw(t),r=1+Yw(e)*n;return[n*nE(e)/r,nE(t)/r]}function CS(e,t){return[eE(aE((qw+t)/2)),-e]}yS.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(hS+dS*i+a*(mS+gS*i))-t)/(hS+3*dS*i+a*(7*mS+9*gS*i)))*r)*i*i,!(Gw(n)<jw));++o);return[vS*e*(hS+3*dS*i+a*(7*mS+9*gS*i))/Yw(r),sE(nE(r)/vS)]},bS.invert=iS(Kw),xS.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(Gw(n)>Lw&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},wS.invert=iS(sE),ES.invert=iS((function(e){return 2*Kw(e)})),CS.invert=function(e,t){return[-t,2*Kw(Zw(e))-qw]};var SS=Math.abs,NS=(Math.atan,Math.atan2,Math.ceil,Math.cos),AS=(Math.exp,Math.floor,Math.log,Math.max,Math.min,Math.pow,Math.round,Math.sign,Math.sin),kS=(Math.tan,Math.PI),DS=kS/2,_S=(Math.SQRT1_2,TS(2));function MS(e){return e>1?DS:e<-1?-DS:Math.asin(e)}function TS(e){return e>0?Math.sqrt(e):0}function OS(e,t){var n,r=e*AS(t),i=30;do{t-=n=(t+AS(t)-r)/(1+NS(t))}while(SS(n)>1e-6&&--i>0);return t/2}TS(kS);var IS=function(e,t,n){function r(r,i){return[e*r*NS(i=OS(n,i)),t*AS(i)]}return r.invert=function(r,i){return i=MS(i/t),[r/(e*NS(i)),MS((2*i+AS(2*i))/n)]},r}(_S/DS,_S,kS);const FS=lC(),RS=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function BS(e,t){return function n(){const r=t();return r.type=e,r.path=lC().projection(r),r.copy=r.copy||function(){const e=n();return RS.forEach((t=>{r[t]&&e[t](r[t]())})),e.path.pointRadius(r.path.pointRadius()),e},r}}function zS(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(LS[e]=BS(e,t),this):LS[e]||null}function PS(e){return e&&e.path||FS}const LS={albers:nS,albersusa:function(){var e,t,n,r,i,a,o=nS(),s=tS().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=tS().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(e,t){a=[e,t]}};function l(e){var t=e[0],o=e[1];return a=null,n.point(t,o),a||(r.point(t,o),a)||(i.point(t,o),a)}function f(){return e=t=null,l}return l.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?u:o).invert(e)},l.stream=function(n){return e&&t===n?e:(r=[o.stream(t=n),s.stream(n),u.stream(n)],i=r.length,e={point:function(e,t){for(var n=-1;++n<i;)r[n].point(e,t)},sphere:function(){for(var e=-1;++e<i;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<i;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<i;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<i;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<i;)r[e].polygonEnd()}});var r,i},l.precision=function(e){return arguments.length?(o.precision(e),s.precision(e),u.precision(e),f()):o.precision()},l.scale=function(e){return arguments.length?(o.scale(e),s.scale(.35*e),u.scale(e),l.translate(o.translate())):o.scale()},l.translate=function(e){if(!arguments.length)return o.translate();var t=o.scale(),a=+e[0],l=+e[1];return n=o.translate(e).clipExtent([[a-.455*t,l-.238*t],[a+.455*t,l+.238*t]]).stream(c),r=s.translate([a-.307*t,l+.201*t]).clipExtent([[a-.425*t+Lw,l+.12*t+Lw],[a-.214*t-Lw,l+.234*t-Lw]]).stream(c),i=u.translate([a-.205*t,l+.212*t]).clipExtent([[a-.214*t+Lw,l+.166*t+Lw],[a-.115*t-Lw,l+.234*t-Lw]]).stream(c),f()},l.fitExtent=function(e,t){return WC(l,e,t)},l.fitSize=function(e,t){return VC(l,e,t)},l.fitWidth=function(e,t){return $C(l,e,t)},l.fitHeight=function(e,t){return HC(l,e,t)},l.scale(1070)},azimuthalequalarea:function(){return JC(aS).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return JC(oS).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return QC(lS).scale(109.5).parallels([30,30])},conicequalarea:tS,conicequidistant:function(){return QC(pS).scale(131.154).center([0,13.9389])},equalEarth:function(){return JC(yS).scale(177.158)},equirectangular:function(){return JC(fS).scale(152.63)},gnomonic:function(){return JC(bS).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,o,s=1,u=0,c=0,l=1,f=1,p=0,h=null,d=1,m=1,g=jC({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),v=Tw;function y(){return d=s*l,m=s*f,a=o=null,b}function b(n){var r=n[0]*d,i=n[1]*m;if(p){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+u,i+c]}return b.invert=function(n){var r=n[0]-u,i=n[1]-c;if(p){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/d,i/m]},b.stream=function(e){return a&&o===e?a:a=g(v(o=e))},b.postclip=function(e){return arguments.length?(v=e,h=n=r=i=null,y()):v},b.clipExtent=function(e){return arguments.length?(v=null==e?(h=n=r=i=null,Tw):IC(h=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),y()):null==h?null:[[h,n],[r,i]]},b.scale=function(e){return arguments.length?(s=+e,y()):s},b.translate=function(e){return arguments.length?(u=+e[0],c=+e[1],y()):[u,c]},b.angle=function(n){return arguments.length?(t=nE(p=n%360*Hw),e=Yw(p),y()):p*$w},b.reflectX=function(e){return arguments.length?(l=e?-1:1,y()):l<0},b.reflectY=function(e){return arguments.length?(f=e?-1:1,y()):f<0},b.fitExtent=function(e,t){return WC(b,e,t)},b.fitSize=function(e,t){return VC(b,e,t)},b.fitWidth=function(e,t){return $C(b,e,t)},b.fitHeight=function(e,t){return HC(b,e,t)},b},mercator:function(){return uS(sS).scale(961/Vw)},mollweide:function(){return JC(IS).scale(169.529)},naturalEarth1:function(){return JC(xS).scale(175.295)},orthographic:function(){return JC(wS).scale(249.5).clipAngle(90.000001)},stereographic:function(){return JC(ES).scale(250).clipAngle(142)},transversemercator:function(){var e=uS(CS),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in LS)zS(e,LS[e]);function jS(e,t,n){var r=wu(e,t-Lw,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function US(e,t,n){var r=wu(e,t-Lw,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}function qS(){}const WS=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function VS(){var e=1,t=1,n=o;function r(e,t){return t.map((t=>i(e,t)))}function i(r,i){var o=[],s=[];return function(n,r,i){var o,s,u,c,l,f,p=new Array,h=new Array;for(o=s=-1,c=n[0]>=r,WS[c<<1].forEach(d);++o<e-1;)u=c,c=n[o+1]>=r,WS[u|c<<1].forEach(d);for(WS[c<<0].forEach(d);++s<t-1;){for(o=-1,c=n[s*e+e]>=r,l=n[s*e]>=r,WS[c<<1|l<<2].forEach(d);++o<e-1;)u=c,c=n[s*e+e+o+1]>=r,f=l,l=n[s*e+o+1]>=r,WS[u|c<<1|l<<2|f<<3].forEach(d);WS[c|l<<3].forEach(d)}for(o=-1,l=n[s*e]>=r,WS[l<<2].forEach(d);++o<e-1;)f=l,l=n[s*e+o+1]>=r,WS[l<<2|f<<3].forEach(d);function d(e){var t,n,r=[e[0][0]+o,e[0][1]+s],u=[e[1][0]+o,e[1][1]+s],c=a(r),l=a(u);(t=h[c])?(n=p[l])?(delete h[t.end],delete p[n.start],t===n?(t.ring.push(u),i(t.ring)):p[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(u),h[t.end=l]=t):(t=p[l])?(n=h[c])?(delete p[t.start],delete h[n.end],t===n?(t.ring.push(u),i(t.ring)):p[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete p[t.start],t.ring.unshift(r),p[t.start=c]=t):p[c]=h[l]={start:c,end:l,ring:[r,u]}}WS[l<<3].forEach(d)}(r,i,(e=>{n(e,r,i),function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)})),s.forEach((e=>{for(var t,n=0,r=o.length;n<r;++n)if(-1!==$S((t=o[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,r,i){n.forEach((n=>{var a,o=n[0],s=n[1],u=0|o,c=0|s,l=r[c*e+u];o>0&&o<e&&u===o&&(a=r[c*e+u-1],n[0]=o+(i-a)/(l-a)-.5),s>0&&s<t&&c===s&&(a=r[(c-1)*e+u],n[1]=s+(i-a)/(l-a)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||oe("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?o:qS,r):n===o},r}function $S(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=HS(e,t[r]))return n;return 0}function HS(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var u=e[a],c=u[0],l=u[1],f=e[s],p=f[0],h=f[1];if(GS(u,f,t))return 0;l>r!=h>r&&n<(p-c)*(r-l)/(h-l)+c&&(i=-i)}return i}function GS(e,t,n){var r,i,a,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],a=n[r],o=t[r],i<=a&&a<=o||o<=a&&a<=i)}function KS(e,t,n){return function(r){var i=it(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,u=t?Qt(a,o,e):s/(e+1);return wu(a+u,o,u)}}function XS(e){ms.call(this,null,e)}function YS(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function u(e){e.forEach(c)}function c(e){s&&e.reverse(),e.forEach(l)}function l(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(u),e}}function JS(e,t,n){const r=e>=0?e:Ms(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function ZS(e){return Xe(e)?e:tt(+e)}function QS(){var e=e=>e[0],t=e=>e[1],n=pe,r=[-1,-1],i=960,a=500,o=2;function s(s,u){const c=JS(r[0],s,e)>>o,l=JS(r[1],s,t)>>o,f=c?c+2:0,p=l?l+2:0,h=2*f+(i>>o),d=2*p+(a>>o),m=new Float32Array(h*d),g=new Float32Array(h*d);let v=m;s.forEach((r=>{const i=f+(+e(r)>>o),a=p+(+t(r)>>o);i>=0&&i<h&&a>=0&&a<d&&(m[i+a*h]+=+n(r))})),c>0&&l>0?(eN(h,d,m,g,c),tN(h,d,g,m,l),eN(h,d,m,g,c),tN(h,d,g,m,l),eN(h,d,m,g,c),tN(h,d,g,m,l)):c>0?(eN(h,d,m,g,c),eN(h,d,g,m,c),eN(h,d,m,g,c),v=g):l>0&&(tN(h,d,m,g,l),tN(h,d,g,m,l),tN(h,d,m,g,l),v=g);const y=u?Math.pow(2,-2*o):1/ew(v);for(let e=0,t=h*d;e<t;++e)v[e]*=y;return{values:v,scale:1<<o,width:h,height:d,x1:f,y1:p,x2:f+(i>>o),y2:p+(a>>o)}}return s.x=function(t){return arguments.length?(e=ZS(t),s):e},s.y=function(e){return arguments.length?(t=ZS(e),s):t},s.weight=function(e){return arguments.length?(n=ZS(e),s):n},s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||oe("invalid size"),i=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||oe("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(1===(e=Ge(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&oe("invalid bandwidth"),r=e,s):r},s}function eN(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+i;++t)t<e&&(s+=n[t+o*e]),t>=i&&(t>=a&&(s-=n[t-a+o*e]),r[t-i+o*e]=s/Math.min(t+1,e-1+a-t,a))}function tN(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let s=0,u=0;s<t+i;++s)s<t&&(u+=n[o+s*e]),s>=i&&(s>=a&&(u-=n[o+(s-a)*e]),r[o+(s-i)*e]=u/Math.min(s+1,t-1+a-s,a))}function nN(e){ms.call(this,null,e)}XS.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},ft(XS,ms,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||le,a=VS().smooth(!1!==e.smooth),o=e.thresholds||function(e,t,n){const r=KS(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map((e=>bs(t(e).values))))}(r,i,e),s=null===e.as?null:e.as||"contour",u=[];return r.forEach((t=>{const n=i(t),r=a.size([n.width,n.height])(n.values,Ee(o)?o:o(n.values));!function(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;if(Xe(i)&&(i=i(n,r)),Xe(a)&&(a=a(n,r)),(1===i||null==i)&&!a)return;const o=(gt(i)?i:i[0])||1,s=(gt(i)?i:i[1])||1,u=a&&a[0]||0,c=a&&a[1]||0;e.forEach(YS(t,o,s,u,c))}(r,n,t,e),r.forEach((e=>{u.push(Uo(t,Lo(null!=s?{[s]:e}:e)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}}),nN.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const rN=["x","y","weight","size","cellSize","bandwidth"];function iN(e,t){return rN.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function aN(e){ms.call(this,null,e)}ft(nN,ms,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,o,s,u=[],c=e=>e(a);if(null==t)u.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(c)])||(n[o]=s=[],s.dims=o,u.push(s)),s.push(a);return u}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(te),o=iN(QS(),e),s=e.as||"grid";return n=i.map((t=>Lo(function(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}({[s]:o(t,e.counts)},t.dims)))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),aN.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},ft(aN,ms,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=VS().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||KS(e.count||10,e.nice,!!o),u=e.size;return o||(o=t.materialize(t.SOURCE).source,r=YS(n=iN(QS(),e)(o,!0),n.scale||1,n.scale||1,0,0),u=[n.width,n.height],o=n.values),s=Ee(s)?s:s(o),o=a.size(u)(o,s),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(Lo),i}});const oN="Feature",sN="FeatureCollection";function uN(e){ms.call(this,null,e)}function cN(e){ms.call(this,null,e)}function lN(e){ms.call(this,null,e)}function fN(e){ms.call(this,null,e)}function pN(e){ms.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,o,s,u,c,l,f,p=10,h=p,d=90,m=360,g=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return wu(Jw(r/d)*d,n,d).map(l).concat(wu(Jw(s/m)*m,o,m).map(f)).concat(wu(Jw(t/p)*p,e,p).filter((function(e){return Gw(e%d)>Lw})).map(u)).concat(wu(Jw(a/h)*h,i,h).filter((function(e){return Gw(e%m)>Lw})).map(c))}return v.lines=function(){return y().map((function(e){return{type:"LineString",coordinates:e}}))},v.outline=function(){return{type:"Polygon",coordinates:[l(r).concat(f(o).slice(1),l(n).reverse().slice(1),f(s).reverse().slice(1))]}},v.extent=function(e){return arguments.length?v.extentMajor(e).extentMinor(e):v.extentMinor()},v.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),v.precision(g)):[[r,s],[n,o]]},v.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),v.precision(g)):[[t,a],[e,i]]},v.step=function(e){return arguments.length?v.stepMajor(e).stepMinor(e):v.stepMinor()},v.stepMajor=function(e){return arguments.length?(d=+e[0],m=+e[1],v):[d,m]},v.stepMinor=function(e){return arguments.length?(p=+e[0],h=+e[1],v):[p,h]},v.precision=function(p){return arguments.length?(g=+p,u=jS(a,i,90),c=US(t,e,g),l=jS(s,o,90),f=US(r,n,g),v):g},v.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function hN(e){ms.call(this,null,e)}function dN(e){if(!Xe(e))return!1;const t=Tt(ne(e));return t.$x||t.$y||t.$value||t.$max}function mN(e){ms.call(this,null,e),this.modified(!0)}function gN(e,t,n){Xe(e[t])&&e[t](n)}function vN(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,u,c,l,f,p,h=e._root,d={data:r},m=e._x0,g=e._y0,v=e._x1,y=e._y1;if(!h)return e._root=d,e;for(;h.length;)if((c=t>=(a=(m+v)/2))?m=a:v=a,(l=n>=(o=(g+y)/2))?g=o:y=o,i=h,!(h=h[f=l<<1|c]))return i[f]=d,e;if(s=+e._x.call(null,h.data),u=+e._y.call(null,h.data),t===s&&n===u)return d.next=h,i?i[f]=d:e._root=d,e;do{i=i?i[f]=new Array(4):e._root=new Array(4),(c=t>=(a=(m+v)/2))?m=a:v=a,(l=n>=(o=(g+y)/2))?g=o:y=o}while((f=l<<1|c)==(p=(u>=o)<<1|s>=a));return i[p]=h,i[f]=d,e}function yN(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function bN(e){return e[0]}function xN(e){return e[1]}function wN(e,t,n){var r=new EN(null==t?bN:t,null==n?xN:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function EN(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function CN(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}uN.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},ft(uN,ms,{transform(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],u=e.geojson||!a&&le,c=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(ne(u))||o&&t.modified(ne(o))||s&&t.modified(ne(s)),this.value&&!n||(c=t.SOURCE,this._features=r=[],this._points=i=[]),u&&t.visit(c,(e=>r.push(u(e)))),o&&s&&(t.visit(c,(e=>{var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])})),r=r.concat({type:oN,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:sN,features:r}}}),cN.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},ft(cN,ms,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||le,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=PS(e.projection),n.materialize().reflow()):o=i===le||t.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(e,t){const n=e.pointRadius();return e.context(null),null!=t&&e.pointRadius(t),n}(r,e.pointRadius);return n.visit(o,(e=>e[a]=r(i(e)))),r.pointRadius(s),n.modifies(a)}}),lN.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},ft(lN,ms,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],u=o[1];function c(e){const t=r([i(e),a(e)]);t?(e[s]=t[0],e[u]=t[1]):(e[s]=void 0,e[u]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,c):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,c)),t.modifies(o)}}),fN.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},ft(fN,ms,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(PS(e.projection),e.field||ue("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(e=>e[i]=r)),n.modifies(i)}}),pN.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},ft(pN,ms,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const t in e)Xe(i[t])&&i[t](e[t]);return n=i(),r.length?t.mod.push(qo(r[0],n)):t.add.push(Lo(n)),r[0]=n,t}}),hN.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},ft(hN,ms,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||le,a=function(e,t){let n;return Xe(e)?(n=n=>e(n,t),n.dep=dN(e)):e?n=tt(e):(n=e=>e.$value/e.$max||0,n.dep=!0),n}(e.opacity,e),o=function(e,t){let n;return Xe(e)?(n=n=>qf(e(n,t)),n.dep=dN(e)):n=tt(qf(e||"#888")),n}(e.color,e),s=e.as||"image",u={$x:0,$y:0,$value:0,$max:r?bs(n.map((e=>bs(i(e).values)))):0};return n.forEach((e=>{const t=i(e),n=rt({},e,u);r||(n.$max=bs(t.values||[])),e[s]=function(e,t,n,r){const i=e.width,a=e.height,o=e.x1||0,s=e.y1||0,u=e.x2||i,c=e.y2||a,l=e.values,f=l?e=>l[e]:fe,p=uf(u-o,c-s),h=p.getContext("2d"),d=h.getImageData(0,0,u-o,c-s),m=d.data;for(let e=s,a=0;e<c;++e){t.$y=e-s;for(let s=o,c=e*i;s<u;++s,a+=4){t.$x=s-o,t.$value=f(s+c);const e=n(t);m[a+0]=e.r,m[a+1]=e.g,m[a+2]=e.b,m[a+3]=~~(255*r(t))}}return h.putImageData(d,0,0),p}(t,n,o.dep?o:tt(o(n)),a.dep?a:tt(a(n)))})),t.reflow(!0).modifies(s)}}),ft(mN,ms,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=zS((e||"mercator").toLowerCase());return t||oe("Unrecognized projection type: "+e),t()}(e.type),RS.forEach((t=>{null!=e[t]&&gN(n,t,e[t])}))):RS.forEach((t=>{e.modified(t)&&gN(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=Ge(e)).length?e[0]:{type:sN,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===sN?e.features:Ge(e).filter((e=>null!=e)).map((e=>e.type===oN?e:{type:oN,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var SN=wN.prototype=EN.prototype;function NN(e){return function(){return e}}function AN(e){return 1e-6*(e()-.5)}function kN(e){return e.x+e.vx}function DN(e){return e.y+e.vy}SN.copy=function(){var e,t,n=new EN(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=CN(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=CN(t));return n},SN.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return vN(this.cover(t,n),t,n,e)},SN.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),u=1/0,c=1/0,l=-1/0,f=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<u&&(u=r),r>l&&(l=r),i<c&&(c=i),i>f&&(f=i));if(u>l||c>f)return this;for(this.cover(u,c).cover(l,f),n=0;n<a;++n)vN(this,o[n],s[n],e[n]);return this},SN.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,u=i-n||1,c=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=c,c=o,u*=2,s){case 0:i=n+u,a=r+u;break;case 1:n=i-u,a=r+u;break;case 2:i=n+u,r=a-u;break;case 3:n=i-u,r=a-u}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},SN.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},SN.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},SN.find=function(e,t,n){var r,i,a,o,s,u,c,l=this._x0,f=this._y0,p=this._x1,h=this._y1,d=[],m=this._root;for(m&&d.push(new yN(m,l,f,p,h)),null==n?n=1/0:(l=e-n,f=t-n,p=e+n,h=t+n,n*=n);u=d.pop();)if(!(!(m=u.node)||(i=u.x0)>p||(a=u.y0)>h||(o=u.x1)<l||(s=u.y1)<f))if(m.length){var g=(i+o)/2,v=(a+s)/2;d.push(new yN(m[3],g,v,o,s),new yN(m[2],i,v,g,s),new yN(m[1],g,a,o,v),new yN(m[0],i,a,g,v)),(c=(t>=v)<<1|e>=g)&&(u=d[d.length-1],d[d.length-1]=d[d.length-1-c],d[d.length-1-c]=u)}else{var y=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=y*y+b*b;if(x<n){var w=Math.sqrt(n=x);l=e-w,f=t-w,p=e+w,h=t+w,r=m.data}}return r},SN.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,u,c,l,f,p,h=this._root,d=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!h)return this;if(h.length)for(;;){if((c=a>=(s=(d+g)/2))?d=s:g=s,(l=o>=(u=(m+v)/2))?m=u:v=u,t=h,!(h=h[f=l<<1|c]))return this;if(!h.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(n=t,p=f)}for(;h.data!==e;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[p]=h:this._root=h),this):(this._root=i,this)},SN.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},SN.root=function(){return this._root},SN.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},SN.visit=function(e){var t,n,r,i,a,o,s=[],u=this._root;for(u&&s.push(new yN(u,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(u=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&u.length){var c=(r+a)/2,l=(i+o)/2;(n=u[3])&&s.push(new yN(n,c,l,a,o)),(n=u[2])&&s.push(new yN(n,r,l,c,o)),(n=u[1])&&s.push(new yN(n,c,i,a,l)),(n=u[0])&&s.push(new yN(n,r,i,c,l))}return this},SN.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new yN(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,u=t.x1,c=t.y1,l=(o+u)/2,f=(s+c)/2;(a=i[0])&&n.push(new yN(a,o,s,l,f)),(a=i[1])&&n.push(new yN(a,l,s,u,f)),(a=i[2])&&n.push(new yN(a,o,f,l,c)),(a=i[3])&&n.push(new yN(a,l,f,u,c))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},SN.x=function(e){return arguments.length?(this._x=e,this):this._x},SN.y=function(e){return arguments.length?(this._y=e,this):this._y};var _N={value:()=>{}};function MN(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new TN(r)}function TN(e){this._=e}function ON(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function IN(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function FN(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=_N,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}TN.prototype=MN.prototype={constructor:TN,on:function(e,t){var n,r=this._,i=ON(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=FN(r[n],e.name,t);else if(null==t)for(n in r)r[n]=FN(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=IN(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new TN(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};const RN=MN;var BN,zN,PN=0,LN=0,jN=0,UN=0,qN=0,WN=0,VN="object"==typeof performance&&performance.now?performance:Date,$N="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function HN(){return qN||($N(GN),qN=VN.now()+WN)}function GN(){qN=0}function KN(){this._call=this._time=this._next=null}function XN(e,t,n){var r=new KN;return r.restart(e,t,n),r}function YN(){qN=(UN=VN.now())+WN,PN=LN=0;try{!function(){HN(),++PN;for(var e,t=BN;t;)(e=qN-t._time)>=0&&t._call.call(null,e),t=t._next;--PN}()}finally{PN=0,function(){for(var e,t,n=BN,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:BN=t);zN=e,ZN(r)}(),qN=0}}function JN(){var e=VN.now(),t=e-UN;t>1e3&&(WN-=t,UN=e)}function ZN(e){PN||(LN&&(LN=clearTimeout(LN)),e-qN>24?(e<1/0&&(LN=setTimeout(YN,e-VN.now()-WN)),jN&&(jN=clearInterval(jN))):(jN||(UN=VN.now(),jN=setInterval(JN,1e3)),PN=1,$N(YN)))}KN.prototype=XN.prototype={constructor:KN,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?HN():+n)+(null==t?0:+t),this._next||zN===this||(zN?zN._next=this:BN=this,zN=this),this._call=e,this._time=n,ZN()},stop:function(){this._call&&(this._call=null,this._time=1/0,ZN())}};const QN=4294967296;function eA(e){return e.x}function tA(e){return e.y}var nA=Math.PI*(3-Math.sqrt(5));function rA(e){return e.index}function iA(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const aA={center:function(e,t){var n,r=1;function i(){var i,a,o=n.length,s=0,u=0;for(i=0;i<o;++i)s+=(a=n[i]).x,u+=a.y;for(s=(s/o-e)*r,u=(u/o-t)*r,i=0;i<o;++i)(a=n[i]).x-=s,a.y-=u}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function o(){for(var e,o,u,c,l,f,p,h=t.length,d=0;d<a;++d)for(o=wN(t,kN,DN).visitAfter(s),e=0;e<h;++e)u=t[e],f=n[u.index],p=f*f,c=u.x+u.vx,l=u.y+u.vy,o.visit(m);function m(e,t,n,a,o){var s=e.data,h=e.r,d=f+h;if(!s)return t>c+d||a<c-d||n>l+d||o<l-d;if(s.index>u.index){var m=c-s.x-s.vx,g=l-s.y-s.vy,v=m*m+g*g;v<d*d&&(0===m&&(v+=(m=AN(r))*m),0===g&&(v+=(g=AN(r))*g),v=(d-(v=Math.sqrt(v)))/v*i,u.vx+=(m*=v)*(d=(h*=h)/(p+h)),u.vy+=(g*=v)*d,s.vx-=m*(d=1-d),s.vy-=g*d)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function u(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=NN(null==e?1:+e)),o.initialize=function(e,n){t=e,r=n,u()},o.iterations=function(e){return arguments.length?(a=+e,o):a},o.strength=function(e){return arguments.length?(i=+e,o):i},o.radius=function(t){return arguments.length?(e="function"==typeof t?t:NN(+t),u(),o):e},o},nbody:function(){var e,t,n,r,i,a=NN(-30),o=1,s=1/0,u=.81;function c(n){var i,a=e.length,o=wN(e,eA,tA).visitAfter(f);for(r=n,i=0;i<a;++i)t=e[i],o.visit(p)}function l(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+a(n,t,e)}}function f(e){var t,n,r,a,o,s=0,u=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,u+=n,r+=n*t.x,a+=n*t.y);e.x=r/u,e.y=a/u}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function p(e,a,c,l){if(!e.value)return!0;var f=e.x-t.x,p=e.y-t.y,h=l-a,d=f*f+p*p;if(h*h/u<d)return d<s&&(0===f&&(d+=(f=AN(n))*f),0===p&&(d+=(p=AN(n))*p),d<o&&(d=Math.sqrt(o*d)),t.vx+=f*e.value*r/d,t.vy+=p*e.value*r/d),!0;if(!(e.length||d>=s)){(e.data!==t||e.next)&&(0===f&&(d+=(f=AN(n))*f),0===p&&(d+=(p=AN(n))*p),d<o&&(d=Math.sqrt(o*d)));do{e.data!==t&&(h=i[e.data.index]*r/d,t.vx+=f*h,t.vy+=p*h)}while(e=e.next)}}return c.initialize=function(t,r){e=t,n=r,l()},c.strength=function(e){return arguments.length?(a="function"==typeof e?e:NN(+e),l(),c):a},c.distanceMin=function(e){return arguments.length?(o=e*e,c):Math.sqrt(o)},c.distanceMax=function(e){return arguments.length?(s=e*e,c):Math.sqrt(s)},c.theta=function(e){return arguments.length?(u=e*e,c):Math.sqrt(u)},c},link:function(e){var t,n,r,i,a,o,s=rA,u=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},c=NN(30),l=1;function f(r){for(var i=0,s=e.length;i<l;++i)for(var u,c,f,p,h,d,m,g=0;g<s;++g)c=(u=e[g]).source,p=(f=u.target).x+f.vx-c.x-c.vx||AN(o),h=f.y+f.vy-c.y-c.vy||AN(o),p*=d=((d=Math.sqrt(p*p+h*h))-n[g])/d*r*t[g],h*=d,f.vx-=p*(m=a[g]),f.vy-=h*m,c.vx+=p*(m=1-m),c.vy+=h*m}function p(){if(r){var o,u,c=r.length,l=e.length,f=new Map(r.map(((e,t)=>[s(e,t,r),e])));for(o=0,i=new Array(c);o<l;++o)(u=e[o]).index=o,"object"!=typeof u.source&&(u.source=iA(f,u.source)),"object"!=typeof u.target&&(u.target=iA(f,u.target)),i[u.source.index]=(i[u.source.index]||0)+1,i[u.target.index]=(i[u.target.index]||0)+1;for(o=0,a=new Array(l);o<l;++o)u=e[o],a[o]=i[u.source.index]/(i[u.source.index]+i[u.target.index]);t=new Array(l),h(),n=new Array(l),d()}}function h(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+u(e[n],n,e)}function d(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+c(e[t],t,e)}return null==e&&(e=[]),f.initialize=function(e,t){r=e,o=t,p()},f.links=function(t){return arguments.length?(e=t,p(),f):e},f.id=function(e){return arguments.length?(s=e,f):s},f.iterations=function(e){return arguments.length?(l=+e,f):l},f.strength=function(e){return arguments.length?(u="function"==typeof e?e:NN(+e),h(),f):u},f.distance=function(e){return arguments.length?(c="function"==typeof e?e:NN(+e),d(),f):c},f},x:function(e){var t,n,r,i=NN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=NN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:NN(+e),o(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:NN(+t),o(),a):e},a},y:function(e){var t,n,r,i=NN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=NN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:NN(+e),o(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:NN(+t),o(),a):e},a}},oA="forces",sA=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],uA=["static","iterations"],cA=["x","y","vx","vy"];function lA(e){ms.call(this,null,e)}function fA(e,t,n,r){var i,a,o,s,u=Ge(t.forces);for(i=0,a=sA.length;i<a;++i)(o=sA[i])!==oA&&t.modified(o)&&e[o](t[o]);for(i=0,a=u.length;i<a;++i)s=oA+i,(o=n||t.modified(oA,i)?hA(u[i]):r&&pA(u[i],r)?e.force(s):null)&&e.force(s,o);for(a=e.numForces||0;i<a;++i)e.force(oA+i,null);return e.numForces=u.length,e}function pA(e,t){var n,r;for(n in e)if(Xe(r=e[n])&&t.modified(ne(r)))return 1;return 0}function hA(e){var t,n;for(n in st(aA,e.force)||oe("Unrecognized force: "+e.force),t=aA[e.force](),e)Xe(t[n])&&dA(t[n],e[n],e);return t}function dA(e,t,n){e(Xe(t)?e=>t(e,n):t)}function mA(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function gA(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=yA)):void 0===t&&(t=vA);for(var n,r,i,a,o,s=new wA(e),u=[s];n=u.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)u.push(r=i[a]=new wA(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(xA)}function vA(e){return e.children}function yA(e){return Array.isArray(e)?e[1]:null}function bA(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function xA(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function wA(e){this.data=e,this.depth=this.height=0,this.parent=null}function EA(e,t){var n,r;if(NA(t,e))return[t];for(n=0;n<e.length;++n)if(CA(t,e[n])&&NA(kA(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(CA(kA(e[n],e[r]),t)&&CA(kA(e[n],t),e[r])&&CA(kA(e[r],t),e[n])&&NA(DA(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function CA(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function SA(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function NA(e,t){for(var n=0;n<t.length;++n)if(!SA(e,t[n]))return!1;return!0}function AA(e){switch(e.length){case 1:return{x:(t=e[0]).x,y:t.y,r:t.r};case 2:return kA(e[0],e[1]);case 3:return DA(e[0],e[1],e[2])}var t}function kA(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,u=a-n,c=o-r,l=s-i,f=Math.sqrt(u*u+c*c);return{x:(n+a+u/f*l)/2,y:(r+o+c/f*l)/2,r:(f+i+s)/2}}function DA(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,u=t.r,c=n.x,l=n.y,f=n.r,p=r-o,h=r-c,d=i-s,m=i-l,g=u-a,v=f-a,y=r*r+i*i-a*a,b=y-o*o-s*s+u*u,x=y-c*c-l*l+f*f,w=h*d-p*m,E=(d*x-m*b)/(2*w)-r,C=(m*g-d*v)/w,S=(h*b-p*x)/(2*w)-i,N=(p*v-h*g)/w,A=C*C+N*N-1,k=2*(a+E*C+S*N),D=E*E+S*S-a*a,_=-(A?(k+Math.sqrt(k*k-4*A*D))/(2*A):D/k);return{x:r+E+C*_,y:i+S+N*_,r:_}}function _A(e,t,n){var r,i,a,o,s=e.x-t.x,u=e.y-t.y,c=s*s+u*u;c?(i=t.r+n.r,i*=i,o=e.r+n.r,i>(o*=o)?(r=(c+o-i)/(2*c),a=Math.sqrt(Math.max(0,o/c-r*r)),n.x=e.x-r*s-a*u,n.y=e.y-r*u+a*s):(r=(c+i-o)/(2*c),a=Math.sqrt(Math.max(0,i/c-r*r)),n.x=t.x+r*s-a*u,n.y=t.y+r*u+a*s)):(n.x=t.x+n.r,n.y=t.y)}function MA(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function TA(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function OA(e){this._=e,this.next=null,this.previous=null}function IA(e){if(!(i=(e=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(e)).length))return 0;var t,n,r,i,a,o,s,u,c,l,f;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;_A(n,t,r=e[2]),t=new OA(t),n=new OA(n),r=new OA(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(s=3;s<i;++s){_A(t._,n._,r=e[s]),r=new OA(r),u=n.next,c=t.previous,l=n._.r,f=t._.r;do{if(l<=f){if(MA(u._,r._)){n=u,t.next=n,n.previous=t,--s;continue e}l+=u._.r,u=u.next}else{if(MA(c._,r._)){(t=c).next=n,n.previous=t,--s;continue e}f+=c._.r,c=c.previous}}while(u!==c.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,a=TA(t);(r=r.next)!==n;)(o=TA(r))<a&&(t=r,a=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=function(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&SA(n,t)?++r:(n=AA(a=EA(a,t)),r=0);return n}(t),s=0;s<i;++s)(t=e[s]).x-=r.x,t.y-=r.y;return r.r}function FA(e){return null==e?null:RA(e)}function RA(e){if("function"!=typeof e)throw new Error;return e}function BA(){return 0}function zA(e){return function(){return e}}function PA(e){return Math.sqrt(e.value)}function LA(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function jA(e,t){return function(n){if(r=n.children){var r,i,a,o=r.length,s=e(n)*t||0;if(s)for(i=0;i<o;++i)r[i].r+=s;if(a=IA(r),s)for(i=0;i<o;++i)r[i].r-=s;n.r=a+s}}}function UA(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function qA(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function WA(e,t,n,r,i){for(var a,o=e.children,s=-1,u=o.length,c=e.value&&(r-t)/e.value;++s<u;)(a=o[s]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*c}lA.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:cA}]},ft(lA,ms,{transform(e,t){var n,r,i=this.value,a=t.changed(t.ADD_REM),o=e.modified(sA),s=e.iterations||300;if(i?(a&&(t.modifies("index"),i.nodes(t.source)),(o||t.changed(t.MOD))&&fA(i,e,0,t)):(this.value=i=function(e,t){const n=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,u=XN(f),c=RN("tick","end"),l=function(){let e=1;return()=>(e=(1664525*e+1013904223)%QN)/QN}();function f(){p(),c.call("tick",t),n<r&&(u.stop(),c.call("end",t))}function p(r){var u,c,l=e.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(a-n)*i,s.forEach((function(e){e(n)})),u=0;u<l;++u)null==(c=e[u]).fx?c.x+=c.vx*=o:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=o:(c.y=c.fy,c.vy=0);return t}function h(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*nA;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function d(t){return t.initialize&&t.initialize(e,l),t}return null==e&&(e=[]),h(),t={tick:p,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(n){return arguments.length?(e=n,h(),s.forEach(d),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(l=e,s.forEach(d),t):l},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,d(n)),t):s.get(e)},find:function(t,n,r){var i,a,o,s,u,c=0,l=e.length;for(null==r?r=1/0:r*=r,c=0;c<l;++c)(o=(i=t-(s=e[c]).x)*i+(a=n-s.y)*a)<r&&(u=s,r=o);return u},on:function(e,n){return arguments.length>1?(c.on(e,n),t):c.on(e)}}}(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),fA(n,t,!0).on("end",(()=>a=!0))}(t.source,e),i.on("tick",(n=t.dataflow,r=this,()=>n.touch(r).run())),e.static||(a=!0,i.tick()),t.modifies("index")),o||a||e.modified(uA)||t.changed()&&e.restart)if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),e.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let e,t=this._argops,s=0,u=t.length;s<u;++s)if(e=t[s],e.name===oA&&"link"===e.op._argval.force)for(var r,i=e.op._argops,a=0,o=i.length;a<o;++a)if("links"===i[a].name&&(r=i[a].op.source)){n.pulse(r,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(cA)}}),wA.prototype=gA.prototype={constructor:wA,count:function(){return this.eachAfter(mA)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],u=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++u,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return gA(this).eachBefore(bA)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}};var VA={depth:-1},$A={};function HA(e){return e.id}function GA(e){return e.parentId}function KA(){var e=HA,t=GA;function n(n){var r,i,a,o,s,u,c,l=Array.from(n),f=l.length,p=new Map;for(i=0;i<f;++i)r=l[i],s=l[i]=new wA(r),null!=(u=e(r,i,n))&&(u+="")&&(c=s.id=u,p.set(c,p.has(c)?$A:s)),null!=(u=t(r,i,n))&&(u+="")&&(s.parent=u);for(i=0;i<f;++i)if(u=(s=l[i]).parent){if(!(o=p.get(u)))throw new Error("missing: "+u);if(o===$A)throw new Error("ambiguous: "+u);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=VA,a.eachBefore((function(e){e.depth=e.parent.depth+1,--f})).eachBefore(xA),a.parent=null,f>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=RA(t),n):e},n.parentId=function(e){return arguments.length?(t=RA(e),n):t},n}function XA(e,t){return e.parent===t.parent?1:2}function YA(e){var t=e.children;return t?t[0]:e.t}function JA(e){var t=e.children;return t?t[t.length-1]:e.t}function ZA(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function QA(e,t,n){return e.a.parent===t.parent?e.a:n}function ek(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function tk(e,t){return e.parent===t.parent?1:2}function nk(e,t){return e+t.x}function rk(e,t){return Math.max(e,t.y)}function ik(e,t,n,r,i){for(var a,o=e.children,s=-1,u=o.length,c=e.value&&(i-n)/e.value;++s<u;)(a=o[s]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*c}ek.prototype=Object.create(wA.prototype);var ak=(1+Math.sqrt(5))/2;function ok(e,t,n,r,i,a){for(var o,s,u,c,l,f,p,h,d,m,g,v=[],y=t.children,b=0,x=0,w=y.length,E=t.value;b<w;){u=i-n,c=a-r;do{l=y[x++].value}while(!l&&x<w);for(f=p=l,g=l*l*(m=Math.max(c/u,u/c)/(E*e)),d=Math.max(p/g,g/f);x<w;++x){if(l+=s=y[x].value,s<f&&(f=s),s>p&&(p=s),g=l*l*m,(h=Math.max(p/g,g/f))>d){l-=s;break}d=h}v.push(o={value:l,dice:u<c,children:y.slice(b,x)}),o.dice?WA(o,n,r,i,E?r+=c*l/E:a):ik(o,n,r,E?n+=u*l/E:i,a),E-=l,b=x}return v}const sk=function e(t){function n(e,n,r,i,a){ok(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(ak),uk=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t)for(var o,s,u,c,l,f=-1,p=o.length,h=e.value;++f<p;){for(u=(s=o[f]).children,c=s.value=0,l=u.length;c<l;++c)s.value+=u[c].value;s.dice?WA(s,n,r,i,h?r+=(a-r)*s.value/h:a):ik(s,n,r,h?n+=(i-n)*s.value/h:i,a),h-=s.value}else e._squarify=o=ok(t,e,n,r,i,a),o.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(ak);function ck(e,t,n){const r={};return e.each((e=>{const i=e.data;n(i)&&(r[t(i)]=e)})),e.lookup=r,e}function lk(e){ms.call(this,null,e)}lk.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const fk=e=>e.values;function pk(){const e=[],t={entries:e=>r(n(e,0),0),key:n=>(e.push(n),t)};function n(t,r){if(r>=e.length)return t;const i=t.length,a=e[r++],o={},s={};let u,c,l,f=-1;for(;++f<i;)u=a(c=t[f])+"",(l=o[u])?l.push(c):o[u]=[c];for(u in o)s[u]=n(o[u],r);return s}function r(t,n){if(++n>e.length)return t;const i=[];for(const e in t)i.push({key:e,values:r(t[e],n)});return i}return t}function hk(e){ms.call(this,null,e)}ft(lk,ms,{transform(e,t){t.source||oe("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each((e=>{e.children&&Bo(e.data)&&i.rem.push(e.data)})),this.value=a=gA({values:Ge(e.keys).reduce(((e,t)=>(e.key(t),e)),pk()).entries(i.source)},fk),n&&a.each((e=>{e.children&&(e=Lo(e.data),i.add.push(e),i.source.push(e))})),ck(a,zo,zo)),i.source.root=a,i}});const dk=(e,t)=>e.parent===t.parent?1:2;ft(hk,ms,{transform(e,t){t.source&&t.source.root||oe(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(Wo(e.sort,(e=>e.data))),function(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?dk:pe);try{this.value=n(i)}catch(e){oe(e)}return i.each((e=>function(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a))),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const mk=["x","y","r","depth","children"];function gk(e){hk.call(this,e)}gk.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:mk.length,default:mk}]},ft(gk,hk,{layout:function(){var e=null,t=1,n=1,r=BA;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(LA(e)).eachAfter(jA(r,.5)).eachBefore(UA(1)):i.eachBefore(LA(PA)).eachAfter(jA(BA,1)).eachAfter(jA(r,i.r/Math.min(t,n))).eachBefore(UA(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=FA(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:zA(+e),i):r},i},params:["radius","size","padding"],fields:mk});const vk=["x0","y0","x1","y1","depth","children"];function yk(e){hk.call(this,e)}function bk(e){ms.call(this,null,e)}yk.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:vk.length,default:vk}]},ft(yk,hk,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&WA(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;o<i&&(i=o=(i+o)/2),s<a&&(a=s=(a+s)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=s}}(t,a)),r&&i.eachBefore(qA),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:vk}),bk.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},ft(bk,ms,{transform(e,t){t.source||oe("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?ck(KA().id(e.key).parentId(e.parentKey)(i.source),e.key,he):ck(KA()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const xk={tidy:function(){var e=XA,t=1,n=1,r=null;function i(i){var u=function(e){for(var t,n,r,i,a,o=new ek(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new ek(r[i],i)),n.parent=t;return(o.parent=new ek(null,0)).children=[o],o}(i);if(u.eachAfter(a),u.parent.m=-u.z,u.eachBefore(o),r)i.eachBefore(s);else{var c=i,l=i,f=i;i.eachBefore((function(e){e.x<c.x&&(c=e),e.x>l.x&&(l=e),e.depth>f.depth&&(f=e)}));var p=c===l?1:e(c,l)/2,h=p-c.x,d=t/(l.x+p+h),m=n/(f.depth||1);i.eachBefore((function(e){e.x=(e.x+h)*d,e.y=e.depth*m}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,u=a.parent.children[0],c=a.m,l=o.m,f=s.m,p=u.m;s=JA(s),a=YA(a),s&&a;)u=YA(u),(o=JA(o)).a=t,(i=s.z+f-a.z-c+e(s._,a._))>0&&(ZA(QA(s,t,r),t,i),c+=i,l+=i),f+=s.m,c+=a.m,p+=u.m,l+=o.m;s&&!JA(o)&&(o.t=s,o.m+=f-l),a&&!YA(u)&&(u.t=a,u.m+=c-p,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=tk,t=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(nk,0)/e.length}(n),t.y=function(e){return 1+e.reduce(rk,0)}(n)):(t.x=a?o+=e(t,a):0,t.y=0,a=t)}));var s=function(e){for(var t;t=e.children;)e=t[0];return e}(i),u=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),c=s.x-e(s,u)/2,l=u.x+e(u,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-c)/(l-c)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},wk=["x","y","depth","children"];function Ek(e){hk.call(this,e)}function Ck(e){ms.call(this,[],e)}Ek.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:wk.length,default:wk}]},ft(Ek,hk,{layout(e){const t=e||"tidy";if(st(xk,t))return xk[t]();oe("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:wk}),Ck.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},ft(Ck,ms,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||oe("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,(e=>a[zo(e)]=1)),r.each((e=>{const t=e.data,n=e.parent&&e.parent.data;n&&a[zo(t)]&&a[zo(n)]&&i.add.push(Lo({source:n,target:t}))})),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,(e=>a[zo(e)]=1)),n.forEach((e=>{(a[zo(e.source)]||a[zo(e.target)])&&i.mod.push(e)}))),i}});const Sk={binary:function(e,t,n,r,i){var a,o,s=e.children,u=s.length,c=new Array(u+1);for(c[0]=o=a=0;a<u;++a)c[a+1]=o+=s[a].value;!function e(t,n,r,i,a,o,u){if(t>=n-1){var l=s[t];return l.x0=i,l.y0=a,l.x1=o,void(l.y1=u)}for(var f=c[t],p=r/2+f,h=t+1,d=n-1;h<d;){var m=h+d>>>1;c[m]<p?h=m+1:d=m}p-c[h-1]<c[h]-p&&t+1<h&&--h;var g=c[h]-f,v=r-g;if(o-i>u-a){var y=r?(i*v+o*g)/r:o;e(t,h,g,i,a,y,u),e(h,n,v,y,a,o,u)}else{var b=r?(a*v+u*g)/r:u;e(t,h,g,i,a,o,b),e(h,n,v,i,b,o,u)}}(0,u,e.value,t,n,r,i)},dice:WA,slice:ik,slicedice:function(e,t,n,r,i){(1&e.depth?ik:WA)(e,t,n,r,i)},squarify:sk,resquarify:uk},Nk=["x0","y0","x1","y1","depth","children"];function Ak(e){hk.call(this,e)}function kk(e,t,n,r){const i=e.width,a=e.height,o=n||r,s=uf(i,a).getContext("2d");t.forEach((e=>Dk(s,e,o)));const u=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),c=e.bitmap(),l=o&&e.bitmap();let f,p,h,d,m;for(p=0;p<a;++p)for(f=0;f<i;++f)m=4278190080&u[p*i+f],m&&(h=e(f),d=e(p),r||c.set(h,d),o&&268435456^m&&l.set(h,d));return[c,l]}function Dk(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;"group"===r?t.forEach((t=>{t.items.forEach((t=>Dk(e,t.items,n)))})):hy[r].draw(e,{items:n?t.map(_k):t})}function _k(e){const t=Uo(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}Ak.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:Nk.length,default:Nk}]},ft(Ak,hk,{layout(){const e=function(){var e=sk,t=!1,n=1,r=1,i=[0],a=BA,o=BA,s=BA,u=BA,c=BA;function l(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(f),i=[0],t&&e.eachBefore(qA),e}function f(t){var n=i[t.depth],r=t.x0+n,l=t.y0+n,f=t.x1-n,p=t.y1-n;f<r&&(r=f=(r+f)/2),p<l&&(l=p=(l+p)/2),t.x0=r,t.y0=l,t.x1=f,t.y1=p,t.children&&(n=i[t.depth+1]=a(t)/2,r+=c(t)-n,l+=o(t)-n,(f-=s(t)-n)<r&&(r=f=(r+f)/2),(p-=u(t)-n)<l&&(l=p=(l+p)/2),e(t,r,l,f,p))}return l.round=function(e){return arguments.length?(t=!!e,l):t},l.size=function(e){return arguments.length?(n=+e[0],r=+e[1],l):[n,r]},l.tile=function(t){return arguments.length?(e=RA(t),l):e},l.padding=function(e){return arguments.length?l.paddingInner(e).paddingOuter(e):l.paddingInner()},l.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:zA(+e),l):a},l.paddingOuter=function(e){return arguments.length?l.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):l.paddingTop()},l.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:zA(+e),l):o},l.paddingRight=function(e){return arguments.length?(s="function"==typeof e?e:zA(+e),l):s},l.paddingBottom=function(e){return arguments.length?(u="function"==typeof e?e:zA(+e),l):u},l.paddingLeft=function(e){return arguments.length?(c="function"==typeof e?e:zA(+e),l):c},l}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{st(Sk,t)?e.tile(Sk[t]):oe("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:Nk});const Mk=31,Tk=new Uint32Array(33),Ok=new Uint32Array(33);Ok[0]=0,Tk[0]=~Ok[0];for(let e=1;e<=32;++e)Ok[e]=Ok[e-1]<<1|1,Tk[e]=~Ok[e];function Ik(e,t,n,r,i,a){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function Fk(e,t,n,r,i,a,o,s){const u=i*a/(2*r),c=e(t-u),l=e(t+u),f=e(n-(a/=2)),p=e(n+a);return o.outOfBounds(c,f,l,p)||o.getRange(c,f,l,p)||s&&s.getRange(c,f,l,p)}const Rk=[-1,-1,1,1],Bk=[-1,1,-1,1],zk=["right","center","left"],Pk=["bottom","middle","top"];function Lk(e,t,n,r,i,a,o,s,u,c,l,f){return!(i.outOfBounds(e,n,t,r)||(f&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(o,u,s,c,l):i.getRange(e,n,t,r)))}const jk={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},Uk={naive:function(e,t,n,r){const i=e.width,a=e.height;return function(e){const t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,s=Gv.width(e.datum,e.datum.text);let u,c,l,f,p,h,d,m=0;for(let r=0;r<n;++r)u=t[r].x,l=t[r].y,c=void 0===t[r].x2?u:t[r].x2,f=void 0===t[r].y2?l:t[r].y2,p=(u+c)/2,h=(l+f)/2,d=Math.abs(c-u+f-l),d>=m&&(m=d,e.x=p,e.y=h);return p=s/2,h=o/2,u=e.x-p,c=e.x+p,l=e.y-h,f=e.y+h,e.align="center",u<0&&c<=i?e.align="left":0<=u&&i<c&&(e.align="right"),e.baseline="middle",l<0&&f<=a?e.baseline="top":0<=l&&a<f&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1];function u(t,n,r,u,c){const l=e.invert(t),f=e.invert(n);let p,h=r,d=a;if(!Ik(l,f,u,c,i,a)&&!Fk(e,l,f,c,u,h,o,s)&&!Fk(e,l,f,c,u,c,o,null)){for(;d-h>=1;)p=(h+d)/2,Fk(e,l,f,c,u,p,o,s)?d=p:h=p;if(h>r)return[l,f,h,!0]}}return function(t){const s=t.datum.datum.items[r].items,c=s.length,l=t.datum.fontSize,f=Gv.width(t.datum,t.datum.text);let p,h,d,m,g,v,y,b,x,w,E,C,S,N,A,k,D,_=n?l:0,M=!1,T=!1,O=0;for(let r=0;r<c;++r){for(p=s[r].x,d=s[r].y,h=void 0===s[r].x2?p:s[r].x2,m=void 0===s[r].y2?d:s[r].y2,p>h&&(D=p,p=h,h=D),d>m&&(D=d,d=m,m=D),x=e(p),E=e(h),w=~~((x+E)/2),C=e(d),N=e(m),S=~~((C+N)/2),y=w;y>=x;--y)for(b=S;b>=C;--b)k=u(y,b,_,f,l),k&&([t.x,t.y,_,M]=k);for(y=w;y<=E;++y)for(b=S;b<=N;++b)k=u(y,b,_,f,l),k&&([t.x,t.y,_,M]=k);M||n||(A=Math.abs(h-p+m-d),g=(p+h)/2,v=(d+m)/2,A>=O&&!Ik(g,v,f,l,i,a)&&!Fk(e,g,v,l,f,l,o,null)&&(O=A,t.x=g,t.y=v,T=!0))}return!(!M&&!T||(g=f/2,v=l/2,o.setRange(e(t.x-g),e(t.y-v),e(t.x+g),e(t.y+v)),t.align="center",t.baseline="middle",0))}},floodfill:function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],u=e.bitmap();return function(t){const c=t.datum.datum.items[r].items,l=c.length,f=t.datum.fontSize,p=Gv.width(t.datum,t.datum.text),h=[];let d,m,g,v,y,b,x,w,E,C,S,N,A=n?f:0,k=!1,D=!1,_=0;for(let r=0;r<l;++r){for(d=c[r].x,g=c[r].y,m=void 0===c[r].x2?d:c[r].x2,v=void 0===c[r].y2?g:c[r].y2,h.push([e((d+m)/2),e((g+v)/2)]);h.length;)if([x,w]=h.pop(),!(o.get(x,w)||s.get(x,w)||u.get(x,w))){u.set(x,w);for(let e=0;e<4;++e)y=x+Rk[e],b=w+Bk[e],u.outOfBounds(y,b,y,b)||h.push([y,b]);if(y=e.invert(x),b=e.invert(w),E=A,C=a,!Ik(y,b,p,f,i,a)&&!Fk(e,y,b,f,p,E,o,s)&&!Fk(e,y,b,f,p,f,o,null)){for(;C-E>=1;)S=(E+C)/2,Fk(e,y,b,f,p,S,o,s)?C=S:E=S;E>A&&(t.x=y,t.y=b,A=E,k=!0)}}k||n||(N=Math.abs(m-d+v-g),y=(d+m)/2,b=(g+v)/2,N>=_&&!Ik(y,b,p,f,i,a)&&!Fk(e,y,b,f,p,f,o,null)&&(_=N,t.x=y,t.y=b,D=!0))}return!(!k&&!D||(y=p/2,b=f/2,o.setRange(e(t.x-y),e(t.y-b),e(t.x+y),e(t.y+b)),t.align="center",t.baseline="middle",0))}}};function qk(e,t,n,r,i,a,o,s,u,c,l){if(!e.length)return e;const f=Math.max(r.length,i.length),p=function(e,t){const n=new Float64Array(t),r=e.length;for(let t=0;t<r;++t)n[t]=e[t]||0;for(let e=r;e<t;++e)n[e]=n[r-1];return n}(r,f),h=function(e,t){const n=new Int8Array(t),r=e.length;for(let t=0;t<r;++t)n[t]|=jk[e[t]];for(let e=r;e<t;++e)n[e]=n[r-1];return n}(i,f),d=(x=e[0].datum)&&x.mark&&x.mark.marktype,m="group"===d&&e[0].datum.items[u].marktype,g="area"===m,v=function(e,t,n,r){const i=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>i(e.datum):"line"===t?e=>{const t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(d,m,s,u),y=function(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=e=>~~((e+n)/r);return o.invert=e=>e*r-n,o.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{const i=r*e+t;return n[i>>>5]&1<<(i&Mk)},set:(t,n)=>{const i=n*e+t;r(i>>>5,1<<(i&Mk))},clear:(t,n)=>{const r=n*e+t;i(r>>>5,~(1<<(r&Mk)))},getRange:(t,r,i,a)=>{let o,s,u,c,l=a;for(;l>=r;--l)if(o=l*e+t,s=l*e+i,u=o>>>5,c=s>>>5,u===c){if(n[u]&Tk[o&Mk]&Ok[1+(s&Mk)])return!0}else{if(n[u]&Tk[o&Mk])return!0;if(n[c]&Ok[1+(s&Mk)])return!0;for(let e=u+1;e<c;++e)if(n[e])return!0}return!1},setRange:(t,n,i,a)=>{let o,s,u,c,l;for(;n<=a;++n)if(o=n*e+t,s=n*e+i,u=o>>>5,c=s>>>5,u===c)r(u,Tk[o&Mk]&Ok[1+(s&Mk)]);else for(r(u,Tk[o&Mk]),r(c,Ok[1+(s&Mk)]),l=u+1;l<c;++l)r(l,4294967295)},clearRange:(t,n,r,a)=>{let o,s,u,c,l;for(;n<=a;++n)if(o=n*e+t,s=n*e+r,u=o>>>5,c=s>>>5,u===c)i(u,Ok[o&Mk]|Tk[1+(s&Mk)]);else for(i(u,Ok[o&Mk]),i(c,Tk[1+(s&Mk)]),l=u+1;l<c;++l)i(l,0)},outOfBounds:(n,r,i,a)=>n<0||r<0||a>=t||i>=e}}(i,a),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}(t[0],t[1],c),b=g&&"naive"===l;var x;const w=e.map((e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:v(e)})));let E;if(!b){n&&w.sort(((e,t)=>n(e.datum,t.datum)));let t=!1;for(let e=0;e<h.length&&!t;++e)t=5===h[e]||p[e]<0;d&&(o||g)&&(a=[e.map((e=>e.datum))].concat(a)),E=a.length?kk(y,a,t,g):function(e,t){const n=e.bitmap();return(t||[]).forEach((t=>n.set(e(t.boundary[0]),e(t.boundary[3])))),[n,void 0]}(y,o&&w)}const C=g?Uk[l](y,E,o,u):function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],u=r.length;return function(t){const c=t.boundary,l=t.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>i||c[3]>a)return!1;let f,p,h,d,m,g,v,y,b,x,w,E,C,S,N,A=0;for(let i=0;i<u;++i){if(f=(3&n[i])-1,p=(n[i]>>>2&3)-1,h=0===f&&0===p||r[i]<0,d=f&&p?Math.SQRT1_2:1,m=r[i]<0?-1:1,g=c[1+f]+r[i]*f*d,w=c[4+p]+m*l*p/2+r[i]*p*d,y=w-l/2,b=w+l/2,E=e(g),S=e(y),N=e(b),!A){if(!Lk(E,E,S,N,o,s,g,g,y,b,c,h))continue;A=Gv.width(t.datum,t.datum.text)}if(x=g+m*A*f/2,g=x-A/2,v=x+A/2,E=e(g),C=e(v),Lk(E,C,S,N,o,s,g,v,y,b,c,h))return t.x=f?f*m<0?v:g:x,t.y=p?p*m<0?b:y:w,t.align=zk[f*m+1],t.baseline=Pk[p*m+1],o.setRange(E,S,C,N),!0}return!1}}(y,E,h,p);return w.forEach((e=>e.opacity=+C(e))),w}const Wk=["x","y","opacity","align","baseline"],Vk=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function $k(e){ms.call(this,null,e)}function Hk(e,t){var n,r,i,a,o,s,u=[],c=function(e){return e(a)};if(null==t)u.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(c)])||(n[o]=s=[],s.dims=o,u.push(s)),s.push(a);return u}function Gk(e){ms.call(this,null,e)}$k.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Vk},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:Wk.length,default:Wk}]},ft($k,ms,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const r=e.sort;return Xe(r)&&t.modified(r.fields)}()))return;e.size&&2===e.size.length||oe("Size parameter should be specified as a [width, height] array.");const r=e.as||Wk;return qk(t.materialize(t.SOURCE).source,e.size,e.sort,Ge(e.offset||1),Ge(e.anchor||Vk),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((e=>{const t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline})),t.reflow(n).modifies(r)}}),Gk.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},ft(Gk,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Hk(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(te),a=i.length,o=e.as||[te(e.x),te(e.y)],s=[];r.forEach((t=>{mu(t,e.x,e.y,e.bandwidth||.3).forEach((e=>{const n={};for(let e=0;e<a;++e)n[i[e]]=t.dims[e];n[o[0]]=e[0],n[o[1]]=e[1],s.push(Lo(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const Kk={linear:uu,log:cu,exp:lu,pow:fu,quad:pu,poly:hu};function Xk(e){ms.call(this,null,e)}Xk.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Kk)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},ft(Xk,ms,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Hk(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(te),a=e.method||"linear",o=e.order||3,s=((e,t)=>"poly"===e?t:"quad"===e?2:1)(a,o),u=e.as||[te(e.x),te(e.y)],c=Kk[a],l=[];let f=e.extent;st(Kk,a)||oe("Invalid regression method: "+a),null!=f&&"log"===a&&f[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),f=null),r.forEach((n=>{if(n.length<=s)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=c(n,e.x,e.y,o);if(e.params)return void l.push(Lo({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const p=f||it(n,e.x),h=e=>{const t={};for(let e=0;e<i.length;++e)t[i[e]]=n.dims[e];t[u[0]]=e[0],t[u[1]]=e[1],l.push(Lo(t))};"linear"===a?p.forEach((e=>h([e,r.predict(e)]))):bu(r.predict,p,25,200).forEach(h)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});const Yk=Math.pow(2,-52),Jk=new Uint32Array(512);class Zk{static from(e,t=oD,n=sD){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new Zk(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,u=-1/0,c=-1/0;for(let t=0;t<a;t++){const n=e[2*t],r=e[2*t+1];n<o&&(o=n),r<s&&(s=r),n>u&&(u=n),r>c&&(c=r),this._ids[t]=t}const l=(o+u)/2,f=(s+c)/2;let p,h,d,m=1/0;for(let t=0;t<a;t++){const n=Qk(l,f,e[2*t],e[2*t+1]);n<m&&(p=t,m=n)}const g=e[2*p],v=e[2*p+1];m=1/0;for(let t=0;t<a;t++){if(t===p)continue;const n=Qk(g,v,e[2*t],e[2*t+1]);n<m&&n>0&&(h=t,m=n)}let y=e[2*h],b=e[2*h+1],x=1/0;for(let t=0;t<a;t++){if(t===p||t===h)continue;const n=rD(g,v,y,b,e[2*t],e[2*t+1]);n<x&&(d=t,x=n)}let w=e[2*d],E=e[2*d+1];if(x===1/0){for(let t=0;t<a;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];iD(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(tD(g,v,y,b,w,E)){const e=h,t=y,n=b;h=d,y=w,b=E,d=e,w=t,E=n}const C=function(e,t,n,r,i,a){const o=n-e,s=r-t,u=i-e,c=a-t,l=o*o+s*s,f=u*u+c*c,p=.5/(o*c-s*u);return{x:e+(c*l-s*f)*p,y:t+(o*f-u*l)*p}}(g,v,y,b,w,E);this._cx=C.x,this._cy=C.y;for(let t=0;t<a;t++)this._dists[t]=Qk(e[2*t],e[2*t+1],C.x,C.y);iD(this._ids,this._dists,0,a-1),this._hullStart=p;let S=3;n[p]=t[d]=h,n[h]=t[p]=d,n[d]=t[h]=p,r[p]=0,r[h]=1,r[d]=2,i.fill(-1),i[this._hashKey(g,v)]=p,i[this._hashKey(y,b)]=h,i[this._hashKey(w,E)]=d,this.trianglesLen=0,this._addTriangle(p,h,d,-1,-1,-1);for(let a,o,s=0;s<this._ids.length;s++){const u=this._ids[s],c=e[2*u],l=e[2*u+1];if(s>0&&Math.abs(c-a)<=Yk&&Math.abs(l-o)<=Yk)continue;if(a=c,o=l,u===p||u===h||u===d)continue;let f=0;for(let e=0,t=this._hashKey(c,l);e<this._hashSize&&(f=i[(t+e)%this._hashSize],-1===f||f===n[f]);e++);f=t[f];let m,g=f;for(;m=n[g],!tD(c,l,e[2*g],e[2*g+1],e[2*m],e[2*m+1]);)if(g=m,g===f){g=-1;break}if(-1===g)continue;let v=this._addTriangle(g,u,n[g],-1,-1,r[g]);r[u]=this._legalize(v+2),r[g]=v,S++;let y=n[g];for(;m=n[y],tD(c,l,e[2*y],e[2*y+1],e[2*m],e[2*m+1]);)v=this._addTriangle(y,u,m,r[u],-1,r[y]),r[u]=this._legalize(v+2),n[y]=y,S--,y=m;if(g===f)for(;m=t[g],tD(c,l,e[2*m],e[2*m+1],e[2*g],e[2*g+1]);)v=this._addTriangle(m,u,g,-1,r[g],r[m]),this._legalize(v+2),r[m]=v,n[g]=g,S--,g=m;this._hullStart=t[u]=g,n[g]=t[y]=u,n[u]=y,i[this._hashKey(c,l)]=u,i[this._hashKey(e[2*g],e[2*g+1])]=g}this.hull=new Uint32Array(S);for(let e=0,t=this._hullStart;e<S;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=Jk[--i];continue}const u=o-o%3,c=s+(e+1)%3,l=u+(o+2)%3,f=t[a],p=t[e],h=t[c],d=t[l];if(nD(r[2*f],r[2*f+1],r[2*p],r[2*p+1],r[2*h],r[2*h+1],r[2*d],r[2*d+1])){t[e]=d,t[o]=f;const r=n[l];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===l){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,l);const s=u+(o+1)%3;i<Jk.length&&(Jk[i++]=s)}else{if(0===i)break;e=Jk[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function Qk(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function eD(e,t,n,r,i,a){const o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function tD(e,t,n,r,i,a){return(eD(i,a,e,t,n,r)||eD(e,t,n,r,i,a)||eD(n,r,i,a,e,t))<0}function nD(e,t,n,r,i,a,o,s){const u=e-o,c=t-s,l=n-o,f=r-s,p=i-o,h=a-s,d=l*l+f*f,m=p*p+h*h;return u*(f*m-d*h)-c*(l*m-d*p)+(u*u+c*c)*(l*h-f*p)<0}function rD(e,t,n,r,i,a){const o=n-e,s=r-t,u=i-e,c=a-t,l=o*o+s*s,f=u*u+c*c,p=.5/(o*c-s*u),h=(c*l-s*f)*p,d=(o*f-u*l)*p;return h*h+d*d}function iD(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;aD(e,n+r>>1,i),t[e[n]]>t[e[r]]&&aD(e,n,r),t[e[i]]>t[e[r]]&&aD(e,i,r),t[e[n]]>t[e[i]]&&aD(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;aD(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(iD(e,t,i,r),iD(e,t,n,a-1)):(iD(e,t,n,a-1),iD(e,t,i,r))}}function aD(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function oD(e){return e[0]}function sD(e){return e[1]}const uD=1e-6;class cD{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>uD||Math.abs(this._y1-i)>uD)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class lD{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class fD{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let t,r,a=0,o=0,s=n.length;a<s;a+=3,o+=2){const s=2*n[a],u=2*n[a+1],c=2*n[a+2],l=e[s],f=e[s+1],p=e[u],h=e[u+1],d=e[c],m=e[c+1],g=p-l,v=h-f,y=d-l,b=m-f,x=g*g+v*v,w=y*y+b*b,E=2*(g*b-v*y);if(E)if(Math.abs(E)<1e-8)t=(l+d)/2,r=(f+m)/2;else{const e=1/E;t=l+(b*x-v*w)*e,r=f+(g*w-y*x)*e}else t=(l+d)/2-1e8*b,r=(f+m)/2+1e8*y;i[o]=t,i[o+1]=r}let a,o,s,u=t[t.length-1],c=4*u,l=e[2*u],f=e[2*u+1];r.fill(0);for(let n=0;n<t.length;++n)u=t[n],a=c,o=l,s=f,c=4*u,l=e[2*u],f=e[2*u+1],r[a+2]=r[c]=s-f,r[a+3]=r[c+1]=l-o}render(e){const t=null==e?e=new cD:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let t=0,r=n.length;t<r;++t){const r=n[t];if(r<t)continue;const i=2*Math.floor(t/3),o=2*Math.floor(r/3),s=a[i],u=a[i+1],c=a[o],l=a[o+1];this._renderSegment(s,u,c,l,e)}let s,u=i[i.length-1];for(let t=0;t<i.length;++t){s=u,u=i[t];const n=2*Math.floor(r[u]/3),c=a[n],l=a[n+1],f=4*s,p=this._project(c,l,o[f+2],o[f+3]);p&&this._renderSegment(c,l,p[0],p[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new cD:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new cD:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let e=2;e<i;e+=2)r[e]===r[e-2]&&r[e+1]===r[e-1]||t.lineTo(r[e],r[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new lD;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]==e[a]&&t[r+1]==e[a+1]&&t[(r+2)%i]==e[(a+o-2)%o]&&t[(r+3)%i]==e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r,i,a,o,s,u=null,c=t[n-2],l=t[n-1],f=this._regioncode(c,l);for(let p=0;p<n;p+=2)if(r=c,i=l,c=t[p],l=t[p+1],a=f,f=this._regioncode(c,l),0===a&&0===f)o=s,s=0,u?u.push(c,l):u=[c,l];else{let t,n,p,h,d;if(0===a){if(null===(t=this._clipSegment(r,i,c,l,a,f)))continue;[n,p,h,d]=t}else{if(null===(t=this._clipSegment(c,l,r,i,f,a)))continue;[h,d,n,p]=t,o=s,s=this._edgecode(n,p),o&&s&&this._edge(e,o,s,u,u.length),u?u.push(n,p):u=[n,p]}o=s,s=this._edgecode(h,d),o&&s&&this._edge(e,o,s,u,u.length),u?u.push(h,d):u=[h,d]}if(u)o=s,s=this._edgecode(u[0],u[1]),o&&s&&this._edge(e,o,s,u,u.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return u}_clipSegment(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;let o,s,u=i||a;8&u?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):4&u?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):2&u?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?(e=o,t=s,i=this._regioncode(e,t)):(n=o,r=s,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let t,n=0,r=s.length,i=this._edgecode(s[r-2],s[r-1]);n<r;n+=2)t=i,i=this._edgecode(s[n],s[n+1]),t&&i&&(n=this._edge(e,t,i,s,n),r=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let e=0;e<r.length;e+=2){const t=(e+2)%r.length,n=(e+4)%r.length;(r[e]===r[t]&&r[t]===r[n]||r[e+1]===r[t+1]&&r[t+1]===r[n+1])&&(r.splice(t,2),e-=2)}return i}_project(e,t,n,r){let i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const pD=2*Math.PI,hD=Math.pow;function dD(e){return e[0]}function mD(e){return e[1]}function gD(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class vD{static from(e,t=dD,n=mD,r){return new vD("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=e[o];a[2*o]=t.call(r,i,o,e),a[2*o+1]=n.call(r,i,o,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new Zk(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){const r=2*t[e],i=2*t[e+1],a=2*t[e+2];if((n[a]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},((e,t)=>t)).sort(((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]));const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let e=0,n=t.length/2;e<n;++e){const n=gD(t[2*e],t[2*e+1],i);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new Zk(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){const t=i[e%3==2?e-2:e+1];-1!==n[e]&&-1!==a[t]||(a[t]=e)}for(let e=0,t=r.length;e<t;++e)o[r[e]]=e;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(e){return new fD(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let u=s,c=-1;do{if(yield c=a[u],u=u%3==2?u-2:u+1,a[u]!==e)return;if(u=i[u],-1===u){const t=n[(r[e]+1)%n.length];return void(t!==c&&(yield t))}}while(u!==s)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:u}=this;if(-1===r[e]||!u.length)return(e+1)%(u.length>>1);let c=e,l=hD(t-u[2*e],2)+hD(n-u[2*e+1],2);const f=r[e];let p=f;do{let r=s[p];const f=hD(t-u[2*r],2)+hD(n-u[2*r+1],2);if(f<l&&(l=f,c=r),p=p%3==2?p-2:p+1,s[p]!==e)break;if(p=o[p],-1===p){if(p=i[(a[e]+1)%i.length],p!==r&&hD(t-u[2*p],2)+hD(n-u[2*p+1],2)<l)return p;break}}while(p!==f);return c}render(e){const t=null==e?e=new cD:void 0,{points:n,halfedges:r,triangles:i}=this;for(let t=0,a=r.length;t<a;++t){const a=r[t];if(a<t)continue;const o=2*i[t],s=2*i[a];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new cD:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],a=r[n+1];e.moveTo(i+t,a),e.arc(i,a,t,0,pD)}return n&&n.value()}renderHull(e){const t=null==e?e=new cD:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let t=1;t<a;++t){const i=2*n[t];e.lineTo(r[i],r[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new lD;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new cD:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new lD;return this.renderTriangle(e,t),t.value()}}function yD(e){ms.call(this,null,e)}yD.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const bD=[-1e5,-1e5,1e5,1e5];function xD(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}ft(yD,ms,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:bD;const a=this.value=vD.from(r,e.x,e.y).voronoi(i);for(let e=0,t=r.length;e<t;++e){const t=a.cellPolygon(e);r[e][n]=t?xD(t):null}return t.reflow(e.modified()).modifies(n)}});var wD=Math.PI/180,ED=2048;function CD(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,2048/a,ED/a);var o,s,u,c,l,f=0,p=0,h=0,d=n.length;for(--r;++r<d;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,u=t.size<<1,t.rotate){var m=Math.sin(t.rotate*wD),g=Math.cos(t.rotate*wD),v=o*g,y=o*m,b=u*g,x=u*m;o=Math.max(Math.abs(v+x),Math.abs(v-x))+31>>5<<5,u=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else o=o+31>>5<<5;if(u>h&&(h=u),f+o>=2048&&(f=0,p+=h,h=0),p+u>=ED)break;i.translate((f+(o>>1))/a,(p+(u>>1))/a),t.rotate&&i.rotate(t.rotate*wD),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=u,t.xoff=f,t.yoff=p,t.x1=o>>1,t.y1=u>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=o}for(var w=i.getImageData(0,0,2048/a,ED/a).data,E=[];--r>=0;)if((t=n[r]).hasText){for(s=(o=t.width)>>5,u=t.y1-t.y0,c=0;c<u*s;c++)E[c]=0;if(null==(f=t.xoff))return;p=t.yoff;var C=0,S=-1;for(l=0;l<u;l++){for(c=0;c<o;c++){var N=s*l+(c>>5),A=w[2048*(p+l)+(f+c)<<2]?1<<31-c%32:0;E[N]|=A,C|=A}C?S=l:(t.y0++,u--,l--,p++)}t.y1=t.y0+S,t.sprite=E.slice(0,(t.y1-t.y0)*s)}}}function SD(e,t,n){n>>=5;for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,u=32-s,c=e.y1-e.y0,l=(e.y+e.y0)*n+(o>>5),f=0;f<c;f++){r=0;for(var p=0;p<=a;p++)if((r<<u|(p<a?(r=i[f*a+p])>>>s:0))&t[l+p])return!0;l+=n}return!1}function ND(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function AD(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function kD(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function DD(e){return"function"==typeof e?e:function(){return e}}var _D={archimedean:kD,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const MD=["x","y","font","fontSize","fontStyle","fontWeight","angle"],TD=["text","font","rotate","fontSize","fontStyle","fontWeight"];function OD(e){ms.call(this,function(){var e,t,n,r,i,a,o,s=[256,256],u=kD,c=[],l=Math.random,f={};function p(e,t,n){for(var r,i,a,o=t.x,c=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),p=u(s),h=l()<.5?1:-1,d=-h;(r=p(d+=h))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(t.x=o+i,t.y=c+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1])&&(!n||!SD(t,e,s[0]))&&(!n||AD(t,n))){for(var m,g=t.sprite,v=t.width>>5,y=s[0]>>5,b=t.x-(v<<4),x=127&b,w=32-x,E=t.y1-t.y0,C=(t.y+t.y0)*y+(b>>5),S=0;S<E;S++){m=0;for(var N=0;N<=v;N++)e[C+N]|=m<<w|(N<v?(m=g[S*v+N])>>>x:0);C+=y}return t.sprite=null,!0}return!1}return f.layout=function(){for(var u=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=ED/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(uf()),f=function(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}((s[0]>>5)*s[1]),h=null,d=c.length,m=-1,g=[],v=c.map((s=>({text:e(s),font:t(s),style:r(s),weight:i(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}))).sort(((e,t)=>t.size-e.size));++m<d;){var y=v[m];y.x=s[0]*(l()+.5)>>1,y.y=s[1]*(l()+.5)>>1,CD(u,y,v,m),y.hasText&&p(f,y,h)&&(g.push(y),h?ND(h,y):h=[{x:y.x+y.x0,y:y.y+y.y0},{x:y.x+y.x1,y:y.y+y.y1}],y.x-=s[0]>>1,y.y-=s[1]>>1)}return g},f.words=function(e){return arguments.length?(c=e,f):c},f.size=function(e){return arguments.length?(s=[+e[0],+e[1]],f):s},f.font=function(e){return arguments.length?(t=DD(e),f):t},f.fontStyle=function(e){return arguments.length?(r=DD(e),f):r},f.fontWeight=function(e){return arguments.length?(i=DD(e),f):i},f.rotate=function(e){return arguments.length?(a=DD(e),f):a},f.text=function(t){return arguments.length?(e=DD(t),f):e},f.spiral=function(e){return arguments.length?(u=_D[e]||e,f):u},f.fontSize=function(e){return arguments.length?(n=DD(e),f):n},f.padding=function(e){return arguments.length?(o=DD(e),f):o},f.random=function(e){return arguments.length?(l=e,f):l},f}(),e)}OD.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:MD}]},ft(OD,ms,{transform(e,t){!e.size||e.size[0]&&e.size[1]||oe("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||TD.some((function(n){const r=e[n];return Xe(r)&&t.modified(r.fields)}))))return;const r=t.materialize(t.SOURCE).source,i=this.value,a=e.as||MD;let o,s=e.fontSize||14;if(Xe(s)?o=e.fontSizeRange:s=tt(s),o){const e=s,t=Fd("sqrt")().domain(it(r,e)).range(o);s=n=>t(e(n))}r.forEach((e=>{e[a[0]]=NaN,e[a[1]]=NaN,e[a[3]]=0}));const u=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(Os).layout(),c=i.size(),l=c[0]>>1,f=c[1]>>1,p=u.length;for(let e,t,n=0;n<p;++n)e=u[n],t=e.datum,t[a[0]]=e.x+l,t[a[1]]=e.y+f,t[a[2]]=e.font,t[a[3]]=e.size,t[a[4]]=e.style,t[a[5]]=e.weight,t[a[6]]=e.rotate;return t.reflow(n).modifies(a)}});const ID=e=>new Uint8Array(e),FD=e=>new Uint16Array(e),RD=e=>new Uint32Array(e);function BD(e,t,n){const r=(t<257?ID:t<65537?FD:RD)(e);return n&&r.set(n),r}function zD(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],s=i[1],u=a.length;let c;for(c=0;c<o;++c)t[a[c]]|=r;for(c=s;c<u;++c)t[a[c]]|=r;return n}}}function PD(){let e=RD(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];const o=n,s=i.length,u=RD(s);let c,l,f,p=Array(s);for(f=0;f<s;++f)p[f]=r(i[f]),u[f]=f;if(p=function(e,t){return e.sort.call(t,((t,n)=>{const r=e[t],i=e[n];return r<i?-1:r>i?1:0})),function(e,t){return Array.from(t,(t=>e[t]))}(e,t)}(p,u),o)c=t,l=e,t=Array(o+s),e=RD(o+s),function(e,t,n,r,i,a,o,s,u){let c,l=0,f=0;for(c=0;l<r&&f<o;++c)t[l]<i[f]?(s[c]=t[l],u[c]=n[l++]):(s[c]=i[f],u[c]=a[f++]+e);for(;l<r;++l,++c)s[c]=t[l],u[c]=n[l];for(;f<o;++f,++c)s[c]=i[f],u[c]=a[f]+e}(a,c,l,o,p,u,s,t,e);else{if(a>0)for(f=0;f<s;++f)u[f]+=a;t=p,e=u}return n=o+s,{index:u,value:p}},remove:function(r,i){const a=n;let o,s,u;for(s=0;!i[e[s]]&&s<a;++s);for(u=s;s<a;++s)i[o=e[s]]||(e[u]=o,t[u]=t[s],++u);n=a-r},bisect:function(e,r){let i;return r?i=r.length:(r=t,i=n),[pf(r,e[0],0,i),ff(r,e[1],0,i)]},reindex:function(t){for(let r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:()=>e,size:()=>n}}function LD(e){ms.call(this,function(){let e=8,t=[],n=RD(0),r=BD(0,e),i=BD(0,e);return{data:()=>t,seen:()=>n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length),add(e){for(let n,r=0,i=t.length,a=e.length;r<a;++r)n=e[r],n._index=i++,t.push(n)},remove(e,n){const a=t.length,o=Array(a-e),s=t;let u,c,l;for(c=0;!n[c]&&c<a;++c)o[c]=t[c],s[c]=c;for(l=c;c<a;++c)u=t[c],n[c]?s[c]=-1:(s[c]=l,r[l]=r[c],i[l]=i[c],o[l]=u,u._index=l++),r[c]=0;return t=o,s},size:()=>t.length,curr:()=>r,prev:()=>i,reset:e=>i[e]=r[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){r[e]|=t},clear(e,t){r[e]&=~t},resize(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=BD(t,e,r),i=BD(t,e))}}}(),e),this._indices=null,this._dims=null}function jD(e){ms.call(this,null,e)}LD.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},ft(LD,ms,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some((e=>t.modified(e.fields)))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;let s,u,c=0;for(;c<o;++c)s=n[c].fname,u=i[s]||(i[s]=PD()),a.push(zD(u,c,r[c]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,u=s.curr(),c=s.prev(),l=s.all(),f=n.rem=n.add,p=n.mod,h=i.length,d={};let m,g,v,y,b,x,w,E,C;if(c.set(u),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(x={},y=t.mod,w=0,E=y.length;w<E;++w)x[y[w]._index]=1;for(w=0;w<h;++w)C=r[w],(!o[w]||e.modified("fields",w)||t.modified(C.fields))&&(v=C.fname,(m=d[v])||(a[v]=g=PD(),d[v]=m=g.insert(C,t.source,0)),o[w]=zD(g,w,i[w]).onAdd(m,u));for(w=0,E=s.data().length;w<E;++w)b[w]||(c[w]!==u[w]?f.push(w):x[w]&&u[w]!==l&&p.push(w));return s.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,u={},c=n.add,l=i.size()+r.length,f=a.length;let p,h,d,m=i.size();i.resize(l,f),i.add(r);const g=i.curr(),v=i.prev(),y=i.all();for(p=0;p<f;++p)h=s[p].fname,d=u[h]||(u[h]=o[h].insert(s[p],r,m)),a[p].onAdd(d,g);for(;m<l;++m)v[m]=y,g[m]!==y&&c.push(m)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;let s,u,c;for(s=0,u=o.length;s<u;++s)c=o[s]._index,i[c]!==a&&n.push(c)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),u={},c=n.rem,l=t.rem;let f,p,h,d;for(f=0,p=l.length;f<p;++f)h=l[f]._index,u[h]=1,o[h]=d=a[h],a[h]=s,d!==s&&c.push(h);for(h in r)r[h].remove(p,u);return this.reindex(t,p,u),u},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter((()=>{const e=i.remove(t,n);for(const t in r)r[t].reindex(e)}))},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,o=r.length;let s,u,c=0;for(n.filters=0,u=0;u<o;++u)e.modified("query",u)&&(s=u,++c);if(1===c)c=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(u=0,c=0;u<o;++u)e.modified("query",u)&&(c|=r[u].one,this.incrementAll(r[u],i[u],a,n.add),n.rem=n.add);return c},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),u=e.index(),c=e.bisect(e.range),l=e.bisect(t),f=l[0],p=l[1],h=c[0],d=c[1],m=e.one;let g,v,y;if(f<h)for(g=f,v=Math.min(h,p);g<v;++g)y=u[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;else if(f>h)for(g=h,v=Math.min(f,d);g<v;++g)y=u[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;if(p>d)for(g=Math.max(f,d),v=p;g<v;++g)y=u[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;else if(p<d)for(g=Math.max(h,p),v=d;g<v;++g)y=u[g],a[y]!==n&&(s[y]=o[y],a[y]=n,r.push(y)),o[y]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),a=e.index(),o=e.bisect(e.range),s=e.bisect(t),u=s[0],c=s[1],l=o[0],f=o[1],p=e.one;let h,d,m;if(u<l)for(h=u,d=Math.min(l,c);h<d;++h)m=a[h],i[m]^=p,n.push(m);else if(u>l)for(h=l,d=Math.min(u,f);h<d;++h)m=a[h],i[m]^=p,r.push(m);if(c>f)for(h=Math.max(u,f),d=c;h<d;++h)m=a[h],i[m]^=p,n.push(m);else if(c<f)for(h=Math.max(l,c),d=f;h<d;++h)m=a[h],i[m]^=p,r.push(m);e.range=t.slice()}}),jD.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},ft(jD,ms,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;const a=t.fork(t.ALL),o=r.data(),s=r.curr(),u=r.prev(),c=e=>s[e]&n?null:o[e];return a.filter(a.MOD,c),i&i-1?(a.filter(a.ADD,(e=>{const t=s[e]&n;return!t&&t^u[e]&n?o[e]:null})),a.filter(a.REM,(e=>{const t=s[e]&n;return!t||t^t^u[e]&n?null:o[e]}))):(a.filter(a.ADD,c),a.filter(a.REM,(e=>(s[e]&n)===i?o[e]:null))),a.filter(a.SOURCE,(e=>c(e._index)))}});const UD="Literal",qD="CallExpression";function WD(e){this.type=e}var VD,$D,HD,GD,KD;WD.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case qD:return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(VD={})[1]="Boolean",VD[2]="<end>",VD[3]="Identifier",VD[4]="Keyword",VD[5]="Null",VD[6]="Numeric",VD[7]="Punctuator",VD[8]="String",VD[9]="RegularExpression";var XD="Identifier",YD="Unexpected token %0",JD="Invalid regular expression",ZD="Invalid regular expression: missing /",QD="Octal literals are not allowed in strict mode.",e_="ILLEGAL",t_="Disabled.",n_=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),r_=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function i_(e,t){if(!e)throw new Error("ASSERT: "+t)}function a_(e){return e>=48&&e<=57}function o_(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function s_(e){return"01234567".indexOf(e)>=0}function u_(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function c_(e){return 10===e||13===e||8232===e||8233===e}function l_(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&n_.test(String.fromCharCode(e))}function f_(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&r_.test(String.fromCharCode(e))}const p_={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function h_(){for(;HD<GD;){const e=$D.charCodeAt(HD);if(!u_(e)&&!c_(e))break;++HD}}function d_(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)HD<GD&&o_($D[HD])?(r=$D[HD++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):D_({},YD,e_);return String.fromCharCode(i)}function m_(){var e,t,n,r;for(t=0,"}"===(e=$D[HD])&&D_({},YD,e_);HD<GD&&o_(e=$D[HD++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&D_({},YD,e_),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function g_(){var e,t;for(e=$D.charCodeAt(HD++),t=String.fromCharCode(e),92===e&&(117!==$D.charCodeAt(HD)&&D_({},YD,e_),++HD,(e=d_("u"))&&"\\"!==e&&l_(e.charCodeAt(0))||D_({},YD,e_),t=e);HD<GD&&f_(e=$D.charCodeAt(HD));)++HD,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==$D.charCodeAt(HD)&&D_({},YD,e_),++HD,(e=d_("u"))&&"\\"!==e&&f_(e.charCodeAt(0))||D_({},YD,e_),t+=e);return t}function v_(){var e,t,n,r,i=HD,a=$D.charCodeAt(HD),o=$D[HD];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++HD,{type:7,value:String.fromCharCode(a),start:i,end:HD};default:if(61===(e=$D.charCodeAt(HD+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return HD+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:HD};case 33:case 61:return HD+=2,61===$D.charCodeAt(HD)&&++HD,{type:7,value:$D.slice(i,HD),start:i,end:HD}}}return">>>="===(r=$D.substr(HD,4))?{type:7,value:r,start:i,end:HD+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:HD+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:HD+=2}:("//"===t&&D_({},YD,e_),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++HD}:void D_({},YD,e_))}function y_(){var e,t,n;if(i_(a_((n=$D[HD]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=HD,e="","."!==n){if(e=$D[HD++],n=$D[HD],"0"===e){if("x"===n||"X"===n)return++HD,function(e){let t="";for(;HD<GD&&o_($D[HD]);)t+=$D[HD++];return 0===t.length&&D_({},YD,e_),l_($D.charCodeAt(HD))&&D_({},YD,e_),{type:6,value:parseInt("0x"+t,16),start:e,end:HD}}(t);if(s_(n))return function(e){let t="0"+$D[HD++];for(;HD<GD&&s_($D[HD]);)t+=$D[HD++];return(l_($D.charCodeAt(HD))||a_($D.charCodeAt(HD)))&&D_({},YD,e_),{type:6,value:parseInt(t,8),octal:!0,start:e,end:HD}}(t);n&&a_(n.charCodeAt(0))&&D_({},YD,e_)}for(;a_($D.charCodeAt(HD));)e+=$D[HD++];n=$D[HD]}if("."===n){for(e+=$D[HD++];a_($D.charCodeAt(HD));)e+=$D[HD++];n=$D[HD]}if("e"===n||"E"===n)if(e+=$D[HD++],"+"!==(n=$D[HD])&&"-"!==n||(e+=$D[HD++]),a_($D.charCodeAt(HD)))for(;a_($D.charCodeAt(HD));)e+=$D[HD++];else D_({},YD,e_);return l_($D.charCodeAt(HD))&&D_({},YD,e_),{type:6,value:parseFloat(e),start:t,end:HD}}function b_(){if(h_(),HD>=GD)return{type:2,start:HD,end:HD};const e=$D.charCodeAt(HD);return l_(e)?function(){var e,t;return e=HD,t=92===$D.charCodeAt(HD)?g_():function(){var e,t;for(e=HD++;HD<GD;){if(92===(t=$D.charCodeAt(HD)))return HD=e,g_();if(!f_(t))break;++HD}return $D.slice(e,HD)}(),{type:1===t.length?3:p_.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:HD}}():40===e||41===e||59===e?v_():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(i_("'"===(e=$D[HD])||'"'===e,"String literal must starts with a quote"),t=HD,++HD;HD<GD;){if((n=$D[HD++])===e){e="";break}if("\\"===n)if((n=$D[HD++])&&c_(n.charCodeAt(0)))"\r"===n&&"\n"===$D[HD]&&++HD;else switch(n){case"u":case"x":"{"===$D[HD]?(++HD,i+=m_()):i+=d_(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:s_(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),HD<GD&&s_($D[HD])&&(a=!0,r=8*r+"01234567".indexOf($D[HD++]),"0123".indexOf(n)>=0&&HD<GD&&s_($D[HD])&&(r=8*r+"01234567".indexOf($D[HD++]))),i+=String.fromCharCode(r)):i+=n}else{if(c_(n.charCodeAt(0)))break;i+=n}}return""!==e&&D_({},YD,e_),{type:8,value:i,octal:a,start:t,end:HD}}():46===e?a_($D.charCodeAt(HD+1))?y_():v_():a_(e)?y_():v_()}function x_(){const e=KD;return HD=e.end,KD=b_(),HD=e.end,e}function w_(){const e=HD;KD=b_(),HD=e}function E_(e,t,n){const r=new WD("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function C_(e,t){const n=new WD("CallExpression");return n.callee=e,n.arguments=t,n}function S_(e){const t=new WD(XD);return t.name=e,t}function N_(e){const t=new WD("Literal");return t.value=e.value,t.raw=$D.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function A_(e,t,n){const r=new WD("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function k_(e,t,n){const r=new WD("Property");return r.key=t,r.value=n,r.kind=e,r}function D_(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,((e,t)=>(i_(t<r.length,"Message reference must be in range"),r[t])));throw(n=new Error(i)).index=HD,n.description=i,n}function __(e){2===e.type&&D_(e,"Unexpected end of input"),6===e.type&&D_(e,"Unexpected number"),8===e.type&&D_(e,"Unexpected string"),3===e.type&&D_(e,"Unexpected identifier"),4===e.type&&D_(e,"Unexpected reserved word"),D_(e,YD,e.value)}function M_(e){const t=x_();7===t.type&&t.value===e||__(t)}function T_(e){return 7===KD.type&&KD.value===e}function O_(e){return 4===KD.type&&KD.value===e}function I_(){HD=KD.start;const e=x_();return 8===e.type||6===e.type?(e.octal&&D_(e,QD),N_(e)):S_(e.value)}function F_(){var e,t,n;return HD=KD.start,3===(e=KD).type?(n=I_(),M_(":"),k_("init",n,q_())):2!==e.type&&7!==e.type?(t=I_(),M_(":"),k_("init",t,q_())):void __(e)}const R_={if:1};function B_(){var e,t,n;if(T_("("))return function(){M_("(");const e=W_();return M_(")"),e}();if(T_("["))return function(){const e=[];for(HD=KD.start,M_("[");!T_("]");)T_(",")?(x_(),e.push(null)):(e.push(q_()),T_("]")||M_(","));return x_(),function(e){const t=new WD("ArrayExpression");return t.elements=e,t}(e)}();if(T_("{"))return function(){var e,t,n=[],r={},i=String;for(HD=KD.start,M_("{");!T_("}");)t="$"+((e=F_()).key.type===XD?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?D_({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),T_("}")||M_(",");return M_("}"),function(e){const t=new WD("ObjectExpression");return t.properties=e,t}(n)}();if(e=KD.type,HD=KD.start,3===e||R_[KD.value])n=S_(x_().value);else if(8===e||6===e)KD.octal&&D_(KD,QD),n=N_(x_());else{if(4===e)throw new Error(t_);1===e?((t=x_()).value="true"===t.value,n=N_(t)):5===e?((t=x_()).value=null,n=N_(t)):T_("/")||T_("/=")?(n=N_(function(){var e,t,n,r;return KD=null,h_(),e=HD,t=function(){var e,t,n,r;for(i_("/"===(e=$D[HD]),"Regular expression literal must start with a slash"),t=$D[HD++],n=!1,r=!1;HD<GD;)if(t+=e=$D[HD++],"\\"===e)c_((e=$D[HD++]).charCodeAt(0))&&D_({},ZD),t+=e;else if(c_(e.charCodeAt(0)))D_({},ZD);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||D_({},ZD),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";HD<GD&&f_((e=$D[HD]).charCodeAt(0));)++HD,"\\"===e&&HD<GD?D_({},YD,e_):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&D_({},JD,n),{value:n,literal:t}}(),r=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";D_({},JD)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){D_({},JD)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:HD}}()),w_()):__(x_())}return n}function z_(){const e=[];if(M_("("),!T_(")"))for(;HD<GD&&(e.push(q_()),!T_(")"));)M_(",");return M_(")"),e}function P_(){M_("[");const e=W_();return M_("]"),e}function L_(){const e=function(){var e;for(e=B_();;)if(T_("."))e=A_(".",e,(M_("."),function(){HD=KD.start;const e=x_();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||__(e),S_(e.value)}()));else if(T_("("))e=C_(e,z_());else{if(!T_("["))break;e=A_("[",e,P_())}return e}();if(7===KD.type&&(T_("++")||T_("--")))throw new Error(t_);return e}function j_(){var e,t;if(7!==KD.type&&4!==KD.type)t=L_();else{if(T_("++")||T_("--"))throw new Error(t_);if(T_("+")||T_("-")||T_("~")||T_("!"))e=x_(),t=j_(),t=function(e,t){const n=new WD("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(O_("delete")||O_("void")||O_("typeof"))throw new Error(t_);t=L_()}}return t}function U_(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function q_(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,u,c;if(e=KD,u=j_(),0===(i=U_(r=KD)))return u;for(r.prec=i,x_(),t=[e,KD],a=[u,r,o=j_()];(i=U_(KD))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,u=a.pop(),t.pop(),n=E_(s,u,o),a.push(n);(r=x_()).prec=i,a.push(r),t.push(KD),n=j_(),a.push(n)}for(n=a[c=a.length-1],t.pop();c>1;)t.pop(),n=E_(a[c-1].value,a[c-2],n),c-=2;return n}(),T_("?")&&(x_(),t=q_(),M_(":"),e=function(e,t,n){const r=new WD("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,q_())),e}function W_(){const e=q_();if(T_(","))throw new Error(t_);return e}var V_={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function $_(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&oe("Missing arguments to clamp function."),t.length>3&&oe("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&oe("Missing arguments to if function."),t.length>3&&oe("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}var H_,G_,K_,X_,Y_,J_,Z_,Q_,eM,tM,nM,rM,iM,aM,oM,sM,uM=new Pw,cM=new Pw,lM={point:uE,lineStart:uE,lineEnd:uE,polygonStart:function(){uM=new Pw,lM.lineStart=fM,lM.lineEnd=pM},polygonEnd:function(){var e=+uM;cM.add(e<0?Vw+e:e),this.lineStart=this.lineEnd=this.point=uE},sphere:function(){cM.add(Vw)}};function fM(){lM.point=hM}function pM(){dM(H_,G_)}function hM(e,t){lM.point=dM,H_=e,G_=t,K_=e*=Hw,X_=Yw(t=(t*=Hw)/2+Ww),Y_=nE(t)}function dM(e,t){var n=(e*=Hw)-K_,r=n>=0?1:-1,i=r*n,a=Yw(t=(t*=Hw)/2+Ww),o=nE(t),s=Y_*o,u=X_*a+s*Yw(i),c=s*r*nE(i);uM.add(Xw(c,u)),K_=e,X_=a,Y_=o}var mM,gM,vM,yM,bM,xM,wM,EM,CM,SM,NM,AM,kM,DM,_M,MM,TM={point:OM,lineStart:FM,lineEnd:RM,polygonStart:function(){TM.point=BM,TM.lineStart=zM,TM.lineEnd=PM,aM=new Pw,lM.polygonStart()},polygonEnd:function(){lM.polygonEnd(),TM.point=OM,TM.lineStart=FM,TM.lineEnd=RM,uM<0?(J_=-(Q_=180),Z_=-(eM=90)):aM>Lw?eM=90:aM<-1e-6&&(Z_=-90),sM[0]=J_,sM[1]=Q_},sphere:function(){J_=-(Q_=180),Z_=-(eM=90)}};function OM(e,t){oM.push(sM=[J_=e,Q_=e]),t<Z_&&(Z_=t),t>eM&&(eM=t)}function IM(e,t){var n=vC([e*Hw,t*Hw]);if(iM){var r=bC(iM,n),i=bC([r[1],-r[0],0],r);EC(i),i=gC(i);var a,o=e-tM,s=o>0?1:-1,u=i[0]*$w*s,c=Gw(o)>180;c^(s*tM<u&&u<s*e)?(a=i[1]*$w)>eM&&(eM=a):c^(s*tM<(u=(u+360)%360-180)&&u<s*e)?(a=-i[1]*$w)<Z_&&(Z_=a):(t<Z_&&(Z_=t),t>eM&&(eM=t)),c?e<tM?LM(J_,e)>LM(J_,Q_)&&(Q_=e):LM(e,Q_)>LM(J_,Q_)&&(J_=e):Q_>=J_?(e<J_&&(J_=e),e>Q_&&(Q_=e)):e>tM?LM(J_,e)>LM(J_,Q_)&&(Q_=e):LM(e,Q_)>LM(J_,Q_)&&(J_=e)}else oM.push(sM=[J_=e,Q_=e]);t<Z_&&(Z_=t),t>eM&&(eM=t),iM=n,tM=e}function FM(){TM.point=IM}function RM(){sM[0]=J_,sM[1]=Q_,TM.point=OM,iM=null}function BM(e,t){if(iM){var n=e-tM;aM.add(Gw(n)>180?n+(n>0?360:-360):n)}else nM=e,rM=t;lM.point(e,t),IM(e,t)}function zM(){lM.lineStart()}function PM(){BM(nM,rM),lM.lineEnd(),Gw(aM)>Lw&&(J_=-(Q_=180)),sM[0]=J_,sM[1]=Q_,iM=null}function LM(e,t){return(t-=e)<0?t+360:t}function jM(e,t){return e[0]-t[0]}function UM(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var qM={sphere:uE,point:WM,lineStart:$M,lineEnd:KM,polygonStart:function(){qM.lineStart=XM,qM.lineEnd=YM},polygonEnd:function(){qM.lineStart=$M,qM.lineEnd=KM}};function WM(e,t){e*=Hw;var n=Yw(t*=Hw);VM(n*Yw(e),n*nE(e),nE(t))}function VM(e,t,n){++mM,vM+=(e-vM)/mM,yM+=(t-yM)/mM,bM+=(n-bM)/mM}function $M(){qM.point=HM}function HM(e,t){e*=Hw;var n=Yw(t*=Hw);DM=n*Yw(e),_M=n*nE(e),MM=nE(t),qM.point=GM,VM(DM,_M,MM)}function GM(e,t){e*=Hw;var n=Yw(t*=Hw),r=n*Yw(e),i=n*nE(e),a=nE(t),o=Xw(iE((o=_M*a-MM*i)*o+(o=MM*r-DM*a)*o+(o=DM*i-_M*r)*o),DM*r+_M*i+MM*a);gM+=o,xM+=o*(DM+(DM=r)),wM+=o*(_M+(_M=i)),EM+=o*(MM+(MM=a)),VM(DM,_M,MM)}function KM(){qM.point=WM}function XM(){qM.point=JM}function YM(){ZM(AM,kM),qM.point=WM}function JM(e,t){AM=e,kM=t,e*=Hw,t*=Hw,qM.point=ZM;var n=Yw(t);DM=n*Yw(e),_M=n*nE(e),MM=nE(t),VM(DM,_M,MM)}function ZM(e,t){e*=Hw;var n=Yw(t*=Hw),r=n*Yw(e),i=n*nE(e),a=nE(t),o=_M*a-MM*i,s=MM*r-DM*a,u=DM*i-_M*r,c=Qw(o,s,u),l=sE(c),f=c&&-l/c;CM.add(f*o),SM.add(f*s),NM.add(f*u),gM+=l,xM+=l*(DM+(DM=r)),wM+=l*(_M+(_M=i)),EM+=l*(MM+(MM=a)),VM(DM,_M,MM)}var QM;(QM={})[1]="Boolean",QM[2]="<end>",QM[3]="Identifier",QM[4]="Keyword",QM[5]="Null",QM[6]="Numeric",QM[7]="Punctuator",QM[8]="String",QM[9]="RegularExpression";const eT="intersect",tT="union",nT="index:unit";function rT(e,t){for(var n,r,i=t.fields,a=t.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=ue.getter||ue(r.field),dt(n=r.getter(e))&&(n=_e(n)),dt(a[s])&&(a[s]=_e(a[s])),dt(a[s][0])&&(a[s]=a[s].map(_e)),"E"===r.type){if(Ee(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if("R"===r.type){if(!pt(n,a[s]))return!1}else if("R-RE"===r.type){if(!pt(n,a[s],!0,!1))return!1}else if("R-E"===r.type){if(!pt(n,a[s],!1,!1))return!1}else if("R-LE"===r.type&&!pt(n,a[s],!1,!0))return!1;return!0}const iT=ue("_vgsid_"),aT=function(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}(iT),oT=aT.left,sT=aT.right;var uT={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=_e(t[0]),r=_e(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=_e(t[0]),r=_e(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function cT(e,t,n,r){"Literal"!==t[0].type&&oe("First argument to selection functions must be a string literal.");const i=t[0].value,a=":"+i;(t.length>=2&&De(t).value)!==eT||st(r,"@unit")||(r["@unit"]=n.getData(i).indataRef(n,"unit")),st(r,a)||(r[a]=n.getData(i).tuplesRef())}function lT(e){const t=this.context.data[e];return t?t.values.value:[]}const fT=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},pT=fT("format"),hT=fT("timeFormat"),dT=fT("utcFormat"),mT=fT("timeParse"),gT=fT("utcParse"),vT=new Date(2e3,0,1);function yT(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(vT.setYear(2e3),vT.setMonth(e),vT.setDate(t),hT.call(this,vT,n)):""}function bT(e,t,n,r){t[0].type!==UD&&oe("First argument to data functions must be a string literal.");const i=t[0].value,a=":"+i;if(!st(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(e){}}function xT(e,t,n,r){if(t[0].type===UD)wT(n,r,t[0].value);else for(e in n.scales)wT(n,r,e)}function wT(e,t,n){const r="%"+n;if(!st(t,r))try{t[r]=e.scaleRef(n)}catch(e){}}function ET(e,t){let n;return Xe(e)?e:yt(e)?(n=t.scales[e])&&n.value:void 0}function CT(e,t){return function(n,r,i){if(n){const t=ET(n,(i||this).context);return t&&t.path[e](r)}return t(r)}}const ST=CT("area",(function(e){return cM=new Pw,zw(e,lM),2*cM})),NT=CT("bounds",(function(e){var t,n,r,i,a,o,s;if(eM=Q_=-(J_=Z_=1/0),oM=[],zw(e,TM),n=oM.length){for(oM.sort(jM),t=1,a=[r=oM[0]];t<n;++t)UM(r,(i=oM[t])[0])||UM(r,i[1])?(LM(r[0],i[1])>LM(r[0],r[1])&&(r[1]=i[1]),LM(i[0],r[1])>LM(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)i=a[t],(s=LM(r[1],i[0]))>o&&(o=s,J_=i[0],Q_=r[1])}return oM=sM=null,J_===1/0||Z_===1/0?[[NaN,NaN],[NaN,NaN]]:[[J_,Z_],[Q_,eM]]})),AT=CT("centroid",(function(e){mM=gM=vM=yM=bM=xM=wM=EM=0,CM=new Pw,SM=new Pw,NM=new Pw,zw(e,qM);var t=+CM,n=+SM,r=+NM,i=Qw(t,n,r);return i<jw&&(t=xM,n=wM,r=EM,gM<Lw&&(t=vM,n=yM,r=bM),(i=Qw(t,n,r))<jw)?[NaN,NaN]:[Xw(n,t)*$w,sE(r/i)*$w]}));function kT(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function DT(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function _T(e){const t=qf(e);return.2126*DT(t.r)+.7152*DT(t.g)+.0722*DT(t.b)}function MT(e,t){return e===t||e!=e&&t!=t||(Ee(e)?!(!Ee(t)||e.length!==t.length)&&function(e,t){for(let n=0,r=e.length;n<r;++n)if(!MT(e[n],t[n]))return!1;return!0}(e,t):!(!Ce(e)||!Ce(t))&&TT(e,t))}function TT(e,t){for(const n in e)if(!MT(e[n],t[n]))return!1;return!0}function OT(e){return t=>TT(e,t)}const IT={};function FT(e){return Ee(e)||ArrayBuffer.isView(e)?e:null}function RT(e){return FT(e)||(yt(e)?e:null)}const BT=e=>e.data;function zT(e,t){const n=lT.call(t,e);return n.root&&n.root.lookup||{}}const PT=()=>"undefined"!=typeof window&&window||null,LT={random:()=>Os(),cumulativeNormal:Ws,cumulativeLogNormal:Xs,cumulativeUniform:tu,densityNormal:qs,densityLogNormal:Ks,densityUniform:eu,quantileNormal:Vs,quantileLogNormal:Ys,quantileUniform:nu,sampleNormal:Us,sampleLogNormal:Gs,sampleUniform:Qs,isArray:Ee,isBoolean:ht,isDate:dt,isDefined:e=>void 0!==e,isNumber:gt,isObject:Ce,isRegExp:vt,isString:yt,isTuple:Bo,isValid:e=>null!=e&&e==e,toBoolean:kt,toDate:_t,toNumber:_e,toString:Mt,indexof:function(e,...t){return RT(e).indexOf(...t)},join:function(e,...t){return FT(e).join(...t)},lastindexof:function(e,...t){return RT(e).lastIndexOf(...t)},replace:function(e,t,n){return Xe(n)&&oe("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return FT(e).slice().reverse()},slice:function(e,...t){return RT(e).slice(...t)},flush:lt,lerp:xt,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),rt(...e)},pad:St,peek:De,pluck:function(e,t){const n=IT[t]||(IT[t]=ue(t));return Ee(e)?e.map(n):n(e)},span:Nt,inrange:pt,truncate:Ot,rgb:qf,lab:Mh,hcl:zh,hsl:Xf,luminance:_T,contrast:function(e,t){const n=_T(e),r=_T(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:wu,format:pT,utcFormat:dT,utcParse:gT,utcOffset:ri,utcSequence:oi,timeFormat:hT,timeParse:mT,timeOffset:ni,timeSequence:ai,timeUnitSpecifier:Dr,monthFormat:function(e){return yT.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return yT.call(this,e,1,"%b")},dayFormat:function(e){return yT.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return yT.call(this,0,2+e,"%a")},quarter:$e,utcquarter:He,week:Or,utcweek:Pr,dayofyear:Tr,utcdayofyear:zr,warn:function(){return kT(this.context.dataflow,"warn",arguments)},info:function(){return kT(this.context.dataflow,"info",arguments)},debug:function(){return kT(this.context.dataflow,"debug",arguments)},extent:it,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,a=(new gg).set(r[0],r[1],i[0],i[1]);return qb(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=Ge(e.marktype),r=Ge(e.markname);t=e=>(!n.length||n.some((t=>e.marktype===t)))&&(!r.length||r.some((t=>e.name===t)))}return t}(t))},clampRange:Ke,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=PT();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=PT();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return ad(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(he).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?Lm(n,t=t||Dm(e)):e}},panLinear:Be,panLog:ze,panPow:Pe,panSymlog:Le,zoomLinear:Ue,zoomLog:qe,zoomPow:We,zoomSymlog:Ve,encode:function(e,t,n){if(e){const n=this.context.dataflow,r=e.mark.source;n.pulse(r,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){const o=this.context.dataflow,s=this.context.data[e],u=s.input,c=o.stamp();let l,f,p=s.changes;if(!1===o._trigger||!(u.value.length||t||r))return 0;if((!p||p.stamp<c)&&(s.changes=p=o.changeset(),p.stamp=c,o.runAfter((()=>{s.modified=!0,o.pulse(u,p).run()}),!0,1)),n&&(l=!0===n?he:Ee(n)||Bo(n)?n:OT(n),p.remove(l)),t&&p.insert(t),r&&(l=OT(r),u.value.some(l)?p.remove(l):p.insert(r)),i)for(f in a)p.modify(i,f,a[f]);return 1}},jT=["view","item","group","xy","x","y"],UT="this.",qT={},WT={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${At("$"+e)}]`,functions:function(e){const t=$_(e);jT.forEach((e=>t[e]="event.vega."+e));for(const e in LT)t[e]=UT+e;return rt(t,function(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=xT,n._range=xT,n._scale=xT;const r=t=>"_["+(t.type===UD?At("%"+t.value):At("%")+"+"+e(t))+"]";return{_bandwidth:e=>`this.__bandwidth(${r(e[0])})`,_range:e=>`${r(e[0])}.range()`,_scale:t=>`${r(t[0])}(${e(t[1])})`}}(e,LT,qT)),t},constants:V_,visitors:qT},VT=function(e){const t=(e=e||{}).allowed?Tt(e.allowed):{},n=e.forbidden?Tt(e.forbidden):{},r=e.constants||V_,i=(e.functions||$_)(f),a=e.globalvar,o=e.fieldvar,s=Xe(a)?a:e=>`${a}["${e}"]`;let u={},c={},l=0;function f(e){if(yt(e))return e;const t=p[e.type];return null==t&&oe("Unsupported type: "+e.type),t(e)}const p={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return l>0?i:st(n,i)?oe("Illegal identifier: "+i):st(r,i)?r[i]:st(t,i)?i:(u[i]=1,s(i))},MemberExpression:e=>{const t=!e.computed,n=f(e.object);t&&(l+=1);const r=f(e.property);return n===o&&(c[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(l-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&oe("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=st(i,t)&&i[t];return r||oe("Unrecognized function: "+t),Xe(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(f).join(",")+"]",BinaryExpression:e=>"("+f(e.left)+" "+e.operator+" "+f(e.right)+")",UnaryExpression:e=>"("+e.operator+f(e.argument)+")",ConditionalExpression:e=>"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")",LogicalExpression:e=>"("+f(e.left)+e.operator+f(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(f).join(",")+"}",Property:e=>{l+=1;const t=f(e.key);return l-=1,t+":"+f(e.value)}};function h(e){const t={code:f(e),globals:Object.keys(u),fields:Object.keys(c)};return u={},c={},t}return h.functions=i,h.constants=r,h}(WT);function $T(e,t,n){return 1===arguments.length?LT[e]:(LT[e]=t,n&&(qT[e]=n),VT&&(VT.functions[e]=UT+e),this)}function HT(e,t){const n={};let r;try{r=function(e){HD=0,GD=($D=e).length,KD=null,w_();const t=W_();if(2!==KD.type)throw new Error("Unexpect token after expression.");return t}(e=yt(e)?e:At(e)+"")}catch(t){oe("Expression parse error: "+e)}r.visit((e=>{if(e.type!==qD)return;const r=e.callee.name,i=WT.visitors[r];i&&i(r,e.arguments,t,n)}));const i=VT(r);return i.globals.forEach((e=>{const r="$"+e;!st(n,r)&&t.getSignal(e)&&(n[r]=t.signalRef(e))})),{$expr:rt({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}$T("bandwidth",(function(e,t){const n=ET(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),xT),$T("copy",(function(e,t){const n=ET(e,(t||this).context);return n?n.copy():void 0}),xT),$T("domain",(function(e,t){const n=ET(e,(t||this).context);return n?n.domain():[]}),xT),$T("range",(function(e,t){const n=ET(e,(t||this).context);return n&&n.range?n.range():[]}),xT),$T("invert",(function(e,t,n){const r=ET(e,(n||this).context);return r?Ee(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),xT),$T("scale",(function(e,t,n){const r=ET(e,(n||this).context);return r?r(t):void 0}),xT),$T("gradient",(function(e,t,n,r,i){e=ET(e,(i||this).context);const a=Cm(t,n);let o=e.domain(),s=o[0],u=De(o),c=le;return u-s?c=Gd(e,s,u):e=(e.interpolator?Fd("sequential")().interpolator(e.interpolator()):Fd("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,u=1]),e.ticks&&(o=e.ticks(+r||15),s!==o[0]&&o.unshift(s),u!==De(o)&&o.push(u)),o.forEach((t=>a.stop(c(t),e(t)))),a}),xT),$T("geoArea",ST,xT),$T("geoBounds",NT,xT),$T("geoCentroid",AT,xT),$T("geoShape",(function(e,t,n){const r=ET(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),xT),$T("indata",(function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==UD&&oe("First argument to indata must be a string literal."),t[1].type!==UD&&oe("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,o="@"+a;st(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),$T("data",lT,bT),$T("treePath",(function(e,t,n){const r=zT(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(BT):void 0}),bT),$T("treeAncestors",(function(e,t){const n=zT(e,this)[t];return n?n.ancestors().map(BT):void 0}),bT),$T("vlSelectionTest",(function(e,t,n){for(var r,i,a,o,s,u=this.context.data[e],c=u?u.values.value:[],l=u?u[nT]&&u[nT].value:void 0,f=n===eT,p=c.length,h=0;h<p;++h)if(r=c[h],l&&f){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(s=rT(t,r),i[o]=s?-1:++a,s&&1===l.size)return!0;if(!s&&a===l.get(o).count)return!1}else if(f^(s=rT(t,r)))return s;return p&&f}),cT),$T("vlSelectionIdTest",(function(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],a=r?r[nT]&&r[nT].value:void 0,o=n===eT,s=iT(t),u=oT(i,s);if(u===i.length)return!1;if(iT(i[u])!==s)return!1;if(a&&o){if(1===a.size)return!0;if(sT(i,s)-u<a.size)return!1}return!0}),cT),$T("vlSelectionResolve",(function(e,t,n,r){for(var i,a,o,s,u,c,l,f,p,h,d,m=this.context.data[e],g=m?m.values.value:[],v={},y={},b={},x=g.length,w=0;w<x;++w){for(s=(i=g[w]).unit,a=i.fields,o=i.values,h=0,d=a.length;h<d;++h)u=a[h],l=(c=v[u.field]||(v[u.field]={}))[s]||(c[s]=[]),b[u.field]=f=u.type.charAt(0),p=uT[f+"_union"],c[s]=p(l,Ge(o[h]));n&&(l=y[s]||(y[s]=[])).push(Ge(o).reduce(((e,t,n)=>(e[a[n].field]=t,e)),{}))}return t=t||tT,Object.keys(v).forEach((e=>{v[e]=Object.keys(v[e]).map((t=>v[e][t])).reduce(((n,r)=>void 0===n?r:uT[b[e]+"_"+t](n,r)))})),g=Object.keys(y),n&&g.length&&(v[r?"vlPoint":"vlMulti"]=t===tT?{or:g.reduce(((e,t)=>(e.push(...y[t]),e)),[])}:{and:g.map((e=>({or:y[e]})))}),v}),cT),$T("vlSelectionTuples",(function(e,t){return e.map((e=>rt({values:t.fields.map((t=>(t.getter||(t.getter=ue(t.field)))(e.datum)))},t)))}));const GT=Tt(["rule"]),KT=Tt(["group","image","rect"]);function XT(e){return(e+"").toLowerCase()}function YT(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var JT={operator:(e,t)=>YT(e,["_"],t.code),parameter:(e,t)=>YT(e,["datum","_"],t.code),event:(e,t)=>YT(e,["event"],t.code),handler:(e,t)=>YT(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const e in r){const t="o["+At(e)+"]";i+="$=".concat(r[e].code,";if(").concat(t,"!==$)").concat(t,"=$,m=1;")}return i+=function(e,t){let n="";return GT[t]||(e.x2&&(e.x?(KT[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(KT[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",YT(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(At).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map(((e,r)=>{const i=t[r];let a,o;return e.path?(a="a".concat(e.path),o="b".concat(e.path)):((n=n||{})["f"+r]=e,a="this.f".concat(r,"(a)"),o="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(a,o,-i,i)})).join("")+"0;");return n?r.bind(n):r}}};function ZT(e,t,n){if(!e||!Ce(e))return e;for(let r,i=0,a=QT.length;i<a;++i)if(r=QT[i],st(e,r.key))return r.parse(e,t,n);return e}var QT=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||oe("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=bt(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=ee(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=ue(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const e in n){const i=n[e];r[e]=ee(t.encodeExpression(i.$expr),i.$fields),r[e].output=i.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=Ge(e.$compare).map((e=>e&&e.$tupleid?zo:e));return t.fn[n]||(t.fn[n]=Ye(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,r,i){const a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(i),o.detachSubflow=()=>t.detach(a),o}}},{key:"$tupleid",parse:function(){return zo}}];const eO={skip:!0};function tO(e,t,n,r){return new nO(e,t,n,r)}function nO(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||JT,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function rO(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}function iO(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}nO.prototype=rO.prototype={fork(){const e=new rO(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter((t=>t!==e));const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),"collect"===XT(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let i=n.get(e.parent.$ref);i?(r.connect(i,[t]),t.targets().add(i)):(n.unresolved=n.unresolved||[]).push((()=>{i=n.get(e.parent.$ref),r.connect(i,[t]),t.targets().add(i)}))}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const r in e.data){const i=n.data[r]||(n.data[r]={});e.data[r].forEach((e=>i[e]=t))}},resolve(){return(this.unresolved||[]).forEach((e=>e())),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[XT(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach((e=>t.parseOperator(e))),n.forEach((e=>t.parseOperatorParameters(e))),(e.streams||[]).forEach((e=>t.parseStream(e))),(e.updates||[]).forEach((e=>t.parseUpdate(e))),t.resolve()},parseOperator:function(e){const t=this;"operator"!==XT(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||oe("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=Ee(i)?i.map((e=>ZT(e,n,t))):ZT(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map((e=>n.get(e))))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map((e=>n.get(e))),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&oe("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=this,r=Ce(r=e.source)?r.$ref:r,i=n.get(r),a=e.update,o=void 0;i||oe("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),a&&a.$expr&&(a.$params&&(o=n.parseParameters(a.$params)),a=n.handlerExpression(a.$expr)),n.update(e,i,t,a,o)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((n=>{const i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((n=>{const r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((t=>t.getState(e)))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((e=>{n.update(t.signals[e],i[e],eO)})),Object.keys(r||{}).forEach((e=>{n.pulse(t.data[e].input,n.changeset().remove(he).insert(r[e]))})),(e.subcontext||[]).forEach(((e,n)=>{const r=t.subcontext[n];r&&r.setState(e)}))}};const aO="default";function oO(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function sO(e,t){var n=e._runtime.data;return st(n,t)||oe("Unrecognized data set: "+t),n[t]}function uO(e,t){Vo(t)||oe("Second argument to changes must be a changeset.");const n=sO(this,e);return n.modified=!0,this.pulse(n.input,t)}function cO(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function lO(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function fO(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}const pO="view",hO={trap:!1};function dO(e,t,n,r){e._eventListeners.push({type:n,sources:Ge(t),handler:r})}function mO(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(!1===r||Ce(r)&&!r[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function gO(e){return e.item}function vO(e){return e.item.mark.source}function yO(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function bO(e,t,n){const r=document.createElement(e);for(const e in t)r.setAttribute(e,t[e]);return null!=n&&(r.textContent=n),r}function xO(e,t,n,r){const i=n.event||"input",a=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,a),dO(r,t,i,a),e.set=e=>{t.value=e,t.dispatchEvent(function(e){return"undefined"!=typeof Event?new Event(e):{type:e}}(i))}}function wO(e,t,n,r){const i=r.signal(n.signal),a=bO("div",{class:"vega-bind"}),o="radio"===n.input?a:a.appendChild(bO("label"));o.appendChild(bO("span",{class:"vega-bind-name"},n.name||n.signal)),t.appendChild(a);let s=EO;switch(n.input){case"checkbox":s=CO;break;case"select":s=SO;break;case"radio":s=NO;break;case"range":s=AO}s(e,o,n,i)}function EO(e,t,n,r){const i=bO("input");for(const e in n)"signal"!==e&&"element"!==e&&i.setAttribute("input"===e?"type":e,n[e]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",(()=>e.update(i.value))),e.elements=[i],e.set=e=>i.value=e}function CO(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=bO("input",i);t.appendChild(a),a.addEventListener("change",(()=>e.update(a.checked))),e.elements=[a],e.set=e=>a.checked=!!e||null}function SO(e,t,n,r){const i=bO("select",{name:n.signal}),a=n.labels||[];n.options.forEach(((e,t)=>{const n={value:e};kO(e,r)&&(n.selected=!0),i.appendChild(bO("option",n,(a[t]||e)+""))})),t.appendChild(i),i.addEventListener("change",(()=>{e.update(n.options[i.selectedIndex])})),e.elements=[i],e.set=e=>{for(let t=0,r=n.options.length;t<r;++t)if(kO(n.options[t],e))return void(i.selectedIndex=t)}}function NO(e,t,n,r){const i=bO("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map(((t,o)=>{const s={type:"radio",name:n.signal,value:t};kO(t,r)&&(s.checked=!0);const u=bO("input",s);u.addEventListener("change",(()=>e.update(t)));const c=bO("label",{},(a[o]||t)+"");return c.prepend(u),i.appendChild(c),u})),e.set=t=>{const n=e.elements,r=n.length;for(let e=0;e<r;++e)kO(n[e].value,t)&&(n[e].checked=!0)}}function AO(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||Qt(a,i,100),s=bO("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;const u=bO("span",{},+r);t.appendChild(s),t.appendChild(u);const c=()=>{u.textContent=s.value,e.update(+s.value)};s.addEventListener("input",c),s.addEventListener("change",c),e.elements=[s],e.set=e=>{s.value=e,u.textContent=e}}function kO(e,t){return e===t||e+""==t+""}function DO(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,cO(e),lO(e),fO(e),i,a).background(e.background())}function _O(e,t){return t?function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}:null}function MO(e,t,n){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const TO=e=>+e||0;function OO(e){return Ce(e)?{top:TO(e.top),bottom:TO(e.bottom),left:TO(e.left),right:TO(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(TO(e))}async function IO(e,t,n,r){const i=Ub(t),a=i&&i.headless;return a||oe("Unrecognized renderer type: "+t),await e.runAsync(),DO(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}var FO="padding",RO={skip:!0};function BO(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===FO?r.left+r.right:0)}function zO(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===FO?r.top+r.bottom:0)}function PO(e,t){return t.modified&&Ee(t.input.value)&&e.indexOf("_:vega:_")}function LO(e,t){return!("parent"===e||t instanceof gs.proxy)}function jO(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":Ee(e)?UO(e):Ce(e)&&!dt(e)?(t=e,Object.keys(t).map((e=>{const n=t[e];return e+": "+(Ee(n)?UO(n):qO(n))})).join("\n")):e+"";var t}(r))}function UO(e){return"["+e.map(qO).join(", ")+"]"}function qO(e){return Ee(e)?"[]":Ce(e)&&!dt(e)?"{}":e}function WO(e,t){const n=this;if(t=t||{},hs.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const r=rt({},e.locale,t.locale);n.locale(no(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||Lb.Canvas,n._scenegraph=new wy;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||jO,n._redraw=!0,n._handler=(new Gy).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=rt({defaults:{}},e),n=(e,t)=>{t.forEach((t=>{Ee(e[t])&&(e[t]=Tt(e[t]))}))};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(e,t,n){return tO(e,gs,LT,n).parse(t)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map((e=>({state:null,param:rt({},e)}))),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=BO(n,n._width),n._viewHeight=zO(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,r=t.height,i=t.padding;function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(t=>{e._width=t.size,e._viewWidth=BO(e,t.size),a()}),{size:n}),e._resizeHeight=e.add(null,(t=>{e._height=t.size,e._viewHeight=zO(e,t.size),a()}),{size:r});const o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(e){e.add(null,(t=>(e._background=t.bg,e._resize=1,t.bg)),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:aO,item:null}));e.on(e.events("view","mousemove"),t,((e,n)=>{const r=t.value,i=r?yt(r)?r:r.user:aO,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),e.add(null,(function(t){let n=t.cursor,r=this.value;return yt(n)||(r=n.item,n=n.user),oO(e,n&&n!==aO?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function VO(e,t){return st(e._signals,t)?e._signals[t]:oe("Unrecognized signal name: "+At(t))}function $O(e,t){const n=(e._targets||[]).filter((e=>e._update&&e._update.handler===t));return n.length?n[0]:null}function HO(e,t,n,r){let i=$O(n,r);return i||(i=_O(e,(()=>r(t,n.value))),i.handler=r,e.on(n,null,i)),e}function GO(e,t,n){const r=$O(t,n);return r&&t._targets.remove(r),e}ft(WO,hs,{async evaluate(e,t,n){if(await hs.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,i=fO(r=this),a=cO(r),o=lO(r),r._renderer.background(r.background()),r._renderer.resize(a,o,i),r._handler.origin(i),r._resizeListeners.forEach((e=>{try{e(a,o)}catch(e){r.error(e)}}))),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(e){this.error(e)}var r,i,a,o;return n&&Io(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&iO(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=VO(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",OO(e)):OO(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Ub(e)||oe("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(hs.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(VO(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter((o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal("width",n,RO),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal("height",r,RO),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter((e=>e.resize()))}),!1,1)},addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=_O(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return HO(this,e,VO(this,e),t)},removeSignalListener(e,t){return GO(this,VO(this,e),t)},addDataListener(e,t){return HO(this,e,sO(this,e).values,t)},removeDataListener(e,t){return GO(this,sO(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=oO(this,null);this._globalCursor=!!e,t&&oO(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var r=new KN,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?HN():+n,r._restart((function a(o){o+=i,r._restart(a,i+=t,n),e(o)}),t,n)},r.restart(e,t,n),r)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new Qo(n),o=function(n,r){i.runAsync(null,(()=>{e===pO&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(function(e,t,n){var r,i,a=e._renderer,o=a&&a.canvas();return o&&(i=fO(e),(r=Dy(t.changedTouches?t.changedTouches[0]:t,o))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;yt(e)&&(e=i(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:tt(e),item:tt(t||{}),group:i,xy:a,x:e=>a(e)[0],y:e=>a(e)[1]}}(e,n,r),t}(i,n,r))}))};if("timer"===e)mO(i,"timer",t)&&i.timer(o,t);else if(e===pO)mO(i,"view",t)&&i.addEventListener(t,o,hO);else if("window"===e?mO(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&mO(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var s=0,u=r.length;s<u;++s)r[s].addEventListener(t,o);dO(i,r,t,o)}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",gO),vO,yO(e)),this.on(this.events("view","mouseout",gO),vO,yO(t)),this},data:function(e,t){return arguments.length<2?sO(this,e).values.value:uO.call(this,e,$o().remove(he).insert(t))},change:uO,insert:function(e,t){return uO.call(this,e,$o().insert(t))},remove:function(e,t){return uO.call(this,e,$o().remove(t))},scale:function(e){var t=this._runtime.scales;return st(t,e)||oe("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=Ub(r);e=n._el=e?MO(n,e,!0):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),iO(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||Gy,s=e?a.renderer:a.headless;return n._renderer=s?DO(n,n._renderer,e,s):null,n._handler=function(e,t,n,r){const i=new r(e.loader(),_O(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,fO(e),e);return t&&t.handlers().forEach((e=>{i.on(e.type,e.handler)})),i}(n,n._handler,e,o),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=MO(n,t,!0):e.appendChild(bO("form",{class:"vega-bindings"})),n._bind.forEach((e=>{e.param.element&&"container"!==i&&(e.element=MO(n,e.param.element,!!e.param.input))})),n._bind.forEach((e=>{!function(e,t,n){if(!t)return;const r=n.param;let i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:t=>{t!=e.signal(r.signal)&&e.runAsync(null,(()=>{i.source=!0,e.signal(r.signal,t)}))}},r.debounce&&(i.update=nt(r.debounce,i.update))),(null==r.input&&r.element?xO:wO)(i,t,r,e),i.active||(e.on(e._signals[r.signal],null,(()=>{i.source?i.source=!1:i.set(e.signal(r.signal))})),i.active=!0)}(n,e.element||t,e)}))),n},toImageURL:async function(e,t){e!==Lb.Canvas&&e!==Lb.SVG&&e!==Lb.PNG&&oe("Unrecognized image type: "+e);const n=await IO(this,e,t);return e===Lb.SVG?function(e,t){const n=new Blob([e],{type:"image/svg+xml"});return window.URL.createObjectURL(n)}(n.svg()):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await IO(this,Lb.Canvas,e,t)).canvas()},toSVG:async function(e){return(await IO(this,Lb.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:PO,signals:LO,recurse:!0})},setState:function(e){return this.runAsync(null,(t=>{t._trigger=!1,t._runtime.setState(e)}),(e=>{e._trigger=!0})),this}});const KO=/[[\]{}]/,XO={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let YO,JO;function ZO(e,t,n,r,i){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;i&&i.indexOf(o)>=0?--s:r&&r.indexOf(o)>=0&&++s}return t}function QO(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=ZO(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function eI(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=ZO(e,r,"]","[","]"),r===t)throw"Empty between selector: "+e;if(n=QO(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(eI);const i=eI(e.slice(1).trim());return i.between?{between:n,stream:i}:(i.between=n,i)}(e):function(e){const t={source:YO},n=[];let r,i,a=[0,0],o=0,s=0,u=e.length,c=0;if("}"===e[u-1]){if(c=e.lastIndexOf("{"),!(c>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(c+1,u-1))}catch(t){throw"Invalid throttle specification: "+e}u=(e=e.slice(0,c).trim()).length,c=0}if(!u)throw e;if("@"===e[0]&&(o=++c),r=ZO(e,c,":"),r<u&&(n.push(e.substring(s,r).trim()),s=c=++r),c=ZO(e,c,"["),c===u)n.push(e.substring(s,u).trim());else if(n.push(e.substring(s,c).trim()),i=[],s=++c,s===u)throw"Unmatched left bracket: "+e;for(;c<u;){if(c=ZO(e,c,"]"),c===u)throw"Unmatched left bracket: "+e;if(i.push(e.substring(s,c).trim()),c<u-1&&"["!==e[++c])throw"Expected left bracket: "+e;s=++c}if(!(u=n.length)||KO.test(n[u-1]))throw"Invalid event selector: "+e;var l;return u>1?(t.type=n[1],o?t.markname=n[0].slice(1):(l=n[0],JO[l]?t.marktype=n[0]:t.source=n[0])):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=i&&(t.filter=i),a[0]&&(t.throttle=a[0]),a[1]&&(t.debounce=a[1]),t}(e)}function tI(e){return Ce(e)?e:{type:e||"pad"}}const nI=e=>+e||0;function rI(e){return Ce(e)?e.signal?e:{top:nI(e.top),bottom:nI(e.bottom),left:nI(e.left),right:nI(e.right)}:{top:t=nI(e),bottom:t,left:t,right:t};var t}const iI=e=>Ce(e)&&!Ee(e)?rt({},e):{value:e};function aI(e,t,n,r){return null!=n?(Ce(n)&&!Ee(n)||Ee(n)&&n.length&&Ce(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function oI(e,t,n){for(const n in t)aI(e,n,t[n]);for(const t in n)aI(e,t,n[t],"update")}function sI(e,t,n){for(const r in t)n&&st(n,r)||(e[r]=rt(e[r]||{},t[r]));return e}function uI(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const cI="mark",lI="frame",fI="scope",pI="legend-label";function hI(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const dI=e=>yt(e)?At(e):e.signal?`(${e.signal})`:yI(e);function mI(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map((e=>null==e?null:At(e)));for(;t.length&&null==De(t);)t.pop();return t.unshift(dI(e.gradient)),`gradient(${t.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(e){return e.c?gI("hcl",e.h,e.c,e.l):e.h||e.s?gI("hsl",e.h,e.s,e.l):e.l||e.a?gI("lab",e.l,e.a,e.b):e.r||e.g||e.b?gI("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?yI(e.field):void 0!==e.value?At(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=dI(e.scale);return null!=e.range?t=`lerp(_range(${n}), ${+e.range})`:(void 0!==t&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(1==+e.band?"":"*"+vI(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),null==t&&(t="0")),t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t=`pow(${t},${vI(e.exponent)})`),null!=e.mult&&(t+=`*${vI(e.mult)}`),null!=e.offset&&(t+=`+${vI(e.offset)}`),e.round&&(t=`round(${t})`),t}const gI=(e,t,n,r)=>`(${e}(${[t,n,r].map(mI).join(",")})+'')`;function vI(e){return Ce(e)?"("+mI(e)+")":e}function yI(e){return bI(Ce(e)?e:{datum:e})}function bI(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):oe("Invalid field reference: "+At(e));return e.signal||(r=yt(r)?se(r).map(At).join("]["):bI(r)),t+"["+r+"]"}function xI(e,t,n,r,i,a){const o={};(a=a||{}).encoders={$encode:o},e=function(e,t,n,r,i){const a={},o={};let s,u,c,l;for(u in u="lineBreak","text"!==t||null==i[u]||uI(u,e)||hI(a,u,i[u]),("legend"==n||String(n).startsWith("axis"))&&(n=null),l=n===lI?i.group:n===cI?rt({},i.mark,i[t]):null,l)c=uI(u,e)||("fill"===u||"stroke"===u)&&(uI("fill",e)||uI("stroke",e)),c||hI(a,u,l[u]);for(u in Ge(r).forEach((t=>{const n=i.style&&i.style[t];for(const t in n)uI(t,e)||hI(a,t,n[t])})),e=rt({},e),a)l=a[u],l.signal?(s=s||{})[u]=l:o[u]=l;return e.enter=rt(o,e.enter),s&&(e.update=rt(s,e.update)),e}(e,t,n,r,i.config);for(const n in e)o[n]=wI(e[n],t,a,i);return a}function wI(e,t,n,r){const i={},a={};for(const t in e)null!=e[t]&&(i[t]=EI((o=e[t],Ee(o)?function(e){let t="";return e.forEach((e=>{const n=mI(e);t+=e.test?`(${e.test})?${n}:`:n})),":"===De(t)&&(t+="null"),t}(o):mI(o)),r,n,a));var o;return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function EI(e,t,n,r){const i=HT(e,t);return i.$fields.forEach((e=>r[e]=1)),rt(n,i.$params),i.$expr}const CI=["value","update","init","react","bind"];function SI(e,t){oe(e+' for "outer" push: '+At(t))}function NI(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||SI("No prior signal definition",n),CI.forEach((t=>{void 0!==e[t]&&SI("Invalid property ",t)}));else{const r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function AI(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function kI(e,t,n,r){return new AI(e,t,n,r)}function DI(e,t){return kI("operator",e,t)}function _I(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function MI(e,t){return t?{$field:e,$name:t}:{$field:e}}const TI=MI("key");function OI(e,t){return{$compare:e,$order:t}}function II(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const FI="scope",RI="view";function BI(e){return e&&e.signal}function zI(e){if(BI(e))return!0;if(Ce(e))for(const t in e)if(zI(e[t]))return!0;return!1}function PI(e,t){return null!=e?e:t}function LI(e){return e&&e.signal||e}const jI="timer";function UI(e,t){return(e.merge?qI:e.stream?WI:e.type?VI:oe("Invalid stream specification: "+At(e)))(e,t)}function qI(e,t){const n=$I({merge:e.merge.map((e=>UI(e,t)))},e,t);return t.addStream(n).id}function WI(e,t){const n=$I({stream:UI(e.stream,t)},e,t);return t.addStream(n).id}function VI(e,t){let n;var r;e.type===jI?(n=t.event(jI,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((r=e.source)===FI?RI:r||RI,e.type);const i=$I({stream:n},e,t);return 1===Object.keys(i).length?n:t.addStream(i).id}function $I(e,t,n){let r=t.between;return r&&(2!==r.length&&oe('Stream "between" parameter must have 2 entries: '+At(t)),e.between=[UI(r[0],n),UI(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){const r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===FI&&r.push("inScope(event.item)"),r.length&&(e.filter=HT("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const HI={code:"_.$value",ast:{type:"Identifier",value:"value"}};function GI(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}const KI=e=>(t,n,r)=>kI(e,n,t||void 0,r),XI=KI("aggregate"),YI=KI("axisticks"),JI=KI("bound"),ZI=KI("collect"),QI=KI("compare"),eF=KI("datajoin"),tF=KI("encode"),nF=KI("expression"),rF=KI("facet"),iF=KI("field"),aF=KI("key"),oF=KI("legendentries"),sF=KI("load"),uF=KI("mark"),cF=KI("multiextent"),lF=KI("multivalues"),fF=KI("overlap"),pF=KI("params"),hF=KI("prefacet"),dF=KI("projection"),mF=KI("proxy"),gF=KI("relay"),vF=KI("render"),yF=KI("scale"),bF=KI("sieve"),xF=KI("sortitems"),wF=KI("viewlayout"),EF=KI("values");let CF=0;const SF={min:"min",max:"max",count:"sum"};function NF(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=_F(e.domain,e,t),null!=e.range&&(n.range=zF(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=AF(e.type||e),null!=e.gamma&&(t.interpolateGamma=AF(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e){return Ce(e)?{interval:AF(e.interval),step:AF(e.step)}:AF(e)}(e.nice)),null!=e.bins&&(n.bins=function(e,t){return e.signal||Ee(e)?kF(e,t):t.objectProperty(e)}(e.bins,t)),e)st(n,r)||"name"===r||(n[r]=AF(e[r],t))}function AF(e,t){return Ce(e)?e.signal?t.signalRef(e.signal):oe("Unsupported object: "+At(e)):e}function kF(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>AF(e,t)))}function DF(e){oe("Can not find data set: "+At(e))}function _F(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Ee(e)?MF:e.fields?OF:TF)(e,t,n);null==t.domainMin&&null==t.domainMax||oe("No scale domain defined for domainMin/domainMax to override.")}function MF(e,t,n){return e.map((e=>AF(e,n)))}function TF(e,t,n){const r=n.getData(e.data);return r||DF(e.data),Pd(t.type)?r.valuesRef(n,e.field,FF(e.sort,!1)):qd(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function OF(e,t,n){const r=e.data,i=e.fields.reduce(((e,t)=>(t=yt(t)?{data:r,field:t}:Ee(t)||t.signal?function(e,t){const n="_:vega:_"+CF++,r=ZI({});if(Ee(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+At(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,bF({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e)),[]);return(Pd(t.type)?IF:qd(t.type)?RF:BF)(e,n,i)}function IF(e,t,n){const r=FF(e.sort,!0);let i,a;const o=n.map((e=>{const n=t.getData(e.data);return n||DF(e.data),n.countsRef(t,e.field,r)})),s={groupby:TI,pulse:o};r&&(i=r.op||"count",a=r.field?II(i,r.field):"count",s.ops=[SF[i]],s.fields=[t.fieldRef(a)],s.as=[a]),i=t.add(XI(s));const u=t.add(ZI({pulse:_I(i)}));return a=t.add(EF({field:TI,sort:t.sortRef(r),pulse:_I(u)})),_I(a)}function FF(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!SF[e.op]&&oe("Multiple domain scales can not be sorted using "+e.op):oe("No field provided for sort aggregate op: "+e.op):Ce(e)?e.field="key":e={field:"key"}),e}function RF(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||DF(e.data),n.domainRef(t,e.field)}));return _I(t.add(lF({values:r})))}function BF(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||DF(e.data),n.extentRef(t,e.field)}));return _I(t.add(cF({extents:r})))}function zF(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(yt(i)){if(r&&st(r,i))return zF(e=rt({},e,{range:r[i]}),t,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=Pd(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:oe("Unrecognized scale range value: "+At(i))}else{if(i.scheme)return n.scheme=Ee(i.scheme)?kF(i.scheme,t):AF(i.scheme,t),i.extent&&(n.schemeExtent=kF(i.extent,t)),void(i.count&&(n.schemeCount=AF(i.count,t)));if(i.step)return void(n.rangeStep=AF(i.step,t));if(Pd(e.type)&&!Ee(i))return _F(i,e,t);Ee(i)||oe("Unsupported range type: "+At(i))}return i.map((e=>(Ee(e)?kF:AF)(e,t)))}function PF(e,t,n){return Ee(e)?e.map((e=>PF(e,t,n))):Ce(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:oe("Unsupported parameter object: "+At(e)):e}const LF="top",jF="left",UF="right",qF="bottom",WF="label",VF="perc",$F="value",HF="guide-label",GF="guide-title",KF="symbol",XF="gradient",YF="discrete",JF="size",ZF=[JF,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],QF={name:1,style:1,interactive:1},eR={value:0},tR={value:1},nR="group",rR="rect",iR="rule",aR="text";function oR(e){return e.type=nR,e.interactive=e.interactive||!1,e}function sR(e,t){const n=(n,r)=>PI(e[n],PI(t[n],r));return n.isVertical=n=>"vertical"===PI(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>PI(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>PI(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>PI(e.columns,PI(t.columns,+n.isVertical(!0))),n}function uR(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function cR(e,t,n){return`item.anchor === 'start' ? ${e} : item.anchor === 'end' ? ${t} : ${n}`}const lR=cR(At(jF),At(UF),At("center"));function fR(e,t){return t?e?Ce(e)?Object.assign({},e,{offset:fR(e.offset,t)}):{value:e,offset:t}:t:e}function pR(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=sI(e.encode,t,QF)):e.interactive=!1,e}function hR(e,t,n,r){const i=sR(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();let u,c,l,f,p;a?(c=[0,1],l=[0,0],f=o,p=s):(c=[0,0],l=[1,0],f=s,p=o);const h={enter:u={opacity:eR,x:eR,y:eR,width:iI(f),height:iI(p)},update:rt({},u,{opacity:tR,fill:{gradient:t,start:c,stop:l}}),exit:{opacity:eR}};return oI(h,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),pR({type:rR,role:"legend-gradient",encode:h},r)}function dR(e,t,n,r,i){const a=sR(e,n),o=a.isVertical(),s=a.gradientThickness(),u=a.gradientLength();let c,l,f,p,h="";o?(c="y",f="y2",l="x",p="width",h="1-"):(c="x",f="x2",l="y",p="height");const d={opacity:eR,fill:{scale:t,field:$F}};d[c]={signal:h+"datum."+VF,mult:u},d[l]=eR,d[f]={signal:h+"datum.perc2",mult:u},d[p]=iI(s);const m={enter:d,update:rt({},d,{opacity:tR}),exit:{opacity:eR}};return oI(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),pR({type:rR,role:"legend-band",key:$F,from:i,encode:m},r)}function mR(e,t,n,r){const i=sR(e,t),a=i.isVertical(),o=iI(i.gradientThickness()),s=i.gradientLength();let u,c,l,f,p=i("labelOverlap"),h="";const d={enter:u={opacity:eR},update:c={opacity:tR,text:{field:WF}},exit:{opacity:eR}};return oI(d,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:PI(e.labelLimit,t.gradientLabelLimit)}),a?(u.align={value:"left"},u.baseline=c.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},l="y",f="x",h="1-"):(u.align=c.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},u.baseline={value:"top"},l="x",f="y"),u[l]=c[l]={signal:h+"datum."+VF,mult:s},u[f]=c[f]=o,o.offset=PI(e.labelOffset,t.gradientLabelOffset)||0,p=p?{separation:i("labelSeparation"),method:p,order:"datum.index"}:void 0,pR({type:aR,role:pI,style:HF,key:$F,from:r,encode:d,overlap:p},n)}function gR(e,t,n,r,i){const a=sR(e,t),o=n.entries,s=!(!o||!o.interactive),u=o?o.name:void 0,c=a("clipHeight"),l=a("symbolOffset"),f={data:"value"},p=`(${i}) ? datum.offset : datum.size`,h=c?iI(c):{field:JF},d="datum.index",m=`max(1, ${i})`;let g,v,y,b,x;h.mult=.5,g={enter:v={opacity:eR,x:{signal:p,mult:.5,offset:l},y:h},update:y={opacity:tR,x:v.x,y:v.y},exit:{opacity:eR}};let w=null,E=null;e.fill||(w=t.symbolBaseFillColor,E=t.symbolBaseStrokeColor),oI(g,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",E),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),ZF.forEach((t=>{e[t]&&(y[t]=v[t]={scale:e[t],field:$F})}));const C=pR({type:"symbol",role:"legend-symbol",key:$F,from:f,clip:!!c||void 0,encode:g},n.symbols),S=iI(l);S.offset=a("labelOffset"),g={enter:v={opacity:eR,x:{signal:p,offset:S},y:h},update:y={opacity:tR,text:{field:WF},x:v.x,y:v.y},exit:{opacity:eR}},oI(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const N=pR({type:aR,role:pI,style:HF,key:$F,from:f,encode:g},n.labels);return g={enter:{noBound:{value:!c},width:eR,height:c?iI(c):eR,opacity:eR},exit:{opacity:eR},update:y={opacity:tR,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b=`ceil(item.mark.items.length / ${m})`,y.row.signal=`${d}%${b}`,y.column.signal=`floor(${d} / ${b})`,x={field:["row",d]}):(y.row.signal=`floor(${d} / ${m})`,y.column.signal=`${d} % ${m}`,x={field:d}),y.column.signal=`(${i})?${y.column.signal}:${d}`,oR({role:fI,from:r={facet:{data:r,name:"value",groupby:"index"}},encode:sI(g,o,QF),marks:[C,N],name:u,interactive:s,sort:x})}const vR='item.orient === "left"',yR='item.orient === "right"',bR=`(${vR} || ${yR})`,xR=`datum.vgrad && ${bR}`,wR=cR('"top"','"bottom"','"middle"'),ER=`datum.vgrad && ${yR} ? (${cR('"right"','"left"','"center"')}) : (${bR} && !(datum.vgrad && ${vR})) ? "left" : ${lR}`,CR=`item._anchor || (${bR} ? "middle" : "start")`,SR=`${xR} ? (${vR} ? -90 : 90) : 0`,NR=`${bR} ? (datum.vgrad ? (${yR} ? "bottom" : "top") : ${wR}) : "top"`;function AR(e,t){let n;return Ce(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+kR(e.path)+")":e.sphere&&(n="geoShape("+kR(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function kR(e){return Ce(e)&&e.signal?e.signal:At(e)}function DR(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===nR?fI:t||cI:t}function _R(e){return{marktype:e.type,name:e.name||void 0,role:e.role||DR(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function MR(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function TR(e,t){const n=vs(e.type);n||oe("Unrecognized transform type: "+At(e.type));const r=kI(n.type.toLowerCase(),null,OR(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function OR(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const i=e.params[a];r[i.name]=IR(i,t,n)}return r}function IR(e,t,n){const r=e.type,i=t[e.name];return"index"===r?function(e,t,n){return yt(t.from)||oe('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){const r=t[e.name];return e.array?(Ee(r)||oe("Expected an array of sub-parameters. Instead: "+At(r)),r.map((t=>RR(e,t,n)))):RR(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!BI(i)?i.map((t=>FR(e,t,n))):FR(e,i,n):void(e.required&&oe("Missing required "+At(t.type)+" parameter: "+At(e.name)))}function FR(e,t,n){const r=e.type;if(BI(t))return LR(r)?oe("Expression references can not be signals."):jR(r)?n.fieldRef(t):UR(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||jR(r);return i&&BR(t)?n.exprRef(t.expr,t.as):i&&zR(t)?MI(t.field,t.as):LR(r)?HT(t,n):PR(r)?_I(n.getData(t).values):jR(r)?MI(t):UR(r)?n.compareRef(t):t}}function RR(e,t,n){const r=e.params.length;let i;for(let n=0;n<r;++n){i=e.params[n];for(const e in i.key)if(i.key[e]!==t[e]){i=null;break}if(i)break}i||oe("Unsupported parameter: "+At(t));const a=rt(OR(i,t,n),i.key);return _I(n.add(pF(a)))}const BR=e=>e&&e.expr,zR=e=>e&&e.field,PR=e=>"data"===e,LR=e=>"expr"===e,jR=e=>"field"===e,UR=e=>"compare"===e;function qR(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:_I(t.getData(e.data).output)}function WR(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function VR(e){return yt(e)?e:null}function $R(e,t,n){const r=II(n.op,n.field);let i;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function HR(e,t,n,r,i,a,o){const s=t[n]||(t[n]={}),u=function(e){return Ce(e)?("descending"===e.order?"-":"+")+II(e.op,e.field):""}(a);let c,l,f=VR(i);if(null!=f&&(e=t.scope,f+=u?"|"+u:"",c=s[f]),!c){const n=a?{field:TI,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:_I(t.output)};u&&(n.sort=e.sortRef(a)),l=e.add(kI(r,void 0,n)),o&&(t.index[i]=l),c=_I(l),null!=f&&(s[f]=c)}return c}function GR(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,u=t.add(DI()),c=HT("if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map((e=>null==e?"null":e)).join(",")+"),0)",t);u.update=c.$expr,u.params=c.$params}function KR(e,t){const n=DR(e),r=e.type===nR,i=e.from&&e.from.facet,a=e.overlap;let o,s,u,c,l,f,p,h=e.layout||n===fI||n===lI;const d=n===cI||h||i,m=function(e,t,n){let r,i,a,o,s;return e?(r=e.facet)&&(t||oe("Only group marks can be faceted."),null!=r.field?o=s=qR(r,n):(e.data?s=_I(n.getData(e.data).aggregate):(a=TR(rt({type:"aggregate",groupby:Ge(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=qR(r,n),o=s=_I(n.add(a))),i=n.keyRef(r.groupby,!0))):o=_I(n.add(ZI(null,[{}]))),o||(o=qR(e,n)),{key:i,pulse:o,parent:s}}(e.from,r,t);s=t.add(eF({key:m.key||(e.key?MI(e.key):void 0),pulse:m.pulse,clean:!r}));const g=_I(s);s=u=t.add(ZI({pulse:g})),s=t.add(uF({markdef:_R(e),interactive:MR(e.interactive,t),clip:AR(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:_I(s)}));const v=_I(s);s=c=t.add(tF(xI(e.encode,e.type,n,e.style,t,{mod:!1,pulse:v}))),s.params.parent=t.encode(),e.transform&&e.transform.forEach((e=>{const n=TR(e,t),r=n.metadata;(r.generates||r.changes)&&oe("Mark transforms should not generate new data."),r.nomod||(c.params.mod=!0),n.params.pulse=_I(s),t.add(s=n)})),e.sort&&(s=t.add(xF({sort:t.compareRef(e.sort),pulse:_I(s)})));const y=_I(s);(i||h)&&(h=t.add(wF({layout:t.objectProperty(e.layout),legends:t.legends,mark:v,pulse:y})),f=_I(h));const b=t.add(JI({mark:v,pulse:f||y}));p=_I(b),r&&(d&&(o=t.operators,o.pop(),h&&o.pop()),t.pushState(y,f||p,g),i?function(e,t,n){const r=e.from.facet,i=r.name,a=qR(r,t);let o;r.name||oe("Facet must have a name: "+At(r)),r.data||oe("Facet must reference a data set: "+At(r)),r.field?o=t.add(hF({field:t.fieldRef(r.field),pulse:a})):r.groupby?o=t.add(rF({key:t.keyRef(r.groupby),group:_I(t.proxy(n.parent)),pulse:a})):oe("Facet must specify groupby or field: "+At(r));const s=t.fork(),u=s.add(ZI()),c=s.add(bF({pulse:_I(u)}));s.addData(i,new WR(s,u,u,c)),s.addSignal("parent",null),o.params.subflow={$subflow:s.parse(e).toRuntime()}}(e,t,m):d?function(e,t,n){const r=t.add(hF({pulse:n.pulse})),i=t.fork();i.add(bF()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),d&&(h&&o.push(h),o.push(b))),a&&(p=function(e,t,n){const r=e.method,i=e.bound,a=e.separation,o={separation:BI(a)?n.signalRef(a.signal):a,method:BI(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),i){const e=i.tolerance;o.boundTolerance=BI(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return _I(n.add(fF(o)))}(a,p,t));const x=t.add(vF({pulse:p})),w=t.add(bF({pulse:_I(x)},void 0,t.parent()));null!=e.name&&(l=e.name,t.addData(l,new WR(t,u,x,w)),e.on&&e.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&oe("Marks only support modify triggers."),GR(e,t,l)})))}function XR(e,t,n){const r={enter:{},update:{}};return oI(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function YR(e,t,n){return t[e]?`scale("${t[e]}",datum)`:uR(e,n[0].encode)}function JR(e,t){const n={enter:{},update:{}};return oI(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:lR},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),sI(n,t,QF)}function ZR(e){const t=ZI({},e);return t.metadata={source:!0},t}function QR(e,t){return sF({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}WR.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],o=null,s=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=_I(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new WR(e,a,i,r,o)},WR.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=VR(t);let o,s,u;return null!=a&&(e=r.scope,o=i[a]),o?n&&n.field&&$R(e,o.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:_I(r.output)},n&&n.field&&$R(e,u,n),s=e.add(XI(u)),o=e.add(ZI({pulse:_I(s)})),o={agg:s,ref:_I(o)},null!=a&&(i[a]=o)),o.ref},tuplesRef(){return _I(this.values)},extentRef(e,t){return HR(e,this,"extent","extent",t,!1)},domainRef(e,t){return HR(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return HR(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return HR(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return HR(e,this,"indata","tupleindex",t,!0,!0)}};const eB=e=>e===qF||e===LF,tB=(e,t,n)=>BI(e)?sB(e.signal,t,n):e===jF||e===LF?t:n,nB=(e,t,n)=>BI(e)?aB(e.signal,t,n):eB(e)?t:n,rB=(e,t,n)=>BI(e)?oB(e.signal,t,n):eB(e)?n:t,iB=(e,t,n)=>BI(e)?uB(e.signal,t,n):e===LF?{value:t}:{value:n},aB=(e,t,n)=>cB(`${e} === 'top' || ${e} === 'bottom'`,t,n),oB=(e,t,n)=>cB(`${e} !== 'top' && ${e} !== 'bottom'`,t,n),sB=(e,t,n)=>fB(`${e} === 'left' || ${e} === 'top'`,t,n),uB=(e,t,n)=>fB(`${e} === 'top'`,t,n),cB=(e,t,n)=>(t=null!=t?iI(t):t,n=null!=n?iI(n):n,lB(t)&&lB(n)?{signal:`${e} ? (${t=t?t.signal||At(t.value):null}) : (${n=n?n.signal||At(n.value):null})`}:[rt({test:e},t)].concat(n||[])),lB=e=>null==e||1===Object.keys(e).length,fB=(e,t,n)=>({signal:`${e} ? (${hB(t)}) : (${hB(n)})`}),pB=(e,t,n,r,i)=>({signal:(null!=r?`${e} === 'left' ? (${hB(r)}) : `:"")+(null!=n?`${e} === 'bottom' ? (${hB(n)}) : `:"")+(null!=i?`${e} === 'right' ? (${hB(i)}) : `:"")+(null!=t?`${e} === 'top' ? (${hB(t)}) : `:"")+"(null)"}),hB=e=>BI(e)?e.signal:null==e?null:At(e),dB=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function mB(e,t,n,r){let i;if(t&&st(t,e))return t[e];if(st(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r["guide-title"][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r["guide-label"][i]}return null}function gB(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function vB(e,t){return{scale:e.scale,range:t}}function yB(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function bB(e,t,n,r,i,a){const o=sR(e,t),s=e.orient,u=e.scale,c=tB(s,-1,1),l=LI(o("labelFlush")),f=LI(o("labelFlushOffset")),p=o("labelAlign"),h=o("labelBaseline");let d,m=0===l||!!l;const g=iI(i);g.mult=c,g.offset=iI(o("labelPadding")||0),g.offset.mult=c;const v={scale:u,field:$F,band:.5,offset:fR(a.offset,o("labelOffset"))},y=nB(s,m?yB(u,l,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>BI(e)?((e,t,n)=>fB(`${e} === 'right'`,t,n))(e.signal,t,n):e===UF?{value:t}:{value:n})(s,"left","right")),b=nB(s,iB(s,"bottom","top"),m?yB(u,l,'"top"','"bottom"','"middle"'):{value:"middle"}),x=yB(u,l,`-(${f})`,f,0);m=m&&f;const w={opacity:eR,x:nB(s,v,g),y:rB(s,v,g)},E={enter:w,update:d={opacity:tR,text:{field:WF},x:w.x,y:w.y,align:y,baseline:b},exit:{opacity:eR,x:w.x,y:w.y}};oI(E,{dx:!p&&m?nB(s,x):null,dy:!h&&m?rB(s,x):null}),oI(E,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:p,baseline:h});const C=o("labelBound");let S=o("labelOverlap");return S=S||C?{separation:o("labelSeparation"),method:S,order:"datum.index",bound:C?{scale:u,orient:s,tolerance:C}:null}:void 0,d.align!==y&&(d.align=dB(d.align,y)),d.baseline!==b&&(d.baseline=dB(d.baseline,b)),pR({type:aR,role:"axis-label",style:HF,key:$F,from:r,encode:E,overlap:S},n)}function xB(e,t){const n=function(e,t){var n,r,i,a=t.config,o=a.style,s=a.axis,u="band"===t.scaleType(e.scale)&&a.axisBand,c=e.orient;if(BI(c)){const e=gB([a.axisX,a.axisY]),t=gB([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]);for(i of(n={},e))n[i]=nB(c,mB(i,a.axisX,s,o),mB(i,a.axisY,s,o));for(i of(r={},t))r[i]=pB(c.signal,mB(i,a.axisTop,s,o),mB(i,a.axisBottom,s,o),mB(i,a.axisLeft,s,o),mB(i,a.axisRight,s,o))}else n=c===LF||c===qF?a.axisX:a.axisY,r=a["axis"+c[0].toUpperCase()+c.slice(1)];return n||r||u?rt({},s,n,r,u):s}(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,o=i.interactive,s=i.style,u=sR(e,n),c=function(e){const t=e("tickBand");let n,r,i=e("tickOffset");return t?t.signal?(n={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},Ce(i)||(i={signal:`(${t.signal}) === 'extent' ? 0 : ${i}`})):"extent"===t?(n=1,r=!0,i=0):(n=.5,r=!1):(n=e("bandPosition"),r=e("tickExtra")),{extra:r,band:n,offset:i}}(u),l={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:null!=e.title},f=_I(t.add(ZI({},[l]))),p=_I(t.add(YI({scale:t.scaleRef(e.scale),extra:t.property(c.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let d;return l.grid&&h.push(function(e,t,n,r,i){const a=sR(e,t),o=e.orient,s=e.gridScale,u=tB(o,1,-1),c=function(e,t){if(1===t);else if(Ce(e)){let n=e=rt({},e);for(;null!=n.mult;){if(!Ce(n.mult))return n.mult=BI(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n=n.mult=rt({},n.mult)}n.mult=t}else e=BI(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);return e}(e.offset,u);let l,f,p;const h={enter:l={opacity:eR},update:p={opacity:tR},exit:f={opacity:eR}};oI(h,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const d={scale:e.scale,field:$F,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},m=nB(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:u,offset:c}:{value:0,offset:c},v=s?{scale:s,range:1,mult:u,offset:c}:rt(m,{mult:u,offset:c});return l.x=p.x=nB(o,d,g),l.y=p.y=rB(o,d,g),l.x2=p.x2=rB(o,v),l.y2=p.y2=nB(o,v),f.x=nB(o,d),f.y=rB(o,d),pR({type:iR,role:"axis-grid",key:$F,from:r,encode:h},n)}(e,n,r.grid,p,c)),l.ticks&&(d=u("tickSize"),h.push(function(e,t,n,r,i,a){const o=sR(e,t),s=e.orient,u=tB(s,-1,1);let c,l,f;const p={enter:c={opacity:eR},update:f={opacity:tR},exit:l={opacity:eR}};oI(p,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=iI(i);h.mult=u;const d={scale:e.scale,field:$F,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};return f.y=c.y=nB(s,eR,d),f.y2=c.y2=nB(s,h),l.x=nB(s,d),f.x=c.x=rB(s,eR,d),f.x2=c.x2=rB(s,h),l.y=rB(s,d),pR({type:iR,role:"axis-tick",key:$F,from:r,encode:p},n)}(e,n,r.ticks,p,d,c))),l.labels&&(d=l.ticks?d:0,h.push(bB(e,n,r.labels,p,d,c))),l.domain&&h.push(function(e,t,n,r){const i=sR(e,t),a=e.orient;let o,s;const u={enter:o={opacity:eR},update:s={opacity:tR},exit:{opacity:eR}};oI(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const c=vB(e,0),l=vB(e,1);return o.x=s.x=nB(a,c,eR),o.x2=s.x2=nB(a,l),o.y=s.y=rB(a,c,eR),o.y2=s.y2=rB(a,l),pR({type:iR,role:"axis-domain",from:r,encode:u},n)}(e,n,r.domain,f)),l.title&&h.push(function(e,t,n,r){const i=sR(e,t),a=e.orient,o=tB(a,-1,1);let s,u;const c={enter:s={opacity:eR,anchor:iI(i("titleAnchor",null)),align:{signal:lR}},update:u=rt({},s,{opacity:tR,text:iI(e.title)}),exit:{opacity:eR}},l={signal:`lerp(range("${e.scale}"), ${cR(0,1,.5)})`};return u.x=nB(a,l),u.y=rB(a,l),s.angle=nB(a,eR,((e,t)=>BI(e)?{signal:`(${e.signal}) * 90`}:{value:90*e})(o)),s.baseline=nB(a,iB(a,qF,LF),{value:qF}),u.angle=s.angle,u.baseline=s.baseline,oI(c,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(e,t,n,r){const i=(e,t)=>null!=e?(n.update[t]=dB(iI(e),n.update[t]),!1):!uI(t,r),a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?iI(o):nB(t,iI(o),iI(a))}(i,a,c,n),c.update.align=dB(c.update.align,s.align),c.update.angle=dB(c.update.angle,s.angle),c.update.baseline=dB(c.update.baseline,s.baseline),pR({type:aR,role:"axis-title",style:GF,from:r,encode:c},n)}(e,n,r.title,f)),KR(oR({role:"axis",from:f,encode:sI(wB(u,e),i,QF),marks:h,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:a,interactive:o,style:s}),t)}function wB(e,t){const n={enter:{},update:{}};return oI(n,{orient:e("orient"),offset:e("offset")||0,position:PI(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function EB(e,t,n){const r=Ge(e.signals),i=Ge(e.scales);return n||r.forEach((e=>NI(e,t))),Ge(e.projections).forEach((e=>function(e,t){const n=t.config.projection||{},r={};for(const n in e)"name"!==n&&(r[n]=PF(e[n],n,t));for(const e in n)null==r[e]&&(r[e]=PF(n[e],e,t));t.addProjection(e.name,r)}(e,t))),i.forEach((e=>function(e,t){const n=e.type||"linear";Rd(n)||oe("Unrecognized scale type: "+At(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t))),Ge(e.data).forEach((e=>function(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(TR(e,t))})),e.on&&e.on.forEach((n=>{GR(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const r=[];let i,a,o,s,u,c=null,l=!1,f=!1;for(e.values?BI(e.values)||zI(e.format)?(r.push(QR(t,e)),r.push(c=ZR())):r.push(c=ZR({$ingest:e.values,$format:e.format})):e.url?zI(e.url)||zI(e.format)?(r.push(QR(t,e)),r.push(c=ZR())):r.push(c=ZR({$request:e.url,$format:e.format})):e.source&&(c=i=Ge(e.source).map((e=>_I(t.getData(e).output))),r.push(null)),a=0,o=n.length;a<o;++a)s=n[a],u=s.metadata,c||u.source||r.push(c=ZR()),r.push(s),u.generates&&(f=!0),u.modifies&&!f&&(l=!0),u.source?c=s:u.changes&&(c=null);return i&&(o=i.length-1,r[0]=gF({derive:l,pulse:o?i:i[0]}),(l||o)&&r.splice(1,0,ZR())),c||r.push(ZR()),r.push(bF({})),r}(e,t,n))}(e,t))),i.forEach((e=>NF(e,t))),(n||r).forEach((e=>function(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?oe("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=HT(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach((e=>function(e,t,n){const r=e.encode,i={target:n};let a=e.events,o=e.update,s=[];var u,c;a||oe("Signal update missing events specification."),yt(a)&&(u=a,c=t.isSubscope()?FI:RI,YO=c||"view",JO=XO,a=QO(u.trim()).map(eI)),a=Ge(a).filter((e=>e.signal||e.scale?(s.push(e),0):1)),s.length>1&&(s=[GI(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=r&&(o&&oe("Signal encode and update are mutually exclusive."),o="encode(item(),"+At(r)+")"),i.update=yt(o)?HT(o,t):null!=o.expr?HT(o.expr,t):null!=o.value?o.value:null!=o.signal?{$expr:HI,$params:{$value:t.signalRef(o.signal)}}:oe("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach((e=>t.addUpdate(rt(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):UI(e,t)}}(e,t),i))))}(e,t,n.id)))}(e,t))),Ge(e.axes).forEach((e=>xB(e,t))),Ge(e.marks).forEach((e=>KR(e,t))),Ge(e.legends).forEach((e=>function(e,t){const n=t.config.legend,r=e.encode||{},i=sR(e,n),a=r.legend||{},o=a.name||void 0,s=a.interactive,u=a.style,c={};let l,f,p,h=0;ZF.forEach((t=>e[t]?(c[t]=e[t],h=h||e[t]):0)),h||oe("Missing valid scale for legend.");const d=function(e,t){let n=e.type||KF;return e.type||1!==function(e){return ZF.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=zd(t)?XF:Ld(t)?YF:KF),n!==XF?n:Ld(t)?YF:XF}(e,t.scaleType(h)),m={title:null!=e.title,scales:c,type:d,vgrad:"symbol"!==d&&i.isVertical()},g=_I(t.add(ZI(null,[m]))),v=_I(t.add(oF(f={type:d,scale:t.scaleRef(h),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return d===XF?(p=[hR(e,h,n,r.gradient),mR(e,n,r.labels,v)],f.count=f.count||t.signalRef(`max(2,2*floor((${LI(i.gradientLength())})/100))`)):d===YF?p=[dR(e,h,n,r.gradient,v),mR(e,n,r.labels,v)]:(l=function(e,t){const n=sR(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),p=[gR(e,n,r,v,LI(l.columns))],f.size=function(e,t,n){const r=LI(YR("size",e,n)),i=LI(YR("strokeWidth",e,n)),a=LI(function(e,t,n){return uR("fontSize",e)||function(e,t,n){const r=t.config.style["guide-label"];return r&&r.fontSize}(0,t)}(n[1].encode,t));return HT(`max(ceil(sqrt(${r})+${i}),${a})`,t)}(e,t,p[0].marks)),p=[oR({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:p,layout:l,interactive:s})],m.title&&p.push(function(e,t,n,r){const i=sR(e,t),a={enter:{opacity:eR},update:{opacity:tR,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:eR}};return oI(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:CR},angle:{signal:SR},align:{signal:ER},baseline:{signal:NR},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),pR({type:aR,role:"legend-title",style:GF,from:r,encode:a},n)}(e,n,r.title,g)),KR(oR({role:"legend",from:g,encode:sI(XR(i,e,n),a,QF),marks:p,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:u}),t)}(e,t))),e.title&&function(e,t){const n=sR(e=yt(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,u=[],c=_I(t.add(ZI(null,[{}])));u.push(function(e,t,n,r){const i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return oI(a,{text:e.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),pR({type:aR,role:"title-text",style:"group-title",from:r,encode:a},n)}(e,n,function(e){const t=e.encode;return t&&t.title||rt({name:e.name,interactive:e.interactive,style:e.style},t)}(e),c)),e.subtitle&&u.push(function(e,t,n,r){const i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return oI(a,{text:e.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),pR({type:aR,role:"title-subtitle",style:"group-subtitle",from:r,encode:a},n)}(e,n,r.subtitle,c)),KR(oR({role:"title",from:c,encode:JR(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}(e.title,t),t.parseLambdas(),t}function CB(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function SB(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function NB(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function AB(e){return(Ee(e)?kB:DB)(e)}function kB(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const t=e[r];n+=(r>0?",":"")+(Ce(t)?t.signal||AB(t):At(t))}return n+"]"}function DB(e){let t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+At(t)+":"+(Ce(n)?n.signal||AB(n):At(n));return r+"}"}function _B(e,t,n){return Ce(e)||oe("Input Vega specification must be an object."),t=Ne(function(){const e="sans-serif",t="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),function(e,t){const n=t.config,r=_I(t.root=t.add(DI())),i=function(e,t){const n=n=>PI(e[n],t[n]),r=[CB("background",n("background")),CB("autosize",tI(n("autosize"))),CB("padding",rI(n("padding"))),CB("width",n("width")||0),CB("height",n("height")||0)],i=r.reduce(((e,t)=>(e[t.name]=t,e)),{}),a={};return Ge(e.signals).forEach((e=>{st(i,e.name)?e=rt(i[e.name],e):r.push(e),a[e.name]=e})),Ge(t.signals).forEach((e=>{st(a,e.name)||st(i,e.name)||r.push(e)})),r}(e,n);i.forEach((e=>NI(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(ZI()),o=t.add(tF(xI((e=>sI({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),nR,lI,e.style,t,{pulse:_I(a)}))),s=t.add(wF({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:_I(o)}));t.operators.pop(),t.pushState(_I(o),_I(s),null),EB(e,t,i),t.operators.push(s);let u=t.add(JI({mark:r,pulse:_I(s)}));return u=t.add(vF({pulse:_I(u)})),u=t.add(bF({pulse:_I(u)})),t.addData("root",new WR(t,a,a,u)),t}(e,new SB(t,n)).toRuntime()}SB.prototype=NB.prototype={parse(e){return EB(e,this)},fork(){return new NB(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof AI?_I(e):e;return this.add(mF({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let r,i;e&&(r=e.data||(e.data={}),i=r[t]||(r[t]=[]),i.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(_I(this.add(bF({pulse:e})))),this._parent.push(t),this._lookup.push(n?_I(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return De(this._parent)},encode(){return De(this._encode)},lookup(){return De(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(yt(e))return MI(e,t);e.signal||oe("Unsupported field reference: "+At(e));const n=e.signal;let r=this.field[n];if(!r){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=r=_I(this.add(iF(e)))}return r},compareRef(e){let t=!1;const n=e=>BI(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,r=Ge(e.field).map(n),i=Ge(e.order).map(n);return t?_I(this.add(QI({fields:r,orders:i}))):OI(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=Ge(e).map((e=>BI(e)?(n=!0,_I(r[e.signal])):e)),n?_I(this.add(aF({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=II(e.op,e.field),n=e.order||"ascending";return n.signal?_I(this.add(QI({fields:t,orders:this.signalRef(n.signal)}))):OI(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return st(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&oe("Duplicate signal name: "+At(e));const n=t instanceof AI?t:this.add(DI(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||oe("Unrecognized signal name: "+At(e)),this.signals[e]},signalRef(e){return this.signals[e]?_I(this.signals[e]):(st(this.lambdas,e)||(this.lambdas[e]=this.add(DI(null))),_I(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=HT(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Ce(e)?this.signalRef(e.signal||AB(e)):e},exprRef(e,t){const n={expr:HT(e,this)};return t&&(n.expr.$name=t),_I(this.add(nF(n)))},addBinding(e,t){this.bindings||oe("Nested signals do not support binding: "+At(e)),this.bindings.push(rt({signal:e},t))},addScaleProj(e,t){st(this.scales,e)&&oe("Duplicate scale or projection name: "+At(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,yF(t))},addProjection(e,t){this.addScaleProj(e,dF(t))},getScale(e){return this.scales[e]||oe("Unrecognized scale name: "+At(e)),this.scales[e]},scaleRef(e){return _I(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return st(this.data,e)&&oe("Duplicate data set name: "+At(e)),this.data[e]=t},getData(e){return this.data[e]||oe("Undefined data set name: "+At(e)),this.data[e]},addDataPipeline(e,t){return st(this.data,e)&&oe("Duplicate data set name: "+At(e)),this.addData(e,WR.fromEntries(this,t))}};function MB(e){this.type=e}var TB,OB,IB,FB,RB;MB.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(TB={})[1]="Boolean",TB[2]="<end>",TB[3]="Identifier",TB[4]="Keyword",TB[5]="Null",TB[6]="Numeric",TB[7]="Punctuator",TB[8]="String",TB[9]="RegularExpression";var BB="Identifier",zB="Unexpected token %0",PB="Invalid regular expression",LB="Invalid regular expression: missing /",jB="Octal literals are not allowed in strict mode.",UB="ILLEGAL",qB="Disabled.",WB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),VB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function $B(e,t){if(!e)throw new Error("ASSERT: "+t)}function HB(e){return e>=48&&e<=57}function GB(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function KB(e){return"01234567".indexOf(e)>=0}function XB(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function YB(e){return 10===e||13===e||8232===e||8233===e}function JB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&WB.test(String.fromCharCode(e))}function ZB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&VB.test(String.fromCharCode(e))}const QB={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function ez(){for(;IB<FB;){const e=OB.charCodeAt(IB);if(!XB(e)&&!YB(e))break;++IB}}function tz(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)IB<FB&&GB(OB[IB])?(r=OB[IB++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):mz({},zB,UB);return String.fromCharCode(i)}function nz(){var e,t,n,r;for(t=0,"}"===(e=OB[IB])&&mz({},zB,UB);IB<FB&&GB(e=OB[IB++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&mz({},zB,UB),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function rz(){var e,t;for(e=OB.charCodeAt(IB++),t=String.fromCharCode(e),92===e&&(117!==OB.charCodeAt(IB)&&mz({},zB,UB),++IB,(e=tz("u"))&&"\\"!==e&&JB(e.charCodeAt(0))||mz({},zB,UB),t=e);IB<FB&&ZB(e=OB.charCodeAt(IB));)++IB,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==OB.charCodeAt(IB)&&mz({},zB,UB),++IB,(e=tz("u"))&&"\\"!==e&&ZB(e.charCodeAt(0))||mz({},zB,UB),t+=e);return t}function iz(){var e,t,n,r,i=IB,a=OB.charCodeAt(IB),o=OB[IB];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++IB,{type:7,value:String.fromCharCode(a),start:i,end:IB};default:if(61===(e=OB.charCodeAt(IB+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return IB+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:IB};case 33:case 61:return IB+=2,61===OB.charCodeAt(IB)&&++IB,{type:7,value:OB.slice(i,IB),start:i,end:IB}}}return">>>="===(r=OB.substr(IB,4))?{type:7,value:r,start:i,end:IB+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:IB+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:IB+=2}:("//"===t&&mz({},zB,UB),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++IB}:void mz({},zB,UB))}function az(){var e,t,n;if($B(HB((n=OB[IB]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=IB,e="","."!==n){if(e=OB[IB++],n=OB[IB],"0"===e){if("x"===n||"X"===n)return++IB,function(e){let t="";for(;IB<FB&&GB(OB[IB]);)t+=OB[IB++];return 0===t.length&&mz({},zB,UB),JB(OB.charCodeAt(IB))&&mz({},zB,UB),{type:6,value:parseInt("0x"+t,16),start:e,end:IB}}(t);if(KB(n))return function(e){let t="0"+OB[IB++];for(;IB<FB&&KB(OB[IB]);)t+=OB[IB++];return(JB(OB.charCodeAt(IB))||HB(OB.charCodeAt(IB)))&&mz({},zB,UB),{type:6,value:parseInt(t,8),octal:!0,start:e,end:IB}}(t);n&&HB(n.charCodeAt(0))&&mz({},zB,UB)}for(;HB(OB.charCodeAt(IB));)e+=OB[IB++];n=OB[IB]}if("."===n){for(e+=OB[IB++];HB(OB.charCodeAt(IB));)e+=OB[IB++];n=OB[IB]}if("e"===n||"E"===n)if(e+=OB[IB++],"+"!==(n=OB[IB])&&"-"!==n||(e+=OB[IB++]),HB(OB.charCodeAt(IB)))for(;HB(OB.charCodeAt(IB));)e+=OB[IB++];else mz({},zB,UB);return JB(OB.charCodeAt(IB))&&mz({},zB,UB),{type:6,value:parseFloat(e),start:t,end:IB}}function oz(){if(ez(),IB>=FB)return{type:2,start:IB,end:IB};const e=OB.charCodeAt(IB);return JB(e)?function(){var e,t;return e=IB,t=92===OB.charCodeAt(IB)?rz():function(){var e,t;for(e=IB++;IB<FB;){if(92===(t=OB.charCodeAt(IB)))return IB=e,rz();if(!ZB(t))break;++IB}return OB.slice(e,IB)}(),{type:1===t.length?3:QB.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:IB}}():40===e||41===e||59===e?iz():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for($B("'"===(e=OB[IB])||'"'===e,"String literal must starts with a quote"),t=IB,++IB;IB<FB;){if((n=OB[IB++])===e){e="";break}if("\\"===n)if((n=OB[IB++])&&YB(n.charCodeAt(0)))"\r"===n&&"\n"===OB[IB]&&++IB;else switch(n){case"u":case"x":"{"===OB[IB]?(++IB,i+=nz()):i+=tz(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:KB(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),IB<FB&&KB(OB[IB])&&(a=!0,r=8*r+"01234567".indexOf(OB[IB++]),"0123".indexOf(n)>=0&&IB<FB&&KB(OB[IB])&&(r=8*r+"01234567".indexOf(OB[IB++]))),i+=String.fromCharCode(r)):i+=n}else{if(YB(n.charCodeAt(0)))break;i+=n}}return""!==e&&mz({},zB,UB),{type:8,value:i,octal:a,start:t,end:IB}}():46===e?HB(OB.charCodeAt(IB+1))?az():iz():HB(e)?az():iz()}function sz(){const e=RB;return IB=e.end,RB=oz(),IB=e.end,e}function uz(){const e=IB;RB=oz(),IB=e}function cz(e,t,n){const r=new MB("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function lz(e,t){const n=new MB("CallExpression");return n.callee=e,n.arguments=t,n}function fz(e){const t=new MB(BB);return t.name=e,t}function pz(e){const t=new MB("Literal");return t.value=e.value,t.raw=OB.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function hz(e,t,n){const r=new MB("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function dz(e,t,n){const r=new MB("Property");return r.key=t,r.value=n,r.kind=e,r}function mz(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,((e,t)=>($B(t<r.length,"Message reference must be in range"),r[t])));throw(n=new Error(i)).index=IB,n.description=i,n}function gz(e){2===e.type&&mz(e,"Unexpected end of input"),6===e.type&&mz(e,"Unexpected number"),8===e.type&&mz(e,"Unexpected string"),3===e.type&&mz(e,"Unexpected identifier"),4===e.type&&mz(e,"Unexpected reserved word"),mz(e,zB,e.value)}function vz(e){const t=sz();7===t.type&&t.value===e||gz(t)}function yz(e){return 7===RB.type&&RB.value===e}function bz(e){return 4===RB.type&&RB.value===e}function xz(){IB=RB.start;const e=sz();return 8===e.type||6===e.type?(e.octal&&mz(e,jB),pz(e)):fz(e.value)}function wz(){var e,t,n;return IB=RB.start,3===(e=RB).type?(n=xz(),vz(":"),dz("init",n,_z())):2!==e.type&&7!==e.type?(t=xz(),vz(":"),dz("init",t,_z())):void gz(e)}const Ez={if:1};function Cz(){var e,t,n;if(yz("("))return function(){vz("(");const e=Mz();return vz(")"),e}();if(yz("["))return function(){const e=[];for(IB=RB.start,vz("[");!yz("]");)yz(",")?(sz(),e.push(null)):(e.push(_z()),yz("]")||vz(","));return sz(),function(e){const t=new MB("ArrayExpression");return t.elements=e,t}(e)}();if(yz("{"))return function(){var e,t,n=[],r={},i=String;for(IB=RB.start,vz("{");!yz("}");)t="$"+((e=wz()).key.type===BB?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?mz({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),yz("}")||vz(",");return vz("}"),function(e){const t=new MB("ObjectExpression");return t.properties=e,t}(n)}();if(e=RB.type,IB=RB.start,3===e||Ez[RB.value])n=fz(sz().value);else if(8===e||6===e)RB.octal&&mz(RB,jB),n=pz(sz());else{if(4===e)throw new Error(qB);1===e?((t=sz()).value="true"===t.value,n=pz(t)):5===e?((t=sz()).value=null,n=pz(t)):yz("/")||yz("/=")?(n=pz(function(){var e,t,n,r;return RB=null,ez(),e=IB,t=function(){var e,t,n,r;for($B("/"===(e=OB[IB]),"Regular expression literal must start with a slash"),t=OB[IB++],n=!1,r=!1;IB<FB;)if(t+=e=OB[IB++],"\\"===e)YB((e=OB[IB++]).charCodeAt(0))&&mz({},LB),t+=e;else if(YB(e.charCodeAt(0)))mz({},LB);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||mz({},LB),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";IB<FB&&ZB((e=OB[IB]).charCodeAt(0));)++IB,"\\"===e&&IB<FB?mz({},zB,UB):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&mz({},PB,n),{value:n,literal:t}}(),r=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";mz({},PB)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){mz({},PB)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:IB}}()),uz()):gz(sz())}return n}function Sz(){const e=[];if(vz("("),!yz(")"))for(;IB<FB&&(e.push(_z()),!yz(")"));)vz(",");return vz(")"),e}function Nz(){vz("[");const e=Mz();return vz("]"),e}function Az(){const e=function(){var e;for(e=Cz();;)if(yz("."))e=hz(".",e,(vz("."),function(){IB=RB.start;const e=sz();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||gz(e),fz(e.value)}()));else if(yz("("))e=lz(e,Sz());else{if(!yz("["))break;e=hz("[",e,Nz())}return e}();if(7===RB.type&&(yz("++")||yz("--")))throw new Error(qB);return e}function kz(){var e,t;if(7!==RB.type&&4!==RB.type)t=Az();else{if(yz("++")||yz("--"))throw new Error(qB);if(yz("+")||yz("-")||yz("~")||yz("!"))e=sz(),t=kz(),t=function(e,t){const n=new MB("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(bz("delete")||bz("void")||bz("typeof"))throw new Error(qB);t=Az()}}return t}function Dz(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function _z(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,u,c;if(e=RB,u=kz(),0===(i=Dz(r=RB)))return u;for(r.prec=i,sz(),t=[e,RB],a=[u,r,o=kz()];(i=Dz(RB))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,u=a.pop(),t.pop(),n=cz(s,u,o),a.push(n);(r=sz()).prec=i,a.push(r),t.push(RB),n=kz(),a.push(n)}for(n=a[c=a.length-1],t.pop();c>1;)t.pop(),n=cz(a[c-1].value,a[c-2],n),c-=2;return n}(),yz("?")&&(sz(),t=_z(),vz(":"),e=function(e,t,n){const r=new MB("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,_z())),e}function Mz(){const e=_z();if(yz(","))throw new Error(qB);return e}function Tz(e){IB=0,FB=(OB=e).length,RB=null,uz();const t=Mz();if(2!==RB.type)throw new Error("Unexpect token after expression.");return t}var Oz={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Iz(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&oe("Missing arguments to clamp function."),t.length>3&&oe("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&oe("Missing arguments to if function."),t.length>3&&oe("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function Fz(e){const t=(e=e||{}).allowed?Tt(e.allowed):{},n=e.forbidden?Tt(e.forbidden):{},r=e.constants||Oz,i=(e.functions||Iz)(f),a=e.globalvar,o=e.fieldvar,s=Xe(a)?a:e=>"".concat(a,'["').concat(e,'"]');let u={},c={},l=0;function f(e){if(yt(e))return e;const t=p[e.type];return null==t&&oe("Unsupported type: "+e.type),t(e)}const p={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return l>0?i:st(n,i)?oe("Illegal identifier: "+i):st(r,i)?r[i]:st(t,i)?i:(u[i]=1,s(i))},MemberExpression:e=>{const t=!e.computed,n=f(e.object);t&&(l+=1);const r=f(e.property);return n===o&&(c[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(l-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&oe("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=st(i,t)&&i[t];return r||oe("Unrecognized function: "+t),Xe(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(f).join(",")+"]",BinaryExpression:e=>"("+f(e.left)+" "+e.operator+" "+f(e.right)+")",UnaryExpression:e=>"("+e.operator+f(e.argument)+")",ConditionalExpression:e=>"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")",LogicalExpression:e=>"("+f(e.left)+e.operator+f(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(f).join(",")+"}",Property:e=>{l+=1;const t=f(e.key);return l-=1,t+":"+f(e.value)}};function h(e){const t={code:f(e),globals:Object.keys(u),fields:Object.keys(c)};return u={},c={},t}return h.functions=i,h.constants=r,h}const Rz=/[[\]{}]/,Bz={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let zz,Pz;function Lz(e,t,n){return zz=t||"view",Pz=n||Bz,Uz(e.trim()).map(qz)}function jz(e,t,n,r,i){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;i&&i.indexOf(o)>=0?--s:r&&r.indexOf(o)>=0&&++s}return t}function Uz(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=jz(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function qz(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=jz(e,r,"]","[","]"),r===t)throw"Empty between selector: "+e;if(n=Uz(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(qz);const i=qz(e.slice(1).trim());return i.between?{between:n,stream:i}:(i.between=n,i)}(e):function(e){const t={source:zz},n=[];let r,i,a=[0,0],o=0,s=0,u=e.length,c=0;if("}"===e[u-1]){if(c=e.lastIndexOf("{"),!(c>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(c+1,u-1))}catch(t){throw"Invalid throttle specification: "+e}u=(e=e.slice(0,c).trim()).length,c=0}if(!u)throw e;if("@"===e[0]&&(o=++c),r=jz(e,c,":"),r<u&&(n.push(e.substring(s,r).trim()),s=c=++r),c=jz(e,c,"["),c===u)n.push(e.substring(s,u).trim());else if(n.push(e.substring(s,c).trim()),i=[],s=++c,s===u)throw"Unmatched left bracket: "+e;for(;c<u;){if(c=jz(e,c,"]"),c===u)throw"Unmatched left bracket: "+e;if(i.push(e.substring(s,c).trim()),c<u-1&&"["!==e[++c])throw"Expected left bracket: "+e;s=++c}if(!(u=n.length)||Rz.test(n[u-1]))throw"Invalid event selector: "+e;var l;return u>1?(t.type=n[1],o?t.markname=n[0].slice(1):(l=n[0],Pz[l]?t.marktype=n[0]:t.source=n[0])):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=i&&(t.filter=i),a[0]&&(t.throttle=a[0]),a[1]&&(t.debounce=a[1]),t}(e)}rt(gs,a,s,u,c,l,p,f,h,d,m,g);const Wz="5.20.0";function Vz(e,t,n){return e.fields=t||[],e.fname=n,e}function $z(e){return 1===e.length?Hz(e[0]):Gz(e)}const Hz=e=>function(t){return t[e]},Gz=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function Kz(e){throw Error(e)}function Xz(e){var t,n,r,i=[],a=null,o=0,s=e.length,u="";function c(){i.push(u+e.substring(t,n)),u="",t=n+1}for(e+="",t=n=0;n<s;++n)if("\\"===(r=e[n]))u+=e.substring(t,n),u+=e.substring(++n,++n),t=n;else if(r===a)c(),a=null,o=-1;else{if(a)continue;t===o&&'"'===r||t===o&&"'"===r?(t=n+1,a=r):"."!==r||o?"["===r?(n>t&&c(),o=t=n+1):"]"===r&&(o||Kz("Access path missing open bracket: "+e),o>0&&c(),o=0,t=n+1):n>t?c():t=n+1}return o&&Kz("Access path missing closing bracket: "+e),a&&Kz("Access path missing closing quote: "+e),n>t&&(n++,c()),i}var Yz=[],Jz=(function(e,t,n){const r=Xz(e);e=1===r.length?r[0]:e,Vz($z(r),[e],e)}("id"),Vz((function(e){return e}),Yz,"identity"));function Zz(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}Vz((function(){return 0}),Yz,"zero"),Vz((function(){return 1}),Yz,"one"),Vz((function(){return!0}),Yz,"true"),Vz((function(){return!1}),Yz,"false");const Qz=Array.isArray;function eP(e){return e===Object(e)}const tP=e=>"__proto__"!==e;function nP(...e){return e.reduce(((e,t)=>{for(var n in t)if("signals"===n)e.signals=iP(e.signals,t.signals);else{var r="legend"===n?{layout:1}:"style"===n||null;rP(e,n,t[n],r)}return e}),{})}function rP(e,t,n,r){var i,a;if(tP(t))if(eP(n)&&!Qz(n))for(i in a=eP(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?rP(a,i,n[i]):tP(i)&&(a[i]=n[i]);else e[t]=n}function iP(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function aP(e){return null!=e?Qz(e)?e:[e]:[]}const oP=Object.prototype.hasOwnProperty;function sP(e,t){return oP.call(e,t)}function uP(e){return"boolean"==typeof e}function cP(e){return"number"==typeof e}function lP(e){return"string"==typeof e}function fP(e){return Qz(e)?"["+e.map(fP)+"]":eP(e)||lP(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function pP(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}function hP(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create,Object.create,Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var dP=n(6313),mP=n.n(dP),gP=n(4063),vP=n.n(gP),yP=n(5035),bP=n.n(yP);function xP(e){return!!e.or}function wP(e){return!!e.and}function EP(e){return!!e.not}function CP(e,t){if(EP(e))CP(e.not,t);else if(wP(e))for(const n of e.and)CP(n,t);else if(xP(e))for(const n of e.or)CP(n,t);else t(e)}function SP(e,t){return EP(e)?{not:SP(e.not,t)}:wP(e)?{and:e.and.map((e=>SP(e,t)))}:xP(e)?{or:e.or.map((e=>SP(e,t)))}:t(e)}const NP=vP(),AP=mP();function kP(e,t){const n={};for(const r of t)sP(e,r)&&(n[r]=e[r]);return n}function DP(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>bP()(e))).join(",")})`};const _P=bP();function MP(e){if(cP(e))return e;const t=lP(e)?e:bP()(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n&=n;return n}function TP(e){return!1===e||null===e}function OP(e,t){return e.indexOf(t)>-1}function IP(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function FP(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function RP(e,t){for(const n of UP(t))rP(e,n,t[n],!0)}function BP(e,t){const n=[],r={};let i;for(const a of e)i=t(a),i in r||(r[i]=1,n.push(a));return n}function zP(e,t){for(const n of e)if(t.has(n))return!0;return!1}function PP(e){const t=new Set;for(const n of e){const e=Xz(n).map(((e,t)=>0===t?e:`[${e}]`)),r=e.map(((t,n)=>e.slice(0,n+1).join("")));for(const e of r)t.add(e)}return t}function LP(e,t){return void 0===e||void 0===t||zP(PP(e),PP(t))}function jP(e){return 0===UP(e).length}const UP=Object.keys,qP=Object.values;function WP(e){const t=[];for(const n in e)sP(e,n)&&t.push({key:n,value:e[n]});return t}function VP(e){return!0===e||!1===e}function $P(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function HP(e,t){return EP(e)?"!("+HP(e.not,t)+")":wP(e)?"("+e.and.map((e=>HP(e,t))).join(") && (")+")":xP(e)?"("+e.or.map((e=>HP(e,t))).join(") || (")+")":t(e)}function GP(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&GP(e[n],t)&&delete e[n],jP(e)}function KP(e){return e.charAt(0).toUpperCase()+e.substr(1)}function XP(e,t="datum"){const n=Xz(e),r=[];for(let e=1;e<=n.length;e++){const i=`[${n.slice(0,e).map(fP).join("][")}]`;r.push(`${t}${i}`)}return r.join(" && ")}function YP(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function JP(e){return`${Xz(e).map(YP).join("\\.")}`}function ZP(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function QP(e){return`${Xz(e).join(".")}`}function eL(e){return e?Xz(e).length:0}function tL(...e){for(const t of e)if(void 0!==t)return t}let nL=42;function rL(e){if(void 0!==e)return(e%360+360)%360}function iL(e){return!!cP(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const aL={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function oL(e){return e&&e.condition}const sL=["domain","grid","labels","ticks","title"],uL={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},cL={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},lL=Object.assign(Object.assign({},cL),{style:1,labelExpr:1,encoding:1});function fL(e){return!!lL[e]}UP(lL);const pL={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},hL=pL.arc,dL=pL.area,mL=pL.bar,gL=pL.image,vL=pL.line,yL=pL.point,bL=pL.rect,xL=pL.rule,wL=pL.text,EL=pL.tick,CL=pL.trail,SL=pL.circle,NL=pL.square,AL=pL.geoshape;function kL(e){return OP(["line","area","trail"],e)}function DL(e){return OP(["rect","bar","image","arc"],e)}const _L=UP(pL);function ML(e){return e.type}pP(_L);const TL=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],OL=UP({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),IL={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function FL(e){return"mark"in e}class RL{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!FL(e)&&function(e){return ML(e)?e.type:e}(e.mark)===this.name}}const BL={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},zL={count:1,min:1,max:1};function PL(e){return!!e&&!!e.argmin}function LL(e){return!!e&&!!e.argmax}function jL(e){return lP(e)&&!!BL[e]}UP(BL);const UL=["count","valid","missing","distinct"];function qL(e){return lP(e)&&OP(UL,e)}const WL=["count","sum","distinct","valid","missing"],VL=pP(["mean","average","median","q1","q3","min","max"]),$L="row",HL="column",GL="facet",KL="x",XL="y",YL="x2",JL="y2",ZL="radius",QL="radius2",ej="theta",tj="theta2",nj="latitude",rj="longitude",ij="latitude2",aj="longitude2",oj="color",sj="fill",uj="stroke",cj="shape",lj="size",fj="angle",pj="opacity",hj="fillOpacity",dj="strokeOpacity",mj="strokeWidth",gj="strokeDash",vj="text",yj="order",bj="detail",xj="key",wj="tooltip",Ej="href",Cj="url",Sj="description",Nj={theta:1,theta2:1,radius:1,radius2:1};function Aj(e){return e in Nj}const kj={longitude:1,longitude2:1,latitude:1,latitude2:1},Dj=UP(kj),_j=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),Nj),kj),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Mj(e){return e===oj||e===sj||e===uj}const Tj={row:1,column:1,facet:1},Oj=UP(Tj),Ij=Object.assign(Object.assign({},_j),Tj),Fj=UP(Ij),{order:Rj,detail:Bj,tooltip:zj}=Ij,Pj=hP(Ij,["order","detail","tooltip"]),{row:Lj,column:jj,facet:Uj}=Pj,qj=hP(Pj,["row","column","facet"]);function Wj(e){return!!Ij[e]}UP(Pj),UP(qj);const Vj=[YL,JL,ij,aj,tj,QL];function $j(e){return Hj(e)!==e}function Hj(e){switch(e){case YL:return KL;case JL:return XL;case ij:return nj;case aj:return rj;case tj:return ej;case QL:return ZL}return e}function Gj(e){if(Aj(e))switch(e){case ej:return"startAngle";case tj:return"endAngle";case ZL:return"outerRadius";case QL:return"innerRadius"}return e}function Kj(e){switch(e){case KL:return YL;case XL:return JL;case nj:return ij;case rj:return aj;case ej:return tj;case ZL:return QL}}function Xj(e){switch(e){case KL:case YL:return"width";case XL:case JL:return"height"}}UP(_j);const{x:Yj,y:Jj,x2:Zj,y2:Qj,latitude:eU,longitude:tU,latitude2:nU,longitude2:rU,theta:iU,theta2:aU,radius:oU,radius2:sU}=_j,uU=hP(_j,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),cU=UP(uU),lU={x:1,y:1},fU=UP(lU);function pU(e){return e in lU}const hU={theta:1,radius:1},dU=UP(hU);function mU(e){return"width"===e?KL:XL}const{text:gU,tooltip:vU,href:yU,url:bU,description:xU,detail:wU,key:EU,order:CU}=uU,SU=hP(uU,["text","tooltip","href","url","description","detail","key","order"]),NU=UP(SU),AU=Object.assign(Object.assign(Object.assign({},lU),hU),SU),kU=UP(AU);function DU(e){return!!AU[e]}const _U={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:MU}=_U,TU=hP(_U,["geoshape"]);function OU(e){switch(e){case KL:case XL:case ej:case ZL:case lj:case fj:case mj:case pj:case hj:case dj:case YL:case JL:case tj:case QL:return;case GL:case $L:case HL:case cj:case gj:case vj:case wj:case Ej:case Cj:case Sj:return"discrete";case oj:case sj:case uj:return"flexible";case nj:case rj:case ij:case aj:case bj:case xj:case yj:return}}function IU(e){return uP(e)&&(e=jV(e,void 0)),"bin"+UP(e).map((t=>zU(e[t])?$P(`_${t}_${Object.entries(e[t])}`):$P(`_${t}_${e[t]}`))).join("")}function FU(e){return!0===e||BU(e)&&!e.binned}function RU(e){return"binned"===e||BU(e)&&!0===e.binned}function BU(e){return eP(e)}function zU(e){return null==e?void 0:e.selection}function PU(e){switch(e){case $L:case HL:case lj:case oj:case sj:case uj:case mj:case pj:case hj:case dj:case cj:return 6;case gj:return 4;default:return 10}}function LU(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}function jU(e){return("width"==e?"Width":"Height")+' "container" only works for single views and layered views.'}function UU(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function qU(e){return e?`Dropping "fit-${e}" because spec has discrete ${Xj(e)}.`:'Dropping "fit" because spec has discrete size.'}function WU(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function VU(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function $U(e){return`Selection not supported for ${e} yet.`}function HU(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function GU(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function KU(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function XU(e){return`Invalid field type "${e}".`}function YU(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function JU(e,t){return`Dropping ${_P(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function ZU(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function QU(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function eq(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function tq(e){return`Using unaggregated domain with raw field has no effect (${_P(e)}).`}function nq(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function rq(e){return`Unaggregated domain is currently unsupported for log scale (${_P(e)}).`}function iq(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function aq(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const oq="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function sq(e,t){return`Invalid ${e}: ${_P(t)}.`}function uq(e){return`1D error band does not support ${e}.`}function cq(e){return`Channel ${e} is required for "binned" bin.`}const lq=(fq=2,{level:function(e){return arguments.length?(fq=+e,this):fq},error:function(){return fq>=1&&Zz("error","ERROR",arguments),this},warn:function(){return fq>=2&&Zz("warn","WARN",arguments),this},info:function(){return fq>=3&&Zz("log","INFO",arguments),this},debug:function(){return fq>=4&&Zz("log","DEBUG",arguments),this}});var fq;let pq=lq;function hq(...e){pq.warn(...e)}function dq(e){if(e&&eP(e))for(const t of Eq)if(t in e)return!0;return!1}const mq=["january","february","march","april","may","june","july","august","september","october","november","december"],gq=mq.map((e=>e.substr(0,3))),vq=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],yq=vq.map((e=>e.substr(0,3)));function bq(e,t){const n=[];if(t&&void 0!==e.day&&UP(e).length>1&&(hq(function(e){return`Dropping day from datetime ${_P(e)} as day cannot be combined with other units.`}(e)),delete(e=AP(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const r=t?function(e){if(iL(e)&&(e=+e),cP(e))return e-1;{const t=e.toLowerCase(),n=mq.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=gq.indexOf(r);if(-1!==i)return i;throw new Error(sq("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(iL(e)&&(e=+e),cP(e))return e>4&&hq(sq("quarter",e)),e-1;throw new Error(sq("quarter",e))}(e.quarter):e.quarter;n.push(cP(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(iL(e)&&(e=+e),cP(e))return e%7;{const t=e.toLowerCase(),n=vq.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=yq.indexOf(r);if(-1!==i)return i;throw new Error(sq("day",e))}}(e.day):e.day;n.push(cP(r)?r+1:r+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const r=e[t];n.push(void 0===r?0:r)}return n}function xq(e){const t=bq(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const wq={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Eq=UP(wq);function Cq(e){return e.startsWith("utc")}const Sq={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Nq(e){const t=[];for(const n of Eq)Aq(e,n)&&t.push(n);return t}function Aq(e,t){const n=e.indexOf(t);return!(n<0||n>0&&"seconds"===t&&"i"===e.charAt(n-1)||e.length>n+3&&"day"===t&&"o"===e.charAt(n+3)||n>0&&"year"===t&&"f"===e.charAt(n-1))}function kq(e){if(!e)return;const t=Nq(e);return`timeUnitSpecifier(${bP()(t)}, ${bP()(Sq)})`}function Dq(e){if(!e)return;let t;return lP(e)?t={unit:e}:eP(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Cq(t.unit)&&(t.utc=!0,t.unit=t.unit.substr(3)),t}function _q(e){return e&&!!e.signal}function Mq(e){return!!e.step}function Tq(e){return!Qz(e)&&"field"in e&&"data"in e}const Oq=UP({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),Iq={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Fq=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Rq(e){return e&&!!e.field&&void 0!==e.equal}function Bq(e){return e&&!!e.field&&void 0!==e.lt}function zq(e){return e&&!!e.field&&void 0!==e.lte}function Pq(e){return e&&!!e.field&&void 0!==e.gt}function Lq(e){return e&&!!e.field&&void 0!==e.gte}function jq(e){if(e&&e.field){if(Qz(e.range)&&2===e.range.length)return!0;if(_q(e.range))return!0}return!1}function Uq(e){return e&&!!e.field&&(Qz(e.oneOf)||Qz(e.in))}function qq(e){return Uq(e)||Rq(e)||jq(e)||Bq(e)||Pq(e)||zq(e)||Lq(e)}function Wq(e,t){return WV(e,{timeUnit:t,wrapTime:!0})}function Vq(e,t=!0){var n;const{field:r}=e,i=null===(n=Dq(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+function(e,t,{end:n}={end:!1}){const r=XP(t),i=Cq(e)?"utc":"";let a;const o={};for(const t of Eq)Aq(e,t)&&(o[t]="quarter"===(s=t)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,a=t);var s;return n&&(o[a]+="+1"),function(e){const t=bq(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(o)}(i,r)+")":NV(e,{expr:"datum"});if(Rq(e))return a+"==="+Wq(e.equal,i);if(Bq(e))return`${a}<${Wq(e.lt,i)}`;if(Pq(e))return`${a}>${Wq(e.gt,i)}`;if(zq(e))return`${a}<=${Wq(e.lte,i)}`;if(Lq(e))return`${a}>=${Wq(e.gte,i)}`;if(Uq(e))return`indexof([${function(e,t){return e.map((e=>Wq(e,t)))}(e.oneOf,i).join(",")}], ${a}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return $q(a,e.valid);if(jq(e)){const{range:n}=e,r=_q(n)?{signal:`${n.signal}[0]`}:n[0],o=_q(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==r&&null!==o&&t)return"inrange("+a+", ["+Wq(r,i)+", "+Wq(o,i)+"])";const s=[];return null!==r&&s.push(`${a} >= ${Wq(r,i)}`),null!==o&&s.push(`${a} <= ${Wq(o,i)}`),s.length>0?s.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function $q(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function Hq(e){var t;return qq(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=Dq(e.timeUnit))||void 0===t?void 0:t.unit}):e}const Gq={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Kq=Gq.quantitative,Xq=Gq.ordinal,Yq=Gq.temporal,Jq=Gq.nominal,Zq=Gq.geojson,Qq=UP(Gq),eW="linear",tW="time",nW="utc",rW="point",iW={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},aW=UP(iW);function oW(e,t){const n=iW[e],r=iW[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}const sW={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function uW(e){return sW[e]}const cW=["linear","log","pow","sqrt","symlog","time","utc"],lW=pP(cW),fW=pP(["linear","log","pow","sqrt","symlog"]),pW=pP(["quantile","quantize","threshold"]),hW=pP(cW.concat(["quantile","quantize","threshold","sequential","identity"])),dW=pP(["ordinal","bin-ordinal","point","band"]);function mW(e){return e in dW}function gW(e){return e in hW}function vW(e){return e in lW}function yW(e){return e in pW}function bW(e){return null==e?void 0:e.selection}const xW={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:wW,domain:EW,range:CW,scheme:SW}=(UP(xW),xW),NW=hP(xW,["type","domain","range","scheme"]),AW=UP(NW);function kW(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!OP(["point","band","identity"],e);case"bins":return!OP(["point","band","identity","ordinal"],e);case"round":return vW(e)||"band"===e||"point"===e;case"padding":return vW(e)||OP(["point","band"],e);case"paddingOuter":case"align":return OP(["point","band"],e);case"paddingInner":return"band"===e;case"domainMid":case"clamp":return vW(e);case"nice":return vW(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return gW(e)&&!OP(["log","time","utc","threshold","quantile"],e)}}function DW(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Mj(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function _W(e,t){return OP([Xq,Jq],t)?void 0===e||mW(e):t===Yq?OP([tW,nW,void 0],e):t!==Kq||OP(["log","pow","sqrt","symlog","quantile","quantize","threshold",eW,void 0],e)}function MW(e,t){if(!DU(e))return!1;switch(e){case KL:case XL:case ej:case ZL:return vW(t)||OP(["band","point"],t);case lj:case mj:case pj:case hj:case dj:case fj:return vW(t)||yW(t)||OP(["band","point","ordinal"],t);case oj:case sj:case uj:return"band"!==t;case gj:return"ordinal"===t||yW(t);case cj:return"ordinal"===t}}function TW(e,t){return e+"_"+t}function OW(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,o=PW(e);return hV(n)&&!qL(n.aggregate)&&i&&vW(i.get("type"))&&!1===i.get("zero")?IW({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function IW({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return kL(n.type)||null===ZV("invalid",n,i)?r:[FW(e,t),r]}function FW(e,t){const n=RW(e,!0),r="y"===Hj(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function RW(e,t=!0){return $q(lP(e)?e:NV(e,{expr:"datum"}),!t)}function BW(e,t,n,r){const i={};if(t&&(i.scale=t),mV(e)){const{datum:t}=e;dq(t)?i.signal=xq(t):_q(t)?i.signal=t.signal:i.value=t}else i.field=NV(e,n);if(r){const{offset:e,band:t}=r;e&&(i.offset=e),t&&(i.band=t)}return i}function zW({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=NV(t,{expr:o,suffix:i}),u=void 0!==n?NV(n,{expr:o}):NV(t,{suffix:"end",expr:o}),c={};if(0===a||1===a){c.scale=e;const t=0===a?s:u;c.field=t}else{const t=`${a} * ${s} + ${1-a} * ${u}`;c.signal=`scale("${e}", ${t})`}return r&&(c.offset=r),c}function PW({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:u,defaultRef:c,band:l}){var f;if(t){if(yV(t)){if(bV(t)){l=null!=l?l:uV({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:s,config:i,isMidPoint:!0});const{bin:o,timeUnit:c,type:f}=t;if(FU(o)||l&&c&&f===Yq)return s&&s.impute?BW(t,a,{binSuffix:"mid"},{offset:u}):l?zW({scaleName:a,fieldOrDatumDef:t,band:l,offset:u}):BW(t,a,$V(t,e)?{binSuffix:"range"}:{},{offset:u});if(RU(o)){if(hV(n))return zW({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:l,offset:u});hq(cq(e===KL?YL:JL))}}const c=null==o?void 0:o.get("type");return BW(t,a,mW(c)?{binSuffix:"range"}:{},{offset:u,band:"band"===c?null!==(f=null!=l?l:t.band)&&void 0!==f?f:.5:void 0})}if(xV(t)){const n=t.value,r=u?{offset:u}:{};return Object.assign(Object.assign({},LW(e,n)),r)}}return"function"==typeof c&&(c=c()),c?Object.assign(Object.assign({},c),u?{offset:u}:{}):c}function LW(e,t){return OP(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:OP(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:KV(t)}function jW(e){return e&&"number"!==e&&"time"!==e}function UW(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}function qW({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){var o,s;if(jW(n))return VW({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const u=WW(e,r,i);if(qV(e)){const n=function(e,t,n,r,i){return!t||n?`${i?"utc":"time"}Format(${e}, '${n=lP(n)?n:r}')`:function(e,t,n){if(!e)return;const r=kq(e);return`${n||Cq(e)?"utc":"time"}Format(${t}, ${r})`}(t,e,i)}(u,hV(e)?null===(o=Dq(e.timeUnit))||void 0===o?void 0:o.unit:void 0,t,a.timeFormat,wV(e)&&(null===(s=e.scale)||void 0===s?void 0:s.type)===nW);return n?{signal:n}:void 0}return t=GW(dV(e),t,a),hV(e)&&FU(e.bin)?{signal:YW(u,NV(e,{expr:r,binSuffix:"end"}),t,n,a)}:t||"quantitative"===dV(e)?{signal:`${KW(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function WW(e,t,n){return hV(e)?n?`${NV(e,{expr:t,suffix:"end"})}-${NV(e,{expr:t,suffix:"start"})}`:NV(e,{expr:t}):function(e){const{datum:t}=e;return dq(t)?xq(t):`${JSON.stringify(t)}`}(e)}function VW({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:o}){return o=null!=o?o:WW(e,r,i),hV(e)&&FU(e.bin)?{signal:YW(o,NV(e,{expr:r,binSuffix:"end"}),t,n,a)}:{signal:UW(n,o,t)}}function $W(e,t,n,r,i,a){var o;if(!jW(r))return qV(e)?function(e,t,n,r){return e||(t?{signal:kq(t)}:r?void 0:n.timeFormat)}(n,hV(e)?null===(o=Dq(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a):GW(t,n,i)}function HW(e,t,n){return e&&(_q(e)||"number"===e||"time"===e)?e:qV(t)&&"time"!==n&&"utc"!==n?"time":void 0}function GW(e,t,n){return lP(t)?t:e===Kq?n.numberFormat:void 0}function KW(e,t){return`format(${e}, "${t||""}")`}function XW(e,t,n,r){var i;return jW(n)?UW(n,e,t):KW(e,null!==(i=lP(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function YW(e,t,n,r,i){const a=XW(e,n,r,i),o=XW(t,n,r,i);return`${$q(e,!1)} ? "null" : ${a} + "  " + ${o}`}!function(){var e;const t={};for(const n of Fj)for(const r of Qq)for(const i of aW){const a=TW(n,r);MW(n,i)&&_W(i,r)&&(t[a]=null!==(e=t[a])&&void 0!==e?e:[],t[a].push(i))}}();const JW="min",ZW={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function QW(e){return e in ZW}function eV(e){return!!e&&!!e.encoding}function tV(e){return!(!e||"count"!==e.op&&!e.field)}function nV(e){return!!e&&Qz(e)}function rV(e){return"row"in e||"column"in e}function iV(e){return!!e&&"header"in e}function aV(e){return"facet"in e}function oV(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function sV(e){return bV(e)&&"sort"in e}function uV({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:a,isMidPoint:o}){if(yV(t)&&void 0!==t.band)return t.band;if(hV(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return o?QV("timeUnitBandPosition",r,a):DL(r.type)?QV("timeUnitBand",r,a):0;if(FU(i))return DL(r.type)&&!o?1:.5}return(null==i?void 0:i.fieldChannel)===e&&o?.5:void 0}function cV(e,t,n,r,i,a){return!!(FU(t.bin)||t.timeUnit&&bV(t)&&"temporal"===t.type)&&!!uV({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function lV(e){return!!e&&"condition"in e}function fV(e){const t=e&&e.condition;return!!t&&!Qz(t)&&hV(t)}function pV(e){const t=e&&e.condition;return!!t&&!Qz(t)&&yV(t)}function hV(e){return!(!e||!e.field&&"count"!==e.aggregate)}function dV(e){return e&&e.type}function mV(e){return!!e&&"datum"in e}function gV(e){return bV(e)&&kV(e)||vV(e)}function vV(e){return mV(e)&&cP(e.datum)}function yV(e){return hV(e)||mV(e)}function bV(e){return!!e&&("field"in e&&"type"in e||"count"===e.aggregate)}function xV(e){return e&&"value"in e&&"value"in e}function wV(e){return!!e&&("scale"in e||"sort"in e)}function EV(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function CV(e){return!!e&&"legend"in e}function SV(e){return!!e&&("format"in e||"formatType"in e)}function NV(e,t={}){var n,r,i;let a=e.field;const o=t.prefix;let s=t.suffix,u="";if(function(e){return"count"===e.aggregate}(e))a=function(e){return 0===e.indexOf("__")}(c="count")?c:"__count";else{let o;if(!t.nofn)if(function(e){return"op"in e}(e))o=e.op;else{const{bin:c,aggregate:l,timeUnit:f}=e;FU(c)?(o=IU(c),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):l?LL(l)?(u=`["${a}"]`,a=`argmax_${l.argmax}`):PL(l)?(u=`["${a}"]`,a=`argmin_${l.argmin}`):o=String(l):f&&(o=function(e){const t=Dq(e),{utc:n}=t,r=hP(t,["utc"]);return r.unit?(n?"utc":"")+UP(r).map((e=>$P(`${"unit"===e?"":`_${e}_`}${r[e]}`))).join(""):(n?"utc":"")+"timeunit"+UP(r).map((e=>$P(`_${e}_${r[e]}`))).join("")}(f),s=(!OP(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}o&&(a=a?`${o}_${a}`:o)}var c;return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?QP(a):t.expr?function(e,t="datum"){return`${t}[${fP(Xz(e).join("."))}]`}(a,t.expr)+u:JP(a)+u}function AV(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return hV(e)&&!!e.bin;case"temporal":return!1}throw new Error(XU(e.type))}function kV(e){return!AV(e)}const DV=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(LL(t))return`${i} for argmax(${t.argmax})`;if(PL(t))return`${i} for argmin(${t.argmin})`;const a=Dq(r),o=t||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||FU(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n;const{field:r,bin:i,timeUnit:a,aggregate:o}=e;if("count"===o)return t.countTitle;if(FU(i))return`${r} (binned)`;if(a){const e=null===(n=Dq(a))||void 0===n?void 0:n.unit;if(e)return`${r} (${Nq(e).join("-")})`}else if(o)return LL(o)?`${r} for max ${o.argmax}`:PL(o)?`${r} for min ${o.argmin}`:`${KP(o)} of ${r}`;return r}(e,t)}};let _V=DV;function MV(e){_V=e}function TV(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,a;const o=(null!==(i=OV(e))&&void 0!==i?i:{}).title;if(!hV(e))return o;const s=e,u=r?IV(s,t):void 0;return n?tL(o,s.title,u):null!==(a=null!=o?o:s.title)&&void 0!==a?a:u}function OV(e){return EV(e)&&e.axis?e.axis:CV(e)&&e.legend?e.legend:iV(e)&&e.header?e.header:void 0}function IV(e,t){return _V(e,t)}function FV(e){var t;if(SV(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=OV(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function RV(e){return hV(e)?e:fV(e)?e.condition:void 0}function BV(e){return yV(e)?e:pV(e)?e.condition:void 0}function zV(e,t,n){return lP(e)||cP(e)||uP(e)?(hq(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${_P(n)}}.`}(t,lP(e)?"string":cP(e)?"number":"boolean",e)),{value:e}):yV(e)?PV(e,t,n):pV(e)?Object.assign(Object.assign({},e),{condition:PV(e.condition,t,n)}):e}function PV(e,t,n){if(SV(e)){const{format:r,formatType:i}=e,a=hP(e,["format","formatType"]);if(jW(i)&&!n.customFormatTypes)return hq(KU(t)),PV(a,t,n)}else{const r=EV(e)?"axis":CV(e)?"legend":iV(e)?"header":null;if(r&&e[r]){const i=e[r],{format:a,formatType:o}=i,s=hP(i,["format","formatType"]);if(jW(o)&&!n.customFormatTypes)return hq(KU(t)),PV(Object.assign(Object.assign({},e),{[r]:s}),t,n)}}return hV(e)?LV(e,t):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=cP(n)?"quantitative":lP(n)?"nominal":dq(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function LV(e,t){const{aggregate:n,timeUnit:r,bin:i,field:a}=e,o=Object.assign({},e);if(!n||jL(n)||LL(n)||PL(n)||(hq(function(e){return`Invalid aggregation operator "${e}".`}(n)),delete o.aggregate),r&&(o.timeUnit=Dq(r)),a&&(o.field=`${a}`),FU(i)&&(o.bin=jV(i,t)),RU(i)&&!pU(t)&&hq(`Channel ${t} should not be used with "binned" bin.`),bV(o)){const{type:e}=o,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case Kq:return"quantitative";case"t":case Yq:return"temporal";case"o":case Xq:return"ordinal";case"n":case Jq:return"nominal";case Zq:return"geojson"}}(e);e!==t&&(o.type=t),"quantitative"!==e&&qL(n)&&(hq(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,n)),o.type="quantitative")}else if(!$j(t)){const e=function(e,t){if(e.timeUnit)return"temporal";if(FU(e.bin))return"quantitative";switch(OU(t)){case"continuous":default:return"quantitative";case"discrete":case"flexible":return"nominal"}}(o,t);hq(function(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}(t,e)),o.type=e}if(bV(o)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case $L:case HL:case GL:return kV(e)?{compatible:!1,warning:QU(t)}:UV;case KL:case XL:case oj:case sj:case uj:case vj:case bj:case xj:case wj:case Ej:case Cj:case fj:case ej:case ZL:case Sj:return UV;case rj:case aj:case nj:case ij:return n!==Kq?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:UV;case pj:case hj:case dj:case mj:case lj:case tj:case QL:case YL:case JL:return"nominal"!==n||e.sort?UV:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case gj:return OP(["ordinal","nominal"],e.type)?UV:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case cj:return OP(["ordinal","nominal","geojson"],e.type)?UV:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case yj:return"nominal"!==e.type||"sort"in e?UV:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(o,t);e||hq(n)}if(sV(o)&&lP(o.sort)){const{sort:e}=o;if(QW(e))return Object.assign(Object.assign({},o),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&QW(t))return Object.assign(Object.assign({},o),{sort:{encoding:t,order:"descending"}})}if(iV(o)){const{header:e}=o,{orient:t}=e,n=hP(e,["orient"]);if(t)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return o}function jV(e,t){return uP(e)?{maxbins:PU(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:PU(t)})}const UV={compatible:!0};function qV(e){const{formatType:t}=FV(e);return"time"===t||!t&&function(e){return e&&("temporal"===e.type||hV(e)&&!!e.timeUnit)}(e)}function WV(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var a;const o=t&&(null===(a=Dq(t))||void 0===a?void 0:a.unit);let s,u=o||"temporal"===n;return _q(e)?s=e.signal:dq(e)?(u=!0,s=xq(e)):(lP(e)||cP(e))&&u&&(s=`datetime(${JSON.stringify(e)})`,function(e){return!!wq[e]}(o)&&(cP(e)&&e<1e4||lP(e)&&isNaN(Date.parse(e)))&&(s=xq({[o]:e}))),s?r&&u?`time(${s})`:s:i?void 0:JSON.stringify(e)}function VV(e,t){const{type:n}=e;return t.map((t=>{const r=WV(t,{timeUnit:hV(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t}))}function $V(e,t){return FU(e.bin)?DU(t)&&OP(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function HV(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:u,subtitleFontStyle:c,subtitleFontWeight:l,subtitleLineHeight:f,subtitlePadding:p}=e,h=hP(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),d=Object.assign(Object.assign({},h),a?{fill:a}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),u?{subtitleFontSize:u}:{}),c?{subtitleFontStyle:c}:{}),l?{subtitleFontWeight:l}:{}),f?{subtitleLineHeight:f}:{}),p?{subtitlePadding:p}:{});return{titleMarkConfig:d,subtitleMarkConfig:kP(d,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function GV(e){return lP(e)||Qz(e)&&lP(e[0])}function KV(e){return _q(e)?e:void 0!==e?{value:e}:void 0}function XV(e){return _q(e)?e.signal:fP(e.value)}function YV(e){return _q(e)?e.signal:null==e?null:fP(e)}function JV(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function ZV(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?QV(e,t,n,r):void 0}function QV(e,t,n,{vgChannel:r}={}){return tL(r?e$(e,t,n.style):void 0,e$(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function e$(e,t,n){return t$(e,JV(t),n)}function t$(e,t,n){let r;t=aP(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}function n$(e,t){return aP(e).reduce(((e,n)=>{var r;return e.field.push(NV(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e}),{field:[],order:[]})}function r$(e,t){const n=[...e];return t.forEach((e=>{for(const t of n)if(NP(t,e))return;n.push(e)})),n}function i$(e,t){return NP(e,t)||!t?e:e?[...aP(e),...aP(t)].join(", "):t}function a$(e,t){const n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((GV(n)||_q(n))&&(GV(r)||_q(r)))return{explicit:e.explicit,value:i$(n,r)};if(GV(n)||_q(n))return{explicit:e.explicit,value:n};if(GV(r)||_q(r))return{explicit:e.explicit,value:r};if(!(GV(n)||_q(n)||GV(r)||_q(r)))return{explicit:e.explicit,value:r$(n,r)};throw new Error("It should never reach here")}function o$(e,t){const n=e&&e[t];return!!n&&(Qz(n)?IP(n,(e=>!!e.field)):hV(n)||fV(n))}function s$(e){return IP(Fj,(t=>{if(o$(e,t)){const n=e[t];if(Qz(n))return IP(n,(e=>!!e.aggregate));{const e=RV(n);return e&&!!e.aggregate}}return!1}))}function u$(e,t){const n=[],r=[],i=[],a=[],o={};return f$(e,((s,u)=>{if(hV(s)){const{field:c,aggregate:l,bin:f,timeUnit:p}=s,h=hP(s,["field","aggregate","bin","timeUnit"]);if(l||p||f){const e=OV(s),d=e&&e.title;let m=NV(s,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},d?[]:{title:TV(s,t,{allowDisabling:!0})}),h),{field:m});if(l){let e;if(LL(l)?(e="argmax",m=NV({op:"argmax",field:l.argmax},{forAs:!0}),g.field=`${m}.${c}`):PL(l)?(e="argmin",m=NV({op:"argmin",field:l.argmin},{forAs:!0}),g.field=`${m}.${c}`):"boxplot"!==l&&"errorbar"!==l&&"errorband"!==l&&(e=l),e){const t={op:e,as:m};c&&(t.field=c),a.push(t)}}else if(n.push(m),bV(s)&&FU(f)){if(r.push({bin:f,field:c,as:m}),n.push(NV(s,{binSuffix:"end"})),$V(s,u)&&n.push(NV(s,{binSuffix:"range"})),pU(u)){const e={field:m+"_end"};o[u+"2"]=e}g.bin="binned",$j(u)||(g.type=Kq)}else if(p){i.push({timeUnit:p,field:c,as:m});const e=bV(s)&&s.type!==Yq&&"time";e&&(u===vj||u===wj?g.formatType=e:function(e){return!!uU[e]}(u)?g.legend=Object.assign({formatType:e},g.legend):pU(u)&&(g.axis=Object.assign({formatType:e},g.axis)))}o[u]=g}else n.push(c),o[u]=e[u]}else o[u]=e[u]})),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function c$(e,t,n){const r=t.type;return UP(e).reduce(((i,a)=>{if(!Wj(a))return hq(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(a)),i;const o=e[a];if("angle"!==a||"arc"!==r||e.theta||(hq("Arc marks uses theta channel rather than angle, replacing angle with theta."),a=ej),!function(e,t,n){const r=function(e,t){return function(e){switch(e){case oj:case sj:case uj:case Sj:case bj:case xj:case wj:case Ej:case yj:case pj:case hj:case dj:case mj:case GL:case $L:case HL:return _U;case KL:case XL:case nj:case rj:return TU;case YL:case JL:case ij:case aj:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case lj:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case gj:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case cj:return{point:"always",geoshape:"always"};case vj:return{text:"always"};case fj:return{point:"always",square:"always",text:"always"};case Cj:return{image:"always"};case ej:case ZL:return{text:"always",arc:"always"};case tj:case QL:return{arc:"always"}}}(e)[t]}(t,n);if(!r)return!1;if("binned"===r){const n=e[t===YL?KL:XL];return!!(hV(n)&&hV(e[t])&&RU(n.bin))}return!0}(e,a,r))return hq(ZU(a,r)),i;if(a===lj&&"line"===r){const t=RV(e[a]);if(null==t?void 0:t.aggregate)return hq("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),i}if(a===oj&&(t.filled?"fill"in e:"stroke"in e))return hq(YU("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===bj||a===yj&&!Qz(o)&&!xV(o)||a===wj&&Qz(o))o&&(i[a]=aP(o).reduce(((e,t)=>(hV(t)?e.push(LV(t,a)):hq(JU(t,a)),e)),[]));else{if(a===wj&&null===o)i[a]=null;else if(!(hV(o)||mV(o)||xV(o)||lV(o)||_q(o)))return hq(JU(o,a)),i;i[a]=zV(o,a,n)}return i}),{})}function l$(e){const t=[];for(const n of UP(e))if(o$(e,n)){const r=aP(e[n]);for(const e of r)hV(e)?t.push(e):fV(e)&&t.push(e.condition)}return t}function f$(e,t,n){if(e)for(const r of UP(e)){const i=e[r];if(Qz(i))for(const e of i)t.call(n,e,r);else t.call(n,i,r)}}function p$(e,t,n,r){return e?UP(e).reduce(((n,i)=>{const a=e[i];return Qz(a)?a.reduce(((e,n)=>t.call(r,e,n,i)),n):t.call(r,n,a,i)}),n):n}function h$(e,t){return UP(t).reduce(((n,r)=>{switch(r){case KL:case XL:case Ej:case Sj:case Cj:case YL:case JL:case ej:case tj:case ZL:case QL:case nj:case rj:case ij:case aj:case vj:case cj:case fj:case wj:return n;case yj:if("line"===e||"trail"===e)return n;case bj:case xj:{const e=t[r];if(Qz(e)||hV(e))for(const t of aP(e))t.aggregate||n.push(NV(t,{}));return n}case lj:if("trail"===e)return n;case oj:case sj:case uj:case pj:case hj:case dj:case gj:case mj:{const e=RV(t[r]);return e&&!e.aggregate&&n.push(NV(e,{})),n}}}),[])}function d$(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map((({fieldPrefix:e,titlePrefix:n})=>{const i=r?` of ${t.field}`:"";return{field:e+t.field,type:t.type,title:_q(n)?{signal:n+`"${escape(i)}"`}:n+i}})),...l$(n)]}}function m$(e){const{axis:t,title:n,field:r}=e;return t&&void 0!==t.title?void 0:tL(n,r)}function g$(e,t,n,r,i){const{scale:a,axis:o}=n;return({partName:s,mark:u,positionPrefix:c,endPositionPrefix:l,aria:f,extraEncoding:p={}})=>{const h=m$(n);return v$(e,s,i,f,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:c+"_"+n.field,type:n.type},void 0!==h?{title:h}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})},lP(l)?{[t+"2"]:{field:l+"_"+n.field}}:{}),r),p)})}}function v$(e,t,n,r,i){const{clip:a,color:o,opacity:s}=e,u=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),a?{clip:a}:{}),o?{color:o}:{}),s?{opacity:s}:{}),ML(i.mark)?i.mark:{type:i.mark}),{style:`${u}-${t}`}),uP(e[t])?{}:e[t]),!1===r?{aria:r}:{})})]:[]}function y$(e,t,n){const{encoding:r}=e,i="vertical"===t?"y":"x",a=r[i],o=r[i+"2"],s=r[i+"Error"],u=r[i+"Error2"];return{continuousAxisChannelDef:b$(a,n),continuousAxisChannelDef2:b$(o,n),continuousAxisChannelDefError:b$(s,n),continuousAxisChannelDefError2:b$(u,n),continuousAxis:i}}function b$(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=hP(e,["aggregate"]);return n!==t&&hq(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),r}return e}function x$(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(gV(i)){if(gV(a)){const e=hV(i)&&i.aggregate,r=hV(a)&&a.aggregate;if(e||r!==t){if(r||e!==t){if(e===t&&r===t)throw new Error("Both x and y cannot have aggregate");return ML(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(gV(a))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const w$="boxplot",E$=new RL(w$,S$);function C$(e){return cP(e)?"tukey":e}function S$(e,{config:t}){var n,r;const{mark:i,encoding:a,selection:o,projection:s}=e,u=hP(e,["mark","encoding","selection","projection"]),c=ML(i)?i:{type:i};o&&hq($U("boxplot"));const l=null!==(n=c.extent)&&void 0!==n?n:t.boxplot.extent,f=ZV("size",c,t),p=C$(l),{transform:h,continuousAxisChannelDef:d,continuousAxis:m,groupby:g,aggregate:v,encodingWithoutContinuousAxis:y,ticksOrient:b,boxOrient:x,customTooltipWithoutAggregatedField:w}=function(e,t,n){const r=x$(e,w$),{continuousAxisChannelDef:i,continuousAxis:a}=y$(e,r,w$),o=i.field,s=C$(t),u=[...N$(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],c="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],l=e.encoding,f=a,p=(l[f],hP(l,["symbol"==typeof f?f:f+""])),{customTooltipWithoutAggregatedField:h,filteredEncoding:d}=function(e){const{tooltip:t}=e,n=hP(e,["tooltip"]);if(!t)return{filteredEncoding:e};let r,i;if(Qz(t)){for(const e of t)e.aggregate?(r||(r=[]),r.push(e)):(i||(i=[]),i.push(e));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return Qz(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(p),{bins:m,timeUnits:g,aggregate:v,groupby:y,encoding:b}=u$(d,n),x="vertical"===r?"horizontal":"vertical",w=r;return{transform:[...m,...g,{aggregate:[...v,...u],groupby:y},...c],groupby:y,aggregate:v,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:h}}(e,l,t),{color:E,size:C}=y,S=hP(y,["color","size"]),N=e=>g$(c,m,d,e,t.boxplot),A=N(S),k=N(y),D=N(Object.assign(Object.assign({},S),C?{size:C}:{})),_=d$([{fieldPrefix:"min-max"===p?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===p?"lower_whisker_":"min_",titlePrefix:"Min"}],d,y),M={type:"tick",color:"black",opacity:1,orient:b,invalid:null},T="min-max"===p?_:d$([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],d,y),O=[...A({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:T}),...A({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:T}),...A({partName:"ticks",mark:M,positionPrefix:"lower_whisker",aria:!1,extraEncoding:T}),...A({partName:"ticks",mark:M,positionPrefix:"upper_whisker",aria:!1,extraEncoding:T})],I=[..."tukey"!==p?O:[],...k({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:x,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:_}),...D({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},eP(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:_})];let F;if("min-max"!==p){const e=`datum["lower_box_${d.field}"]`,n=`datum["upper_box_${d.field}"]`,r=`(${n} - ${e})`,i=`${e} - ${l} * ${r}`,a=`${n} + ${l} * ${r}`,o=`datum["${d.field}"]`,s={joinaggregate:N$(d.field),groupby:g};let u;"tukey"===p&&(u={transform:[{filter:`(${i} <= ${o}) && (${o} <= ${a})`},{aggregate:[{op:"min",field:d.field,as:"lower_whisker_"+d.field},{op:"max",field:d.field,as:"upper_whisker_"+d.field},{op:"min",field:"lower_box_"+d.field,as:"lower_box_"+d.field},{op:"max",field:"upper_box_"+d.field,as:"upper_box_"+d.field},...v],groupby:g}],layer:O});const{tooltip:f}=S,h=hP(S,["tooltip"]),{scale:y,axis:b}=d,x=m$(d),E=v$(c,"outliers",t.boxplot,!0,{transform:[{filter:`(${o} < ${i}) || (${o} > ${a})`}],mark:"point",encoding:Object.assign(Object.assign({[m]:Object.assign(Object.assign(Object.assign({field:d.field,type:d.type},void 0!==x?{title:x}:{}),void 0!==y?{scale:y}:{}),void 0!==b?{axis:b}:{})},h),w?{tooltip:w}:{})})[0];E&&u?F={transform:[s],layer:[E,u]}:E?(F=E,F.transform.unshift(s)):u&&(F=u,F.transform.unshift(s))}return F?Object.assign(Object.assign({},u),{layer:[F,{transform:h,layer:I}]}):Object.assign(Object.assign({},u),{transform:(null!==(r=u.transform)&&void 0!==r?r:[]).concat(h),layer:I})}function N$(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const A$="errorbar",k$=new RL(A$,D$);function D$(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:u,tooltipEncoding:c}=_$(e,A$,t),l=g$(s,i,r,a,t.errorbar),f={type:"tick",orient:o},p=[...l({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:c}),...l({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:c}),...l({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function _$(e,t,n){var r;const{mark:i,encoding:a,selection:o,projection:s}=e,u=hP(e,["mark","encoding","selection","projection"]),c=ML(i)?i:{type:i};o&&hq($U(t));const{orient:l,inputType:f}=function(e,t){const{encoding:n}=e;if(function(e){return(yV(e.x)||yV(e.y))&&!yV(e.x2)&&!yV(e.y2)&&!yV(e.xError)&&!yV(e.xError2)&&!yV(e.yError)&&!yV(e.yError2)}(n))return{orient:x$(e,t),inputType:"raw"};const r=function(e){return yV(e.x2)||yV(e.y2)}(n),i=function(e){return yV(e.xError)||yV(e.xError2)||yV(e.yError)||yV(e.yError2)}(n),a=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const e=n.x2,r=n.y2;if(yV(e)&&yV(r))throw new Error(`${t} cannot have both x2 and y2`);if(yV(e)){if(gV(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(yV(r)){if(gV(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const e=n.xError,r=n.xError2,i=n.yError,s=n.yError2;if(yV(r)&&!yV(e))throw new Error(`${t} cannot have xError2 without xError`);if(yV(s)&&!yV(i))throw new Error(`${t} cannot have yError2 without yError`);if(yV(e)&&yV(i))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(yV(e)){if(gV(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(yV(i)){if(gV(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}(e,t),{continuousAxisChannelDef:p,continuousAxisChannelDef2:h,continuousAxisChannelDefError:d,continuousAxisChannelDefError2:m,continuousAxis:g}=y$(e,l,t),{errorBarSpecificAggregate:v,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,r,i,a,o,s){let u=[],c=[];const l=t.field;let f,p=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&hq(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,o)),"stderr"===n||"stdev"===n)u=[{op:n,field:l,as:"extent_"+l},{op:t,field:l,as:"center_"+l}],c=[{calculate:`datum["center_${l}"] + datum["extent_${l}"]`,as:"upper_"+l},{calculate:`datum["center_${l}"] - datum["extent_${l}"]`,as:"lower_"+l}],f=[{fieldPrefix:"center_",titlePrefix:KP(t)},{fieldPrefix:"upper_",titlePrefix:M$(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:M$(t,n,"-")}],p=!0;else{let t,r,i;e.center&&e.extent&&hq(function(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}(e.extent,o)),"ci"===n?(t="mean",r="ci0",i="ci1"):(t="median",r="q1",i="q3"),u=[{op:r,field:l,as:"lower_"+l},{op:i,field:l,as:"upper_"+l},{op:t,field:l,as:"center_"+l}],f=[{fieldPrefix:"upper_",titlePrefix:TV({field:l,aggregate:i,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:TV({field:l,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:TV({field:l,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&hq(function(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}(e.center,e.extent)),"aggregated-upper-lower"===a?(f=[],c=[{calculate:`datum["${n.field}"]`,as:"upper_"+l},{calculate:`datum["${l}"]`,as:"lower_"+l}]):"aggregated-error"===a&&(f=[{fieldPrefix:"",titlePrefix:l}],c=[{calculate:`datum["${l}"] + datum["${r.field}"]`,as:"upper_"+l}],i?c.push({calculate:`datum["${l}"] + datum["${i.field}"]`,as:"lower_"+l}):c.push({calculate:`datum["${l}"] - datum["${r.field}"]`,as:"lower_"+l}));for(const e of c)f.push({fieldPrefix:e.as.substring(0,6),titlePrefix:ZP(ZP(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:c,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:p}}(c,p,h,d,m,f,t,n),w=a,E=g,C=(w[E],"x"===g?"x2":"y2"),S=(w[C],"x"===g?"xError":"yError"),N=(w[S],"x"===g?"xError2":"yError2"),A=(w[N],hP(w,["symbol"==typeof E?E:E+"","symbol"==typeof C?C:C+"","symbol"==typeof S?S:S+"","symbol"==typeof N?N:N+""])),{bins:k,timeUnits:D,aggregate:_,groupby:M,encoding:T}=u$(A,n),O=[..._,...v],I="raw"!==f?[]:M,F=d$(b,p,T,x);return{transform:[...null!==(r=u.transform)&&void 0!==r?r:[],...k,...D,...0===O.length?[]:[{aggregate:O,groupby:I}],...y],groupby:I,continuousAxisChannelDef:p,continuousAxis:g,encodingWithoutContinuousAxis:T,ticksOrient:"vertical"===l?"horizontal":"vertical",markDef:c,outerSpec:u,tooltipEncoding:F}}function M$(e,t,n){return KP(e)+" "+n+" "+t}const T$="errorband",O$=new RL(T$,I$);function I$(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:u}=_$(e,T$,t),c=o,l=g$(c,i,r,a,t.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let p={type:f?"area":"rect"},h={type:f?"line":"rule"};const d=Object.assign(Object.assign({},c.interpolate?{interpolate:c.interpolate}:{}),c.tension&&c.interpolate?{tension:c.tension}:{});return f?(p=Object.assign(Object.assign(Object.assign({},p),d),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign({},h),d)):c.interpolate?hq(uq("interpolate")):c.tension&&hq(uq("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...l({partName:"band",mark:p,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...l({partName:"borders",mark:h,positionPrefix:"lower",aria:!1,extraEncoding:u}),...l({partName:"borders",mark:h,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const F$={};function R$(e,t,n){const r=new RL(e,t);F$[e]={normalizer:r,parts:n}}R$(w$,S$,["box","median","outliers","rule","ticks"]),R$(A$,D$,["ticks","rule"]),R$(T$,I$,["band","borders"]);const B$=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],z$=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],P$={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},L$={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},j$=(UP(L$),"_vgsid_"),U$={single:{on:"click",fields:[j$],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[j$],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function q$(e){return!(!e||"legend"!==e&&!e.legend)}function W$(e){return q$(e)&&eP(e)}function V$(e){return"concat"in e}function $$(e){return"vconcat"in e}function H$(e){return"hconcat"in e}function G$(e){return eP(e)&&void 0!==e.step}function K$(e){return e.view||e.width||e.height}const X$=UP({align:1,bounds:1,center:1,columns:1,spacing:1});function Y$(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function J$(e,t){const n=Z$(e,t);return G$(n)?n.step:Q$}function Z$(e,t){var n;return tL(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const Q$=20,eH={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:Q$},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:U$,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},tH=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],nH={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},rH={blue:tH[0],orange:tH[1],red:tH[2],teal:tH[3],green:tH[4],yellow:tH[5],purple:tH[6],pink:tH[7],brown:tH[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function iH(e={}){const{color:t,font:n,fontSize:r}=e,i=hP(e,["color","font","fontSize"]);return nP({},eH,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:eP(e)?Object.assign(Object.assign({},rH),e):rH}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:eP(e)?Object.assign(Object.assign({},nH),e):nH}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{})}const aH=["view",..._L],oH=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],sH=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function uH(e,t,n,r){const i=r?e[t][r]:e[t];"view"===t&&(n="cell");const a=Object.assign(Object.assign({},i),e.style[null!=n?n:t]);jP(a)||(e.style[null!=n?n:t]=a),r||delete e[t]}function cH(e){return"layer"in e}class lH{map(e,t){return aV(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):H$(e)?this.mapHConcat(e,t):$$(e)?this.mapVConcat(e,t):V$(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(cH(e))return this.mapLayer(e,t);if(FL(e))return this.mapUnit(e,t);throw new Error(LU(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map((e=>this.mapLayerOrUnit(e,t)))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map((e=>this.map(e,t)))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map((e=>this.map(e,t)))})}mapConcat(e,t){const{concat:n}=e,r=hP(e,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map((e=>this.map(e,t)))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const fH={zero:1,center:1,normalize:1},pH=new Set([hL,mL,dL,xL,yL,SL,NL,vL,wL,EL]),hH=new Set([mL,dL,hL]);function dH(e,t){var n,r;const i="x"===t?"y":"radius",a=e[t],o=e[i];if(hV(a)&&hV(o))if("quantitative"===dV(a)&&"quantitative"===dV(o)){if(a.stack)return t;if(o.stack)return i;const e=hV(a)&&!!a.aggregate;if(e!==(hV(o)&&!!o.aggregate))return e?t:i;{const e=null===(n=a.scale)||void 0===n?void 0:n.type,s=null===(r=o.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(s&&"linear"!==s)return t}}else{if("quantitative"===dV(a))return t;if("quantitative"===dV(o))return i}else{if("quantitative"===dV(a))return t;if("quantitative"===dV(o))return i}}function mH(e,t,n={}){const r=ML(e)?e.type:e;if(!pH.has(r))return null;const i=dH(t,"x")||dH(t,"theta");if(!i)return null;const a=t[i],o=hV(a)?NV(a,{}):void 0;let s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),u=t[s],c=hV(u)?NV(u,{}):void 0;c===o&&(c=void 0,u=void 0,s=void 0);const l=cU.reduce(((e,n)=>{if("tooltip"!==n&&o$(t,n)){const r=t[n];for(const t of aP(r)){const r=RV(t);if(r.aggregate)continue;const i=NV(r,{});i&&i===c||e.push({channel:n,fieldDef:r})}}return e}),[]);let f;if(void 0!==a.stack?f=uP(a.stack)?a.stack?"zero":null:a.stack:l.length>0&&hH.has(r)&&(f="zero"),!f||!(f in fH))return null;var p;if(s$(t)&&0===l.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==eW){if(n.disallowNonLinearStack)return null;hq(function(e){return`Cannot stack non-linear scale (${e}).`}(a.scale.type))}return yV(t[Kj(i)])?(void 0!==a.stack&&hq(`Cannot stack "${p=i}" if there is already "${p}2".`),null):(hV(a)&&a.aggregate&&!OP(WL,a.aggregate)&&hq(`Stacking is applied even though the aggregate function is non-summative ("${a.aggregate}").`),{groupbyChannel:u?s:void 0,groupbyField:c,fieldChannel:i,impute:null!==a.impute&&kL(r),stackBy:l,offset:f})}function gH(e){const{point:t,line:n}=e,r=hP(e,["point","line"]);return UP(r).length>1?r:r.type}function vH(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:DP(e[t],["point","line"])}));return e}function yH(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?eP(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?eP(t.point)?t.point:{}:void 0}function bH(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class xH{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(FL(e)){const{mark:n,encoding:r}=e,i=ML(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!yH(i,t[i.type],r);case"area":return!!yH(i,t[i.type],r)||!!bH(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{selection:i,projection:a,encoding:o,mark:s}=e,u=hP(e,["selection","projection","encoding","mark"]),c=ML(s)?s:{type:s},l=yH(c,r[c.type],o),f="area"===c.type&&bH(c,r[c.type]),p=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:gH(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:DP(o,["shape"])})],h=mH(c,o);let d=o;if(h){const{fieldChannel:e,offset:t}=h;d=Object.assign(Object.assign({},o),{[e]:Object.assign(Object.assign({},o[e]),t?{stack:t}:{})})}return f&&p.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},kP(c,["clip","interpolate","tension","tooltip"])),f),encoding:d})),l&&p.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},kP(c,["clip","tooltip"])),l),encoding:d})),n(Object.assign(Object.assign({},u),{layer:p}),Object.assign(Object.assign({},t),{config:vH(r)}))}}class wH{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(FL(e)&&e.encoding)for(const n of fU){const r=e.encoding[n];if(r&&yV(r)&&(null===(t=null==r?void 0:r.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let r=Object.assign({},e.encoding);for(const e of fU){const i=Xj(e),a=r[e];if(a&&yV(a)&&(null===(t=null==a?void 0:a.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=a,o=hP(a,["scale"]),s=t,{rangeStep:u}=s,c=hP(s,["rangeStep"]);n[i]={step:t.rangeStep},hq('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),r=Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},o),jP(c)?{}:{scale:c})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:r})}}function EH(e,t){return t?rV(e)?DH(e,t):NH(e,t):e}function CH(e,t){return t?DH(e,t):e}function SH(e,t,n){const r=t[e];return(i=r)&&!lP(i)&&"repeat"in i?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void hq(function(e){return`Unknown repeated value "${e}".`}(r.repeat)):t;var i}function NH(e,t){if(void 0!==(e=SH("field",e,t))){if(null===e)return null;if(sV(e)&&tV(e.sort)){const n=SH("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function AH(e,t){if(hV(e))return NH(e,t);{const n=SH("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function kH(e,t){if(!yV(e)){if(pV(e)){const n=AH(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const{condition:t}=e;return hP(e,["condition"])}}return e}{const n=AH(e,t);if(n)return n;if(lV(e))return{condition:e.condition}}}function DH(e,t){const n={};for(const r in e)if(sP(e,r)){const i=e[r];if(Qz(i))n[r]=i.map((e=>kH(e,t))).filter((e=>e));else{const e=kH(i,t);void 0!==e&&(n[r]=e)}}return n}class _H{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(FL(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of Vj){const n=t[Hj(e)];if(t[e]&&(hV(n)&&!RU(n.bin)||mV(n)))return!0}}return!1}run(e,t,n){const{encoding:r}=e;var i,a;return hq((i=!!r.x2,a=!!r.y2,`Line mark is for continuous lines and thus cannot be used with ${i&&a?"x2 and y2":i?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}function MH(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const e=UP(t).reduce(((e,t)=>(n[t]&&e.push(t),e)),[]);e.length>0&&hq(`Layer's shared ${(r=e).join(",")} channel ${1===r.length?"is":"are"} overriden.`)}var r;const i=Object.assign(Object.assign({},null!=t?t:{}),null!=n?n:{});return jP(i)?void 0:i}function TH(e){const{parentProjection:t,projection:n}=e;return t&&n&&hq(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${_P(t)} is overridden by a child projection ${_P(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function OH(e,t){void 0===t&&(t=iH(e.config));const n=function(e,t={}){return IH.map(e,{config:t})}(e,t),{width:r,height:i}=e,a=function(e,t,n){let{width:r,height:i}=t;const a=FL(e)||cH(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(hq(jU("width")),r=void 0),"container"==i&&(hq(jU("height")),i=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?FH(n.autosize):{}),FH(e.autosize));if("fit"!==s.type||a||(hq('Autosize "fit" only works for single views and layered views.'),s.type="pad"),"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&hq(UU("width")),"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&hq(UU("height")),!NP(s,{type:"pad"}))return s}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const IH=new class extends lH{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[E$,k$,O$,new xH,new _H,new wH]}map(e,t){if(FL(e)){const n=o$(e.encoding,$L),r=o$(e.encoding,HL),i=o$(e.encoding,GL);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=Object.assign(Object.assign({},e),{encoding:CH(e.encoding,t.repeater)});if(n||r)return this.mapUnitWithParentEncodingOrProjection(i,t);const a=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(i,t.config))return e.run(i,t,a);return i}mapRepeat(e,t){return function(e){return!Qz(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=hP(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:u={},repeaterPrefix:c=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:r}}),t):Object.assign(Object.assign({},i),{layer:s.map((e=>{const n=Object.assign(Object.assign({},u),{layer:e}),i=(r.name||"")+c+`child__layer_${$P(e)}`,a=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:i}));return a.name=i,a}))})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:a}=e,o=hP(e,["repeat","spec","data"]);!Qz(r)&&e.columns&&(e=DP(e,["columns"]),hq(HU("repeat")));const s=[],{repeater:u={},repeaterPrefix:c=""}=t,l=!Qz(r)&&r.row||[u?u.row:null],f=!Qz(r)&&r.column||[u?u.column:null],p=Qz(r)&&r||[u?u.repeat:null];for(const e of p)for(const n of l)for(const a of f){const o={repeat:e,row:n,column:a,layer:u.layer},l=(i.name||"")+c+"child__"+(Qz(r)?`${$P(e)}`:(r.row?`row_${$P(n)}`:"")+(r.column?`column_${$P(a)}`:"")),f=this.map(i,Object.assign(Object.assign({},t),{repeater:o,repeaterPrefix:l}));f.name=l,s.push(DP(f,["data"]))}const h=Qz(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return rV(n)&&e.columns&&(e=DP(e,["columns"]),hq(HU("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:o}=t,s=TH({parentProjection:a,projection:r}),u=MH({parentEncoding:i,encoding:CH(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),u?{encoding:u}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:a}=n,o=hP(n,["row","column","facet"]),{mark:s,width:u,projection:c,height:l,view:f,selection:p,encoding:h}=e,d=hP(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),v=CH(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},d),g),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),l?{height:l}:{}),f?{view:f}:{}),c?{projection:c}:{}),{mark:s,encoding:v}),p?{selection:p}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:a}=e;if(r||i){a&&hq(`Facet encoding dropped as ${(o=[...r?[$L]:[],...i?[HL]:[]]).join(" and ")} ${o.length>1?"are":"is"} also specified.`);const t={},s={};for(const r of[$L,HL]){const i=e[r];if(i){const{align:e,center:a,spacing:o,columns:u}=i,c=hP(i,["align","center","spacing","columns"]);t[r]=c;for(const e of["align","center","spacing"])void 0!==i[e]&&(s[e]=null!==(n=s[e])&&void 0!==n?n:{},s[e][r]=i[e])}}return{facetMapping:t,layout:s}}{const{align:e,center:n,spacing:r,columns:i}=a;return{facetMapping:EH(hP(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}var o}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=hP(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=hP(e,["encoding","projection"]),u=Object.assign(Object.assign({},i),{parentEncoding:MH({parentEncoding:n,encoding:a}),parentProjection:TH({parentProjection:r,projection:o})});return super.mapLayer(s,u)}};function FH(e){return lP(e)?{type:e}:null!=e?e:{}}const RH=["background","padding"];function BH(e){return RH.reduce(((t,n)=>(e&&void 0!==e[n]&&(t[n]=e[n]),t)),{})}class zH{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new zH(AP(this.explicit),AP(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return tL(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of UP(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function PH(e){return{explicit:!0,value:e}}function LH(e){return{explicit:!1,value:e}}function jH(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:UH(t,n,r,i)}}function UH(e,t,n,r){return e.explicit&&t.explicit&&hq(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${_P(n)} and ${_P(r)}). Using ${_P(n)}.`}(n,r,e.value,t.value)),e}function qH(e,t,n,r,i=UH){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:NP(e.value,t.value)?e:i(e,t,n,r)}class WH extends zH{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function VH(e){return"url"in e}function $H(e){return"values"in e}function HH(e){return"name"in e&&!VH(e)&&!$H(e)&&!GH(e)}function GH(e){return e&&(KH(e)||XH(e)||YH(e))}function KH(e){return"sequence"in e}function XH(e){return"sphere"in e}function YH(e){return"graticule"in e}const JH="main",ZH="raw";function QH(e){return"filter"in e}function eG(e){return"lookup"in e}function tG(e){return"pivot"in e}function nG(e){return"density"in e}function rG(e){return"quantile"in e}function iG(e){return"regression"in e}function aG(e){return"loess"in e}function oG(e){return"sample"in e}function sG(e){return"window"in e}function uG(e){return"joinaggregate"in e}function cG(e){return"flatten"in e}function lG(e){return"calculate"in e}function fG(e){return"bin"in e}function pG(e){return"impute"in e}function hG(e){return"timeUnit"in e}function dG(e){return"aggregate"in e}function mG(e){return"stack"in e}function gG(e){return"fold"in e}function vG(e,t,n,r){const i=lV(t)&&t.condition,a=r(t);if(i){const t=aP(i).map((t=>{const n=r(t),i=function(e){return e.selection}(t)?WX(e,t.selection):$X(e,t.test);return Object.assign({test:i},n)}));return{[n]:[...t,...void 0!==a?[a]:[]]}}return void 0!==a?{[n]:a}:{}}function yG(e,t="text"){const n=e.encoding[t];return vG(e,n,t,(t=>bG(t,e.config)))}function bG(e,t,n="datum"){if(e){if(xV(e))return KV(e.value);if(yV(e)){const{format:r,formatType:i}=FV(e);return qW({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function xG(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,o=n.tooltip;if(Qz(o))return{tooltip:EG({tooltip:o},a,i,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return vG(e,o,"tooltip",(e=>{const o=bG(e,i,s);if(o)return o;if(null===e)return;let u=ZV("tooltip",r,i);return!0===u&&(u={content:"encoding"}),lP(u)?{value:u}:eP(u)?"encoding"===u.content?EG(n,a,i,t):{signal:s}:void 0}))}}function wG(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",o=[];function s(r,s){const u=Hj(s),c=bV(r)?r:Object.assign(Object.assign({},r),{type:e[u].type}),l=aP(TV(c,n,{allowDisabling:!1})).join(", ");let f;if(pU(s)){const r="x"===s?"x2":"y2",o=RV(e[r]);if(RU(c.bin)&&o){const e=NV(c,{expr:a}),t=NV(o,{expr:a}),{format:s,formatType:u}=FV(c);f=YW(e,t,s,u,n),i[r]=!0}else if(t&&t.fieldChannel===s&&"normalize"===t.offset){const{format:e,formatType:t}=FV(c);f=qW({fieldOrDatumDef:c,format:e,formatType:t,expr:a,config:n,normalizeStack:!0}).signal}}f=null!=f?f:bG(c,n,a).signal,o.push({channel:s,key:l,value:f})}f$(e,((e,t)=>{hV(e)?s(e,t):fV(e)&&s(e.condition,t)}));const u={};for(const{channel:e,key:t,value:n}of o)i[e]||u[t]||(u[fP(t)]=n);return u}function EG(e,t,n,{reactiveGeom:r}={}){const i=WP(wG(e,t,n,{reactiveGeom:r})).map((({key:e,value:t})=>`${e}: ${t}`));return i.length>0?{signal:`{${i.join(", ")}}`}:void 0}function CG(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:u}=n;void 0===s&&(u=null!=u?u:ZV(e,r,a,{vgChannel:o,ignoreVgConfig:!0}),void 0!==u&&(s=KV(u)));const c=i[e];return vG(t,c,null!=o?o:e,(n=>PW({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s})))}function SG(e,t={filled:void 0}){var n,r,i,a;const{markDef:o,encoding:s,config:u}=e,{type:c}=o,l=null!==(n=t.filled)&&void 0!==n?n:ZV("filled",o,u),f=OP(["bar","point","circle","square","geoshape"],c)?"transparent":void 0,p=null!==(i=null!==(r=ZV(!0===l?"color":void 0,o,u,{vgChannel:"fill"}))&&void 0!==r?r:u.mark[!0===l&&"color"])&&void 0!==i?i:f,h=null!==(a=ZV(!1===l?"color":void 0,o,u,{vgChannel:"stroke"}))&&void 0!==a?a:u.mark[!1===l&&"color"],d=l?"fill":"stroke",m=Object.assign(Object.assign({},p?{fill:KV(p)}:{}),h?{stroke:KV(h)}:{});return o.color&&(l?o.fill:o.stroke)&&hq(YU("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),CG("color",e,{vgChannel:d,defaultValue:l?p:h})),CG("fill",e,{defaultValue:s.fill?p:void 0})),CG("stroke",e,{defaultValue:s.stroke?h:void 0}))}function NG(e,t){const n=function(e){switch(e){case KL:return"xOffset";case XL:return"yOffset";case YL:return"x2Offset";case JL:return"y2Offset";case ej:return"thetaOffset";case ZL:return"radiusOffset";case tj:return"theta2Offset";case QL:return"radius2Offset"}}(e),r=t[n];if(r)return r}function AG(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:a,markDef:o,config:s,stack:u}=t,c=a[e],l=a[Kj(e)],f=t.scaleName(e),p=t.getScaleComponent(e),h=NG(e,o),d=kG({model:t,defaultPos:n,channel:e,scaleName:f,scale:p}),m=!c&&pU(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:a,offset:o,markDef:s,config:u}=e;if(yV(n)&&a&&t===a.fieldChannel){if(hV(n)){const e=uV({channel:t,fieldDef:n,isMidPoint:r,markDef:s,stack:a,config:u});if(void 0!==e)return zW({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:o})}return BW(n,i,{suffix:"end"},{offset:o})}return OW(e)}({channel:e,channelDef:c,channel2Def:l,markDef:o,config:s,isMidPoint:i,scaleName:f,scale:p,stack:u,offset:h,defaultRef:d});return m?{[r||e]:m}:void 0}function kG({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:o}=e;return()=>{const s=Hj(n),u=Gj(n),c=ZV(n,a,o,{vgChannel:u});if(void 0!==c)return LW(n,c);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const e=i.get("type");if(OP(["log",tW,nW],e));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===t)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[Xj(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}const DG={left:"x",center:"xc",right:"x2"},_G={top:"y",middle:"yc",bottom:"y2"};function MG(e,t,n,r="middle"){if("radius"===e||"theta"===e)return Gj(e);const i=ZV("x"===e?"align":"baseline",t,n);return"x"===e?DG[i||("top"===r?"left":"center")]:_G[i||r]}function TG(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?OG(e,t,{defaultPos:n,defaultPos2:r}):AG(e,t,{defaultPos:n})}function OG(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,o=Kj(e),s=Xj(e),u=function(e,t,n){const{encoding:r,mark:i,markDef:a,stack:o,config:s}=e,u=Hj(n),c=Xj(n),l=Gj(n),f=r[u],p=e.scaleName(u),h=e.getScaleComponent(u),d=NG(n in r||n in a?n:u,e.markDef);if(!f&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[l]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:u,defaultRef:c}){return yV(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?BW(t,a,{suffix:"start"},{offset:u}):OW({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:r,config:i,offset:u,defaultRef:c})}({channel:n,channelDef:f,channel2Def:r[n],markDef:a,config:s,scaleName:p,scale:h,stack:o,offset:d,defaultRef:void 0});return void 0!==m?{[l]:m}:IG(n,a)||IG(n,{[n]:e$(n,a,s.style),[c]:e$(c,a,s.style)})||IG(n,s[i])||IG(n,s.mark)||{[l]:kG({model:e,defaultPos:t,channel:n,scaleName:p,scale:h})()}}(t,r,o),c=u[s]?MG(e,i,a):Gj(e);return Object.assign(Object.assign({},AG(e,t,{defaultPos:n,vgChannel:c})),u)}function IG(e,t){const n=Xj(e),r=Gj(e);return void 0!==t[r]?{[r]:LW(e,t[r])}:void 0!==t[e]?{[r]:LW(e,t[e])}:t[n]?{[n]:LW(e,t[n])}:void 0}function FG(e,t,n){var r,i,a,o;const{config:s,encoding:u,markDef:c,stack:l}=e,f=Kj(t),p=Xj(t),h=u[t],d=u[f],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,v=e.scaleName(t),y=c.orient,b=null!==(i=null!==(r=u[p])&&void 0!==r?r:u.size)&&void 0!==i?i:ZV("size",c,s,{vgChannel:p}),x="bar"===n&&("x"===t?"vertical"===y:"horizontal"===y);if(hV(h)&&(FU(h.bin)||RU(h.bin)||h.timeUnit&&!d)&&!b&&!mW(g)){const n=uV({channel:t,fieldDef:h,stack:l,markDef:c,config:s}),r=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:a,spacing:o=0,axisTranslate:s,reverse:u,config:c}){const l=Kj(n),f=Gj(n),p=Gj(l),h=NG(n,a);if(FU(e.bin)||e.timeUnit)return{[p]:zG({channel:n,fieldDef:e,scaleName:i,markDef:a,band:(1-r)/2,offset:BG(l,o,u,s,h),config:c}),[f]:zG({channel:n,fieldDef:e,scaleName:i,markDef:a,band:1-(1-r)/2,offset:BG(n,o,u,s,h),config:c})};if(RU(e.bin)){const r=BW(e,i,{},{offset:BG(l,o,u,s,h)});if(hV(t))return{[p]:r,[f]:BW(t,i,{},{offset:BG(n,o,u,s,h)})};if(BU(e.bin)&&e.bin.step)return{[p]:r,[f]:{signal:`scale("${i}", ${NV(e,{expr:"datum"})} + ${e.bin.step})`,offset:BG(n,o,u,s,h)}}}hq(cq(l))}({fieldDef:h,fieldDef2:d,channel:t,markDef:c,scaleName:v,band:n,axisTranslate:null!==(o=null==r?void 0:r.get("translate"))&&void 0!==o?o:.5,spacing:pU(t)?ZV("binSpacing",c,s):void 0,reverse:m.get("reverse"),config:s})}return(yV(h)&&mW(g)||x)&&!d?function(e,t,n,r){var i;const{markDef:a,encoding:o,config:s,stack:u}=r,c=a.orient,l=r.scaleName(n),f=r.getScaleComponent(n),p=Xj(n),h=Kj(n),d="horizontal"===c&&"y"===n||"vertical"===c&&"x"===n,m=ZV(d?"size":p,a,s,{vgChannel:p});let g;(o.size||void 0!==m)&&(d?g=CG("size",r,{vgChannel:p,defaultValue:m}):hq(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(a.type)));const v=null!==(i=yV(t)?uV({channel:n,fieldDef:t,markDef:a,stack:u,config:s}):void 0)&&void 0!==i?i:1;g=g||{[p]:RG(e,p,l,f,s,v)};const y="band"!==(null==f?void 0:f.get("type"))||!("band"in g[p]),b=MG(n,a,s,y?"middle":"top"),x=NG(n,a),w=OW({channel:n,channelDef:t,markDef:a,config:s,scaleName:l,scale:f,stack:u,offset:x,defaultRef:kG({model:r,defaultPos:"mid",channel:n,scaleName:l,scale:f}),band:y?.5:(1-v)/2});if(p)return Object.assign({[b]:w},g);{const e=Gj(h),t=g[p],n=x?Object.assign(Object.assign({},t),{offset:x}):t;return{[b]:w,[e]:Qz(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,h,t,e):OG(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function RG(e,t,n,r,i,a){if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(t===rW){const e=r.get("range");return Mq(e)&&cP(e.step)?{value:e.step-2}:{value:Q$-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}const o=J$(i.view,t),s=tL(i[e].discreteBandSize,o-2);return void 0!==s?{value:s}:void 0}function BG(e,t,n,r,i){if(Aj(e))return 0;const a="x"===e||"y2"===e?-t/2:t/2;if(_q(n)){const e=YV(i);return{signal:`${n.signal} ? ${r-a}${e?"-"+e:""} : ${r+a}${e?"+"+e:""}`}}if(_q(i)){const e=r+(n?-a:a);return{signal:`${e||""}${n?" - ":e?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-a:+i+a)}function zG({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:a,config:o}){return IW({fieldDef:t,channel:e,markDef:r,ref:zW({scaleName:n,fieldOrDatumDef:t,band:i,offset:a}),config:o})}const PG=new Set(["aria"]);function LG(e,t){const{fill:n,stroke:r}="include"===t.color?SG(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return Oq.reduce(((n,r)=>(PG.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=KV(e[r])),n)),{})}(e.markDef,t)),jG(e,"fill",n)),jG(e,"stroke",r)),CG("opacity",e)),CG("fillOpacity",e)),CG("strokeOpacity",e)),CG("strokeWidth",e)),CG("strokeDash",e)),xG(e)),yG(e,"href")),function(e){const{markDef:t,config:n}=e,r=ZV("aria",t,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(e){const{mark:t,markDef:n,config:r}=e;if(!1===r.aria)return{};const i=ZV("ariaRoleDescription",n,r);return null!=i?{ariaRoleDescription:{value:i}}:t in Iq?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return vG(e,a,"description",(t=>bG(t,e.config)));const o=ZV("description",n,r);if(null!=o)return{description:KV(o)};if(!1===r.aria)return{};const s=wG(t,i,r);return jP(s)?void 0:{description:{signal:WP(s).map((({key:e,value:t})=>`${e} + ": " + (${t})`)).join(' + "; " + ')}}}(e))}(e))}function jG(e,t,n){const{config:r,mark:i,markDef:a}=e;if("hide"===ZV("invalid",a,r)&&n&&!kL(i)){const r=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&gW(i)&&(t[a]=!0)}return t}),{}),i=UP(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>RW(e,t))).join(` ${e} `)}}(e,{invalid:!0,channels:kU});if(r)return{[t]:[{test:r,value:null},...aP(n)]}}return n?{[t]:n}:{}}function UG(e){const{config:t,markDef:n}=e;if(ZV("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&gW(i)&&(t[a]=!0)}return t}),{}),i=UP(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>RW(e,t))).join(` ${e} `)}}(e,{channels:fU});if(t)return{defined:{signal:t}}}return{}}function qG(e,t){if(void 0!==t)return{[e]:KV(t)}}const WG="voronoi",VG={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(WG)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if(kL(a))return hq(`The "nearest" transform is not supported for ${a} marks.`),n;const o={name:e.getName(WG),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},xG(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,u=!1;return n.forEach(((t,n)=>{var r;const i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?s=n:i.indexOf(WG)>=0&&(u=!0)})),u||n.splice(s+1,0,o),n}},$G=VG;class HG{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?console.warn("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class GG extends HG{constructor(e,t,n,r){super(e,t),this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${function(e){const t=++nL;return t}()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class KG extends HG{constructor(e,t){super(e),this.formula=t}clone(){return new KG(null,AP(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{const{field:i,timeUnit:a}=n,o=hZ(t)?t.encoding[Kj(r)]:void 0,s=hZ(t)&&cV(r,n,o,t.stack,t.markDef,t.config);if(a){const t=NV(n,{forAs:!0});e[MP({as:t,field:i,timeUnit:a})]=Object.assign({as:t,field:i,timeUnit:a},s?{band:!0}:{})}return e}),{});return jP(n)?null:new KG(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:r}=n,i=hP(n,["timeUnit"]),a=Dq(r),o=Object.assign(Object.assign({},i),{timeUnit:a});return new KG(e,{[MP(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(qP(this.formula).map((e=>e.as)))}dependentFields(){return new Set(qP(this.formula).map((e=>e.field)))}hash(){return`TimeUnit ${MP(this.formula)}`}assemble(){const e=[];for(const t of qP(this.formula)){const{field:n,as:r,timeUnit:i}=t,a=Dq(i),{unit:o,utc:s}=a,u=hP(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:JP(n),type:"timeunit"},o?{units:Nq(o)}:{}),s?{timezone:"utc"}:{}),u),{as:[r,`${r}_end`]}))}return e}}const XG="_tuple_fields";class YG{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const JG={has:()=>!0,parse:(e,t,n)=>{var r,i,a;const o=t.name,s=null!==(r=t.project)&&void 0!==r?r:t.project=new YG,u={},c={},l=new Set,f=(e,t)=>{const n="visual"===t?e.channel:e.field;let r=$P(`${o}_${n}`);for(let e=1;l.has(r);e++)r=$P(`${o}_${n}_${e}`);return l.add(r),{[t]:r}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of aP(n.init))for(const r of UP(e))qj[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(hq('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(i=n.fields)&&void 0!==i?i:[]){const t={type:"E",field:e};t.signals=Object.assign({},f(t,"data")),s.items.push(t),s.hasField[e]=t}for(const r of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(r);if(n){let i=n.field;if(n.aggregate){hq(VU(r,n.aggregate));continue}if(!i){hq(WU(r));continue}if(n.timeUnit){i=e.vgField(r);const t={timeUnit:n.timeUnit,as:i,field:n.field};c[MP(t)]=t}if(!u[i]){let a="E";"interval"===t.type?gW(e.getScaleComponent(r).get("type"))&&(a="R"):n.bin&&(a="R-RE");const o={field:i,channel:r,type:a};o.signals=Object.assign(Object.assign({},f(o,"data")),f(o,"visual")),s.items.push(u[i]=o),s.hasField[i]=s.hasChannel[r]=u[i]}}else hq(WU(r))}if(n.init){const e=e=>s.items.map((t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]));if("interval"===n.type)t.init=e(n.init);else{const r=aP(n.init);t.init=r.map(e)}}jP(c)||(s.timeUnit=new KG(null,c))},signals:(e,t,n)=>{const r=t.name+XG;return n.filter((e=>e.name===r)).length>0?n:n.concat({name:r,value:t.project.items.map((e=>{const{signals:t,hasLegend:n}=e,r=hP(e,["signals","hasLegend"]);return r.field=JP(r.field),r}))})}},ZG={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!q$(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=$G.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach(((e,i)=>{var u,c;const l=$P(`${r}_${e.field}`);n.filter((e=>e.name===l)).length||n.unshift(Object.assign(Object.assign({name:l},o?{init:vK(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${fP(e.field)}] : null`}]:[],bind:null!==(c=null!==(u=a[e.field])&&void 0!==u?u:a[e.channel])&&void 0!==c?c:a}))})),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter((e=>e.name===r+DK))[0],o=r+XG,s=i.items.map((e=>$P(`${r}_${e.field}`))),u=s.map((e=>`${e} !== null`)).join(" && ");return s.length&&(a.update=`${u} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},QG=ZG,eK="_toggle",tK={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+eK,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+DK,r=t.name+eK;return`${r} ? null : ${n}, `+("global"===t.resolve?`${r} ? null : true, `:`${r} ? null : {unit: ${OK(e)}}, `)+`${r} ? ${n} : null`}},nK={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=lP(n.clear)?Lz(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(QG.has(t))for(const e of t.project.items){const r=n.findIndex((n=>n.name===$P(`${t.name}_${e.field}`)));-1!==r&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex((t=>t.name===e.signals.visual));r(t,"[0, 0]"),-1===t&&r(n.findIndex((t=>t.name===e.signals.data)),"null")}else{let e=n.findIndex((e=>e.name===t.name+DK));r(e,"null"),tK.has(t)&&(e=n.findIndex((e=>e.name===t.name+eK)),r(e,"false"))}return n}},rK={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!DU(i))continue;const a=e.getScaleComponent(i),o=a?a.get("type"):void 0;if(!a||!gW(o)){hq("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const s={selection:t.name,field:r.field};a.set("selectionExtent",s,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter((e=>0===n.filter((t=>t.name===e.signals.data)).length));if(!e.parent||oK(e)||0===r.length)return n;const i=n.filter((e=>e.name===t.name))[0];let a=i.update;if(a.indexOf(_K)>=0)i.update=`{${r.map((e=>`${fP(e.field)}: ${e.signals.data}`)).join(", ")}}`;else{for(const e of r){const t=`${fP(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}i.update=a}return n.concat(r.map((e=>({name:e.signals.data}))))},signals:(e,t,n)=>{if(e.parent&&!oK(e))for(const e of t.scales){const t=n.filter((t=>t.name===e.signals.data))[0];t.push="outer",delete t.value,delete t.update}return n}},iK=rK;function aK(e,t){return`domain(${fP(e.scaleName(t))})`}function oK(e){var t;return e.parent&&gZ(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:oK(e.parent.parent))}const sK={has:e=>{const t="global"===e.resolve&&e.bind&&q$(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==j$;return t&&!n&&hq("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=aP(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=W$(t.bind)?t.bind.legend:"click",o=lP(a)?Lz(a,"view"):aP(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=W$(t.bind)&&t.bind.legend,a=e=>t=>{const n=AP(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const o=`${$P(e.field)}_legend`,s=`${r}_${o}`;if(0===n.filter((e=>e.name===s)).length){const e=i.merge.map(a(`${o}_symbols`)).concat(i.merge.map(a(`${o}_labels`))).concat(i.merge.map(a(`${o}_entries`)));n.unshift(Object.assign(Object.assign({name:s},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${s}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find((e=>e.name===r+DK)),o=r+XG,s=i.items.filter((e=>e.hasLegend)).map((e=>$P(`${r}_${$P(e.field)}_legend`))),u=`${s.map((e=>`${e} !== null`)).join(" && ")} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map((e=>({signal:e}))),update:u}):s.length>0&&(a.update=u,delete a.value,delete a.on);const c=n.find((e=>e.name===r+eK)),l=W$(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:l})):c.on[0].events=l),n}},uK="_translate_anchor",cK="_translate_delta",lK={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const r=t.name,i=iK.has(t),a=r+uK,{x:o,y:s}=t.project.hasChannel;let u=Lz(t.translate,"scope");return i||(u=u.map((e=>(e.between[0].markname=r+xK,e)))),n.push({name:a,value:{},on:[{events:u.map((e=>e.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(i?aK(e,KL):`slice(${o.signals.visual})`):"")+(void 0!==s?", extent_y: "+(i?aK(e,XL):`slice(${s.signals.visual})`):"")+"}"}]},{name:r+cK,value:{},on:[{events:u,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==o&&fK(e,t,o,"width",n),void 0!==s&&fK(e,t,s,"height",n),n}};function fK(e,t,n,r,i){var a;const o=t.name,s=o+uK,u=o+cK,c=n.channel,l=iK.has(t),f=i.filter((e=>e.name===n.signals[l?"data":"visual"]))[0],p=e.getSizeSignalRef(r).signal,h=e.getScaleComponent(c),d=h.get("type"),m=`${s}.extent_${c}`,g=`${l?"log"===d?"panLog":"pow"===d?"panPow":"panLinear":"panLinear"}(${m}, ${`${l&&c===KL?"-":""}${u}.${c} / `+(l?`${p}`:`span(${m})`)}`+(l&&"pow"===d?`, ${null!==(a=h.get("exponent"))&&void 0!==a?a:1}`:"")+")";f.on.push({events:{signal:u},update:l?g:`clampRange(${g}, 0, ${p})`})}const pK="_zoom_delta",hK={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=iK.has(t),a=r+pK,{x:o,y:s}=t.project.hasChannel,u=fP(e.scaleName(KL)),c=fP(e.scaleName(XL));let l=Lz(t.zoom,"scope");return i||(l=l.map((e=>(e.markname=r+xK,e)))),n.push({name:r+"_zoom_anchor",on:[{events:l,update:i?"{"+[u?`x: invert(${u}, x(unit))`:"",c?`y: invert(${c}, y(unit))`:""].filter((e=>!!e)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:l,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&dK(e,t,o,"width",n),void 0!==s&&dK(e,t,s,"height",n),n}};function dK(e,t,n,r,i){var a;const o=t.name,s=n.channel,u=iK.has(t),c=i.filter((e=>e.name===n.signals[u?"data":"visual"]))[0],l=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(s),p=f.get("type"),h=u?aK(e,s):c.name,d=o+pK,m=`${u?"log"===p?"zoomLog":"pow"===p?"zoomPow":"zoomLinear":"zoomLinear"}(${h}, ${o}_zoom_anchor.${s}, ${d}`+(u&&"pow"===p?`, ${null!==(a=f.get("exponent"))&&void 0!==a?a:1}`:"")+")";c.on.push({events:{signal:d},update:u?m:`clampRange(${m}, 0, ${l})`})}const mK=[JG,tK,iK,sK,lK,hK,QG,$G,nK];function gK(e,t){for(const n of mK)n.has(e)&&t(n)}function vK(e,t=!0,n=Jz){if(Qz(e)){const r=e.map((e=>vK(e,t,n)));return t?`[${r.join(", ")}]`:r}return dq(e)?n(t?xq(e):function(e){const t=bq(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function yK(e,t){return TK(e,((n,r)=>{t=r.marks?r.marks(e,n,t):t,gK(n,(r=>{r.marks&&(t=r.marks(e,n,t))}))})),t}function bK(e){return e.map((e=>(e.on&&!e.on.length&&delete e.on,e)))}const xK="_brush",wK="_scale_trigger",EK={signals:(e,t)=>{const n=t.name,r=n+XG,i=iK.has(t),a=[],o=[],s=[];if(t.translate&&!i){const e=`!event.item || event.item.mark.name !== ${fP(n+xK)}`;CK(t,((t,n)=>{var r;const i=aP(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(e)<0&&i.push(e),t}))}t.project.items.forEach(((n,r)=>{const i=n.channel;if(i!==KL&&i!==XL)return void hq("Interval selections only support x and y encoding channels.");const u=t.init?t.init[r]:null,c=function(e,t,n,r){const i=n.channel,a=n.signals.visual,o=n.signals.data,s=iK.has(t),u=fP(e.scaleName(i)),c=e.getScaleComponent(i),l=c?c.get("type"):void 0,f=e=>`scale(${u}, ${e})`,p=e.getSizeSignalRef(i===KL?"width":"height").signal,h=`${i}(unit)`,d=CK(t,((e,t)=>[...e,{events:t.between[0],update:`[${h}, ${h}]`},{events:t,update:`[${a}[0], clamp(${h}, 0, ${p})]`}]));return d.push({events:{signal:t.name+wK},update:gW(l)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:vK(r,!0,f)}:{value:[]}),{on:d}),Object.assign(Object.assign({name:o},r?{init:vK(r)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${u}, ${a})`}]})]}(e,t,n,u),l=n.signals.data,f=n.signals.visual,p=fP(e.scaleName(i)),h=gW(e.getScaleComponent(i).get("type"))?"+":"";a.push(...c),o.push(l),s.push({scaleName:e.scaleName(i),expr:`(!isArray(${l}) || (${h}invert(${p}, ${f})[0] === ${h}${l}[0] && ${h}invert(${p}, ${f})[1] === ${h}${l}[1]))`})})),i||a.push({name:n+wK,value:{},on:[{events:s.map((e=>({scale:e.scaleName}))),update:s.map((e=>e.expr)).join(" && ")+` ? ${n+wK} : {}`}]});const u=t.init,c=`unit: ${OK(e)}, fields: ${r}, values`;return a.concat(Object.assign(Object.assign({name:n+DK},u?{init:`{${c}: ${vK(u)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${c}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+DK+", "+("global"===t.resolve?"true":`{unit: ${OK(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,o=i&&i.signals.visual,s=a&&a.signals.visual,u=`data(${fP(t.name+kK)})`;if(iK.has(t))return n;const c={x:void 0!==i?{signal:`${o}[0]`}:{value:0},y:void 0!==a?{signal:`${s}[0]`}:{value:0},x2:void 0!==i?{signal:`${o}[1]`}:{field:{group:"width"}},y2:void 0!==a?{signal:`${s}[1]`}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of UP(c))c[t]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${OK(e)}`},c[t]),{value:0}];const l=t.mark,{fill:f,fillOpacity:p,cursor:h}=l,d=hP(l,["fill","fillOpacity","cursor"]),m=UP(d).reduce(((e,t)=>(e[t]=[{test:[void 0!==i&&`${o}[0] !== ${o}[1]`,void 0!==a&&`${s}[0] !== ${s}[1]`].filter((e=>e)).join(" && "),value:d[t]},{value:null}],e)),{});return[{name:r+xK+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:p}},update:c}},...n,{name:r+xK,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},c),m)}}]}};function CK(e,t){return e.events.reduce(((e,n)=>n.between?t(e,n):(hq(`${n} is not an ordered event stream for interval selections.`),e)),[])}function SK(e,t){const n=t.name,r=n+XG,i=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=i.items.map((t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${a}[${fP(e.vgField(t.channel,{}))}], ${a}[${fP(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${a}[${fP(t.field)}]`})).join(", "),s=`unit: ${OK(e)}, fields: ${r}, values`,u=t.events;return[{name:n+DK,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const NK={signals:SK,modifyExpr:(e,t)=>t.name+DK+", "+("global"===t.resolve?"null":`{unit: ${OK(e)}}`)},AK={signals:SK,modifyExpr:(e,t)=>t.name+DK+", "+("global"===t.resolve?"true":`{unit: ${OK(e)}}`)},kK="_store",DK="_tuple",_K="vlSelectionResolve",MK={single:AK,multi:NK,interval:EK};function TK(e,t){const n=e.component.selection;if(n)for(const e of qP(n))if(!0===t(e,MK[e.type]))break}function OK(e,{escape:t}={escape:!0}){let n=t?fP(e.name):e.name;const r=function(e){let t=e.parent;for(;t&&!dZ(t);)t=t.parent;return t}(e);if(r){const{facet:e}=r;for(const t of Oj)e[t]&&(n+=` + '__facet_${t}_' + (facet[${fP(r.vgField(t))}])`)}return n}function IK(e){let t=!1;return TK(e,(e=>{t=t||e.project.items.some((e=>e.field===j$))})),t}function FK(e){this.type=e}var RK,BK,zK,PK,LK;FK.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(RK={})[1]="Boolean",RK[2]="<end>",RK[3]="Identifier",RK[4]="Keyword",RK[5]="Null",RK[6]="Numeric",RK[7]="Punctuator",RK[8]="String",RK[9]="RegularExpression";var jK="Identifier",UK="Unexpected token %0",qK="Invalid regular expression",WK="Invalid regular expression: missing /",VK="Octal literals are not allowed in strict mode.",$K="ILLEGAL",HK="Disabled.",GK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),KK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function XK(e,t){if(!e)throw new Error("ASSERT: "+t)}function YK(e){return e>=48&&e<=57}function JK(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function ZK(e){return"01234567".indexOf(e)>=0}function QK(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function eX(e){return 10===e||13===e||8232===e||8233===e}function tX(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&GK.test(String.fromCharCode(e))}function nX(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&KK.test(String.fromCharCode(e))}var rX={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function iX(){for(var e;zK<PK&&(QK(e=BK.charCodeAt(zK))||eX(e));)++zK}function aX(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)zK<PK&&JK(BK[zK])?(r=BK[zK++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):yX({},UK,$K);return String.fromCharCode(i)}function oX(){var e,t,n,r;for(t=0,"}"===(e=BK[zK])&&yX({},UK,$K);zK<PK&&JK(e=BK[zK++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&yX({},UK,$K),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function sX(){var e,t;for(e=BK.charCodeAt(zK++),t=String.fromCharCode(e),92===e&&(117!==BK.charCodeAt(zK)&&yX({},UK,$K),++zK,(e=aX("u"))&&"\\"!==e&&tX(e.charCodeAt(0))||yX({},UK,$K),t=e);zK<PK&&nX(e=BK.charCodeAt(zK));)++zK,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==BK.charCodeAt(zK)&&yX({},UK,$K),++zK,(e=aX("u"))&&"\\"!==e&&nX(e.charCodeAt(0))||yX({},UK,$K),t+=e);return t}function uX(){var e,t,n,r,i=zK,a=BK.charCodeAt(zK),o=BK[zK];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++zK,{type:7,value:String.fromCharCode(a),start:i,end:zK};default:if(61===(e=BK.charCodeAt(zK+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return zK+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:zK};case 33:case 61:return zK+=2,61===BK.charCodeAt(zK)&&++zK,{type:7,value:BK.slice(i,zK),start:i,end:zK}}}return">>>="===(r=BK.substr(zK,4))?{type:7,value:r,start:i,end:zK+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:zK+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:zK+=2}:"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++zK}:void yX({},UK,$K)}function cX(){var e,t,n;if(XK(YK((n=BK[zK]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=zK,e="","."!==n){if(e=BK[zK++],n=BK[zK],"0"===e){if("x"===n||"X"===n)return++zK,function(e){for(var t="";zK<PK&&JK(BK[zK]);)t+=BK[zK++];return 0===t.length&&yX({},UK,$K),tX(BK.charCodeAt(zK))&&yX({},UK,$K),{type:6,value:parseInt("0x"+t,16),start:e,end:zK}}(t);if(ZK(n))return function(e){for(var t="0"+BK[zK++];zK<PK&&ZK(BK[zK]);)t+=BK[zK++];return(tX(BK.charCodeAt(zK))||YK(BK.charCodeAt(zK)))&&yX({},UK,$K),{type:6,value:parseInt(t,8),octal:!0,start:e,end:zK}}(t);n&&YK(n.charCodeAt(0))&&yX({},UK,$K)}for(;YK(BK.charCodeAt(zK));)e+=BK[zK++];n=BK[zK]}if("."===n){for(e+=BK[zK++];YK(BK.charCodeAt(zK));)e+=BK[zK++];n=BK[zK]}if("e"===n||"E"===n)if(e+=BK[zK++],"+"!==(n=BK[zK])&&"-"!==n||(e+=BK[zK++]),YK(BK.charCodeAt(zK)))for(;YK(BK.charCodeAt(zK));)e+=BK[zK++];else yX({},UK,$K);return tX(BK.charCodeAt(zK))&&yX({},UK,$K),{type:6,value:parseFloat(e),start:t,end:zK}}function lX(){var e;return iX(),zK>=PK?{type:2,start:zK,end:zK}:tX(e=BK.charCodeAt(zK))?function(){var e,t;return e=zK,t=92===BK.charCodeAt(zK)?sX():function(){var e,t;for(e=zK++;zK<PK;){if(92===(t=BK.charCodeAt(zK)))return zK=e,sX();if(!nX(t))break;++zK}return BK.slice(e,zK)}(),{type:1===t.length?3:rX.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:zK}}():40===e||41===e||59===e?uX():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(XK("'"===(e=BK[zK])||'"'===e,"String literal must starts with a quote"),t=zK,++zK;zK<PK;){if((n=BK[zK++])===e){e="";break}if("\\"===n)if((n=BK[zK++])&&eX(n.charCodeAt(0)))"\r"===n&&"\n"===BK[zK]&&++zK;else switch(n){case"u":case"x":"{"===BK[zK]?(++zK,i+=oX()):i+=aX(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:ZK(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),zK<PK&&ZK(BK[zK])&&(a=!0,r=8*r+"01234567".indexOf(BK[zK++]),"0123".indexOf(n)>=0&&zK<PK&&ZK(BK[zK])&&(r=8*r+"01234567".indexOf(BK[zK++]))),i+=String.fromCharCode(r)):i+=n}else{if(eX(n.charCodeAt(0)))break;i+=n}}return""!==e&&yX({},UK,$K),{type:8,value:i,octal:a,start:t,end:zK}}():46===e?YK(BK.charCodeAt(zK+1))?cX():uX():YK(e)?cX():uX()}function fX(){var e;return zK=(e=LK).end,LK=lX(),zK=e.end,e}function pX(){var e;e=zK,LK=lX(),zK=e}function hX(e,t,n){var r=new FK("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function dX(e){var t=new FK(jK);return t.name=e,t}function mX(e){var t=new FK("Literal");return t.value=e.value,t.raw=BK.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function gX(e,t,n){var r=new FK("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function vX(e,t,n){var r=new FK("Property");return r.key=t,r.value=n,r.kind=e,r}function yX(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){return XK(t<r.length,"Message reference must be in range"),r[t]}));throw(n=new Error(i)).index=zK,n.description=i,n}function bX(e){2===e.type&&yX(e,"Unexpected end of input"),6===e.type&&yX(e,"Unexpected number"),8===e.type&&yX(e,"Unexpected string"),3===e.type&&yX(e,"Unexpected identifier"),4===e.type&&yX(e,"Unexpected reserved word"),yX(e,UK,e.value)}function xX(e){var t=fX();7===t.type&&t.value===e||bX(t)}function wX(e){return 7===LK.type&&LK.value===e}function EX(e){return 4===LK.type&&LK.value===e}function CX(){var e;return zK=LK.start,8===(e=fX()).type||6===e.type?(e.octal&&yX(e,VK),mX(e)):dX(e.value)}function SX(){var e,t,n;return zK=LK.start,3===(e=LK).type?(n=CX(),xX(":"),vX("init",n,OX())):2!==e.type&&7!==e.type?(t=CX(),xX(":"),vX("init",t,OX())):void bX(e)}var NX={if:1};function AX(){var e,t,n;if(wX("("))return function(){var e;return xX("("),e=IX(),xX(")"),e}();if(wX("["))return function(){var e=[];for(zK=LK.start,xX("[");!wX("]");)wX(",")?(fX(),e.push(null)):(e.push(OX()),wX("]")||xX(","));return fX(),function(e){var t=new FK("ArrayExpression");return t.elements=e,t}(e)}();if(wX("{"))return function(){var e,t,n=[],r={},i=String;for(zK=LK.start,xX("{");!wX("}");)t="$"+((e=SX()).key.type===jK?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?yX({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),wX("}")||xX(",");return xX("}"),function(e){var t=new FK("ObjectExpression");return t.properties=e,t}(n)}();if(e=LK.type,zK=LK.start,3===e||NX[LK.value])n=dX(fX().value);else if(8===e||6===e)LK.octal&&yX(LK,VK),n=mX(fX());else{if(4===e)throw new Error(HK);1===e?((t=fX()).value="true"===t.value,n=mX(t)):5===e?((t=fX()).value=null,n=mX(t)):wX("/")||wX("/=")?(n=mX(function(){var e,t,n,r;return LK=null,iX(),e=zK,t=function(){var e,t,n,r;for(XK("/"===(e=BK[zK]),"Regular expression literal must start with a slash"),t=BK[zK++],n=!1,r=!1;zK<PK;)if(t+=e=BK[zK++],"\\"===e)eX((e=BK[zK++]).charCodeAt(0))&&yX({},WK),t+=e;else if(eX(e.charCodeAt(0)))yX({},WK);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||yX({},WK),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";zK<PK&&nX((e=BK[zK]).charCodeAt(0));)++zK,"\\"===e&&zK<PK?yX({},UK,$K):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&yX({},qK,n),{value:n,literal:t}}(),r=function(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";yX({},qK)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){yX({},qK)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:zK}}()),pX()):bX(fX())}return n}function kX(){var e=[];if(xX("("),!wX(")"))for(;zK<PK&&(e.push(OX()),!wX(")"));)xX(",");return xX(")"),e}function DX(){var e;return xX("["),e=IX(),xX("]"),e}function _X(){var e=function(){var e,t,n,r,i;for(e=AX();;)if(wX("."))e=gX(".",e,(i=void 0,xX("."),zK=LK.start,function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(i=fX())||bX(i),dX(i.value)));else if(wX("("))t=e,n=kX(),r=void 0,(r=new FK("CallExpression")).callee=t,r.arguments=n,e=r;else{if(!wX("["))break;e=gX("[",e,DX())}return e}();if(7===LK.type&&(wX("++")||wX("--")))throw new Error(HK);return e}function MX(){var e,t;if(7!==LK.type&&4!==LK.type)t=_X();else{if(wX("++")||wX("--"))throw new Error(HK);if(wX("+")||wX("-")||wX("~")||wX("!"))e=fX(),t=MX(),t=function(e,t){var n=new FK("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(EX("delete")||EX("void")||EX("typeof"))throw new Error(HK);t=_X()}}return t}function TX(e){var t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function OX(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,u,c;if(e=LK,u=MX(),0===(i=TX(r=LK)))return u;for(r.prec=i,fX(),t=[e,LK],a=[u,r,o=MX()];(i=TX(LK))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,u=a.pop(),t.pop(),n=hX(s,u,o),a.push(n);(r=fX()).prec=i,a.push(r),t.push(LK),n=MX(),a.push(n)}for(n=a[c=a.length-1],t.pop();c>1;)t.pop(),n=hX(a[c-1].value,a[c-2],n),c-=2;return n}(),wX("?")&&(fX(),t=OX(),xX(":"),e=function(e,t,n){var r=new FK("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,OX())),e}function IX(){var e=OX();if(wX(","))throw new Error(HK);return e}function FX(e,t,n){return e.fields=t||[],e.fname=n,e}function RX(e){return 1===e.length?BX(e[0]):zX(e)}const BX=e=>function(t){return t[e]},zX=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function PX(e){throw Error(e)}function LX(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...LX(e.object)),t.push(...LX(e.property))),t)}function jX(e){return"MemberExpression"===e.object.type?jX(e.object):"datum"===e.object.name}function UX(e){const t=function(e){zK=0,PK=(BK=e).length,LK=null,pX();var t=IX();if(2!==LK.type)throw new Error("Unexpect token after expression.");return t}(e),n=new Set;return t.visit((e=>{"MemberExpression"===e.type&&jX(e)&&n.add(LX(e).slice(1).join("."))})),n}(function(e,t,n){const r=function(e){const t=[],n=e.length;let r,i,a,o=null,s=0,u="";function c(){t.push(u+e.substring(r,i)),u="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)u+=e.substring(r,i),u+=e.substring(++i,++i),r=i;else if(a===o)c(),o=null,s=-1;else{if(o)continue;r===s&&'"'===a||r===s&&"'"===a?(r=i+1,o=a):"."!==a||s?"["===a?(i>r&&c(),s=r=i+1):"]"===a&&(s||PX("Access path missing open bracket: "+e),s>0&&c(),s=0,r=i+1):i>r?c():r=i+1}return s&&PX("Access path missing closing bracket: "+e),o&&PX("Access path missing closing quote: "+e),i>r&&(i++,c()),t}(e);e=1===r.length?r[0]:e,FX((n&&n.get||RX)(r),[e],t||e)})("id"),FX((e=>e),[],"identity"),FX((()=>0),[],"zero"),FX((()=>1),[],"one"),FX((()=>!0),[],"true"),FX((()=>!1),[],"false"),Array.isArray,Object.prototype.hasOwnProperty;class qX extends HG{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=$X(this.model,this.filter,this),this._dependentFields=UX(this.expr)}clone(){return new qX(null,this.model,AP(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function WX(e,t,n,r="datum"){const i=[],a=HP(t,(function(t){const a=$P(t),o=e.getSelectionComponent(a,t),s=fP(a+kK);if(o.project.timeUnit){const t=null!=n?n:e.component.data.raw,r=o.project.timeUnit.clone();t.parent?r.insertAsParentOf(t):t.parent=r}return"none"!==o.empty&&i.push(s),`vlSelectionTest(${s}, ${r}`+("global"===o.resolve?")":`, ${fP(o.resolve)})`)}));return(i.length?"!("+i.map((e=>`length(data(${e}))`)).join(" || ")+") || ":"")+`(${a})`}function VX(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter((e=>e.channel===n));!i.length||i.length>1?(r=e.project.items[0].field,hq((i.length?"Multiple ":"No ")+`matching ${fP(n)} encoding found for selection ${fP(t.selection)}. `+`Using "field": ${fP(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&hq(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${fP(r)}.`);return`${e.name}[${fP(r)}]`}function $X(e,t,n){return HP(t,(t=>lP(t)?t:function(e){return null==e?void 0:e.selection}(t)?WX(e,t.selection,n):Vq(t)))}function HX(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function GX(e,t,n,r={header:!1}){var i,a;const o=e.combine(),{disable:s,orient:u,scale:c,labelExpr:l,title:f,zindex:p}=o,h=hP(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const e in h){const n=uL[e],r=h[e];if(n&&n!==t&&"both"!==n)delete h[e];else if(oL(r)){const{condition:t}=r,n=hP(r,["condition"]),i=aP(t),a=aL[e];if(a){const{vgProp:t,part:r}=a,o=[...i.map((e=>{const{test:t}=e,n=hP(e,["test"]);return Object.assign({test:$X(null,t)},n)})),n];HX(h,r,t,o),delete h[e]}else if(null===a){const t={signal:i.map((e=>{const{test:t}=e,n=hP(e,["test"]);return`${$X(null,t)} ? ${XV(n)} : `})).join("")+XV(n)};h[e]=t}}else if(_q(r)){const t=aL[e];if(t){const{vgProp:n,part:i}=t;HX(h,i,n,r),delete h[e]}}}if("grid"===t){if(!h.grid)return;if(h.encode){const{grid:e}=h.encode;h.encode=Object.assign({},e?{grid:e}:{}),jP(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:c,orient:u},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:tL(p,0)})}{if(!r.header&&e.mainExtracted)return;if(void 0!==l){let e=l;(null===(a=null===(i=h.encode)||void 0===i?void 0:i.labels)||void 0===a?void 0:a.update)&&_q(h.encode.labels.update.text)&&(e=ZP(l,"datum.label",h.encode.labels.update.text.signal)),HX(h,"labels","text",{signal:e})}if(null===h.labelAlign&&delete h.labelAlign,h.encode){for(const t of sL)e.hasAxisPart(t)||delete h.encode[t];jP(h.encode)&&delete h.encode}const t=function(e,t){if(e)return Qz(e)&&!GV(e)?e.map((e=>IV(e,t))).join(", "):e}(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:c,orient:u,grid:!1},t?{title:t}:{}),h),!1===n.aria?{aria:!1}:{}),{zindex:tL(p,0)})}}}function KX(e){const{axes:t}=e.component,n=[];for(const r of fU)if(t[r])for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const t="x"===r?"height":"width",i=e.getSizeSignalRef(t).signal;t!==i&&n.push({name:t,update:i})}return n}const XX={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},YX={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},JX=UP(XX),ZX=UP(YX);function QX(e,t,n,r){return Object.assign.apply(null,[{},...e.map((e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",i=t["x"===n?"axisBottom":"axisLeft"]||{},a=t["x"===n?"axisTop":"axisRight"]||{},o=new Set([...UP(i),...UP(a)]),s={};for(const t of o.values())s[t]={signal:`${r.signal} === "${e}" ? ${YV(i[t])} : ${YV(a[t])}`};return s}return t[e]}))])}function eY(e,t){var n;const r=[{}];for(const i of e){let e=null===(n=t[i])||void 0===n?void 0:n.style;if(e){e=aP(e);for(const n of e)r.push(t.style[n])}}return Object.assign.apply(null,r)}function tY(e,t,n,r={}){var i;const a=t$(e,n,t.style);if(void 0!==a)return{configFrom:"style",configValue:a};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[t])||void 0===i?void 0:i[e]))return{configFrom:t,configValue:r[t][e]};return{}}const nY={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return $W(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return HW(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!hV(e)||!RU(e.bin))&&(null!==(r=t.grid)&&void 0!==r?r:function(e,t){return!mW(e)&&hV(t)&&!FU(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||aY(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||iY(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return null!==(r=e.labelFlush)&&void 0!==r?r:function(e,t){if("x"===t&&OP(["quantitative","temporal"],e))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return null!==(r=e.labelOverlap)&&void 0!==r?r:function(e,t){if("nominal"!==e)return"log"!==t||"greedy"}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var a;const o="x"===e?"width":"y"===e?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return null!==(a=n.tickCount)&&void 0!==a?a:function({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!mW(t)&&"log"!==t){if(hV(e)){if(FU(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&OP(["month","hours","day","quarter"],null===(i=Dq(e.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const r=oY(t,n);if(void 0!==r)return r;const i=t.typedFieldDef(n),a="x"===n?"x2":"y2",o=t.fieldDef(a);return r$(i?[oV(i)]:[],hV(o)?[oV(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;return Qz(n)?VV(t,n):_q(n)?n:void 0}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return null!==(r=e.zindex)&&void 0!==r?r:function(e,t){return"rect"===e&&AV(t)?1:0}(n,t)}};function rY(e){return`(((${e.signal} % 360) + 360) % 360)`}function iY(e,t,n,r){if(void 0!==e){if("x"===n){if(_q(e)){const n=rY(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${_q(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(_q(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(_q(e)){const n=rY(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${_q(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(_q(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function aY(e,t,n){if(void 0===e)return;const r="x"===n,i=r?0:90,a=r?"bottom":"left";if(_q(e)){const n=rY(e);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${_q(t)?`(${t.signal} === "${a}")`:t===a} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if(_q(t)){const n=i<e&&e<180+i?"===":"!==";return{signal:`${t.signal} ${n} "${a}" ? "left" : "right"`}}return(i<e&&e<180+i)==(t===a)?"left":"right"}function oY(e,t){const n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?i$(a,o):a||o||(void 0!==a?a:void 0!==o?o:void 0)}class sY extends HG{constructor(e,t){super(e),this.transform=t,this._dependentFields=UX(this.transform.calculate)}clone(){return new sY(null,AP(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef(((t,n)=>{if(wV(t)&&nV(t.sort)){const{field:r,timeUnit:i}=t,a=t.sort,o=a.map(((e,t)=>`${Vq({field:r,timeUnit:i,equal:e})} ? ${t} : `)).join("")+a.length;e=new sY(e,{calculate:o,as:uY(t,n,{forAs:!0})})}})),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${MP(this.transform)}`}}function uY(e,t,n){return NV(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function cY(e,t){return OP(["top","bottom"],t)?"column":OP(["left","right"],t)||"row"===e?"row":"column"}function lY(e,t,n,r){const i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return tL(((null==t?void 0:t.header)||{})[e],i[e],n.header[e])}function fY(e,t,n,r){const i={};for(const a of e){const e=lY(a,t,n,r);void 0!==e&&(i[a]=e)}return i}const pY=["row","column"],hY=["header","footer"];function dY(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=fY(["titleAnchor","titleAngle","titleOrient"],i,r,t),u=cY(t,s),c=rL(o);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),gY(c,u)),mY(u,c,a)),CY(r,i,t,JX,XX))}}function mY(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=aY(t,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function gY(e,t){const n=iY(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function vY(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of hY)if(n[i])for(const a of n[i]){const o=xY(e,t,i,n,a);null!=o&&r.push(o)}return r}function yY(e,t){var n;const{sort:r}=e;return tV(r)?{field:NV(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:Qz(r)?{field:uY(e,t,{expr:"datum"}),order:"ascending"}:{field:NV(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function bY(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:u}=fY(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),c=qW({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,l=cY(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?ZP(ZP(u,"datum.label",c),"datum.value",NV(e,{expr:"parent"})):c}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),gY(a,l)),mY(l,a,o)),CY(n,e,t,ZX,YX))}function xY(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:o}=r,s=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:e}=fY(["labelOrient"],o,s,t);("row"===t&&!OP(["top","bottom"],e)||"column"===t&&!OP(["left","right"],e))&&(a=bY(o,t,s))}const u=dZ(e)&&!rV(e.facet),c=i.axes,l=(null==c?void 0:c.length)>0;if(a||l){const s="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:yY(o,t)}:{}),l&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:{[s]:i.sizeSignal}}}:{}),l?{axes:c}:{})}}return null}const wY={column:{start:0,end:1},row:{start:1,end:0}};function EY(e,t){return wY[t][e]}function CY(e,t,n,r,i){const a={};for(const o of r){if(!i[o])continue;const r=lY(o,t,e,n);void 0!==r&&(a[i[o]]=r)}return a}function SY(e){return[...NY(e,"width"),...NY(e,"height"),...NY(e,"childWidth"),...NY(e,"childHeight")]}function NY(e,t){const n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];const i=e.getSizeSignalRef(t).signal;if("step"===r){const t=e.getScaleComponent(n);if(t){const r=t.get("type"),a=t.get("range");if(mW(r)&&Mq(a)){const r=e.scaleName(n);return dZ(e.parent)&&"independent"===e.parent.component.resolve.scale[n]?[AY(r,a)]:[AY(r,a),{name:i,update:kY(r,t,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const t=i.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${Y$(e.config.view,t?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function AY(e,t){return{name:e+"_step",value:t.step}}function kY(e,t,n){const r=t.get("type"),i=t.get("padding"),a=tL(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,`bandspace(${n}, ${o}, ${a}) * ${e}_step`}function DY(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function _Y(e,t){return UP(e).reduce(((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),vG(t,i,r,(e=>_q(e)?e:{value:e.value})))}),{})}function MY(e,t){if(gZ(t)||dZ(t))return"shared";if(mZ(t))return pU(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function TY(e,t){const n=e.scale[t],r=pU(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&hq(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[r][t]||"shared"}const OY=Object.assign(Object.assign({},L$),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),IY=UP(OY);class FY extends zH{}const RY={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){var o,s,u,c,l;if("symbol"!==a)return;const{markDef:f,encoding:p,config:h,mark:d}=n,m=f.filled&&"trail"!==d;let g=Object.assign(Object.assign({},function(e,t,n){for(const r of n){const n=QV(r,t.markDef,t.config);void 0!==n&&(e[r]=KV(n))}return e}({},n,TL)),SG(n,{filled:m}));const v=null!==(o=BY(p.opacity))&&void 0!==o?o:f.opacity;if(g.fill)if("fill"===r||m&&r===oj)delete g.fill;else if(g.fill.field)i.get("symbolFillColor")?delete g.fill:(g.fill=KV(null!==(s=h.legend.symbolBaseFillColor)&&void 0!==s?s:"black"),g.fillOpacity=KV(null!=v?v:1));else if(Qz(g.fill)){const e=null!==(l=null!==(c=zY(null!==(u=p.fill)&&void 0!==u?u:p.color))&&void 0!==c?c:f.fill)&&void 0!==l?l:m&&f.color;e&&(g.fill=KV(e))}if(g.stroke)if("stroke"===r||!m&&r===oj)delete g.stroke;else if(g.stroke.field)delete g.stroke;else if(Qz(g.stroke)){const e=tL(zY(p.stroke||p.color),f.stroke,m?f.color:void 0);e&&(g.stroke={value:e})}if(r!==pj){const e=hV(t)&&LY(0,i,t);e?g.opacity=[Object.assign({test:e},KV(null!=v?v:1)),KV(h.legend.unselectedOpacity)]:v&&(g.opacity=KV(v))}return g=Object.assign(Object.assign({},g),e),jP(g)?void 0:g},gradient:function(e,{model:t,legendType:n}){if("gradient"!==n)return;let r={};const i=BY(t.encoding.opacity)||t.markDef.opacity;return i&&(r.opacity=KV(i)),r=Object.assign(Object.assign({},r),e),jP(r)?void 0:r},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},o=n.config,s=hV(t)?LY(0,i,t):void 0,u=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:c,formatType:l}=a,f=jW(l)?VW({fieldOrDatumDef:t,field:"datum.value",format:c,formatType:l,config:o}):void 0,p=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return jP(p)?void 0:p},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function BY(e){return PY(e,((e,t)=>Math.max(e,t.value)))}function zY(e){return PY(e,((e,t)=>tL(e,t.value)))}function PY(e,t){return function(e){const t=e&&e.condition;return!!t&&(Qz(t)||xV(t))}(e)?aP(e.condition).reduce(t,e.value):xV(e)?e.value:void 0}function LY(e,t,n){const r=t.get("selections");if(!(null==r?void 0:r.length))return;const i=fP(n.field);return r.map((e=>`(!length(data(${fP($P(e)+kK)})) || (${e}[${i}] && indexof(${e}[${i}], datum.value) >= 0))`)).join(" || ")}const jY={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return $W(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return HW(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:u}=e;if(vW(i))return"horizontal"===n?"top"===r||"bottom"===r?qY(t,"width",o,a):o:qY(t,"height",u,s)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return null!==(i=null!==(r=e.labelOverlap)&&void 0!==r?r:t.labelOverlap)&&void 0!==i?i:function(e){if(OP(["quantile","threshold","log"],e))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return null!==(i=e.symbolType)&&void 0!==i?i:function(e,t,n,r){var i;if("shape"!==t){const e=null!==(i=zY(n))&&void 0!==i?i:r;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>TV(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Mj(n)&&vW(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;return Qz(n)?VV(t,n):_q(n)?n:void 0}(t,e)};function UY({legendConfig:e,legendType:t,orient:n,legend:r}){var i,a;return null!==(a=null!==(i=r.direction)&&void 0!==i?i:e[t?"gradientDirection":"symbolDirection"])&&void 0!==a?a:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function qY(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function WY(e){const t=hZ(e)?function(e){const{encoding:t}=e,n={};for(const r of[oj,...z$]){const i=BV(t[r]);i&&e.getScaleComponent(r)&&(r===cj&&hV(i)&&i.type===Zq||(n[r]=$Y(e,r)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){WY(r);for(const i of UP(r.component.legends))n.legend[i]=TY(e.component.resolve,i),"shared"===n.legend[i]&&(t[i]=HY(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of UP(t))for(const t of e.children)t.component.legends[r]&&"shared"===n.legend[r]&&delete t.component.legends[r];return t}(e);return e.component.legends=t,t}function VY(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==r?void 0:r.title))return!0}return e===(n||{})[t]}function $Y(e,t){var n,r,i;let a=e.legend(t);const{markDef:o,encoding:s,config:u}=e,c=u.legend,l=new FY({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var r;const i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;TK(e,(e=>{var r,a;const o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&sK.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),o.hasLegend=!0}}))}(e,t,l);const f=void 0!==a?!a:c.disable;if(l.set("disable",f,void 0!==a),f)return l;a=a||{};const p=e.getScaleComponent(t).get("type"),h=BV(s[t]),d=hV(h)?null===(n=Dq(h.timeUnit))||void 0===n?void 0:n.unit:void 0,m=a.orient||u.legend.orient||"right",g=function(e){const{legend:t}=e;return tL(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(Mj(e)){if(OP(["quarter","month","day"],t))return"symbol";if(vW(n))return"gradient"}return"symbol"}(e))}({legend:a,channel:t,timeUnit:d,scaleType:p}),v={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:c,config:u,scaleType:p,orient:m,legendType:g,direction:UY({legend:a,legendType:g,orient:m,legendConfig:c})};for(const n of IY){const r=n in jY?jY[n](v):a[n];if(void 0!==r){const i=VY(r,n,a,e.fieldDef(t));(i||void 0===u.legend[n])&&l.set(n,r,i)}}const y=null!==(r=null==a?void 0:a.encoding)&&void 0!==r?r:{},b=l.get("selections"),x={},w={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:l,legendType:g};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=_Y(null!==(i=y[t])&&void 0!==i?i:{},e),r=t in RY?RY[t](n,w):n;void 0===r||jP(r)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&hV(h)?{name:`${$P(h.field)}_legend_${t}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:r}))}return jP(x)||l.set("encode",x,!!(null==a?void 0:a.encoding)),l}function HY(e,t){var n,r,i,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let u=!1;for(const n of IY){const r=qH(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",((e,t)=>{switch(n){case"symbolType":return r=e,"circle"===(i=t).value?i:r;case"title":return a$(e,t);case"type":return u=!0,LH("symbol")}var r,i;return UH(e,t,n,"legend")}));e.setWithExplicit(n,r)}return u&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&GP(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&GP(e.explicit,["encode","gradient"])),e}function GY(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function KY(e){const t=e.component.legends,n={};for(const r of UP(t)){const i=e.getScaleComponent(r),a=_P(i.get("domains"));if(n[a])for(const e of n[a])HY(e,t[r])||n[a].push(t[r]);else n[a]=[t[r].clone()]}const r=qP(n).flat().map((t=>function(e,t){var n,r,i;const a=e.combine(),{disable:o,labelExpr:s,selections:u}=a,c=hP(a,["disable","labelExpr","selections"]);if(!o){if(!1===t.aria&&null==c.aria&&(c.aria=!1),null===(n=c.encode)||void 0===n?void 0:n.symbols){const e=c.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||c.stroke||(e.stroke={value:"transparent"});for(const t of z$)c[t]&&delete e[t]}if(c.title||delete c.title,void 0!==s){let e=s;(null===(i=null===(r=c.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&_q(c.encode.labels.update.text)&&(e=ZP(s,"datum.label",c.encode.labels.update.text.signal)),GY(c,"labels","text",{signal:e})}for(const e in c){const t=c[e];if(_q(t)){const n=P$[e];if(n){const{vgProp:r,part:i}=n;GY(c,i,r,t),delete c[e]}}}return c}}(t,e.config))).filter((e=>void 0!==e));return r}function XY(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map((e=>e.signal)).join(", ")}]`},a=t.data.reduce(((t,n)=>{const r=_q(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return OP(t,r)||t.push(r),t}),[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const YY=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class JY extends zH{constructor(e,t,n,r){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function ZY(e){e.component.projection=hZ(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){const t=[],{encoding:n}=e;for(const r of[[rj,nj],[aj,ij]])(BV(n[r[0]])||BV(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(cj)&&e.typedFieldDef(cj).type===Zq&&t.push({signal:e.getName(`geojson_${t.length}`)}),0===t.length&&t.push(e.requestDataName(JH)),t}(e):void 0;return new JY(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),i,a)}}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)ZY(t);const n=FP(e.children,(e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=FP(YY,(n=>!sP(e.explicit,n)&&!sP(t.explicit,n)||!(!sP(e.explicit,n)||!sP(t.explicit,n)||_P(e.get(n))!==_P(t.get(n)))));if(_P(e.size)===_P(t.size)){if(n)return e;if(_P(e.explicit)===_P({}))return t;if(_P(t.explicit)===_P({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0}));if(t&&n){const n=e.projectionName(!0),r=new JY(n,t.specifiedProjection,t.size,AP(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&r.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return r}}(e)}function QY(e,t){return`${IU(e)}_${t}`}function eJ(e,t,n){var r;const i=QY(null!==(r=jV(n,void 0))&&void 0!==r?r:{},t);return e.getName(`${i}_bins`)}function tJ(e,t,n){let r,i;r=function(e){return"as"in e}(e)?lP(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[NV(e,{forAs:!0}),NV(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},jV(t,void 0)),o=QY(a,e.field),{signal:s,extentSignal:u}=function(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}(n,o);if(zU(a.extent)){const e=a.extent,t=e.selection;i=VX(n.getSelectionComponent($P(t),t),e),delete a.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},s?{signal:s}:{}),u?{extentSignal:u}:{}),i?{span:i}:{})}}class nJ extends HG{constructor(e,t){super(e),this.bins=t}clone(){return new nJ(null,AP(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{if(bV(n)&&FU(n.bin)){const{key:i,binComponent:a}=tJ(n,n.bin,t);e[i]=Object.assign(Object.assign(Object.assign({},a),e[i]),function(e,t,n,r){var i,a;if($V(t,n)){const o=hZ(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},s=NV(t,{expr:"datum"}),u=NV(t,{expr:"datum",binSuffix:"end"});return{formulaAs:NV(t,{binSuffix:"range",forAs:!0}),formula:YW(s,u,o.format,o.formatType,r)}}return{}}(t,n,r,t.config))}return e}),{});return jP(n)?null:new nJ(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=tJ(t,t.bin,n);return new nJ(e,{[r]:i})}merge(e,t){for(const n of UP(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=BP([...this.bins[n].as,...e.bins[n].as],MP)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(qP(this.bins).map((e=>e.as)).flat(2))}dependentFields(){return new Set(qP(this.bins).map((e=>e.field)))}hash(){return`Bin ${MP(this.bins)}`}assemble(){return qP(this.bins).flatMap((e=>{const t=[],[n,...r]=e.as,i=e.bin,{extent:a}=i,o=hP(i,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:JP(e.field),as:n,signal:e.signal},zU(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:JP(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const e of r)for(let r=0;r<2;r++)t.push({type:"formula",expr:NV({field:n[r]},{expr:"datum"}),as:e[r]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}class rJ extends HG{constructor(e){let t;if(super(null),GH(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},DP(e.format,["parse"])):{}),$H(e))this._data={values:e.values};else if(VH(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];OP(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else XH(e)?this._data={values:[{type:"Sphere"}]}:(HH(e)||GH(e))&&(this._data={});this._generator=GH(e),e.name&&(this._name=e.name),t&&!jP(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function iJ(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return console.error("Dataflow graph is inconsistent.",t,e),!1;if(!iJ(t.children))return!1}return!0}class aJ extends HG{constructor(e,t){super(e),this.params=t}clone(){return new aJ(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${MP(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class oJ extends HG{constructor(e,t){super(e),this.params=t}clone(){return new oJ(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return`Hash ${MP(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function sJ(e){return e instanceof rJ||e instanceof aJ||e instanceof oJ}class uJ{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class cJ extends uJ{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(sJ(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class lJ extends uJ{}class fJ extends HG{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new fJ(null,new Set(this.dimensions),AP(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef((e=>{e.aggregate&&(n=!0)}));const r={},i=new Set;return n?(t.forEachFieldDef(((e,n)=>{var a,o,s,u;const{aggregate:c,field:l}=e;if(c)if("count"===c)r["*"]=null!==(a=r["*"])&&void 0!==a?a:{},r["*"].count=new Set([NV(e,{forAs:!0})]);else{if(PL(c)||LL(c)){const e=PL(c)?"argmin":"argmax",t=c[e];r[t]=null!==(o=r[t])&&void 0!==o?o:{},r[t][e]=new Set([NV({op:e,field:t},{forAs:!0})])}else r[l]=null!==(s=r[l])&&void 0!==s?s:{},r[l][c]=new Set([NV(e,{forAs:!0})]);DU(n)&&"unaggregated"===t.scaleDomain(n)&&(r[l]=null!==(u=r[l])&&void 0!==u?u:{},r[l].min=new Set([NV({field:l,aggregate:"min"},{forAs:!0})]),r[l].max=new Set([NV({field:l,aggregate:"max"},{forAs:!0})]))}else!function(e,t,n,r){const i=hZ(r)?r.encoding[Kj(t)]:void 0;if(bV(n)&&hZ(r)&&cV(t,n,i,r.stack,r.markDef,r.config))e.add(NV(n,{})),e.add(NV(n,{suffix:"end"})),n.bin&&$V(n,t)&&e.add(NV(n,{binSuffix:"range"}));else if(t in kj){const n=function(e){switch(e){case nj:return"y";case ij:return"y2";case rj:return"x";case aj:return"x2"}}(t);e.add(r.getName(n))}else e.add(NV(n))}(i,n,e,t)})),i.size+UP(r).length===0?null:new fJ(e,i,r)):null}static makeFromTransform(e,t){var n,r,i;const a=new Set,o={};for(const e of t.aggregate){const{op:t,field:i,as:a}=e;t&&("count"===t?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([a||NV(e,{forAs:!0})])):(o[i]=null!==(r=o[i])&&void 0!==r?r:{},o[i][t]=new Set([a||NV(e,{forAs:!0})])))}for(const e of null!==(i=t.groupby)&&void 0!==i?i:[])a.add(e);return a.size+UP(o).length===0?null:new fJ(e,a,o)}merge(e){return function(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}(this.dimensions,e.dimensions)?(function(e,t){var n;for(const r of UP(t)){const i=t[r];for(const t of UP(i))r in e?e[r][t]=new Set([...null!==(n=e[r][t])&&void 0!==n?n:[],...i[t]]):e[r]={[t]:i[t]}}}(this.measures,e.measures),!0):(function(...e){pq.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...UP(this.measures)])}producedFields(){const e=new Set;for(const t of UP(this.measures))for(const n of UP(this.measures[t])){const r=this.measures[t][n];0===r.size?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return`Aggregate ${MP({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of UP(this.measures))for(const i of UP(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:JP(r));return{type:"aggregate",groupby:[...this.dimensions].map(JP),ops:e,fields:t,as:n}}}class pJ extends HG{constructor(e,t,n,r){super(e),this.model=t,this.name=n,this.data=r;for(const e of Oj){const n=t.facet[e];if(n){const{bin:r,sort:i}=n;this[e]=Object.assign({name:t.getName(`${e}_domain`),fields:[NV(n),...FU(r)?[NV(n,{binSuffix:"end"})]:[]]},tV(i)?{sortField:i}:Qz(i)?{sortIndexField:uY(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of Oj)this[t]&&(e+=` ${t.charAt(0)}:${MP(this[t])}`);return e}get fields(){var e;const t=[];for(const n of Oj)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of Oj)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of fU){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(mW(r)&&Mq(i)){const n=GJ(KJ(this.childModel,t));n?e[t]=n:hq(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x"}[e],i=[],a=[],o=[];n&&n[r]&&(t?(i.push(`distinct_${n[r]}`),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push(`distinct_${n[r]}`));const{sortField:s,sortIndexField:u}=this[e];if(s){const{op:e=JW,field:t}=s;i.push(t),a.push(e),o.push(NV(s,{forAs:!0}))}else u&&(i.push(u),a.push("max"),o.push(u));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,a=[],o={};for(const e of pY){for(const r of hY){const a=null!==(t=i[e]&&i[e][r])&&void 0!==t?t:[];for(const t of a)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){o[e]=!0;break}}if(o[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?r?{signal:`ceil(${t} / ${r})`}:1:r?{signal:`min(${t}, ${r})`}:{signal:t};a.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:s,column:u}=o;return(s||u)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),o=a.map((()=>"distinct"));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:o}]})}for(const e of[HL,$L])this[e]&&n.push(this.assembleRowColumnHeaderData(e,r,i));if(s){const e=this.assembleFacetHeaderData(i);e&&n.push(...e)}return n}}function hJ(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function dJ(e){const t={};return CP(e.filter,(e=>{var n;if(qq(e)){let r=null;Rq(e)?r=e.equal:jq(e)?r=e.range[0]:Uq(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(dq(r)?t[e.field]="date":cP(r)?t[e.field]="number":lP(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}})),t}class mJ extends HG{constructor(e,t){super(e),this._parse=t}clone(){return new mJ(null,AP(this._parse))}hash(){return`Parse ${MP(this._parse)}`}static makeExplicit(e,t,n){let r={};const i=t.data;return!GH(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const e of UP(n)){const t=r.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:hq(GU(e,n[e],t.value)))}for(const e of UP(t)){const n=r.get(e);void 0!==n&&(n===t[e]?delete t[e]:hq(GU(e,t[e],n)))}const i=new zH(t,n);r.copyAll(i);const a={};for(const e of UP(i.combine())){const t=i.get(e);null!==t&&(a[e]=t)}return 0===UP(a).length||r.parseNothing?null:new mJ(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of UP(this._parse)){const n=this._parse[t];1===eL(t)&&(e[t]=n)}return e}producedFields(){return new Set(UP(this._parse))}dependentFields(){return new Set(UP(this._parse))}assembleTransforms(e=!1){return UP(this._parse).filter((t=>!e||eL(t)>1)).map((e=>{const t=function(e,t){const n=XP(e);return"number"===t?`toNumber(${n})`:"boolean"===t?`toBoolean(${n})`:"string"===t?`toString(${n})`:"date"===t?`toDate(${n})`:"flatten"===t?n:0===t.indexOf("date:")?`timeParse(${n},'${hJ(t.slice(5,t.length))}')`:0===t.indexOf("utc:")?`utcParse(${n},'${hJ(t.slice(4,t.length))}')`:(hq(`Unrecognized parse "${t}".`),null)}(e,this._parse[e]);return t?{type:"formula",expr:t,as:QP(e)}:null})).filter((e=>null!==e))}}class gJ extends HG{clone(){return new gJ(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([j$])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:j$}}}class vJ extends HG{constructor(e,t){super(e),this.transform=t}clone(){return new vJ(null,AP(this.transform))}addDimensions(e){this.transform.groupby=BP(this.transform.groupby.concat(e),(e=>e))}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((e=>e.field)).filter((e=>void 0!==e)).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:NV(e)}hash(){return`JoinAggregateTransform ${MP(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(void 0===r.field?null:r.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==r?{groupby:r}:{})}}class yJ extends HG{constructor(e,t){super(e),this._stack=t}clone(){return new yJ(null,AP(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,o=[],s=[];if(void 0!==t.sort)for(const e of t.sort)o.push(e.field),s.push(tL(e.order,"ascending"));const u={field:o,order:s};let c;return c=function(e){return Qz(e)&&e.every((e=>lP(e)))&&e.length>1}(i)?i:lP(i)?[i,i+"_end"]:[t.stack+"_start",t.stack+"_end"],new yJ(e,{stackField:n,groupby:r,offset:a,sort:u,facetby:[],as:c})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:o,impute:s}=n;let u;i&&(u=RV(r[i]));const c=function(e){return e.stack.stackBy.reduce(((e,t)=>{const n=NV(t.fieldDef);return n&&e.push(n),e}),[])}(t),l=t.encoding.order;let f;return f=Qz(l)||hV(l)?n$(l):c.reduce(((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e)),{field:[],order:[]}),new yJ(e,{dimensionFieldDef:u,stackField:t.vgField(a),facetby:[],stackby:c,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${MP(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[NV(e,{binSuffix:"mid"})]:[NV(e,{}),NV(e,{binSuffix:"end"})]:[NV(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:o,impute:s,as:u}=this._stack;if(s&&n){const{band:a=.5,bin:o}=n;o&&e.push({type:"formula",expr:`${a}*`+NV(n,{expr:"datum"})+`+${1-a}*`+NV(n,{expr:"datum",binSuffix:"end"}),as:NV(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:NV(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:u,offset:o}),e}}class bJ extends HG{constructor(e,t){super(e),this.transform=t}clone(){return new bJ(null,AP(this.transform))}addDimensions(e){this.transform.groupby=BP(this.transform.groupby.concat(e),(e=>e))}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((e=>n.add(e.field))),this.transform.window.map((e=>e.field)).filter((e=>void 0!==e)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:NV(e)}hash(){return`WindowTransform ${MP(this.transform)}`}assemble(){var e;const t=[],n=[],r=[],i=[];for(const e of this.transform.window)n.push(e.op),r.push(this.getDefaultName(e)),i.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every((e=>jL(e))))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==o?{groupby:o}:{});const s=[],u=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)s.push(t.field),u.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const c={field:s,order:u},l=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:t,sort:c},void 0!==l?{ignorePeers:l}:{}),void 0!==o?{groupby:o}:{}),void 0!==a?{frame:a}:{})}}class xJ extends cJ{run(e){const t=e.parent;if(e instanceof mJ){if(sJ(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof mJ)this.setMutated(),t.merge(e);else{if(LP(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class wJ extends lJ{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map((e=>e.hash())),n={};for(let r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const t of UP(n))n[t].length>1&&(this.setMutated(),this.mergeNodes(e,n[t]));for(const t of e.children)this.run(t);return this.mutatedFlag}}class EJ extends cJ{run(e){return e instanceof GG||e.numChildren()>0||e instanceof pJ||(this.setMutated(),e.remove()),this.flags}}class CJ extends cJ{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(e){if(this.setContinue(),e instanceof KG){const t=e.producedFields();zP(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class SJ extends cJ{run(e){this.setContinue();const t=e.parent.children.filter((e=>e instanceof KG)),n=t.pop();for(const e of t)this.setMutated(),n.merge(e);return this.flags}}function NJ(e){if(e instanceof pJ)if(1!==e.numChildren()||e.children[0]instanceof GG){const n=e.model.component.data.main;AJ(n);const r=(t=e,function e(n){if(!(n instanceof pJ)){const r=n.clone();if(r instanceof GG){const e=IJ+r.getSource();r.setSource(e),t.model.component.data.outputNodes[e]=r}else(r instanceof fJ||r instanceof yJ||r instanceof bJ||r instanceof vJ)&&r.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=r;return[r]}return n.children.flatMap(e)}),i=e.children.map(r).flat();for(const e of i)e.parent=n}else{const t=e.children[0];(t instanceof fJ||t instanceof yJ||t instanceof bJ||t instanceof vJ)&&t.addDimensions(e.fields),t.swapWithParent(),NJ(e)}else e.children.map(NJ);var t}function AJ(e){if(e instanceof GG&&e.type===JH&&1===e.numChildren()){const t=e.children[0];t instanceof pJ||(t.swapWithParent(),AJ(e))}}class kJ extends lJ{constructor(){super()}run(e){e instanceof GG&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class DJ extends lJ{constructor(e){super(),this.requiresSelectionId=e&&IK(e)}run(e){e instanceof gJ&&(this.requiresSelectionId&&(sJ(e.parent)||e.parent instanceof fJ||e.parent instanceof mJ)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class _J extends cJ{run(e){const t=e.parent,n=[...t.children],r=t.children.filter((e=>e instanceof mJ));if(t.numChildren()>1&&r.length>=1){const e={},i=new Set;for(const t of r){const n=t.parse;for(const t of UP(n))t in e?e[t]!==n[t]&&i.add(t):e[t]=n[t]}for(const t of i)delete e[t];if(!jP(e)){this.setMutated();const r=new mJ(t,e);for(const i of n){if(i instanceof mJ)for(const t of UP(e))delete i.parse[t];t.removeChild(i),i.parent=r,i instanceof mJ&&0===UP(i.parse).length&&i.remove()}}}return this.setContinue(),this.flags}}class MJ extends cJ{run(e){const t=e.parent,n=t.children.filter((e=>e instanceof fJ)),r={};for(const e of n){const t=MP(e.groupBy);t in r||(r[t]=[]),r[t].push(e)}for(const e of UP(r)){const n=r[e];if(n.length>1){const e=n.pop();for(const r of n)e.merge(r)&&(t.removeChild(r),r.parent=e,r.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class TJ extends cJ{constructor(e){super(),this.model=e}run(e){const t=e.parent,n=!(sJ(t)||t instanceof qX||t instanceof mJ||t instanceof gJ),r=[],i=[];for(const e of t.children)e instanceof nJ&&(n&&!LP(t.producedFields(),e.dependentFields())?r.push(e):i.push(e));if(r.length>0){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof nJ?t.merge(e,this.model.renameSignal.bind(this.model)):e.swapWithParent()}if(i.length>1){const e=i.pop();for(const t of i)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class OJ extends cJ{run(e){const t=e.parent,n=[...t.children];if(!IP(n,(e=>e instanceof GG))||t.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let i;for(const e of n)if(e instanceof GG){let n=e;for(;1===n.numChildren();){const e=n.children[0];if(!(e instanceof GG))break;n=e}r.push(...n.children),i?(t.removeChild(e),e.parent=i.parent,i.parent.removeChild(i),i.parent=n,this.setMutated()):i=n}else r.push(e);if(r.length){this.setMutated();for(const e of r)e.parent.removeChild(e),e.parent=i}return this.setContinue(),this.flags}}const IJ="scale_";function FJ(e){const t=[];function n(e){if(0===e.numChildren())t.push(e);else for(const t of e.children)n(t)}for(const t of e)n(t);return t}function RJ(e){return e}function BJ(e,t){return t.map((t=>{if(e instanceof cJ){const n=e.optimizeNextFromLeaves(t);return e.reset(),n}return e.run(t)})).some(RJ)}function zJ(e,t){let n=e.sources;const r=new Set;return r.add(BJ(new kJ,n)),r.add(BJ(new DJ(t),n)),n=n.filter((e=>e.numChildren()>0)),r.add(BJ(new EJ,FJ(n))),n=n.filter((e=>e.numChildren()>0)),r.add(BJ(new xJ,FJ(n))),r.add(BJ(new TJ(t),FJ(n))),r.add(BJ(new CJ,FJ(n))),r.add(BJ(new _J,FJ(n))),r.add(BJ(new MJ,FJ(n))),r.add(BJ(new SJ,FJ(n))),r.add(BJ(new wJ,n)),r.add(BJ(new OJ,FJ(n))),e.sources=n,r.has(!0)}class PJ{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new PJ((()=>e(t)))}}function LJ(e){hZ(e)?function(e){const t=e.component.scales;for(const n of UP(t)){const r=jJ(e,n);if(t[n].setWithExplicit("domains",r),VJ(e,n),e.component.data.isFaceted){let t=e;for(;!dZ(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of r.value)Tq(e)&&(e.data=IJ+e.data.replace(IJ,""))}}}(e):function(e){for(const t of e.children)LJ(t);const t=e.component.scales;for(const n of UP(t)){let r,i=null;for(const t of e.children){const e=t.component.scales[n];if(e){r=void 0===r?e.getWithExplicit("domains"):qH(r,e.getWithExplicit("domains"),"domains","scale",HJ);const t=e.get("selectionExtent");i&&t&&i.selection!==t.selection&&hq("The same selection must be used to override scale domains in a layered view."),i=t}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}(e)}function jJ(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(e,t,n,r){if("unaggregated"===e){const{valid:e,reason:r}=$J(t,n);if(!e)return void hq(r)}else if(void 0===e&&r.useUnaggregatedDomain){const{valid:e}=$J(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&BV(r.x2)?BV(r.x)?qH(qJ(n,i,e,"x"),qJ(n,i,e,"x2"),"domain","scale",HJ):qJ(n,i,e,"x2"):"y"===t&&BV(r.y2)?BV(r.y)?qH(qJ(n,i,e,"y"),qJ(n,i,e,"y2"),"domain","scale",HJ):qJ(n,i,e,"y2"):qJ(n,i,e,t)}function UJ(e,t,n){var r;const i=null===(r=Dq(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map((e=>({signal:`{data: ${WV(e,{timeUnit:n,type:t})}}`})))}(e,t,i):[e]}function qJ(e,t,n,r){const{encoding:i}=n,a=BV(i[r]),{type:o}=a,s=a.timeUnit;if(function(e){return e&&e.unionWith}(t)){const i=qJ(e,void 0,n,r),a=UJ(t.unionWith,o,s);return PH([...i.value,...a])}if(_q(t))return PH([t]);if(t&&"unaggregated"!==t&&!bW(t))return PH(UJ(t,o,s));const u=n.stack;if(u&&r===u.fieldChannel){if("normalize"===u.offset)return LH([[0,1]]);const e=n.requestDataName(JH);return LH([{data:e,field:n.vgField(r,{suffix:"start"})},{data:e,field:n.vgField(r,{suffix:"end"})}])}const c=DU(r)&&hV(a)?function(e,t,n){if(!mW(n))return;const r=e.fieldDef(t),i=r.sort;if(nV(i))return{op:"min",field:uY(r,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map((e=>e.fieldDef.field))]:void 0;if(tV(i))return WJ(i,a&&!OP(o,i.field));if(eV(i)){const{encoding:t,order:n}=i,r=e.fieldDef(t),{aggregate:s,field:u}=r,c=a&&!OP(o,u);if(PL(s)||LL(s))return WJ({field:NV(r),order:n},c);if(jL(s)||!s)return WJ({op:s,field:u,order:n},c)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(OP(["ascending",void 0],i))return!0}}(n,r,e):void 0;if(mV(a))return LH(UJ([a.datum],o,s));const l=a;if("unaggregated"===t){const e=n.requestDataName(JH),{field:t}=a;return LH([{data:e,field:NV({field:t,aggregate:"min"})},{data:e,field:NV({field:t,aggregate:"max"})}])}if(FU(l.bin)){if(mW(e))return LH("bin-ordinal"===e?[]:[{data:VP(c)?n.requestDataName(JH):n.requestDataName(ZH),field:n.vgField(r,$V(l,r)?{binSuffix:"range"}:{}),sort:!0!==c&&eP(c)?c:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:e}=l;if(FU(e)){const t=eJ(n,l.field,e);return LH([new PJ((()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`}))])}return LH([{data:n.requestDataName(JH),field:n.vgField(r,{})}])}}if(l.timeUnit&&OP(["time","utc"],e)&&cV(r,l,hZ(n)?n.encoding[Kj(r)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(JH);return LH([{data:e,field:n.vgField(r)},{data:e,field:n.vgField(r,{suffix:"end"})}])}return LH(c?[{data:VP(c)?n.requestDataName(JH):n.requestDataName(ZH),field:n.vgField(r),sort:c}]:[{data:n.requestDataName(JH),field:n.vgField(r)}])}function WJ(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":JW},r?{field:JP(r)}:{}),i?{order:i}:{})}function VJ(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,o=bW(i)&&i,s=BU(a)&&zU(a.extent)&&a.extent;(o||s)&&r.set("selectionExtent",null!=o?o:s,!0)}function $J(e,t){const{aggregate:n,type:r}=e;return n?lP(n)&&!VL[n]?{valid:!1,reason:nq(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:rq(e)}:{valid:!0}:{valid:!1,reason:tq(e)}}function HJ(e,t,n,r){return e.explicit&&t.explicit&&hq(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${_P(n)} and ${_P(r)}). Using the union of the two domains.`}(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function GJ(e){if(Tq(e)&&lP(e.field))return e.field;if(function(e){return!Qz(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(Tq(n)&&lP(n.field))if(t){if(t!==n.field)return hq("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return hq("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!Qz(e)&&"fields"in e&&"data"in e}(e)){hq("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return lP(t)?t:void 0}}function KJ(e,t){return function(e){const t=BP(e.map((e=>{if(Tq(e)){const{sort:t}=e;return hP(e,["sort"])}return e})),MP),n=BP(e.map((e=>{if(Tq(e)){const t=e.sort;return void 0===t||VP(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((e=>void 0!==e)),MP);if(0===t.length)return;if(1===t.length){const t=e[0];if(Tq(t)&&n.length>0){let e=n[0];if(n.length>1)hq(oq),e=!0;else if(eP(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const r=BP(n.map((e=>VP(e)||!("op"in e)||e.op in zL?e:(hq(function(e){return`Dropping sort property ${_P(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0))),MP);let i;1===r.length?i=r[0]:r.length>1&&(hq(oq),i=!0);const a=BP(e.map((e=>Tq(e)?e.data:null)),(e=>e));return 1===a.length&&null!==a[0]?Object.assign({data:a[0],fields:t.map((e=>e.field))},i?{sort:i}:{}):Object.assign({fields:t},i?{sort:i}:{})}(e.component.scales[t].get("domains").map((t=>(Tq(t)&&(t.data=e.lookupDataSource(t.data)),t))))}function XJ(e){return gZ(e)||mZ(e)?e.children.reduce(((e,t)=>e.concat(XJ(t))),YJ(e)):YJ(e)}function YJ(e){return UP(e.component.scales).reduce(((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:o,selectionExtent:s,domains:u,range:c,reverse:l}=i,f=hP(i,["name","type","selectionExtent","domains","range","reverse"]),p=function(e,t,n){return pU(n)&&Mq(e)?{step:{signal:t+"_step"}}:e}(i.range,a,n);let h;s&&(h=function(e,t){const n=t.selection;return{signal:VX(e.getSelectionComponent(n,$P(n)),t)}}(e,s));const d=KJ(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},d?{domain:d}:{}),h?{domainRaw:h}:{}),{range:p}),void 0!==l?{reverse:l}:{}),f)),t}),[])}class JJ extends zH{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||IP(this.get("domains"),(e=>Qz(e)&&2===e.length&&e[0]<=0&&e[1]>=0))}}const ZJ=["range","scheme"];function QJ(e){return"x"===e?"width":"y"===e?"height":void 0}function eZ(e,t){const n=e.fieldDef(t);if(n&&n.bin&&FU(n.bin)){const r=eJ(e,n.field,n.bin),i=QJ(t),a=e.getName(i);return new PJ((()=>{const t=e.getSignalName(r),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`}))}}function tZ(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const r of ZJ)if(void 0!==n[r]){const a=kW(i,r),o=DW(e,r);if(a)if(o)hq(o);else switch(r){case"range":return Qz(n.range)&&pU(e)?PH(n.range.map((e=>{if("width"===e||"height"===e){const n=t.getName(e),r=t.getSignalName.bind(t);return PJ.fromName(r,n)}return e}))):PH(n.range);case"scheme":return PH(nZ(n[r]))}else hq(iq(i,r,e))}if(e===KL||e===XL){const t=e===KL?"width":"height",n=r[t];if(G$(n)){if(mW(i))return PH({step:n.step});hq(aq(t))}}return LH(function(e,t){const{size:n,config:r,mark:i,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=BV(a[e]),u=t.getScaleComponent(e).get("type"),{domain:c,domainMid:l}=t.specifiedScales[e];switch(e){case KL:case XL:{if(OP(["point","band"],u))if(e!==KL||n.width){if(e===XL&&!n.height){const e=Z$(r.view,"height");if(G$(e))return e}}else{const e=Z$(r.view,"width");if(G$(e))return e}const i=QJ(e),a=t.getName(i);return e===XL&&gW(u)?[PJ.fromName(o,a),0]:[0,PJ.fromName(o,a)]}case lj:{const a=rZ(i,t.component.scales[e].get("zero"),r),o=function(e,t,n,r){const i={x:eZ(n,"x"),y:eZ(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const e=aZ(t,i,r.view);return cP(e)?e-1:new PJ((()=>`${e.signal} - 1`))}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const e=aZ(t,i,r.view);return cP(e)?Math.pow(iZ*e,2):new PJ((()=>`pow(0.95 * ${e.signal}, 2)`))}}throw new Error(ZU("size",e))}(i,n,t,r);return yW(u)?function(e,t,n){const r=()=>{const r=YV(t),i=YV(e),a=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${a}, ${a})`};return _q(t)?new PJ(r):{signal:r()}}(a,o,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&Qz(n)?n.length+1:(hq(function(e){return`Domain for ${e} is required for threshold scale.`}(r)),3)}}(u,r,c,e)):[a,o]}case ej:return[0,2*Math.PI];case fj:return[0,360];case ZL:return[0,new PJ((()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`))];case mj:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case gj:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case cj:return"symbol";case oj:case sj:case uj:return"ordinal"===u?"nominal"===s?"category":"ordinal":void 0!==l?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case pj:case hj:case dj:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}(e,t))}function nZ(e){return function(e){return!lP(e)&&!!e.name}(e)?Object.assign({scheme:e.name},DP(e,["name"])):{scheme:e}}function rZ(e,t,n){if(t)return _q(t)?{signal:`${t.signal} ? 0 : ${rZ(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(ZU("size",e))}const iZ=.95;function aZ(e,t,n){const r=G$(e.width)?e.width.step:J$(n,"width"),i=G$(e.height)?e.height.step:J$(n,"height");return t.x||t.y?new PJ((()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`)):Math.min(r,i)}function oZ(e,t){hZ(e)?function(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:o}=e;for(const s of UP(n)){const u=o[s],c=n[s],l=e.getScaleComponent(s),f=BV(i[s]),p=u[t],h=l.get("type"),d=l.get("padding"),m=l.get("paddingInner"),g=kW(h,t),v=DW(s,t);if(void 0!==p&&(g?v&&hq(v):hq(iq(h,t,s))),g&&void 0===v)if(void 0!==p)c.copyKeyFromObject(t,u);else{const n=t in sZ?sZ[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:d,scalePaddingInner:m,domain:u.domain,markDef:a,config:r}):r.scale[t];void 0!==n&&c.set(t,n,!1)}}}(e,t):cZ(e,t)}const sZ={bins:({model:e,fieldOrDatumDef:t})=>hV(t)?function(e,t){const n=t.bin;if(FU(n)){const r=eJ(e,t.field,n);return new PJ((()=>e.getSignalName(r)))}if(RU(n)&&BU(n)&&void 0!==n.step)return{step:n.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(OP([oj,sj,uj],e)&&"nominal"!==t)return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var r;if(!(null===(r=RV(n))||void 0===r?void 0:r.bin)&&!OP([tW,nW],e))return t in lU||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(e,t,n,r,i,a){if(e in lU){if(vW(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:o}=i;if("bar"===t&&(!hV(r)||!r.bin&&!r.timeUnit)&&("vertical"===o&&"x"===e||"horizontal"===o&&"y"===e))return a.continuousBandSize}if(t===rW)return n.pointPadding}}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(e,t,n,r){if(void 0===e&&t in lU){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i}=r;return tL(e,"bar"===n?t:i)}}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:a})=>function(e,t,n,r,i,a){if(void 0===e&&t in lU&&"band"===n){const{bandPaddingOuter:e}=a;return tL(e,_q(i)?{signal:`${i.signal}/2`}:i/2)}}(e,t,n,r.type,i,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(e,t,n,r){return"x"===n&&void 0!==r.xReverse?gW(e)&&"descending"===t?_q(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse:!(!gW(e)||"descending"!==t)||void 0}(t,hV(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(e,t,n,r,i){if(n&&"unaggregated"!==n&&gW(i)){if(Qz(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!yW(i))return!0;if((!hV(t)||!t.bin)&&OP([...fU,...dU],e)){const{orient:t,type:n}=r;return!OP(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,r,i)};function uZ(e){hZ(e)?function(e){const t=e.component.scales;for(const n of kU){const r=t[n];if(!r)continue;const i=tZ(n,e);r.setWithExplicit("range",i)}}(e):cZ(e,"range")}function cZ(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?uZ(n):oZ(n,t);for(const r of UP(n)){let i;for(const n of e.children){const e=n.component.scales[r];e&&(i=qH(i,e.getWithExplicit(t),t,"scale",jH(((e,n)=>"range"===t&&e.step&&n.step?e.step-n.step:0))))}n[r].setWithExplicit(t,i)}}function lZ(e){hZ(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return kU.reduce(((r,i)=>{const a=BV(t[i]);if(a&&n===AL&&i===cj&&a.type===Zq)return r;let o=a&&a.scale;if(a&&null!==o&&!1!==o){o=null!=o?o:{};const t=function(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(Mj(e)||"discrete"===OU(e))return"shape"===e&&"ordinal"===t.type&&hq(eq(e,"ordinal")),"ordinal";if(e in lU){if(OP(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in hU)return"band";return void 0!==t.band||EV(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return Mj(e)?"time":"discrete"===OU(e)?(hq(eq(e,"temporal")),"ordinal"):hV(t)&&t.timeUnit&&Dq(t.timeUnit).utc?"utc":"time";case"quantitative":return Mj(e)?hV(t)&&FU(t.bin)?"bin-ordinal":"linear":"discrete"===OU(e)?(hq(eq(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(XU(t.type))}(t,n,r),{type:a}=e;return DU(t)?void 0!==a?MW(t,a)?hV(n)&&!_W(a,n.type)?(hq(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(a,i)),i):a:(hq(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,a,i)),i):i:null}(o,i,a,n);r[i]=new JJ(e.scaleName(i+"",!0),{value:t,explicit:o.type===t})}return r}),{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const n of e.children){lZ(n);for(const a of UP(n.component.scales))if(i.scale[a]=null!==(t=i.scale[a])&&void 0!==t?t:MY(a,e),"shared"===i.scale[a]){const e=r[a],t=n.component.scales[a].getWithExplicit("type");e?oW(e.value,t.value)?r[a]=qH(e,t,"type","scale",fZ):(i.scale[a]="independent",delete r[a]):r[a]=t}}for(const t of UP(r)){const i=e.scaleName(t,!0),a=r[t];n[t]=new JJ(i,a);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),i),e.merged=!0)}}return n}(e)}const fZ=jH(((e,t)=>uW(e)-uW(t)));class pZ{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function hZ(e){return"unit"===(null==e?void 0:e.type)}function dZ(e){return"facet"===(null==e?void 0:e.type)}function mZ(e){return"concat"===(null==e?void 0:e.type)}function gZ(e){return"layer"===(null==e?void 0:e.type)}class vZ{constructor(e,t,n,r,i,a,o){var s,u;this.type=t,this.parent=n,this.config=i,this.view=o,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=i,this.name=null!==(s=e.name)&&void 0!==s?s:r,this.title=GV(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new pZ,this.projectionNameMap=n?n.projectionNameMap:new pZ,this.signalNameMap=n?n.signalNameMap:new pZ,this.data=e.data,this.description=e.description,this.transforms=(null!==(u=e.transform)&&void 0!==u?u:[]).map((e=>QH(e)?{filter:SP(e.filter,Hq)}:e)),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var r,i;const a=n[t],o={},{spacing:s,columns:u}=a;void 0!==s&&(o.spacing=s),void 0!==u&&(aV(e)&&!rV(e.facet)||V$(e))&&(o.columns=u),$$(e)&&(o.columns=1);for(const t of X$)if(void 0!==e[t])if("spacing"===t){const n=e[t];o[t]=cP(n)?n:{row:null!==(r=n.row)&&void 0!==r?r:s,column:null!==(i=n.column)&&void 0!==i?i:s}}else o[t]=e[t];return o}(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:aV(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new zH,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?AP(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){lZ(e),LJ(e);for(const t of AW)oZ(e,t);t||uZ(e)}(this)}parseProjection(){ZY(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){WY(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const{style:t}=e,n=hP(e,["style"]),r={};for(const e of UP(n)){const t=n[e];void 0!==t&&(r[e]=KV(t))}return r}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=KV(this.description)),"unit"!==this.type&&"layer"!==this.type)?jP(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=hP(e,["spacing"]),{component:r,config:i}=this,a=function(e,t){const n={};for(const r of Oj){const i=e[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:e,titleOrient:a}=fY(["titleAnchor","titleOrient"],i.facetFieldDef,t,r),o=cY(r,a),s=EY(e,o);void 0!==s&&(n[o]=s)}}return jP(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of Oj)e[n].title&&t.push(dY(this,n));for(const e of pY)t=t.concat(vY(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:r=[]}=e;return[...n.map((e=>GX(e,"grid",t))),...r.map((e=>GX(e,"grid",t))),...n.map((e=>GX(e,"main",t))),...r.map((e=>GX(e,"main",t)))].filter((e=>e))}(this.component.axes,this.config)}assembleLegends(){return KY(this)}assembleProjections(){return gZ(e=this)||mZ(e)?function(e){return e.children.reduce(((e,t)=>e.concat(t.assembleProjections())),XY(e))}(e):XY(e);var e}assembleTitle(){var e,t,n;const r=null!==(e=this.title)&&void 0!==e?e:{},{encoding:i}=r,a=hP(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},HV(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text)return OP(["unit","layer"],this.type)?OP(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",jP(o)?void 0:o}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||dZ(this.parent)?XJ(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return $P((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),r=this.component.data.outputNodeRefCounts;return r[n]=(null!==(t=r[n])&&void 0!==t?t:0)+1,n}getSizeSignalRef(e){if(dZ(this.parent)){const t=mU(DY(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),r=n.get("range");if(mW(e)&&Mq(r)){const e=n.get("name"),r=GJ(KJ(this,t));return r?{signal:kY(e,n,NV({aggregate:"distinct",field:r},{expr:"datum"}))}:(hq(`Unknown field for ${t}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):Wj(e)&&DU(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(`Cannot find a selection named "${t}".`);return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((e=>e.hasOrientSignalRef())))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((e=>e.hasOrientSignalRef())))}}class yZ extends vZ{vgField(e,t={}){const n=this.fieldDef(e);if(n)return NV(n,t)}reduceFieldDef(e,t){return p$(this.getMapping(),((t,n,r)=>{const i=RV(n);return i?e(t,i,r):t}),t)}forEachFieldDef(e,t){f$(this.getMapping(),((t,n)=>{const r=RV(t);r&&e(r,n)}),t)}}class bZ extends HG{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=AP(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"value",null!==(i=a[1])&&void 0!==i?i:"density"]}clone(){return new bZ(null,AP(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${MP(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=hP(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class xZ extends HG{constructor(e,t){super(e),this.filter=t}clone(){return new xZ(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:r,markDef:i}=t;if("filter"!==ZV("invalid",i,n))return null;const a=t.reduceFieldDef(((e,n,i)=>{const a=DU(i)&&t.getScaleComponent(i);return a&&gW(a.get("type"))&&"count"!==n.aggregate&&!kL(r)&&(e[n.field]=n),e}),{});return UP(a).length?new xZ(e,a):null}dependentFields(){return new Set(UP(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${MP(this.filter)}`}assemble(){const e=UP(this.filter).reduce(((e,t)=>{const n=this.filter[t],r=NV(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(e.push(`isValid(${r})`),e.push(`isFinite(+${r})`))),e}),[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class wZ extends HG{constructor(e,t){super(e),this.transform=t,this.transform=AP(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map(((e,t)=>{var n;return null!==(n=r[t])&&void 0!==n?n:e}))}clone(){return new wZ(this.parent,AP(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${MP(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class EZ extends HG{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=AP(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"key",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new EZ(null,AP(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${MP(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class CZ extends HG{constructor(e,t,n,r){super(e),this.fields=t,this.geojson=n,this.signal=r}clone(){return new CZ(null,AP(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[rj,nj],[aj,ij]]){const i=r.map((e=>{const n=BV(t.encoding[e]);return hV(n)?n.field:mV(n)?{expr:`${n.datum}`}:xV(n)?{expr:`${n.value}`}:void 0}));(i[0]||i[1])&&(e=new CZ(e,i,null,t.getName("geojson_"+n++)))}if(t.channelHasField(cj)){const r=t.typedFieldDef(cj);r.type===Zq&&(e=new CZ(e,null,r.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(lP);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${MP(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class SZ extends HG{constructor(e,t,n,r){super(e),this.projection=t,this.fields=n,this.as=r}clone(){return new SZ(null,this.projection,AP(this.fields),AP(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[rj,nj],[aj,ij]]){const r=n.map((e=>{const n=BV(t.encoding[e]);return hV(n)?n.field:mV(n)?{expr:`${n.datum}`}:xV(n)?{expr:`${n.value}`}:void 0})),i=n[0]===aj?"2":"";(r[0]||r[1])&&(e=new SZ(e,t.projectionName(),r,[t.getName("x"+i),t.getName("y"+i)]))}return e}dependentFields(){return new Set(this.fields.filter(lP))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${MP(this.fields)} ${MP(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class NZ extends HG{constructor(e,t){super(e),this.transform=t}clone(){return new NZ(null,AP(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e;return{signal:`sequence(${[t,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,t){return new NZ(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(hV(r)&&hV(i)){const a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;const o=r.impute?i:i.impute?r:void 0,{method:s,value:u,frame:c,keyvals:l}=a.impute,f=h$(t.mark,n);return new NZ(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),void 0!==u?{value:u}:{}),c?{frame:c}:{}),void 0!==l?{keyvals:l}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${MP(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:(u=n,void 0!==(null==u?void 0:u.stop)?this.processSequence(n):n)}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:a});var u;return r&&"value"!==r?[s,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:o,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]:[s]}}class AZ extends HG{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=AP(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.loess]}clone(){return new AZ(null,AP(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${MP(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,r=hP(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}class kZ extends HG{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new kZ(null,AP(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let o=null;if(function(e){return"data"in e}(a)){let e=qZ(a.data,i);e||(e=new rJ(a.data),i.push(e));const n=t.getName(`lookup_${r}`);o=new GG(e,n,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=o}else if(function(e){return"selection"in e}(a)){const e=a.selection;if(n=Object.assign({as:e},n),o=t.getSelectionComponent($P(e),e).materialized,!o)throw new Error(`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`)}return new kZ(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?aP(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${MP({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:aP(this.transform.as)}:{});else{let t=this.transform.as;lP(t)||(hq('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class DZ extends HG{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=AP(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"prob",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new DZ(null,AP(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${MP(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=hP(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}class _Z extends HG{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=AP(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.regression]}clone(){return new _Z(null,AP(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${MP(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,r=hP(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}class MZ extends HG{constructor(e,t){super(e),this.transform=t}clone(){return new MZ(null,AP(this.transform))}addDimensions(e){var t;this.transform.groupby=BP((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(e=>e))}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return`PivotTransform ${MP(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class TZ extends HG{constructor(e,t){super(e),this.transform=t}clone(){return new TZ(null,AP(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${MP(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function OZ(e){let t=0;return function n(r,i){var a;if(r instanceof rJ&&!r.isGenerator&&!VH(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof mJ&&(r.parent instanceof rJ&&!i.source?(i.format=Object.assign(Object.assign({},null!==(a=i.format)&&void 0!==a?a:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof pJ){i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const t of r.assemble())e.push(t)}else switch((r instanceof aJ||r instanceof oJ||r instanceof xZ||r instanceof qX||r instanceof sY||r instanceof SZ||r instanceof CZ||r instanceof fJ||r instanceof kZ||r instanceof bJ||r instanceof vJ||r instanceof EZ||r instanceof wZ||r instanceof bZ||r instanceof AZ||r instanceof DZ||r instanceof _Z||r instanceof gJ||r instanceof TZ||r instanceof MZ)&&i.transform.push(r.assemble()),(r instanceof nJ||r instanceof KG||r instanceof NZ||r instanceof yJ)&&i.transform.push(...r.assemble()),r instanceof GG&&(i.source&&0===i.transform.length?r.setSource(i.source):r.parent instanceof GG?r.setSource(i.name):(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof GG&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+t++);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const e of r.children)n(e,{name:null,source:a,transform:[]});break}}}}function IZ(e){return"top"===e||"left"===e||_q(e)?"header":"footer"}function FZ(e,t){var n;const{facet:r,config:i,child:a,component:o}=e;if(e.channelHasField(t)){const s=r[t],u=lY("title",null,i,t);let c=TV(s,i,{allowDisabling:!0,includeDefault:void 0===u||!!u});a.component.layoutHeaders[t].title&&(c=Qz(c)?c.join(", "):c,c+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const l=lY("labelOrient",s,i,t),f=tL((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),p=OP(["bottom","right"],l)?"footer":"header";o.layoutHeaders[t]={title:c,facetFieldDef:s,[p]:"facet"===t?[]:[RZ(e,t,f)]}}}function RZ(e,t,n){const r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function BZ(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:a}=e.component;if(a.axis[t]=TY(a,t),"shared"===a.axis[t]){const a="x"===t?"column":"row",o=i[a];for(const i of r.component.axes[t]){const t=IZ(i.get("orient"));o[t]=null!==(n=o[t])&&void 0!==n?n:[RZ(e,a,!1)];const r=GX(i,"main",e.config,{header:!0});r&&o[t][0].axes.push(r),i.mainExtracted=!0}}}}function zZ(e){for(const t of e.children)t.parseLayoutSize()}function PZ(e,t){const n=DY(t),r=mU(n),i=e.component.resolve,a=e.component.layoutSize;let o;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),a=i.scale[r];if("independent"===a&&"step"===e.value){o=void 0;break}if(o){if("independent"===a&&o.value!==e.value){o=void 0;break}o=qH(o,e,n,"")}else o=e}if(o){for(const r of e.children)e.renameSignal(r.getName(n),e.getName(t)),r.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function LZ(e,t){const n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const e=i.get("type"),n=i.get("range");if(mW(e)){const e=Z$(r.view,t);return Mq(n)||G$(e)?"step":e}return Y$(r.view,t)}if(e.hasProjection||"arc"===e.mark)return Y$(r.view,t);{const e=Z$(r.view,t);return G$(e)?e.step:e}}function jZ(e,t,n){return NV(t,Object.assign({suffix:`by_${NV(e)}`},null!=n?n:{}))}class UZ extends yZ{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve),this.child=lQ(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet,r)}initFacet(e,t){return rV(e)?p$(e,((e,n,r)=>OP([$L,HL],r)?void 0===n.field?(hq(JU(n,r)),e):(e[r]=zV(n,r,t),e):(hq(ZU(r,"facet")),e)),{}):{facet:zV(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=WZ(this),this.child.parseData()}parseLayoutSize(){zZ(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of Oj)FZ(e,t);BZ(e,"x"),BZ(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const r={};for(const i of Oj)for(const a of hY){const o=this.component.layoutHeaders[i],s=o[a],{facetFieldDef:u}=o;if(u){const t=lY("titleOrient",u,this.config,i);if(OP(["right","bottom"],t)){const n=cY(i,t);r.titleAnchor=null!==(e=r.titleAnchor)&&void 0!==e?e:{},r.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const e="row"===i?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(e)||(r[s]=null!==(t=r[s])&&void 0!==t?t:{},r[s][i]=.5),o.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof UZ))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(e){return this.parent&&this.parent instanceof UZ?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:NV(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof UZ){if(this.child.channelHasField("column")){const r=NV(this.child.facet.column);e.push(r),t.push("distinct"),n.push(`distinct_${r}`)}}else for(const r of fU){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),o=i.get("range");if(mW(a)&&Mq(o)){const i=GJ(KJ(this.child,r));i?(e.push(i),t.push("distinct"),n.push(`distinct_${i}`)):hq(`Unknown field for ${r}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const e of Oj){const t=this.facet[e];if(t){s.push(NV(t));const{bin:u,sort:c}=t;if(FU(u)&&s.push(NV(t,{binSuffix:"end"})),tV(c)){const{field:e,op:s=JW}=c,u=jZ(t,c);n&&r?(i.push(u),a.push("max"),o.push(u)):(i.push(e),a.push(s),o.push(u))}else if(Qz(c)){const n=uY(t,e);i.push(n),a.push("max"),o.push(n)}}}const u=!!n&&!!r;return Object.assign({name:e,data:t,groupby:s},u||i.length>0?{aggregate:Object.assign(Object.assign({},u?{cross:u}:{}),i.length?{fields:i,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?tV(n.sort)?[jZ(n,n.sort,{expr:"datum"})]:Qz(n.sort)?[uY(n,e,{expr:"datum"})]:[NV(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(tV(e)?e.order:!Qz(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return bY(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const r of pY)if(e[r]){const i=lY("labelOrient",e[r],t,r);if(OP(n[r],i))return bY(e[r],r,t)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=OZ(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),i=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:Oj.map((e=>this.facetSortFields(e))).flat(),order:Oj.map((e=>this.facetSortOrder(e))).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&UP(e.component.selection).length){const n=fP(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Lz("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return bK(t)}(this,[])))]}getMapping(){return this.facet}}function qZ(e,t){var n,r,i,a,o,s,u,c,l,f;for(const p of t){const t=p.data;if(!(e.name&&p.hasName()&&e.name!==p.dataName||(null===(n=e.format)||void 0===n?void 0:n.mesh)&&(null===(r=t.format)||void 0===r?void 0:r.feature)||((null===(i=e.format)||void 0===i?void 0:i.feature)||(null===(a=t.format)||void 0===a?void 0:a.feature))&&(null===(o=e.format)||void 0===o?void 0:o.feature)!==(null===(s=t.format)||void 0===s?void 0:s.feature)||((null===(u=e.format)||void 0===u?void 0:u.mesh)||(null===(c=t.format)||void 0===c?void 0:c.mesh))&&(null===(l=e.format)||void 0===l?void 0:l.mesh)!==(null===(f=t.format)||void 0===f?void 0:f.mesh)))if($H(e)&&$H(t)){if(NP(e.values,t.values))return p}else if(VH(e)&&VH(t)){if(e.url===t.url)return p}else if(HH(e)&&e.name===p.dataName)return p}return null}function WZ(e){var t,n,r,i,a,o,s,u,c,l;let f=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new rJ({values:[]});return t.push(e),e}const n=qZ(e.data,t);if(n)return GH(e.data)||(n.data.format=function(e,...t){for(const n of t)RP(e,null!=n?n:{});return e}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new rJ(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:p,outputNodeRefCounts:h}=e.component.data,d=e.parent?e.parent.component.data.ancestorParse.clone():new WH,m=e.data;GH(m)?(KH(m)?f=new oJ(f,m.sequence):YH(m)&&(f=new aJ(f,m.graticule)),d.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(d.parseNothing=!0),f=null!==(n=mJ.makeExplicit(f,e,d))&&void 0!==n?n:f,f=new gJ(f);const g=e.parent&&gZ(e.parent);(hZ(e)||dZ(e))&&g&&(f=null!==(r=nJ.makeFromEncoding(f,e))&&void 0!==r?r:f),e.transforms.length>0&&(f=function(e,t,n){var r,i;let a=0;for(const o of t.transforms){let s,u;if(lG(o))u=e=new sY(e,o),s="derived";else if(QH(o)){const i=dJ(o);u=e=null!==(r=mJ.makeWithAncestors(e,{},i,n))&&void 0!==r?r:e,e=new qX(e,t,o.filter)}else if(fG(o))u=e=nJ.makeFromTransform(e,o,t),s="number";else if(hG(o))s="date",void 0===n.getWithExplicit(o.field).value&&(e=new mJ(e,{[o.field]:s}),n.set(o.field,s,!1)),u=e=KG.makeFromTransform(e,o);else if(dG(o))u=e=fJ.makeFromTransform(e,o),s="number",IK(t)&&(e=new gJ(e));else if(eG(o))u=e=kZ.make(e,t,o,a++),s="derived";else if(sG(o))u=e=new bJ(e,o),s="number";else if(uG(o))u=e=new vJ(e,o),s="number";else if(mG(o))u=e=yJ.makeFromTransform(e,o),s="derived";else if(gG(o))u=e=new EZ(e,o),s="derived";else if(cG(o))u=e=new wZ(e,o),s="derived";else if(tG(o))u=e=new MZ(e,o),s="derived";else if(oG(o))e=new TZ(e,o);else if(pG(o))u=e=NZ.makeFromTransform(e,o),s="derived";else if(nG(o))u=e=new bZ(e,o),s="derived";else if(rG(o))u=e=new DZ(e,o),s="derived";else if(iG(o))u=e=new _Z(e,o),s="derived";else{if(!aG(o)){hq(`Ignoring an invalid transform: ${_P(o)}.`);continue}u=e=new AZ(e,o),s="derived"}if(u&&void 0!==s)for(const e of null!==(i=u.producedFields())&&void 0!==i?i:[])n.set(e,s,!1)}return e}(f,e,d));const v=function(e){const t={};if(hZ(e)&&e.component.selection)for(const n of UP(e.component.selection)){const r=e.component.selection[n];for(const e of r.project.items)!e.channel&&eL(e.field)>1&&(t[e.field]="flatten")}return t}(e),y=function(e){const t={};function n(e){var n;qV(e)?t[e.field]="date":"quantitative"===e.type&&lP(n=e.aggregate)&&OP(["min","max"],n)?t[e.field]="number":eL(e.field)>1?e.field in t||(t[e.field]="flatten"):wV(e)&&tV(e.sort)&&eL(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((hZ(e)||dZ(e))&&e.forEachFieldDef(((t,r)=>{if(bV(t))n(t);else{const i=Hj(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}})),hZ(e)){const{mark:n,markDef:r,encoding:i}=e;if(kL(n)&&!e.encoding.order){const e=i["horizontal"===r.orient?"y":"x"];hV(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}(e);f=null!==(i=mJ.makeWithAncestors(f,{},Object.assign(Object.assign({},v),y),d))&&void 0!==i?i:f,hZ(e)&&(f=CZ.parseAll(f,e),f=SZ.parseAll(f,e)),(hZ(e)||dZ(e))&&(g||(f=null!==(a=nJ.makeFromEncoding(f,e))&&void 0!==a?a:f),f=null!==(o=KG.makeFromEncoding(f,e))&&void 0!==o?o:f,f=sY.parseAllForSortIndex(f,e));const b=e.getName(ZH),x=new GG(f,b,ZH,h);if(p[b]=x,f=x,hZ(e)){const t=fJ.makeFromEncoding(f,e);t&&(f=t,IK(e)&&(f=new gJ(f))),f=null!==(s=NZ.makeFromEncoding(f,e))&&void 0!==s?s:f,f=null!==(u=yJ.makeFromEncoding(f,e))&&void 0!==u?u:f}hZ(e)&&(f=null!==(c=xZ.make(f,e))&&void 0!==c?c:f);const w=e.getName(JH),E=new GG(f,w,JH,h);p[w]=E,f=E,hZ(e)&&function(e,t){TK(e,(n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new GG(new qX(t,e,{selection:r}),i,"lookup",e.component.data.outputNodeRefCounts)}))}(e,E);let C=null;if(dZ(e)){const t=e.getName("facet");f=null!==(l=function(e,t){const{row:n,column:r}=t;if(n&&r){let t=null;for(const i of[n,r])if(tV(i.sort)){const{field:n,op:r=JW}=i.sort;e=t=new vJ(e,{joinaggregate:[{op:r,field:n,as:jZ(i,i.sort,{forAs:!0})}],groupby:[NV(i)]})}return t}return null}(f,e.facet))&&void 0!==l?l:f,C=new pJ(f,e,t,E.getSource()),p[t]=C}return Object.assign(Object.assign({},e.component.data),{outputNodes:p,outputNodeRefCounts:h,raw:x,main:E,facetRoot:C,ancestorParse:d})}class VZ extends vZ{constructor(e,t,n,r){var i,a,o,s;super(e,"concat",t,n,r,e.resolve),"shared"!==(null===(a=null===(i=e.resolve)||void 0===i?void 0:i.axis)||void 0===a?void 0:a.x)&&"shared"!==(null===(s=null===(o=e.resolve)||void 0===o?void 0:o.axis)||void 0===s?void 0:s.y)||hq("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map(((e,t)=>lQ(e,this,this.getName("concat_"+t),void 0,r)))}parseData(){this.component.data=WZ(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of UP(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return $$(e)?e.vconcat:H$(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){zZ(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";PZ(e,t),PZ(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.forEach((e=>e.assembleSignals())),[]}assembleLayoutSignals(){const e=SY(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleMarks(){return this.children.map((e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const $Z=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},cL),{labelExpr:1,encode:1}),HZ=UP($Z);class GZ extends zH{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new GZ(AP(this.explicit),AP(this.implicit),this.mainExtracted)}hasAxisPart(e){return!("axis"!==e&&("grid"===e||"title"===e?!this.get(e):!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return _q(this.explicit.orient)}}const KZ={bottom:"top",top:"bottom",left:"right",right:"left"};function XZ(e,t){if(!e)return t.map((e=>e.clone()));{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t[r];if(!!n!=!!i)return;if(n&&i){const t=n.getWithExplicit("orient"),a=i.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[r]=YZ(n,i)}}}return e}function YZ(e,t){for(const n of HZ){const r=qH(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",((e,t)=>{switch(n){case"title":return a$(e,t);case"gridScale":return{explicit:e.explicit,value:tL(e.value,t.value)}}return UH(e,t,n,"axis")}));e.setWithExplicit(n,r)}return e}function JZ(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(_q(n.labelAngle)?n.labelAngle:rL(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===oY(r,i))return!0}return e===n[t]}const ZZ=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function QZ(e,t){var n,r,i;let a=t.axis(e);const o=new GZ,s=BV(t.encoding[e]),{mark:u,config:c}=t,l=(null==a?void 0:a.orient)||(null===(n=c["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=c.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),f=t.getScaleComponent(e).get("type"),p=function(e,t,n,r){const i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:t in fW?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=_q(n)?"axisOrient":"axis"+KP(n),s=[...i,...i.map((e=>a+e.substr(4)))],u=["axis",o,a];return{vlOnlyAxisConfig:QX(s,r,e,n),vgAxisConfig:QX(u,r,e,n),axisConfigStyle:eY([...u,...s],r)}}(e,f,l,t.config),h=void 0!==a?!a:tY("disable",c,null==a?void 0:a.style,p).configValue;if(o.set("disable",h,void 0!==a),h)return o;a=a||{};const d=function(e,t,n,r,i){const a=null==t?void 0:t.labelAngle;if(void 0!==a)return _q(a)?a:rL(a);{const{configValue:a}=tY("labelAngle",e.config,null==t?void 0:t.style,i);return void 0!==a?rL(a):n===KL&&OP([Jq,Xq],r.type)?270:void 0}}(t,a,e,s,p),m={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:l,labelAngle:d,mark:u,config:c};for(const n of HZ){const r=n in nY?nY[n](m):fL(n)?a[n]:void 0,i=void 0!==r,s=JZ(r,n,a,t,e);if(i&&s)o.set(n,r,s);else{const{configValue:e,configFrom:u}=fL(n)&&"values"!==n?tY(n,t.config,a.style,p):{},c=void 0!==e;i&&!c?o.set(n,r,s):("vgAxisConfig"!==u||ZZ.has(n)&&c||oL(e)||_q(e))&&o.set(n,e,!1)}}const g=null!==(i=a.encoding)&&void 0!==i?i:{},v=sL.reduce(((n,r)=>{var i;if(!o.hasAxisPart(r))return n;const a=_Y(null!==(i=g[r])&&void 0!==i?i:{},t),s="labels"===r?function(e,t,n){var r;const{encoding:i,config:a}=e,o=null!==(r=BV(i[t]))&&void 0!==r?r:BV(i[Kj(t)]),s=e.axis(t)||{},{format:u,formatType:c}=s;return jW(c)?Object.assign({text:VW({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:c,config:a})},n):n}(t,e,a):a;return void 0===s||jP(s)||(n[r]={update:s}),n}),{});return jP(v)||o.set("encode",v,!!a.encoding||void 0!==a.labelAngle),o}function eQ(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),AG("x",e,{defaultPos:"mid"})),AG("y",e,{defaultPos:"mid"})),CG("size",e)),CG("angle",e)),function(e,t,n){return n?{shape:{value:n}}:CG("shape",e)}(e,0,t))}const tQ={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),TG("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),TG("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),CG("size",e,{vgChannel:"strokeWidth"})):{}}},nQ={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),AG("x",e,{defaultPos:"mid",vgChannel:"xc"})),AG("y",e,{defaultPos:"mid",vgChannel:"yc"})),CG("size",e,{defaultValue:rQ(e),vgChannel:i})),{[a]:KV(ZV("thickness",n,t))})}};function rQ(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(t=ZV("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==s)return s;{const e=o?o.get("range"):void 0;return e&&Mq(e)&&cP(e.step)?3*e.step/4:3*J$(n.view,a)/4}}const iQ={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),AG("x",e,{defaultPos:"mid"})),AG("y",e,{defaultPos:"mid"})),FG(e,"radius","arc")),FG(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),TG("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),TG("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),UG(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),FG(e,"x","bar")),FG(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>eQ(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&hV(n)&&n.type===Zq?{field:NV(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),FG(e,"x","image")),FG(e,"y","image")),yG(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),AG("x",e,{defaultPos:"mid"})),AG("y",e,{defaultPos:"mid"})),CG("size",e,{vgChannel:"strokeWidth"})),UG(e))},point:{vgMark:"symbol",encodeEntry:e=>eQ(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),FG(e,"x","rect")),FG(e,"y","rect"))},rule:tQ,square:{vgMark:"symbol",encodeEntry:e=>eQ(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),AG("x",e,{defaultPos:"mid"})),AG("y",e,{defaultPos:"mid"})),yG(e)),CG("size",e,{vgChannel:"fontSize"})),CG("angle",e)),qG("align",function(e,t,n){if(void 0===ZV("align",e,n))return"center"}(e.markDef,0,t))),qG("baseline",function(e,t,n){if(void 0===ZV("baseline",e,n))return"middle"}(e.markDef,0,t))),AG("radius",e,{defaultPos:null,isMidPoint:!0})),AG("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:nQ,trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},LG(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),AG("x",e,{defaultPos:"mid"})),AG("y",e,{defaultPos:"mid"})),CG("size",e)),UG(e))}};const aQ="faceted_path_",oQ="stack_group_";function sQ(e,t={fromPrefix:""}){const{mark:n,markDef:r,config:i}=e,a=tL(r.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),o=JV(r),s=e.encoding.key,u=function(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,o=t.order;if(!(!Qz(o)&&xV(o)&&TP(o.value)||!o&&TP(ZV("order",i,a)))){if((Qz(o)||hV(o))&&!n)return n$(o,{expr:"datum"});if(kL(r)){const n="horizontal"===i.orient?"y":"x",r=t[n];if(hV(r)){const t=r.sort;return Qz(t)?{field:NV(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:tV(t)?{field:NV({aggregate:s$(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:eV(t)?{field:NV(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:NV(r,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),c=function(e){if(!e.component.selection)return null;const t=UP(e.component.selection).length;let n=t,r=e.parent;for(;r&&0===n;)n=UP(r.component.selection).length,r=r.parent;return n?{interactive:t>0}:null}(e),l=ZV("aria",r,i),f=iQ[n].postEncodingTransform?iQ[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:iQ[n].vgMark},a?{clip:!0}:{}),o?{style:o}:{}),s?{key:s.field}:{}),u?{sort:u}:{}),c||{}),!1===l?{aria:l}:{}),{from:{data:t.fromPrefix+e.requestDataName(JH)},encode:{update:iQ[n].encodeEntry(e)}}),f?{transform:f}:{})]}class uQ extends yZ{constructor(e,t,n,r={},i){var a,o;super(e,"unit",t,n,i,void 0,K$(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=ML(e.mark)?e.mark.type:e.mark;this.markDef=function(e,t,n,{graticule:r}){const i=ML(e)?Object.assign({},e):{type:e},a=ZV("orient",i,n);if(i.orient=function(e,t,n){switch(e){case yL:case SL:case NL:case wL:case bL:case gL:return}const{x:r,y:i,x2:a,y2:o}=t;switch(e){case mL:if(hV(r)&&(RU(r.bin)||hV(i)&&i.aggregate&&!r.aggregate))return"vertical";if(hV(i)&&(RU(i.bin)||hV(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(hV(r)&&r.type===Kq&&!FU(r.bin)||vV(r)))return"horizontal";if(!o&&(hV(i)&&i.type===Kq&&!FU(i.bin)||vV(i)))return"vertical"}case xL:if(a&&(!hV(r)||!RU(r.bin))&&o&&(!hV(i)||!RU(i.bin)))return;case dL:if(o)return hV(i)&&RU(i.bin)?"horizontal":"vertical";if(a)return hV(r)&&RU(r.bin)?"vertical":"horizontal";if(e===xL){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case vL:case EL:{const t=gV(r),a=gV(i);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=r,a=i,o=t.type===Yq,s=a.type===Yq;return o&&!s?"tick"!==e?"vertical":"horizontal":!o&&s?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(i.type,t,a),void 0!==a&&a!==i.orient&&hq(`Specified orient "${i.orient}" overridden with "${a}".`),"bar"===i.type&&i.orient){const e=ZV("cornerRadiusEnd",i,n);if(void 0!==e){const n="horizontal"===i.orient&&t.x2||"vertical"===i.orient&&t.y2?["cornerRadius"]:IL[i.orient];for(const t of n)i[t]=e;void 0!==i.cornerRadiusEnd&&delete i.cornerRadiusEnd}}return void 0===ZV("opacity",i,n)&&(i.opacity=function(e,t){if(OP([yL,EL,SL,NL],e)&&!s$(t))return.7}(i.type,t)),void 0===i.filled&&(i.filled=!r&&function(e,t){const n=QV("filled",e,t),r=e.type;return tL(n,r!==yL&&r!==vL&&r!==xL)}(i,n)),void 0===ZV("cursor",i,n)&&(i.cursor=function(e,t,n){return t.href||e.href||ZV("href",e,n)?"pointer":e.cursor}(i,t,n)),i}(e.mark,null!==(a=e.encoding)&&void 0!==a?a:{},i,{graticule:e.data&&YH(e.data)});const u=this.encoding=c$(null!==(o=e.encoding)&&void 0!==o?o:{},this.markDef,i);this.size=function({encoding:e,size:t}){for(const n of fU){const r=Xj(n);G$(t[r])&&gV(e[n])&&(delete t[r],hq(aq(r)))}return t}({encoding:u,size:K$(e)?Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):r}),this.stack=mH(s,u),this.specifiedScales=this.initScales(s,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegend(u),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===AL,n=e&&Dj.some((t=>yV(e[t])));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return kU.reduce(((e,n)=>{var r;const i=BV(t[n]);return i&&(e[n]=null!==(r=i.scale)&&void 0!==r?r:{}),e}),{})}initAxes(e){return fU.reduce(((t,n)=>{const r=e[n];if(yV(r)||n===KL&&yV(e.x2)||n===XL&&yV(e.y2)){const e=yV(r)?r.axis:void 0;t[n]=e?Object.assign({},e):e}return t}),{})}initLegend(e){return NU.reduce(((t,n)=>{const r=BV(e[n]);if(r&&function(e){switch(e){case oj:case sj:case uj:case lj:case cj:case pj:case mj:case gj:return!0;case hj:case dj:case fj:return!1}}(n)){const e=r.legend;t[n]=e?Object.assign({},e):e}return t}),{})}parseData(){this.component.data=WZ(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const r of fU){const i=Xj(r);if(t[i]){const e=t[i];n.layoutSize.set(i,G$(e)?"step":e,!0)}else{const t=LZ(e,i);n.layoutSize.set(i,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const r={},i=e.config.selection;for(const a of UP(null!=t?t:{})){const o=AP(t[a]),s=i[o.type],{fields:u,encodings:c}=s,l=hP(s,["fields","encodings"]);for(const e in l)"encodings"===e&&o.fields||"fields"===e&&o.encodings||("mark"===e&&(o[e]=Object.assign(Object.assign({},l[e]),o[e])),void 0!==o[e]&&!0!==o[e]||(o[e]=null!==(n=l[e])&&void 0!==n?n:o[e]));const f=$P(a),p=r[f]=Object.assign(Object.assign({},o),{name:f,events:lP(o.on)?Lz(o.on,"scope"):AP(o.on)});gK(p,(n=>{n.has(p)&&n.parse&&n.parse(e,p,o,t[a])}))}return r}(this,this.selection)}parseMarkGroup(){var e;this.component.mark=OP([vL,dL,CL],(e=this).mark)?function(e){const t=h$(e.mark,e.encoding),n=sQ(e,{fromPrefix:t.length>0?aQ:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:aQ+e.requestDataName(JH),data:e.requestDataName(JH),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(e):OP([mL],e.mark)?function(e){const t=Fq.some((t=>ZV(t,e.markDef,e.config)));if(e.stack&&!e.fieldDef("size")&&t){const[t]=sQ(e,{fromPrefix:oQ}),n=e.scaleName(e.stack.fieldChannel),r=(t={})=>e.vgField(e.stack.fieldChannel,t),i=(e,t)=>`${e}(${[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})].map((e=>`scale('${n}',${e})`)).join(",")})`;let a,o;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},kP(t.encode.update,["y","yc","y2","height",...Fq])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},DP(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},kP(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},DP(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of Fq){const r=QV(n,e.markDef,e.config);t.encode.update[n]?(a[n]=t.encode.update[n],delete t.encode.update[n]):r&&(a[n]=KV(r)),r&&(t.encode.update[n]={value:0})}const s=e.fieldDef(e.stack.groupbyChannel),u=NV(s)?[NV(s)]:[];return((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&u.push(NV(s,{binSuffix:"end"})),a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,r)=>{if(t.encode.update[r])return Object.assign(Object.assign({},n),{[r]:t.encode.update[r]});{const t=QV(r,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[r]:KV(t)}):n}}),a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(JH),name:oQ+e.requestDataName(JH),groupby:u,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}return sQ(e)}(e):sQ(e)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,fU.reduce(((t,n)=>(e.component.scales[n]&&(t[n]=[QZ(n,e)]),t)),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;if(TK(e,((r,i)=>{const a=r.name,o=fP(a+kK);if(0===t.filter((e=>e.name===a)).length){const e="global"===r.resolve?"union":r.resolve,n="multi"===r.type?", true)":")";t.push({name:r.name,update:`${_K}(${o}, ${fP(e)}${n}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),gK(r,(n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))}))})),n){0===t.filter((e=>"unit"===e.name)).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return bK(t)}(this,e)}assembleSignals(){return[...KX(this),...(e=this,t=[],TK(e,((n,r)=>{const i=n.name;let a=r.modifyExpr(e,n);t.push(...r.signals(e,n)),gK(n,(r=>{r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(a=r.modifyExpr(e,n,a))})),t.push({name:i+"_modify",on:[{events:{signal:n.name+DK},update:`modify(${fP(n.name+kK)}, ${a})`}]})})),bK(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return TK(e,(t=>{const r={name:t.name+kK};if(t.init){const n=t.project.items.map((e=>{const{signals:t}=e;return hP(e,["signals"])})),i=t.init.map((e=>vK(e,!1)));r.values="interval"===t.type?[{unit:OK(e,{escape:!1}),fields:n,values:i}]:i.map((t=>({unit:OK(e,{escape:!1}),fields:n,values:t})))}n.filter((e=>e.name===t.name+kK)).length||n.push(r)})),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return SY(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&gZ(this.parent)||(t=yK(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return o$(this.encoding,e)}fieldDef(e){return RV(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return bV(t)?t:null}}class cQ extends vZ{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map(((e,t)=>{if(cH(e))return new cQ(e,this,this.getName("layer_"+t),a,i);if(FL(e))return new uQ(e,this,this.getName("layer_"+t),a,i);throw new Error(LU(e))}))}parseData(){this.component.data=WZ(this);for(const e of this.children)e.parseData()}parseLayoutSize(){zZ(this),PZ(this,"width"),PZ(this,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of UP(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const i of UP(t.component.axes))r.axis[i]=TY(e.component.resolve,i),"shared"===r.axis[i]&&(n[i]=XZ(n[i],t.component.axes[i]),n[i]||(r.axis[i]="independent",delete n[i]))}for(const a of fU){for(const o of e.children)if(o.component.axes[a]){if("independent"===r.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(o.component.axes[a]);for(const e of o.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!_q(t)){if(i[t]>0&&!n){const n=KZ[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete o.component.axes[a]}if("independent"===r.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleSignals())),KX(this))}assembleLayoutSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleLayoutSignals())),SY(this))}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)hZ(n)&&(t=yK(n,t));return t}(this,this.children.flatMap((e=>e.assembleMarks())))}assembleLegends(){return this.children.reduce(((e,t)=>e.concat(t.assembleLegends())),KY(this))}}function lQ(e,t,n,r,i){if(aV(e))return new UZ(e,t,n,i);if(cH(e))return new cQ(e,t,n,r,i);if(FL(e))return new uQ(e,t,n,r,i);if(function(e){return $$(e)||H$(e)||V$(e)}(e))return new VZ(e,t,n,i);throw new Error(LU(e))}function fQ(e,t={}){var n;t.logger&&(n=t.logger,pq=n),t.fieldTitle&&MV(t.fieldTitle);try{const n=iH(nP(t.config,e.config)),r=OH(e,n),i=lQ(r,null,"",void 0,n);i.parse(),function(e,t){iJ(e.sources);let n=0,r=0;for(let r=0;r<5&&zJ(e,t);r++)n++;e.sources.map(NJ);for(let n=0;n<5&&zJ(e,t);n++)r++;iJ(e.sources),5===Math.max(n,r)&&hq("Maximum optimization runs(5) reached.")}(i.component.data,i);const a=function(e,t,n={},r){const i=e.config?function(e){e=AP(e);for(const t of oH)delete e[t];if(e.axis)for(const t in e.axis)oL(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of B$)delete e.legend[t];if(e.mark){for(const t of OL)delete e.mark[t];e.mark.tooltip&&eP(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of aH){for(const n of OL)delete e[t][n];const n=sH[t];if(n)for(const r of n)delete e[t][r];uH(e,t)}for(const t of UP(F$))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=HV(e.title);jP(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),jP(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),jP(r)?delete e.title:e.title=r}(e);for(const t in e)eP(e[t])&&jP(e[t])&&delete e[t];return jP(e)?void 0:e}(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r;const i=[],a=OZ(i);let o=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+o++);const e=t.assemble();a(t,e)}for(const e of i)0===e.transform.length&&delete e.transform;let s=0;for(const[e,t]of i.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||i.splice(s++,0,i.splice(e,1)[0]);for(const t of i)for(const n of null!==(r=t.transform)&&void 0!==r?r:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of i)e.name in t&&(e.values=t[e.name]);return i}(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),u=e.assembleGroupStyle(),c=e.assembleGroupEncodeEntry(!0);let l=e.assembleLayoutSignals();return l=l.filter((e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1))),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),s?{title:s}:{}),u?{style:u}:{}),c?{encode:{update:c}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...l,...e.assembleSelectionTopLevelSignals([])])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");if(void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):lP(t)&&(t={type:t}),i&&a&&("fit"===(o=t.type)||"fit-x"===o||"fit-y"===o))if("step"===i&&"step"===a)hq(qU()),t.type="pad";else if("step"===i||"step"===a){const e="step"===i?"width":"height";hq(qU(mU(e)));const n="width"===e?"height":"width";t.type=function(e){return e?`fit-${mU(e)}`:"fit"}(n)}var o;return Object.assign(Object.assign(Object.assign({},1===UP(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),BH(n)),BH(e))}(e,r.autosize,n,i),e.datasets,e.usermeta);return{spec:a,normalized:r}}finally{t.logger&&(pq=lq),t.fieldTitle&&MV(DV)}}const pQ=new class extends lH{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:r}=e,{bins:i,timeUnits:a,aggregate:o,groupby:s,encoding:u}=u$(n,t),c=[...r||[],...i,...a,...0===o.length?[]:[{aggregate:o,groupby:s}]];return Object.assign(Object.assign(Object.assign({},e),c.length>0?{transform:c}:{}),{encoding:u})}return e}};function hQ(e,t){return pQ.map(e,{config:t})}const dQ="4.13.1",mQ=function(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}},gQ="#fff",vQ={background:"#333",title:{color:gQ,subtitleColor:gQ},style:{"guide-label":{fill:gQ},"guide-title":{fill:gQ}},axis:{domainColor:gQ,gridColor:"#888",tickColor:gQ}},yQ="#4572a7",bQ={background:"#fff",arc:{fill:yQ},area:{fill:yQ},line:{stroke:yQ,strokeWidth:2},path:{stroke:yQ},rect:{fill:yQ},shape:{stroke:yQ},symbol:{fill:yQ,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},xQ="#30a2da",wQ="#cbcbcb",EQ="#f0f0f0",CQ="#333",SQ={arc:{fill:xQ},area:{fill:xQ},axis:{domainColor:wQ,grid:!0,gridColor:wQ,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:wQ,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:EQ,group:{fill:EQ},legend:{labelColor:CQ,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:CQ,titleFontSize:14,titlePadding:10},line:{stroke:xQ,strokeWidth:2},path:{stroke:xQ,strokeWidth:.5},rect:{fill:xQ},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:xQ},bar:{binSpacing:2,fill:xQ,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},NQ="#000",AQ={group:{fill:"#e5e5e5"},arc:{fill:NQ},area:{fill:NQ},line:{stroke:NQ},path:{stroke:NQ},rect:{fill:NQ},shape:{stroke:NQ},symbol:{fill:NQ,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},kQ="Benton Gothic, sans-serif",DQ="#82c6df",_Q="Benton Gothic Bold, sans-serif",MQ="normal",TQ={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},OQ={background:"#ffffff",title:{anchor:"start",color:"#000000",font:_Q,fontSize:22,fontWeight:"normal"},arc:{fill:DQ},area:{fill:DQ},line:{stroke:DQ,strokeWidth:2},path:{stroke:DQ},rect:{fill:DQ},shape:{stroke:DQ},symbol:{fill:DQ,size:30},axis:{labelFont:kQ,labelFontSize:11.5,labelFontWeight:"normal",titleFont:_Q,titleFontSize:13,titleFontWeight:MQ},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:kQ,labelFontSize:11.5,symbolType:"square",titleFont:_Q,titleFontSize:13,titleFontWeight:MQ},range:{category:TQ["category-6"],diverging:TQ["fireandice-6"],heatmap:TQ["fire-7"],ordinal:TQ["fire-7"],ramp:TQ["fire-7"]}},IQ="#ab5787",FQ="#979797",RQ={background:"#f9f9f9",arc:{fill:IQ},area:{fill:IQ},line:{stroke:IQ},path:{stroke:IQ},rect:{fill:IQ},shape:{stroke:IQ},symbol:{fill:IQ,size:30},axis:{domainColor:FQ,domainWidth:.5,gridWidth:.2,labelColor:FQ,tickColor:FQ,tickWidth:.2,titleColor:FQ},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},BQ="#3e5c69",zQ={background:"#fff",arc:{fill:BQ},area:{fill:BQ},line:{stroke:BQ},path:{stroke:BQ},rect:{fill:BQ},shape:{stroke:BQ},symbol:{fill:BQ},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},PQ="#1696d2",LQ="#000000",jQ="Lato",UQ="Lato",qQ={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},WQ={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:jQ},axisX:{domain:!0,domainColor:LQ,domainWidth:1,grid:!1,labelFontSize:12,labelFont:UQ,labelAngle:0,tickColor:LQ,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:jQ},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:UQ,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:jQ,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:UQ,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:jQ,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:qQ["six-groups-cat-1"],diverging:qQ["diverging-colors"],heatmap:qQ["diverging-colors"],ordinal:qQ["six-groups-seq"],ramp:qQ["shades-blue"]},area:{fill:PQ},rect:{fill:PQ},line:{color:PQ,stroke:PQ,strokeWidth:5},trail:{color:PQ,stroke:PQ,strokeWidth:0,size:1},path:{stroke:PQ,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:PQ,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:PQ,stroke:null}},arc:{fill:PQ},shape:{stroke:PQ},symbol:{fill:PQ,size:30}},VQ="#3366CC",$Q="#ccc",HQ="Arial, sans-serif",GQ={arc:{fill:VQ},area:{fill:VQ},path:{stroke:VQ},rect:{fill:VQ},shape:{stroke:VQ},symbol:{stroke:VQ},circle:{fill:VQ},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:HQ,fontSize:12},"guide-title":{font:HQ,fontSize:12},"group-title":{font:HQ,fontSize:12}},title:{font:HQ,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:$Q,tickColor:$Q,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},KQ="2.10.0";const XQ="vg-tooltip-element",YQ={offsetX:10,offsetY:10,id:XQ,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function JQ(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}class ZQ{constructor(e){this.options=Object.assign(Object.assign({},YQ),e);const t=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(XQ,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}}tooltipHandler(e,t,n,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(null!=document.fullscreenElement?document.fullscreenElement:document.body).appendChild(this.el),null==r||""===r)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=function(e,t,n){if(Ee(e))return`[${e.map((e=>t(yt(e)?e:JQ(e,n)))).join(", ")}]`;if(Ce(e)){let r="";const i=e,{title:a,image:o}=i,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const u=Object.keys(s);if(u.length>0){r+="<table>";for(const e of u){let i=s[e];void 0!==i&&(Ce(i)&&(i=JQ(i,n)),r+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:i,y:a}=function(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${i}px`)}}function QQ(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}u((r=r.apply(e,t||[])).next())}))}var e0;function t0(e,...t){for(const n of t)n0(e,n);return e}function n0(e,t){for(const n of Object.keys(t))Ae(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const r0=v;let i0=y;const a0="undefined"!=typeof window?window:void 0;void 0===i0&&(null===(e0=null==a0?void 0:a0.vl)||void 0===e0?void 0:e0.compile)&&(i0=a0.vl);const o0={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},s0={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},u0={vega:"Vega","vega-lite":"Vega-Lite"},c0={vega:r0.version,"vega-lite":i0?i0.version:"not available"},l0={vega:e=>e,"vega-lite":(e,t)=>i0.compile(e,{config:t}).spec};function f0(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+a),o.document.title=`${u0[r]} JSON Source`}function p0(e,t){var n;if(e.$schema){const r=mQ(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${u0[r.library]}, but mode argument sets ${null!==(n=u0[t])&&void 0!==n?n:t}.`);const i=r.library;return(0,Q.satisfies)(c0[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${u0[i]} ${r.version}, but the current version of ${u0[i]} is v${c0[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}function h0(e){return(t=e)&&"load"in t?e:r0.loader(e);var t}function d0(e){var t;return null!==(t=e.usermeta&&e.usermeta.embedOptions)&&void 0!==t?t:{}}function m0(e,t){var n;return QQ(this,void 0,void 0,(function*(){const r=yt(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},i=yt(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})}))}const g0=function(e,t,n={}){var r,i,a;return QQ(this,void 0,void 0,(function*(){let o,s;yt(t)?(s=h0(n.loader),o=JSON.parse(yield s.load(t))):o=t;const u=d0(o).loader;s&&!u||(s=h0(null!==(r=n.loader)&&void 0!==r?r:u));const c=yield m0(d0(o),s),l=yield m0(n,s),f=Object.assign(Object.assign({},t0(l,c)),{config:Ne(null!==(i=l.config)&&void 0!==i?i:{},null!==(a=c.config)&&void 0!==a?a:{})});return yield function(e,t,n={},r){var i,a,o,s,u,c;return QQ(this,void 0,void 0,(function*(){const l=n.theme?Ne(b[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,f=ht(n.actions)?n.actions:t0({},o0,null!==(a=n.actions)&&void 0!==a?a:{}),p=Object.assign(Object.assign({},s0),n.i18n),h=null!==(o=n.renderer)&&void 0!==o?o:"canvas",d=null!==(s=n.logLevel)&&void 0!==s?s:r0.Warn,m=null!==(u=n.downloadFileName)&&void 0!==u?u:"visualization",g="string"==typeof e?document.querySelector(e):e;if(!g)throw new Error(`${e} does not exist`);if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:r}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(g);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n'.toString():n.defaultStyle,r.appendChild(t)}}const v=p0(t,n.mode);let y=l0[v](t,l);if("vega-lite"===v&&y.$schema){const e=mQ(y.$schema);(0,Q.satisfies)(c0.vega,`^${e.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${c0.vega}.`)}g.classList.add("vega-embed"),f&&g.classList.add("has-actions"),g.innerHTML="";let x=g;if(f){const e=document.createElement("div");e.classList.add("chart-wrapper"),g.appendChild(e),x=e}const w=n.patch;w&&(y=w instanceof Function?w(y):P(y,w,!0,!1).newDocument),n.formatLocale&&r0.formatLocale(n.formatLocale),n.timeFormatLocale&&r0.timeFormatLocale(n.timeFormatLocale);const{ast:E}=n,C=r0.parse(y,"vega-lite"===v?{}:l,{ast:E}),S=new(n.viewClass||r0.View)(C,Object.assign({loader:r,logLevel:d,renderer:h},E?{expr:r0.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e="function"==typeof n.tooltip?n.tooltip:new ZQ(!0===n.tooltip?{}:n.tooltip).call,S.tooltip(e)}let N,{hover:A}=n;if(void 0===A&&(A="vega"===v),A){const{hoverSet:e,updateSet:t}="boolean"==typeof A?{}:A;S.hover(e,t)}if(n&&(null!=n.width&&S.width(n.width),null!=n.height&&S.height(n.height),null!=n.padding&&S.padding(n.padding)),yield S.initialize(x,n.bind).runAsync(),!1!==f){let e=g;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=p.CLICK_TO_VIEW_ACTIONS,g.append(t),e=t;const n=document.createElement("summary");n.innerHTML='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',t.append(n),N=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",N)}const r=document.createElement("div");if(e.append(r),r.classList.add("vega-actions"),!0===f||!1!==f.export)for(const e of["svg","png"])if(!0===f||!0===f.export||f.export[e]){const t=p[`${e.toUpperCase()}_ACTION`],i=document.createElement("a");i.text=t,i.href="#",i.target="_blank",i.download=`${m}.${e}`,i.addEventListener("mousedown",(function(t){return QQ(this,void 0,void 0,(function*(){t.preventDefault();const r=yield S.toImageURL(e,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===f||!1!==f.source){const e=document.createElement("a");e.text=p.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var r,i;f0(Z()(t),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",v),e.preventDefault()})),r.append(e)}if("vega-lite"===v&&(!0===f||!1!==f.compiled)){const e=document.createElement("a");e.text=p.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,r;f0(Z()(y),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),e.preventDefault()})),r.append(e)}if(!0===f||!1!==f.editor){const e=null!==(c=n.editorUrl)&&void 0!==c?c:"https://vega.github.io/editor/",i=document.createElement("a");i.text=p.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(e,t,n){const r=e.open(t),{origin:i}=new URL(t);let a=40;e.addEventListener("message",(function t(n){n.source===r&&(a=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){a<=0||(r.postMessage(n,i),setTimeout(e,250),a-=1)}),250)}(window,e,{config:l,mode:v,renderer:h,spec:Z()(t)}),n.preventDefault()})),r.append(i)}}return{view:S,spec:t,vgSpec:y,finalize:function(){N&&document.removeEventListener("click",N),S.finalize()}}}))}(e,o,f,s)}))}},9602:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},4411:(e,t,n)=>{"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t,n){var r=t===e.head?new s(n,null,t,e):new s(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function a(e,t){e.tail=new s(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new s(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function s(e,t,n,r){if(!(this instanceof s))return new s(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=s,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,a=this.head;null!==a&&i<e;i++)a=a.next;for(;null!==a&&i<t;i++,a=a.next)n.push(a.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,a=this.tail;null!==a&&i>t;i--)a=a.prev;for(;null!==a&&i>e;i--,a=a.prev)n.push(a.value);return n},r.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,a=this.head;null!==a&&r<e;r++)a=a.next;var o=[];for(r=0;a&&r<t;r++)o.push(a.value),a=this.removeNode(a);for(null===a&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev),r=0;r<n.length;r++)a=i(this,a,n[r]);return o},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n(9602)(r)}catch(e){}},9127:()=>{},4902:()=>{},522:()=>{},753:()=>{},802:()=>{},4633:()=>{},5688:()=>{},8369:()=>{},3655:()=>{},5118:()=>{},2007:()=>{},1801:e=>{"use strict";var t=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,n){var r,i,a;return n=n||{},r=JSON.stringify([1],void 0,void 0===n.indent?2:n.indent).slice(2,-3),i=""===r?1/0:void 0===n.maxLength?80:n.maxLength,a=n.replacer,function e(n,o,s){var u,c,l,f,p,h,d,m,g,v,y,b;if(n&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0===(y=JSON.stringify(n,a)))return y;if(d=i-o.length-s,y.length<=d&&(g=y.replace(t,(function(e,t){return t||e+" "}))).length<=d)return g;if(null!=a&&(n=JSON.parse(y),a=void 0),"object"==typeof n&&null!==n){if(m=o+r,l=[],c=0,Array.isArray(n))for(v="[",u="]",d=n.length;c<d;c++)l.push(e(n[c],m,c===d-1?0:1)||"null");else for(v="{",u="}",d=(h=Object.keys(n)).length;c<d;c++)f=h[c],p=JSON.stringify(f)+": ",void 0!==(b=e(n[f],m,p.length+(c===d-1?0:1)))&&l.push(p+b);if(l.length>0)return[v,r+l.join(",\n"+m),u].join("\n"+o)}return y}(e,"",0)}},8593:e=>{"use strict";e.exports=JSON.parse('{"_from":"axios@^0.21.1","_id":"axios@0.21.4","_inBundle":false,"_integrity":"sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==","_location":"/axios","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"axios@^0.21.1","name":"axios","escapedName":"axios","rawSpec":"^0.21.1","saveSpec":null,"fetchSpec":"^0.21.1"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/axios/-/axios-0.21.4.tgz","_shasum":"c67b90dc0568e5c1cf2b0b858c43ba28e2eda575","_spec":"axios@^0.21.1","_where":"/Users/nick/code/numero","author":{"name":"Matt Zabriskie"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"bugs":{"url":"https://github.com/axios/axios/issues"},"bundleDependencies":false,"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}],"dependencies":{"follow-redirects":"^1.14.0"},"deprecated":false,"description":"Promise based HTTP client for the browser and node.js","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"homepage":"https://axios-http.com","jsdelivr":"dist/axios.min.js","keywords":["xhr","http","ajax","promise","node"],"license":"MIT","main":"index.js","name":"axios","repository":{"type":"git","url":"git+https://github.com/axios/axios.git"},"scripts":{"build":"NODE_ENV=production grunt build","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","examples":"node ./examples/server.js","fix":"eslint --fix lib/**/*.js","postversion":"git push && git push --tags","preversion":"npm test","start":"node ./sandbox/server.js","test":"grunt test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json"},"typings":"./index.d.ts","unpkg":"dist/axios.min.js","version":"0.21.4"}')}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var r=n(708);num=r})();